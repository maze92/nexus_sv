--- a/Nexus OS/server/metin2/Source/Server/game/src/desc.cpp
+++ b/Nexus OS/server/metin2/Source/Server/game/src/desc.cpp
@@ -1047,6 +1047,13 @@
 {
 	const BYTE* c_pszKey = GetKey() + 37;
 
+	// Avoid TEA key desync: discard pending encrypted traffic before swapping keys
+	if (m_lpInputBuffer && buffer_size(m_lpInputBuffer) > 0)
+	{
+		sys_log(0, "SetSecurityKey: flushing %d pending input bytes to avoid key desync", buffer_size(m_lpInputBuffer));
+		buffer_reset(m_lpInputBuffer);
+	}
+
 	thecore_memcpy(&m_adwDecryptionKey, c_pdwKey, 16);
 	TEA_Encrypt(&m_adwEncryptionKey[0], &m_adwDecryptionKey[0], (const DWORD*)c_pszKey, 16);
 
