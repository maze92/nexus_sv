diff --git a/client/pack/root/consolemodule.py b/client/pack/root/consolemodule.py
index c84f8e5..867de0a 100644
--- a/client/pack/root/consolemodule.py
+++ b/client/pack/root/consolemodule.py
@@ -1,909 +1,911 @@
-import app
-import grp
-import wndMgr
-import ui
-import os
-import sys
-import stat
-import chrmgr
-import chr
-import net
-import background
-import snd
-import net
-import player
-import localeInfo
-import uiScriptLocale
-
-class Console(object):
-	def __init__(self, output):
-		self.dirNameList = []
-		self.fileNameList = []
-
-		self.output = output
-		self.curPathName = "D:\\Ymir Work\\"
-		self.collision = 0
-
-		self.bgPartDict = {
-			"terrain" : background.PART_TERRAIN,
-			"object" : background.PART_OBJECT,
-			"cloud" : background.PART_CLOUD,
-			"tree" : background.PART_TREE,
-			"water" : background.PART_WATER,
-			"sky" : background.PART_SKY,
-		}
-
-		self.bgSortDict = {
-			"distance" : background.DISTANCE_SORT,
-			"texture" : background.TEXTURE_SORT,
-		}
-
-		self.game = 0
-
-	def Close(self):
-		self.output = 0
-
-	def BindGameClass(self, game):
-		self.game = game
-
-	def Exit(self):
-		#"Exit Program"
-		app.Exit()
-
-	def EnablePerformanceTime(self, mode, isEnable):
-		app.EnablePerformanceTime(mode, int(isEnable))
-
-	def ReloadLocale(self):
-		"Reload Locale"
-		reload(localeInfo)
-		reload(uiScriptLocale)
-		self.Print("RELOAD LOCALE")
-
-	def ReloadDevel(self):
-		"ReloadDevel"
-		import consoleModule
-		import uiGuild
-		import uiInventory
-		reload(uiGuild)
-		self.Print("ReloadGuild")
-		reload(uiInventory)
-		self.Print("ReloadInventory")
-
-	def ShowPerformanceInfo(self):
-		"Shows Performance Info"
-		pass
-		#self.Print(app.GetInfo(app.INFO_ACTOR))
-		#self.Print(app.GetInfo(app.INFO_ITEM))
-		#self.Print(app.GetInfo(app.INFO_EFFECT))
-		#self.Print(app.GetInfo(app.INFO_TEXTTAIL))
-
-	def Disconnect(self):
-		"Disconnect by sending unknown packet"
-		net.SendStrangePacket()
-
-	def ToggleActorDirectionLine(self):
-		"Shows character's direction line"
-		pass
-		#chrmgr.ToggleDirectionLine()
-
-	def RegisterCharacterEffect(self, effectType, effectFileName):
-		"Set character's effect state (state number, bone name, effect filename/number)"
-		if effectFileName.isdigit():
-			effectFileName = self.GetFileName(int(effectFileName))
-
-		effectFullPathFileName = self.GetFullPathName(effectFileName)
-		chrmgr.RegisterEffect(chrmgr.EFFECT_STATE+int(effectType), "", effectFullPathFileName)
-		self.Print("effect state %d: %s" % (int(effectType), effectFullPathFileName))
-
-	def SetCharacterAffect(self, affectType, isVisible):
-		"Set character's affect (number, visiblity 1|0)"
-		pass
-		#chrmgr.SetAffect(-1, int(affectType), int(isVisible))
-		#self.Print("affect set %d: %d" % (int(affectType), int(isVisible)))
-
-	def SetCharacterEmoticon(self, EmoticonNum):
-		"Show emoticon (number)"
-		chrmgr.SetEmoticon(-1, int(EmoticonNum))
-		self.Print("Emoticon %d: %d" % (int(EmoticonNum), int(isVisible)))
-
-	def ShowPickedCharacterInfo(self):
-		"Show information of picked character"
-		vid=chrmgr.GetPickedVID()
-		info=chrmgr.GetVIDInfo(vid)
-		self.Print(info)
-
-	def ShowCharacterInfo(self, arg):
-		"Show information of character (vid)"
-		if arg.isdigit():
-			vid=int(arg)
-		else:
-			vid=0
-
-		info=chrmgr.GetVIDInfo(vid)
-		self.Print(info)
-
-	def SetWeaponTraceTexture(self, arg):
-		"Sets sword afterimage texture (filename)"
-		pass
-		#if arg.isdigit():
-			#textureFileName = self.GetFileName(int(arg))
-		#else:
-			#textureFileName = arg
-
-		#chr.WeaponTraceSetTexture(textureFileName)
-
-	def SetAutoCameraRotationSpeed(self, arg):
-		"Auto camera rotation speed (angle per sec)"
-		spd=float(arg)
-		player.SetAutoCameraRotationSpeed(spd)
-
-		self.Print("Auto camera rotation speed: %f" % (spd))
-
-	def SetWeaponTraceMode(self, *mode):
-		"Sword afterimage mode (0 = Use alpha, 1 = Use texture)"
-		pass
-		#if mode and mode[0].isdigit() and int(mode[0]):
-			#chr.WeaponTraceUseTexture()
-		#else:
-			#chr.WeaponTraceUseAlpha()
-
-	def SetCollision(self, *mode):
-		"Show collison objects (0 | 1)"
-		if mode and mode[0].isdigit():
-			self.collision = int(mode[0])
-		else:
-			self.collision = not self.collision
-
-	def SetMovingSpeed(self, arg):
-		"Set walking speed"
-		pass
-		#chrmgr.SetMovingSpeed(int(arg))
-
-	def SetMusicVolume(self, arg):
-		"Set BGM volumn (0 ~ 1.0)"
-		snd.SetMusicVolume(float(arg))
-
-	def SetSoundVolume(self, arg):
-		"Set Effect sound volumn (0 ~ 5)"
-		snd.SetSoundVolume(int(arg))
-
-	def SetSoundScale(self, arg):
-		"3D Sound scale (default : 200)"
-		snd.SetSoundScale(int(arg))
-
-	def SetAmbienceSoundScale(self, arg):
-		"3D Ambience sound scale (default : 200)"
-		snd.SetAmbienceSoundScale(int(arg))
-
-	def SetCoolTime(self):
-		"Cooltime toggle"
-		flag = player.ToggleCoolTime()
-		if flag:
-			self.Print("Cooltime will be applied")
-		else:
-			self.Print("Cooltime disabled")
-
-	def SetLevelLimit(self):
-		"Sets Level limit"
-		flag = player.ToggleLevelLimit()
-		if flag:
-			self.Print("Level limit will be applied")
-		else:
-			self.Print("Level limit disabled")
-
-	def ShowCursor(self):
-		app.ShowCursor()
-
-	def HideCursor(self):
-		app.HideCursor()
-
-	def Print(self, msg):
-		self.output.Print(msg)
-
-	def RefreshPath(self):
-		self.SetPath(self.curPathName)
-
-	def	SetPath(self, newPathName):
-		if '\\' != newPathName[-1]:
-			newPathName = newPathName + '\\'
-
-		if os.access(newPathName, os.R_OK) == 0:
-			self.Print(newPathName + " Cannot find path")
-			return
-
-		nameList = os.listdir(newPathName)
-
-		dirNameList = []
-		fileNameList = []
-		for sName in nameList:
-			mode = os.stat(newPathName + sName)[stat.ST_MODE]
-			if stat.S_ISDIR(mode):
-				dirNameList.append(sName)
-			else:
-				fileNameList.append(sName)
-
-		self.curPathName = newPathName
-		self.dirNameList = dirNameList
-		self.fileNameList = fileNameList
-
-		self.ShowPath()
-
-	def GetPath(self):
-		return self.curPathName
-
-	def GetDirName(self, iDir):
-		if (len(self.dirNameList) > iDir):
-			return self.dirNameList[iDir]
-		else:
-			print len(self.dirNameList)
-			return ""
-
-	def GetFileName(self, iFile):
-		if (len(self.fileNameList)>iFile):
-			return self.fileNameList[iFile]
-		else:
-			print len(self.fileNameList)
-			return ""
-
-	def	MoveParentPath(self):
-		"Go to Parent directory"
-		newPathName=self.GetPath()
-
-		lastPos=-1
-		if '\\'==newPathName[-1]:
-			lastPos=-2
-
-		lastPos=newPathName.rfind('\\', 0,	lastPos)
-		if 0>lastPos:
-			self.Print("Here is root")
-			return
-
-		newPathName=newPathName[0:lastPos]+'\\'
-
-		self.SetPath(newPathName)
-
-	def GetFullPathName(self, sPathName):
-		sParentPathName=self.GetPath()
-
-		if '\\'!=sParentPathName[-1]:
-			sParentPathName=sParentPathName+'\\'
-
-		return sParentPathName+sPathName
-
-	def	MoveChildPath(self, directory):
-		"[Directory name/number] change to child directory"
-		if ""==directory:
-			self.Print("You need directory name or number")
-			return
-
-		if directory.isdigit():
-			directory=self.GetDirName(int(directory))
-
-		newPathName=self.GetFullPathName(directory)
-
-		self.SetPath(newPathName)
-
-	def SetHitEffect(self, arg):
-		"Sets hit effect"
-		if arg.isdigit():
-			effectFileName = self.GetFileName(int(arg))
-		else:
-			effectFileName = arg
-
-		effectFullPathFileName=self.GetFullPathName(EffectFileName)
-		chrmgr.RegisterEffect(chrmgr.EFFECT_HIT, "", effectFullPathFileName)
-
-		self.Print("Hit effect: "+effectFullPathFileName)
-
-	def SetStunEffect(self, arg):
-		"Sets stun effect"
-		if arg.isdigit():
-			effectFileName = self.GetFileName(int(arg))
-		else:
-			effectFileName = arg
-
-		effectFullPathFileName = self.GetFullPathName(effectFileName)
-		chrmgr.RegisterEffect(chrmgr.EFFECT_STUN, "Bip01 Head", effectFullPathFileName)
-
-		self.Print("Stun effect: "+effectFullPathFileName)
-
-	def SetDustEffect(self, arg):
-		"Sets dirt effect"
-		if arg.isdigit():
-			effectFileName = self.GetFileName(int(arg))
-		else:
-			effectFileName = arg
-
-		effectFullPathFileName = self.GetFullPathName(effectFileName)
-		chrmgr.RegisterEffect(chrmgr.EFFECT_DUST, "", effectFullPathFileName)
-
-		self.Print("Dirt effect: "+effectFullPathFileName)
-
-	def SetDustGap(self, arg):
-		"Sets dirt effect gap"
-		if arg.isdigit() == 0:
-			self.Print("Dirt effect gap argument must be a number")
-		else:
-			gap = int(arg)
-			chrmgr.SetDustGap(gap)
-			self.Print("Dirt effect gap: %d" % (gap))
-
-	def ShowBackgroundPart(self, arg):
-		"Show background part"
-		try:
-			background.SetVisiblePart(self.bgPartDict[arg], 1);
-		except KeyError:
-			self.Print("Unknown part: ", arg);
-		except:
-			raise
-
-	def HideBackgroundPart(self, arg):
-		"Hide background part"
-		try:
-			background.SetVisiblePart(self.bgPartDict[arg], 0);
-		except KeyError:
-			self.Print("Unknown part: ", arg);
-		except:
-			raise
-
-	def SetShadowLevel(self, arg):
-		"Shadow level setting (0~5)"
-		if arg.isdigit() == 0:
-			self.Print("Shadow setting must be a number")
-		else:
-			level = int(arg)
-
-			if level < 0 or level > 5:
-				self.Print("Shadow level range is 0~5")
-			else:
-				background.SetShadowLevel(level)
-				self.Print("Shadow level: %d" % (level))
-
-	def SetSplatLimit(self, arg):
-		"Splat number limit"
-		if arg.isdigit() == 0:
-			self.Print("Splat number limit must be a number")
-		else:
-			limit = int(arg)
-
-			background.SetSplatLimit(limit)
-			self.Print("Splat number limit: %d" % (limit))
-
-	def SelectViewDistanceNum(self, arg):
-		"View distance (0~4)"
-		if arg.isdigit() == 0:
-			self.Print("Enter between 0 to 4")
-		else:
-			settingnum = int(arg)
-
-			if settingnum < 0 or settingnum > 4:
-				self.Print("View distance range is 0 to 4")
-
-			else:
-				background.SelectViewDistanceNum(settingnum)
-				self.Print("View distance: %d" % (settingnum))
-
-	def SetBGLoading(self, bBGLoading):
-		"Background loading (0, 1)"
-		pass
-		#bResultBoolean = int(bBGLoading)
-
-		#if bResultBoolean != 0 and bResultBoolean != 1:
-			#self.Print("Enter 0 or 1")
-		#else:
-			#background.SetBGLoading(bResultBoolean)
-			#self.Print("Background loading: %d" % (bResultBoolean))
-
-	def SetTerrainRenderSort(self, arg):
-		"Terrain rendering type"
-		pass
-		#try:
-			#background.SetRenderSort(self.bgSortDict[arg]);
-		#except KeyError:
-			#self.Print("Unknown part: ", arg);
-		#except:
-			#raise
-
-	def SetTransparentTree(self, arg):
-		"Tree's leaf transparency"
-		bTransparent = int(arg)
-		try:
-			background.SetTransparentTree(bTransparent);
-		except KeyError:
-			self.Print("must be 0 or 1: ", bTransparent);
-		except:
-			raise
-
-	def WarpTest(self, warpX, warpY):
-		"WarpTest : warp dwX dwY"
-		iWarpX = int(warpX)
-		iWarpY = int(warpY)
-		try:
-			background.Destroy()
-			background.Initialize()
-			background.WarpTest(iWarpX, iWarpY);
-			background.RegisterEnvironmentData(0, "d:/ymir work/environment/b3.msenv")
-			background.SetEnvironmentData(0)
-			background.SetShadowLevel(background.SHADOW_ALL)
-		except:
-			import exception
-			exception.Abort("consoleModule.Console.WarpTest")
-
-	def ToggleDebugInfo(self):
-		"Show DebugInfo"
-		pass
-		#net.ToggleGameDebugInfo()
-
-	def ShowPath(self):
-		"Show current path"
-		self.Print("Current path is "+self.GetPath())
-
-	def	ShowList(self):
-		"Show current path's list"
-		self.ShowDirList()
-		self.ShowFileList()
-
-	def	ShowDirList(self):
-		"Show current path's child directories"
-		self.Print(self.GetPath()+" directories:")
-		self.ShowNameList(self.dirNameList)
-		self.Print("")
-
-	def	ShowFileList(self, Filter=[]):
-		"Show current path's files (extension filter)"
-		self.Print(self.GetPath()+" files:")
-		self.ShowNameList(self.fileNameList, Filter)
-		self.Print("")
-
-	def	ShowEffectList(self):
-		"Show current path's effect"
-		self.Print(self.GetPath()+" effects:")
-		self.ShowNameList(self.fileNameList, ["mse"])
-		self.Print("")
-
-	def ShowWeb(self):
-		"ShowWeb"
-		pass
-		#if app.IsWebPageMode():
-			#app.HideWebPage()
-		#else:
-			#app.ShowWebPage("http://wiki.metin.co.kr/metin1help/01.htm", (0, 0, 320, 600))
-
-	def ShowUI(self):
-		"Shows UI"
-		self.game.CheckGameButton()
-		self.game.interface.ShowDefaultWindows()
-		self.game.interface.wndChat.Show()
-		self.game.interface.wndChat.show_btnChatSizing()
-
-	def HideUI(self):
-		"Hides UI"
-		self.game.interface.HideAllWindows()
-		self.game.interface.wndChat.Hide()
-
-	def SetCameraSpeed(self, percentage):
-		"Sets camera speed (Default = 100)"
-		app.SetCameraSpeed(int(percentage))
-
-	def SaveCameraSetting(self, filename):
-		"Save current camera attributes (filename)"
-		app.SaveCameraSetting(filename)
-
-	def LoadCameraSetting(self, filename):
-		"Load camera attributes (filename)"
-		if not app.LoadCameraSetting(filename):
-			self.Print("Could not load camera attribute")
-
-	def SetcmrZ(self, z):
-		app.SetcmrZ(float(z))
-
-	def SetDefaultCamera(self):
-		"Return to default camera attribute"
-		app.SetDefaultCamera()
-
-	def ShowClock(self, second):
-		self.game.ShowClock(int(second))
-
-	def HideClock(self):
-		self.game.HideClock()
-
-	def ShowNotice(self):
-		pass
-		#app.SetVisibleNotice(True)
-		#self.Print("Show Notice")
-
-	def HideNotice(self):
-		pass
-		#app.SetVisibleNotice(False)
-		#self.Print("Hide Notice")
-
-	def SetSight(self, range):
-		pass
-		#"Set Force Sight Range"
-		#app.SetSightRange(int(range))
-
-	def SetComboType(self, type):
-		pass
-		#chr.testSetComboType(int(type))
-
-	def SetSkillGroupFake(self, index):
-		"""Å×½ºÆ® ÄÚµå"""
-		pass
-		#net.SetSkillGroupFake(int(index))
-		#self.Print(" SetSkillGroupFake : %d" % int(index))
-
-	def SetEmpireLanguageMode(self, mode):
-		net.SetEmpireLanguageMode(int(mode))
-		self.Print(" SetEmpireLanguageMode : %d" % int(mode))
-
-	def SetCharacterRenderModeTypeAdd(self, color):
-		vid = player.GetTargetVID()
-		print " -> SetCharacterRenderModeTypeAdd", vid, color
-		chr.testSetAddRenderMode(vid, int(color,16))
-
-	def SetCharacterRenderModeTypeMod(self, color):
-		vid = player.GetTargetVID()
-		print " -> SetCharacterRenderModeTypeMod", vid, color, int(color,16)
-		chr.testSetModulateRenderMode(vid, int(color,16))
-
-	def SetCharacterRenderModeTypeAddRGB(self, r, g, b):
-		vid = player.GetTargetVID()
-		print " -> SetCharacterRenderModeTypeAddRGB", vid, r, g, b
-		chr.testSetAddRenderModeRGB(vid, float(r)/255.0, float(g)/255.0, float(b)/255.0)
-
-	def SetCharacterRenderModeTypeModRGB(self, r, g, b):
-		vid = player.GetTargetVID()
-		print " -> SetCharacterRenderModeTypeModRGB", vid, r, g, b
-		chr.testSetModulateRenderModeRGB(vid, float(r)/255.0, float(g)/255.0, float(b)/255.0)
-
-	def SetCharacterRenderModeSpecular(self, part, alpha):
-		vid = player.GetTargetVID()
-		print " -> SetCharacterRenderModeSpecular", vid, part, alpha
-		chr.testSetSpecularRenderMode(vid, int(part), float(alpha))
-
-	def RestoreCharacterRenderModeType(self):
-		vid = player.GetTargetVID()
-		chr.testRestoreRenderMode(vid)
-
-	def	ShowNameList(self, lstsName, lstsFilter=None):
-		if len(lstsName)==0:
-			self.Print("None")
-			return
-
-		if lstsFilter:
-			isFilter=1
-		else:
-			isFilter=0
-
-		sLine=""
-		iCol=0
-
-		iName=0
-		for sName in lstsName:
-			if isFilter:
-				iDotPos=sName.rfind('.', 0, -1)
-				if iDotPos<0:
-					iName=iName+1
-					continue
-
-				if (sName[iDotPos+1:] in lstsFilter)==0:
-					iName=iName+1
-					continue
-
-			sLine=sLine+"%3d %-15s " % (iName, sName)
-
-			if iCol>4:
-				iCol=0
-				self.Print(sLine)
-				sLine=""
-
-			iCol=iCol+1
-
-			iName=iName+1
-
-		if ""!=sLine:
-			self.Print(sLine)
-
-class ConsoleWindow(ui.Window):
-
-	BACK_GROUND_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 0.5)
-	EDIT_LINE_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 1.0)
-	BUTTON_COLOR = grp.GenerateColor(1.0, 1.0, 1.0, 1.0)
-	HEIGHT = 200
-	LINE_STEP = 15
-	MAX_LINE_COUNT = 50
-
-	class ConsoleEditLine(ui.EditLine):
-		def __init__(self):
-			ui.EditLine.__init__(self)
-			self.eventReturn = 0
-			self.eventEscape = 0
-		def __del__(self):
-			ui.EditLine.__del__(self)
-
-		def SetReturnEvent(self, event):
-			self.eventReturn = event
-
-		def SetEscapeEvent(self, event):
-			self.eventEscape = event
-
-		def OnIMEReturn(self):
-			text = self.GetText()
-
-			if len(text) > 0:
-				self.eventReturn(text)
-
-			else:
-				wndMgr.KillFocus()
-				self.eventEscape()
-
-			self.SetText("")
-			return True
-
-		def OnPressEscapeKey(self):
-			self.SetText("")
-			wndMgr.KillFocus()
-			self.eventEscape()
-			return True
-
-	class ResizingButton(ui.DragButton):
-
-		BUTTON_NORMAL_COLOR = grp.GenerateColor(0.3320, 0.2929, 0.2578, 1.0)
-		BUTTON_OVER_COLOR = grp.GenerateColor(0.5320, 0.4929, 0.4578, 1.0)
-		BUTTON_LIGHT_OUTLINE_COLOR = grp.GenerateColor(0.6666, 0.6509, 0.6313, 1.0)
-		BUTTON_DARK_OUTLINE_COLOR = grp.GenerateColor(0.1647, 0.1450, 0.1294, 1.0)
-
-		def __init__(self):
-			ui.DragButton.__init__(self)
-			self.AddFlag("limit")
-			self.AddFlag("restrict_x")
-
-		def __del__(self):
-			ui.DragButton.__del__(self)
-
-	def __init__(self):
-		ui.Window.__init__(self)
-
-		self.TextList = []
-		self.game = 0
-		self.Console = Console(self)
-
-		self.ResizingButton = self.ResizingButton()
-		self.ResizingButton.SetParent(self)
-		self.ResizingButton.SetSize(15, 15)
-		self.ResizingButton.SetPosition(100, 100)
-		self.ResizingButton.Show()
-
-		self.EditLine = self.ConsoleEditLine()
-		self.EditLine.SetParent(self)
-		self.EditLine.SetMax(100)
-		self.EditLine.SetFontName(localeInfo.UI_DEF_FONT)
-		self.EditLine.SetText("")
-		self.EditLine.Show()
-
-		from _weakref import ref
-
-		self.ResizingButton.SetMoveEvent(lambda s = ref(self): s().UpdatePosition())
-		self.EditLine.SetReturnEvent(lambda x,s = ref(self): s().ProcessCommand(x))
-		self.EditLine.SetEscapeEvent(lambda s = ref(self): s().CloseWindow())
-
-		self.UpdatePosition()
-
-		self.functionDict = {}
-		self.InitFunction()
-
-	def __del__(self):
-		ui.Window.__del__(self)
-
-	def BindGameClass(self, game):
-		self.Console.BindGameClass(game)
-
-	def Close(self):
-		self.Console.Close()
-		self.ResizingButton = 0
-		self.EditLine = 0
-
-	def SetConsoleSize(self, width, height):
-		self.ResizingButton.SetPosition(width-20, height-20)
-		self.UpdatePosition()
-
-	def OnRender(self):
-		grp.SetColor(self.BACK_GROUND_COLOR)
-		grp.RenderBar(self.gx, self.gy, self.width, self.height)
-
-		grp.SetColor(ConsoleWindow.EDIT_LINE_COLOR)
-		grp.RenderBar(self.gxEditLine-2, self.gyEditLine-3, self.width - 40, 17)
-
-		grp.SetColor(ConsoleWindow.BUTTON_COLOR)
-		grp.RenderBar(self.gxButton-2, self.gyButton-3, self.widthButton, self.heightButton)
-
-	def UpdatePosition(self):
-
-		self.width = self.GetWidth()
-		self.height = self.GetHeight()
-		self.widthButton = self.ResizingButton.GetWidth()
-		self.heightButton = self.ResizingButton.GetHeight()
-		(self.gx, self.gy) = self.GetGlobalPosition()
-		(self.gxButton, self.gyButton) = self.ResizingButton.GetGlobalPosition()
-
-		self.SetSize(self.gxButton - self.gx + 20, self.gyButton - self.gy + 20)
-
-		self.EditLine.SetSize(self.width-30, 16)
-		self.EditLine.SetPosition(7, self.height-20)
-		(self.gxEditLine, self.gyEditLine) = self.EditLine.GetGlobalPosition()
-
-		#####
-
-		yPosition = (self.height-20) - self.LINE_STEP
-		ItemCount = len(self.TextList)
-
-		for i in xrange(ItemCount):
-			TextLine = self.TextList[ItemCount-i-1]
-
-			TextLine.SetPosition(10, yPosition)
-			yPosition -= self.LINE_STEP
-
-			if yPosition < 0:
-				TextLine.Hide()
-			else:
-				TextLine.Show()
-
-	def OpenWindow(self):
-
-		self.EditLine.SetFocus()
-
-		self.Show()
-		self.Console.RefreshPath()
-
-	def CloseWindow(self):
-		self.Hide()
-
-	## NOTE : ÀÌ°÷¿¡¼­ Command¸¦ Ã³¸®ÇÕ´Ï´Ù - [levites]
-	def ProcessCommand(self, text):
-
-		if '/' == text[0]:
-			net.SendCommandPacket(text)
-			return
-
-		Console=self.Console
-		Console.Print(">> "+text)
-
-		lstsArg=text.split()
-		if len(lstsArg)==0:
-			return
-
-		sCmd=lstsArg[0]
-
-		if self.functionDict.has_key(sCmd):
-			try:
-				self.functionDict[sCmd](self.Console, *lstsArg[1:])
-			except Exception, e:
-				Console.Print(str(e))
-				#self.Console.Print(e)
-				#self.Console.Print(self.functionDict[sCmd].__doc__)
-		else:
-			if sCmd == 'help' or sCmd == 'h':
-				try:
-					k = lstsArg[1]
-					v = self.functionDict[k]
-					argcount = v.im_func.func_code.co_argcount - 1 # -1 for self
-					if v.im_func.func_code.co_flags & 4:
-						argcount+=1
-					argnames = v.im_func.func_code.co_varnames[1:argcount+1]
-					if argcount:
-						Console.Print("%s(%s) : %s" % (k,argcount, v.__doc__))
-						Console.Print("   arg : %s" % argnames)
-					else:
-						Console.Print("%s : %s" % (k,v.__doc__))
-				except:
-					for k,v in self.functionDict.iteritems():
-						argcount = v.im_func.func_code.co_argcount - 1 # -1 for self
-						if v.im_func.func_code.co_flags & 4:
-							argcount+=1
-						if argcount:
-							Console.Print("%s(%s) : %s" % (k,argcount, v.__doc__))
-						else:
-							Console.Print("%s : %s" % (k,v.__doc__))
-					Console.Print("? : All commands list")
-					Console.Print("h : Help for all commands")
-					Console.Print("h blah : Help for blah")
-
-				Console.Print("")
-			elif sCmd == '?':
-				list = self.functionDict.keys()
-				list.sort()
-				Console.ShowNameList(list)
-			pass
-
-	def InitFunction(self):
-		self.AddFunction("showui", Console.ShowUI)
-		self.AddFunction("hideui", Console.HideUI)
-		self.AddFunction("showcursor", Console.ShowCursor)
-		self.AddFunction("hidecursor", Console.HideCursor)
-		self.AddFunction("shadow", Console.SetShadowLevel)
-		self.AddFunction("splat", Console.SetSplatLimit)
-		self.AddFunction("setcspd", Console.SetCameraSpeed)
-		self.AddFunction("savecmr", Console.SaveCameraSetting)
-		self.AddFunction("loadcmr", Console.LoadCameraSetting)
-		self.AddFunction("setdefcmr", Console.SetDefaultCamera)
-		self.AddFunction("setrmadd", Console.SetCharacterRenderModeTypeAdd)
-		self.AddFunction("setrmmod", Console.SetCharacterRenderModeTypeMod)
-		self.AddFunction("setrmaddrgb", Console.SetCharacterRenderModeTypeAddRGB)
-		self.AddFunction("setrmmodrgb", Console.SetCharacterRenderModeTypeModRGB)
-		self.AddFunction("setspec", Console.SetCharacterRenderModeSpecular)
-		self.AddFunction("restorerm", Console.RestoreCharacterRenderModeType)
-		self.AddFunction("setcmrz", Console.SetcmrZ)
-
-		##self.AddFunction("setsight", Console.SetSight)
-		#self.AddFunction("help", Console.PrintHelp)
-		#self.AddFunction("?", Console.PrintHelp)
-		#self.AddFunction("distance", Console.SelectViewDistanceNum)
-		#self.AddFunction("exit", Console.Exit)
-		#self.AddFunction("mvol", Console.SetMusicVolume)
-		#self.AddFunction("svol", Console.SetSoundVolume)
-		#self.AddFunction("snds", Console.SetSoundScale)
-		#self.AddFunction("asnds", Console.SetAmbienceSoundScale)
-		#self.AddFunction("mspd", Console.SetMovingSpeed)
-		#self.AddFunction("pwd", Console.ShowPath)
-		#self.AddFunction("ls", Console.ShowList)
-		#self.AddFunction("bgloading", Console.SetBGLoading)
-		#self.AddFunction("terrainrender", Console.SetTerrainRenderSort)
-		self.AddFunction("transtree", Console.SetTransparentTree)
-		#self.AddFunction("stune", Console.SetStunEffect)
-		#self.AddFunction("duste", Console.SetDustEffect)
-		#self.AddFunction("dustt", Console.SetDustGap)
-		#self.AddFunction("hite", Console.SetHitEffect)
-		#self.AddFunction("cd", Console.MoveChildPath)
-		#self.AddFunction("up", Console.MoveParentPath)
-		#self.AddFunction("lsd", Console.ShowDirList)
-		#self.AddFunction("lsf", Console.ShowFileList)
-		#self.AddFunction("lse", Console.ShowEffectList)
-		self.AddFunction("show", Console.ShowBackgroundPart)
-		self.AddFunction("hide", Console.HideBackgroundPart)
-		#self.AddFunction("debuginfo", Console.ToggleDebugInfo)
-		self.AddFunction("collision", Console.SetCollision)
-		#self.AddFunction("colli", Console.SetCollision)
-		#self.AddFunction("wt", Console.SetWeaponTrace)
-		#self.AddFunction("wtt", Console.SetWeaponTraceTexture)
-		#self.AddFunction("wtm", Console.SetWeaponTraceMode)
-		#self.AddFunction("disconnect", Console.Disconnect)
-		#self.AddFunction("autorot", Console.SetAutoCameraRotationSpeed)
-		#self.AddFunction("dirline", Console.ToggleActorDirectionLine)
-		#self.AddFunction("pickc", Console.ShowPickedCharacterInfo)
-		#self.AddFunction("infoc", Console.ShowCharacterInfo)
-		#self.AddFunction("regchre", Console.RegisterCharacterEffect)
-		#self.AddFunction("setchra", Console.SetCharacterAffect)
-		#self.AddFunction("emoticon", Console.SetCharacterEmoticon)
-		#self.AddFunction("perfinfo", Console.ShowPerformanceInfo)
-		self.AddFunction("reload_locale", Console.ReloadLocale)
-		#self.AddFunction("re", Console.ReloadDevel)
-		self.AddFunction("perftime", Console.EnablePerformanceTime)
-		#self.AddFunction("cooltime", Console.SetCoolTime)
-		#self.AddFunction("levellimit", Console.SetLevelLimit)
-		self.AddFunction("warp", Console.WarpTest)
-		#self.AddFunction("web", Console.ShowWeb)
-		#self.AddFunction("showclock", Console.ShowClock)
-		#self.AddFunction("hideclock", Console.HideClock)
-		#self.AddFunction("setcombotype", Console.SetComboType)
-		#self.AddFunction("setsk_fake", Console.SetSkillGroupFake)
-		#self.AddFunction("trans", Console.SetEmpireLanguageMode)
-		#self.AddFunction("shownotice", Console.ShowNotice)
-		#self.AddFunction("hidenotice", Console.HideNotice)
-
-	def AddFunction(self, cmd, func):
-		self.functionDict[cmd] = func
-
-	def Print(self, text):
-		TextLine = ui.TextLine()
-		TextLine.SetParent(self)
-		TextLine.SetFontName(localeInfo.UI_DEF_FONT)
-		TextLine.Show()
-		TextLine.SetText(text)
-		self.TextList.append(TextLine)
-
-		count = len(self.TextList)
-		if count > self.MAX_LINE_COUNT:
-			for i in xrange(count - self.MAX_LINE_COUNT):
-				del self.TextList[0]
-
-		self.UpdatePosition()
\ No newline at end of file
+import app
+import grp
+import wndMgr
+import ui
+import os
+import sys
+import stat
+import chrmgr
+import chr
+import net
+import background
+import snd
+import net
+import player
+import localeInfo
+import uiScriptLocale
+
+class Console(object):
+	def __init__(self, output):
+		self.dirNameList = []
+		self.fileNameList = []
+
+		self.output = output
+		self.curPathName = "D:\\Ymir Work\\"
+		self.collision = 0
+
+		self.bgPartDict = {
+			"terrain" : background.PART_TERRAIN,
+			"object" : background.PART_OBJECT,
+			"cloud" : background.PART_CLOUD,
+			"tree" : background.PART_TREE,
+			"water" : background.PART_WATER,
+			"sky" : background.PART_SKY,
+		}
+
+		self.bgSortDict = {
+			"distance" : background.DISTANCE_SORT,
+			"texture" : background.TEXTURE_SORT,
+		}
+
+		self.game = 0
+
+	def Close(self):
+		self.output = 0
+
+	def BindGameClass(self, game):
+		self.game = game
+
+	def Exit(self):
+		#"Exit Program"
+		app.Exit()
+
+	def EnablePerformanceTime(self, mode, isEnable):
+		app.EnablePerformanceTime(mode, int(isEnable))
+
+	def ReloadLocale(self):
+		"Reload Locale"
+		reload(localeInfo)
+		reload(uiScriptLocale)
+		self.Print("RELOAD LOCALE")
+
+	def ReloadDevel(self):
+		"ReloadDevel"
+		import consoleModule
+		import uiGuild
+		import uiInventory
+		reload(uiGuild)
+		self.Print("ReloadGuild")
+		reload(uiInventory)
+		self.Print("ReloadInventory")
+
+	def ShowPerformanceInfo(self):
+		"Shows Performance Info"
+		pass
+		#self.Print(app.GetInfo(app.INFO_ACTOR))
+		#self.Print(app.GetInfo(app.INFO_ITEM))
+		#self.Print(app.GetInfo(app.INFO_EFFECT))
+		#self.Print(app.GetInfo(app.INFO_TEXTTAIL))
+
+	def Disconnect(self):
+		"Disconnect (unsafe debug packet removed)"
+		# net.SendStrangePacket() does not exist in your C++ net module and is unsafe by design.
+		# Keep as no-op to avoid latent crashes if consoleModule is accidentally present/loaded.
+		self.Print("Disconnect disabled (unsafe debug packet removed)")
+
+	def ToggleActorDirectionLine(self):
+		"Shows character's direction line"
+		pass
+		#chrmgr.ToggleDirectionLine()
+
+	def RegisterCharacterEffect(self, effectType, effectFileName):
+		"Set character's effect state (state number, bone name, effect filename/number)"
+		if effectFileName.isdigit():
+			effectFileName = self.GetFileName(int(effectFileName))
+
+		effectFullPathFileName = self.GetFullPathName(effectFileName)
+		chrmgr.RegisterEffect(chrmgr.EFFECT_STATE+int(effectType), "", effectFullPathFileName)
+		self.Print("effect state %d: %s" % (int(effectType), effectFullPathFileName))
+
+	def SetCharacterAffect(self, affectType, isVisible):
+		"Set character's affect (number, visiblity 1|0)"
+		pass
+		#chrmgr.SetAffect(-1, int(affectType), int(isVisible))
+		#self.Print("affect set %d: %d" % (int(affectType), int(isVisible)))
+
+	def SetCharacterEmoticon(self, EmoticonNum):
+		"Show emoticon (number)"
+		chrmgr.SetEmoticon(-1, int(EmoticonNum))
+		self.Print("Emoticon %d: %d" % (int(EmoticonNum), int(isVisible)))
+
+	def ShowPickedCharacterInfo(self):
+		"Show information of picked character"
+		vid=chrmgr.GetPickedVID()
+		info=chrmgr.GetVIDInfo(vid)
+		self.Print(info)
+
+	def ShowCharacterInfo(self, arg):
+		"Show information of character (vid)"
+		if arg.isdigit():
+			vid=int(arg)
+		else:
+			vid=0
+
+		info=chrmgr.GetVIDInfo(vid)
+		self.Print(info)
+
+	def SetWeaponTraceTexture(self, arg):
+		"Sets sword afterimage texture (filename)"
+		pass
+		#if arg.isdigit():
+			#textureFileName = self.GetFileName(int(arg))
+		#else:
+			#textureFileName = arg
+
+		#chr.WeaponTraceSetTexture(textureFileName)
+
+	def SetAutoCameraRotationSpeed(self, arg):
+		"Auto camera rotation speed (angle per sec)"
+		spd=float(arg)
+		player.SetAutoCameraRotationSpeed(spd)
+
+		self.Print("Auto camera rotation speed: %f" % (spd))
+
+	def SetWeaponTraceMode(self, *mode):
+		"Sword afterimage mode (0 = Use alpha, 1 = Use texture)"
+		pass
+		#if mode and mode[0].isdigit() and int(mode[0]):
+			#chr.WeaponTraceUseTexture()
+		#else:
+			#chr.WeaponTraceUseAlpha()
+
+	def SetCollision(self, *mode):
+		"Show collison objects (0 | 1)"
+		if mode and mode[0].isdigit():
+			self.collision = int(mode[0])
+		else:
+			self.collision = not self.collision
+
+	def SetMovingSpeed(self, arg):
+		"Set walking speed"
+		pass
+		#chrmgr.SetMovingSpeed(int(arg))
+
+	def SetMusicVolume(self, arg):
+		"Set BGM volumn (0 ~ 1.0)"
+		snd.SetMusicVolume(float(arg))
+
+	def SetSoundVolume(self, arg):
+		"Set Effect sound volumn (0 ~ 5)"
+		snd.SetSoundVolume(int(arg))
+
+	def SetSoundScale(self, arg):
+		"3D Sound scale (default : 200)"
+		snd.SetSoundScale(int(arg))
+
+	def SetAmbienceSoundScale(self, arg):
+		"3D Ambience sound scale (default : 200)"
+		snd.SetAmbienceSoundScale(int(arg))
+
+	def SetCoolTime(self):
+		"Cooltime toggle"
+		flag = player.ToggleCoolTime()
+		if flag:
+			self.Print("Cooltime will be applied")
+		else:
+			self.Print("Cooltime disabled")
+
+	def SetLevelLimit(self):
+		"Sets Level limit"
+		flag = player.ToggleLevelLimit()
+		if flag:
+			self.Print("Level limit will be applied")
+		else:
+			self.Print("Level limit disabled")
+
+	def ShowCursor(self):
+		app.ShowCursor()
+
+	def HideCursor(self):
+		app.HideCursor()
+
+	def Print(self, msg):
+		self.output.Print(msg)
+
+	def RefreshPath(self):
+		self.SetPath(self.curPathName)
+
+	def	SetPath(self, newPathName):
+		if '\\' != newPathName[-1]:
+			newPathName = newPathName + '\\'
+
+		if os.access(newPathName, os.R_OK) == 0:
+			self.Print(newPathName + " Cannot find path")
+			return
+
+		nameList = os.listdir(newPathName)
+
+		dirNameList = []
+		fileNameList = []
+		for sName in nameList:
+			mode = os.stat(newPathName + sName)[stat.ST_MODE]
+			if stat.S_ISDIR(mode):
+				dirNameList.append(sName)
+			else:
+				fileNameList.append(sName)
+
+		self.curPathName = newPathName
+		self.dirNameList = dirNameList
+		self.fileNameList = fileNameList
+
+		self.ShowPath()
+
+	def GetPath(self):
+		return self.curPathName
+
+	def GetDirName(self, iDir):
+		if (len(self.dirNameList) > iDir):
+			return self.dirNameList[iDir]
+		else:
+			print len(self.dirNameList)
+			return ""
+
+	def GetFileName(self, iFile):
+		if (len(self.fileNameList)>iFile):
+			return self.fileNameList[iFile]
+		else:
+			print len(self.fileNameList)
+			return ""
+
+	def	MoveParentPath(self):
+		"Go to Parent directory"
+		newPathName=self.GetPath()
+
+		lastPos=-1
+		if '\\'==newPathName[-1]:
+			lastPos=-2
+
+		lastPos=newPathName.rfind('\\', 0,	lastPos)
+		if 0>lastPos:
+			self.Print("Here is root")
+			return
+
+		newPathName=newPathName[0:lastPos]+'\\'
+
+		self.SetPath(newPathName)
+
+	def GetFullPathName(self, sPathName):
+		sParentPathName=self.GetPath()
+
+		if '\\'!=sParentPathName[-1]:
+			sParentPathName=sParentPathName+'\\'
+
+		return sParentPathName+sPathName
+
+	def	MoveChildPath(self, directory):
+		"[Directory name/number] change to child directory"
+		if ""==directory:
+			self.Print("You need directory name or number")
+			return
+
+		if directory.isdigit():
+			directory=self.GetDirName(int(directory))
+
+		newPathName=self.GetFullPathName(directory)
+
+		self.SetPath(newPathName)
+
+	def SetHitEffect(self, arg):
+		"Sets hit effect"
+		if arg.isdigit():
+			effectFileName = self.GetFileName(int(arg))
+		else:
+			effectFileName = arg
+
+		effectFullPathFileName=self.GetFullPathName(EffectFileName)
+		chrmgr.RegisterEffect(chrmgr.EFFECT_HIT, "", effectFullPathFileName)
+
+		self.Print("Hit effect: "+effectFullPathFileName)
+
+	def SetStunEffect(self, arg):
+		"Sets stun effect"
+		if arg.isdigit():
+			effectFileName = self.GetFileName(int(arg))
+		else:
+			effectFileName = arg
+
+		effectFullPathFileName = self.GetFullPathName(effectFileName)
+		chrmgr.RegisterEffect(chrmgr.EFFECT_STUN, "Bip01 Head", effectFullPathFileName)
+
+		self.Print("Stun effect: "+effectFullPathFileName)
+
+	def SetDustEffect(self, arg):
+		"Sets dirt effect"
+		if arg.isdigit():
+			effectFileName = self.GetFileName(int(arg))
+		else:
+			effectFileName = arg
+
+		effectFullPathFileName = self.GetFullPathName(effectFileName)
+		chrmgr.RegisterEffect(chrmgr.EFFECT_DUST, "", effectFullPathFileName)
+
+		self.Print("Dirt effect: "+effectFullPathFileName)
+
+	def SetDustGap(self, arg):
+		"Sets dirt effect gap"
+		if arg.isdigit() == 0:
+			self.Print("Dirt effect gap argument must be a number")
+		else:
+			gap = int(arg)
+			chrmgr.SetDustGap(gap)
+			self.Print("Dirt effect gap: %d" % (gap))
+
+	def ShowBackgroundPart(self, arg):
+		"Show background part"
+		try:
+			background.SetVisiblePart(self.bgPartDict[arg], 1);
+		except KeyError:
+			self.Print("Unknown part: ", arg);
+		except:
+			raise
+
+	def HideBackgroundPart(self, arg):
+		"Hide background part"
+		try:
+			background.SetVisiblePart(self.bgPartDict[arg], 0);
+		except KeyError:
+			self.Print("Unknown part: ", arg);
+		except:
+			raise
+
+	def SetShadowLevel(self, arg):
+		"Shadow level setting (0~5)"
+		if arg.isdigit() == 0:
+			self.Print("Shadow setting must be a number")
+		else:
+			level = int(arg)
+
+			if level < 0 or level > 5:
+				self.Print("Shadow level range is 0~5")
+			else:
+				background.SetShadowLevel(level)
+				self.Print("Shadow level: %d" % (level))
+
+	def SetSplatLimit(self, arg):
+		"Splat number limit"
+		if arg.isdigit() == 0:
+			self.Print("Splat number limit must be a number")
+		else:
+			limit = int(arg)
+
+			background.SetSplatLimit(limit)
+			self.Print("Splat number limit: %d" % (limit))
+
+	def SelectViewDistanceNum(self, arg):
+		"View distance (0~4)"
+		if arg.isdigit() == 0:
+			self.Print("Enter between 0 to 4")
+		else:
+			settingnum = int(arg)
+
+			if settingnum < 0 or settingnum > 4:
+				self.Print("View distance range is 0 to 4")
+
+			else:
+				background.SelectViewDistanceNum(settingnum)
+				self.Print("View distance: %d" % (settingnum))
+
+	def SetBGLoading(self, bBGLoading):
+		"Background loading (0, 1)"
+		pass
+		#bResultBoolean = int(bBGLoading)
+
+		#if bResultBoolean != 0 and bResultBoolean != 1:
+			#self.Print("Enter 0 or 1")
+		#else:
+			#background.SetBGLoading(bResultBoolean)
+			#self.Print("Background loading: %d" % (bResultBoolean))
+
+	def SetTerrainRenderSort(self, arg):
+		"Terrain rendering type"
+		pass
+		#try:
+			#background.SetRenderSort(self.bgSortDict[arg]);
+		#except KeyError:
+			#self.Print("Unknown part: ", arg);
+		#except:
+			#raise
+
+	def SetTransparentTree(self, arg):
+		"Tree's leaf transparency"
+		bTransparent = int(arg)
+		try:
+			background.SetTransparentTree(bTransparent);
+		except KeyError:
+			self.Print("must be 0 or 1: ", bTransparent);
+		except:
+			raise
+
+	def WarpTest(self, warpX, warpY):
+		"WarpTest : warp dwX dwY"
+		iWarpX = int(warpX)
+		iWarpY = int(warpY)
+		try:
+			background.Destroy()
+			background.Initialize()
+			background.WarpTest(iWarpX, iWarpY);
+			background.RegisterEnvironmentData(0, "d:/ymir work/environment/b3.msenv")
+			background.SetEnvironmentData(0)
+			background.SetShadowLevel(background.SHADOW_ALL)
+		except:
+			import exception
+			exception.Abort("consoleModule.Console.WarpTest")
+
+	def ToggleDebugInfo(self):
+		"Show DebugInfo"
+		pass
+		#net.ToggleGameDebugInfo()
+
+	def ShowPath(self):
+		"Show current path"
+		self.Print("Current path is "+self.GetPath())
+
+	def	ShowList(self):
+		"Show current path's list"
+		self.ShowDirList()
+		self.ShowFileList()
+
+	def	ShowDirList(self):
+		"Show current path's child directories"
+		self.Print(self.GetPath()+" directories:")
+		self.ShowNameList(self.dirNameList)
+		self.Print("")
+
+	def	ShowFileList(self, Filter=[]):
+		"Show current path's files (extension filter)"
+		self.Print(self.GetPath()+" files:")
+		self.ShowNameList(self.fileNameList, Filter)
+		self.Print("")
+
+	def	ShowEffectList(self):
+		"Show current path's effect"
+		self.Print(self.GetPath()+" effects:")
+		self.ShowNameList(self.fileNameList, ["mse"])
+		self.Print("")
+
+	def ShowWeb(self):
+		"ShowWeb"
+		pass
+		#if app.IsWebPageMode():
+			#app.HideWebPage()
+		#else:
+			#app.ShowWebPage("http://wiki.metin.co.kr/metin1help/01.htm", (0, 0, 320, 600))
+
+	def ShowUI(self):
+		"Shows UI"
+		self.game.CheckGameButton()
+		self.game.interface.ShowDefaultWindows()
+		self.game.interface.wndChat.Show()
+		self.game.interface.wndChat.show_btnChatSizing()
+
+	def HideUI(self):
+		"Hides UI"
+		self.game.interface.HideAllWindows()
+		self.game.interface.wndChat.Hide()
+
+	def SetCameraSpeed(self, percentage):
+		"Sets camera speed (Default = 100)"
+		app.SetCameraSpeed(int(percentage))
+
+	def SaveCameraSetting(self, filename):
+		"Save current camera attributes (filename)"
+		app.SaveCameraSetting(filename)
+
+	def LoadCameraSetting(self, filename):
+		"Load camera attributes (filename)"
+		if not app.LoadCameraSetting(filename):
+			self.Print("Could not load camera attribute")
+
+	def SetcmrZ(self, z):
+		app.SetcmrZ(float(z))
+
+	def SetDefaultCamera(self):
+		"Return to default camera attribute"
+		app.SetDefaultCamera()
+
+	def ShowClock(self, second):
+		self.game.ShowClock(int(second))
+
+	def HideClock(self):
+		self.game.HideClock()
+
+	def ShowNotice(self):
+		pass
+		#app.SetVisibleNotice(True)
+		#self.Print("Show Notice")
+
+	def HideNotice(self):
+		pass
+		#app.SetVisibleNotice(False)
+		#self.Print("Hide Notice")
+
+	def SetSight(self, range):
+		pass
+		#"Set Force Sight Range"
+		#app.SetSightRange(int(range))
+
+	def SetComboType(self, type):
+		pass
+		#chr.testSetComboType(int(type))
+
+	def SetSkillGroupFake(self, index):
+		"""×½Æ® Úµ"""
+		pass
+		#net.SetSkillGroupFake(int(index))
+		#self.Print(" SetSkillGroupFake : %d" % int(index))
+
+	def SetEmpireLanguageMode(self, mode):
+		net.SetEmpireLanguageMode(int(mode))
+		self.Print(" SetEmpireLanguageMode : %d" % int(mode))
+
+	def SetCharacterRenderModeTypeAdd(self, color):
+		vid = player.GetTargetVID()
+		print " -> SetCharacterRenderModeTypeAdd", vid, color
+		chr.testSetAddRenderMode(vid, int(color,16))
+
+	def SetCharacterRenderModeTypeMod(self, color):
+		vid = player.GetTargetVID()
+		print " -> SetCharacterRenderModeTypeMod", vid, color, int(color,16)
+		chr.testSetModulateRenderMode(vid, int(color,16))
+
+	def SetCharacterRenderModeTypeAddRGB(self, r, g, b):
+		vid = player.GetTargetVID()
+		print " -> SetCharacterRenderModeTypeAddRGB", vid, r, g, b
+		chr.testSetAddRenderModeRGB(vid, float(r)/255.0, float(g)/255.0, float(b)/255.0)
+
+	def SetCharacterRenderModeTypeModRGB(self, r, g, b):
+		vid = player.GetTargetVID()
+		print " -> SetCharacterRenderModeTypeModRGB", vid, r, g, b
+		chr.testSetModulateRenderModeRGB(vid, float(r)/255.0, float(g)/255.0, float(b)/255.0)
+
+	def SetCharacterRenderModeSpecular(self, part, alpha):
+		vid = player.GetTargetVID()
+		print " -> SetCharacterRenderModeSpecular", vid, part, alpha
+		chr.testSetSpecularRenderMode(vid, int(part), float(alpha))
+
+	def RestoreCharacterRenderModeType(self):
+		vid = player.GetTargetVID()
+		chr.testRestoreRenderMode(vid)
+
+	def	ShowNameList(self, lstsName, lstsFilter=None):
+		if len(lstsName)==0:
+			self.Print("None")
+			return
+
+		if lstsFilter:
+			isFilter=1
+		else:
+			isFilter=0
+
+		sLine=""
+		iCol=0
+
+		iName=0
+		for sName in lstsName:
+			if isFilter:
+				iDotPos=sName.rfind('.', 0, -1)
+				if iDotPos<0:
+					iName=iName+1
+					continue
+
+				if (sName[iDotPos+1:] in lstsFilter)==0:
+					iName=iName+1
+					continue
+
+			sLine=sLine+"%3d %-15s " % (iName, sName)
+
+			if iCol>4:
+				iCol=0
+				self.Print(sLine)
+				sLine=""
+
+			iCol=iCol+1
+
+			iName=iName+1
+
+		if ""!=sLine:
+			self.Print(sLine)
+
+class ConsoleWindow(ui.Window):
+
+	BACK_GROUND_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 0.5)
+	EDIT_LINE_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 1.0)
+	BUTTON_COLOR = grp.GenerateColor(1.0, 1.0, 1.0, 1.0)
+	HEIGHT = 200
+	LINE_STEP = 15
+	MAX_LINE_COUNT = 50
+
+	class ConsoleEditLine(ui.EditLine):
+		def __init__(self):
+			ui.EditLine.__init__(self)
+			self.eventReturn = 0
+			self.eventEscape = 0
+		def __del__(self):
+			ui.EditLine.__del__(self)
+
+		def SetReturnEvent(self, event):
+			self.eventReturn = event
+
+		def SetEscapeEvent(self, event):
+			self.eventEscape = event
+
+		def OnIMEReturn(self):
+			text = self.GetText()
+
+			if len(text) > 0:
+				self.eventReturn(text)
+
+			else:
+				wndMgr.KillFocus()
+				self.eventEscape()
+
+			self.SetText("")
+			return True
+
+		def OnPressEscapeKey(self):
+			self.SetText("")
+			wndMgr.KillFocus()
+			self.eventEscape()
+			return True
+
+	class ResizingButton(ui.DragButton):
+
+		BUTTON_NORMAL_COLOR = grp.GenerateColor(0.3320, 0.2929, 0.2578, 1.0)
+		BUTTON_OVER_COLOR = grp.GenerateColor(0.5320, 0.4929, 0.4578, 1.0)
+		BUTTON_LIGHT_OUTLINE_COLOR = grp.GenerateColor(0.6666, 0.6509, 0.6313, 1.0)
+		BUTTON_DARK_OUTLINE_COLOR = grp.GenerateColor(0.1647, 0.1450, 0.1294, 1.0)
+
+		def __init__(self):
+			ui.DragButton.__init__(self)
+			self.AddFlag("limit")
+			self.AddFlag("restrict_x")
+
+		def __del__(self):
+			ui.DragButton.__del__(self)
+
+	def __init__(self):
+		ui.Window.__init__(self)
+
+		self.TextList = []
+		self.game = 0
+		self.Console = Console(self)
+
+		self.ResizingButton = self.ResizingButton()
+		self.ResizingButton.SetParent(self)
+		self.ResizingButton.SetSize(15, 15)
+		self.ResizingButton.SetPosition(100, 100)
+		self.ResizingButton.Show()
+
+		self.EditLine = self.ConsoleEditLine()
+		self.EditLine.SetParent(self)
+		self.EditLine.SetMax(100)
+		self.EditLine.SetFontName(localeInfo.UI_DEF_FONT)
+		self.EditLine.SetText("")
+		self.EditLine.Show()
+
+		from _weakref import ref
+
+		self.ResizingButton.SetMoveEvent(lambda s = ref(self): s().UpdatePosition())
+		self.EditLine.SetReturnEvent(lambda x,s = ref(self): s().ProcessCommand(x))
+		self.EditLine.SetEscapeEvent(lambda s = ref(self): s().CloseWindow())
+
+		self.UpdatePosition()
+
+		self.functionDict = {}
+		self.InitFunction()
+
+	def __del__(self):
+		ui.Window.__del__(self)
+
+	def BindGameClass(self, game):
+		self.Console.BindGameClass(game)
+
+	def Close(self):
+		self.Console.Close()
+		self.ResizingButton = 0
+		self.EditLine = 0
+
+	def SetConsoleSize(self, width, height):
+		self.ResizingButton.SetPosition(width-20, height-20)
+		self.UpdatePosition()
+
+	def OnRender(self):
+		grp.SetColor(self.BACK_GROUND_COLOR)
+		grp.RenderBar(self.gx, self.gy, self.width, self.height)
+
+		grp.SetColor(ConsoleWindow.EDIT_LINE_COLOR)
+		grp.RenderBar(self.gxEditLine-2, self.gyEditLine-3, self.width - 40, 17)
+
+		grp.SetColor(ConsoleWindow.BUTTON_COLOR)
+		grp.RenderBar(self.gxButton-2, self.gyButton-3, self.widthButton, self.heightButton)
+
+	def UpdatePosition(self):
+
+		self.width = self.GetWidth()
+		self.height = self.GetHeight()
+		self.widthButton = self.ResizingButton.GetWidth()
+		self.heightButton = self.ResizingButton.GetHeight()
+		(self.gx, self.gy) = self.GetGlobalPosition()
+		(self.gxButton, self.gyButton) = self.ResizingButton.GetGlobalPosition()
+
+		self.SetSize(self.gxButton - self.gx + 20, self.gyButton - self.gy + 20)
+
+		self.EditLine.SetSize(self.width-30, 16)
+		self.EditLine.SetPosition(7, self.height-20)
+		(self.gxEditLine, self.gyEditLine) = self.EditLine.GetGlobalPosition()
+
+		#####
+
+		yPosition = (self.height-20) - self.LINE_STEP
+		ItemCount = len(self.TextList)
+
+		for i in xrange(ItemCount):
+			TextLine = self.TextList[ItemCount-i-1]
+
+			TextLine.SetPosition(10, yPosition)
+			yPosition -= self.LINE_STEP
+
+			if yPosition < 0:
+				TextLine.Hide()
+			else:
+				TextLine.Show()
+
+	def OpenWindow(self):
+
+		self.EditLine.SetFocus()
+
+		self.Show()
+		self.Console.RefreshPath()
+
+	def CloseWindow(self):
+		self.Hide()
+
+	## NOTE : Ì° Command Ã³Õ´Ï´ - [levites]
+	def ProcessCommand(self, text):
+
+		if '/' == text[0]:
+			net.SendCommandPacket(text)
+			return
+
+		Console=self.Console
+		Console.Print(">> "+text)
+
+		lstsArg=text.split()
+		if len(lstsArg)==0:
+			return
+
+		sCmd=lstsArg[0]
+
+		if self.functionDict.has_key(sCmd):
+			try:
+				self.functionDict[sCmd](self.Console, *lstsArg[1:])
+			except Exception, e:
+				Console.Print(str(e))
+				#self.Console.Print(e)
+				#self.Console.Print(self.functionDict[sCmd].__doc__)
+		else:
+			if sCmd == 'help' or sCmd == 'h':
+				try:
+					k = lstsArg[1]
+					v = self.functionDict[k]
+					argcount = v.im_func.func_code.co_argcount - 1 # -1 for self
+					if v.im_func.func_code.co_flags & 4:
+						argcount+=1
+					argnames = v.im_func.func_code.co_varnames[1:argcount+1]
+					if argcount:
+						Console.Print("%s(%s) : %s" % (k,argcount, v.__doc__))
+						Console.Print("   arg : %s" % argnames)
+					else:
+						Console.Print("%s : %s" % (k,v.__doc__))
+				except:
+					for k,v in self.functionDict.iteritems():
+						argcount = v.im_func.func_code.co_argcount - 1 # -1 for self
+						if v.im_func.func_code.co_flags & 4:
+							argcount+=1
+						if argcount:
+							Console.Print("%s(%s) : %s" % (k,argcount, v.__doc__))
+						else:
+							Console.Print("%s : %s" % (k,v.__doc__))
+					Console.Print("? : All commands list")
+					Console.Print("h : Help for all commands")
+					Console.Print("h blah : Help for blah")
+
+				Console.Print("")
+			elif sCmd == '?':
+				list = self.functionDict.keys()
+				list.sort()
+				Console.ShowNameList(list)
+			pass
+
+	def InitFunction(self):
+		self.AddFunction("showui", Console.ShowUI)
+		self.AddFunction("hideui", Console.HideUI)
+		self.AddFunction("showcursor", Console.ShowCursor)
+		self.AddFunction("hidecursor", Console.HideCursor)
+		self.AddFunction("shadow", Console.SetShadowLevel)
+		self.AddFunction("splat", Console.SetSplatLimit)
+		self.AddFunction("setcspd", Console.SetCameraSpeed)
+		self.AddFunction("savecmr", Console.SaveCameraSetting)
+		self.AddFunction("loadcmr", Console.LoadCameraSetting)
+		self.AddFunction("setdefcmr", Console.SetDefaultCamera)
+		self.AddFunction("setrmadd", Console.SetCharacterRenderModeTypeAdd)
+		self.AddFunction("setrmmod", Console.SetCharacterRenderModeTypeMod)
+		self.AddFunction("setrmaddrgb", Console.SetCharacterRenderModeTypeAddRGB)
+		self.AddFunction("setrmmodrgb", Console.SetCharacterRenderModeTypeModRGB)
+		self.AddFunction("setspec", Console.SetCharacterRenderModeSpecular)
+		self.AddFunction("restorerm", Console.RestoreCharacterRenderModeType)
+		self.AddFunction("setcmrz", Console.SetcmrZ)
+
+		##self.AddFunction("setsight", Console.SetSight)
+		#self.AddFunction("help", Console.PrintHelp)
+		#self.AddFunction("?", Console.PrintHelp)
+		#self.AddFunction("distance", Console.SelectViewDistanceNum)
+		#self.AddFunction("exit", Console.Exit)
+		#self.AddFunction("mvol", Console.SetMusicVolume)
+		#self.AddFunction("svol", Console.SetSoundVolume)
+		#self.AddFunction("snds", Console.SetSoundScale)
+		#self.AddFunction("asnds", Console.SetAmbienceSoundScale)
+		#self.AddFunction("mspd", Console.SetMovingSpeed)
+		#self.AddFunction("pwd", Console.ShowPath)
+		#self.AddFunction("ls", Console.ShowList)
+		#self.AddFunction("bgloading", Console.SetBGLoading)
+		#self.AddFunction("terrainrender", Console.SetTerrainRenderSort)
+		self.AddFunction("transtree", Console.SetTransparentTree)
+		#self.AddFunction("stune", Console.SetStunEffect)
+		#self.AddFunction("duste", Console.SetDustEffect)
+		#self.AddFunction("dustt", Console.SetDustGap)
+		#self.AddFunction("hite", Console.SetHitEffect)
+		#self.AddFunction("cd", Console.MoveChildPath)
+		#self.AddFunction("up", Console.MoveParentPath)
+		#self.AddFunction("lsd", Console.ShowDirList)
+		#self.AddFunction("lsf", Console.ShowFileList)
+		#self.AddFunction("lse", Console.ShowEffectList)
+		self.AddFunction("show", Console.ShowBackgroundPart)
+		self.AddFunction("hide", Console.HideBackgroundPart)
+		#self.AddFunction("debuginfo", Console.ToggleDebugInfo)
+		self.AddFunction("collision", Console.SetCollision)
+		#self.AddFunction("colli", Console.SetCollision)
+		#self.AddFunction("wt", Console.SetWeaponTrace)
+		#self.AddFunction("wtt", Console.SetWeaponTraceTexture)
+		#self.AddFunction("wtm", Console.SetWeaponTraceMode)
+		#self.AddFunction("disconnect", Console.Disconnect)
+		#self.AddFunction("autorot", Console.SetAutoCameraRotationSpeed)
+		#self.AddFunction("dirline", Console.ToggleActorDirectionLine)
+		#self.AddFunction("pickc", Console.ShowPickedCharacterInfo)
+		#self.AddFunction("infoc", Console.ShowCharacterInfo)
+		#self.AddFunction("regchre", Console.RegisterCharacterEffect)
+		#self.AddFunction("setchra", Console.SetCharacterAffect)
+		#self.AddFunction("emoticon", Console.SetCharacterEmoticon)
+		#self.AddFunction("perfinfo", Console.ShowPerformanceInfo)
+		self.AddFunction("reload_locale", Console.ReloadLocale)
+		#self.AddFunction("re", Console.ReloadDevel)
+		self.AddFunction("perftime", Console.EnablePerformanceTime)
+		#self.AddFunction("cooltime", Console.SetCoolTime)
+		#self.AddFunction("levellimit", Console.SetLevelLimit)
+		self.AddFunction("warp", Console.WarpTest)
+		#self.AddFunction("web", Console.ShowWeb)
+		#self.AddFunction("showclock", Console.ShowClock)
+		#self.AddFunction("hideclock", Console.HideClock)
+		#self.AddFunction("setcombotype", Console.SetComboType)
+		#self.AddFunction("setsk_fake", Console.SetSkillGroupFake)
+		#self.AddFunction("trans", Console.SetEmpireLanguageMode)
+		#self.AddFunction("shownotice", Console.ShowNotice)
+		#self.AddFunction("hidenotice", Console.HideNotice)
+
+	def AddFunction(self, cmd, func):
+		self.functionDict[cmd] = func
+
+	def Print(self, text):
+		TextLine = ui.TextLine()
+		TextLine.SetParent(self)
+		TextLine.SetFontName(localeInfo.UI_DEF_FONT)
+		TextLine.Show()
+		TextLine.SetText(text)
+		self.TextList.append(TextLine)
+
+		count = len(self.TextList)
+		if count > self.MAX_LINE_COUNT:
+			for i in xrange(count - self.MAX_LINE_COUNT):
+				del self.TextList[0]
+
+		self.UpdatePosition()
diff --git a/client/pack/root/constinfo.py b/client/pack/root/constinfo.py
index fb89a48..dd54105 100644
--- a/client/pack/root/constinfo.py
+++ b/client/pack/root/constinfo.py
@@ -1,279 +1,272 @@
-import app
-
-# option
-IN_GAME_SHOP_ENABLE = 1
-CONSOLE_ENABLE = 0
-
-PVPMODE_ENABLE = 1
-#PVPMODE_TEST_ENABLE = 0
-PVPMODE_ACCELKEY_ENABLE = 1
-PVPMODE_ACCELKEY_DELAY = 0.5
-PVPMODE_PROTECTED_LEVEL = 30
-
-FOG_LEVEL0 = 4800.0
-FOG_LEVEL1 = 9600.0
-FOG_LEVEL2 = 12800.0
-FOG_LEVEL = FOG_LEVEL0
-FOG_LEVEL_LIST = [FOG_LEVEL0, FOG_LEVEL1, FOG_LEVEL2]
-
-import systemSetting
-CAMERA_MAX_DISTANCE_SHORT = 2500.0
-CAMERA_MAX_DISTANCE_LONG = 3500.0 * 2
-CAMERA_MAX_DISTANCE_LIST = [CAMERA_MAX_DISTANCE_SHORT, CAMERA_MAX_DISTANCE_LONG]
-CAMERA_MAX_DISTANCE = CAMERA_MAX_DISTANCE_LIST[systemSetting.GetCameraMode()]
-
-GOLD_MAX = 2000000000
-CHEQUE_MAX = 999
-
-CHRNAME_COLOR_INDEX = 0
-
-ENVIRONMENT_NIGHT="d:/ymir work/environment/moonlight04.msenv"
-
-# constant
-HIGH_PRICE = 500000
-MIDDLE_PRICE = 50000
-ERROR_METIN_STONE = 28960
-SUB2_LOADING_ENABLE = 1
-EXPANDED_COMBO_ENABLE = 1
-CONVERT_EMPIRE_LANGUAGE_ENABLE = 1
-USE_ITEM_WEAPON_TABLE_ATTACK_BONUS = 0
-ADD_DEF_BONUS_ENABLE = 1
-LOGIN_COUNT_LIMIT_ENABLE = 0
-
-USE_SKILL_EFFECT_UPGRADE_ENABLE = 1
-
-VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD = 1
-GUILD_MONEY_PER_GSP = 100
-GUILD_WAR_TYPE_SELECT_ENABLE = 1
-TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE = 0
-
-HAIR_COLOR_ENABLE = 1
-ARMOR_SPECULAR_ENABLE = 1
-WEAPON_SPECULAR_ENABLE = 1
-SEQUENCE_PACKET_ENABLE = 1
-KEEP_ACCOUNT_CONNETION_ENABLE = 1
-MINIMAP_POSITIONINFO_ENABLE = 0
-CONVERT_EMPIRE_LANGUAGE_ENABLE = 0
-USE_ITEM_WEAPON_TABLE_ATTACK_BONUS = 0
-ADD_DEF_BONUS_ENABLE = 0
-LOGIN_COUNT_LIMIT_ENABLE = 0
-PVPMODE_PROTECTED_LEVEL = 15
-TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE = 10
-
-isItemQuestionDialog = 0
-
-if app.ENABLE_REFINE_RENEWAL:
-	IS_AUTO_REFINE = False
-	AUTO_REFINE_TYPE = 0
-	AUTO_REFINE_DATA = {
-		"ITEM" : [-1, -1],
-		"NPC" : [0, -1, -1, 0]
-	}
-
-def GET_ITEM_QUESTION_DIALOG_STATUS():
-	global isItemQuestionDialog
-	return isItemQuestionDialog
-
-def SET_ITEM_QUESTION_DIALOG_STATUS(flag):
-	global isItemQuestionDialog
-	isItemQuestionDialog = flag
-
-import app
-import net
-
-########################
-
-def SET_DEFAULT_FOG_LEVEL():
-	global FOG_LEVEL
-	app.SetMinFog(FOG_LEVEL)
-
-def SET_FOG_LEVEL_INDEX(index):
-	global FOG_LEVEL
-	global FOG_LEVEL_LIST
-	try:
-		FOG_LEVEL=FOG_LEVEL_LIST[index]
-	except IndexError:
-		FOG_LEVEL=FOG_LEVEL_LIST[0]
-	app.SetMinFog(FOG_LEVEL)
-
-def GET_FOG_LEVEL_INDEX():
-	global FOG_LEVEL
-	global FOG_LEVEL_LIST
-	return FOG_LEVEL_LIST.index(FOG_LEVEL)
-
-########################
-
-def SET_DEFAULT_CAMERA_MAX_DISTANCE():
-	global CAMERA_MAX_DISTANCE
-	app.SetCameraMaxDistance(CAMERA_MAX_DISTANCE)
-
-def SET_CAMERA_MAX_DISTANCE_INDEX(index):
-	global CAMERA_MAX_DISTANCE
-	global CAMERA_MAX_DISTANCE_LIST
-	try:
-		CAMERA_MAX_DISTANCE=CAMERA_MAX_DISTANCE_LIST[index]
-	except:
-		CAMERA_MAX_DISTANCE=CAMERA_MAX_DISTANCE_LIST[0]
-
-	app.SetCameraMaxDistance(CAMERA_MAX_DISTANCE)
-
-def GET_CAMERA_MAX_DISTANCE_INDEX():
-	global CAMERA_MAX_DISTANCE
-	global CAMERA_MAX_DISTANCE_LIST
-	return CAMERA_MAX_DISTANCE_LIST.index(CAMERA_MAX_DISTANCE)
-
-########################
-
-import chrmgr
-import player
-import app
-
-def SET_DEFAULT_CHRNAME_COLOR():
-	global CHRNAME_COLOR_INDEX
-	chrmgr.SetEmpireNameMode(CHRNAME_COLOR_INDEX)
-
-def SET_CHRNAME_COLOR_INDEX(index):
-	global CHRNAME_COLOR_INDEX
-	CHRNAME_COLOR_INDEX=index
-	chrmgr.SetEmpireNameMode(index)
-
-def GET_CHRNAME_COLOR_INDEX():
-	global CHRNAME_COLOR_INDEX
-	return CHRNAME_COLOR_INDEX
-
-def SET_VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD(index):
-	global VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD
-	VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD = index
-
-def GET_VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD():
-	global VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD
-	return VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD
-
-def SET_DEFAULT_CONVERT_EMPIRE_LANGUAGE_ENABLE():
-	global CONVERT_EMPIRE_LANGUAGE_ENABLE
-	net.SetEmpireLanguageMode(CONVERT_EMPIRE_LANGUAGE_ENABLE)
-
-def SET_DEFAULT_USE_ITEM_WEAPON_TABLE_ATTACK_BONUS():
-	global USE_ITEM_WEAPON_TABLE_ATTACK_BONUS
-	player.SetWeaponAttackBonusFlag(USE_ITEM_WEAPON_TABLE_ATTACK_BONUS)
-
-def SET_DEFAULT_USE_SKILL_EFFECT_ENABLE():
-	global USE_SKILL_EFFECT_UPGRADE_ENABLE
-	app.SetSkillEffectUpgradeEnable(USE_SKILL_EFFECT_UPGRADE_ENABLE)
-
-def SET_TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE():
-	global TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE
-	app.SetTwoHandedWeaponAttSpeedDecreaseValue(TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE)
-
-########################
-import item
-
-ACCESSORY_MATERIAL_LIST = [50623, 50624, 50625, 50626, 50627, 50628, 50629, 50630, 50631, 50632, 50633, 50634, 50635, 50636, 50637, 50638, 50639]
-if app.ENABLE_CONQUEROR_LEVEL:
-	ACCESSORY_MATERIAL_LIST += [50661, 50662, 50663, 50664]
-
-JewelAccessoryInfos = [
-		# jewel wrist neck ear
-		[ 50634, 14420, 16220, 17220 ],
-		[ 50635, 14500, 16500, 17500 ],
-		[ 50636, 14520, 16520, 17520 ],
-		[ 50637, 14540, 16540, 17540 ],
-		[ 50638, 14560, 16560, 17560 ],
-		[ 50639, 14570, 16570, 0 ], # ¿À±¤±Í°ÉÀÌ´Â ¾øÀ½(±Í°ÉÀÌ´Â ¼öÀÎ°ü·Ã)
-	]
-
-if app.ENABLE_CONQUEROR_LEVEL:
-	JewelAccessoryInfos += [
-		# jewel wrist neck ear
-		[ 50661, 14590, 16590, 17580 ],
-		[ 50662, 14600, 16600, 17590 ],
-		[ 50663, 14610, 16610, 17600 ],
-		[ 50664, 14580, 16580, 17570 ],
-	]
-
-def GET_ACCESSORY_MATERIAL_VNUM(vnum, subType):
-	ret = vnum
-	item_base = (vnum / 10) * 10
-	for info in JewelAccessoryInfos:
-		if item.ARMOR_WRIST == subType:
-			if info[1] == item_base:
-				return info[0]
-		elif item.ARMOR_NECK == subType:
-			if info[2] == item_base:
-				return info[0]
-		elif item.ARMOR_EAR == subType:
-			if info[3] == item_base:
-				return info[0]
-
-	if vnum >= 16210 and vnum <= 16219:
-		return 50625
-
-	if item.ARMOR_WRIST == subType:
-		WRIST_ITEM_VNUM_BASE = 14000
-		ret -= WRIST_ITEM_VNUM_BASE
-	elif item.ARMOR_NECK == subType:
-		NECK_ITEM_VNUM_BASE = 16000
-		ret -= NECK_ITEM_VNUM_BASE
-	elif item.ARMOR_EAR == subType:
-		EAR_ITEM_VNUM_BASE = 17000
-		ret -= EAR_ITEM_VNUM_BASE
-
-	type = ret/20
-
-	if type < 0 or type >= len(ACCESSORY_MATERIAL_LIST):
-		type = (ret - 170) / 20
-		if type < 0 or type >= len(ACCESSORY_MATERIAL_LIST):
-			return 0
-
-	return ACCESSORY_MATERIAL_LIST[type]
-
-##################################################################
-## »õ·Î Ãß°¡µÈ 'º§Æ®' ¾ÆÀÌÅÛ Å¸ÀÔ°ú, º§Æ®ÀÇ ¼ÒÄÏ¿¡ ²ÈÀ» ¾ÆÀÌÅÛ °ü·Ã.. 
-## º§Æ®ÀÇ ¼ÒÄÏ½Ã½ºÅÛÀº ¾Ç¼¼¼­¸®¿Í µ¿ÀÏÇÏ±â ¶§¹®¿¡, À§ ¾Ç¼¼¼­¸® °ü·Ã ÇÏµåÄÚµùÃ³·³ ÀÌ·±½ÄÀ¸·Î ÇÒ ¼ö¹Û¿¡ ¾ø´Ù..
-
-def GET_BELT_MATERIAL_VNUM(vnum, subType = 0):
-	# ÇöÀç´Â ¸ðµç º§Æ®¿¡´Â ÇÏ³ªÀÇ ¾ÆÀÌÅÛ(#18900)¸¸ »ðÀÔ °¡´É
-	return 18900
-
-##################################################################
-## ÀÚµ¿¹°¾à (HP: #72723 ~ #72726, SP: #72727 ~ #72730)
-
-# ÇØ´ç vnumÀÌ ÀÚµ¿¹°¾àÀÎ°¡?
-def IS_AUTO_POTION(itemVnum):
-	return IS_AUTO_POTION_HP(itemVnum) or IS_AUTO_POTION_SP(itemVnum)
-
-# ÇØ´ç vnumÀÌ HP ÀÚµ¿¹°¾àÀÎ°¡?
-def IS_AUTO_POTION_HP(itemVnum):
-	if 72723 <= itemVnum and 72726 >= itemVnum:
-		return 1
-	elif itemVnum >= 76021 and itemVnum <= 76022: ## »õ·Î µé¾î°£ ¼±¹°¿ë È­·æÀÇ Ãàº¹
-		return 1
-	elif itemVnum == 79012:
-		return 1
-
-	return 0
-
-# ÇØ´ç vnumÀÌ SP ÀÚµ¿¹°¾àÀÎ°¡?
-def IS_AUTO_POTION_SP(itemVnum):
-	if 72727 <= itemVnum and 72730 >= itemVnum:
-		return 1
-	elif itemVnum >= 76004 and itemVnum <= 76005: ## »õ·Î µé¾î°£ ¼±¹°¿ë ¼ö·æÀÇ Ãàº¹
-		return 1
-	elif itemVnum == 79013:
-		return 1
-
-	return 0
-
-if app.ENABLE_GROWTH_PET_SYSTEM:
-	def IS_PET_ITEM(itemVnum):
-		if itemVnum == 0:
-			return 0
-			
-		item.SelectItem(itemVnum)
-		itemType = item.GetItemType()
-		itemSubType = item.GetItemSubType()
-		
-		if itemType == item.ITEM_TYPE_PET and itemSubType == item.PET_UPBRINGING:
-			return 1
-			
-		return 0
+import app
+
+# option
+IN_GAME_SHOP_ENABLE = 1
+CONSOLE_ENABLE = 0
+
+PVPMODE_ENABLE = 1
+#PVPMODE_TEST_ENABLE = 0
+PVPMODE_ACCELKEY_ENABLE = 1
+PVPMODE_ACCELKEY_DELAY = 0.5
+PVPMODE_PROTECTED_LEVEL = 15
+
+FOG_LEVEL0 = 4800.0
+FOG_LEVEL1 = 9600.0
+FOG_LEVEL2 = 12800.0
+FOG_LEVEL = FOG_LEVEL0
+FOG_LEVEL_LIST = [FOG_LEVEL0, FOG_LEVEL1, FOG_LEVEL2]
+
+import systemSetting
+CAMERA_MAX_DISTANCE_SHORT = 2500.0
+CAMERA_MAX_DISTANCE_LONG = 3500.0 * 2
+CAMERA_MAX_DISTANCE_LIST = [CAMERA_MAX_DISTANCE_SHORT, CAMERA_MAX_DISTANCE_LONG]
+CAMERA_MAX_DISTANCE = CAMERA_MAX_DISTANCE_LIST[systemSetting.GetCameraMode()]
+
+GOLD_MAX = 2000000000
+CHEQUE_MAX = 999
+
+CHRNAME_COLOR_INDEX = 0
+
+ENVIRONMENT_NIGHT="d:/ymir work/environment/moonlight04.msenv"
+
+# constant
+HIGH_PRICE = 500000
+MIDDLE_PRICE = 50000
+ERROR_METIN_STONE = 28960
+SUB2_LOADING_ENABLE = 1
+EXPANDED_COMBO_ENABLE = 1
+CONVERT_EMPIRE_LANGUAGE_ENABLE = 0
+USE_ITEM_WEAPON_TABLE_ATTACK_BONUS = 0
+ADD_DEF_BONUS_ENABLE = 0
+LOGIN_COUNT_LIMIT_ENABLE = 0
+
+USE_SKILL_EFFECT_UPGRADE_ENABLE = 1
+
+VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD = 1
+GUILD_MONEY_PER_GSP = 100
+GUILD_WAR_TYPE_SELECT_ENABLE = 1
+TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE = 10
+
+HAIR_COLOR_ENABLE = 1
+ARMOR_SPECULAR_ENABLE = 1
+WEAPON_SPECULAR_ENABLE = 1
+SEQUENCE_PACKET_ENABLE = 1
+KEEP_ACCOUNT_CONNETION_ENABLE = 1
+MINIMAP_POSITIONINFO_ENABLE = 0
+
+isItemQuestionDialog = 0
+
+if app.ENABLE_REFINE_RENEWAL:
+	IS_AUTO_REFINE = False
+	AUTO_REFINE_TYPE = 0
+	AUTO_REFINE_DATA = {
+		"ITEM" : [-1, -1],
+		"NPC" : [0, -1, -1, 0]
+	}
+
+def GET_ITEM_QUESTION_DIALOG_STATUS():
+	global isItemQuestionDialog
+	return isItemQuestionDialog
+
+def SET_ITEM_QUESTION_DIALOG_STATUS(flag):
+	global isItemQuestionDialog
+	isItemQuestionDialog = flag
+
+import net
+
+########################
+
+def SET_DEFAULT_FOG_LEVEL():
+	global FOG_LEVEL
+	app.SetMinFog(FOG_LEVEL)
+
+def SET_FOG_LEVEL_INDEX(index):
+	global FOG_LEVEL
+	global FOG_LEVEL_LIST
+	try:
+		FOG_LEVEL=FOG_LEVEL_LIST[index]
+	except IndexError:
+		FOG_LEVEL=FOG_LEVEL_LIST[0]
+	app.SetMinFog(FOG_LEVEL)
+
+def GET_FOG_LEVEL_INDEX():
+	global FOG_LEVEL
+	global FOG_LEVEL_LIST
+	return FOG_LEVEL_LIST.index(FOG_LEVEL)
+
+########################
+
+def SET_DEFAULT_CAMERA_MAX_DISTANCE():
+	global CAMERA_MAX_DISTANCE
+	app.SetCameraMaxDistance(CAMERA_MAX_DISTANCE)
+
+def SET_CAMERA_MAX_DISTANCE_INDEX(index):
+	global CAMERA_MAX_DISTANCE
+	global CAMERA_MAX_DISTANCE_LIST
+	try:
+		CAMERA_MAX_DISTANCE=CAMERA_MAX_DISTANCE_LIST[index]
+	except:
+		CAMERA_MAX_DISTANCE=CAMERA_MAX_DISTANCE_LIST[0]
+
+	app.SetCameraMaxDistance(CAMERA_MAX_DISTANCE)
+
+def GET_CAMERA_MAX_DISTANCE_INDEX():
+	global CAMERA_MAX_DISTANCE
+	global CAMERA_MAX_DISTANCE_LIST
+	return CAMERA_MAX_DISTANCE_LIST.index(CAMERA_MAX_DISTANCE)
+
+########################
+
+import chrmgr
+import player
+import app
+
+def SET_DEFAULT_CHRNAME_COLOR():
+	global CHRNAME_COLOR_INDEX
+	chrmgr.SetEmpireNameMode(CHRNAME_COLOR_INDEX)
+
+def SET_CHRNAME_COLOR_INDEX(index):
+	global CHRNAME_COLOR_INDEX
+	CHRNAME_COLOR_INDEX=index
+	chrmgr.SetEmpireNameMode(index)
+
+def GET_CHRNAME_COLOR_INDEX():
+	global CHRNAME_COLOR_INDEX
+	return CHRNAME_COLOR_INDEX
+
+def SET_VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD(index):
+	global VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD
+	VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD = index
+
+def GET_VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD():
+	global VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD
+	return VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD
+
+def SET_DEFAULT_CONVERT_EMPIRE_LANGUAGE_ENABLE():
+	global CONVERT_EMPIRE_LANGUAGE_ENABLE
+	net.SetEmpireLanguageMode(CONVERT_EMPIRE_LANGUAGE_ENABLE)
+
+def SET_DEFAULT_USE_ITEM_WEAPON_TABLE_ATTACK_BONUS():
+	global USE_ITEM_WEAPON_TABLE_ATTACK_BONUS
+	player.SetWeaponAttackBonusFlag(USE_ITEM_WEAPON_TABLE_ATTACK_BONUS)
+
+def SET_DEFAULT_USE_SKILL_EFFECT_ENABLE():
+	global USE_SKILL_EFFECT_UPGRADE_ENABLE
+	app.SetSkillEffectUpgradeEnable(USE_SKILL_EFFECT_UPGRADE_ENABLE)
+
+def SET_TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE():
+	global TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE
+	app.SetTwoHandedWeaponAttSpeedDecreaseValue(TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE)
+
+########################
+import item
+
+ACCESSORY_MATERIAL_LIST = [50623, 50624, 50625, 50626, 50627, 50628, 50629, 50630, 50631, 50632, 50633, 50634, 50635, 50636, 50637, 50638, 50639]
+if app.ENABLE_CONQUEROR_LEVEL:
+	ACCESSORY_MATERIAL_LIST += [50661, 50662, 50663, 50664]
+
+JewelAccessoryInfos = [
+		# jewel wrist neck ear
+		[ 50634, 14420, 16220, 17220 ],
+		[ 50635, 14500, 16500, 17500 ],
+		[ 50636, 14520, 16520, 17520 ],
+		[ 50637, 14540, 16540, 17540 ],
+		[ 50638, 14560, 16560, 17560 ],
+		[ 50639, 14570, 16570, 0 ], # Í°Ì´ (Í°Ì´ Î°)
+	]
+
+if app.ENABLE_CONQUEROR_LEVEL:
+	JewelAccessoryInfos += [
+		# jewel wrist neck ear
+		[ 50661, 14590, 16590, 17580 ],
+		[ 50662, 14600, 16600, 17590 ],
+		[ 50663, 14610, 16610, 17600 ],
+		[ 50664, 14580, 16580, 17570 ],
+	]
+
+def GET_ACCESSORY_MATERIAL_VNUM(vnum, subType):
+	ret = vnum
+	item_base = (vnum / 10) * 10
+	for info in JewelAccessoryInfos:
+		if item.ARMOR_WRIST == subType:
+			if info[1] == item_base:
+				return info[0]
+		elif item.ARMOR_NECK == subType:
+			if info[2] == item_base:
+				return info[0]
+		elif item.ARMOR_EAR == subType:
+			if info[3] == item_base:
+				return info[0]
+
+	if vnum >= 16210 and vnum <= 16219:
+		return 50625
+
+	if item.ARMOR_WRIST == subType:
+		WRIST_ITEM_VNUM_BASE = 14000
+		ret -= WRIST_ITEM_VNUM_BASE
+	elif item.ARMOR_NECK == subType:
+		NECK_ITEM_VNUM_BASE = 16000
+		ret -= NECK_ITEM_VNUM_BASE
+	elif item.ARMOR_EAR == subType:
+		EAR_ITEM_VNUM_BASE = 17000
+		ret -= EAR_ITEM_VNUM_BASE
+
+	type = ret/20
+
+	if type < 0 or type >= len(ACCESSORY_MATERIAL_LIST):
+		type = (ret - 170) / 20
+		if type < 0 or type >= len(ACCESSORY_MATERIAL_LIST):
+			return 0
+
+	return ACCESSORY_MATERIAL_LIST[type]
+
+##################################################################
+##  ß° 'Æ®'  Å¸Ô°, Æ® Ï¿   .. 
+## Æ® Ï½Ã½ Ç¼ Ï± ,  Ç¼  ÏµÚµÃ³ Ì·  Û¿ ..
+
+def GET_BELT_MATERIAL_VNUM(vnum, subType = 0):
+	#   Æ® Ï³ (#18900)  
+	return 18900
+
+##################################################################
+## Úµ (HP: #72723 ~ #72726, SP: #72727 ~ #72730)
+
+# Ø´ vnum ÚµÎ°?
+def IS_AUTO_POTION(itemVnum):
+	return IS_AUTO_POTION_HP(itemVnum) or IS_AUTO_POTION_SP(itemVnum)
+
+# Ø´ vnum HP ÚµÎ°?
+def IS_AUTO_POTION_HP(itemVnum):
+	if 72723 <= itemVnum and 72726 >= itemVnum:
+		return 1
+	elif itemVnum >= 76021 and itemVnum <= 76022: ##  î°£  È­ àº¹
+		return 1
+	elif itemVnum == 79012:
+		return 1
+
+	return 0
+
+# Ø´ vnum SP ÚµÎ°?
+def IS_AUTO_POTION_SP(itemVnum):
+	if 72727 <= itemVnum and 72730 >= itemVnum:
+		return 1
+	elif itemVnum >= 76004 and itemVnum <= 76005: ##  î°£   àº¹
+		return 1
+	elif itemVnum == 79013:
+		return 1
+
+	return 0
+
+if app.ENABLE_GROWTH_PET_SYSTEM:
+	def IS_PET_ITEM(itemVnum):
+		if itemVnum == 0:
+			return 0
+			
+		item.SelectItem(itemVnum)
+		itemType = item.GetItemType()
+		itemSubType = item.GetItemSubType()
+		
+		if itemType == item.ITEM_TYPE_PET and itemSubType == item.PET_UPBRINGING:
+			return 1
+			
+		return 0
diff --git a/client/pack/root/game.py b/client/pack/root/game.py
index 6cd7ec9..a64f51d 100644
--- a/client/pack/root/game.py
+++ b/client/pack/root/game.py
@@ -1,3242 +1,3290 @@
-import os
-import app
-import dbg
-import grp
-import item
-import background
-import chr
-import chrmgr
-import player
-import snd
-import chat
-import textTail
-import snd
-import net
-import effect
-import wndMgr
-#import fly
-import systemSetting
-import quest
-import guild
-import skill
-import messenger
-import localeInfo
-import constInfo
-import exchange
-import ime
-
-import ui
-import uiCommon
-import uiPhaseCurtain
-import uiMapNameShower
-import uiAffectShower
-import uiPlayerGauge
-import uiCharacter
-import uiTarget
-
-# PRIVATE_SHOP_PRICE_LIST
-import uiPrivateShopBuilder
-# END_OF_PRIVATE_SHOP_PRICE_LIST
-
-import mouseModule
-import consoleModule
-import localeInfo
-
-import playerSettingModule
-import interfaceModule
-
-import musicInfo
-import debugInfo
-import stringCommander
-
-if app.ENABLE_KEYCHANGE_SYSTEM:
-	import uiKeyChange
-
-if app.ENABLE_EVENT_BANNER:
-	import ingameEventSystem
-
-from _weakref import proxy
-
-# TEXTTAIL_LIVINGTIME_CONTROL
-#if localeInfo.IsJAPAN():
-#	app.SetTextTailLivingTime(8.0)
-# END_OF_TEXTTAIL_LIVINGTIME_CONTROL
-
-# SCREENSHOT_CWDSAVE
-SCREENSHOT_CWDSAVE = False
-SCREENSHOT_DIR = None
-
-if localeInfo.IsEUROPE():
-	SCREENSHOT_CWDSAVE = True
-
-if localeInfo.IsCIBN10():
-	SCREENSHOT_CWDSAVE = False
-	SCREENSHOT_DIR = "YT2W"
-
-cameraDistance = 1550.0
-cameraPitch = 27.0
-cameraRotation = 0.0
-cameraHeight = 100.0
-
-testAlignment = 0
-
-if app.ENABLE_REFINE_MSG_ADD:
-	REFINE_FAIL_GRADE_DOWN = 0
-	REFINE_FAIL_DEL_ITEM = 1
-	REFINE_FAIL_KEEP_GRADE = 2
-	REFINE_FAIL_MAX = 3
-
-class GameWindow(ui.ScriptWindow):
-
-	if app.ENABLE_LEFT_SEAT:
-		left_seat_dialog = None
-
-	def __init__(self, stream):
-		ui.ScriptWindow.__init__(self, "GAME")
-		self.SetWindowName("game")
-		net.SetPhaseWindow(net.PHASE_WINDOW_GAME, self)
-		player.SetGameWindow(self)
-
-		self.quickSlotPageIndex = 0
-		self.lastPKModeSendedTime = 0
-		self.pressNumber = None
-
-		self.guildWarQuestionDialog = None
-		self.interface = None
-		self.targetBoard = None
-		if app.ENABLE_DEFENSE_WAVE:
-			self.allianceTargetBoard = None
-		self.console = None
-		self.mapNameShower = None
-		self.affectShower = None
-		self.playerGauge = None
-		if app.ENABLE_KEYCHANGE_SYSTEM:
-			self.wndKeyChange = None
-
-		self.stream = stream
-		self.interface = interfaceModule.Interface()
-		self.interface.MakeInterface()
-		self.interface.ShowDefaultWindows()
-
-		self.curtain = uiPhaseCurtain.PhaseCurtain()
-		self.curtain.speed = 0.03
-		self.curtain.Hide()
-
-		self.targetBoard = uiTarget.TargetBoard()
-		self.targetBoard.SetWhisperEvent(ui.__mem_func__(self.interface.OpenWhisperDialog))
-		self.targetBoard.Hide()
-		self.interface.SettargetBoard(self.targetBoard)
-
-		if app.ENABLE_DEFENSE_WAVE:
-			self.allianceTargetBoard = uiTarget.AllianceTargetBoard()
-			self.allianceTargetBoard.Hide()
-			self.interface.SetAllianceTargetBoard(self.allianceTargetBoard)
-
-		self.console = consoleModule.ConsoleWindow()
-		self.console.BindGameClass(self)
-		self.console.SetConsoleSize(wndMgr.GetScreenWidth(), 200)
-		self.console.Hide()
-
-		self.mapNameShower = uiMapNameShower.MapNameShower()
-		self.affectShower = uiAffectShower.AffectShower()
-		self.interface.SetAffectShower(self.affectShower)
-
-		self.playerGauge = uiPlayerGauge.PlayerGauge(self)
-		self.playerGauge.Hide()
-
-		#wj 2014.1.2. ESCÅ°¸¦ ´©¸¦ ½Ã ¿ì¼±ÀûÀ¸·Î DropQuestionDialog¸¦ ²ôµµ·Ï ¸¸µé¾ú´Ù. ÇÏÁö¸¸ Ã³À½¿¡ itemDropQuestionDialog°¡ ¼±¾ðµÇ¾î ÀÖÁö ¾Ê¾Æ ERROR°¡ ¹ß»ýÇÏ¿© init¿¡¼­ ¼±¾ð°ú µ¿½Ã¿¡ ÃÊ±âÈ­ ½ÃÅ´.
-		self.itemDropQuestionDialog = None
-		if app.ENABLE_NEW_DROP_DIALOG:
-			self.itemDestroyQuestionDialog = None
-
-		self.__SetQuickSlotMode()
-
-		self.__ServerCommand_Build()
-		self.__ProcessPreservedServerCommand()
-
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			self.interface.PetInfoBindAffectShower(self.affectShower)
-
-		if app.ENABLE_KEYCHANGE_SYSTEM:
-			self.wndKeyChange = uiKeyChange.KeyChangeWindow(self, self.interface)
-			self.ADDKEYBUFFERCONTROL = player.KEY_ADDKEYBUFFERCONTROL
-			self.ADDKEYBUFFERALT = player.KEY_ADDKEYBUFFERALT
-			self.ADDKEYBUFFERSHIFT = player.KEY_ADDKEYBUFFERSHIFT
-
-		self.partyRequestQuestionDialog = None
-		self.partyInviteQuestionDialog = None
-
-	def __del__(self):
-		player.SetGameWindow(0)
-		net.ClearPhaseWindow(net.PHASE_WINDOW_GAME, self)
-		ui.ScriptWindow.__del__(self)
-
-	def Open(self):
-		app.SetFrameSkip(1)
-
-		self.SetSize(wndMgr.GetScreenWidth(), wndMgr.GetScreenHeight())
-
-		self.quickSlotPageIndex = 0
-		self.PickingCharacterIndex = -1
-		self.PickingItemIndex = -1
-		self.consoleEnable = False
-		self.isShowDebugInfo = False
-		self.ShowNameFlag = False
-
-		self.enableXMasBoom = False
-		self.startTimeXMasBoom = 0.0
-		self.indexXMasBoom = 0
-
-		global cameraDistance, cameraPitch, cameraRotation, cameraHeight
-
-		app.SetCamera(cameraDistance, cameraPitch, cameraRotation, cameraHeight)
-
-		constInfo.SET_DEFAULT_CAMERA_MAX_DISTANCE()
-		constInfo.SET_DEFAULT_CHRNAME_COLOR()
-		constInfo.SET_DEFAULT_FOG_LEVEL()
-		constInfo.SET_DEFAULT_CONVERT_EMPIRE_LANGUAGE_ENABLE()
-		constInfo.SET_DEFAULT_USE_ITEM_WEAPON_TABLE_ATTACK_BONUS()
-		constInfo.SET_DEFAULT_USE_SKILL_EFFECT_ENABLE()
-
-		# TWO_HANDED_WEAPON_ATTACK_SPEED_UP
-		constInfo.SET_TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE()
-		# END_OF_TWO_HANDED_WEAPON_ATTACK_SPEED_UP
-
-		import event
-		event.SetLeftTimeString(localeInfo.UI_LEFT_TIME)
-
-		textTail.EnablePKTitle(constInfo.PVPMODE_ENABLE)
-
-		#if constInfo.PVPMODE_TEST_ENABLE:
-			#self.testPKMode = ui.TextLine()
-			#self.testPKMode.SetFontName(localeInfo.UI_DEF_FONT)
-			#self.testPKMode.SetPosition(0, 15)
-			#self.testPKMode.SetWindowHorizontalAlignCenter()
-			#self.testPKMode.SetHorizontalAlignCenter()
-			#self.testPKMode.SetFeather()
-			#self.testPKMode.SetOutline()
-			#self.testPKMode.Show()
-
-			#self.testAlignment = ui.TextLine()
-			#self.testAlignment.SetFontName(localeInfo.UI_DEF_FONT)
-			#self.testAlignment.SetPosition(0, 35)
-			#self.testAlignment.SetWindowHorizontalAlignCenter()
-			#self.testAlignment.SetHorizontalAlignCenter()
-			#self.testAlignment.SetFeather()
-			#self.testAlignment.SetOutline()
-			#self.testAlignment.Show()
-
-		if app.ENABLE_KEYCHANGE_SYSTEM:
-			pass
-		else:
-			self.__BuildKeyDict()
-
-		self.__BuildDebugInfo()
-
-		# PRIVATE_SHOP_PRICE_LIST
-		uiPrivateShopBuilder.Clear()
-		# END_OF_PRIVATE_SHOP_PRICE_LIST
-
-		# UNKNOWN_UPDATE
-		exchange.InitTrading()
-		# END_OF_UNKNOWN_UPDATE
-
-		if debugInfo.IsDebugMode():
-			self.ToggleDebugInfo()
-
-		## Sound
-		snd.SetMusicVolume(systemSetting.GetMusicVolume() * net.GetFieldMusicVolume())
-		snd.SetSoundVolume(systemSetting.GetSoundVolume())
-
-		netFieldMusicFileName = net.GetFieldMusicFileName()
-		if netFieldMusicFileName:
-			snd.FadeInMusic("BGM/" + netFieldMusicFileName)
-		elif musicInfo.fieldMusic != "":
-			snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
-
-		self.__SetQuickSlotMode()
-		self.__SelectQuickPage(self.quickSlotPageIndex)
-
-		self.SetFocus()
-		self.Show()
-		app.ShowCursor()
-
-		net.SendEnterGamePacket()
-
-		if app.ENABLE_MONSTER_CARD:
-			app.IllustratedCreate()
-
-		if app.ENABLE_MYSHOP_DECO:
-			app.MyShopDecoBGCreate()
-
-		if app.ENABLE_MINI_GAME_YUTNORI:
-			app.YutnoriCreate()
-
-		# START_GAME_ERROR_EXIT
-		try:
-			self.StartGame()
-		except:
-			import exception
-			exception.Abort("GameWindow.Open")
-		# END_OF_START_GAME_ERROR_EXIT
-
-		# NPC°¡ Å¥ºê½Ã½ºÅÛÀ¸·Î ¸¸µé ¼ö ÀÖ´Â ¾ÆÀÌÅÛµéÀÇ ¸ñ·ÏÀ» Ä³½Ì
-		# ex) cubeInformation[20383] = [ {"rewordVNUM": 72723, "rewordCount": 1, "materialInfo": "101,1&102,2", "price": 999 }, ... ]
-		if not app.ENABLE_CUBE_RENEWAL:
-			self.cubeInformation = {}
-			self.currentCubeNPC = 0
-
-		mouseModule.mouseController.CreateNumberLine()
-
-	def Close(self):
-		self.Hide()
-
-		global cameraDistance, cameraPitch, cameraRotation, cameraHeight
-		(cameraDistance, cameraPitch, cameraRotation, cameraHeight) = app.GetCamera()
-
-		if musicInfo.fieldMusic != "":
-			snd.FadeOutMusic("BGM/"+ musicInfo.fieldMusic)
-
-		self.onPressKeyDict = None
-		self.onClickKeyDict = None
-
-		chat.Close()
-		snd.StopAllSound()
-		grp.InitScreenEffect()
-		chr.Destroy()
-		textTail.Clear()
-		quest.Clear()
-		background.Destroy()
-		guild.Destroy()
-		messenger.Destroy()
-		skill.ClearSkillData()
-		wndMgr.Unlock()
-		mouseModule.mouseController.DeattachObject()
-
-		if self.guildWarQuestionDialog:
-			self.guildWarQuestionDialog.Close()
-
-		self.guildNameBoard = None
-		self.partyRequestQuestionDialog = None
-		self.partyInviteQuestionDialog = None
-		self.guildInviteQuestionDialog = None
-		self.guildWarQuestionDialog = None
-		self.messengerAddFriendQuestion = None
-
-		# UNKNOWN_UPDATE
-		self.itemDropQuestionDialog = None
-		if app.ENABLE_NEW_DROP_DIALOG:
-			self.itemDestroyQuestionDialog = None
-		# END_OF_UNKNOWN_UPDATE
-
-		# QUEST_CONFIRM
-		self.confirmDialog = None
-		# END_OF_QUEST_CONFIRM
-
-		self.PrintCoord = None
-		self.FrameRate = None
-		self.Pitch = None
-		self.Splat = None
-		self.TextureNum = None
-		self.ObjectNum = None
-		self.ViewDistance = None
-		self.PrintMousePos = None
-
-		self.ClearDictionary()
-
-		self.playerGauge = None
-		self.mapNameShower = None
-		self.affectShower = None
-
-		if self.console:
-			self.console.BindGameClass(0)
-			self.console.Close()
-			self.console = None
-
-		if self.interface:
-			self.interface.HideAllWindows()
-			self.interface.Close()
-			del self.interface
-			self.interface = None
-
-		if self.targetBoard:
-			self.targetBoard.Destroy()
-			self.targetBoard = None
-
-		if app.ENABLE_DEFENSE_WAVE:
-			if self.allianceTargetBoard:
-				self.allianceTargetBoard.Destroy()
-				self.allianceTargetBoard = None
-
-		if app.ENABLE_LEFT_SEAT:
-			if self.left_seat_dialog:
-				del self.left_seat_dialog
-				self.left_seat_dialog = None
-
-		player.ClearSkillDict()
-		player.ResetCameraRotation()
-
-		self.KillFocus()
-		app.HideCursor()
-
-		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-		if app.ENABLE_KEYCHANGE_SYSTEM:
-			if self.wndKeyChange:
-				self.wndKeyChange.KeyChangeWindowClose(True)
-				self.wndKeyChange = None
-
-		mouseModule.mouseController.Destroy()
-		#print "---------------------------------------------------------------------------- CLOSE GAME WINDOW"
-
-	def __BuildKeyDict(self):
-		onPressKeyDict = {}
-
-		# PressKey ´Â ´©¸£°í ÀÖ´Â µ¿¾È °è¼Ó Àû¿ëµÇ´Â Å°ÀÌ´Ù.
-
-		## ¼ýÀÚ ´ÜÃàÅ° Äü½½·Ô¿¡ ÀÌ¿ëµÈ´Ù.(ÀÌÈÄ ¼ýÀÚµéµµ Äü ½½·Ô¿ë ¿¹¾à)
-		## F12 ´Â Å¬¶ó µð¹ö±×¿ë Å°ÀÌ¹Ç·Î ¾²Áö ¾Ê´Â °Ô ÁÁ´Ù.
-		onPressKeyDict[app.DIK_1] = lambda : self.__PressNumKey(1)
-		onPressKeyDict[app.DIK_2] = lambda : self.__PressNumKey(2)
-		onPressKeyDict[app.DIK_3] = lambda : self.__PressNumKey(3)
-		onPressKeyDict[app.DIK_4] = lambda : self.__PressNumKey(4)
-		onPressKeyDict[app.DIK_5] = lambda : self.__PressNumKey(5)
-		onPressKeyDict[app.DIK_6] = lambda : self.__PressNumKey(6)
-		onPressKeyDict[app.DIK_7] = lambda : self.__PressNumKey(7)
-		onPressKeyDict[app.DIK_8] = lambda : self.__PressNumKey(8)
-		onPressKeyDict[app.DIK_9] = lambda : self.__PressNumKey(9)
-		onPressKeyDict[app.DIK_F1] = lambda : self.__PressQuickSlot(4)
-		onPressKeyDict[app.DIK_F2] = lambda : self.__PressQuickSlot(5)
-		onPressKeyDict[app.DIK_F3] = lambda : self.__PressQuickSlot(6)
-		onPressKeyDict[app.DIK_F4] = lambda : self.__PressQuickSlot(7)
-
-		onPressKeyDict[app.DIK_LALT] = lambda : self.ShowName()
-		onPressKeyDict[app.DIK_LCONTROL] = lambda : self.ShowMouseImage()
-		onPressKeyDict[app.DIK_SYSRQ] = lambda : self.SaveScreen()
-		onPressKeyDict[app.DIK_SPACE] = lambda : self.StartAttack()
-
-		# Ä³¸¯ÅÍ ÀÌµ¿Å°
-		onPressKeyDict[app.DIK_UP] = lambda : self.MoveUp()
-		onPressKeyDict[app.DIK_DOWN] = lambda : self.MoveDown()
-		onPressKeyDict[app.DIK_LEFT] = lambda : self.MoveLeft()
-		onPressKeyDict[app.DIK_RIGHT] = lambda : self.MoveRight()
-		onPressKeyDict[app.DIK_W] = lambda : self.MoveUp()
-		onPressKeyDict[app.DIK_S] = lambda : self.MoveDown()
-		onPressKeyDict[app.DIK_A] = lambda : self.MoveLeft()
-		onPressKeyDict[app.DIK_D] = lambda : self.MoveRight()
-
-		onPressKeyDict[app.DIK_E] = self.__PressEKey
-		onPressKeyDict[app.DIK_R] = lambda: app.ZoomCamera(app.CAMERA_TO_NEGATIVE)
-		#onPressKeyDict[app.DIK_F] = lambda: app.ZoomCamera(app.CAMERA_TO_POSITIVE)
-		onPressKeyDict[app.DIK_T] = lambda: app.PitchCamera(app.CAMERA_TO_NEGATIVE)
-		onPressKeyDict[app.DIK_G] = self.__PressGKey
-		onPressKeyDict[app.DIK_Q] = self.__PressQKey
-
-		onPressKeyDict[app.DIK_NUMPAD9] = lambda: app.MovieResetCamera()
-		onPressKeyDict[app.DIK_NUMPAD4] = lambda: app.MovieRotateCamera(app.CAMERA_TO_NEGATIVE)
-		onPressKeyDict[app.DIK_NUMPAD6] = lambda: app.MovieRotateCamera(app.CAMERA_TO_POSITIVE)
-		onPressKeyDict[app.DIK_PGUP] = lambda: app.MovieZoomCamera(app.CAMERA_TO_NEGATIVE)
-		onPressKeyDict[app.DIK_PGDN] = lambda: app.MovieZoomCamera(app.CAMERA_TO_POSITIVE)
-		onPressKeyDict[app.DIK_NUMPAD8] = lambda: app.MoviePitchCamera(app.CAMERA_TO_NEGATIVE)
-		onPressKeyDict[app.DIK_NUMPAD2] = lambda: app.MoviePitchCamera(app.CAMERA_TO_POSITIVE)
-		onPressKeyDict[app.DIK_GRAVE] = lambda : self.PickUpItem()
-		onPressKeyDict[app.DIK_Z] = lambda : self.PickUpItem()
-		onPressKeyDict[app.DIK_C] = lambda state = "STATUS": self.interface.ToggleCharacterWindow(state)
-		onPressKeyDict[app.DIK_V] = lambda state = "SKILL": self.interface.ToggleCharacterWindow(state)
-		#onPressKeyDict[app.DIK_B] = lambda state = "EMOTICON": self.interface.ToggleCharacterWindow(state)
-		onPressKeyDict[app.DIK_N] = lambda state = "QUEST": self.interface.ToggleCharacterWindow(state)
-		onPressKeyDict[app.DIK_I] = lambda : self.interface.ToggleInventoryWindow()
-		onPressKeyDict[app.DIK_O] = lambda : self.__PressOKey()
-		onPressKeyDict[app.DIK_M] = lambda : self.interface.PressMKey()
-		#onPressKeyDict[app.DIK_H] = lambda : self.interface.OpenHelpWindow()
-		onPressKeyDict[app.DIK_ADD] = lambda : self.interface.MiniMapScaleUp()
-		onPressKeyDict[app.DIK_SUBTRACT] = lambda : self.interface.MiniMapScaleDown()
-		onPressKeyDict[app.DIK_L] = lambda : self.interface.ToggleChatLogWindow()
-		onPressKeyDict[app.DIK_COMMA] = lambda : self.ShowConsole() # "`" key
-		onPressKeyDict[app.DIK_LSHIFT] = lambda : self.__SetQuickPageMode()
-
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			onPressKeyDict[app.DIK_P] = lambda : self.interface.TogglePetInformationWindow()
-
-		onPressKeyDict[app.DIK_J] = lambda : self.__PressJKey()
-		onPressKeyDict[app.DIK_H] = lambda : self.__PressHKey()
-		onPressKeyDict[app.DIK_B] = lambda : self.__PressBKey()
-		onPressKeyDict[app.DIK_F] = lambda : self.__PressFKey()
-
-		# CUBE_TEST
-		#onPressKeyDict[app.DIK_K] = lambda : self.interface.OpenCubeWindow()
-		# CUBE_TEST_END
-
-		self.onPressKeyDict = onPressKeyDict
-
-		onClickKeyDict = {}
-		onClickKeyDict[app.DIK_UP] = lambda : self.StopUp()
-		onClickKeyDict[app.DIK_DOWN] = lambda : self.StopDown()
-		onClickKeyDict[app.DIK_LEFT] = lambda : self.StopLeft()
-		onClickKeyDict[app.DIK_RIGHT] = lambda : self.StopRight()
-		onClickKeyDict[app.DIK_SPACE] = lambda : self.EndAttack()
-
-		onClickKeyDict[app.DIK_W] = lambda : self.StopUp()
-		onClickKeyDict[app.DIK_S] = lambda : self.StopDown()
-		onClickKeyDict[app.DIK_A] = lambda : self.StopLeft()
-		onClickKeyDict[app.DIK_D] = lambda : self.StopRight()
-		onClickKeyDict[app.DIK_Q] = lambda: app.RotateCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_E] = lambda: app.RotateCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_R] = lambda: app.ZoomCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_F] = lambda: app.ZoomCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_T] = lambda: app.PitchCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_G] = lambda: self.__ReleaseGKey()
-		onClickKeyDict[app.DIK_NUMPAD4] = lambda: app.MovieRotateCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_NUMPAD6] = lambda: app.MovieRotateCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_PGUP] = lambda: app.MovieZoomCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_PGDN] = lambda: app.MovieZoomCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_NUMPAD8] = lambda: app.MoviePitchCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_NUMPAD2] = lambda: app.MoviePitchCamera(app.CAMERA_STOP)
-		onClickKeyDict[app.DIK_LALT] = lambda: self.HideName()
-		onClickKeyDict[app.DIK_LCONTROL] = lambda: self.HideMouseImage()
-		onClickKeyDict[app.DIK_LSHIFT] = lambda: self.__SetQuickSlotMode()
-
-		#if constInfo.PVPMODE_ACCELKEY_ENABLE:
-		#	onClickKeyDict[app.DIK_B] = lambda: self.ChangePKMode()
-
-		self.onClickKeyDict=onClickKeyDict
-
-	def __PressNumKey(self,num):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			if num >= 1 and num <= 9:
-				if (chrmgr.IsPossibleEmoticon(-1)):
-					chrmgr.SetEmoticon(-1, int(num)-1)
-					net.SendEmoticon(int(num)-1)
-		else:
-			if num >= 1 and num <= 4:
-				self.pressNumber(num-1)
-
-	def __ClickBKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			return
-		else:
-			if constInfo.PVPMODE_ACCELKEY_ENABLE:
-				self.ChangePKMode()
-
-	def __PressJKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			if player.IsMountingHorse():
-				net.SendCommandPacket("/unmount")
-			else:
-				#net.SendCommandPacket("/user_horse_ride")
-				if not uiPrivateShopBuilder.IsBuildingPrivateShop():
-					for i in xrange(player.INVENTORY_PAGE_SIZE):
-						if player.GetItemIndex(i) in (71114, 71116, 71118, 71120):
-							net.SendItemUsePacket(i)
-							break
-
-	def __PressHKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			net.SendCommandPacket("/user_horse_ride")
-		else:
-			self.interface.OpenHelpWindow()
-
-	def __PressOKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			if self.interface.wndDragonSoul:
-				self.interface.wndDragonSoul.ActivateButtonClick()
-		else:
-			self.interface.ToggleDragonSoulWindowWithNoInfo()
-
-	def __PressBKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			net.SendCommandPacket("/user_horse_back")
-		else:
-			state = "EMOTICON"
-			self.interface.ToggleCharacterWindow(state)
-
-	def __PressFKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			net.SendCommandPacket("/user_horse_feed")
-		else:
-			app.ZoomCamera(app.CAMERA_TO_POSITIVE)
-
-	def __PressGKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			net.SendCommandPacket("/ride")
-		else:
-			if self.ShowNameFlag:
-				self.interface.ToggleGuildWindow()
-			else:
-				app.PitchCamera(app.CAMERA_TO_POSITIVE)
-
-	def __ReleaseGKey(self):
-		app.PitchCamera(app.CAMERA_STOP)
-
-	def __PressQKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			if 0 == interfaceModule.IsQBHide:
-				interfaceModule.IsQBHide = 1
-				self.interface.HideAllQuestButton()
-			else:
-				interfaceModule.IsQBHide = 0
-				self.interface.ShowAllQuestButton()
-		else:
-			app.RotateCamera(app.CAMERA_TO_NEGATIVE)
-
-	def __PressEKey(self):
-		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-			if 0 == interfaceModule.IsWisperHide:
-				interfaceModule.IsWisperHide = 1
-				self.interface.HideAllWhisperButton()
-			else:
-				interfaceModule.IsWisperHide= 0
-				self.interface.ShowAllWhisperButton()
-		else:
-			app.RotateCamera(app.CAMERA_TO_POSITIVE)
-
-	def __SetQuickSlotMode(self):
-		self.pressNumber = ui.__mem_func__(self.__PressQuickSlot)
-
-	def __SetQuickPageMode(self):
-		self.pressNumber = ui.__mem_func__(self.__SelectQuickPage)
-
-	def __PressQuickSlot(self, localSlotIndex):
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			if localeInfo.IsARABIC():
-				if 0 <= localSlotIndex and localSlotIndex < 4:
-					localSlotIndex = 3 - localSlotIndex
-				else:
-					localSlotIndex = 11 - localSlotIndex
-
-			result = player.CanUseGrowthPetQuickSlot(localSlotIndex)
-
-			if player.QUICK_SLOT_POS_ERROR == result:
-				return
-			elif result in [player.QUICK_SLOT_ITEM_USE_SUCCESS, player.QUICK_SLOT_IS_NOT_ITEM, player.QUICK_SLOT_PET_ITEM_USE_SUCCESS]:
-				player.RequestUseLocalQuickSlot(localSlotIndex)
-			elif player.QUICK_SLOT_PET_ITEM_USE_FAILED == result:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.PET_CAN_NOT_SUMMON_BECAUSE_LIFE_TIME_END)
-			elif player.QUICK_SLOT_CAN_NOT_USE_PET_ITEM == result:
-				return
-
-		else:
-			if localeInfo.IsARABIC():
-				if 0 <= localSlotIndex and localSlotIndex < 4:
-					player.RequestUseLocalQuickSlot(3-localSlotIndex)
-				else:
-					player.RequestUseLocalQuickSlot(11-localSlotIndex)
-			else:
-				player.RequestUseLocalQuickSlot(localSlotIndex)
-
-	if app.ENABLE_KEYCHANGE_SYSTEM:
-		def OpenKeyChangeWindow(self):
-			self.wndKeyChange.Open()
-
-		def OpenWindow(self, type, state):
-			if type == player.KEY_OPEN_STATE:
-				self.interface.ToggleCharacterWindow(state)
-			elif type == player.KEY_OPEN_INVENTORY:
-				self.interface.ToggleInventoryWindow()
-			elif type == player.KEY_OPEN_DDS:
-				self.interface.ToggleDragonSoulWindowWithNoInfo()
-			elif type == player.KEY_OPEN_MINIMAP:
-				self.interface.ToggleMiniMap()
-			elif type == player.KEY_OPEN_LOGCHAT:
-				self.interface.ToggleChatLogWindow()
-			elif type == player.KEY_OPEN_GUILD:
-				self.interface.ToggleGuildWindow()
-			elif type == player.KEY_OPEN_MESSENGER:
-				self.interface.ToggleMessenger()
-			elif type == player.KEY_OPEN_HELP:
-				self.interface.ToggleHelpWindow()
-			elif app.ENABLE_EVENT_BANNER and type == player.KEY_OPEN_IN_GAME_EVENT:
-				self.interface.ShowInGameEvent()
-			elif app.ENABLE_GROWTH_PET_SYSTEM:
-				self.interface.TogglePetInformationWindow()
-
-			if app.ENABLE_DSS_KEY_SELECT:
-				if type == player.KEY_SELECT_DSS_1:
-					self.interface.DragonSoulKeySelect(0)
-				elif type == player.KEY_SELECT_DSS_2:
-					self.interface.DragonSoulKeySelect(1)
-
-		def ScrollOnOff(self):
-			if 0 == interfaceModule.IsQBHide:
-				interfaceModule.IsQBHide = 1
-				self.interface.HideAllQuestButton()
-			else:
-				interfaceModule.IsQBHide = 0
-				self.interface.ShowAllQuestButton()
-
-	def __SelectQuickPage(self, pageIndex):
-		self.quickSlotPageIndex = pageIndex
-		player.SetQuickPage(pageIndex)
-
-	def ToggleDebugInfo(self):
-		self.isShowDebugInfo = not self.isShowDebugInfo
-
-		if self.isShowDebugInfo:
-			self.PrintCoord.Show()
-			self.FrameRate.Show()
-			self.Pitch.Show()
-			self.Splat.Show()
-			self.TextureNum.Show()
-			self.ObjectNum.Show()
-			self.ViewDistance.Show()
-			self.PrintMousePos.Show()
-		else:
-			self.PrintCoord.Hide()
-			self.FrameRate.Hide()
-			self.Pitch.Hide()
-			self.Splat.Hide()
-			self.TextureNum.Hide()
-			self.ObjectNum.Hide()
-			self.ViewDistance.Hide()
-			self.PrintMousePos.Hide()
-
-	def __BuildDebugInfo(self):
-		## Character Position Coordinate
-		self.PrintCoord = ui.TextLine()
-		self.PrintCoord.SetFontName(localeInfo.UI_DEF_FONT)
-		self.PrintCoord.SetPosition(wndMgr.GetScreenWidth() - 270, 0)
-
-		## Frame Rate
-		self.FrameRate = ui.TextLine()
-		self.FrameRate.SetFontName(localeInfo.UI_DEF_FONT)
-		self.FrameRate.SetPosition(wndMgr.GetScreenWidth() - 270, 20)
-
-		## Camera Pitch
-		self.Pitch = ui.TextLine()
-		self.Pitch.SetFontName(localeInfo.UI_DEF_FONT)
-		self.Pitch.SetPosition(wndMgr.GetScreenWidth() - 270, 40)
-
-		## Splat
-		self.Splat = ui.TextLine()
-		self.Splat.SetFontName(localeInfo.UI_DEF_FONT)
-		self.Splat.SetPosition(wndMgr.GetScreenWidth() - 270, 60)
-
-		##
-		self.PrintMousePos = ui.TextLine()
-		self.PrintMousePos.SetFontName(localeInfo.UI_DEF_FONT)
-		self.PrintMousePos.SetPosition(wndMgr.GetScreenWidth() - 270, 80)
-
-		# TextureNum
-		self.TextureNum = ui.TextLine()
-		self.TextureNum.SetFontName(localeInfo.UI_DEF_FONT)
-		self.TextureNum.SetPosition(wndMgr.GetScreenWidth() - 270, 100)
-
-		# ¿ÀºêÁ§Æ® ±×¸®´Â °³¼ö
-		self.ObjectNum = ui.TextLine()
-		self.ObjectNum.SetFontName(localeInfo.UI_DEF_FONT)
-		self.ObjectNum.SetPosition(wndMgr.GetScreenWidth() - 270, 120)
-
-		# ½Ã¾ß°Å¸®
-		self.ViewDistance = ui.TextLine()
-		self.ViewDistance.SetFontName(localeInfo.UI_DEF_FONT)
-		self.ViewDistance.SetPosition(0, 0)
-
-	def __NotifyError(self, msg):
-		chat.AppendChat(chat.CHAT_TYPE_INFO, msg)
-
-	def ChangePKMode(self):
-		if not app.IsPressed(app.DIK_LCONTROL):
-			return
-
-		if player.GetStatus(player.LEVEL) < constInfo.PVPMODE_PROTECTED_LEVEL:
-			self.__NotifyError(localeInfo.OPTION_PVPMODE_PROTECT % (constInfo.PVPMODE_PROTECTED_LEVEL))
-			return
-
-		curTime = app.GetTime()
-		if curTime - self.lastPKModeSendedTime < constInfo.PVPMODE_ACCELKEY_DELAY:
-			return
-
-		self.lastPKModeSendedTime = curTime
-
-		curPKMode = player.GetPKMode()
-		nextPKMode = curPKMode + 1
-		if nextPKMode == player.PK_MODE_PROTECT:
-			if 0 == player.GetGuildID():
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.OPTION_PVPMODE_CANNOT_SET_GUILD_MODE)
-				nextPKMode = 0
-			else:
-				nextPKMode = player.PK_MODE_GUILD
-
-		elif nextPKMode == player.PK_MODE_MAX_NUM:
-			nextPKMode = 0
-
-		net.SendCommandPacket("/PKMode " + str(nextPKMode))
-		print "/PKMode " + str(nextPKMode)
-
-	def OnChangePKMode(self):
-		self.interface.OnChangePKMode()
-
-		try:
-			if player.GetStatus(player.LEVEL) < constInfo.PVPMODE_PROTECTED_LEVEL:
-				self.__NotifyError(localeInfo.OPTION_PVPMODE_MESSAGE_DICT[player.GetPKMode()])
-				return
-		except KeyError:
-			print "UNKNOWN PVPMode[%d]" % (player.GetPKMode())
-
-		#if constInfo.PVPMODE_TEST_ENABLE:
-		#	curPKMode = player.GetPKMode()
-		#	alignment, grade = chr.testGetPKData()
-		#	self.pkModeNameDict = { 0 : "PEACE", 1 : "REVENGE", 2 : "FREE", 3 : "PROTECT", }
-		#	self.testPKMode.SetText("Current PK Mode : " + self.pkModeNameDict.get(curPKMode, "UNKNOWN"))
-		#	self.testAlignment.SetText("Current Alignment : " + str(alignment) + " (" + localeInfo.TITLE_NAME_LIST[grade] + ")")
-
-	###############################################################################################
-	###############################################################################################
-	## Game Callback Functions
-
-	# Start
-	def StartGame(self):
-		self.RefreshInventory()
-		self.RefreshEquipment()
-		self.RefreshCharacter()
-		self.RefreshSkill()
-
-	# Refresh
-	def CheckGameButton(self):
-		if self.interface:
-			self.interface.CheckGameButton()
-
-	def RefreshAlignment(self):
-		self.interface.RefreshAlignment()
-
-	def RefreshStatus(self):
-		self.CheckGameButton()
-
-		if self.interface:
-			self.interface.RefreshStatus()
-
-		if self.playerGauge:
-			self.playerGauge.RefreshGauge()
-
-	def RefreshStamina(self):
-		self.interface.RefreshStamina()
-
-	def RefreshSkill(self):
-		self.CheckGameButton()
-		if self.interface:
-			self.interface.RefreshSkill()
-
-	if app.ENABLE_QUEST_RENEWAL:
-		def RefreshQuest(self, quest_type, quest_index):
-			self.interface.RefreshQuest(quest_type, quest_index)
-
-		def DeleteQuest(self, quest_type, quest_index):
-			self.interface.DeleteQuest(quest_type, quest_index)
-	else:
-		def RefreshQuest(self):
-			self.interface.RefreshQuest()
-
-	def RefreshMessenger(self):
-		self.interface.RefreshMessenger()
-
-	def RefreshGuildInfoPage(self):
-		self.interface.RefreshGuildInfoPage()
-
-	def RefreshGuildBoardPage(self):
-		self.interface.RefreshGuildBoardPage()
-
-	def RefreshGuildMemberPage(self):
-		self.interface.RefreshGuildMemberPage()
-
-	def RefreshGuildMemberPageGradeComboBox(self):
-		self.interface.RefreshGuildMemberPageGradeComboBox()
-
-	def RefreshGuildSkillPage(self):
-		self.interface.RefreshGuildSkillPage()
-
-	def RefreshGuildGradePage(self):
-		self.interface.RefreshGuildGradePage()
-
-	def OnBlockMode(self, mode):
-		self.interface.OnBlockMode(mode)
-
-	def OpenQuestWindow(self, skin, idx):
-		self.interface.OpenQuestWindow(skin, idx)
-
-	def AskGuildName(self):
-		guildNameBoard = uiCommon.InputDialog()
-		guildNameBoard.SetTitle(localeInfo.GUILD_NAME)
-		guildNameBoard.SetAcceptEvent(ui.__mem_func__(self.ConfirmGuildName))
-		guildNameBoard.SetCancelEvent(ui.__mem_func__(self.CancelGuildName))
-		guildNameBoard.Open()
-
-		self.guildNameBoard = guildNameBoard
-
-	def ConfirmGuildName(self):
-		guildName = self.guildNameBoard.GetText()
-		if not guildName:
-			return
-
-		if net.IsInsultIn(guildName):
-			self.PopupMessage(localeInfo.GUILD_CREATE_ERROR_INSULT_NAME)
-			return
-
-		net.SendAnswerMakeGuildPacket(guildName)
-		self.guildNameBoard.Close()
-		self.guildNameBoard = None
-		return True
-
-	def CancelGuildName(self):
-		self.guildNameBoard.Close()
-		self.guildNameBoard = None
-		return True
-
-	## Refine
-	def PopupMessage(self, msg):
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(msg, 0, localeInfo.UI_OK)
-
-	def OpenRefineDialog(self, targetItemPos, nextGradeItemVnum, cost, prob, type, apply_random_list = None, src_vnum = 0):
-		self.interface.OpenRefineDialog(targetItemPos, nextGradeItemVnum, cost, prob, type, apply_random_list, src_vnum)
-
-	def AppendMaterialToRefineDialog(self, vnum, count):
-		self.interface.AppendMaterialToRefineDialog(vnum, count)
-
-	def RunUseSkillEvent(self, slotIndex, coolTime):
-		self.interface.OnUseSkill(slotIndex, coolTime)
-
-	def ClearAffects(self):
-		self.affectShower.ClearAffects()
-
-	def SetAffect(self, affect):
-		self.affectShower.SetAffect(affect)
-
-	def ResetAffect(self, affect):
-		self.affectShower.ResetAffect(affect)
-
-	# UNKNOWN_UPDATE
-	def BINARY_NEW_AddAffect(self, type, pointIdx, value, duration):
-		if app.ENABLE_SET_ITEM:
-			if self.affectShower:
-				self.affectShower.BINARY_NEW_AddAffect(type, pointIdx, value, duration)
-		else:
-			self.affectShower.BINARY_NEW_AddAffect(type, pointIdx, value, duration)
-
-		if chr.NEW_AFFECT_DRAGON_SOUL_DECK1 == type or chr.NEW_AFFECT_DRAGON_SOUL_DECK2 == type:
-			self.interface.DragonSoulActivate(type - chr.NEW_AFFECT_DRAGON_SOUL_DECK1)
-		elif chr.NEW_AFFECT_DRAGON_SOUL_QUALIFIED == type:
-			self.BINARY_DragonSoulGiveQuilification()
-		elif app.ENABLE_DS_SET and chr.NEW_AFFECT_DS_SET == type:
-			self.interface.DragonSoulSetGrade(value)
-
-	def BINARY_NEW_RemoveAffect(self, type, pointIdx):
-		if app.ENABLE_SET_ITEM:
-			if self.affectShower:
-				self.affectShower.BINARY_NEW_RemoveAffect(type, pointIdx)
-		else:
-			self.affectShower.BINARY_NEW_RemoveAffect(type, pointIdx)
-
-		if chr.NEW_AFFECT_DRAGON_SOUL_DECK1 == type or chr.NEW_AFFECT_DRAGON_SOUL_DECK2 == type:
-			self.interface.DragonSoulDeactivate()
-		elif app.ENABLE_DS_SET and chr.NEW_AFFECT_DS_SET == type:
-			self.interface.DragonSoulSetGrade(0)
-
-	def BINARY_NEW_UpdateAffect(self, type, point_type, value, duration):
-		self.affectShower.BINARY_NEW_UpdateAffect(type, point_type, value, duration)
-	# END_OF_UNKNOWN_UPDATE
-
-	def ActivateSkillSlot(self, slotIndex):
-		if self.interface:
-			self.interface.OnActivateSkill(slotIndex)
-
-	def DeactivateSkillSlot(self, slotIndex):
-		if self.interface:
-			self.interface.OnDeactivateSkill(slotIndex)
-
-	def RefreshEquipment(self):
-		if self.interface:
-			self.interface.RefreshInventory()
-
-	def RefreshInventory(self):
-		if self.interface:
-			self.interface.RefreshInventory()
-
-	def RefreshCharacter(self):
-		if self.interface:
-			self.interface.RefreshCharacter()
-
-	def OnGameOver(self, map_index, dialog_type):
-		self.CloseTargetBoard()
-		self.OpenRestartDialog(map_index, dialog_type)
-
-	def OpenRestartDialog(self, map_index, dialog_type):
-		self.interface.OpenRestartDialog(map_index, dialog_type)
-
-	def ChangeCurrentSkill(self, skillSlotNumber):
-		self.interface.OnChangeCurrentSkill(skillSlotNumber)
-
-	## TargetBoard
-	def SetPCTargetBoard(self, vid, name):
-		if self.interface.IsHideUiMode == True:
-			return
-
-		self.targetBoard.Open(vid, name)
-
-		if app.IsPressed(app.DIK_LCONTROL):
-			if not player.IsSameEmpire(vid):
-				return
-
-			if player.IsMainCharacterIndex(vid):
-				return
-			elif chr.INSTANCE_TYPE_BUILDING == chr.GetInstanceType(vid):
-				return
-
-			self.interface.OpenWhisperDialog(name)
-
-	def RefreshTargetBoardByVID(self, vid):
-		if self.targetBoard:
-			self.targetBoard.RefreshByVID(vid)
-
-	def RefreshTargetBoardByName(self, name):
-		if self.targetBoard:
-			self.targetBoard.RefreshByName(name)
-
-	def __RefreshTargetBoard(self):
-		if self.targetBoard:
-			self.targetBoard.Refresh()
-
-	if app.ENABLE_VIEW_TARGET_DECIMAL_HP:
-		def SetHPTargetBoard(self, vid, hpPercentage, iMinHP, iMaxHP):
-			if self.interface.IsHideUiMode == True:
-				return
-
-			if vid != self.targetBoard.GetTargetVID():
-				self.targetBoard.ResetTargetBoard()
-				self.targetBoard.SetEnemyVID(vid)
-
-			self.targetBoard.SetHP(hpPercentage, iMinHP, iMaxHP)
-			self.targetBoard.Show()
-	else:
-		def SetHPTargetBoard(self, vid, hpPercentage):
-			if self.interface.IsHideUiMode == True:
-				return
-
-			if vid != self.targetBoard.GetTargetVID():
-				self.targetBoard.ResetTargetBoard()
-				self.targetBoard.SetEnemyVID(vid)
-
-			self.targetBoard.SetHP(hpPercentage)
-			self.targetBoard.Show()
-
-	if app.ENABLE_DEFENSE_WAVE:
-		def SetHPAllianceTargetBoard(self, vid, hp, hpMax):
-			if self.interface.IsHideUiMode == True:
-				return
-
-			if not vid:
-				self.allianceTargetBoard.Close()
-				return
-
-			if vid != self.allianceTargetBoard.GetTargetVID():
-				self.allianceTargetBoard.ResetTargetBoard()
-				self.allianceTargetBoard.SetTarget(vid)
-
-			self.allianceTargetBoard.SetHP(hp, hpMax)
-			self.allianceTargetBoard.Show()
-
-	def CloseTargetBoardIfDifferent(self, vid):
-		if vid != self.targetBoard.GetTargetVID():
-			self.targetBoard.Close()
-
-	def CloseTargetBoard(self):
-		self.targetBoard.Close()
-
-	if app.ENABLE_ELEMENT_ADD:
-		def ShowTargetElementEnchant(self, element_enchants_dict):
-			if self.targetBoard:
-				self.targetBoard.ShowElementImg(element_enchants_dict)
-
-	## View Equipment
-	def OpenEquipmentDialog(self, vid):
-		self.interface.OpenEquipmentDialog(vid)
-
-	def SetEquipmentDialogItem(self, window, vid, slot_index, vnum, count, change_look_vnum, refine_element, apply_random_list, set_value):
-		self.interface.SetEquipmentDialogItem(window, vid, slot_index, vnum, count, change_look_vnum, refine_element, apply_random_list, set_value)
-
-	def SetEquipmentDialogSocket(self, window, vid, slot_index, socket_index, value):
-		self.interface.SetEquipmentDialogSocket(window, vid, slot_index, socket_index, value)
-
-	def SetEquipmentDialogAttr(self, window, vid, slot_index, attr_index, type, value):
-		self.interface.SetEquipmentDialogAttr(window, vid, slot_index, attr_index, type, value)
-
-	# SHOW_LOCAL_MAP_NAME
-	def ShowMapName(self, mapName, x, y):
-		if self.mapNameShower:
-			self.mapNameShower.ShowMapName(mapName, x, y)
-
-		if self.interface:
-			self.interface.SetMapName(mapName)
-	# END_OF_SHOW_LOCAL_MAP_NAME
-
-	if app.ENABLE_EXTENDED_BATTLE_PASS:
-		def BINARY_ExtOpenBattlePass(self):
-			if self.interface:
-				self.interface.ReciveOpenExtBattlePass()
-			
-		def BINARY_ExtBattlePassAddGeneralInfo(self, BattlePassType, BattlePassName, BattlePassID, battlePassStartTime, battlePassEndTime):
-			if self.interface:
-				self.interface.AddExtendedBattleGeneralInfo(BattlePassType, BattlePassName, BattlePassID, battlePassStartTime, battlePassEndTime)
-				
-		def BINARY_ExtBattlePassAddMission(self, battlepassType, battlepassID, missionIndex, missionType, missionInfo1, missionInfo2, missionInfo3):
-			if self.interface:
-				self.interface.AddExtendedBattlePassMission(battlepassType, battlepassID, missionIndex, missionType, missionInfo1, missionInfo2, missionInfo3)
-
-		def BINARY_ExtBattlePassAddMissionReward(self, battlepassType, battlepassID, missionIndex, missionType, itemVnum, itemCount):
-			if self.interface:
-				self.interface.AddExtendedBattlePassMissionReward(battlepassType, battlepassID, missionIndex, missionType, itemVnum, itemCount)
-
-		def BINARY_ExtBattlePassUpdate(self, battlepassType, missionIndex, missionType, newProgress):
-			if self.interface:
-				self.interface.UpdateExtendedBattlePassMission(battlepassType, missionIndex, missionType, newProgress)
-
-		def BINARY_ExtBattlePassAddReward(self, battlepassType, battlepassID, itemVnum, itemCount):
-			if self.interface:
-				self.interface.AddExtendedBattlePassReward(battlepassType, battlepassID, itemVnum, itemCount)
-		
-		def BINARY_ExtBattlePassAddRanklistEntry(self, playername, battlepassType, battlepassID, startTime, endTime):
-			if self.interface:
-				self.interface.AddExtBattlePassRanklistEntry(playername, battlepassType, battlepassID, startTime, endTime)
-
-	def BINARY_OpenAtlasWindow(self):
-		self.interface.BINARY_OpenAtlasWindow()
-
-	## Chat
-	if app.ENABLE_MULTI_LANGUAGE_SYSTEM:
-		def OnRecvWhisper(self, mode, name, line, language):
-			if mode == chat.WHISPER_TYPE_GM:
-				self.interface.RegisterGameMasterName(name)
-
-			if localeInfo.IsARABIC():
-				chat.AppendWhisper(mode, name, name + " : ", language)
-				chat.AppendWhisper(mode, name, line)
-			else:
-				chat.AppendWhisper(mode, name, line, language)
-
-			self.interface.RecvWhisper(name)
-	else:
-		def OnRecvWhisper(self, mode, name, line):
-			if mode == chat.WHISPER_TYPE_GM:
-				self.interface.RegisterGameMasterName(name)
-
-			if localeInfo.IsARABIC():
-				chat.AppendWhisper(mode, name, name + " : ")
-				chat.AppendWhisper(mode, name, line)
-			else:
-				chat.AppendWhisper(mode, name, line)
-
-			self.interface.RecvWhisper(name)
-
-	def OnRecvWhisperSystemMessage(self, mode, name, line):
-		chat.AppendWhisper(chat.WHISPER_TYPE_SYSTEM, name, line)
-		self.interface.RecvWhisper(name)
-
-	def OnRecvWhisperError(self, mode, name, line):
-		if localeInfo.WHISPER_ERROR.has_key(mode):
-			chat.AppendWhisper(chat.WHISPER_TYPE_SYSTEM, name, localeInfo.WHISPER_ERROR[mode](name))
-		else:
-			chat.AppendWhisper(chat.WHISPER_TYPE_SYSTEM, name, "Whisper Unknown Error(mode=%d, name=%s)" % (mode, name))
-		self.interface.RecvWhisper(name)
-
-	def RecvWhisper(self, name):
-		self.interface.RecvWhisper(name)
-
-	def OnPickMoney(self, money):
-		if app.ENABLE_CHATTING_WINDOW_RENEWAL:
-			chat.AppendChat(chat.CHAT_TYPE_MONEY_INFO, localeInfo.GAME_PICK_MONEY % (money))
-		else:
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GAME_PICK_MONEY % (money))
-
-	if app.ENABLE_CHEQUE_SYSTEM:
-		def OnPickCheque(self, cheque):
-			if app.ENABLE_CHATTING_WINDOW_RENEWAL:
-				chat.AppendChat(chat.CHAT_TYPE_MONEY_INFO, localeInfo.CHEQUE_SYSTEM_PICK_WON % (cheque))
-			else:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.CHEQUE_SYSTEM_PICK_WON % (cheque))
-
-	if app.ENABLE_GEM_SYSTEM:
-		def OnPickGem(self, gem):
-			if app.ENABLE_CHATTING_WINDOW_RENEWAL:
-				chat.AppendChat(chat.CHAT_TYPE_MONEY_INFO, localeInfo.GEM_SYSTEM_PICK_GEM % (gem))
-			else:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_SYSTEM_PICK_GEM % (gem))
-
-		def OpenGemShop(self):
-			self.interface.OpenGemShop()
-		def CloseGemShop(self):
-			self.interface.CloseGemShop()
-		def RefreshGemShopWindow(self):
-			self.interface.RefreshGemShopWindow()
-		def GemShopSlotBuy(self, slotindex, enable):
-			self.interface.GemShopSlotBuy(slotindex, enable)
-		def BINARY_OpenSelectItemWindowEx(self):
-			self.interface.BINARY_OpenSelectItemWindowEx()
-		def BINARY_RefreshSelectItemWindowEx(self):
-			self.interface.BINARY_RefreshSelectItemWindowEx()
-		def GemShopSlotAdd(self, slotindex, enable):
-			self.interface.GemShopSlotAdd(slotindex, enable)
-
-	def OpenCostumeWindow(self):
-		self.interface.OpenCostumeWindow()
-
-	if app.ENABLE_MOVE_CHANNEL:
-		# 2019.09.03.owsap - Load server info (server name)
-		def __LoadChannelInfo(self):
-			try:
-				file = open("channel.inf")
-				lines = file.readlines()
-
-				if len(lines) > 0:
-					tokens = lines[0].split()
-
-					selServerID = int(tokens[0])
-					selChannelID = int(tokens[1])
-
-					if len(tokens) == 3:
-						regionID = int(tokens[2])
-
-					return regionID, selServerID, selChannelID
-			except:
-				print "GameWindow.__LoadChannelInfo - OpenError"
-				return -1, -1, -1
-
-		def __SeverInfo(self, channelNumber, mapIndex):
-			_chNum = int(channelNumber.strip())
-			_mapIdx = int(mapIndex.strip())
-
-			if _chNum == 99 or _mapIdx >= 10000:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.MOVE_CHANNEL_NOTICE % 0)
-			else:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.MOVE_CHANNEL_NOTICE % _chNum)
-
-			net.SetChannelNumber(_chNum) # 2019.09.02.owsap
-			net.SetMapIndex(_mapIdx)
-
-			# 2019.09.02.owsap - update server info
-			import serverInfo
-			loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
-			_svName = serverInfo.REGION_DICT[loadRegionID][loadServerID]["name"]
-			_chName = serverInfo.REGION_DICT[loadRegionID][loadServerID]["channel"]
-			net.SetServerInfo(("%s, %s " % (_svName, "CH0" if _chNum == 99 else _chName[_chNum]["name"])).strip())
-
-			self.interface.RefreshServerInfo()
-
-	def OnShopError(self, type):
-		try:
-			self.PopupMessage(localeInfo.SHOP_ERROR_DICT[type])
-		except KeyError:
-			self.PopupMessage(localeInfo.SHOP_ERROR_UNKNOWN % (type))
-
-	def OnSafeBoxError(self):
-		self.PopupMessage(localeInfo.SAFEBOX_ERROR)
-
-	def OnFishingSuccess(self, isFish, fishName):
-		chat.AppendChatWithDelay(chat.CHAT_TYPE_INFO, localeInfo.FISHING_SUCCESS(isFish, fishName), 2000)
-
-	# ADD_FISHING_MESSAGE
-	def OnFishingNotifyUnknown(self):
-		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.FISHING_UNKNOWN)
-
-	def OnFishingWrongPlace(self):
-		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.FISHING_WRONG_PLACE)
-
-	def OnCannotFishingRideMount(self, vid):
-		textTail.RegisterInfoTail(vid, localeInfo.CANNOT_FISHING_RIDE_MOUNT)
-	# END_OF_ADD_FISHING_MESSAGE
-
-	def OnFishingNotify(self, isFish, fishName):
-		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.FISHING_NOTIFY(isFish, fishName))
-
-	def OnFishingFailure(self):
-		chat.AppendChatWithDelay(chat.CHAT_TYPE_INFO, localeInfo.FISHING_FAILURE, 2000)
-
-	def OnCannotPickItem(self):
-		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GAME_CANNOT_PICK_ITEM)
-
-	# MINING
-	def OnCannotMining(self):
-		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GAME_CANNOT_MINING)
-	# END_OF_MINING
-
-	def OnCannotUseSkill(self, vid, type):
-		if localeInfo.USE_SKILL_ERROR_TAIL_DICT.has_key(type):
-			textTail.RegisterInfoTail(vid, localeInfo.USE_SKILL_ERROR_TAIL_DICT[type])
-
-		if localeInfo.USE_SKILL_ERROR_CHAT_DICT.has_key(type):
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_SKILL_ERROR_CHAT_DICT[type])
-
-	def OnCannotShotError(self, vid, type):
-		textTail.RegisterInfoTail(vid, localeInfo.SHOT_ERROR_TAIL_DICT.get(type, localeInfo.SHOT_ERROR_UNKNOWN % (type)))
-
-	## PointReset
-	def StartPointReset(self):
-		self.interface.OpenPointResetDialog()
-
-	## Shop
-	def StartShop(self, vid):
-		self.interface.OpenShopDialog(vid)
-
-	def EndShop(self):
-		self.interface.CloseShopDialog()
-
-	def RefreshShop(self):
-		self.interface.RefreshShopDialog()
-
-	def SetShopSellingPrice(self, Price):
-		pass
-
-	## Exchange
-	def StartExchange(self):
-		self.interface.StartExchange()
-
-	def EndExchange(self):
-		self.interface.EndExchange()
-
-	def RefreshExchange(self):
-		self.interface.RefreshExchange()
-
-	if app.WJ_ENABLE_TRADABLE_ICON:
-		def AddExchangeItemSlotIndex(self, idx):
-			self.interface.AddExchangeItemSlotIndex(idx)
-
-	## Party
-	# ÆÄÆ¼ °¡ÀÔ Á¦ÇÑ ½Ã°£¶§¹®¿¡ ¼öÁ¤.
-	if app.ENABLE_NEW_USER_CARE:
-		def RecvPartyInviteQuestion(self, leaderVID, leaderName):
-			partyInviteQuestionDialog = uiCommon.QuestionDialogWithTimeLimit()
-			partyInviteQuestionDialog.SetAcceptEvent(lambda arg=True: self.AnswerPartyInvite(arg))
-			partyInviteQuestionDialog.SetCancelEvent(lambda arg=False: self.AnswerPartyInvite(arg))
-			partyInviteQuestionDialog.Open(leaderName + localeInfo.PARTY_DO_YOU_JOIN, 10)
-			partyInviteQuestionDialog.SetTimeOverMsg(localeInfo.PARTY_ANSWER_TIMEOVER)
-			partyInviteQuestionDialog.SetCancelOnTimeOver()
-			partyInviteQuestionDialog.partyLeaderVID = leaderVID
-			self.partyInviteQuestionDialog = partyInviteQuestionDialog
-	else:
-		def RecvPartyInviteQuestion(self, leaderVID, leaderName):
-			partyInviteQuestionDialog = uiCommon.QuestionDialog()
-			partyInviteQuestionDialog.SetText(leaderName + localeInfo.PARTY_DO_YOU_JOIN)
-			partyInviteQuestionDialog.SetAcceptEvent(lambda arg=True: self.AnswerPartyInvite(arg))
-			partyInviteQuestionDialog.SetCancelEvent(lambda arg=False: self.AnswerPartyInvite(arg))
-			partyInviteQuestionDialog.Open()
-			partyInviteQuestionDialog.partyLeaderVID = leaderVID
-			self.partyInviteQuestionDialog = partyInviteQuestionDialog
-
-	def AnswerPartyInvite(self, answer):
-		if not self.partyInviteQuestionDialog:
-			return
-
-		partyLeaderVID = self.partyInviteQuestionDialog.partyLeaderVID
-
-		# ÆÄÆ¼°¡ÀÔ¿¡ ´ëÇÑ °Å¸® Á¦ÇÑ »èÁ¦.
-		if not app.ENABLE_NEW_USER_CARE:
-			distance = player.GetCharacterDistance(partyLeaderVID)
-			if distance < 0.0 or distance > 5000:
-				answer = False
-
-		net.SendPartyInviteAnswerPacket(partyLeaderVID, answer)
-
-		self.partyInviteQuestionDialog.Close()
-		self.partyInviteQuestionDialog = None
-
-	if app.WJ_SHOW_PARTY_ON_MINIMAP and app.ENABLE_PARTY_CHANNEL_FIX:
-		def AddPartyMember(self, pid, name, mapIdx, channel):
-			self.interface.AddPartyMember(pid, name, mapIdx, channel)
-	elif app.WJ_SHOW_PARTY_ON_MINIMAP:
-		def AddPartyMember(self, pid, name, mapIdx):
-			self.interface.AddPartyMember(pid, name, mapIdx)
-	else:
-		def AddPartyMember(self, pid, name):
-			self.interface.AddPartyMember(pid, name)
-
-	def UpdatePartyMemberInfo(self, pid):
-		self.interface.UpdatePartyMemberInfo(pid)
-
-	def RemovePartyMember(self, pid):
-		self.interface.RemovePartyMember(pid)
-		self.__RefreshTargetBoard()
-
-	if app.WJ_SHOW_PARTY_ON_MINIMAP and app.ENABLE_PARTY_CHANNEL_FIX:
-		def LinkPartyMember(self, pid, vid, mapIdx, channel):
-			self.interface.LinkPartyMember(pid, vid, mapIdx, channel)
-	elif app.WJ_SHOW_PARTY_ON_MINIMAP:
-		def LinkPartyMember(self, pid, vid, mapIdx):
-			self.interface.LinkPartyMember(pid, vid, mapIdx)
-	else:
-		def LinkPartyMember(self, pid, vid):
-			self.interface.LinkPartyMember(pid, vid)
-
-	def UnlinkPartyMember(self, pid):
-		self.interface.UnlinkPartyMember(pid)
-
-	def UnlinkAllPartyMember(self):
-		self.interface.UnlinkAllPartyMember()
-
-	def ExitParty(self):
-		self.interface.ExitParty()
-		self.RefreshTargetBoardByVID(self.targetBoard.GetTargetVID())
-
-	def ChangePartyParameter(self, distributionMode):
-		self.interface.ChangePartyParameter(distributionMode)
-
-	## Messenger
-	def OnMessengerAddFriendQuestion(self, name):
-		messengerAddFriendQuestion = uiCommon.QuestionDialog2()
-		messengerAddFriendQuestion.SetText1(localeInfo.MESSENGER_DO_YOU_ACCEPT_ADD_FRIEND_1 % (name))
-		messengerAddFriendQuestion.SetText2(localeInfo.MESSENGER_DO_YOU_ACCEPT_ADD_FRIEND_2)
-		messengerAddFriendQuestion.SetAcceptEvent(ui.__mem_func__(self.OnAcceptAddFriend))
-		messengerAddFriendQuestion.SetCancelEvent(ui.__mem_func__(self.OnDenyAddFriend))
-		messengerAddFriendQuestion.Open()
-		messengerAddFriendQuestion.name = name
-		self.messengerAddFriendQuestion = messengerAddFriendQuestion
-
-	def OnAcceptAddFriend(self):
-		name = self.messengerAddFriendQuestion.name
-		net.SendCommandPacket("/messenger_auth y " + name)
-		self.OnCloseAddFriendQuestionDialog()
-		return True
-
-	def OnDenyAddFriend(self):
-		name = self.messengerAddFriendQuestion.name
-		net.SendCommandPacket("/messenger_auth n " + name)
-		self.OnCloseAddFriendQuestionDialog()
-		return True
-
-	def OnCloseAddFriendQuestionDialog(self):
-		self.messengerAddFriendQuestion.Close()
-		self.messengerAddFriendQuestion = None
-		return True
-
-	## SafeBox
-	def OpenSafeboxWindow(self, size):
-		self.interface.OpenSafeboxWindow(size)
-
-	def RefreshSafebox(self):
-		self.interface.RefreshSafebox()
-
-	def RefreshSafeboxMoney(self):
-		self.interface.RefreshSafeboxMoney()
-
-	# ITEM_MALL
-	def OpenMallWindow(self, size):
-		self.interface.OpenMallWindow(size)
-
-	def RefreshMall(self):
-		self.interface.RefreshMall()
-	# END_OF_ITEM_MALL
-
-	## Guild
-	def RecvGuildInviteQuestion(self, guildID, guildName):
-		guildInviteQuestionDialog = uiCommon.QuestionDialog()
-		guildInviteQuestionDialog.SetText(guildName + localeInfo.GUILD_DO_YOU_JOIN)
-		guildInviteQuestionDialog.SetAcceptEvent(lambda arg=True: self.AnswerGuildInvite(arg))
-		guildInviteQuestionDialog.SetCancelEvent(lambda arg=False: self.AnswerGuildInvite(arg))
-		guildInviteQuestionDialog.Open()
-		guildInviteQuestionDialog.guildID = guildID
-		self.guildInviteQuestionDialog = guildInviteQuestionDialog
-
-	def AnswerGuildInvite(self, answer):
-		if not self.guildInviteQuestionDialog:
-			return
-
-		guildLeaderVID = self.guildInviteQuestionDialog.guildID
-		net.SendGuildInviteAnswerPacket(guildLeaderVID, answer)
-
-		self.guildInviteQuestionDialog.Close()
-		self.guildInviteQuestionDialog = None
-
-	def DeleteGuild(self):
-		self.interface.DeleteGuild()
-
-	## Clock
-	def ShowClock(self, second):
-		self.interface.ShowClock(second)
-
-	def HideClock(self):
-		self.interface.HideClock()
-
-	def UseInventoryItemInQuickSlot(self, global_slot_index):
-		self.interface.UseInventoryItemInQuickSlot(global_slot_index)
-
-	## Emotion
-	def BINARY_ActEmotion(self, emotionIndex):
-		if self.interface.wndCharacter:
-			self.interface.wndCharacter.ActEmotion(emotionIndex)
-
-	###############################################################################################
-	###############################################################################################
-	## Keyboard Functions
-
-	def CheckFocus(self):
-		if False == self.IsFocus():
-			if True == self.interface.IsOpenChat():
-				self.interface.ToggleChat()
-
-			self.SetFocus()
-
-	def SaveScreen(self):
-		print "save screen"
-
-		# SCREENSHOT_CWDSAVE
-		if SCREENSHOT_CWDSAVE:
-			if not os.path.exists(os.getcwd() + os.sep + "screenshot"):
-				os.mkdir(os.getcwd() + os.sep + "screenshot")
-
-			(succeeded, name) = grp.SaveScreenShotToPath(os.getcwd()+os.sep+"screenshot"+os.sep)
-		elif SCREENSHOT_DIR:
-			(succeeded, name) = grp.SaveScreenShot(SCREENSHOT_DIR)
-		else:
-			(succeeded, name) = grp.SaveScreenShot()
-		# END_OF_SCREENSHOT_CWDSAVE
-
-		if succeeded:
-			pass
-			"""
-			chat.AppendChat(chat.CHAT_TYPE_INFO, name + localeInfo.SCREENSHOT_SAVE1)
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.SCREENSHOT_SAVE2)
-			"""
-		else:
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.SCREENSHOT_SAVE_FAILURE)
-
-	def ShowConsole(self):
-		if debugInfo.IsDebugMode() or True == self.consoleEnable:
-			player.EndKeyWalkingImmediately()
-			self.console.OpenWindow()
-
-	def ShowName(self):
-		self.ShowNameFlag = True
-		self.playerGauge.EnableShowAlways()
-		if not app.ENABLE_KEYCHANGE_SYSTEM:
-			player.SetQuickPage(self.quickSlotPageIndex + 1)
-
-	# ADD_ALWAYS_SHOW_NAME
-	def __IsShowName(self):
-		if systemSetting.IsAlwaysShowName():
-			return True
-
-		if self.ShowNameFlag:
-			return True
-
-		return False
-	# END_OF_ADD_ALWAYS_SHOW_NAME
-
-	def HideName(self):
-		self.ShowNameFlag = False
-		self.playerGauge.DisableShowAlways()
-		if not app.ENABLE_KEYCHANGE_SYSTEM:
-			player.SetQuickPage(self.quickSlotPageIndex)
-
-	def ShowMouseImage(self):
-		self.interface.ShowMouseImage()
-
-	def HideMouseImage(self):
-		self.interface.HideMouseImage()
-
-	def StartAttack(self):
-		player.SetAttackKeyState(True)
-
-	def EndAttack(self):
-		player.SetAttackKeyState(False)
-
-	def MoveUp(self):
-		player.SetSingleDIKKeyState(app.DIK_UP, True)
-
-	def MoveDown(self):
-		player.SetSingleDIKKeyState(app.DIK_DOWN, True)
-
-	def MoveLeft(self):
-		player.SetSingleDIKKeyState(app.DIK_LEFT, True)
-
-	def MoveRight(self):
-		player.SetSingleDIKKeyState(app.DIK_RIGHT, True)
-
-	def StopUp(self):
-		player.SetSingleDIKKeyState(app.DIK_UP, False)
-
-	def StopDown(self):
-		player.SetSingleDIKKeyState(app.DIK_DOWN, False)
-
-	def StopLeft(self):
-		player.SetSingleDIKKeyState(app.DIK_LEFT, False)
-
-	def StopRight(self):
-		player.SetSingleDIKKeyState(app.DIK_RIGHT, False)
-
-	def PickUpItem(self):
-		player.PickCloseItem()
-
-	###############################################################################################
-	###############################################################################################
-	## Event Handler
-
-	def OnKeyDown(self, key):
-		if self.interface.wndWeb and self.interface.wndWeb.IsShow():
-			return
-
-		if app.ENABLE_POPUP_NOTICE:
-			if self.interface.wndPopupNotice and self.interface.wndPopupNotice.IsShow():
-				return
-
-		if key == app.DIK_ESC:
-			self.RequestDropItem(False)
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-		try:
-			if app.ENABLE_KEYCHANGE_SYSTEM:
-				if self.wndKeyChange.IsOpen() == 1:
-					## Å°¼³Á¤ Ã¢ÀÌ ¿­·ÈÀ»¶§. ±×¸®°í ¹¹¸¦ ¹Ù²ÜÁö ¼±ÅÃÇßÀ»¶§
-					if self.wndKeyChange.IsSelectKeySlot():
-						if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
-							if self.wndKeyChange.IsChangeKey(self.wndKeyChange.GetSelectSlotNumber()):
-								self.wndKeyChange.ChangeKey(key + app.DIK_LCONTROL + self.ADDKEYBUFFERCONTROL)
-							else:
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.KEYCHANGE_IMPOSSIBLE_CHANGE)
-						elif app.IsPressed(app.DIK_LALT) or app.IsPressed(app.DIK_RALT):
-							if self.wndKeyChange.IsChangeKey(self.wndKeyChange.GetSelectSlotNumber()):
-								self.wndKeyChange.ChangeKey(key + app.DIK_LALT + self.ADDKEYBUFFERALT)
-							else:
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.KEYCHANGE_IMPOSSIBLE_CHANGE)
-						elif app.IsPressed(app.DIK_LSHIFT) or app.IsPressed(app.DIK_RSHIFT):
-							if self.wndKeyChange.IsChangeKey(self.wndKeyChange.GetSelectSlotNumber()):
-								self.wndKeyChange.ChangeKey(key + app.DIK_LSHIFT + self.ADDKEYBUFFERSHIFT)
-							else:
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.KEYCHANGE_IMPOSSIBLE_CHANGE)
-						else:
-							self.wndKeyChange.ChangeKey(key)
-				else:
-					player.OnKeyDown(key)
-			else:
-				self.onPressKeyDict[key]()
-		except KeyError:
-			pass
-		except:
-			raise
-
-		return True
-
-	def OnKeyUp(self, key):
-		if app.ENABLE_KEYCHANGE_SYSTEM:
-			player.OnKeyUp(key)
-		else:
-			try:
-				self.onClickKeyDict[key]()
-			except KeyError:
-				pass
-			except:
-				raise
-
-		return True
-
-	def OnMouseLeftButtonDown(self):
-		if self.interface.BUILD_OnMouseLeftButtonDown():
-			return
-
-		if mouseModule.mouseController.isAttached():
-			self.CheckFocus()
-		else:
-			hyperlink = ui.GetHyperlink()
-			if hyperlink:
-				return
-			else:
-				self.CheckFocus()
-				player.SetMouseState(player.MBT_LEFT, player.MBS_PRESS);
-
-		return True
-
-	def OnMouseLeftButtonUp(self):
-		if self.interface.BUILD_OnMouseLeftButtonUp():
-			return
-
-		if mouseModule.mouseController.isAttached():
-			attachedType = mouseModule.mouseController.GetAttachedType()
-			attachedItemIndex = mouseModule.mouseController.GetAttachedItemIndex()
-			attachedItemSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
-			attachedItemCount = mouseModule.mouseController.GetAttachedItemCount()
-
-			## QuickSlot
-			if player.SLOT_TYPE_QUICK_SLOT == attachedType:
-				player.RequestDeleteGlobalQuickSlot(attachedItemSlotPos)
-
-			## Inventory
-			elif player.SLOT_TYPE_INVENTORY == attachedType:
-				if player.ITEM_MONEY == attachedItemIndex:
-					# Note : ÀÎº¥ µ· ¼ÂÆÃ ÈÄ, ´Ù¸¥ À¯Àú Å¬¸¯ÇÏ¸é µé¾î¿À´Â ÇÔ¼ö
-					if app.ENABLE_CHEQUE_SYSTEM:
-						cheque = mouseModule.mouseController.GetCheque()
-						self.__PutMoney(attachedType, attachedItemCount, self.PickingCharacterIndex, cheque)
-					else:
-						self.__PutMoney(attachedType, attachedItemCount, self.PickingCharacterIndex)
-				else:
-					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
-
-			## DragonSoul
-			elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == attachedType:
-				self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				## ¹Ù´Ú¿¡ ¶³±ÉÀ»¶§ ¾Ç¼¼¼­¸®(Á¶ÇÕ,Èí¼ö) ¾ÆÀÌÅÛ »©±â.
-				if player.SLOT_TYPE_ACCE == attachedType:
-					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
-
-			if app.ENABLE_EXTEND_INVEN_SYSTEM:
-				if player.SLOT_TYPE_EQUIPMENT == attachedType or \
-					player.SLOT_TYPE_BELT_INVENTORY == attachedType:
-					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if player.SLOT_TYPE_CHANGE_LOOK == attachedType:
-					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
-
-			mouseModule.mouseController.DeattachObject()
-		else:
-			hyperlink = ui.GetHyperlink()
-			if hyperlink:
-				if app.IsPressed(app.DIK_LALT):
-					link = chat.GetLinkFromHyperlink(hyperlink)
-					#ime.PasteString(link)
-				else:
-					self.interface.MakeHyperlinkTooltip(hyperlink)
-				return
-			else:
-				player.SetMouseState(player.MBT_LEFT, player.MBS_CLICK)
-
-		# player.EndMouseWalking()
-		return True
-
-	def __PutItem(self, attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, dstChrID):
-		attachedInvenType = player.SlotTypeToInvenType(attachedType)
-
-		if player.INVENTORY == attachedInvenType or \
-			player.DRAGON_SOUL_INVENTORY == attachedInvenType or \
-			player.EQUIPMENT == attachedInvenType or \
-			player.BELT_INVENTORY == attachedInvenType:
-
-			if True == chr.HasInstance(self.PickingCharacterIndex) and player.GetMainCharacterIndex() != dstChrID:
-				if player.IsEquipmentSlot(attachedInvenType, attachedItemSlotPos):
-					self.stream.popupWindow.Close()
-					self.stream.popupWindow.Open(localeInfo.EXCHANGE_FAILURE_EQUIP_ITEM, 0, localeInfo.UI_OK)
-				else:
-					if app.ENABLE_GUILD_DRAGONLAIR_SYSTEM:
-						if chr.IsNPC(dstChrID) or chr.IsStone(dstChrID):
-							net.SendGiveItemPacket(dstChrID, attachedInvenType, attachedItemSlotPos, attachedItemCount)
-						else:
-							net.SendExchangeStartPacket(dstChrID)
-							net.SendExchangeItemAddPacket(attachedInvenType, attachedItemSlotPos, 0)
-							if app.ENABLE_REFINE_RENEWAL:
-								constInfo.AUTO_REFINE_TYPE = 2
-								constInfo.AUTO_REFINE_DATA["NPC"][0] = dstChrID
-								constInfo.AUTO_REFINE_DATA["NPC"][1] = attachedInvenType
-								constInfo.AUTO_REFINE_DATA["NPC"][2] = attachedItemSlotPos
-								constInfo.AUTO_REFINE_DATA["NPC"][3] = attachedItemCount
-					else:
-						if chr.IsNPC(dstChrID):
-							net.SendGiveItemPacket(dstChrID, attachedInvenType, attachedItemSlotPos, attachedItemCount)
-						else:
-							net.SendExchangeStartPacket(dstChrID)
-							net.SendExchangeItemAddPacket(attachedInvenType, attachedItemSlotPos, 0)
-							if app.ENABLE_REFINE_RENEWAL:
-								constInfo.AUTO_REFINE_TYPE = 2
-								constInfo.AUTO_REFINE_DATA["NPC"][0] = dstChrID
-								constInfo.AUTO_REFINE_DATA["NPC"][1] = attachedInvenType
-								constInfo.AUTO_REFINE_DATA["NPC"][2] = attachedItemSlotPos
-								constInfo.AUTO_REFINE_DATA["NPC"][3] = attachedItemCount
-			else:
-				self.__DropItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount)
-
-		if app.ENABLE_ACCE_COSTUME_SYSTEM:
-			## ¹Ù´Ú¿¡ ¶³±ÉÀ»¶§ ¾Ç¼¼¼­¸®(Á¶ÇÕ,Èí¼ö) ¾ÆÀÌÅÛ »©±â.
-			if player.SLOT_TYPE_ACCE == attachedType:
-				self.__DropItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount)
-
-		if app.ENABLE_CHANGE_LOOK_SYSTEM:
-			if player.SLOT_TYPE_CHANGE_LOOK == attachedType:
-				self.__DropItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount)
-
-	if app.ENABLE_CHEQUE_SYSTEM:
-		def __PutMoney(self, attachedType, attachedMoney, dstChrID, cheque):
-			if True == chr.HasInstance(dstChrID) and player.GetMainCharacterIndex() != dstChrID:
-				net.SendExchangeStartPacket(dstChrID)
-				net.SendExchangeElkAddPacket(attachedMoney)
-				net.SendExchangeChequeAddPacket(cheque)
-			else:
-				self.stream.popupWindow.Close()
-				self.stream.popupWindow.Open(localeInfo.CHEQUE_SYSTEM_DO_NOT_DROP_MONEY, 0, localeInfo.UI_OK)
-	else:
-		def __PutMoney(self, attachedType, attachedMoney, dstChrID):
-			if True == chr.HasInstance(dstChrID) and player.GetMainCharacterIndex() != dstChrID:
-				net.SendExchangeStartPacket(dstChrID)
-				net.SendExchangeElkAddPacket(attachedMoney)
-			else:
-				self.__DropMoney(attachedType, attachedMoney)
-
-	def __DropMoney(self, attachedType, attachedMoney):
-		# PRIVATESHOP_DISABLE_ITEM_DROP - °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ ¹ö¸² ¹æÁö
-		if uiPrivateShopBuilder.IsBuildingPrivateShop():
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
-			return
-		# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
-
-		if attachedMoney >= 1000:
-			self.stream.popupWindow.Close()
-			self.stream.popupWindow.Open(localeInfo.DROP_MONEY_FAILURE_1000_OVER, 0, localeInfo.UI_OK)
-			return
-
-		itemDropQuestionDialog = uiCommon.QuestionDialog()
-		itemDropQuestionDialog.SetText(localeInfo.DO_YOU_DROP_MONEY % (attachedMoney))
-		itemDropQuestionDialog.SetAcceptEvent(lambda arg=True: self.RequestDropItem(arg))
-		itemDropQuestionDialog.SetCancelEvent(lambda arg=False: self.RequestDropItem(arg))
-		itemDropQuestionDialog.Open()
-		itemDropQuestionDialog.dropType = attachedType
-		itemDropQuestionDialog.dropCount = attachedMoney
-		itemDropQuestionDialog.dropNumber = player.ITEM_MONEY
-		self.itemDropQuestionDialog = itemDropQuestionDialog
-
-	def __DropItem(self, attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount):
-		# PRIVATESHOP_DISABLE_ITEM_DROP - °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ ¹ö¸² ¹æÁö
-		if uiPrivateShopBuilder.IsBuildingPrivateShop():
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
-			return
-		# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
-
-		window_type = player.SlotTypeToInvenType(attachedType)
-
-		if player.IsEquipmentSlot(window_type, attachedItemSlotPos):
-			self.stream.popupWindow.Close()
-			self.stream.popupWindow.Open(localeInfo.DROP_ITEM_FAILURE_EQUIP_ITEM, 0, localeInfo.UI_OK)
-
-		else:
-			if player.SLOT_TYPE_INVENTORY == attachedType or\
-				player.SLOT_TYPE_BELT_INVENTORY == attachedType:
-
-				dropItemIndex = player.GetItemIndex(window_type, attachedItemSlotPos)
-
-				item.SelectItem(dropItemIndex)
-				dropItemName = item.GetItemName()
-				if app.ENABLE_SET_ITEM:
-					dropItemName = item.GetItemNameBySetValue(player.GetItemSetValue(window_type, attachedItemSlotPos))
-
-				## Question Text
-				questionText = localeInfo.HOW_MANY_ITEM_DO_YOU_DROP(dropItemName, attachedItemCount)
-
-				## Dialog
-				if app.ENABLE_NEW_DROP_DIALOG:
-					itemDropQuestionDialog = uiCommon.QuestionDropDialog()
-					itemDropQuestionDialog.SetText(questionText)
-					itemDropQuestionDialog.SetItemSlot(window_type, attachedItemSlotPos)
-					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
-					itemDropQuestionDialog.SetDestroyEvent(ui.__mem_func__(self.RequestDestroyItem))
-					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
-				else:
-					itemDropQuestionDialog = uiCommon.QuestionDialog()
-					itemDropQuestionDialog.SetText(questionText)
-					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
-					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
-
-				itemDropQuestionDialog.Open()
-				itemDropQuestionDialog.dropType = attachedType
-				itemDropQuestionDialog.dropNumber = attachedItemSlotPos
-				itemDropQuestionDialog.dropCount = attachedItemCount
-				self.itemDropQuestionDialog = itemDropQuestionDialog
-
-				constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-
-			elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == attachedType:
-				dropItemIndex = player.GetItemIndex(player.DRAGON_SOUL_INVENTORY, attachedItemSlotPos)
-
-				item.SelectItem(dropItemIndex)
-				dropItemName = item.GetItemName()
-
-				## Question Text
-				questionText = localeInfo.HOW_MANY_ITEM_DO_YOU_DROP(dropItemName, attachedItemCount)
-
-				## Dialog
-				if app.ENABLE_NEW_DROP_DIALOG:
-					itemDropQuestionDialog = uiCommon.QuestionDropDialog()
-					itemDropQuestionDialog.SetText(questionText)
-					itemDropQuestionDialog.SetItemSlot(window_type, attachedItemSlotPos)
-					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
-					itemDropQuestionDialog.SetDestroyEvent(ui.__mem_func__(self.RequestDestroyItem))
-					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
-				else:
-					itemDropQuestionDialog = uiCommon.QuestionDialog()
-					itemDropQuestionDialog.SetText(questionText)
-					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
-					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
-
-				itemDropQuestionDialog.Open()
-				itemDropQuestionDialog.dropType = attachedType
-				itemDropQuestionDialog.dropNumber = attachedItemSlotPos
-				itemDropQuestionDialog.dropCount = attachedItemCount
-				self.itemDropQuestionDialog = itemDropQuestionDialog
-
-				constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				## ¹Ù´Ú¿¡ ¶³±ÉÀ»¶§ ¾Ç¼¼¼­¸®(Á¶ÇÕ,Èí¼ö) ¾ÆÀÌÅÛ »©±â.
-				if player.SLOT_TYPE_ACCE == attachedType:
-					net.SendAcceRefineCheckOut(attachedItemSlotPos)
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if player.SLOT_TYPE_CHANGE_LOOK == attachedType:
-					net.SendChangeLookCheckOut(attachedItemSlotPos)
-
-	def RequestDropItem(self, answer):
-		if not self.itemDropQuestionDialog:
-			return
-
-		if answer:
-			dropType = self.itemDropQuestionDialog.dropType
-			dropCount = self.itemDropQuestionDialog.dropCount
-			dropNumber = self.itemDropQuestionDialog.dropNumber
-
-			if player.SLOT_TYPE_INVENTORY == dropType:
-				if dropNumber == player.ITEM_MONEY:
-					net.SendGoldDropPacketNew(dropCount)
-					snd.PlaySound("sound/ui/money.wav")
-				else:
-					# PRIVATESHOP_DISABLE_ITEM_DROP
-					self.__SendDropItemPacket(dropNumber, dropCount)
-					# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
-
-			elif player.SLOT_TYPE_BELT_INVENTORY == dropType:
-				self.__SendDropItemPacket(dropNumber, dropCount, player.BELT_INVENTORY)
-
-			elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == dropType:
-				# PRIVATESHOP_DISABLE_ITEM_DROP
-				self.__SendDropItemPacket(dropNumber, dropCount, player.DRAGON_SOUL_INVENTORY)
-				# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
-
-		self.itemDropQuestionDialog.Close()
-		self.itemDropQuestionDialog = None
-
-		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-	if app.ENABLE_NEW_DROP_DIALOG:
-		def RequestDestroyItem(self):
-			if not self.itemDropQuestionDialog:
-				return
-
-			itemDestroyQuestionDialog = uiCommon.QuestionDialogWithTimeLimit()
-			itemDestroyQuestionDialog.SetAcceptEvent(lambda arg=True: self.__ConfirmDestroyItem(arg))
-			itemDestroyQuestionDialog.SetCancelEvent(lambda arg=False: self.__ConfirmDestroyItem(arg))
-			itemDestroyQuestionDialog.Open(localeInfo.DESTROY_ITEM_CONFIRM, 3)
-			itemDestroyQuestionDialog.SetCancelOnTimeOver()
-			self.itemDestroyQuestionDialog = itemDestroyQuestionDialog
-
-		def __ConfirmDestroyItem(self, arg):
-			if not self.itemDropQuestionDialog or not self.itemDestroyQuestionDialog:
-				return
-
-			if arg:
-				dropType = self.itemDropQuestionDialog.dropType
-				dropNumber = self.itemDropQuestionDialog.dropNumber
-
-				if player.SLOT_TYPE_INVENTORY == dropType:
-					if dropNumber == player.ITEM_MONEY:
-						return
-					else:
-						self.__SendDestroyItemPacket(dropNumber)
-
-				elif player.SLOT_TYPE_BELT_INVENTORY == dropType:
-					self.__SendDestroyItemPacket(dropNumber, player.BELT_INVENTORY)
-
-				elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == dropType:
-					self.__SendDestroyItemPacket(dropNumber, player.DRAGON_SOUL_INVENTORY)
-
-			self.itemDestroyQuestionDialog.Close()
-			self.itemDestroyQuestionDialog = None
-
-			self.itemDropQuestionDialog.Close()
-			self.itemDropQuestionDialog = None
-
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-		def __SendDestroyItemPacket(self, itemInvenPos, itemInvenType = player.INVENTORY):
-			if uiPrivateShopBuilder.IsBuildingPrivateShop():
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
-				return
-
-			net.SendItemDestroyPacket(itemInvenType, itemInvenPos)
-
-	# PRIVATESHOP_DISABLE_ITEM_DROP
-	def __SendDropItemPacket(self, itemInvenPos, itemCount, itemInvenType = player.INVENTORY):
-		if uiPrivateShopBuilder.IsBuildingPrivateShop():
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
-			return
-
-		net.SendItemDropPacketNew(itemInvenType, itemInvenPos, itemCount)
-	# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
-
-	def OnMouseRightButtonDown(self):
-		self.CheckFocus()
-
-		if True == mouseModule.mouseController.isAttached():
-			mouseModule.mouseController.DeattachObject()
-		else:
-			player.SetMouseState(player.MBT_RIGHT, player.MBS_PRESS)
-
-		return True
-
-	def OnMouseRightButtonUp(self):
-		if True == mouseModule.mouseController.isAttached():
-			return True
-
-		player.SetMouseState(player.MBT_RIGHT, player.MBS_CLICK)
-		return True
-
-	def OnMouseMiddleButtonDown(self):
-		player.SetMouseMiddleButtonState(player.MBS_PRESS)
-
-	def OnMouseMiddleButtonUp(self):
-		player.SetMouseMiddleButtonState(player.MBS_CLICK)
-
-	def OnUpdate(self):
-		app.UpdateGame()
-
-		if self.mapNameShower.IsShow():
-			self.mapNameShower.Update()
-
-		if self.isShowDebugInfo:
-			self.UpdateDebugInfo()
-
-		if self.enableXMasBoom:
-			self.__XMasBoom_Update()
-
-		self.interface.BUILD_OnUpdate()
-
-	def UpdateDebugInfo(self):
-		#
-		# Ä³¸¯ÅÍ ÁÂÇ¥ ¹× FPS Ãâ·Â
-		(x, y, z) = player.GetMainCharacterPosition()
-		nUpdateTime = app.GetUpdateTime()
-		nUpdateFPS = app.GetUpdateFPS()
-		nRenderFPS = app.GetRenderFPS()
-		nFaceCount = app.GetFaceCount()
-		fFaceSpeed = app.GetFaceSpeed()
-		nST = background.GetRenderShadowTime()
-		(fAveRT, nCurRT) = app.GetRenderTime()
-		(iNum, fFogStart, fFogEnd, fFarCilp) = background.GetDistanceSetInfo()
-		(iPatch, iSplat, fSplatRatio, sTextureNum) = background.GetRenderedSplatNum()
-		if iPatch == 0:
-			iPatch = 1
-
-		#(dwRenderedThing, dwRenderedCRC) = background.GetRenderedGraphicThingInstanceNum()
-
-		self.PrintCoord.SetText("Coordinate: %.2f %.2f %.2f ATM: %d" % (x, y, z, app.GetAvailableTextureMemory()/(1024*1024)))
-		xMouse, yMouse = wndMgr.GetMousePosition()
-		self.PrintMousePos.SetText("MousePosition: %d %d" % (xMouse, yMouse))
-
-		self.FrameRate.SetText("UFPS: %3d UT: %3d FS %.2f" % (nUpdateFPS, nUpdateTime, fFaceSpeed))
-
-		if fAveRT>1.0:
-			self.Pitch.SetText("RFPS: %3d RT:%.2f(%3d) FC: %d(%.2f) " % (nRenderFPS, fAveRT, nCurRT, nFaceCount, nFaceCount/fAveRT))
-
-		self.Splat.SetText("PATCH: %d SPLAT: %d BAD(%.2f)" % (iPatch, iSplat, fSplatRatio))
-		# self.Pitch.SetText("Pitch: %.2f" % (app.GetCameraPitch())
-		# self.TextureNum.SetText("TN : %s" % (sTextureNum))
-		# self.ObjectNum.SetText("GTI : %d, CRC : %d" % (dwRenderedThing, dwRenderedCRC))
-		self.ViewDistance.SetText("Num : %d, FS : %f, FE : %f, FC : %f" % (iNum, fFogStart, fFogEnd, fFarCilp))
-
-	def OnRender(self):
-		app.RenderGame()
-
-		if self.console.Console.collision:
-			background.RenderCollision()
-			chr.RenderCollision()
-
-		(x, y) = app.GetCursorPosition()
-
-		########################
-		# Picking
-		########################
-		textTail.UpdateAllTextTail()
-
-		if True == wndMgr.IsPickedWindow(self.hWnd):
-			self.PickingCharacterIndex = chr.Pick()
-
-			if -1 != self.PickingCharacterIndex:
-				textTail.ShowCharacterTextTail(self.PickingCharacterIndex)
-			if 0 != self.targetBoard.GetTargetVID():
-				textTail.ShowCharacterTextTail(self.targetBoard.GetTargetVID())
-
-			# ADD_ALWAYS_SHOW_NAME
-			if not self.__IsShowName():
-				self.PickingItemIndex = item.Pick()
-				if -1 != self.PickingItemIndex:
-					textTail.ShowItemTextTail(self.PickingItemIndex)
-			# END_OF_ADD_ALWAYS_SHOW_NAME
-
-		## Show all name in the range
-
-		# ADD_ALWAYS_SHOW_NAME
-		if self.__IsShowName():
-			textTail.ShowAllTextTail()
-			self.PickingItemIndex = textTail.Pick(x, y)
-		# END_OF_ADD_ALWAYS_SHOW_NAME
-
-		textTail.UpdateShowingTextTail()
-		textTail.ArrangeTextTail()
-		if -1 != self.PickingItemIndex:
-			textTail.SelectItemName(self.PickingItemIndex)
-
-		grp.PopState()
-		grp.SetInterfaceRenderState()
-
-		textTail.Render()
-		textTail.HideAllTextTail()
-
-	def OnPressEscapeKey(self):
-		if app.TARGET == app.GetCursor():
-			app.SetCursor(app.NORMAL)
-
-		elif True == mouseModule.mouseController.isAttached():
-			mouseModule.mouseController.DeattachObject()
-		else:
-			self.interface.OpenSystemDialog()
-
-		return True
-
-	def OnIMEReturn(self):
-		if app.IsPressed(app.DIK_LSHIFT):
-			self.interface.OpenWhisperDialogWithoutTarget()
-		else:
-			self.interface.ToggleChat()
-		return True
-
-	def OnPressExitKey(self):
-		self.interface.ToggleSystemDialog()
-		return True
-
-	## BINARY CALLBACK
-	######################################################################################
-
-	# WEDDING
-	def BINARY_LoverInfo(self, name, lovePoint):
-		if self.interface.wndMessenger:
-			self.interface.wndMessenger.OnAddLover(name, lovePoint)
-		if self.affectShower:
-			self.affectShower.SetLoverInfo(name, lovePoint)
-
-	def BINARY_UpdateLovePoint(self, lovePoint):
-		if self.interface.wndMessenger:
-			self.interface.wndMessenger.OnUpdateLovePoint(lovePoint)
-		if self.affectShower:
-			self.affectShower.OnUpdateLovePoint(lovePoint)
-	# END_OF_WEDDING
-
-	if app.ENABLE_SEND_TARGET_INFO:
-		def BINARY_RefreshTargetMonsterDropInfo(self, raceNum):
-			self.targetBoard.RefreshMonsterInfoBoard()
-
-	# QUEST_CONFIRM
-	def BINARY_OnQuestConfirm(self, msg, timeout, pid):
-		confirmDialog = uiCommon.QuestionDialogWithTimeLimit()
-		confirmDialog.Open(msg, timeout)
-		confirmDialog.SetAcceptEvent(lambda answer=True, pid=pid: net.SendQuestConfirmPacket(answer, pid) or self.confirmDialog.Hide())
-		confirmDialog.SetCancelEvent(lambda answer=False, pid=pid: net.SendQuestConfirmPacket(answer, pid) or self.confirmDialog.Hide())
-		self.confirmDialog = confirmDialog
-	# END_OF_QUEST_CONFIRM
-
-	# GIFT command
-	def Gift_Show(self):
-		self.interface.ShowGift()
-
-	def Gift_Hide(self):
-		self.interface.HideGift()
-
-	# CUBE
-	if app.ENABLE_CUBE_RENEWAL:
-		def BINARY_Cube_Open(self, npc_vnum):
-			self.interface.OpenCubeWindow(npc_vnum)
-
-		def BINARY_Cube_Close(self):
-			self.interface.CloseCubeWindow()
-
-		def BINARY_Cube_Result(self, is_success):
-			self.interface.CubeResult(is_success)
-	else:
-		def BINARY_Cube_Open(self, npcVNUM, reload = 0):
-			self.currentCubeNPC = npcVNUM
-
-			if reload:
-				self.cubeInformation.clear()
-				self.interface.wndCube.ClearOldSlots()
-
-			self.interface.OpenCubeWindow()
-
-			if npcVNUM not in self.cubeInformation:
-				net.SendCommandPacket("/cube r_info")
-			else:
-				cubeInfoList = self.cubeInformation[npcVNUM]
-
-				i = 0
-				for cubeInfo in cubeInfoList:
-					self.interface.wndCube.AddCubeResultItem(cubeInfo["vnum"], cubeInfo["count"])
-
-					j = 0
-					for materialList in cubeInfo["materialList"]:
-						for materialInfo in materialList:
-							itemVnum, itemCount = materialInfo
-							self.interface.wndCube.AddMaterialInfo(i, j, itemVnum, itemCount)
-						j = j + 1
-
-					i = i + 1
-
-				self.interface.wndCube.Refresh()
-
-		def BINARY_Cube_Close(self):
-			self.interface.CloseCubeWindow()
-
-		# Á¦ÀÛ¿¡ ÇÊ¿äÇÑ °ñµå, ¿¹»óµÇ´Â ¿Ï¼ºÇ°ÀÇ VNUM°ú °³¼ö Á¤º¸ update
-		def BINARY_Cube_UpdateInfo(self, gold, itemVnum, count):
-			self.interface.UpdateCubeInfo(gold, itemVnum, count)
-
-		def BINARY_Cube_Succeed(self, itemVnum, count):
-			print "Å¥ºê Á¦ÀÛ ¼º°ø"
-			self.interface.SucceedCubeWork(itemVnum, count)
-			pass
-
-		def BINARY_Cube_Failed(self):
-			print "Å¥ºê Á¦ÀÛ ½ÇÆÐ"
-			self.interface.FailedCubeWork()
-			pass
-
-		def BINARY_Cube_ResultList(self, npcVNUM, listText):
-			# ResultList Text Format : 72723,1/72725,1/72730.1/50001,5 ÀÌ·±½ÄÀ¸·Î "/" ¹®ÀÚ·Î ±¸ºÐµÈ ¸®½ºÆ®¸¦ ÁÜ
-			#print listText
-
-			if npcVNUM == 0:
-				npcVNUM = self.currentCubeNPC
-
-			self.cubeInformation[npcVNUM] = []
-
-			try:
-				for eachInfoText in listText.split("/"):
-					eachInfo = eachInfoText.split(",")
-					itemVnum = int(eachInfo[0])
-					itemCount = int(eachInfo[1])
-
-					self.cubeInformation[npcVNUM].append({"vnum": itemVnum, "count": itemCount})
-					self.interface.wndCube.AddCubeResultItem(itemVnum, itemCount)
-
-				resultCount = len(self.cubeInformation[npcVNUM])
-				requestCount = 5
-				modCount = resultCount % requestCount
-				splitCount = resultCount / requestCount
-				for i in xrange(splitCount):
-					#print("/cube r_info %d %d" % (i * requestCount, requestCount))
-					net.SendCommandPacket("/cube r_info %d %d" % (i * requestCount, requestCount))
-
-				if 0 < modCount:
-					#print("/cube r_info %d %d" % (splitCount * requestCount, modCount))
-					net.SendCommandPacket("/cube r_info %d %d" % (splitCount * requestCount, modCount))
-
-			except RuntimeError, msg:
-				dbg.TraceError(msg)
-				return 0
-
-			pass
-
-		def BINARY_Cube_MaterialInfo(self, startIndex, listCount, listText):
-			# Material Text Format : 125,1|126,2|127,2|123,5&555,5&555,4/120000
-			try:
-				#print listText
-
-				if 3 > len(listText):
-					dbg.TraceError("Wrong Cube Material Infomation")
-					return 0
-
-				eachResultList = listText.split("@")
-
-				cubeInfo = self.cubeInformation[self.currentCubeNPC]
-
-				itemIndex = 0
-				for eachResultText in eachResultList:
-					cubeInfo[startIndex + itemIndex]["materialList"] = [[], [], [], [], []]
-					materialList = cubeInfo[startIndex + itemIndex]["materialList"]
-
-					gold = 0
-					splitResult = eachResultText.split("/")
-					if 1 < len(splitResult):
-						gold = int(splitResult[1])
-
-					#print "splitResult : ", splitResult
-					eachMaterialList = splitResult[0].split("&")
-
-					i = 0
-					for eachMaterialText in eachMaterialList:
-						complicatedList = eachMaterialText.split("|")
-
-						if 0 < len(complicatedList):
-							for complicatedText in complicatedList:
-								(itemVnum, itemCount) = complicatedText.split(",")
-								itemVnum = int(itemVnum)
-								itemCount = int(itemCount)
-								self.interface.wndCube.AddMaterialInfo(itemIndex + startIndex, i, itemVnum, itemCount)
-
-								materialList[i].append((itemVnum, itemCount))
-						else:
-							itemVnum, itemCount = eachMaterialText.split(",")
-							itemVnum = int(itemVnum)
-							itemCount = int(itemCount)
-							self.interface.wndCube.AddMaterialInfo(itemIndex + startIndex, i, itemVnum, itemCount)
-
-							materialList[i].append((itemVnum, itemCount))
-
-						i = i + 1
-
-					itemIndex = itemIndex + 1
-
-				self.interface.wndCube.Refresh()
-
-			except RuntimeError, msg:
-				dbg.TraceError(msg)
-				return 0
-
-			pass
-
-		# END_OF_CUBE
-
-	# ¿ëÈ¥¼®
-	def BINARY_Highlight_Item(self, inven_type, inven_pos):
-		self.interface.Highligt_Item(inven_type, inven_pos)
-
-	def BINARY_DragonSoulGiveQuilification(self):
-		self.interface.DragonSoulGiveQuilification()
-
-	if app.ENABLE_DS_CHANGE_ATTR:
-		def BINARY_DragonSoulRefineWindow_Open(self, type):
-			self.interface.OpenDragonSoulRefineWindow(type)
-	else:
-		def BINARY_DragonSoulRefineWindow_Open(self):
-			self.interface.OpenDragonSoulRefineWindow()
-
-	def BINARY_DragonSoulRefineWindow_RefineFail(self, reason, inven_type, inven_pos):
-		self.interface.FailDragonSoulRefine(reason, inven_type, inven_pos)
-
-	def BINARY_DragonSoulRefineWindow_RefineSucceed(self, inven_type, inven_pos):
-		self.interface.SucceedDragonSoulRefine(inven_type, inven_pos)
-
-	# END of DRAGON SOUL REFINE WINDOW
-
-	def BINARY_SetBigMessage(self, message):
-		self.interface.bigBoard.SetTip(message)
-
-	if app.ENABLE_OX_RENEWAL:
-		def BINARY_SetBigControlMessage(self, message):
-			self.interface.bigBoardControl.SetTip(message)
-
-	def BINARY_SetTipMessage(self, message):
-		self.interface.tipBoard.SetTip(message)
-
-	def BINARY_SetMissionMessage(self, message):
-		self.interface.missionBoard.SetMission(message)
-
-	def BINARY_SetSubMissionMessage(self, message):
-		self.interface.missionBoard.SetSubMission(message)
-
-	def BINARY_CleanMissionMessage(self):
-		self.interface.missionBoard.CleanMission()
-
-	def BINARY_AppendNotifyMessage(self, type):
-		if not type in localeInfo.NOTIFY_MESSAGE:
-			return
-
-		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.NOTIFY_MESSAGE[type])
-
-	def BINARY_Guild_EnterGuildArea(self, areaID):
-		self.interface.BULID_EnterGuildArea(areaID)
-
-	def BINARY_Guild_ExitGuildArea(self, areaID):
-		self.interface.BULID_ExitGuildArea(areaID)
-
-	def BINARY_GuildWar_OnSendDeclare(self, guildID):
-		pass
-
-	def BINARY_GuildWar_OnRecvDeclare(self, guildID, warType):
-		mainCharacterName = player.GetMainCharacterName()
-		masterName = guild.GetGuildMasterName()
-		if mainCharacterName == masterName:
-			self.__GuildWar_OpenAskDialog(guildID, warType)
-
-	def BINARY_GuildWar_OnRecvPoint(self, gainGuildID, opponentGuildID, point):
-		self.interface.OnRecvGuildWarPoint(gainGuildID, opponentGuildID, point)
-
-	def BINARY_GuildWar_OnStart(self, guildSelf, guildOpp):
-		self.interface.OnStartGuildWar(guildSelf, guildOpp)
-
-	def BINARY_GuildWar_OnEnd(self, guildSelf, guildOpp):
-		self.interface.OnEndGuildWar(guildSelf, guildOpp)
-
-	def BINARY_BettingGuildWar_SetObserverMode(self, isEnable):
-		self.interface.BINARY_SetObserverMode(isEnable)
-
-	def BINARY_BettingGuildWar_UpdateObserverCount(self, observerCount):
-		self.interface.wndMiniMap.UpdateObserverCount(observerCount)
-
-	def __GuildWar_UpdateMemberCount(self, guildID1, memberCount1, guildID2, memberCount2, observerCount):
-		guildID1 = int(guildID1)
-		guildID2 = int(guildID2)
-		memberCount1 = int(memberCount1)
-		memberCount2 = int(memberCount2)
-		observerCount = int(observerCount)
-
-		self.interface.UpdateMemberCount(guildID1, memberCount1, guildID2, memberCount2)
-		self.interface.wndMiniMap.UpdateObserverCount(observerCount)
-
-	def __GuildWar_OpenAskDialog(self, guildID, warType):
-		guildName = guild.GetGuildName(guildID)
-
-		# REMOVED_GUILD_BUG_FIX
-		if "Noname" == guildName:
-			return
-		# END_OF_REMOVED_GUILD_BUG_FIX
-
-		import uiGuild
-		questionDialog = uiGuild.AcceptGuildWarDialog()
-		questionDialog.SAFE_SetAcceptEvent(self.__GuildWar_OnAccept)
-		questionDialog.SAFE_SetCancelEvent(self.__GuildWar_OnDecline)
-		questionDialog.Open(guildName, warType)
-
-		self.guildWarQuestionDialog = questionDialog
-
-	def __GuildWar_CloseAskDialog(self):
-		self.guildWarQuestionDialog.Close()
-		self.guildWarQuestionDialog = None
-
-	def __GuildWar_OnAccept(self):
-		guildName = self.guildWarQuestionDialog.GetGuildName()
-
-		net.SendCommandPacket("/war " + guildName)
-		self.__GuildWar_CloseAskDialog()
-
-		return 1
-
-	def __GuildWar_OnDecline(self):
-		guildName = self.guildWarQuestionDialog.GetGuildName()
-
-		net.SendCommandPacket("/nowar " + guildName)
-		self.__GuildWar_CloseAskDialog()
-
-		return 1
-
-	## BINARY CALLBACK
-	######################################################################################
-
-	def __ServerCommand_Build(self):
-		serverCommandList = {
-			"ConsoleEnable" : self.__Console_Enable,
-			"DayMode" : self.__DayMode_Update,
-			"PRESERVE_DayMode" : self.__PRESERVE_DayMode_Update,
-			"CloseRestartWindow" : self.__RestartDialog_Close,
-			"OpenPrivateShop" : self.__PrivateShop_Open,
-			"PartyHealReady" : self.PartyHealReady,
-			"ShowMeSafeboxPassword" : self.AskSafeboxPassword,
-			"CloseSafebox" : self.CommandCloseSafebox,
-
-			# ITEM_MALL
-			"CloseMall" : self.CommandCloseMall,
-			"ShowMeMallPassword" : self.AskMallPassword,
-			"item_mall" : self.__ItemMall_Open,
-			# END_OF_ITEM_MALL
-
-			"RefineSuceeded" : self.RefineSuceededMessage,
-			"RefineFailed" : self.RefineFailedMessage,
-			"xmas_snow" : self.__XMasSnow_Enable,
-			"xmas_boom" : self.__XMasBoom_Enable,
-			"xmas_song" : self.__XMasSong_Enable,
-			"xmas_tree" : self.__XMasTree_Enable,
-			"newyear_boom" : self.__XMasBoom_Enable,
-			"PartyRequest" : self.__PartyRequestQuestion,
-			"PartyRequestDenied" : self.__PartyRequestDenied,
-			"horse_state" : self.__Horse_UpdateState,
-			"hide_horse_state" : self.__Horse_HideState,
-			"WarUC" : self.__GuildWar_UpdateMemberCount,
-			"test_server" : self.__EnableTestServerFlag,
-			"mall" : self.__InGameShop_Show,
-
-			# WEDDING
-			"lover_login" : self.__LoginLover,
-			"lover_logout" : self.__LogoutLover,
-			"lover_near" : self.__LoverNear,
-			"lover_far" : self.__LoverFar,
-			"lover_divorce" : self.__LoverDivorce,
-			"PlayMusic" : self.__PlayMusic,
-			# END_OF_WEDDING
-
-			# PRIVATE_SHOP_PRICE_LIST
-			"MyShopPriceList" : self.__PrivateShop_PriceList,
-			# END_OF_PRIVATE_SHOP_PRICE_LIST
-		}
-
-		#if app.ENABLE_ACCE_COSTUME_SYSTEM:
-		#	serverCommandList["ShowAcceCombineDialog"] = self.__AcceCombineDialog
-		#	serverCommandList["ShowAcceAbsorbDialog"] = self.__AcceAbsorbDialog
-
-		if app.ENABLE_MOVE_COSTUME_ATTR:
-			serverCommandList["ShowItemCombinationDialog"] = self.__ItemCombinationDialog
-
-		if app.ENABLE_MINI_GAME_RUMI:
-			serverCommandList["mini_game_okey"] = self.__MiniGameOkey
-			serverCommandList["mini_game_okey_normal"] = self.__MiniGameOkeyNormal
-
-		if app.ENABLE_MINI_GAME_CATCH_KING:
-			serverCommandList["mini_game_catchking"] = self.__MiniGameCatchKing
-
-		if app.ENABLE_CHANGE_LOOK_SYSTEM:
-			serverCommandList["ShowChangeDialog"] = self.__ChangeWindowOpen
-
-		serverCommandList.update({
-			"SetMissionMessage" : self.BINARY_SetMissionMessage,
-			"SetSubMissionMessage" : self.BINARY_SetSubMissionMessage,
-			"CleanMissionMessage" : self.BINARY_CleanMissionMessage,
-		})
-
-		serverCommandList["OpenCostumeWindow"] = self.OpenCostumeWindow
-
-		if app.ENABLE_MOVE_CHANNEL:
-			serverCommandList["server_info"] = self.__SeverInfo
-
-		if app.ENABLE_REFINE_MSG_ADD:
-			serverCommandList["RefineFailedType"] = self.__RefineFailedTypeMessage
-
-		if app.ENABLE_SKILLBOOK_COMB_SYSTEM:
-			serverCommandList["OpenSkillbookCombinationDialog"] = self.OpenSkillbookCombinationDialog
-
-		if app.ENABLE_MYSHOP_DECO:
-			serverCommandList["OpenMyShopDecoWnd"] = self.__OpenMyShopDecoWnd
-
-		if app.ENABLE_POPUP_NOTICE:
-			serverCommandList["PopupNoticeEventFlag"] = self.__SetPopupNoticeEventFlag
-			serverCommandList["PopupNoticeProcess"] = self.__PopupNoticeProcess
-
-		if app.ENABLE_MINI_GAME_YUTNORI:
-			serverCommandList["mini_game_yutnori"] = self.__MiniGameYutnori
-
-		if app.ENABLE_ATTR_6TH_7TH:
-			serverCommandList["__OpenAttr67AddDlg"] = self.__OpenAttr67AddDlg
-
-		if app.ENABLE_SOUL_SYSTEM:
-			serverCommandList["RefineSoulSuceeded"] = self.__RefineSoulSuceededMessage
-			serverCommandList["RefineSoulFailed"] = self.__RefineSoulFailedMessage
-
-		if app.ENABLE_SNOWFLAKE_STICK_EVENT:
-			serverCommandList["snowflake_stick_event"] = self.__SnowflakeStickEvent
-
-		if app.ENABLE_HIDE_COSTUME_SYSTEM:
-			serverCommandList["SetHiddenCostumePart"] = self.__SetHiddenCostumePart
-
-		if app.ENABLE_LEFT_SEAT:
-			serverCommandList["OpenLeftSeatDialog"] = self.OpenLeftSeatDialog
-			serverCommandList["CloseLeftSeatDialog"] = self.CloseLeftSeatDialog
-
-		if app.ENABLE_GUILD_DRAGONLAIR_SYSTEM:
-			serverCommandList["clear_guild_reddragonlair_ranking"] = self.__ClearGuildRedDragonLairRanking
-			serverCommandList["check_reddragonlairranking_board"] = self.__CheckRedDragonLairRanking
-
-		if app.ENABLE_SUMMER_EVENT_ROULETTE:
-			serverCommandList["e_late_summer"] = self.__LateSummerEvent
-
-		if app.ENABLE_FLOWER_EVENT:
-			serverCommandList["e_flower_drop"] = self.__FlowerEvent
-
-		self.serverCommander = stringCommander.Analyzer()
-		for serverCommandItem in serverCommandList.items():
-			self.serverCommander.SAFE_RegisterCallBack(
-				serverCommandItem[0], serverCommandItem[1]
-			)
-
-	if app.ENABLE_CHANGE_LOOK_SYSTEM:
-		def __ChangeWindowOpen(self, type):
-			self.interface.ChangeWindowOpen(type)
-
-	def BINARY_ServerCommand_Run(self, line):
-		#dbg.TraceError(line)
-		try:
-			#print " BINARY_ServerCommand_Run", line
-			return self.serverCommander.Run(line)
-		except RuntimeError, msg:
-			dbg.TraceError(msg)
-			return 0
-
-	def __ProcessPreservedServerCommand(self):
-		try:
-			command = net.GetPreservedServerCommand()
-			while command:
-				print " __ProcessPreservedServerCommand", command
-				self.serverCommander.Run(command)
-				command = net.GetPreservedServerCommand()
-		except RuntimeError, msg:
-			dbg.TraceError(msg)
-			return 0
-
-	def PartyHealReady(self):
-		self.interface.PartyHealReady()
-
-	def AskSafeboxPassword(self):
-		self.interface.AskSafeboxPassword()
-
-	if app.ENABLE_SKILLBOOK_COMB_SYSTEM:
-		def OpenSkillbookCombinationDialog(self):
-			self.interface.OpenSkillbookCombinationDialog()
-
-	# ITEM_MALL
-	def AskMallPassword(self):
-		self.interface.AskMallPassword()
-
-	def __ItemMall_Open(self):
-		self.interface.OpenItemMall();
-
-	def CommandCloseMall(self):
-		self.interface.CommandCloseMall()
-	# END_OF_ITEM_MALL
-
-	def RefineSuceededMessage(self):
-		snd.PlaySound("sound/ui/make_soket.wav")
-		self.PopupMessage(localeInfo.REFINE_SUCCESS)
-		if app.ENABLE_REFINE_RENEWAL:
-			self.interface.CheckRefineDialog(False)
-
-	def RefineFailedMessage(self):
-		snd.PlaySound("sound/ui/jaeryun_fail.wav")
-		self.PopupMessage(localeInfo.REFINE_FAILURE)
-		if app.ENABLE_REFINE_RENEWAL:
-			self.interface.CheckRefineDialog(True)
-
-	if app.ENABLE_SOUL_SYSTEM:
-		def __RefineSoulSuceededMessage(self):
-			snd.PlaySound("sound/ui/make_soket.wav")
-			self.PopupMessage(localeInfo.SOUL_REFINE_SUCCESS)
-
-		def __RefineSoulFailedMessage(self):
-			snd.PlaySound("sound/ui/jaeryun_fail.wav")
-			self.PopupMessage(localeInfo.SOUL_REFINE_FAILURE)
-
-	if app.ENABLE_REFINE_MSG_ADD:
-		def __RefineFailedTypeMessage(self, value):
-			snd.PlaySound("sound/ui/jaeryun_fail.wav")
-
-			value = int(value)
-			print "type : ", value
-			print type(value)
-
-			if REFINE_FAIL_GRADE_DOWN == value:
-				self.PopupMessage(localeInfo.REFINE_FAILURE_GRADE_DOWN)
-			elif REFINE_FAIL_DEL_ITEM == value:
-				self.PopupMessage(localeInfo.REFINE_FAILURE_DEL_ITEM)
-			elif REFINE_FAIL_KEEP_GRADE == value:
-				self.PopupMessage(localeInfo.REFINE_FAILURE_KEEP_GRADE)
-			else:
-				self.PopupMessage(localeInfo.REFINE_FAILURE)
-
-	def CommandCloseSafebox(self):
-		self.interface.CommandCloseSafebox()
-
-	# PRIVATE_SHOP_PRICE_LIST
-	def __PrivateShop_PriceList(self, itemVNum, itemPrice, itemCheque):
-		if app.ENABLE_CHEQUE_SYSTEM:
-			uiPrivateShopBuilder.SetPrivateShopItemPrice(itemVNum, itemPrice, itemCheque)
-		else:
-			uiPrivateShopBuilder.SetPrivateShopItemPrice(itemVNum, itemPrice)
-	# END_OF_PRIVATE_SHOP_PRICE_LIST
-
-	def __Horse_HideState(self):
-		self.affectShower.SetHorseState(0, 0, 0)
-
-	def __Horse_UpdateState(self, level, health, battery):
-		self.affectShower.SetHorseState(int(level), int(health), int(battery))
-
-	if app.ENABLE_CONQUEROR_LEVEL:
-		def BINARY_SungMaAttr(self, str, hp, move, immune):
-			self.affectShower.SetSungMaAffectImage(str, hp, move, immune)
-
-	def __IsXMasMap(self):
-		mapDict = (
-			"metin2_map_n_flame_01",
-			"metin2_map_n_desert_01",
-			"metin2_map_spiderdungeon_01",
-			"metin2_map_spiderdungeon_02",
-			"metin2_map_spiderdungeon_03",
-			"metin2_map_deviltower1",
-			"metin2_map_sungzi_flame_hill_01",
-			"metin2_map_sungzi_flame_hill_02",
-			"metin2_map_sungzi_flame_hill_03",
-			"metin2_map_sungzi_desert_01",
-			"metin2_map_sungzi_desert_hill_01",
-			"metin2_map_sungzi_desert_hill_02",
-			"metin2_map_sungzi_desert_hill_03",
-			"metin2_map_empirewar03",
-			"metin2_map_devilsCatacomb",
-			"metin2_map_Mt_Thunder",
-			"metin2_map_n_flame_dungeon_01",
-			"metin2_map_dawnmist_dungeon_01",
-			"metin2_map_Mt_Th_dungeon_01",
-		)
-
-		if background.GetCurrentMapName() in mapDict:
-			return False
-
-		return True
-
-	def __XMasSnow_Enable(self, mode):
-		self.__XMasSong_Enable(mode)
-
-		if "1" == mode:
-			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
-				background.SetXMasShowEvent(1)
-
-			if not self.__IsXMasMap():
-				return
-
-			print "XMAS_SNOW ON"
-			background.EnableSnow(1)
-		else:
-			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
-				background.SetXMasShowEvent(0)
-
-			print "XMAS_SNOW OFF"
-			background.EnableSnow(0)
-
-	def __XMasBoom_Enable(self, mode):
-		if "1" == mode:
-			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
-				if not background.IsBoomMap():
-					return
-			else:
-				if not self.__IsXMasMap():
-					return
-
-			print "XMAS_BOOM ON"
-			self.__DayMode_Update("dark")
-			self.enableXMasBoom = True
-			self.startTimeXMasBoom = app.GetTime()
-		else:
-			print "XMAS_BOOM OFF"
-			self.__DayMode_Update("light")
-			self.enableXMasBoom = False
-
-	def __XMasTree_Enable(self, grade):
-		print "XMAS_TREE ", grade
-		background.SetXMasTree(int(grade))
-
-	def __XMasSong_Enable(self, mode):
-		if "1" == mode:
-			print "XMAS_SONG ON"
-
-			XMAS_BGM = "xmas.mp3"
-
-			if app.IsExistFile("BGM/" + XMAS_BGM) == 1:
-				if musicInfo.fieldMusic != "":
-					snd.FadeOutMusic("BGM/" + musicInfo.fieldMusic)
-
-				musicInfo.fieldMusic = XMAS_BGM
-				snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
-		else:
-			print "XMAS_SONG OFF"
-
-			if musicInfo.fieldMusic != "":
-				snd.FadeOutMusic("BGM/" + musicInfo.fieldMusic)
-
-			musicInfo.fieldMusic = musicInfo.METIN2THEMA
-			snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
-
-	def __RestartDialog_Close(self):
-		self.interface.CloseRestartDialog()
-
-	def __Console_Enable(self):
-		self.consoleEnable = True
-		app.EnableSpecialCameraMode()
-		ui.EnablePaste(True)
-		self.ShowConsole()
-
-	## PrivateShop
-	if app.ENABLE_CHEQUE_SYSTEM:
-		def __CashPrivateShop_Open(self):
-			if app.ENABLE_MYSHOP_DECO:
-				return
-
-			self.interface.OpenPrivateShopInputNameDialog(True)
-
-		def __PrivateShop_Open(self):
-			if app.ENABLE_MYSHOP_DECO:
-				return
-
-			self.interface.OpenPrivateShopInputNameDialog(False)
-	else:
-		def __PrivateShop_Open(self):
-			self.interface.OpenPrivateShopInputNameDialog()
-
-	if app.ENABLE_MYSHOP_DECO:
-		def MyPrivShopOpen(self, cashItem, tabCnt):
-			self.interface.OpenPrivateShopInputNameDialog(cashItem, tabCnt)
-
-		def __OpenMyShopDecoWnd(self):
-			self.interface.OpenMyShopDecoWnd()
-
-		def BINARY_PrivateShop_Appear(self, vid, text, type):
-			self.interface.AppearPrivateShop(vid, text, type)
-	else:
-		def BINARY_PrivateShop_Appear(self, vid, text):
-			self.interface.AppearPrivateShop(vid, text)
-
-	def BINARY_PrivateShop_Disappear(self, vid):
-		self.interface.DisappearPrivateShop(vid)
-
-	if app.ENABLE_MINI_GAME_RUMI:
-		def __MiniGameOkey(self, enable):
-			player.SetMiniGameOkeyNormal(False)
-			if app.ENABLE_EVENT_BANNER:
-				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_OKEY_NORMAL, int(enable))
-
-		def __MiniGameOkeyNormal(self, enable):
-			player.SetMiniGameOkeyNormal(True)
-			if app.ENABLE_EVENT_BANNER:
-				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_OKEY_NORMAL, int(enable))
-
-			if self.interface:
-				self.interface.SetOkeyNormalBG()
-
-		def MiniGameRumiStart(self):
-			self.interface.MiniGameRumiStart()
-
-		def MiniGameRumiEnd(self):
-			self.interface.MiniGameRumiEnd()
-
-		def MiniGameRumiMoveCard(self, src_pos, src_index, src_color, src_number, dst_pos, dst_index, dst_color, dst_number):
-			srcCard = (src_pos, src_index, src_color, src_number)
-			dstCard = (dst_pos, dst_index, dst_color, dst_number)
-			self.interface.MiniGameRumiMoveCard(srcCard, dstCard)
-
-		def MiniGameRumiSetDeckCount(self, deck_card_count):
-			self.interface.MiniGameRumiSetDeckCount(deck_card_count)
-
-		def MiniGameRumiIncreaseScore(self, score, total_score):
-			self.interface.MiniGameRumiIncreaseScore(score, total_score)
-
-		if app.ENABLE_OKEY_EVENT_FLAG_RENEWAL:
-			def MiniGameRumiFlagProcess(self, process_type, data):
-				self.interface.MiniGameRumiFlagProcess(process_type, data)
-
-	if app.ENABLE_MINI_GAME_CATCH_KING:
-		def __MiniGameCatchKing(self, enable):
-			if app.ENABLE_EVENT_BANNER:
-				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_CATCHKING, int(enable))
-			else:
-				pass
-
-		def MiniGameCatchKingEventStart(self, bigScore):
-			self.interface.MiniGameCatchKingEventStart(bigScore)
-
-		def MiniGameCatchKingSetHandCard(self, cardNumber):
-			self.interface.MiniGameCatchKingSetHandCard(cardNumber)
-
-		def MiniGameCatchKingResultField(self, score, rowType, cardPos, cardValue, keepFieldCard, destroyHandCard, getReward, isFiveNear):
-			self.interface.MiniGameCatchKingResultField(score, rowType, cardPos, cardValue, keepFieldCard, destroyHandCard, getReward, isFiveNear)
-
-		def MiniGameCatchKingSetEndCard(self, cardPos, cardNumber):
-			self.interface.MiniGameCatchKingSetEndCard(cardPos, cardNumber)
-
-		def MiniGameCatchKingReward(self, rewardCode):
-			self.interface.MiniGameCatchKingReward(rewardCode)
-
-		if app.ENABLE_CATCH_KING_EVENT_FLAG_RENEWAL:
-			def CatchKingFlagProcess(self, type, data):
-				self.interface.CatchKingFlagProcess(type, data)
-
-	## DayMode
-	def __PRESERVE_DayMode_Update(self, mode):
-		if "light" == mode:
-			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
-				if not background.IsBoomMap():
-					return
-			else:
-				if not self.__IsXMasMap():
-					return
-
-			background.SetEnvironmentData(background.DAY_MODE_LIGHT)
-		elif "dark" == mode:
-			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
-				if not background.IsBoomMap():
-					return
-			else:
-				if not self.__IsXMasMap():
-					return
-
-			background.RegisterEnvironmentData(background.DAY_MODE_DARK, constInfo.ENVIRONMENT_NIGHT)
-			background.SetEnvironmentData(background.DAY_MODE_DARK)
-
-	def __DayMode_Update(self, mode):
-		if "light" == mode:
-			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
-				if not background.IsBoomMap():
-					return
-				else:
-					if not self.__IsXMasMap():
-						return
-
-			self.curtain.SAFE_FadeOut(self.__DayMode_OnCompleteChangeToLight)
-		elif "dark" == mode:
-			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
-				if not background.IsBoomMap():
-					return
-			else:
-				if not self.__IsXMasMap():
-					return
-
-			self.curtain.SAFE_FadeOut(self.__DayMode_OnCompleteChangeToDark)
-
-	def __DayMode_OnCompleteChangeToLight(self):
-		background.SetEnvironmentData(background.DAY_MODE_LIGHT)
-		self.curtain.FadeIn()
-
-	def __DayMode_OnCompleteChangeToDark(self):
-		background.RegisterEnvironmentData(background.DAY_MODE_DARK, constInfo.ENVIRONMENT_NIGHT)
-		background.SetEnvironmentData(background.DAY_MODE_DARK)
-		self.curtain.FadeIn()
-
-	## XMasBoom
-	def __XMasBoom_Update(self):
-		self.BOOM_DATA_LIST = ( (2, 5), (5, 2), (7, 3), (10, 3), (20, 5) )
-		if self.indexXMasBoom >= len(self.BOOM_DATA_LIST):
-			return
-
-		boomTime = self.BOOM_DATA_LIST[self.indexXMasBoom][0]
-		boomCount = self.BOOM_DATA_LIST[self.indexXMasBoom][1]
-
-		if app.GetTime() - self.startTimeXMasBoom > boomTime:
-			self.indexXMasBoom += 1
-
-			for i in xrange(boomCount):
-				self.__XMasBoom_Boom()
-
-	def __XMasBoom_Boom(self):
-		x, y, z = player.GetMainCharacterPosition()
-		randX = app.GetRandom(-150, 150)
-		randY = app.GetRandom(-150, 150)
-
-		snd.PlaySound3D(x+randX, -y+randY, z, "sound/common/etc/salute.mp3")
-
-	if app.ENABLE_NEW_USER_CARE:
-		def __PartyRequestQuestion(self, vid, name):
-			vid = int(vid)
-			partyRequestQuestionDialog = uiCommon.QuestionDialogWithTimeLimit()
-			partyRequestQuestionDialog.SetAcceptText(localeInfo.UI_ACCEPT)
-			partyRequestQuestionDialog.SetCancelText(localeInfo.UI_DENY)
-			partyRequestQuestionDialog.SetAcceptEvent(lambda arg=True: self.__AnswerPartyRequest(arg))
-			partyRequestQuestionDialog.SetCancelEvent(lambda arg=False: self.__AnswerPartyRequest(arg))
-			partyRequestQuestionDialog.Open(name + localeInfo.PARTY_DO_YOU_ACCEPT, 10)
-			partyRequestQuestionDialog.SetTimeOverMsg(localeInfo.PARTY_ANSWER_TIMEOVER)
-			partyRequestQuestionDialog.SetCancelOnTimeOver()
-			partyRequestQuestionDialog.vid = vid
-			self.partyRequestQuestionDialog = partyRequestQuestionDialog
-	else:
-		def __PartyRequestQuestion(self, vid):
-			vid = int(vid)
-			partyRequestQuestionDialog = uiCommon.QuestionDialog()
-			partyRequestQuestionDialog.SetText(chr.GetNameByVID(vid) + localeInfo.PARTY_DO_YOU_ACCEPT)
-			partyRequestQuestionDialog.SetAcceptText(localeInfo.UI_ACCEPT)
-			partyRequestQuestionDialog.SetCancelText(localeInfo.UI_DENY)
-			partyRequestQuestionDialog.SetAcceptEvent(lambda arg=True: self.__AnswerPartyRequest(arg))
-			partyRequestQuestionDialog.SetCancelEvent(lambda arg=False: self.__AnswerPartyRequest(arg))
-			partyRequestQuestionDialog.Open()
-			partyRequestQuestionDialog.vid = vid
-			self.partyRequestQuestionDialog = partyRequestQuestionDialog
-
-	def __AnswerPartyRequest(self, answer):
-		if not self.partyRequestQuestionDialog:
-			return
-
-		vid = self.partyRequestQuestionDialog.vid
-
-		if answer:
-			net.SendCommandPacket("/party_request_accept " + str(vid))
-		else:
-			net.SendCommandPacket("/party_request_deny " + str(vid))
-
-		self.partyRequestQuestionDialog.Close()
-		self.partyRequestQuestionDialog = None
-
-	def __PartyRequestDenied(self):
-		self.PopupMessage(localeInfo.PARTY_REQUEST_DENIED)
-
-	def __EnableTestServerFlag(self):
-		app.EnableTestServerFlag()
-
-	def __InGameShop_Show(self, url):
-		if constInfo.IN_GAME_SHOP_ENABLE:
-			self.interface.OpenWebWindow(url)
-
-	# WEDDING
-	def __LoginLover(self):
-		if self.interface.wndMessenger:
-			self.interface.wndMessenger.OnLoginLover()
-
-	def __LogoutLover(self):
-		if self.interface.wndMessenger:
-			self.interface.wndMessenger.OnLogoutLover()
-		if self.affectShower:
-			self.affectShower.HideLoverState()
-
-	def __LoverNear(self):
-		if self.affectShower:
-			self.affectShower.ShowLoverState()
-
-	def __LoverFar(self):
-		if self.affectShower:
-			self.affectShower.HideLoverState()
-
-	def __LoverDivorce(self):
-		if self.interface.wndMessenger:
-			self.interface.wndMessenger.ClearLoverInfo()
-		if self.affectShower:
-			self.affectShower.ClearLoverState()
-
-	def __PlayMusic(self, flag, filename):
-		flag = int(flag)
-		if flag:
-			snd.FadeOutAllMusic()
-			musicInfo.SaveLastPlayFieldMusic()
-			snd.FadeInMusic("BGM/" + filename)
-		else:
-			snd.FadeOutAllMusic()
-			musicInfo.LoadLastPlayFieldMusic()
-			snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
-
-	# END_OF_WEDDING
-
-	if app.ENABLE_POPUP_NOTICE:
-		def __SetPopupNoticeEventFlag(self, flag_value):
-			self.interface.SetPopupNoticeEventFlag(int(flag_value))
-
-		def __PopupNoticeProcess(self, is_checked, url):
-			self.interface.PopupNoticeProcess(int(is_checked), url)
-
-	if app.ENABLE_ACCE_COSTUME_SYSTEM:
-		def OpenAcceWindow(self, type):
-			self.interface.AcceDialogOpen(type)
-
-		def CloseAcceWindow(self):
-			self.interface.AcceDialogClose()
-
-	if app.ENABLE_AURA_COSTUME_SYSTEM:
-		def OpenAuraWindow(self, type):
-			self.interface.AuraDialogOpen(type)
-
-		def CloseAuraWindow(self):
-			self.interface.AuraDialogClose()
-
-	if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-		## HilightSlot Change
-		def DeactivateSlot(self, slotindex, type):
-			self.interface.DeactivateSlot(slotindex, type)
-
-		## HilightSlot Change
-		def ActivateSlot(self, slotindex, type):
-			self.interface.ActivateSlot(slotindex, type)
-
-	if app.ENABLE_MOVE_COSTUME_ATTR:
-		def __ItemCombinationDialog(self):
-			self.interface.ItemCombinationDialogOpen()
-	else:
-		def __ItemCombinationDialog(self):
-			return
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def ExInvenItemUseMsg(self, item_vnum, msg, enough_count):
-			self.interface.ExInvenItemUseMsg(item_vnum, msg, enough_count)
-
-	if app.ENABLE_CHANGED_ATTR:
-		def OpenSelectAttrDialog(self, window_type, slotIdx):
-			self.interface.OpenSelectAttrDialog(window_type, slotIdx)
-
-	if app.ENABLE_RANKING_SYSTEM:
-		def OpenRankingBoard(self, type, category):
-			self.interface.OpenRankingBoardWindow(type, category)
-
-	if app.ENABLE_MAILBOX:
-		def MailBoxProcess(self, type, data):
-			if self.interface:
-				self.interface.MailBoxProcess(type, data)
-
-	if app.ENABLE_LOOTING_SYSTEM:
-		def LootingSystemProcess(self):
-			if self.interface:
-				self.interface.LootingSystemProcess()
-
-	if app.ENABLE_MINI_GAME_YUTNORI:
-		def __MiniGameYutnori(self, enable):
-			if app.ENABLE_EVENT_BANNER:
-				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_YUTNORI, int(enable))
-			else:
-				pass
-
-		def YutnoriProcess(self, type, data):
-			if self.interface:
-				self.interface.YutnoriProcess(type, data)
-
-		def YutnoriFlagProcess(self, type, data):
-			if self.interface:
-				self.interface.YutnoriFlagProcess(type, data)
-
-	if app.ENABLE_LUCKY_BOX:
-		def ShowLuckyBoxWindow(self, dwItemVnum, byItemCount, iNeedMoney, wSlotIndex):
-			if self.interface:
-				self.interface.ShowLuckyBoxWindow(dwItemVnum, byItemCount, iNeedMoney, wSlotIndex)
-
-	if app.ENABLE_ATTR_6TH_7TH:
-		def __OpenAttr67AddDlg(self):
-			if self.interface:
-				self.interface.OpenAttr67AddDlg()
-
-	if app.ENABLE_FISHING_GAME:
-		def OnFishingGameStart(self, level):
-			if self.interface:
-				self.interface.OpenFishingGameWindow(level)
-
-		def OnFishingStopGame(self):
-			if self.interface:
-				self.interface.CloseFishingGameWindow()
-
-	if app.ENABLE_CLIENT_TIMER:
-		def ClientTimerProcess(self, type, data = None):
-			self.interface.wndMiniMap.ClientTimerProcess(type, data)
-
-	if app.ENABLE_SKILL_COOLTIME_UPDATE:
-		def SkillClearCoolTime(self, slotIndex):
-			self.interface.SkillClearCoolTime(slotIndex)
-
-	if app.ENABLE_EXPRESSING_EMOTION:
-		def AddSpecialActionSlot(self, byType, dwDuration):
-			self.interface.AddSpecialActionSlot(byType, dwDuration)
-
-		def RemoveSpecialActionSlot(self, iIndex):
-			self.interface.RemoveSpecialActionSlot(iIndex)
-
-		def RemoveQuickSlotIndex(self, iIndex):
-			self.interface.RemoveQuickSlotIndex(iIndex)
-
-	if app.ENABLE_SNOWFLAKE_STICK_EVENT:
-		def __SnowflakeStickEvent(self, end_time):
-			player.SetSnowflakeStickEvent(int(end_time))
-
-			if app.ENABLE_EVENT_BANNER:
-				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_SNOWFLAKE_STICK_EVENT, int(end_time))
-
-		def SnowflakeStickEventProcess(self, type, data):
-			if self.interface:
-				self.interface.SnowflakeStickEventProcess(type, data)
-
-	if app.ENABLE_REFINE_ELEMENT_SYSTEM:
-		def RefineElementProcess(self, type, refine_type, data):
-			if self.interface:
-				self.interface.RefineElementProcess(type, refine_type, data)
-
-	if app.ENABLE_HIDE_COSTUME_SYSTEM:
-		def __SetHiddenCostumePart(self, part, hidden):
-			if self.interface:
-				self.interface.SetHiddenCostumePart(int(part), int(hidden))
-
-	if app.ENABLE_EVENT_BANNER:
-		def RefreshInGameEvent(self):
-			if self.interface:
-				self.interface.RefreshInGameEvent()
-
-	if app.ENABLE_LOCALE_CLIENT:
-		def LanguageChange(self):
-			if self.interface:
-				self.interface.LanguageChange()
-
-	if app.ENABLE_LEFT_SEAT:
-		def LoadLeftSeatWaitTimeIndexData(self):
-			if self.interface:
-				self.interface.LoadLeftSeatWaitTimeIndexData()
-
-		def OpenLeftSeatDialog(self):
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.LEFT_SEAT_STATE_ON)
-
-			self.left_seat_dialog = uiCommon.PopupDialog()
-			self.left_seat_dialog.SetText(localeInfo.LEFT_SEAT_RELEASE_ASK)
-			self.left_seat_dialog.SetAcceptEvent(ui.__mem_func__(self.__ReleaseLeftSeat))
-
-			w, h = self.left_seat_dialog.GetTextSize()
-			self.left_seat_dialog.SetWidth(w + 60)
-
-			self.left_seat_dialog.Open()
-
-		def CloseLeftSeatDialog(self):
-			if self.left_seat_dialog:
-				self.left_seat_dialog.Close()
-
-		def __ReleaseLeftSeat(self):
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.LEFT_SEAT_STATE_OFF)
-			net.DisableLeftSeatLogOutState()
-
-	if app.ENABLE_GUILD_DRAGONLAIR_SYSTEM:
-		def __ClearGuildRedDragonLairRanking(self):
-			guild.ClearDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED)
-
-		def __CheckRedDragonLairRanking(self):
-			if guild.CheckDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED) == 0:
-				self.interface.RefreshGuildDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED)
-				self.interface.OpenGuildDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED)
-
-		def OpenGuildDragonLairRanking(self, type):
-			self.interface.OpenGuildDragonLairRanking(type)
-
-		def RefreshGuildDragonLairRanking(self, type):
-			self.interface.RefreshGuildDragonLairRanking(type)
-
-		if app.ENABLE_GUILD_DRAGONLAIR_PARTY_SYSTEM:
-			def SetGuildDragonLairFistGuildText(self, second):
-				self.interface.SetGuildDragonLairFistGuildText(second)
-			def SetGuildDragonLairStart(self):
-				self.interface.SetGuildDragonLairStart()
-			def SetGuildDragonLairSuccess(self):
-				self.interface.SetGuildDragonLairSuccess()
-
-	if app.ENABLE_SUMMER_EVENT_ROULETTE:
-		def __LateSummerEvent(self, enable):
-			background.SetLateSummerEvent(int(enable))
-			if app.ENABLE_EVENT_BANNER:
-				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_ROULETTE, int(enable))
-
-		def RouletteProcess(self, type, data = None):
-			self.interface.RouletteProcess(type, data)
-
-	if app.ENABLE_FLOWER_EVENT:
-		def __FlowerEvent(self, enable):
-			player.SetFlowerEventEnable(int(enable))
-			if app.ENABLE_EVENT_BANNER:
-				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_FLOWER_EVENT, int(enable))
-
-		def FlowerEventProcess(self, type, data = None):
-			self.interface.FlowerEventProcess(type, data)
-
-	if app.ENABLE_GROWTH_PET_SYSTEM:
-		def PetHatchingWindowCommand(self, command):
-			self.interface.PetHatchingWindowCommand(command)
-
-		def PetNameChangeWindowCommand(self, command):
-			self.interface.PetNameChangeWindowCommand(command)
-
-		def PetSkillUpgradeDlgOpen(self, slot, index, gold):
-			self.interface.PetSkillUpgradeDlgOpen(slot, index, gold)
-
-		def PetFlashEvent(self, index):
-			self.interface.PetFlashEvent(index)
-
-		def PetAffectShowerRefresh(self):
-			self.interface.PetAffectShowerRefresh()
-
-		def PetFeedReuslt(self, result):
-			self.interface.PetFeedReuslt(result)
-			
-		def PetAttrDetermineResult(self, byType):
-			self.interface.PetAttrDetermineResult(byType)
-			
-		def PetAttrChangeResult(self, slotIndex, byType):
-			self.interface.PetAttrChangeResult(slotIndex, byType)
-			
-		def PetReviveResult(self, result):
-			self.interface.PetReviveResult(result)
-			
-		def PetWindowTypeResult(self, result):
-			self.interface.PetWindowTypeResult(result)
+import os
+import app
+import dbg
+import grp
+import item
+import background
+import chr
+import chrmgr
+import player
+import snd
+import chat
+import textTail
+import snd
+import net
+import effect
+import wndMgr
+#import fly
+import systemSetting
+import quest
+import guild
+import skill
+import messenger
+import localeInfo
+import constInfo
+import exchange
+import ime
+
+import ui
+import uiCommon
+import uiPhaseCurtain
+import uiMapNameShower
+import uiAffectShower
+import uiPlayerGauge
+import uiCharacter
+import uiTarget
+
+# PRIVATE_SHOP_PRICE_LIST
+import uiPrivateShopBuilder
+# END_OF_PRIVATE_SHOP_PRICE_LIST
+
+import mouseModule
+import localeInfo
+
+import playerSettingModule
+import interfaceModule
+
+import musicInfo
+import debugInfo
+import stringCommander
+
+if app.ENABLE_KEYCHANGE_SYSTEM:
+	import uiKeyChange
+
+if app.ENABLE_EVENT_BANNER:
+	import ingameEventSystem
+
+from _weakref import proxy
+
+# TEXTTAIL_LIVINGTIME_CONTROL
+#if localeInfo.IsJAPAN():
+#	app.SetTextTailLivingTime(8.0)
+# END_OF_TEXTTAIL_LIVINGTIME_CONTROL
+
+# SCREENSHOT_CWDSAVE
+SCREENSHOT_CWDSAVE = False
+SCREENSHOT_DIR = None
+
+if localeInfo.IsEUROPE():
+	SCREENSHOT_CWDSAVE = True
+
+if localeInfo.IsCIBN10():
+	SCREENSHOT_CWDSAVE = False
+	SCREENSHOT_DIR = "YT2W"
+
+cameraDistance = 1550.0
+cameraPitch = 27.0
+cameraRotation = 0.0
+cameraHeight = 100.0
+
+testAlignment = 0
+
+if app.ENABLE_REFINE_MSG_ADD:
+	REFINE_FAIL_GRADE_DOWN = 0
+	REFINE_FAIL_DEL_ITEM = 1
+	REFINE_FAIL_KEEP_GRADE = 2
+	REFINE_FAIL_MAX = 3
+
+class GameWindow(ui.ScriptWindow):
+
+	if app.ENABLE_LEFT_SEAT:
+		left_seat_dialog = None
+
+	def __init__(self, stream):
+		ui.ScriptWindow.__init__(self, "GAME")
+		self.SetWindowName("game")
+		net.SetPhaseWindow(net.PHASE_WINDOW_GAME, self)
+		player.SetGameWindow(self)
+
+		self.quickSlotPageIndex = 0
+		self.lastPKModeSendedTime = 0
+		self.pressNumber = None
+
+		self.guildWarQuestionDialog = None
+		self.interface = None
+		self.targetBoard = None
+		if app.ENABLE_DEFENSE_WAVE:
+			self.allianceTargetBoard = None
+		self.console = None
+		self.mapNameShower = None
+		self.affectShower = None
+		self.playerGauge = None
+		if app.ENABLE_KEYCHANGE_SYSTEM:
+			self.wndKeyChange = None
+
+		self.stream = stream
+		self.interface = interfaceModule.Interface()
+		self.interface.MakeInterface()
+		self.interface.ShowDefaultWindows()
+
+		# ENABLE_OFFLINE_SHOP: ensure C++ handler is always initialized (prevents NULL handler crash)
+		if hasattr(net, "SetOfflineShopManagerHandler"):
+			class _OfflineShopManagerHandler(object):
+				def __init__(self, interface):
+					self.interface = interface
+
+				# Called by CPythonOfflineShop on shop spawn
+				def OnSpawnShop(self, shopId, vid, decoBoard, shopName):
+					if hasattr(self.interface, "OnOfflineShopSpawn"):
+						try:
+							self.interface.OnOfflineShopSpawn(shopId, vid, decoBoard, shopName)
+						except Exception:
+							pass
+
+				# Called by CPythonOfflineShop on shop close
+				def OnCloseShop(self, shopId):
+					if hasattr(self.interface, "OnOfflineShopClose"):
+						try:
+							self.interface.OnOfflineShopClose(shopId)
+						except Exception:
+							pass
+
+			self.interface.offlineShopManagerHandler = _OfflineShopManagerHandler(self.interface)
+			try:
+				net.SetOfflineShopManagerHandler(self.interface.offlineShopManagerHandler)
+			except Exception:
+				pass
+
+		self.curtain = uiPhaseCurtain.PhaseCurtain()
+		self.curtain.speed = 0.03
+		self.curtain.Hide()
+
+		self.targetBoard = uiTarget.TargetBoard()
+		self.targetBoard.SetWhisperEvent(ui.__mem_func__(self.interface.OpenWhisperDialog))
+		self.targetBoard.Hide()
+		self.interface.SettargetBoard(self.targetBoard)
+
+		if app.ENABLE_DEFENSE_WAVE:
+			self.allianceTargetBoard = uiTarget.AllianceTargetBoard()
+			self.allianceTargetBoard.Hide()
+			self.interface.SetAllianceTargetBoard(self.allianceTargetBoard)
+
+		self.mapNameShower = uiMapNameShower.MapNameShower()
+		self.affectShower = uiAffectShower.AffectShower()
+		self.interface.SetAffectShower(self.affectShower)
+
+		self.playerGauge = uiPlayerGauge.PlayerGauge(self)
+		self.playerGauge.Hide()
+
+		#wj 2014.1.2. ESCÅ°   ì¼± DropQuestionDialog  .  Ã³ itemDropQuestionDialog Ç¾  Ê¾ ERROR ß»Ï¿ init  Ã¿ Ê±È­ Å´.
+		self.itemDropQuestionDialog = None
+		if app.ENABLE_NEW_DROP_DIALOG:
+			self.itemDestroyQuestionDialog = None
+
+		self.__SetQuickSlotMode()
+
+		self.__ServerCommand_Build()
+		self.__ProcessPreservedServerCommand()
+
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			self.interface.PetInfoBindAffectShower(self.affectShower)
+
+		if app.ENABLE_KEYCHANGE_SYSTEM:
+			self.wndKeyChange = uiKeyChange.KeyChangeWindow(self, self.interface)
+			self.ADDKEYBUFFERCONTROL = player.KEY_ADDKEYBUFFERCONTROL
+			self.ADDKEYBUFFERALT = player.KEY_ADDKEYBUFFERALT
+			self.ADDKEYBUFFERSHIFT = player.KEY_ADDKEYBUFFERSHIFT
+
+		self.partyRequestQuestionDialog = None
+		self.partyInviteQuestionDialog = None
+
+	def __del__(self):
+		player.SetGameWindow(0)
+		net.ClearPhaseWindow(net.PHASE_WINDOW_GAME, self)
+		ui.ScriptWindow.__del__(self)
+
+	def Open(self):
+		app.SetFrameSkip(1)
+
+		self.SetSize(wndMgr.GetScreenWidth(), wndMgr.GetScreenHeight())
+
+		self.quickSlotPageIndex = 0
+		self.PickingCharacterIndex = -1
+		self.PickingItemIndex = -1
+		self.isShowDebugInfo = False
+		self._nextDebugInfoUpdateTime = 0.0
+		self.ShowNameFlag = False
+
+		self.enableXMasBoom = False
+		self.startTimeXMasBoom = 0.0
+		self.indexXMasBoom = 0
+
+		global cameraDistance, cameraPitch, cameraRotation, cameraHeight
+
+		app.SetCamera(cameraDistance, cameraPitch, cameraRotation, cameraHeight)
+
+		constInfo.SET_DEFAULT_CAMERA_MAX_DISTANCE()
+		constInfo.SET_DEFAULT_CHRNAME_COLOR()
+		constInfo.SET_DEFAULT_FOG_LEVEL()
+		constInfo.SET_DEFAULT_CONVERT_EMPIRE_LANGUAGE_ENABLE()
+		constInfo.SET_DEFAULT_USE_ITEM_WEAPON_TABLE_ATTACK_BONUS()
+		constInfo.SET_DEFAULT_USE_SKILL_EFFECT_ENABLE()
+
+		# TWO_HANDED_WEAPON_ATTACK_SPEED_UP
+		constInfo.SET_TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE()
+		# END_OF_TWO_HANDED_WEAPON_ATTACK_SPEED_UP
+
+		import event
+		event.SetLeftTimeString(localeInfo.UI_LEFT_TIME)
+
+		textTail.EnablePKTitle(constInfo.PVPMODE_ENABLE)
+
+		#if constInfo.PVPMODE_TEST_ENABLE:
+			#self.testPKMode = ui.TextLine()
+			#self.testPKMode.SetFontName(localeInfo.UI_DEF_FONT)
+			#self.testPKMode.SetPosition(0, 15)
+			#self.testPKMode.SetWindowHorizontalAlignCenter()
+			#self.testPKMode.SetHorizontalAlignCenter()
+			#self.testPKMode.SetFeather()
+			#self.testPKMode.SetOutline()
+			#self.testPKMode.Show()
+
+			#self.testAlignment = ui.TextLine()
+			#self.testAlignment.SetFontName(localeInfo.UI_DEF_FONT)
+			#self.testAlignment.SetPosition(0, 35)
+			#self.testAlignment.SetWindowHorizontalAlignCenter()
+			#self.testAlignment.SetHorizontalAlignCenter()
+			#self.testAlignment.SetFeather()
+			#self.testAlignment.SetOutline()
+			#self.testAlignment.Show()
+
+		if app.ENABLE_KEYCHANGE_SYSTEM:
+			pass
+		else:
+			self.__BuildKeyDict()
+
+		self.__BuildDebugInfo()
+
+		# PRIVATE_SHOP_PRICE_LIST
+		uiPrivateShopBuilder.Clear()
+		# END_OF_PRIVATE_SHOP_PRICE_LIST
+
+		# UNKNOWN_UPDATE
+		exchange.InitTrading()
+		# END_OF_UNKNOWN_UPDATE
+
+		if debugInfo.IsDebugMode():
+			self.ToggleDebugInfo()
+
+		## Sound
+		snd.SetMusicVolume(systemSetting.GetMusicVolume() * net.GetFieldMusicVolume())
+		snd.SetSoundVolume(systemSetting.GetSoundVolume())
+
+		netFieldMusicFileName = net.GetFieldMusicFileName()
+		if netFieldMusicFileName:
+			snd.FadeInMusic("BGM/" + netFieldMusicFileName)
+		elif musicInfo.fieldMusic != "":
+			snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
+
+		self.__SetQuickSlotMode()
+		self.__SelectQuickPage(self.quickSlotPageIndex)
+
+		self.SetFocus()
+		self.Show()
+		app.ShowCursor()
+
+		net.SendEnterGamePacket()
+
+		if app.ENABLE_MONSTER_CARD:
+			app.IllustratedCreate()
+
+		if app.ENABLE_MYSHOP_DECO:
+			app.MyShopDecoBGCreate()
+
+		if app.ENABLE_MINI_GAME_YUTNORI:
+			app.YutnoriCreate()
+
+		# START_GAME_ERROR_EXIT
+		try:
+			self.StartGame()
+		except:
+			import exception
+			exception.Abort("GameWindow.Open")
+		# END_OF_START_GAME_ERROR_EXIT
+
+		# NPC Å¥Ã½   Ö´ Ûµ  Ä³
+		# ex) cubeInformation[20383] = [ {"rewordVNUM": 72723, "rewordCount": 1, "materialInfo": "101,1&102,2", "price": 999 }, ... ]
+		if not app.ENABLE_CUBE_RENEWAL:
+			self.cubeInformation = {}
+			self.currentCubeNPC = 0
+
+		mouseModule.mouseController.CreateNumberLine()
+
+	def Close(self):
+		self.Hide()
+
+		global cameraDistance, cameraPitch, cameraRotation, cameraHeight
+		(cameraDistance, cameraPitch, cameraRotation, cameraHeight) = app.GetCamera()
+
+		if musicInfo.fieldMusic != "":
+			snd.FadeOutMusic("BGM/"+ musicInfo.fieldMusic)
+
+		self.onPressKeyDict = None
+		self.onClickKeyDict = None
+
+		chat.Close()
+		snd.StopAllSound()
+		grp.InitScreenEffect()
+		chr.Destroy()
+		textTail.Clear()
+		quest.Clear()
+		background.Destroy()
+		guild.Destroy()
+		messenger.Destroy()
+		skill.ClearSkillData()
+		wndMgr.Unlock()
+		mouseModule.mouseController.DeattachObject()
+
+		if self.guildWarQuestionDialog:
+			self.guildWarQuestionDialog.Close()
+
+		self.guildNameBoard = None
+		self.partyRequestQuestionDialog = None
+		self.partyInviteQuestionDialog = None
+		self.guildInviteQuestionDialog = None
+		self.guildWarQuestionDialog = None
+		self.messengerAddFriendQuestion = None
+
+		# UNKNOWN_UPDATE
+		self.itemDropQuestionDialog = None
+		if app.ENABLE_NEW_DROP_DIALOG:
+			self.itemDestroyQuestionDialog = None
+		# END_OF_UNKNOWN_UPDATE
+
+		# QUEST_CONFIRM
+		self.confirmDialog = None
+		# END_OF_QUEST_CONFIRM
+
+		self.PrintCoord = None
+		self.FrameRate = None
+		self.Pitch = None
+		self.Splat = None
+		self.TextureNum = None
+		self.ObjectNum = None
+		self.ViewDistance = None
+		self.PrintMousePos = None
+
+		self.ClearDictionary()
+
+		self.playerGauge = None
+		self.mapNameShower = None
+		self.affectShower = None
+
+		if self.console:
+			self.console.BindGameClass(0)
+			self.console.Close()
+			self.console = None
+
+		if self.interface:
+			self.interface.HideAllWindows()
+			self.interface.Close()
+			del self.interface
+			self.interface = None
+
+		if self.targetBoard:
+			self.targetBoard.Destroy()
+			self.targetBoard = None
+
+		if app.ENABLE_DEFENSE_WAVE:
+			if self.allianceTargetBoard:
+				self.allianceTargetBoard.Destroy()
+				self.allianceTargetBoard = None
+
+		if app.ENABLE_LEFT_SEAT:
+			if self.left_seat_dialog:
+				del self.left_seat_dialog
+				self.left_seat_dialog = None
+
+		player.ClearSkillDict()
+		player.ResetCameraRotation()
+
+		self.KillFocus()
+		app.HideCursor()
+
+		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+		if app.ENABLE_KEYCHANGE_SYSTEM:
+			if self.wndKeyChange:
+				self.wndKeyChange.KeyChangeWindowClose(True)
+				self.wndKeyChange = None
+
+		mouseModule.mouseController.Destroy()
+		#print "---------------------------------------------------------------------------- CLOSE GAME WINDOW"
+
+	def __BuildKeyDict(self):
+		onPressKeyDict = {}
+
+		# PressKey   Ö´   Ç´ Å°Ì´.
+
+		##  Å° Ô¿ Ì¿È´.( Úµéµµ  Ô¿ )
+		## F12  Å¬ ×¿ Å°Ì¹Ç·  Ê´  .
+		onPressKeyDict[app.DIK_1] = lambda : self.__PressNumKey(1)
+		onPressKeyDict[app.DIK_2] = lambda : self.__PressNumKey(2)
+		onPressKeyDict[app.DIK_3] = lambda : self.__PressNumKey(3)
+		onPressKeyDict[app.DIK_4] = lambda : self.__PressNumKey(4)
+		onPressKeyDict[app.DIK_5] = lambda : self.__PressNumKey(5)
+		onPressKeyDict[app.DIK_6] = lambda : self.__PressNumKey(6)
+		onPressKeyDict[app.DIK_7] = lambda : self.__PressNumKey(7)
+		onPressKeyDict[app.DIK_8] = lambda : self.__PressNumKey(8)
+		onPressKeyDict[app.DIK_9] = lambda : self.__PressNumKey(9)
+		onPressKeyDict[app.DIK_F1] = lambda : self.__PressQuickSlot(4)
+		onPressKeyDict[app.DIK_F2] = lambda : self.__PressQuickSlot(5)
+		onPressKeyDict[app.DIK_F3] = lambda : self.__PressQuickSlot(6)
+		onPressKeyDict[app.DIK_F4] = lambda : self.__PressQuickSlot(7)
+
+		onPressKeyDict[app.DIK_LALT] = lambda : self.ShowName()
+		onPressKeyDict[app.DIK_LCONTROL] = lambda : self.ShowMouseImage()
+		onPressKeyDict[app.DIK_SYSRQ] = lambda : self.SaveScreen()
+		onPressKeyDict[app.DIK_SPACE] = lambda : self.StartAttack()
+
+		# Ä³ ÌµÅ°
+		onPressKeyDict[app.DIK_UP] = lambda : self.MoveUp()
+		onPressKeyDict[app.DIK_DOWN] = lambda : self.MoveDown()
+		onPressKeyDict[app.DIK_LEFT] = lambda : self.MoveLeft()
+		onPressKeyDict[app.DIK_RIGHT] = lambda : self.MoveRight()
+		onPressKeyDict[app.DIK_W] = lambda : self.MoveUp()
+		onPressKeyDict[app.DIK_S] = lambda : self.MoveDown()
+		onPressKeyDict[app.DIK_A] = lambda : self.MoveLeft()
+		onPressKeyDict[app.DIK_D] = lambda : self.MoveRight()
+
+		onPressKeyDict[app.DIK_E] = self.__PressEKey
+		onPressKeyDict[app.DIK_R] = lambda: app.ZoomCamera(app.CAMERA_TO_NEGATIVE)
+		#onPressKeyDict[app.DIK_F] = lambda: app.ZoomCamera(app.CAMERA_TO_POSITIVE)
+		onPressKeyDict[app.DIK_T] = lambda: app.PitchCamera(app.CAMERA_TO_NEGATIVE)
+		onPressKeyDict[app.DIK_G] = self.__PressGKey
+		onPressKeyDict[app.DIK_Q] = self.__PressQKey
+
+		onPressKeyDict[app.DIK_NUMPAD9] = lambda: app.MovieResetCamera()
+		onPressKeyDict[app.DIK_NUMPAD4] = lambda: app.MovieRotateCamera(app.CAMERA_TO_NEGATIVE)
+		onPressKeyDict[app.DIK_NUMPAD6] = lambda: app.MovieRotateCamera(app.CAMERA_TO_POSITIVE)
+		onPressKeyDict[app.DIK_PGUP] = lambda: app.MovieZoomCamera(app.CAMERA_TO_NEGATIVE)
+		onPressKeyDict[app.DIK_PGDN] = lambda: app.MovieZoomCamera(app.CAMERA_TO_POSITIVE)
+		onPressKeyDict[app.DIK_NUMPAD8] = lambda: app.MoviePitchCamera(app.CAMERA_TO_NEGATIVE)
+		onPressKeyDict[app.DIK_NUMPAD2] = lambda: app.MoviePitchCamera(app.CAMERA_TO_POSITIVE)
+		onPressKeyDict[app.DIK_GRAVE] = lambda : self.PickUpItem()
+		onPressKeyDict[app.DIK_Z] = lambda : self.PickUpItem()
+		onPressKeyDict[app.DIK_C] = lambda state = "STATUS": self.interface.ToggleCharacterWindow(state)
+		onPressKeyDict[app.DIK_V] = lambda state = "SKILL": self.interface.ToggleCharacterWindow(state)
+		#onPressKeyDict[app.DIK_B] = lambda state = "EMOTICON": self.interface.ToggleCharacterWindow(state)
+		onPressKeyDict[app.DIK_N] = lambda state = "QUEST": self.interface.ToggleCharacterWindow(state)
+		onPressKeyDict[app.DIK_I] = lambda : self.interface.ToggleInventoryWindow()
+		onPressKeyDict[app.DIK_O] = lambda : self.__PressOKey()
+		onPressKeyDict[app.DIK_M] = lambda : self.interface.PressMKey()
+		#onPressKeyDict[app.DIK_H] = lambda : self.interface.OpenHelpWindow()
+		onPressKeyDict[app.DIK_ADD] = lambda : self.interface.MiniMapScaleUp()
+		onPressKeyDict[app.DIK_SUBTRACT] = lambda : self.interface.MiniMapScaleDown()
+		onPressKeyDict[app.DIK_L] = lambda : self.interface.ToggleChatLogWindow()
+		onPressKeyDict[app.DIK_LSHIFT] = lambda : self.__SetQuickPageMode()
+
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			onPressKeyDict[app.DIK_P] = lambda : self.interface.TogglePetInformationWindow()
+
+		onPressKeyDict[app.DIK_J] = lambda : self.__PressJKey()
+		onPressKeyDict[app.DIK_H] = lambda : self.__PressHKey()
+		onPressKeyDict[app.DIK_B] = lambda : self.__PressBKey()
+		onPressKeyDict[app.DIK_F] = lambda : self.__PressFKey()
+
+		# CUBE_TEST
+		#onPressKeyDict[app.DIK_K] = lambda : self.interface.OpenCubeWindow()
+		# CUBE_TEST_END
+
+		self.onPressKeyDict = onPressKeyDict
+
+		onClickKeyDict = {}
+		onClickKeyDict[app.DIK_UP] = lambda : self.StopUp()
+		onClickKeyDict[app.DIK_DOWN] = lambda : self.StopDown()
+		onClickKeyDict[app.DIK_LEFT] = lambda : self.StopLeft()
+		onClickKeyDict[app.DIK_RIGHT] = lambda : self.StopRight()
+		onClickKeyDict[app.DIK_SPACE] = lambda : self.EndAttack()
+
+		onClickKeyDict[app.DIK_W] = lambda : self.StopUp()
+		onClickKeyDict[app.DIK_S] = lambda : self.StopDown()
+		onClickKeyDict[app.DIK_A] = lambda : self.StopLeft()
+		onClickKeyDict[app.DIK_D] = lambda : self.StopRight()
+		onClickKeyDict[app.DIK_Q] = lambda: app.RotateCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_E] = lambda: app.RotateCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_R] = lambda: app.ZoomCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_F] = lambda: app.ZoomCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_T] = lambda: app.PitchCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_G] = lambda: self.__ReleaseGKey()
+		onClickKeyDict[app.DIK_NUMPAD4] = lambda: app.MovieRotateCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_NUMPAD6] = lambda: app.MovieRotateCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_PGUP] = lambda: app.MovieZoomCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_PGDN] = lambda: app.MovieZoomCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_NUMPAD8] = lambda: app.MoviePitchCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_NUMPAD2] = lambda: app.MoviePitchCamera(app.CAMERA_STOP)
+		onClickKeyDict[app.DIK_LALT] = lambda: self.HideName()
+		onClickKeyDict[app.DIK_LCONTROL] = lambda: self.HideMouseImage()
+		onClickKeyDict[app.DIK_LSHIFT] = lambda: self.__SetQuickSlotMode()
+
+		#if constInfo.PVPMODE_ACCELKEY_ENABLE:
+		#	onClickKeyDict[app.DIK_B] = lambda: self.ChangePKMode()
+
+		self.onClickKeyDict=onClickKeyDict
+
+	def __PressNumKey(self,num):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			if num >= 1 and num <= 9:
+				if (chrmgr.IsPossibleEmoticon(-1)):
+					chrmgr.SetEmoticon(-1, int(num)-1)
+					net.SendEmoticon(int(num)-1)
+		else:
+			if num >= 1 and num <= 4:
+				self.pressNumber(num-1)
+
+	def __ClickBKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			return
+		else:
+			if constInfo.PVPMODE_ACCELKEY_ENABLE:
+				self.ChangePKMode()
+
+	def __PressJKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			if player.IsMountingHorse():
+				net.SendCommandPacket("/unmount")
+			else:
+				#net.SendCommandPacket("/user_horse_ride")
+				if not uiPrivateShopBuilder.IsBuildingPrivateShop():
+					for i in xrange(player.INVENTORY_PAGE_SIZE):
+						if player.GetItemIndex(i) in (71114, 71116, 71118, 71120):
+							net.SendItemUsePacket(i)
+							break
+
+	def __PressHKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			net.SendCommandPacket("/user_horse_ride")
+		else:
+			self.interface.OpenHelpWindow()
+
+	def __PressOKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			if self.interface.wndDragonSoul:
+				self.interface.wndDragonSoul.ActivateButtonClick()
+		else:
+			self.interface.ToggleDragonSoulWindowWithNoInfo()
+
+	def __PressBKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			net.SendCommandPacket("/user_horse_back")
+		else:
+			state = "EMOTICON"
+			self.interface.ToggleCharacterWindow(state)
+
+	def __PressFKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			net.SendCommandPacket("/user_horse_feed")
+		else:
+			app.ZoomCamera(app.CAMERA_TO_POSITIVE)
+
+	def __PressGKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			net.SendCommandPacket("/ride")
+		else:
+			if self.ShowNameFlag:
+				self.interface.ToggleGuildWindow()
+			else:
+				app.PitchCamera(app.CAMERA_TO_POSITIVE)
+
+	def __ReleaseGKey(self):
+		app.PitchCamera(app.CAMERA_STOP)
+
+	def __PressQKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			if 0 == interfaceModule.IsQBHide:
+				interfaceModule.IsQBHide = 1
+				self.interface.HideAllQuestButton()
+			else:
+				interfaceModule.IsQBHide = 0
+				self.interface.ShowAllQuestButton()
+		else:
+			app.RotateCamera(app.CAMERA_TO_NEGATIVE)
+
+	def __PressEKey(self):
+		if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+			if 0 == interfaceModule.IsWisperHide:
+				interfaceModule.IsWisperHide = 1
+				self.interface.HideAllWhisperButton()
+			else:
+				interfaceModule.IsWisperHide= 0
+				self.interface.ShowAllWhisperButton()
+		else:
+			app.RotateCamera(app.CAMERA_TO_POSITIVE)
+
+	def __SetQuickSlotMode(self):
+		self.pressNumber = ui.__mem_func__(self.__PressQuickSlot)
+
+	def __SetQuickPageMode(self):
+		self.pressNumber = ui.__mem_func__(self.__SelectQuickPage)
+
+	def __PressQuickSlot(self, localSlotIndex):
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			if localeInfo.IsARABIC():
+				if 0 <= localSlotIndex and localSlotIndex < 4:
+					localSlotIndex = 3 - localSlotIndex
+				else:
+					localSlotIndex = 11 - localSlotIndex
+
+			result = player.CanUseGrowthPetQuickSlot(localSlotIndex)
+
+			if player.QUICK_SLOT_POS_ERROR == result:
+				return
+			elif result in [player.QUICK_SLOT_ITEM_USE_SUCCESS, player.QUICK_SLOT_IS_NOT_ITEM, player.QUICK_SLOT_PET_ITEM_USE_SUCCESS]:
+				player.RequestUseLocalQuickSlot(localSlotIndex)
+			elif player.QUICK_SLOT_PET_ITEM_USE_FAILED == result:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.PET_CAN_NOT_SUMMON_BECAUSE_LIFE_TIME_END)
+			elif player.QUICK_SLOT_CAN_NOT_USE_PET_ITEM == result:
+				return
+
+		else:
+			if localeInfo.IsARABIC():
+				if 0 <= localSlotIndex and localSlotIndex < 4:
+					player.RequestUseLocalQuickSlot(3-localSlotIndex)
+				else:
+					player.RequestUseLocalQuickSlot(11-localSlotIndex)
+			else:
+				player.RequestUseLocalQuickSlot(localSlotIndex)
+
+	if app.ENABLE_KEYCHANGE_SYSTEM:
+		def OpenKeyChangeWindow(self):
+			self.wndKeyChange.Open()
+
+		def OpenWindow(self, type, state):
+			if type == player.KEY_OPEN_STATE:
+				self.interface.ToggleCharacterWindow(state)
+			elif type == player.KEY_OPEN_INVENTORY:
+				self.interface.ToggleInventoryWindow()
+			elif type == player.KEY_OPEN_DDS:
+				self.interface.ToggleDragonSoulWindowWithNoInfo()
+			elif type == player.KEY_OPEN_MINIMAP:
+				self.interface.ToggleMiniMap()
+			elif type == player.KEY_OPEN_LOGCHAT:
+				self.interface.ToggleChatLogWindow()
+			elif type == player.KEY_OPEN_GUILD:
+				self.interface.ToggleGuildWindow()
+			elif type == player.KEY_OPEN_MESSENGER:
+				self.interface.ToggleMessenger()
+			elif type == player.KEY_OPEN_HELP:
+				self.interface.ToggleHelpWindow()
+			elif app.ENABLE_EVENT_BANNER and type == player.KEY_OPEN_IN_GAME_EVENT:
+				self.interface.ShowInGameEvent()
+			elif app.ENABLE_GROWTH_PET_SYSTEM:
+				self.interface.TogglePetInformationWindow()
+
+			if app.ENABLE_DSS_KEY_SELECT:
+				if type == player.KEY_SELECT_DSS_1:
+					self.interface.DragonSoulKeySelect(0)
+				elif type == player.KEY_SELECT_DSS_2:
+					self.interface.DragonSoulKeySelect(1)
+
+		def ScrollOnOff(self):
+			if 0 == interfaceModule.IsQBHide:
+				interfaceModule.IsQBHide = 1
+				self.interface.HideAllQuestButton()
+			else:
+				interfaceModule.IsQBHide = 0
+				self.interface.ShowAllQuestButton()
+
+	def __SelectQuickPage(self, pageIndex):
+		self.quickSlotPageIndex = pageIndex
+		player.SetQuickPage(pageIndex)
+
+	def ToggleDebugInfo(self):
+		self.isShowDebugInfo = not self.isShowDebugInfo
+
+		if self.isShowDebugInfo:
+			self.PrintCoord.Show()
+			self.FrameRate.Show()
+			self.Pitch.Show()
+			self.Splat.Show()
+			self.TextureNum.Show()
+			self.ObjectNum.Show()
+			self.ViewDistance.Show()
+			self.PrintMousePos.Show()
+		else:
+			self.PrintCoord.Hide()
+			self.FrameRate.Hide()
+			self.Pitch.Hide()
+			self.Splat.Hide()
+			self.TextureNum.Hide()
+			self.ObjectNum.Hide()
+			self.ViewDistance.Hide()
+			self.PrintMousePos.Hide()
+
+	def __BuildDebugInfo(self):
+		## Character Position Coordinate
+		self.PrintCoord = ui.TextLine()
+		self.PrintCoord.SetFontName(localeInfo.UI_DEF_FONT)
+		self.PrintCoord.SetPosition(wndMgr.GetScreenWidth() - 270, 0)
+
+		## Frame Rate
+		self.FrameRate = ui.TextLine()
+		self.FrameRate.SetFontName(localeInfo.UI_DEF_FONT)
+		self.FrameRate.SetPosition(wndMgr.GetScreenWidth() - 270, 20)
+
+		## Camera Pitch
+		self.Pitch = ui.TextLine()
+		self.Pitch.SetFontName(localeInfo.UI_DEF_FONT)
+		self.Pitch.SetPosition(wndMgr.GetScreenWidth() - 270, 40)
+
+		## Splat
+		self.Splat = ui.TextLine()
+		self.Splat.SetFontName(localeInfo.UI_DEF_FONT)
+		self.Splat.SetPosition(wndMgr.GetScreenWidth() - 270, 60)
+
+		##
+		self.PrintMousePos = ui.TextLine()
+		self.PrintMousePos.SetFontName(localeInfo.UI_DEF_FONT)
+		self.PrintMousePos.SetPosition(wndMgr.GetScreenWidth() - 270, 80)
+
+		# TextureNum
+		self.TextureNum = ui.TextLine()
+		self.TextureNum.SetFontName(localeInfo.UI_DEF_FONT)
+		self.TextureNum.SetPosition(wndMgr.GetScreenWidth() - 270, 100)
+
+		# Æ® ×¸ 
+		self.ObjectNum = ui.TextLine()
+		self.ObjectNum.SetFontName(localeInfo.UI_DEF_FONT)
+		self.ObjectNum.SetPosition(wndMgr.GetScreenWidth() - 270, 120)
+
+		# Ã¾ß°Å¸
+		self.ViewDistance = ui.TextLine()
+		self.ViewDistance.SetFontName(localeInfo.UI_DEF_FONT)
+		self.ViewDistance.SetPosition(0, 0)
+
+	def __NotifyError(self, msg):
+		chat.AppendChat(chat.CHAT_TYPE_INFO, msg)
+
+	def ChangePKMode(self):
+		if not app.IsPressed(app.DIK_LCONTROL):
+			return
+
+		if player.GetStatus(player.LEVEL) < constInfo.PVPMODE_PROTECTED_LEVEL:
+			self.__NotifyError(localeInfo.OPTION_PVPMODE_PROTECT % (constInfo.PVPMODE_PROTECTED_LEVEL))
+			return
+
+		curTime = app.GetTime()
+		if curTime - self.lastPKModeSendedTime < constInfo.PVPMODE_ACCELKEY_DELAY:
+			return
+
+		self.lastPKModeSendedTime = curTime
+
+		curPKMode = player.GetPKMode()
+		nextPKMode = curPKMode + 1
+		if nextPKMode == player.PK_MODE_PROTECT:
+			if 0 == player.GetGuildID():
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.OPTION_PVPMODE_CANNOT_SET_GUILD_MODE)
+				nextPKMode = 0
+			else:
+				nextPKMode = player.PK_MODE_GUILD
+
+		elif nextPKMode == player.PK_MODE_MAX_NUM:
+			nextPKMode = 0
+
+		net.SendCommandPacket("/PKMode " + str(nextPKMode))
+		print "/PKMode " + str(nextPKMode)
+
+	def OnChangePKMode(self):
+		self.interface.OnChangePKMode()
+
+		try:
+			if player.GetStatus(player.LEVEL) < constInfo.PVPMODE_PROTECTED_LEVEL:
+				self.__NotifyError(localeInfo.OPTION_PVPMODE_MESSAGE_DICT[player.GetPKMode()])
+				return
+		except KeyError:
+			print "UNKNOWN PVPMode[%d]" % (player.GetPKMode())
+
+		#if constInfo.PVPMODE_TEST_ENABLE:
+		#	curPKMode = player.GetPKMode()
+		#	alignment, grade = chr.testGetPKData()
+		#	self.pkModeNameDict = { 0 : "PEACE", 1 : "REVENGE", 2 : "FREE", 3 : "PROTECT", }
+		#	self.testPKMode.SetText("Current PK Mode : " + self.pkModeNameDict.get(curPKMode, "UNKNOWN"))
+		#	self.testAlignment.SetText("Current Alignment : " + str(alignment) + " (" + localeInfo.TITLE_NAME_LIST[grade] + ")")
+
+	###############################################################################################
+	###############################################################################################
+	## Game Callback Functions
+
+	# Start
+	def StartGame(self):
+		self.RefreshInventory()
+		self.RefreshEquipment()
+		self.RefreshCharacter()
+		self.RefreshSkill()
+
+	# Refresh
+	def CheckGameButton(self):
+		if self.interface:
+			self.interface.CheckGameButton()
+
+	def RefreshAlignment(self):
+		self.interface.RefreshAlignment()
+
+	def RefreshStatus(self):
+		self.CheckGameButton()
+
+		if self.interface:
+			self.interface.RefreshStatus()
+
+		if self.playerGauge:
+			self.playerGauge.RefreshGauge()
+
+	def RefreshStamina(self):
+		self.interface.RefreshStamina()
+
+	def RefreshSkill(self):
+		self.CheckGameButton()
+		if self.interface:
+			self.interface.RefreshSkill()
+
+	if app.ENABLE_QUEST_RENEWAL:
+		def RefreshQuest(self, quest_type, quest_index):
+			self.interface.RefreshQuest(quest_type, quest_index)
+
+		def DeleteQuest(self, quest_type, quest_index):
+			self.interface.DeleteQuest(quest_type, quest_index)
+	else:
+		def RefreshQuest(self):
+			self.interface.RefreshQuest()
+
+	def RefreshMessenger(self):
+		self.interface.RefreshMessenger()
+
+	def RefreshGuildInfoPage(self):
+		self.interface.RefreshGuildInfoPage()
+
+	def RefreshGuildBoardPage(self):
+		self.interface.RefreshGuildBoardPage()
+
+	def RefreshGuildMemberPage(self):
+		self.interface.RefreshGuildMemberPage()
+
+	def RefreshGuildMemberPageGradeComboBox(self):
+		self.interface.RefreshGuildMemberPageGradeComboBox()
+
+	def RefreshGuildSkillPage(self):
+		self.interface.RefreshGuildSkillPage()
+
+	def RefreshGuildGradePage(self):
+		self.interface.RefreshGuildGradePage()
+
+	def OnBlockMode(self, mode):
+		self.interface.OnBlockMode(mode)
+
+	def OpenQuestWindow(self, skin, idx):
+		self.interface.OpenQuestWindow(skin, idx)
+
+	def AskGuildName(self):
+		guildNameBoard = uiCommon.InputDialog()
+		guildNameBoard.SetTitle(localeInfo.GUILD_NAME)
+		guildNameBoard.SetAcceptEvent(ui.__mem_func__(self.ConfirmGuildName))
+		guildNameBoard.SetCancelEvent(ui.__mem_func__(self.CancelGuildName))
+		guildNameBoard.Open()
+
+		self.guildNameBoard = guildNameBoard
+
+	def ConfirmGuildName(self):
+		guildName = self.guildNameBoard.GetText()
+		if not guildName:
+			return
+
+		if net.IsInsultIn(guildName):
+			self.PopupMessage(localeInfo.GUILD_CREATE_ERROR_INSULT_NAME)
+			return
+
+		net.SendAnswerMakeGuildPacket(guildName)
+		self.guildNameBoard.Close()
+		self.guildNameBoard = None
+		return True
+
+	def CancelGuildName(self):
+		self.guildNameBoard.Close()
+		self.guildNameBoard = None
+		return True
+
+	## Refine
+	def PopupMessage(self, msg):
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(msg, 0, localeInfo.UI_OK)
+
+	def OpenRefineDialog(self, targetItemPos, nextGradeItemVnum, cost, prob, type, apply_random_list = None, src_vnum = 0):
+		self.interface.OpenRefineDialog(targetItemPos, nextGradeItemVnum, cost, prob, type, apply_random_list, src_vnum)
+
+	def AppendMaterialToRefineDialog(self, vnum, count):
+		self.interface.AppendMaterialToRefineDialog(vnum, count)
+
+	def RunUseSkillEvent(self, slotIndex, coolTime):
+		self.interface.OnUseSkill(slotIndex, coolTime)
+
+	def ClearAffects(self):
+		self.affectShower.ClearAffects()
+
+	def SetAffect(self, affect):
+		self.affectShower.SetAffect(affect)
+
+	def ResetAffect(self, affect):
+		self.affectShower.ResetAffect(affect)
+
+	# UNKNOWN_UPDATE
+	def BINARY_NEW_AddAffect(self, type, pointIdx, value, duration):
+		if app.ENABLE_SET_ITEM:
+			if self.affectShower:
+				self.affectShower.BINARY_NEW_AddAffect(type, pointIdx, value, duration)
+		else:
+			self.affectShower.BINARY_NEW_AddAffect(type, pointIdx, value, duration)
+
+		if chr.NEW_AFFECT_DRAGON_SOUL_DECK1 == type or chr.NEW_AFFECT_DRAGON_SOUL_DECK2 == type:
+			self.interface.DragonSoulActivate(type - chr.NEW_AFFECT_DRAGON_SOUL_DECK1)
+		elif chr.NEW_AFFECT_DRAGON_SOUL_QUALIFIED == type:
+			self.BINARY_DragonSoulGiveQuilification()
+		elif app.ENABLE_DS_SET and chr.NEW_AFFECT_DS_SET == type:
+			self.interface.DragonSoulSetGrade(value)
+
+	def BINARY_NEW_RemoveAffect(self, type, pointIdx):
+		if app.ENABLE_SET_ITEM:
+			if self.affectShower:
+				self.affectShower.BINARY_NEW_RemoveAffect(type, pointIdx)
+		else:
+			self.affectShower.BINARY_NEW_RemoveAffect(type, pointIdx)
+
+		if chr.NEW_AFFECT_DRAGON_SOUL_DECK1 == type or chr.NEW_AFFECT_DRAGON_SOUL_DECK2 == type:
+			self.interface.DragonSoulDeactivate()
+		elif app.ENABLE_DS_SET and chr.NEW_AFFECT_DS_SET == type:
+			self.interface.DragonSoulSetGrade(0)
+
+	def BINARY_NEW_UpdateAffect(self, type, point_type, value, duration):
+		self.affectShower.BINARY_NEW_UpdateAffect(type, point_type, value, duration)
+	# END_OF_UNKNOWN_UPDATE
+
+	def ActivateSkillSlot(self, slotIndex):
+		if self.interface:
+			self.interface.OnActivateSkill(slotIndex)
+
+	def DeactivateSkillSlot(self, slotIndex):
+		if self.interface:
+			self.interface.OnDeactivateSkill(slotIndex)
+
+	def RefreshEquipment(self):
+		if self.interface:
+			self.interface.RefreshInventory()
+
+	def RefreshInventory(self):
+		if self.interface:
+			self.interface.RefreshInventory()
+
+	def RefreshCharacter(self):
+		if self.interface:
+			self.interface.RefreshCharacter()
+
+	def OnGameOver(self, map_index, dialog_type):
+		self.CloseTargetBoard()
+		self.OpenRestartDialog(map_index, dialog_type)
+
+	def OpenRestartDialog(self, map_index, dialog_type):
+		self.interface.OpenRestartDialog(map_index, dialog_type)
+
+	def ChangeCurrentSkill(self, skillSlotNumber):
+		self.interface.OnChangeCurrentSkill(skillSlotNumber)
+
+	## TargetBoard
+	def SetPCTargetBoard(self, vid, name):
+		if self.interface.IsHideUiMode == True:
+			return
+
+		self.targetBoard.Open(vid, name)
+
+		if app.IsPressed(app.DIK_LCONTROL):
+			if not player.IsSameEmpire(vid):
+				return
+
+			if player.IsMainCharacterIndex(vid):
+				return
+			elif chr.INSTANCE_TYPE_BUILDING == chr.GetInstanceType(vid):
+				return
+
+			self.interface.OpenWhisperDialog(name)
+
+	def RefreshTargetBoardByVID(self, vid):
+		if self.targetBoard:
+			self.targetBoard.RefreshByVID(vid)
+
+	def RefreshTargetBoardByName(self, name):
+		if self.targetBoard:
+			self.targetBoard.RefreshByName(name)
+
+	def __RefreshTargetBoard(self):
+		if self.targetBoard:
+			self.targetBoard.Refresh()
+
+	if app.ENABLE_VIEW_TARGET_DECIMAL_HP:
+		def SetHPTargetBoard(self, vid, hpPercentage, iMinHP, iMaxHP):
+			if self.interface.IsHideUiMode == True:
+				return
+
+			if vid != self.targetBoard.GetTargetVID():
+				self.targetBoard.ResetTargetBoard()
+				self.targetBoard.SetEnemyVID(vid)
+
+			self.targetBoard.SetHP(hpPercentage, iMinHP, iMaxHP)
+			self.targetBoard.Show()
+	else:
+		def SetHPTargetBoard(self, vid, hpPercentage):
+			if self.interface.IsHideUiMode == True:
+				return
+
+			if vid != self.targetBoard.GetTargetVID():
+				self.targetBoard.ResetTargetBoard()
+				self.targetBoard.SetEnemyVID(vid)
+
+			self.targetBoard.SetHP(hpPercentage)
+			self.targetBoard.Show()
+
+	if app.ENABLE_DEFENSE_WAVE:
+		def SetHPAllianceTargetBoard(self, vid, hp, hpMax):
+			if self.interface.IsHideUiMode == True:
+				return
+
+			if not vid:
+				self.allianceTargetBoard.Close()
+				return
+
+			if vid != self.allianceTargetBoard.GetTargetVID():
+				self.allianceTargetBoard.ResetTargetBoard()
+				self.allianceTargetBoard.SetTarget(vid)
+
+			self.allianceTargetBoard.SetHP(hp, hpMax)
+			self.allianceTargetBoard.Show()
+
+	def CloseTargetBoardIfDifferent(self, vid):
+		if vid != self.targetBoard.GetTargetVID():
+			self.targetBoard.Close()
+
+	def CloseTargetBoard(self):
+		self.targetBoard.Close()
+
+	if app.ENABLE_ELEMENT_ADD:
+		def ShowTargetElementEnchant(self, element_enchants_dict):
+			if self.targetBoard:
+				self.targetBoard.ShowElementImg(element_enchants_dict)
+
+	## View Equipment
+	def OpenEquipmentDialog(self, vid):
+		self.interface.OpenEquipmentDialog(vid)
+
+	def SetEquipmentDialogItem(self, window, vid, slot_index, vnum, count, change_look_vnum, refine_element, apply_random_list, set_value):
+		self.interface.SetEquipmentDialogItem(window, vid, slot_index, vnum, count, change_look_vnum, refine_element, apply_random_list, set_value)
+
+	def SetEquipmentDialogSocket(self, window, vid, slot_index, socket_index, value):
+		self.interface.SetEquipmentDialogSocket(window, vid, slot_index, socket_index, value)
+
+	def SetEquipmentDialogAttr(self, window, vid, slot_index, attr_index, type, value):
+		self.interface.SetEquipmentDialogAttr(window, vid, slot_index, attr_index, type, value)
+
+	# SHOW_LOCAL_MAP_NAME
+	def ShowMapName(self, mapName, x, y):
+		if self.mapNameShower:
+			self.mapNameShower.ShowMapName(mapName, x, y)
+
+		if self.interface:
+			self.interface.SetMapName(mapName)
+	# END_OF_SHOW_LOCAL_MAP_NAME
+
+	if app.ENABLE_EXTENDED_BATTLE_PASS:
+		def BINARY_ExtOpenBattlePass(self):
+			if self.interface:
+				self.interface.ReciveOpenExtBattlePass()
+			
+		def BINARY_ExtBattlePassAddGeneralInfo(self, BattlePassType, BattlePassName, BattlePassID, battlePassStartTime, battlePassEndTime):
+			if self.interface:
+				self.interface.AddExtendedBattleGeneralInfo(BattlePassType, BattlePassName, BattlePassID, battlePassStartTime, battlePassEndTime)
+				
+		def BINARY_ExtBattlePassAddMission(self, battlepassType, battlepassID, missionIndex, missionType, missionInfo1, missionInfo2, missionInfo3):
+			if self.interface:
+				self.interface.AddExtendedBattlePassMission(battlepassType, battlepassID, missionIndex, missionType, missionInfo1, missionInfo2, missionInfo3)
+
+		def BINARY_ExtBattlePassAddMissionReward(self, battlepassType, battlepassID, missionIndex, missionType, itemVnum, itemCount):
+			if self.interface:
+				self.interface.AddExtendedBattlePassMissionReward(battlepassType, battlepassID, missionIndex, missionType, itemVnum, itemCount)
+
+		def BINARY_ExtBattlePassUpdate(self, battlepassType, missionIndex, missionType, newProgress):
+			if self.interface:
+				self.interface.UpdateExtendedBattlePassMission(battlepassType, missionIndex, missionType, newProgress)
+
+		def BINARY_ExtBattlePassAddReward(self, battlepassType, battlepassID, itemVnum, itemCount):
+			if self.interface:
+				self.interface.AddExtendedBattlePassReward(battlepassType, battlepassID, itemVnum, itemCount)
+		
+		def BINARY_ExtBattlePassAddRanklistEntry(self, playername, battlepassType, battlepassID, startTime, endTime):
+			if self.interface:
+				self.interface.AddExtBattlePassRanklistEntry(playername, battlepassType, battlepassID, startTime, endTime)
+
+	def BINARY_OpenAtlasWindow(self):
+		self.interface.BINARY_OpenAtlasWindow()
+
+	## Chat
+	if app.ENABLE_MULTI_LANGUAGE_SYSTEM:
+		def OnRecvWhisper(self, mode, name, line, language):
+			if mode == chat.WHISPER_TYPE_GM:
+				self.interface.RegisterGameMasterName(name)
+
+			if localeInfo.IsARABIC():
+				chat.AppendWhisper(mode, name, name + " : ", language)
+				chat.AppendWhisper(mode, name, line)
+			else:
+				chat.AppendWhisper(mode, name, line, language)
+
+			self.interface.RecvWhisper(name)
+	else:
+		def OnRecvWhisper(self, mode, name, line):
+			if mode == chat.WHISPER_TYPE_GM:
+				self.interface.RegisterGameMasterName(name)
+
+			if localeInfo.IsARABIC():
+				chat.AppendWhisper(mode, name, name + " : ")
+				chat.AppendWhisper(mode, name, line)
+			else:
+				chat.AppendWhisper(mode, name, line)
+
+			self.interface.RecvWhisper(name)
+
+	def OnRecvWhisperSystemMessage(self, mode, name, line):
+		chat.AppendWhisper(chat.WHISPER_TYPE_SYSTEM, name, line)
+		self.interface.RecvWhisper(name)
+
+	def OnRecvWhisperError(self, mode, name, line):
+		if localeInfo.WHISPER_ERROR.has_key(mode):
+			chat.AppendWhisper(chat.WHISPER_TYPE_SYSTEM, name, localeInfo.WHISPER_ERROR[mode](name))
+		else:
+			chat.AppendWhisper(chat.WHISPER_TYPE_SYSTEM, name, "Whisper Unknown Error(mode=%d, name=%s)" % (mode, name))
+		self.interface.RecvWhisper(name)
+
+	def RecvWhisper(self, name):
+		self.interface.RecvWhisper(name)
+
+	def OnPickMoney(self, money):
+		if app.ENABLE_CHATTING_WINDOW_RENEWAL:
+			chat.AppendChat(chat.CHAT_TYPE_MONEY_INFO, localeInfo.GAME_PICK_MONEY % (money))
+		else:
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GAME_PICK_MONEY % (money))
+
+	if app.ENABLE_CHEQUE_SYSTEM:
+		def OnPickCheque(self, cheque):
+			if app.ENABLE_CHATTING_WINDOW_RENEWAL:
+				chat.AppendChat(chat.CHAT_TYPE_MONEY_INFO, localeInfo.CHEQUE_SYSTEM_PICK_WON % (cheque))
+			else:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.CHEQUE_SYSTEM_PICK_WON % (cheque))
+
+	if app.ENABLE_GEM_SYSTEM:
+		def OnPickGem(self, gem):
+			if app.ENABLE_CHATTING_WINDOW_RENEWAL:
+				chat.AppendChat(chat.CHAT_TYPE_MONEY_INFO, localeInfo.GEM_SYSTEM_PICK_GEM % (gem))
+			else:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_SYSTEM_PICK_GEM % (gem))
+
+		def OpenGemShop(self):
+			self.interface.OpenGemShop()
+		def CloseGemShop(self):
+			self.interface.CloseGemShop()
+		def RefreshGemShopWindow(self):
+			self.interface.RefreshGemShopWindow()
+		def GemShopSlotBuy(self, slotindex, enable):
+			self.interface.GemShopSlotBuy(slotindex, enable)
+		def BINARY_OpenSelectItemWindowEx(self):
+			self.interface.BINARY_OpenSelectItemWindowEx()
+		def BINARY_RefreshSelectItemWindowEx(self):
+			self.interface.BINARY_RefreshSelectItemWindowEx()
+		def GemShopSlotAdd(self, slotindex, enable):
+			self.interface.GemShopSlotAdd(slotindex, enable)
+
+	def OpenCostumeWindow(self):
+		self.interface.OpenCostumeWindow()
+
+	if app.ENABLE_MOVE_CHANNEL:
+		# 2019.09.03.owsap - Load server info (server name)
+		def __LoadChannelInfo(self):
+			try:
+				file = open("channel.inf")
+				lines = file.readlines()
+
+				if len(lines) > 0:
+					tokens = lines[0].split()
+
+					selServerID = int(tokens[0])
+					selChannelID = int(tokens[1])
+
+					if len(tokens) == 3:
+						regionID = int(tokens[2])
+
+					return regionID, selServerID, selChannelID
+			except:
+				print "GameWindow.__LoadChannelInfo - OpenError"
+				return -1, -1, -1
+
+		def __SeverInfo(self, channelNumber, mapIndex):
+			_chNum = int(channelNumber.strip())
+			_mapIdx = int(mapIndex.strip())
+
+			if _chNum == 99 or _mapIdx >= 10000:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.MOVE_CHANNEL_NOTICE % 0)
+			else:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.MOVE_CHANNEL_NOTICE % _chNum)
+
+			net.SetChannelNumber(_chNum) # 2019.09.02.owsap
+			net.SetMapIndex(_mapIdx)
+
+			# 2019.09.02.owsap - update server info
+			import serverInfo
+			loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
+			_svName = serverInfo.REGION_DICT[loadRegionID][loadServerID]["name"]
+			_chName = serverInfo.REGION_DICT[loadRegionID][loadServerID]["channel"]
+			net.SetServerInfo(("%s, %s " % (_svName, "CH0" if _chNum == 99 else _chName[_chNum]["name"])).strip())
+
+			self.interface.RefreshServerInfo()
+
+	def OnShopError(self, type):
+		try:
+			self.PopupMessage(localeInfo.SHOP_ERROR_DICT[type])
+		except KeyError:
+			self.PopupMessage(localeInfo.SHOP_ERROR_UNKNOWN % (type))
+
+	def OnSafeBoxError(self):
+		self.PopupMessage(localeInfo.SAFEBOX_ERROR)
+
+	def OnFishingSuccess(self, isFish, fishName):
+		chat.AppendChatWithDelay(chat.CHAT_TYPE_INFO, localeInfo.FISHING_SUCCESS(isFish, fishName), 2000)
+
+	# ADD_FISHING_MESSAGE
+	def OnFishingNotifyUnknown(self):
+		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.FISHING_UNKNOWN)
+
+	def OnFishingWrongPlace(self):
+		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.FISHING_WRONG_PLACE)
+
+	def OnCannotFishingRideMount(self, vid):
+		textTail.RegisterInfoTail(vid, localeInfo.CANNOT_FISHING_RIDE_MOUNT)
+	# END_OF_ADD_FISHING_MESSAGE
+
+	def OnFishingNotify(self, isFish, fishName):
+		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.FISHING_NOTIFY(isFish, fishName))
+
+	def OnFishingFailure(self):
+		chat.AppendChatWithDelay(chat.CHAT_TYPE_INFO, localeInfo.FISHING_FAILURE, 2000)
+
+	def OnCannotPickItem(self):
+		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GAME_CANNOT_PICK_ITEM)
+
+	# MINING
+	def OnCannotMining(self):
+		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GAME_CANNOT_MINING)
+	# END_OF_MINING
+
+	def OnCannotUseSkill(self, vid, type):
+		if localeInfo.USE_SKILL_ERROR_TAIL_DICT.has_key(type):
+			textTail.RegisterInfoTail(vid, localeInfo.USE_SKILL_ERROR_TAIL_DICT[type])
+
+		if localeInfo.USE_SKILL_ERROR_CHAT_DICT.has_key(type):
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_SKILL_ERROR_CHAT_DICT[type])
+
+	def OnCannotShotError(self, vid, type):
+		textTail.RegisterInfoTail(vid, localeInfo.SHOT_ERROR_TAIL_DICT.get(type, localeInfo.SHOT_ERROR_UNKNOWN % (type)))
+
+	## PointReset
+	def StartPointReset(self):
+		self.interface.OpenPointResetDialog()
+
+	## Shop
+	def StartShop(self, vid):
+		self.interface.OpenShopDialog(vid)
+
+	def EndShop(self):
+		self.interface.CloseShopDialog()
+
+	def RefreshShop(self):
+		self.interface.RefreshShopDialog()
+
+	def SetShopSellingPrice(self, Price):
+		pass
+
+	## Exchange
+	def StartExchange(self):
+		self.interface.StartExchange()
+
+	def EndExchange(self):
+		self.interface.EndExchange()
+
+	def RefreshExchange(self):
+		self.interface.RefreshExchange()
+
+	if app.WJ_ENABLE_TRADABLE_ICON:
+		def AddExchangeItemSlotIndex(self, idx):
+			self.interface.AddExchangeItemSlotIndex(idx)
+
+	## Party
+	# Æ¼   Ã° .
+	if app.ENABLE_NEW_USER_CARE:
+		def RecvPartyInviteQuestion(self, leaderVID, leaderName):
+			partyInviteQuestionDialog = uiCommon.QuestionDialogWithTimeLimit()
+			partyInviteQuestionDialog.SetAcceptEvent(lambda arg=True: self.AnswerPartyInvite(arg))
+			partyInviteQuestionDialog.SetCancelEvent(lambda arg=False: self.AnswerPartyInvite(arg))
+			partyInviteQuestionDialog.Open(leaderName + localeInfo.PARTY_DO_YOU_JOIN, 10)
+			partyInviteQuestionDialog.SetTimeOverMsg(localeInfo.PARTY_ANSWER_TIMEOVER)
+			partyInviteQuestionDialog.SetCancelOnTimeOver()
+			partyInviteQuestionDialog.partyLeaderVID = leaderVID
+			self.partyInviteQuestionDialog = partyInviteQuestionDialog
+	else:
+		def RecvPartyInviteQuestion(self, leaderVID, leaderName):
+			partyInviteQuestionDialog = uiCommon.QuestionDialog()
+			partyInviteQuestionDialog.SetText(leaderName + localeInfo.PARTY_DO_YOU_JOIN)
+			partyInviteQuestionDialog.SetAcceptEvent(lambda arg=True: self.AnswerPartyInvite(arg))
+			partyInviteQuestionDialog.SetCancelEvent(lambda arg=False: self.AnswerPartyInvite(arg))
+			partyInviteQuestionDialog.Open()
+			partyInviteQuestionDialog.partyLeaderVID = leaderVID
+			self.partyInviteQuestionDialog = partyInviteQuestionDialog
+
+	def AnswerPartyInvite(self, answer):
+		if not self.partyInviteQuestionDialog:
+			return
+
+		partyLeaderVID = self.partyInviteQuestionDialog.partyLeaderVID
+
+		# Æ¼Ô¿  Å¸  .
+		if not app.ENABLE_NEW_USER_CARE:
+			distance = player.GetCharacterDistance(partyLeaderVID)
+			if distance < 0.0 or distance > 5000:
+				answer = False
+
+		net.SendPartyInviteAnswerPacket(partyLeaderVID, answer)
+
+		self.partyInviteQuestionDialog.Close()
+		self.partyInviteQuestionDialog = None
+
+	if app.WJ_SHOW_PARTY_ON_MINIMAP and app.ENABLE_PARTY_CHANNEL_FIX:
+		def AddPartyMember(self, pid, name, mapIdx, channel):
+			self.interface.AddPartyMember(pid, name, mapIdx, channel)
+	elif app.WJ_SHOW_PARTY_ON_MINIMAP:
+		def AddPartyMember(self, pid, name, mapIdx):
+			self.interface.AddPartyMember(pid, name, mapIdx)
+	else:
+		def AddPartyMember(self, pid, name):
+			self.interface.AddPartyMember(pid, name)
+
+	def UpdatePartyMemberInfo(self, pid):
+		self.interface.UpdatePartyMemberInfo(pid)
+
+	def RemovePartyMember(self, pid):
+		self.interface.RemovePartyMember(pid)
+		self.__RefreshTargetBoard()
+
+	if app.WJ_SHOW_PARTY_ON_MINIMAP and app.ENABLE_PARTY_CHANNEL_FIX:
+		def LinkPartyMember(self, pid, vid, mapIdx, channel):
+			self.interface.LinkPartyMember(pid, vid, mapIdx, channel)
+	elif app.WJ_SHOW_PARTY_ON_MINIMAP:
+		def LinkPartyMember(self, pid, vid, mapIdx):
+			self.interface.LinkPartyMember(pid, vid, mapIdx)
+	else:
+		def LinkPartyMember(self, pid, vid):
+			self.interface.LinkPartyMember(pid, vid)
+
+	def UnlinkPartyMember(self, pid):
+		self.interface.UnlinkPartyMember(pid)
+
+	def UnlinkAllPartyMember(self):
+		self.interface.UnlinkAllPartyMember()
+
+	def ExitParty(self):
+		self.interface.ExitParty()
+		self.RefreshTargetBoardByVID(self.targetBoard.GetTargetVID())
+
+	def ChangePartyParameter(self, distributionMode):
+		self.interface.ChangePartyParameter(distributionMode)
+
+	## Messenger
+	def OnMessengerAddFriendQuestion(self, name):
+		messengerAddFriendQuestion = uiCommon.QuestionDialog2()
+		messengerAddFriendQuestion.SetText1(localeInfo.MESSENGER_DO_YOU_ACCEPT_ADD_FRIEND_1 % (name))
+		messengerAddFriendQuestion.SetText2(localeInfo.MESSENGER_DO_YOU_ACCEPT_ADD_FRIEND_2)
+		messengerAddFriendQuestion.SetAcceptEvent(ui.__mem_func__(self.OnAcceptAddFriend))
+		messengerAddFriendQuestion.SetCancelEvent(ui.__mem_func__(self.OnDenyAddFriend))
+		messengerAddFriendQuestion.Open()
+		messengerAddFriendQuestion.name = name
+		self.messengerAddFriendQuestion = messengerAddFriendQuestion
+
+	def OnAcceptAddFriend(self):
+		name = self.messengerAddFriendQuestion.name
+		net.SendCommandPacket("/messenger_auth y " + name)
+		self.OnCloseAddFriendQuestionDialog()
+		return True
+
+	def OnDenyAddFriend(self):
+		name = self.messengerAddFriendQuestion.name
+		net.SendCommandPacket("/messenger_auth n " + name)
+		self.OnCloseAddFriendQuestionDialog()
+		return True
+
+	def OnCloseAddFriendQuestionDialog(self):
+		self.messengerAddFriendQuestion.Close()
+		self.messengerAddFriendQuestion = None
+		return True
+
+	## SafeBox
+	def OpenSafeboxWindow(self, size):
+		self.interface.OpenSafeboxWindow(size)
+
+	def RefreshSafebox(self):
+		self.interface.RefreshSafebox()
+
+	def RefreshSafeboxMoney(self):
+		self.interface.RefreshSafeboxMoney()
+
+	# ITEM_MALL
+	def OpenMallWindow(self, size):
+		self.interface.OpenMallWindow(size)
+
+	def RefreshMall(self):
+		self.interface.RefreshMall()
+	# END_OF_ITEM_MALL
+
+	## Guild
+	def RecvGuildInviteQuestion(self, guildID, guildName):
+		guildInviteQuestionDialog = uiCommon.QuestionDialog()
+		guildInviteQuestionDialog.SetText(guildName + localeInfo.GUILD_DO_YOU_JOIN)
+		guildInviteQuestionDialog.SetAcceptEvent(lambda arg=True: self.AnswerGuildInvite(arg))
+		guildInviteQuestionDialog.SetCancelEvent(lambda arg=False: self.AnswerGuildInvite(arg))
+		guildInviteQuestionDialog.Open()
+		guildInviteQuestionDialog.guildID = guildID
+		self.guildInviteQuestionDialog = guildInviteQuestionDialog
+
+	def AnswerGuildInvite(self, answer):
+		if not self.guildInviteQuestionDialog:
+			return
+
+		guildLeaderVID = self.guildInviteQuestionDialog.guildID
+		net.SendGuildInviteAnswerPacket(guildLeaderVID, answer)
+
+		self.guildInviteQuestionDialog.Close()
+		self.guildInviteQuestionDialog = None
+
+	def DeleteGuild(self):
+		self.interface.DeleteGuild()
+
+	## Clock
+	def ShowClock(self, second):
+		self.interface.ShowClock(second)
+
+	def HideClock(self):
+		self.interface.HideClock()
+
+	def UseInventoryItemInQuickSlot(self, global_slot_index):
+		self.interface.UseInventoryItemInQuickSlot(global_slot_index)
+
+	## Emotion
+	def BINARY_ActEmotion(self, emotionIndex):
+		if self.interface.wndCharacter:
+			self.interface.wndCharacter.ActEmotion(emotionIndex)
+
+	###############################################################################################
+	###############################################################################################
+	## Keyboard Functions
+
+	def CheckFocus(self):
+		if False == self.IsFocus():
+			if True == self.interface.IsOpenChat():
+				self.interface.ToggleChat()
+
+			self.SetFocus()
+
+	def SaveScreen(self):
+		print "save screen"
+
+		# SCREENSHOT_CWDSAVE
+		if SCREENSHOT_CWDSAVE:
+			if not os.path.exists(os.getcwd() + os.sep + "screenshot"):
+				os.mkdir(os.getcwd() + os.sep + "screenshot")
+
+			(succeeded, name) = grp.SaveScreenShotToPath(os.getcwd()+os.sep+"screenshot"+os.sep)
+		elif SCREENSHOT_DIR:
+			(succeeded, name) = grp.SaveScreenShot(SCREENSHOT_DIR)
+		else:
+			(succeeded, name) = grp.SaveScreenShot()
+		# END_OF_SCREENSHOT_CWDSAVE
+
+		if succeeded:
+			pass
+			"""
+			chat.AppendChat(chat.CHAT_TYPE_INFO, name + localeInfo.SCREENSHOT_SAVE1)
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.SCREENSHOT_SAVE2)
+			"""
+		else:
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.SCREENSHOT_SAVE_FAILURE)
+
+	def ShowName(self):
+		self.ShowNameFlag = True
+		self.playerGauge.EnableShowAlways()
+		if not app.ENABLE_KEYCHANGE_SYSTEM:
+			player.SetQuickPage(self.quickSlotPageIndex + 1)
+
+	# ADD_ALWAYS_SHOW_NAME
+	def __IsShowName(self):
+		if systemSetting.IsAlwaysShowName():
+			return True
+
+		if self.ShowNameFlag:
+			return True
+
+		return False
+	# END_OF_ADD_ALWAYS_SHOW_NAME
+
+	def HideName(self):
+		self.ShowNameFlag = False
+		self.playerGauge.DisableShowAlways()
+		if not app.ENABLE_KEYCHANGE_SYSTEM:
+			player.SetQuickPage(self.quickSlotPageIndex)
+
+	def ShowMouseImage(self):
+		self.interface.ShowMouseImage()
+
+	def HideMouseImage(self):
+		self.interface.HideMouseImage()
+
+	def StartAttack(self):
+		player.SetAttackKeyState(True)
+
+	def EndAttack(self):
+		player.SetAttackKeyState(False)
+
+	def MoveUp(self):
+		player.SetSingleDIKKeyState(app.DIK_UP, True)
+
+	def MoveDown(self):
+		player.SetSingleDIKKeyState(app.DIK_DOWN, True)
+
+	def MoveLeft(self):
+		player.SetSingleDIKKeyState(app.DIK_LEFT, True)
+
+	def MoveRight(self):
+		player.SetSingleDIKKeyState(app.DIK_RIGHT, True)
+
+	def StopUp(self):
+		player.SetSingleDIKKeyState(app.DIK_UP, False)
+
+	def StopDown(self):
+		player.SetSingleDIKKeyState(app.DIK_DOWN, False)
+
+	def StopLeft(self):
+		player.SetSingleDIKKeyState(app.DIK_LEFT, False)
+
+	def StopRight(self):
+		player.SetSingleDIKKeyState(app.DIK_RIGHT, False)
+
+	def PickUpItem(self):
+		player.PickCloseItem()
+
+	###############################################################################################
+	###############################################################################################
+	## Event Handler
+
+	def OnKeyDown(self, key):
+		if self.interface.wndWeb and self.interface.wndWeb.IsShow():
+			return
+
+		if app.ENABLE_POPUP_NOTICE:
+			if self.interface.wndPopupNotice and self.interface.wndPopupNotice.IsShow():
+				return
+
+		if key == app.DIK_ESC:
+			self.RequestDropItem(False)
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+		try:
+			if app.ENABLE_KEYCHANGE_SYSTEM:
+				if self.wndKeyChange.IsOpen() == 1:
+					## Å° Ã¢ . ×¸  Ù² 
+					if self.wndKeyChange.IsSelectKeySlot():
+						if app.IsPressed(app.DIK_LCONTROL) or app.IsPressed(app.DIK_RCONTROL):
+							if self.wndKeyChange.IsChangeKey(self.wndKeyChange.GetSelectSlotNumber()):
+								self.wndKeyChange.ChangeKey(key + app.DIK_LCONTROL + self.ADDKEYBUFFERCONTROL)
+							else:
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.KEYCHANGE_IMPOSSIBLE_CHANGE)
+						elif app.IsPressed(app.DIK_LALT) or app.IsPressed(app.DIK_RALT):
+							if self.wndKeyChange.IsChangeKey(self.wndKeyChange.GetSelectSlotNumber()):
+								self.wndKeyChange.ChangeKey(key + app.DIK_LALT + self.ADDKEYBUFFERALT)
+							else:
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.KEYCHANGE_IMPOSSIBLE_CHANGE)
+						elif app.IsPressed(app.DIK_LSHIFT) or app.IsPressed(app.DIK_RSHIFT):
+							if self.wndKeyChange.IsChangeKey(self.wndKeyChange.GetSelectSlotNumber()):
+								self.wndKeyChange.ChangeKey(key + app.DIK_LSHIFT + self.ADDKEYBUFFERSHIFT)
+							else:
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.KEYCHANGE_IMPOSSIBLE_CHANGE)
+						else:
+							self.wndKeyChange.ChangeKey(key)
+				else:
+					player.OnKeyDown(key)
+			else:
+				self.onPressKeyDict[key]()
+		except KeyError:
+			pass
+		except:
+			raise
+
+		return True
+
+	def OnKeyUp(self, key):
+		if app.ENABLE_KEYCHANGE_SYSTEM:
+			player.OnKeyUp(key)
+		else:
+			try:
+				self.onClickKeyDict[key]()
+			except KeyError:
+				pass
+			except:
+				raise
+
+		return True
+
+	def OnMouseLeftButtonDown(self):
+		if self.interface.BUILD_OnMouseLeftButtonDown():
+			return
+
+		if mouseModule.mouseController.isAttached():
+			self.CheckFocus()
+		else:
+			hyperlink = ui.GetHyperlink()
+			if hyperlink:
+				return
+			else:
+				self.CheckFocus()
+				player.SetMouseState(player.MBT_LEFT, player.MBS_PRESS);
+
+		return True
+
+	def OnMouseLeftButtonUp(self):
+		if self.interface.BUILD_OnMouseLeftButtonUp():
+			return
+
+		if mouseModule.mouseController.isAttached():
+			attachedType = mouseModule.mouseController.GetAttachedType()
+			attachedItemIndex = mouseModule.mouseController.GetAttachedItemIndex()
+			attachedItemSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
+			attachedItemCount = mouseModule.mouseController.GetAttachedItemCount()
+
+			## QuickSlot
+			if player.SLOT_TYPE_QUICK_SLOT == attachedType:
+				player.RequestDeleteGlobalQuickSlot(attachedItemSlotPos)
+
+			## Inventory
+			elif player.SLOT_TYPE_INVENTORY == attachedType:
+				if player.ITEM_MONEY == attachedItemIndex:
+					# Note : Îº   , Ù¸  Å¬Ï¸  Ô¼
+					if app.ENABLE_CHEQUE_SYSTEM:
+						cheque = mouseModule.mouseController.GetCheque()
+						self.__PutMoney(attachedType, attachedItemCount, self.PickingCharacterIndex, cheque)
+					else:
+						self.__PutMoney(attachedType, attachedItemCount, self.PickingCharacterIndex)
+				else:
+					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
+
+			## DragonSoul
+			elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == attachedType:
+				self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				## Ù´Ú¿  Ç¼(,)  .
+				if player.SLOT_TYPE_ACCE == attachedType:
+					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
+
+			if app.ENABLE_EXTEND_INVEN_SYSTEM:
+				if player.SLOT_TYPE_EQUIPMENT == attachedType or \
+					player.SLOT_TYPE_BELT_INVENTORY == attachedType:
+					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if player.SLOT_TYPE_CHANGE_LOOK == attachedType:
+					self.__PutItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, self.PickingCharacterIndex)
+
+			mouseModule.mouseController.DeattachObject()
+		else:
+			hyperlink = ui.GetHyperlink()
+			if hyperlink:
+				if app.IsPressed(app.DIK_LALT):
+					link = chat.GetLinkFromHyperlink(hyperlink)
+					#ime.PasteString(link)
+				else:
+					self.interface.MakeHyperlinkTooltip(hyperlink)
+				return
+			else:
+				player.SetMouseState(player.MBT_LEFT, player.MBS_CLICK)
+
+		# player.EndMouseWalking()
+		return True
+
+	def __PutItem(self, attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount, dstChrID):
+		attachedInvenType = player.SlotTypeToInvenType(attachedType)
+
+		if player.INVENTORY == attachedInvenType or \
+			player.DRAGON_SOUL_INVENTORY == attachedInvenType or \
+			player.EQUIPMENT == attachedInvenType or \
+			player.BELT_INVENTORY == attachedInvenType:
+
+			if True == chr.HasInstance(self.PickingCharacterIndex) and player.GetMainCharacterIndex() != dstChrID:
+				if player.IsEquipmentSlot(attachedInvenType, attachedItemSlotPos):
+					self.stream.popupWindow.Close()
+					self.stream.popupWindow.Open(localeInfo.EXCHANGE_FAILURE_EQUIP_ITEM, 0, localeInfo.UI_OK)
+				else:
+					if app.ENABLE_GUILD_DRAGONLAIR_SYSTEM:
+						if chr.IsNPC(dstChrID) or chr.IsStone(dstChrID):
+							net.SendGiveItemPacket(dstChrID, attachedInvenType, attachedItemSlotPos, attachedItemCount)
+						else:
+							net.SendExchangeStartPacket(dstChrID)
+							net.SendExchangeItemAddPacket(attachedInvenType, attachedItemSlotPos, 0)
+							if app.ENABLE_REFINE_RENEWAL:
+								constInfo.AUTO_REFINE_TYPE = 2
+								constInfo.AUTO_REFINE_DATA["NPC"][0] = dstChrID
+								constInfo.AUTO_REFINE_DATA["NPC"][1] = attachedInvenType
+								constInfo.AUTO_REFINE_DATA["NPC"][2] = attachedItemSlotPos
+								constInfo.AUTO_REFINE_DATA["NPC"][3] = attachedItemCount
+					else:
+						if chr.IsNPC(dstChrID):
+							net.SendGiveItemPacket(dstChrID, attachedInvenType, attachedItemSlotPos, attachedItemCount)
+						else:
+							net.SendExchangeStartPacket(dstChrID)
+							net.SendExchangeItemAddPacket(attachedInvenType, attachedItemSlotPos, 0)
+							if app.ENABLE_REFINE_RENEWAL:
+								constInfo.AUTO_REFINE_TYPE = 2
+								constInfo.AUTO_REFINE_DATA["NPC"][0] = dstChrID
+								constInfo.AUTO_REFINE_DATA["NPC"][1] = attachedInvenType
+								constInfo.AUTO_REFINE_DATA["NPC"][2] = attachedItemSlotPos
+								constInfo.AUTO_REFINE_DATA["NPC"][3] = attachedItemCount
+			else:
+				self.__DropItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount)
+
+		if app.ENABLE_ACCE_COSTUME_SYSTEM:
+			## Ù´Ú¿  Ç¼(,)  .
+			if player.SLOT_TYPE_ACCE == attachedType:
+				self.__DropItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount)
+
+		if app.ENABLE_CHANGE_LOOK_SYSTEM:
+			if player.SLOT_TYPE_CHANGE_LOOK == attachedType:
+				self.__DropItem(attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount)
+
+	if app.ENABLE_CHEQUE_SYSTEM:
+		def __PutMoney(self, attachedType, attachedMoney, dstChrID, cheque):
+			if True == chr.HasInstance(dstChrID) and player.GetMainCharacterIndex() != dstChrID:
+				net.SendExchangeStartPacket(dstChrID)
+				net.SendExchangeElkAddPacket(attachedMoney)
+				net.SendExchangeChequeAddPacket(cheque)
+			else:
+				self.stream.popupWindow.Close()
+				self.stream.popupWindow.Open(localeInfo.CHEQUE_SYSTEM_DO_NOT_DROP_MONEY, 0, localeInfo.UI_OK)
+	else:
+		def __PutMoney(self, attachedType, attachedMoney, dstChrID):
+			if True == chr.HasInstance(dstChrID) and player.GetMainCharacterIndex() != dstChrID:
+				net.SendExchangeStartPacket(dstChrID)
+				net.SendExchangeElkAddPacket(attachedMoney)
+			else:
+				self.__DropMoney(attachedType, attachedMoney)
+
+	def __DropMoney(self, attachedType, attachedMoney):
+		# PRIVATESHOP_DISABLE_ITEM_DROP - Î»  Ö´    
+		if uiPrivateShopBuilder.IsBuildingPrivateShop():
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
+			return
+		# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
+
+		if attachedMoney >= 1000:
+			self.stream.popupWindow.Close()
+			self.stream.popupWindow.Open(localeInfo.DROP_MONEY_FAILURE_1000_OVER, 0, localeInfo.UI_OK)
+			return
+
+		itemDropQuestionDialog = uiCommon.QuestionDialog()
+		itemDropQuestionDialog.SetText(localeInfo.DO_YOU_DROP_MONEY % (attachedMoney))
+		itemDropQuestionDialog.SetAcceptEvent(lambda arg=True: self.RequestDropItem(arg))
+		itemDropQuestionDialog.SetCancelEvent(lambda arg=False: self.RequestDropItem(arg))
+		itemDropQuestionDialog.Open()
+		itemDropQuestionDialog.dropType = attachedType
+		itemDropQuestionDialog.dropCount = attachedMoney
+		itemDropQuestionDialog.dropNumber = player.ITEM_MONEY
+		self.itemDropQuestionDialog = itemDropQuestionDialog
+
+	def __DropItem(self, attachedType, attachedItemIndex, attachedItemSlotPos, attachedItemCount):
+		# PRIVATESHOP_DISABLE_ITEM_DROP - Î»  Ö´    
+		if uiPrivateShopBuilder.IsBuildingPrivateShop():
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
+			return
+		# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
+
+		window_type = player.SlotTypeToInvenType(attachedType)
+
+		if player.IsEquipmentSlot(window_type, attachedItemSlotPos):
+			self.stream.popupWindow.Close()
+			self.stream.popupWindow.Open(localeInfo.DROP_ITEM_FAILURE_EQUIP_ITEM, 0, localeInfo.UI_OK)
+
+		else:
+			if player.SLOT_TYPE_INVENTORY == attachedType or\
+				player.SLOT_TYPE_BELT_INVENTORY == attachedType:
+
+				dropItemIndex = player.GetItemIndex(window_type, attachedItemSlotPos)
+
+				item.SelectItem(dropItemIndex)
+				dropItemName = item.GetItemName()
+				if app.ENABLE_SET_ITEM:
+					dropItemName = item.GetItemNameBySetValue(player.GetItemSetValue(window_type, attachedItemSlotPos))
+
+				## Question Text
+				questionText = localeInfo.HOW_MANY_ITEM_DO_YOU_DROP(dropItemName, attachedItemCount)
+
+				## Dialog
+				if app.ENABLE_NEW_DROP_DIALOG:
+					itemDropQuestionDialog = uiCommon.QuestionDropDialog()
+					itemDropQuestionDialog.SetText(questionText)
+					itemDropQuestionDialog.SetItemSlot(window_type, attachedItemSlotPos)
+					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
+					itemDropQuestionDialog.SetDestroyEvent(ui.__mem_func__(self.RequestDestroyItem))
+					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
+				else:
+					itemDropQuestionDialog = uiCommon.QuestionDialog()
+					itemDropQuestionDialog.SetText(questionText)
+					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
+					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
+
+				itemDropQuestionDialog.Open()
+				itemDropQuestionDialog.dropType = attachedType
+				itemDropQuestionDialog.dropNumber = attachedItemSlotPos
+				itemDropQuestionDialog.dropCount = attachedItemCount
+				self.itemDropQuestionDialog = itemDropQuestionDialog
+
+				constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+
+			elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == attachedType:
+				dropItemIndex = player.GetItemIndex(player.DRAGON_SOUL_INVENTORY, attachedItemSlotPos)
+
+				item.SelectItem(dropItemIndex)
+				dropItemName = item.GetItemName()
+
+				## Question Text
+				questionText = localeInfo.HOW_MANY_ITEM_DO_YOU_DROP(dropItemName, attachedItemCount)
+
+				## Dialog
+				if app.ENABLE_NEW_DROP_DIALOG:
+					itemDropQuestionDialog = uiCommon.QuestionDropDialog()
+					itemDropQuestionDialog.SetText(questionText)
+					itemDropQuestionDialog.SetItemSlot(window_type, attachedItemSlotPos)
+					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
+					itemDropQuestionDialog.SetDestroyEvent(ui.__mem_func__(self.RequestDestroyItem))
+					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
+				else:
+					itemDropQuestionDialog = uiCommon.QuestionDialog()
+					itemDropQuestionDialog.SetText(questionText)
+					itemDropQuestionDialog.SetAcceptEvent(lambda arg = True : self.RequestDropItem(arg))
+					itemDropQuestionDialog.SetCancelEvent(lambda arg = False : self.RequestDropItem(arg))
+
+				itemDropQuestionDialog.Open()
+				itemDropQuestionDialog.dropType = attachedType
+				itemDropQuestionDialog.dropNumber = attachedItemSlotPos
+				itemDropQuestionDialog.dropCount = attachedItemCount
+				self.itemDropQuestionDialog = itemDropQuestionDialog
+
+				constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				## Ù´Ú¿  Ç¼(,)  .
+				if player.SLOT_TYPE_ACCE == attachedType:
+					net.SendAcceRefineCheckOut(attachedItemSlotPos)
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if player.SLOT_TYPE_CHANGE_LOOK == attachedType:
+					net.SendChangeLookCheckOut(attachedItemSlotPos)
+
+	def RequestDropItem(self, answer):
+		if not self.itemDropQuestionDialog:
+			return
+
+		if answer:
+			dropType = self.itemDropQuestionDialog.dropType
+			dropCount = self.itemDropQuestionDialog.dropCount
+			dropNumber = self.itemDropQuestionDialog.dropNumber
+
+			if player.SLOT_TYPE_INVENTORY == dropType:
+				if dropNumber == player.ITEM_MONEY:
+					net.SendGoldDropPacketNew(dropCount)
+					snd.PlaySound("sound/ui/money.wav")
+				else:
+					# PRIVATESHOP_DISABLE_ITEM_DROP
+					self.__SendDropItemPacket(dropNumber, dropCount)
+					# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
+
+			elif player.SLOT_TYPE_BELT_INVENTORY == dropType:
+				self.__SendDropItemPacket(dropNumber, dropCount, player.BELT_INVENTORY)
+
+			elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == dropType:
+				# PRIVATESHOP_DISABLE_ITEM_DROP
+				self.__SendDropItemPacket(dropNumber, dropCount, player.DRAGON_SOUL_INVENTORY)
+				# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
+
+		self.itemDropQuestionDialog.Close()
+		self.itemDropQuestionDialog = None
+
+		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+	if app.ENABLE_NEW_DROP_DIALOG:
+		def RequestDestroyItem(self):
+			if not self.itemDropQuestionDialog:
+				return
+
+			itemDestroyQuestionDialog = uiCommon.QuestionDialogWithTimeLimit()
+			itemDestroyQuestionDialog.SetAcceptEvent(lambda arg=True: self.__ConfirmDestroyItem(arg))
+			itemDestroyQuestionDialog.SetCancelEvent(lambda arg=False: self.__ConfirmDestroyItem(arg))
+			itemDestroyQuestionDialog.Open(localeInfo.DESTROY_ITEM_CONFIRM, 3)
+			itemDestroyQuestionDialog.SetCancelOnTimeOver()
+			self.itemDestroyQuestionDialog = itemDestroyQuestionDialog
+
+		def __ConfirmDestroyItem(self, arg):
+			if not self.itemDropQuestionDialog or not self.itemDestroyQuestionDialog:
+				return
+
+			if arg:
+				dropType = self.itemDropQuestionDialog.dropType
+				dropNumber = self.itemDropQuestionDialog.dropNumber
+
+				if player.SLOT_TYPE_INVENTORY == dropType:
+					if dropNumber == player.ITEM_MONEY:
+						return
+					else:
+						self.__SendDestroyItemPacket(dropNumber)
+
+				elif player.SLOT_TYPE_BELT_INVENTORY == dropType:
+					self.__SendDestroyItemPacket(dropNumber, player.BELT_INVENTORY)
+
+				elif player.SLOT_TYPE_DRAGON_SOUL_INVENTORY == dropType:
+					self.__SendDestroyItemPacket(dropNumber, player.DRAGON_SOUL_INVENTORY)
+
+			self.itemDestroyQuestionDialog.Close()
+			self.itemDestroyQuestionDialog = None
+
+			self.itemDropQuestionDialog.Close()
+			self.itemDropQuestionDialog = None
+
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+		def __SendDestroyItemPacket(self, itemInvenPos, itemInvenType = player.INVENTORY):
+			if uiPrivateShopBuilder.IsBuildingPrivateShop():
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
+				return
+
+			net.SendItemDestroyPacket(itemInvenType, itemInvenPos)
+
+	# PRIVATESHOP_DISABLE_ITEM_DROP
+	def __SendDropItemPacket(self, itemInvenPos, itemCount, itemInvenType = player.INVENTORY):
+		if uiPrivateShopBuilder.IsBuildingPrivateShop():
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DROP_ITEM_FAILURE_PRIVATE_SHOP)
+			return
+
+		net.SendItemDropPacketNew(itemInvenType, itemInvenPos, itemCount)
+	# END_OF_PRIVATESHOP_DISABLE_ITEM_DROP
+
+	def OnMouseRightButtonDown(self):
+		self.CheckFocus()
+
+		if True == mouseModule.mouseController.isAttached():
+			mouseModule.mouseController.DeattachObject()
+		else:
+			player.SetMouseState(player.MBT_RIGHT, player.MBS_PRESS)
+
+		return True
+
+	def OnMouseRightButtonUp(self):
+		if True == mouseModule.mouseController.isAttached():
+			return True
+
+		player.SetMouseState(player.MBT_RIGHT, player.MBS_CLICK)
+		return True
+
+	def OnMouseMiddleButtonDown(self):
+		player.SetMouseMiddleButtonState(player.MBS_PRESS)
+
+	def OnMouseMiddleButtonUp(self):
+		player.SetMouseMiddleButtonState(player.MBS_CLICK)
+
+	def OnUpdate(self):
+		app.UpdateGame()
+
+		if self.mapNameShower.IsShow():
+			self.mapNameShower.Update()
+
+		if self.isShowDebugInfo:
+			# Debug info is expensive: throttle to reduce frame-time spikes if enabled
+			t = app.GetTime()
+			if t >= self._nextDebugInfoUpdateTime:
+				self._nextDebugInfoUpdateTime = t + 0.25
+				self.UpdateDebugInfo()
+
+		if self.enableXMasBoom:
+			self.__XMasBoom_Update()
+
+		self.interface.BUILD_OnUpdate()
+
+	def UpdateDebugInfo(self):
+		#
+		# Ä³ Ç¥  FPS 
+		(x, y, z) = player.GetMainCharacterPosition()
+		nUpdateTime = app.GetUpdateTime()
+		nUpdateFPS = app.GetUpdateFPS()
+		nRenderFPS = app.GetRenderFPS()
+		nFaceCount = app.GetFaceCount()
+		fFaceSpeed = app.GetFaceSpeed()
+		nST = background.GetRenderShadowTime()
+		(fAveRT, nCurRT) = app.GetRenderTime()
+		(iNum, fFogStart, fFogEnd, fFarCilp) = background.GetDistanceSetInfo()
+		(iPatch, iSplat, fSplatRatio, sTextureNum) = background.GetRenderedSplatNum()
+		if iPatch == 0:
+			iPatch = 1
+
+		#(dwRenderedThing, dwRenderedCRC) = background.GetRenderedGraphicThingInstanceNum()
+
+		self.PrintCoord.SetText("Coordinate: %.2f %.2f %.2f ATM: %d" % (x, y, z, app.GetAvailableTextureMemory()/(1024*1024)))
+		xMouse, yMouse = wndMgr.GetMousePosition()
+		self.PrintMousePos.SetText("MousePosition: %d %d" % (xMouse, yMouse))
+
+		self.FrameRate.SetText("UFPS: %3d UT: %3d FS %.2f" % (nUpdateFPS, nUpdateTime, fFaceSpeed))
+
+		if fAveRT>1.0:
+			self.Pitch.SetText("RFPS: %3d RT:%.2f(%3d) FC: %d(%.2f) " % (nRenderFPS, fAveRT, nCurRT, nFaceCount, nFaceCount/fAveRT))
+
+		self.Splat.SetText("PATCH: %d SPLAT: %d BAD(%.2f)" % (iPatch, iSplat, fSplatRatio))
+		# self.Pitch.SetText("Pitch: %.2f" % (app.GetCameraPitch())
+		# self.TextureNum.SetText("TN : %s" % (sTextureNum))
+		# self.ObjectNum.SetText("GTI : %d, CRC : %d" % (dwRenderedThing, dwRenderedCRC))
+		self.ViewDistance.SetText("Num : %d, FS : %f, FE : %f, FC : %f" % (iNum, fFogStart, fFogEnd, fFarCilp))
+
+	def OnRender(self):
+		app.RenderGame()
+
+		(x, y) = app.GetCursorPosition()
+
+		########################
+		# Picking
+		########################
+		textTail.UpdateAllTextTail()
+
+		if True == wndMgr.IsPickedWindow(self.hWnd):
+			self.PickingCharacterIndex = chr.Pick()
+
+			if -1 != self.PickingCharacterIndex:
+				textTail.ShowCharacterTextTail(self.PickingCharacterIndex)
+			if 0 != self.targetBoard.GetTargetVID():
+				textTail.ShowCharacterTextTail(self.targetBoard.GetTargetVID())
+
+			# ADD_ALWAYS_SHOW_NAME
+			if not self.__IsShowName():
+				self.PickingItemIndex = item.Pick()
+				if -1 != self.PickingItemIndex:
+					textTail.ShowItemTextTail(self.PickingItemIndex)
+			# END_OF_ADD_ALWAYS_SHOW_NAME
+
+		## Show all name in the range
+
+		# ADD_ALWAYS_SHOW_NAME
+		if self.__IsShowName():
+			textTail.ShowAllTextTail()
+			self.PickingItemIndex = textTail.Pick(x, y)
+		# END_OF_ADD_ALWAYS_SHOW_NAME
+
+		textTail.UpdateShowingTextTail()
+		textTail.ArrangeTextTail()
+		if -1 != self.PickingItemIndex:
+			textTail.SelectItemName(self.PickingItemIndex)
+
+		grp.PopState()
+		grp.SetInterfaceRenderState()
+
+		textTail.Render()
+		textTail.HideAllTextTail()
+
+	def OnPressEscapeKey(self):
+		if app.TARGET == app.GetCursor():
+			app.SetCursor(app.NORMAL)
+
+		elif True == mouseModule.mouseController.isAttached():
+			mouseModule.mouseController.DeattachObject()
+		else:
+			self.interface.OpenSystemDialog()
+
+		return True
+
+	def OnIMEReturn(self):
+		if app.IsPressed(app.DIK_LSHIFT):
+			self.interface.OpenWhisperDialogWithoutTarget()
+		else:
+			self.interface.ToggleChat()
+		return True
+
+	def OnPressExitKey(self):
+		self.interface.ToggleSystemDialog()
+		return True
+
+	## BINARY CALLBACK
+	######################################################################################
+
+	# WEDDING
+	def BINARY_LoverInfo(self, name, lovePoint):
+		if self.interface.wndMessenger:
+			self.interface.wndMessenger.OnAddLover(name, lovePoint)
+		if self.affectShower:
+			self.affectShower.SetLoverInfo(name, lovePoint)
+
+	def BINARY_UpdateLovePoint(self, lovePoint):
+		if self.interface.wndMessenger:
+			self.interface.wndMessenger.OnUpdateLovePoint(lovePoint)
+		if self.affectShower:
+			self.affectShower.OnUpdateLovePoint(lovePoint)
+	# END_OF_WEDDING
+
+	if app.ENABLE_SEND_TARGET_INFO:
+		def BINARY_RefreshTargetMonsterDropInfo(self, raceNum):
+			self.targetBoard.RefreshMonsterInfoBoard()
+
+	# QUEST_CONFIRM
+	def BINARY_OnQuestConfirm(self, msg, timeout, pid):
+		confirmDialog = uiCommon.QuestionDialogWithTimeLimit()
+		confirmDialog.Open(msg, timeout)
+		confirmDialog.SetAcceptEvent(lambda answer=True, pid=pid: net.SendQuestConfirmPacket(answer, pid) or self.confirmDialog.Hide())
+		confirmDialog.SetCancelEvent(lambda answer=False, pid=pid: net.SendQuestConfirmPacket(answer, pid) or self.confirmDialog.Hide())
+		self.confirmDialog = confirmDialog
+	# END_OF_QUEST_CONFIRM
+
+	# GIFT command
+	def Gift_Show(self):
+		self.interface.ShowGift()
+
+	def Gift_Hide(self):
+		self.interface.HideGift()
+
+	# CUBE
+	if app.ENABLE_CUBE_RENEWAL:
+		def BINARY_Cube_Open(self, npc_vnum):
+			self.interface.OpenCubeWindow(npc_vnum)
+
+		def BINARY_Cube_Close(self):
+			self.interface.CloseCubeWindow()
+
+		def BINARY_Cube_Result(self, is_success):
+			self.interface.CubeResult(is_success)
+	else:
+		def BINARY_Cube_Open(self, npcVNUM, reload = 0):
+			self.currentCubeNPC = npcVNUM
+
+			if reload:
+				self.cubeInformation.clear()
+				self.interface.wndCube.ClearOldSlots()
+
+			self.interface.OpenCubeWindow()
+
+			if npcVNUM not in self.cubeInformation:
+				net.SendCommandPacket("/cube r_info")
+			else:
+				cubeInfoList = self.cubeInformation[npcVNUM]
+
+				i = 0
+				for cubeInfo in cubeInfoList:
+					self.interface.wndCube.AddCubeResultItem(cubeInfo["vnum"], cubeInfo["count"])
+
+					j = 0
+					for materialList in cubeInfo["materialList"]:
+						for materialInfo in materialList:
+							itemVnum, itemCount = materialInfo
+							self.interface.wndCube.AddMaterialInfo(i, j, itemVnum, itemCount)
+						j = j + 1
+
+					i = i + 1
+
+				self.interface.wndCube.Refresh()
+
+		def BINARY_Cube_Close(self):
+			self.interface.CloseCubeWindow()
+
+		# Û¿ Ê¿ , Ç´ Ï¼Ç° VNUM   update
+		def BINARY_Cube_UpdateInfo(self, gold, itemVnum, count):
+			self.interface.UpdateCubeInfo(gold, itemVnum, count)
+
+		def BINARY_Cube_Succeed(self, itemVnum, count):
+			print "Å¥  "
+			self.interface.SucceedCubeWork(itemVnum, count)
+			pass
+
+		def BINARY_Cube_Failed(self):
+			print "Å¥  "
+			self.interface.FailedCubeWork()
+			pass
+
+		def BINARY_Cube_ResultList(self, npcVNUM, listText):
+			# ResultList Text Format : 72723,1/72725,1/72730.1/50001,5 Ì· "/" Ú· Ðµ Æ® 
+			#print listText
+
+			if npcVNUM == 0:
+				npcVNUM = self.currentCubeNPC
+
+			self.cubeInformation[npcVNUM] = []
+
+			try:
+				for eachInfoText in listText.split("/"):
+					eachInfo = eachInfoText.split(",")
+					itemVnum = int(eachInfo[0])
+					itemCount = int(eachInfo[1])
+
+					self.cubeInformation[npcVNUM].append({"vnum": itemVnum, "count": itemCount})
+					self.interface.wndCube.AddCubeResultItem(itemVnum, itemCount)
+
+				resultCount = len(self.cubeInformation[npcVNUM])
+				requestCount = 5
+				modCount = resultCount % requestCount
+				splitCount = resultCount / requestCount
+				for i in xrange(splitCount):
+					#print("/cube r_info %d %d" % (i * requestCount, requestCount))
+					net.SendCommandPacket("/cube r_info %d %d" % (i * requestCount, requestCount))
+
+				if 0 < modCount:
+					#print("/cube r_info %d %d" % (splitCount * requestCount, modCount))
+					net.SendCommandPacket("/cube r_info %d %d" % (splitCount * requestCount, modCount))
+
+			except RuntimeError, msg:
+				dbg.TraceError(msg)
+				return 0
+
+			pass
+
+		def BINARY_Cube_MaterialInfo(self, startIndex, listCount, listText):
+			# Material Text Format : 125,1|126,2|127,2|123,5&555,5&555,4/120000
+			try:
+				#print listText
+
+				if 3 > len(listText):
+					dbg.TraceError("Wrong Cube Material Infomation")
+					return 0
+
+				eachResultList = listText.split("@")
+
+				cubeInfo = self.cubeInformation[self.currentCubeNPC]
+
+				itemIndex = 0
+				for eachResultText in eachResultList:
+					cubeInfo[startIndex + itemIndex]["materialList"] = [[], [], [], [], []]
+					materialList = cubeInfo[startIndex + itemIndex]["materialList"]
+
+					gold = 0
+					splitResult = eachResultText.split("/")
+					if 1 < len(splitResult):
+						gold = int(splitResult[1])
+
+					#print "splitResult : ", splitResult
+					eachMaterialList = splitResult[0].split("&")
+
+					i = 0
+					for eachMaterialText in eachMaterialList:
+						complicatedList = eachMaterialText.split("|")
+
+						if 0 < len(complicatedList):
+							for complicatedText in complicatedList:
+								(itemVnum, itemCount) = complicatedText.split(",")
+								itemVnum = int(itemVnum)
+								itemCount = int(itemCount)
+								self.interface.wndCube.AddMaterialInfo(itemIndex + startIndex, i, itemVnum, itemCount)
+
+								materialList[i].append((itemVnum, itemCount))
+						else:
+							itemVnum, itemCount = eachMaterialText.split(",")
+							itemVnum = int(itemVnum)
+							itemCount = int(itemCount)
+							self.interface.wndCube.AddMaterialInfo(itemIndex + startIndex, i, itemVnum, itemCount)
+
+							materialList[i].append((itemVnum, itemCount))
+
+						i = i + 1
+
+					itemIndex = itemIndex + 1
+
+				self.interface.wndCube.Refresh()
+
+			except RuntimeError, msg:
+				dbg.TraceError(msg)
+				return 0
+
+			pass
+
+		# END_OF_CUBE
+
+	# È¥
+	def BINARY_Highlight_Item(self, inven_type, inven_pos):
+		self.interface.Highligt_Item(inven_type, inven_pos)
+
+	def BINARY_DragonSoulGiveQuilification(self):
+		self.interface.DragonSoulGiveQuilification()
+
+	if app.ENABLE_DS_CHANGE_ATTR:
+		def BINARY_DragonSoulRefineWindow_Open(self, type):
+			self.interface.OpenDragonSoulRefineWindow(type)
+	else:
+		def BINARY_DragonSoulRefineWindow_Open(self):
+			self.interface.OpenDragonSoulRefineWindow()
+
+	def BINARY_DragonSoulRefineWindow_RefineFail(self, reason, inven_type, inven_pos):
+		self.interface.FailDragonSoulRefine(reason, inven_type, inven_pos)
+
+	def BINARY_DragonSoulRefineWindow_RefineSucceed(self, inven_type, inven_pos):
+		self.interface.SucceedDragonSoulRefine(inven_type, inven_pos)
+
+	# END of DRAGON SOUL REFINE WINDOW
+
+	def BINARY_SetBigMessage(self, message):
+		self.interface.bigBoard.SetTip(message)
+
+	if app.ENABLE_OX_RENEWAL:
+		def BINARY_SetBigControlMessage(self, message):
+			self.interface.bigBoardControl.SetTip(message)
+
+	def BINARY_SetTipMessage(self, message):
+		self.interface.tipBoard.SetTip(message)
+
+	def BINARY_SetMissionMessage(self, message):
+		self.interface.missionBoard.SetMission(message)
+
+	def BINARY_SetSubMissionMessage(self, message):
+		self.interface.missionBoard.SetSubMission(message)
+
+	def BINARY_CleanMissionMessage(self):
+		self.interface.missionBoard.CleanMission()
+
+	def BINARY_AppendNotifyMessage(self, type):
+		if not type in localeInfo.NOTIFY_MESSAGE:
+			return
+
+		chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.NOTIFY_MESSAGE[type])
+
+	def BINARY_Guild_EnterGuildArea(self, areaID):
+		self.interface.BULID_EnterGuildArea(areaID)
+
+	def BINARY_Guild_ExitGuildArea(self, areaID):
+		self.interface.BULID_ExitGuildArea(areaID)
+
+	def BINARY_GuildWar_OnSendDeclare(self, guildID):
+		pass
+
+	def BINARY_GuildWar_OnRecvDeclare(self, guildID, warType):
+		mainCharacterName = player.GetMainCharacterName()
+		masterName = guild.GetGuildMasterName()
+		if mainCharacterName == masterName:
+			self.__GuildWar_OpenAskDialog(guildID, warType)
+
+	def BINARY_GuildWar_OnRecvPoint(self, gainGuildID, opponentGuildID, point):
+		self.interface.OnRecvGuildWarPoint(gainGuildID, opponentGuildID, point)
+
+	def BINARY_GuildWar_OnStart(self, guildSelf, guildOpp):
+		self.interface.OnStartGuildWar(guildSelf, guildOpp)
+
+	def BINARY_GuildWar_OnEnd(self, guildSelf, guildOpp):
+		self.interface.OnEndGuildWar(guildSelf, guildOpp)
+
+	def BINARY_BettingGuildWar_SetObserverMode(self, isEnable):
+		self.interface.BINARY_SetObserverMode(isEnable)
+
+	def BINARY_BettingGuildWar_UpdateObserverCount(self, observerCount):
+		self.interface.wndMiniMap.UpdateObserverCount(observerCount)
+
+	def __GuildWar_UpdateMemberCount(self, guildID1, memberCount1, guildID2, memberCount2, observerCount):
+		guildID1 = int(guildID1)
+		guildID2 = int(guildID2)
+		memberCount1 = int(memberCount1)
+		memberCount2 = int(memberCount2)
+		observerCount = int(observerCount)
+
+		self.interface.UpdateMemberCount(guildID1, memberCount1, guildID2, memberCount2)
+		self.interface.wndMiniMap.UpdateObserverCount(observerCount)
+
+	def __GuildWar_OpenAskDialog(self, guildID, warType):
+		guildName = guild.GetGuildName(guildID)
+
+		# REMOVED_GUILD_BUG_FIX
+		if "Noname" == guildName:
+			return
+		# END_OF_REMOVED_GUILD_BUG_FIX
+
+		import uiGuild
+		questionDialog = uiGuild.AcceptGuildWarDialog()
+		questionDialog.SAFE_SetAcceptEvent(self.__GuildWar_OnAccept)
+		questionDialog.SAFE_SetCancelEvent(self.__GuildWar_OnDecline)
+		questionDialog.Open(guildName, warType)
+
+		self.guildWarQuestionDialog = questionDialog
+
+	def __GuildWar_CloseAskDialog(self):
+		self.guildWarQuestionDialog.Close()
+		self.guildWarQuestionDialog = None
+
+	def __GuildWar_OnAccept(self):
+		guildName = self.guildWarQuestionDialog.GetGuildName()
+
+		net.SendCommandPacket("/war " + guildName)
+		self.__GuildWar_CloseAskDialog()
+
+		return 1
+
+	def __GuildWar_OnDecline(self):
+		guildName = self.guildWarQuestionDialog.GetGuildName()
+
+		net.SendCommandPacket("/nowar " + guildName)
+		self.__GuildWar_CloseAskDialog()
+
+		return 1
+
+	## BINARY CALLBACK
+	######################################################################################
+	def __ServerCommand_Build(self):
+		serverCommandList = {
+			"DayMode" : self.__DayMode_Update,
+			"PRESERVE_DayMode" : self.__PRESERVE_DayMode_Update,
+			"CloseRestartWindow" : self.__RestartDialog_Close,
+			"OpenPrivateShop" : self.__PrivateShop_Open,
+			"PartyHealReady" : self.PartyHealReady,
+			"ShowMeSafeboxPassword" : self.AskSafeboxPassword,
+			"CloseSafebox" : self.CommandCloseSafebox,
+
+			# ITEM_MALL
+			"CloseMall" : self.CommandCloseMall,
+			"ShowMeMallPassword" : self.AskMallPassword,
+			"item_mall" : self.__ItemMall_Open,
+			# END_OF_ITEM_MALL
+
+			"RefineSuceeded" : self.RefineSuceededMessage,
+			"RefineFailed" : self.RefineFailedMessage,
+			"xmas_snow" : self.__XMasSnow_Enable,
+			"xmas_boom" : self.__XMasBoom_Enable,
+			"xmas_song" : self.__XMasSong_Enable,
+			"xmas_tree" : self.__XMasTree_Enable,
+			"newyear_boom" : self.__XMasBoom_Enable,
+			"PartyRequest" : self.__PartyRequestQuestion,
+			"PartyRequestDenied" : self.__PartyRequestDenied,
+			"horse_state" : self.__Horse_UpdateState,
+			"hide_horse_state" : self.__Horse_HideState,
+			"WarUC" : self.__GuildWar_UpdateMemberCount,
+			"test_server" : self.__EnableTestServerFlag,
+			"mall" : self.__InGameShop_Show,
+
+			# WEDDING
+			"lover_login" : self.__LoginLover,
+			"lover_logout" : self.__LogoutLover,
+			"lover_near" : self.__LoverNear,
+			"lover_far" : self.__LoverFar,
+			"lover_divorce" : self.__LoverDivorce,
+			"PlayMusic" : self.__PlayMusic,
+			# END_OF_WEDDING
+
+			# PRIVATE_SHOP_PRICE_LIST
+			"MyShopPriceList" : self.__PrivateShop_PriceList,
+			# END_OF_PRIVATE_SHOP_PRICE_LIST
+		}
+
+		#if app.ENABLE_ACCE_COSTUME_SYSTEM:
+		#	serverCommandList["ShowAcceCombineDialog"] = self.__AcceCombineDialog
+		#	serverCommandList["ShowAcceAbsorbDialog"] = self.__AcceAbsorbDialog
+
+		if app.ENABLE_MOVE_COSTUME_ATTR:
+			serverCommandList["ShowItemCombinationDialog"] = self.__ItemCombinationDialog
+
+		if app.ENABLE_MINI_GAME_RUMI:
+			serverCommandList["mini_game_okey"] = self.__MiniGameOkey
+			serverCommandList["mini_game_okey_normal"] = self.__MiniGameOkeyNormal
+
+		if app.ENABLE_MINI_GAME_CATCH_KING:
+			serverCommandList["mini_game_catchking"] = self.__MiniGameCatchKing
+
+		if app.ENABLE_CHANGE_LOOK_SYSTEM:
+			serverCommandList["ShowChangeDialog"] = self.__ChangeWindowOpen
+
+		serverCommandList.update({
+			"SetMissionMessage" : self.BINARY_SetMissionMessage,
+			"SetSubMissionMessage" : self.BINARY_SetSubMissionMessage,
+			"CleanMissionMessage" : self.BINARY_CleanMissionMessage,
+		})
+
+		serverCommandList["OpenCostumeWindow"] = self.OpenCostumeWindow
+
+		if app.ENABLE_MOVE_CHANNEL:
+			serverCommandList["server_info"] = self.__SeverInfo
+
+		if app.ENABLE_REFINE_MSG_ADD:
+			serverCommandList["RefineFailedType"] = self.__RefineFailedTypeMessage
+
+		if app.ENABLE_SKILLBOOK_COMB_SYSTEM:
+			serverCommandList["OpenSkillbookCombinationDialog"] = self.OpenSkillbookCombinationDialog
+
+		if app.ENABLE_MYSHOP_DECO:
+			serverCommandList["OpenMyShopDecoWnd"] = self.__OpenMyShopDecoWnd
+
+		if app.ENABLE_POPUP_NOTICE:
+			serverCommandList["PopupNoticeEventFlag"] = self.__SetPopupNoticeEventFlag
+			serverCommandList["PopupNoticeProcess"] = self.__PopupNoticeProcess
+
+		if app.ENABLE_MINI_GAME_YUTNORI:
+			serverCommandList["mini_game_yutnori"] = self.__MiniGameYutnori
+
+		if app.ENABLE_ATTR_6TH_7TH:
+			serverCommandList["__OpenAttr67AddDlg"] = self.__OpenAttr67AddDlg
+
+		if app.ENABLE_SOUL_SYSTEM:
+			serverCommandList["RefineSoulSuceeded"] = self.__RefineSoulSuceededMessage
+			serverCommandList["RefineSoulFailed"] = self.__RefineSoulFailedMessage
+
+		if app.ENABLE_SNOWFLAKE_STICK_EVENT:
+			serverCommandList["snowflake_stick_event"] = self.__SnowflakeStickEvent
+
+		if app.ENABLE_HIDE_COSTUME_SYSTEM:
+			serverCommandList["SetHiddenCostumePart"] = self.__SetHiddenCostumePart
+
+		if app.ENABLE_LEFT_SEAT:
+			serverCommandList["OpenLeftSeatDialog"] = self.OpenLeftSeatDialog
+			serverCommandList["CloseLeftSeatDialog"] = self.CloseLeftSeatDialog
+
+		if app.ENABLE_GUILD_DRAGONLAIR_SYSTEM:
+			serverCommandList["clear_guild_reddragonlair_ranking"] = self.__ClearGuildRedDragonLairRanking
+			serverCommandList["check_reddragonlairranking_board"] = self.__CheckRedDragonLairRanking
+
+		if app.ENABLE_SUMMER_EVENT_ROULETTE:
+			serverCommandList["e_late_summer"] = self.__LateSummerEvent
+
+		if app.ENABLE_FLOWER_EVENT:
+			serverCommandList["e_flower_drop"] = self.__FlowerEvent
+
+		self.serverCommander = stringCommander.Analyzer()
+		for serverCommandItem in serverCommandList.items():
+			self.serverCommander.SAFE_RegisterCallBack(
+				serverCommandItem[0], serverCommandItem[1]
+			)
+
+	if app.ENABLE_CHANGE_LOOK_SYSTEM:
+		def __ChangeWindowOpen(self, type):
+			self.interface.ChangeWindowOpen(type)
+
+	def BINARY_ServerCommand_Run(self, line):
+		#dbg.TraceError(line)
+		try:
+			#print " BINARY_ServerCommand_Run", line
+			return self.serverCommander.Run(line)
+		except RuntimeError, msg:
+			dbg.TraceError(msg)
+			return 0
+
+	def __ProcessPreservedServerCommand(self):
+		try:
+			command = net.GetPreservedServerCommand()
+			while command:
+				print " __ProcessPreservedServerCommand", command
+				self.serverCommander.Run(command)
+				command = net.GetPreservedServerCommand()
+		except RuntimeError, msg:
+			dbg.TraceError(msg)
+			return 0
+
+	def PartyHealReady(self):
+		self.interface.PartyHealReady()
+
+	def AskSafeboxPassword(self):
+		self.interface.AskSafeboxPassword()
+
+	if app.ENABLE_SKILLBOOK_COMB_SYSTEM:
+		def OpenSkillbookCombinationDialog(self):
+			self.interface.OpenSkillbookCombinationDialog()
+
+	# ITEM_MALL
+	def AskMallPassword(self):
+		self.interface.AskMallPassword()
+
+	def __ItemMall_Open(self):
+		self.interface.OpenItemMall();
+
+	def CommandCloseMall(self):
+		self.interface.CommandCloseMall()
+	# END_OF_ITEM_MALL
+
+	def RefineSuceededMessage(self):
+		snd.PlaySound("sound/ui/make_soket.wav")
+		self.PopupMessage(localeInfo.REFINE_SUCCESS)
+		if app.ENABLE_REFINE_RENEWAL:
+			self.interface.CheckRefineDialog(False)
+
+	def RefineFailedMessage(self):
+		snd.PlaySound("sound/ui/jaeryun_fail.wav")
+		self.PopupMessage(localeInfo.REFINE_FAILURE)
+		if app.ENABLE_REFINE_RENEWAL:
+			self.interface.CheckRefineDialog(True)
+
+	if app.ENABLE_SOUL_SYSTEM:
+		def __RefineSoulSuceededMessage(self):
+			snd.PlaySound("sound/ui/make_soket.wav")
+			self.PopupMessage(localeInfo.SOUL_REFINE_SUCCESS)
+
+		def __RefineSoulFailedMessage(self):
+			snd.PlaySound("sound/ui/jaeryun_fail.wav")
+			self.PopupMessage(localeInfo.SOUL_REFINE_FAILURE)
+
+	if app.ENABLE_REFINE_MSG_ADD:
+		def __RefineFailedTypeMessage(self, value):
+			snd.PlaySound("sound/ui/jaeryun_fail.wav")
+
+			value = int(value)
+			print "type : ", value
+			print type(value)
+
+			if REFINE_FAIL_GRADE_DOWN == value:
+				self.PopupMessage(localeInfo.REFINE_FAILURE_GRADE_DOWN)
+			elif REFINE_FAIL_DEL_ITEM == value:
+				self.PopupMessage(localeInfo.REFINE_FAILURE_DEL_ITEM)
+			elif REFINE_FAIL_KEEP_GRADE == value:
+				self.PopupMessage(localeInfo.REFINE_FAILURE_KEEP_GRADE)
+			else:
+				self.PopupMessage(localeInfo.REFINE_FAILURE)
+
+	def CommandCloseSafebox(self):
+		self.interface.CommandCloseSafebox()
+
+	# PRIVATE_SHOP_PRICE_LIST
+	def __PrivateShop_PriceList(self, itemVNum, itemPrice, itemCheque):
+		if app.ENABLE_CHEQUE_SYSTEM:
+			uiPrivateShopBuilder.SetPrivateShopItemPrice(itemVNum, itemPrice, itemCheque)
+		else:
+			uiPrivateShopBuilder.SetPrivateShopItemPrice(itemVNum, itemPrice)
+	# END_OF_PRIVATE_SHOP_PRICE_LIST
+
+	def __Horse_HideState(self):
+		self.affectShower.SetHorseState(0, 0, 0)
+
+	def __Horse_UpdateState(self, level, health, battery):
+		self.affectShower.SetHorseState(int(level), int(health), int(battery))
+
+	if app.ENABLE_CONQUEROR_LEVEL:
+		def BINARY_SungMaAttr(self, str, hp, move, immune):
+			self.affectShower.SetSungMaAffectImage(str, hp, move, immune)
+
+	def __IsXMasMap(self):
+		mapDict = (
+			"metin2_map_n_flame_01",
+			"metin2_map_n_desert_01",
+			"metin2_map_spiderdungeon_01",
+			"metin2_map_spiderdungeon_02",
+			"metin2_map_spiderdungeon_03",
+			"metin2_map_deviltower1",
+			"metin2_map_sungzi_flame_hill_01",
+			"metin2_map_sungzi_flame_hill_02",
+			"metin2_map_sungzi_flame_hill_03",
+			"metin2_map_sungzi_desert_01",
+			"metin2_map_sungzi_desert_hill_01",
+			"metin2_map_sungzi_desert_hill_02",
+			"metin2_map_sungzi_desert_hill_03",
+			"metin2_map_empirewar03",
+			"metin2_map_devilsCatacomb",
+			"metin2_map_Mt_Thunder",
+			"metin2_map_n_flame_dungeon_01",
+			"metin2_map_dawnmist_dungeon_01",
+			"metin2_map_Mt_Th_dungeon_01",
+		)
+
+		if background.GetCurrentMapName() in mapDict:
+			return False
+
+		return True
+
+	def __XMasSnow_Enable(self, mode):
+		self.__XMasSong_Enable(mode)
+
+		if "1" == mode:
+			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
+				background.SetXMasShowEvent(1)
+
+			if not self.__IsXMasMap():
+				return
+
+			print "XMAS_SNOW ON"
+			background.EnableSnow(1)
+		else:
+			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
+				background.SetXMasShowEvent(0)
+
+			print "XMAS_SNOW OFF"
+			background.EnableSnow(0)
+
+	def __XMasBoom_Enable(self, mode):
+		if "1" == mode:
+			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
+				if not background.IsBoomMap():
+					return
+			else:
+				if not self.__IsXMasMap():
+					return
+
+			print "XMAS_BOOM ON"
+			self.__DayMode_Update("dark")
+			self.enableXMasBoom = True
+			self.startTimeXMasBoom = app.GetTime()
+		else:
+			print "XMAS_BOOM OFF"
+			self.__DayMode_Update("light")
+			self.enableXMasBoom = False
+
+	def __XMasTree_Enable(self, grade):
+		print "XMAS_TREE ", grade
+		background.SetXMasTree(int(grade))
+
+	def __XMasSong_Enable(self, mode):
+		if "1" == mode:
+			print "XMAS_SONG ON"
+
+			XMAS_BGM = "xmas.mp3"
+
+			if app.IsExistFile("BGM/" + XMAS_BGM) == 1:
+				if musicInfo.fieldMusic != "":
+					snd.FadeOutMusic("BGM/" + musicInfo.fieldMusic)
+
+				musicInfo.fieldMusic = XMAS_BGM
+				snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
+		else:
+			print "XMAS_SONG OFF"
+
+			if musicInfo.fieldMusic != "":
+				snd.FadeOutMusic("BGM/" + musicInfo.fieldMusic)
+
+			musicInfo.fieldMusic = musicInfo.METIN2THEMA
+			snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
+
+	def __RestartDialog_Close(self):
+		self.interface.CloseRestartDialog()
+
+	## PrivateShop
+	if app.ENABLE_CHEQUE_SYSTEM:
+		def __CashPrivateShop_Open(self):
+			if app.ENABLE_MYSHOP_DECO:
+				return
+
+			self.interface.OpenPrivateShopInputNameDialog(True)
+
+		def __PrivateShop_Open(self):
+			if app.ENABLE_MYSHOP_DECO:
+				return
+
+			self.interface.OpenPrivateShopInputNameDialog(False)
+	else:
+		def __PrivateShop_Open(self):
+			self.interface.OpenPrivateShopInputNameDialog()
+
+	if app.ENABLE_MYSHOP_DECO:
+		def MyPrivShopOpen(self, cashItem, tabCnt):
+			self.interface.OpenPrivateShopInputNameDialog(cashItem, tabCnt)
+
+		def __OpenMyShopDecoWnd(self):
+			self.interface.OpenMyShopDecoWnd()
+
+		def BINARY_PrivateShop_Appear(self, vid, text, type):
+			self.interface.AppearPrivateShop(vid, text, type)
+	else:
+		def BINARY_PrivateShop_Appear(self, vid, text):
+			self.interface.AppearPrivateShop(vid, text)
+
+	def BINARY_PrivateShop_Disappear(self, vid):
+		self.interface.DisappearPrivateShop(vid)
+
+	if app.ENABLE_MINI_GAME_RUMI:
+		def __MiniGameOkey(self, enable):
+			player.SetMiniGameOkeyNormal(False)
+			if app.ENABLE_EVENT_BANNER:
+				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_OKEY_NORMAL, int(enable))
+
+		def __MiniGameOkeyNormal(self, enable):
+			player.SetMiniGameOkeyNormal(True)
+			if app.ENABLE_EVENT_BANNER:
+				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_OKEY_NORMAL, int(enable))
+
+			if self.interface:
+				self.interface.SetOkeyNormalBG()
+
+		def MiniGameRumiStart(self):
+			self.interface.MiniGameRumiStart()
+
+		def MiniGameRumiEnd(self):
+			self.interface.MiniGameRumiEnd()
+
+		def MiniGameRumiMoveCard(self, src_pos, src_index, src_color, src_number, dst_pos, dst_index, dst_color, dst_number):
+			srcCard = (src_pos, src_index, src_color, src_number)
+			dstCard = (dst_pos, dst_index, dst_color, dst_number)
+			self.interface.MiniGameRumiMoveCard(srcCard, dstCard)
+
+		def MiniGameRumiSetDeckCount(self, deck_card_count):
+			self.interface.MiniGameRumiSetDeckCount(deck_card_count)
+
+		def MiniGameRumiIncreaseScore(self, score, total_score):
+			self.interface.MiniGameRumiIncreaseScore(score, total_score)
+
+		if app.ENABLE_OKEY_EVENT_FLAG_RENEWAL:
+			def MiniGameRumiFlagProcess(self, process_type, data):
+				self.interface.MiniGameRumiFlagProcess(process_type, data)
+
+	if app.ENABLE_MINI_GAME_CATCH_KING:
+		def __MiniGameCatchKing(self, enable):
+			if app.ENABLE_EVENT_BANNER:
+				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_CATCHKING, int(enable))
+			else:
+				pass
+
+		def MiniGameCatchKingEventStart(self, bigScore):
+			self.interface.MiniGameCatchKingEventStart(bigScore)
+
+		def MiniGameCatchKingSetHandCard(self, cardNumber):
+			self.interface.MiniGameCatchKingSetHandCard(cardNumber)
+
+		def MiniGameCatchKingResultField(self, score, rowType, cardPos, cardValue, keepFieldCard, destroyHandCard, getReward, isFiveNear):
+			self.interface.MiniGameCatchKingResultField(score, rowType, cardPos, cardValue, keepFieldCard, destroyHandCard, getReward, isFiveNear)
+
+		def MiniGameCatchKingSetEndCard(self, cardPos, cardNumber):
+			self.interface.MiniGameCatchKingSetEndCard(cardPos, cardNumber)
+
+		def MiniGameCatchKingReward(self, rewardCode):
+			self.interface.MiniGameCatchKingReward(rewardCode)
+
+		if app.ENABLE_CATCH_KING_EVENT_FLAG_RENEWAL:
+			def CatchKingFlagProcess(self, type, data):
+				self.interface.CatchKingFlagProcess(type, data)
+
+	## DayMode
+	def __PRESERVE_DayMode_Update(self, mode):
+		if "light" == mode:
+			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
+				if not background.IsBoomMap():
+					return
+			else:
+				if not self.__IsXMasMap():
+					return
+
+			background.SetEnvironmentData(background.DAY_MODE_LIGHT)
+		elif "dark" == mode:
+			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
+				if not background.IsBoomMap():
+					return
+			else:
+				if not self.__IsXMasMap():
+					return
+
+			background.RegisterEnvironmentData(background.DAY_MODE_DARK, constInfo.ENVIRONMENT_NIGHT)
+			background.SetEnvironmentData(background.DAY_MODE_DARK)
+
+	def __DayMode_Update(self, mode):
+		if "light" == mode:
+			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
+				if not background.IsBoomMap():
+					return
+				else:
+					if not self.__IsXMasMap():
+						return
+
+			self.curtain.SAFE_FadeOut(self.__DayMode_OnCompleteChangeToLight)
+		elif "dark" == mode:
+			if app.ENABLE_ENVIRONMENT_EFFECT_OPTION:
+				if not background.IsBoomMap():
+					return
+			else:
+				if not self.__IsXMasMap():
+					return
+
+			self.curtain.SAFE_FadeOut(self.__DayMode_OnCompleteChangeToDark)
+
+	def __DayMode_OnCompleteChangeToLight(self):
+		background.SetEnvironmentData(background.DAY_MODE_LIGHT)
+		self.curtain.FadeIn()
+
+	def __DayMode_OnCompleteChangeToDark(self):
+		background.RegisterEnvironmentData(background.DAY_MODE_DARK, constInfo.ENVIRONMENT_NIGHT)
+		background.SetEnvironmentData(background.DAY_MODE_DARK)
+		self.curtain.FadeIn()
+
+	## XMasBoom
+	def __XMasBoom_Update(self):
+		self.BOOM_DATA_LIST = ( (2, 5), (5, 2), (7, 3), (10, 3), (20, 5) )
+		if self.indexXMasBoom >= len(self.BOOM_DATA_LIST):
+			return
+
+		boomTime = self.BOOM_DATA_LIST[self.indexXMasBoom][0]
+		boomCount = self.BOOM_DATA_LIST[self.indexXMasBoom][1]
+
+		if app.GetTime() - self.startTimeXMasBoom > boomTime:
+			self.indexXMasBoom += 1
+
+			for i in xrange(boomCount):
+				self.__XMasBoom_Boom()
+
+	def __XMasBoom_Boom(self):
+		x, y, z = player.GetMainCharacterPosition()
+		randX = app.GetRandom(-150, 150)
+		randY = app.GetRandom(-150, 150)
+
+		snd.PlaySound3D(x+randX, -y+randY, z, "sound/common/etc/salute.mp3")
+
+	if app.ENABLE_NEW_USER_CARE:
+		def __PartyRequestQuestion(self, vid, name):
+			vid = int(vid)
+			partyRequestQuestionDialog = uiCommon.QuestionDialogWithTimeLimit()
+			partyRequestQuestionDialog.SetAcceptText(localeInfo.UI_ACCEPT)
+			partyRequestQuestionDialog.SetCancelText(localeInfo.UI_DENY)
+			partyRequestQuestionDialog.SetAcceptEvent(lambda arg=True: self.__AnswerPartyRequest(arg))
+			partyRequestQuestionDialog.SetCancelEvent(lambda arg=False: self.__AnswerPartyRequest(arg))
+			partyRequestQuestionDialog.Open(name + localeInfo.PARTY_DO_YOU_ACCEPT, 10)
+			partyRequestQuestionDialog.SetTimeOverMsg(localeInfo.PARTY_ANSWER_TIMEOVER)
+			partyRequestQuestionDialog.SetCancelOnTimeOver()
+			partyRequestQuestionDialog.vid = vid
+			self.partyRequestQuestionDialog = partyRequestQuestionDialog
+	else:
+		def __PartyRequestQuestion(self, vid):
+			vid = int(vid)
+			partyRequestQuestionDialog = uiCommon.QuestionDialog()
+			partyRequestQuestionDialog.SetText(chr.GetNameByVID(vid) + localeInfo.PARTY_DO_YOU_ACCEPT)
+			partyRequestQuestionDialog.SetAcceptText(localeInfo.UI_ACCEPT)
+			partyRequestQuestionDialog.SetCancelText(localeInfo.UI_DENY)
+			partyRequestQuestionDialog.SetAcceptEvent(lambda arg=True: self.__AnswerPartyRequest(arg))
+			partyRequestQuestionDialog.SetCancelEvent(lambda arg=False: self.__AnswerPartyRequest(arg))
+			partyRequestQuestionDialog.Open()
+			partyRequestQuestionDialog.vid = vid
+			self.partyRequestQuestionDialog = partyRequestQuestionDialog
+
+	def __AnswerPartyRequest(self, answer):
+		if not self.partyRequestQuestionDialog:
+			return
+
+		vid = self.partyRequestQuestionDialog.vid
+
+		if answer:
+			net.SendCommandPacket("/party_request_accept " + str(vid))
+		else:
+			net.SendCommandPacket("/party_request_deny " + str(vid))
+
+		self.partyRequestQuestionDialog.Close()
+		self.partyRequestQuestionDialog = None
+
+	def __PartyRequestDenied(self):
+		self.PopupMessage(localeInfo.PARTY_REQUEST_DENIED)
+
+	def __EnableTestServerFlag(self):
+		# Do not allow the server to remotely toggle client test/debug behavior.
+		try:
+			import debugInfo
+			if debugInfo.IsDebugMode():
+				app.EnableTestServerFlag()
+		except:
+			pass
+
+	def __IsSafeWebURL(self, url):
+		# Only allow http(s). Block file://, javascript:, data:, etc.
+		if not isinstance(url, str):
+			return False
+		u = url.strip()
+		if not u or len(u) > 2048:
+			return False
+		lu = u.lower()
+		return lu.startswith("http://") or lu.startswith("https://")
+
+	def __IsSafeBgmFile(self, filename):
+		# Prevent traversal/absolute paths from server commands.
+		# Only allow relative BGM file names with safe chars and common extensions.
+		if not isinstance(filename, str):
+			return False
+		f = filename.strip().replace("\\", "/")
+		if not f or len(f) > 128:
+			return False
+		if f.startswith("/") or f.startswith("~") or ".." in f:
+			return False
+		lf = f.lower()
+		if not (lf.endswith(".mp3") or lf.endswith(".ogg") or lf.endswith(".wav")):
+			return False
+		for c in f:
+			# conservative allowed charset
+			if not (c.isalnum() or c in "._-/"):
+				return False
+		return True
+
+	def __InGameShop_Show(self, url):
+		if constInfo.IN_GAME_SHOP_ENABLE:
+			if self.__IsSafeWebURL(url):
+				self.interface.OpenWebWindow(url)
+
+	# WEDDING
+	def __LoginLover(self):
+		if self.interface.wndMessenger:
+			self.interface.wndMessenger.OnLoginLover()
+
+	def __LogoutLover(self):
+		if self.interface.wndMessenger:
+			self.interface.wndMessenger.OnLogoutLover()
+		if self.affectShower:
+			self.affectShower.HideLoverState()
+
+	def __LoverNear(self):
+		if self.affectShower:
+			self.affectShower.ShowLoverState()
+
+	def __LoverFar(self):
+		if self.affectShower:
+			self.affectShower.HideLoverState()
+
+	def __LoverDivorce(self):
+		if self.interface.wndMessenger:
+			self.interface.wndMessenger.ClearLoverInfo()
+		if self.affectShower:
+			self.affectShower.ClearLoverState()
+
+	def __PlayMusic(self, flag, filename):
+		flag = int(flag)
+		if flag:
+			if not self.__IsSafeBgmFile(filename):
+				return
+			snd.FadeOutAllMusic()
+			musicInfo.SaveLastPlayFieldMusic()
+			snd.FadeInMusic("BGM/" + filename)
+		else:
+			snd.FadeOutAllMusic()
+			musicInfo.LoadLastPlayFieldMusic()
+			snd.FadeInMusic("BGM/" + musicInfo.fieldMusic)
+
+	# END_OF_WEDDING
+
+	if app.ENABLE_POPUP_NOTICE:
+		def __SetPopupNoticeEventFlag(self, flag_value):
+			self.interface.SetPopupNoticeEventFlag(int(flag_value))
+
+		def __PopupNoticeProcess(self, is_checked, url):
+			# URL must be http(s) only
+			if self.__IsSafeWebURL(url):
+				self.interface.PopupNoticeProcess(int(is_checked), url)
+
+	if app.ENABLE_ACCE_COSTUME_SYSTEM:
+		def OpenAcceWindow(self, type):
+			self.interface.AcceDialogOpen(type)
+
+		def CloseAcceWindow(self):
+			self.interface.AcceDialogClose()
+
+	if app.ENABLE_AURA_COSTUME_SYSTEM:
+		def OpenAuraWindow(self, type):
+			self.interface.AuraDialogOpen(type)
+
+		def CloseAuraWindow(self):
+			self.interface.AuraDialogClose()
+
+	if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+		## HilightSlot Change
+		def DeactivateSlot(self, slotindex, type):
+			self.interface.DeactivateSlot(slotindex, type)
+
+		## HilightSlot Change
+		def ActivateSlot(self, slotindex, type):
+			self.interface.ActivateSlot(slotindex, type)
+
+	if app.ENABLE_MOVE_COSTUME_ATTR:
+		def __ItemCombinationDialog(self):
+			self.interface.ItemCombinationDialogOpen()
+	else:
+		def __ItemCombinationDialog(self):
+			return
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def ExInvenItemUseMsg(self, item_vnum, msg, enough_count):
+			self.interface.ExInvenItemUseMsg(item_vnum, msg, enough_count)
+
+	if app.ENABLE_CHANGED_ATTR:
+		def OpenSelectAttrDialog(self, window_type, slotIdx):
+			self.interface.OpenSelectAttrDialog(window_type, slotIdx)
+
+	if app.ENABLE_RANKING_SYSTEM:
+		def OpenRankingBoard(self, type, category):
+			self.interface.OpenRankingBoardWindow(type, category)
+
+	if app.ENABLE_MAILBOX:
+		def MailBoxProcess(self, type, data):
+			if self.interface:
+				self.interface.MailBoxProcess(type, data)
+
+	if app.ENABLE_LOOTING_SYSTEM:
+		def LootingSystemProcess(self):
+			if self.interface:
+				self.interface.LootingSystemProcess()
+
+	if app.ENABLE_MINI_GAME_YUTNORI:
+		def __MiniGameYutnori(self, enable):
+			if app.ENABLE_EVENT_BANNER:
+				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_YUTNORI, int(enable))
+			else:
+				pass
+
+		def YutnoriProcess(self, type, data):
+			if self.interface:
+				self.interface.YutnoriProcess(type, data)
+
+		def YutnoriFlagProcess(self, type, data):
+			if self.interface:
+				self.interface.YutnoriFlagProcess(type, data)
+
+	if app.ENABLE_LUCKY_BOX:
+		def ShowLuckyBoxWindow(self, dwItemVnum, byItemCount, iNeedMoney, wSlotIndex):
+			if self.interface:
+				self.interface.ShowLuckyBoxWindow(dwItemVnum, byItemCount, iNeedMoney, wSlotIndex)
+
+	if app.ENABLE_ATTR_6TH_7TH:
+		def __OpenAttr67AddDlg(self):
+			if self.interface:
+				self.interface.OpenAttr67AddDlg()
+
+	if app.ENABLE_FISHING_GAME:
+		def OnFishingGameStart(self, level):
+			if self.interface:
+				self.interface.OpenFishingGameWindow(level)
+
+		def OnFishingStopGame(self):
+			if self.interface:
+				self.interface.CloseFishingGameWindow()
+
+	if app.ENABLE_CLIENT_TIMER:
+		def ClientTimerProcess(self, type, data = None):
+			self.interface.wndMiniMap.ClientTimerProcess(type, data)
+
+	if app.ENABLE_SKILL_COOLTIME_UPDATE:
+		def SkillClearCoolTime(self, slotIndex):
+			self.interface.SkillClearCoolTime(slotIndex)
+
+	if app.ENABLE_EXPRESSING_EMOTION:
+		def AddSpecialActionSlot(self, byType, dwDuration):
+			self.interface.AddSpecialActionSlot(byType, dwDuration)
+
+		def RemoveSpecialActionSlot(self, iIndex):
+			self.interface.RemoveSpecialActionSlot(iIndex)
+
+		def RemoveQuickSlotIndex(self, iIndex):
+			self.interface.RemoveQuickSlotIndex(iIndex)
+
+	if app.ENABLE_SNOWFLAKE_STICK_EVENT:
+		def __SnowflakeStickEvent(self, end_time):
+			player.SetSnowflakeStickEvent(int(end_time))
+
+			if app.ENABLE_EVENT_BANNER:
+				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_SNOWFLAKE_STICK_EVENT, int(end_time))
+
+		def SnowflakeStickEventProcess(self, type, data):
+			if self.interface:
+				self.interface.SnowflakeStickEventProcess(type, data)
+
+	if app.ENABLE_REFINE_ELEMENT_SYSTEM:
+		def RefineElementProcess(self, type, refine_type, data):
+			if self.interface:
+				self.interface.RefineElementProcess(type, refine_type, data)
+
+	if app.ENABLE_HIDE_COSTUME_SYSTEM:
+		def __SetHiddenCostumePart(self, part, hidden):
+			if self.interface:
+				self.interface.SetHiddenCostumePart(int(part), int(hidden))
+
+	if app.ENABLE_EVENT_BANNER:
+		def RefreshInGameEvent(self):
+			if self.interface:
+				self.interface.RefreshInGameEvent()
+
+	if app.ENABLE_LOCALE_CLIENT:
+		def LanguageChange(self):
+			if self.interface:
+				self.interface.LanguageChange()
+
+	if app.ENABLE_LEFT_SEAT:
+		def LoadLeftSeatWaitTimeIndexData(self):
+			if self.interface:
+				self.interface.LoadLeftSeatWaitTimeIndexData()
+
+		def OpenLeftSeatDialog(self):
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.LEFT_SEAT_STATE_ON)
+
+			self.left_seat_dialog = uiCommon.PopupDialog()
+			self.left_seat_dialog.SetText(localeInfo.LEFT_SEAT_RELEASE_ASK)
+			self.left_seat_dialog.SetAcceptEvent(ui.__mem_func__(self.__ReleaseLeftSeat))
+
+			w, h = self.left_seat_dialog.GetTextSize()
+			self.left_seat_dialog.SetWidth(w + 60)
+
+			self.left_seat_dialog.Open()
+
+		def CloseLeftSeatDialog(self):
+			if self.left_seat_dialog:
+				self.left_seat_dialog.Close()
+
+		def __ReleaseLeftSeat(self):
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.LEFT_SEAT_STATE_OFF)
+			net.DisableLeftSeatLogOutState()
+
+	if app.ENABLE_GUILD_DRAGONLAIR_SYSTEM:
+		def __ClearGuildRedDragonLairRanking(self):
+			guild.ClearDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED)
+
+		def __CheckRedDragonLairRanking(self):
+			if guild.CheckDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED) == 0:
+				self.interface.RefreshGuildDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED)
+				self.interface.OpenGuildDragonLairRanking(guild.GUILD_DRAGONLAIR_TYPE_RED)
+
+		def OpenGuildDragonLairRanking(self, type):
+			self.interface.OpenGuildDragonLairRanking(type)
+
+		def RefreshGuildDragonLairRanking(self, type):
+			self.interface.RefreshGuildDragonLairRanking(type)
+
+		if app.ENABLE_GUILD_DRAGONLAIR_PARTY_SYSTEM:
+			def SetGuildDragonLairFistGuildText(self, second):
+				self.interface.SetGuildDragonLairFistGuildText(second)
+			def SetGuildDragonLairStart(self):
+				self.interface.SetGuildDragonLairStart()
+			def SetGuildDragonLairSuccess(self):
+				self.interface.SetGuildDragonLairSuccess()
+
+	if app.ENABLE_SUMMER_EVENT_ROULETTE:
+		def __LateSummerEvent(self, enable):
+			background.SetLateSummerEvent(int(enable))
+			if app.ENABLE_EVENT_BANNER:
+				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_ROULETTE, int(enable))
+
+		def RouletteProcess(self, type, data = None):
+			self.interface.RouletteProcess(type, data)
+
+	if app.ENABLE_FLOWER_EVENT:
+		def __FlowerEvent(self, enable):
+			player.SetFlowerEventEnable(int(enable))
+			if app.ENABLE_EVENT_BANNER:
+				ingameEventSystem.SetInGameEventEnable(ingameEventSystem.INGAME_EVENT_TYPE_FLOWER_EVENT, int(enable))
+
+		def FlowerEventProcess(self, type, data = None):
+			self.interface.FlowerEventProcess(type, data)
+
+	if app.ENABLE_GROWTH_PET_SYSTEM:
+		def PetHatchingWindowCommand(self, command):
+			self.interface.PetHatchingWindowCommand(command)
+
+		def PetNameChangeWindowCommand(self, command):
+			self.interface.PetNameChangeWindowCommand(command)
+
+		def PetSkillUpgradeDlgOpen(self, slot, index, gold):
+			self.interface.PetSkillUpgradeDlgOpen(slot, index, gold)
+
+		def PetFlashEvent(self, index):
+			self.interface.PetFlashEvent(index)
+
+		def PetAffectShowerRefresh(self):
+			self.interface.PetAffectShowerRefresh()
+
+		def PetFeedReuslt(self, result):
+			self.interface.PetFeedReuslt(result)
+			
+		def PetAttrDetermineResult(self, byType):
+			self.interface.PetAttrDetermineResult(byType)
+			
+		def PetAttrChangeResult(self, slotIndex, byType):
+			self.interface.PetAttrChangeResult(slotIndex, byType)
+			
+		def PetReviveResult(self, result):
+			self.interface.PetReviveResult(result)
+			
+		def PetWindowTypeResult(self, result):
+			self.interface.PetWindowTypeResult(result)
diff --git a/client/pack/root/intrologin.py b/client/pack/root/intrologin.py
index 9264fbf..fc5c2e4 100644
--- a/client/pack/root/intrologin.py
+++ b/client/pack/root/intrologin.py
@@ -1,822 +1,863 @@
-import app
-import net
-import ui
-import snd
-import wndMgr
-import musicInfo
-import serverInfo
-import systemSetting
-import ServerStateChecker
-import localeInfo
-import constInfo
-import uiCommon
-import ime
-import uiScriptLocale
-import time
-import dbg
-import uiGuild
-import os
-import serverCommandParser
-
-RegisteredID = ""
-RegisteredPassword = ""
-# RegisteredPin = ""
-LOGIN_DELAY_SEC = 0.0 #Default 0.0
-
-def IsLoginDelay():
-	global LOGIN_DELAY_SEC
-	if LOGIN_DELAY_SEC > 0.0:
-		return True
-	else:
-		return False
-
-class ConnectingDialog(ui.ScriptWindow):
-
-	def __init__(self):
-		ui.ScriptWindow.__init__(self)
-		self.SetWindowName("ConnectingDialog")
-		self.__LoadDialog()
-		self.eventTimeOver = lambda *arg: None
-		self.eventExit = lambda *arg: None
-
-	def __del__(self):
-		ui.ScriptWindow.__del__(self)
-
-	def __LoadDialog(self):
-		try:
-			PythonScriptLoader = ui.PythonScriptLoader()
-			PythonScriptLoader.LoadScriptFile(self, "UIScript/ConnectingDialog.py")
-
-			self.board = self.GetChild("board")
-			self.message = self.GetChild("message")
-			self.countdownMessage = self.GetChild("countdown_message")
-
-		except:
-			import exception
-			exception.Abort("ConnectingDialog.LoadDialog.BindObject")
-
-	def Open(self, waitTime):
-		curTime = time.clock()
-		self.endTime = curTime + waitTime
-
-		self.Lock()
-		self.SetCenterPosition()
-		self.SetTop()
-		self.Show()
-
-	def Close(self):
-		self.Unlock()
-		self.ClearDictionary()
-		self.Hide()
-
-	def Destroy(self):
-		self.Hide()
-		self.ClearDictionary()
-
-	def SetText(self, text):
-		self.message.SetText(text)
-
-	def SetCountDownMessage(self, waitTime):
-		self.countdownMessage.SetText("%.0f%s" % (waitTime, localeInfo.SECOND))
-
-	def SAFE_SetTimeOverEvent(self, event):
-		self.eventTimeOver = ui.__mem_func__(event)
-
-	def SAFE_SetExitEvent(self, event):
-		self.eventExit = ui.__mem_func__(event)
-
-	def OnUpdate(self):
-		lastTime = max(0, self.endTime - time.clock())
-		if 0 == lastTime:
-			self.Close()
-			self.eventTimeOver()
-		else:
-			self.SetCountDownMessage(self.endTime - time.clock())
-
-	def OnPressExitKey(self):
-		self.eventExit()
-		return True
-
-class LoginWindow(ui.ScriptWindow):
-	def __init__(self, stream):
-		print "LoginWindow::LoginWindow"
-		ui.ScriptWindow.__init__(self)
-		self.SetWindowName("LoginWindow")
-		net.SetPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
-		net.SetAccountConnectorHandler(self)
-
-		self.connectingDialog = None
-		self.stream=stream
-		self.isNowCountDown=False
-
-
-
-	def __del__(self):
-		print "LoginWindow::~LoginWindow"
-		net.SetAccountConnectorHandler(0)
-		net.ClearPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
-		ui.ScriptWindow.__del__(self)
-
-
-		
-	def Open(self):
-		ServerStateChecker.Create(self)
-
-		print "LoginWindow::Open()"
-		self.loginFailureMsgDict={
-			"ALREADY"	: localeInfo.LOGIN_FAILURE_ALREAY,
-			"NOID"		: localeInfo.LOGIN_FAILURE_NOT_EXIST_ID,
-			"WRONGPWD"	: localeInfo.LOGIN_FAILURE_WRONG_PASSWORD,
-			"FULL"		: localeInfo.LOGIN_FAILURE_TOO_MANY_USER,
-			"SHUTDOWN"	: localeInfo.LOGIN_FAILURE_SHUTDOWN,
-			"NOTAVAIL"	: localeInfo.LOGIN_FAILURE_NOT_AVAIL,
-			"NOBILL"	: localeInfo.LOGIN_FAILURE_NOBILL,
-			"BLKLOGIN"	: localeInfo.LOGIN_FAILURE_BLOCK_LOGIN,
-			# "GUV_PC"	: localeInfo.LOGIN_FAILURE_GUV_PC,
-			# "MAC_YOK"	: localeInfo.LOGIN_FAILURE_MAC_YOK,
-			# "NOPIN"		: localeInfo.LOGIN_FAILURE_PIN,
-			# "NOCLIENT"	: localeInfo.LOGIN_FAILURE_CLIENT_VERSION,
-			# "NOSERVER"	: localeInfo.LOGIN_FAILURE_SERVER,
-		}
-
-		self.loginFailureFuncDict = {
-			"WRONGPWD"	: self.__DisconnectAndInputPassword,
-			"QUIT"		: app.Exit,
-		}
-
-		self.SetSize(wndMgr.GetScreenWidth(), wndMgr.GetScreenHeight())
-
-		if not self.__LoadScript("UIScript/LoginWindow.py"):
-			dbg.TraceError("LoginWindow.Open - __LoadScript Error")
-			return
-
-		# self.__LoadLoginInfo("loginInfo.xml")
-		app.loggined = False
-		if app.loggined:
-			self.loginFailureFuncDict = {
-			"WRONGPWD"	: app.Exit,
-			"WRONGMAT"	: app.Exit,
-			"QUIT"		: app.Exit,
-			}
-
-		if musicInfo.loginMusic:
-			snd.SetMusicVolume(systemSetting.GetMusicVolume())
-			snd.FadeInMusic("BGM/"+musicInfo.loginMusic)
-
-		snd.SetSoundVolume(systemSetting.GetSoundVolume())
-
-		ime.AddExceptKey(91)
-		ime.AddExceptKey(93)
-		self.Show()
-
-		self.__RefreshServerList()
-		self.__OpenLoginBoard()
-
-		#self.idEditLine.UpdatePlaceHolder()
-		#self.pwdEditLine.UpdatePlaceHolder()
-		# self.pinEditLine.UpdatePlaceHolder()
-
-		app.ShowCursor()
-
-	def Close(self):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		ServerStateChecker.Initialize(self)
-		print "---------------------------------------------------------------------------- CLOSE LOGIN WINDOW "
-
-		if musicInfo.loginMusic != "" and musicInfo.selectMusic != "":
-			snd.FadeOutMusic("BGM/"+musicInfo.loginMusic)
-
-		self.idEditLine.SetTabEvent(0)
-		self.idEditLine.SetReturnEvent(0)
-		self.pwdEditLine.SetReturnEvent(0)
-		self.pwdEditLine.SetTabEvent(0)
-		# self.pinEditLine.SetReturnEvent(0)
-		# self.pinEditLine.SetTabEvent(0)
-
-		self.loginBoard = None
-		self.idEditLine = None
-		self.connectingDialog = None
-
-		self.serverList = None
-
-		self.KillFocus()
-		self.Hide()
-
-		self.stream.popupWindow.Close()
-		self.loginFailureFuncDict=None
-		ime.ClearExceptKey()
-		app.HideCursor()
-
-
-
-
-	def __ExitGame(self):
-		app.Exit()
-
-	def SetIDEditLineFocus(self):
-		if self.idEditLine != None:
-			self.idEditLine.SetFocus()
-
-	def SetPasswordEditLineFocus(self):
-		if self.idEditLine != None:
-			self.idEditLine.SetText("")
-			self.idEditLine.SetFocus()
-
-		if self.pwdEditLine != None:
-			self.pwdEditLine.SetText("")
-
-		# if self.pinEditLine != None:
-			# self.pinEditLine.SetText("")
-
-	def OnEndCountDown(self):
-		self.isNowCountDown = False
-		self.OnConnectFailure()
-
-	def OnConnectFailure(self):
-
-		if self.isNowCountDown:
-			return
-
-		snd.PlaySound("sound/ui/loginfail.wav")
-
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		if app.loggined:
-			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.__ExitGame)
-		else:
-			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.SetPasswordEditLineFocus)
-
-	def OnHandShake(self):
-		snd.PlaySound("sound/ui/loginok.wav")
-
-
-	def OnLoginStart(self):
-		self.PopupDisplayMessage(localeInfo.LOGIN_PROCESSING)
-
-	def OnLoginFailure(self, error):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		try:
-			loginFailureMsg = self.loginFailureMsgDict[error]
-		except KeyError:
-			loginFailureMsg = localeInfo.LOGIN_FAILURE_UNKNOWN  + error
-
-		loginFailureFunc=self.loginFailureFuncDict.get(error, self.SetPasswordEditLineFocus)
-		if app.loggined:
-			self.PopupNotifyMessage(loginFailureMsg, self.__ExitGame)
-		else:
-			self.PopupNotifyMessage(loginFailureMsg, loginFailureFunc)
-
-		snd.PlaySound("sound/ui/loginfail.wav")
-
-	def __DisconnectAndInputID(self):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		self.SetIDEditLineFocus()
-		net.Disconnect()
-
-	def __DisconnectAndInputPassword(self):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		self.SetPasswordEditLineFocus()
-		net.Disconnect()
-
-	def __LoadScript(self, fileName):
-		try:
-			pyScrLoader = ui.PythonScriptLoader()
-			pyScrLoader.LoadScriptFile(self, fileName)
-		except:
-			import exception
-			exception.Abort("LoginWindow.__LoadScript.LoadObject")
-
-		try:
-			GetObject=self.GetChild
-			self.serverList				= GetObject("ServerList")
-			self.loginBoard				= GetObject("LoginBoard")
-			self.idEditLine				= GetObject("ID_EditLine")
-			self.pwdEditLine			= GetObject("Password_EditLine")
-			# self.pinEditLine			= GetObject("Pin_EditLine")
-			self.loginButton			= GetObject("LoginButton")
-			self.loginExitButton		= GetObject("LoginExitButton")
-
-			self.ChannelButton1			= GetObject("ChannelButton1")
-			self.ChannelButton2			= GetObject("ChannelButton2")
-			self.ChannelButton3			= GetObject("ChannelButton3")
-			self.ChannelButton4			= GetObject("ChannelButton4")
-			self.ChannelButton5			= GetObject("ChannelButton5")
-			self.ChannelButton6			= GetObject("ChannelButton6")
-
-			self.ChannelButtonTooltip1	= GetObject("ChannelButtonTooltip1")
-			self.ChannelButtonTooltip2	= GetObject("ChannelButtonTooltip2")
-			self.ChannelButtonTooltip3	= GetObject("ChannelButtonTooltip3")
-			self.ChannelButtonTooltip4	= GetObject("ChannelButtonTooltip4")
-			self.ChannelButtonTooltip5	= GetObject("ChannelButtonTooltip5")
-			self.ChannelButtonTooltip6	= GetObject("ChannelButtonTooltip6")
-
-			self.sitebutton			= GetObject("site")
-			self.discordbutton			= GetObject("discord")
-			self.registerbutton			= GetObject("register")
-
-			self.registerButton1		= GetObject("registerButton1")
-			self.registerButton2		= GetObject("registerButton2")
-			self.registerButton3		= GetObject("registerButton3")
-			self.registerButton4		= GetObject("registerButton4")
-			self.registerButton5		= GetObject("registerButton5")
-			self.registerButton6		= GetObject("registerButton6")
-			self.registerButtons		= { 1 : self.registerButton1, 2 : self.registerButton2, 3 : self.registerButton3, 4 : self.registerButton4 , 5 : self.registerButton5 , 6 : self.registerButton6 }
-
-			self.deleteButton1			= GetObject("deleteButton1")
-			self.deleteButton2			= GetObject("deleteButton2")
-			self.deleteButton3			= GetObject("deleteButton3")
-			self.deleteButton4			= GetObject("deleteButton4")
-			self.deleteButton5			= GetObject("deleteButton5")
-			self.deleteButton6			= GetObject("deleteButton6")
-			self.serverList.Hide()
-		except:
-			import exception
-			exception.Abort("LoginWindow.__LoadScript.BindObject")
-
-		self.loginButton.SetEvent(ui.__mem_func__(self.__OnClickLoginButton))
-		self.loginExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitButton))
-		self.serverList.SetEvent(ui.__mem_func__(self.__OnSelectServer))
-
-		self.idEditLine.SetReturnEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
-		self.idEditLine.SetTabEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
-		# self.idEditLine.SetPlaceHolder(" Username")
-
-		# self.pwdEditLine.SetReturnEvent(ui.__mem_func__(self.pinEditLine.SetFocus))
-		# self.pwdEditLine.SetTabEvent(ui.__mem_func__(self.pinEditLine.SetFocus))
-		# self.pwdEditLine.SetPlaceHolder(" Password")
-
-		# self.pinEditLine.SetReturnEvent(ui.__mem_func__(self.__OnClickLoginButton))
-		# self.pinEditLine.SetTabEvent(ui.__mem_func__(self.idEditLine.SetFocus))
-		# self.pinEditLine.SetPlaceHolder(" Pin", (0, -2))
-
-		self.ChannelButton1.SetEvent(ui.__mem_func__(self.__SelectChannel), 1)
-		self.ChannelButton2.SetEvent(ui.__mem_func__(self.__SelectChannel), 2)
-		self.ChannelButton3.SetEvent(ui.__mem_func__(self.__SelectChannel), 3)
-		self.ChannelButton4.SetEvent(ui.__mem_func__(self.__SelectChannel), 4)
-		self.ChannelButton5.SetEvent(ui.__mem_func__(self.__SelectChannel), 5)
-		self.ChannelButton6.SetEvent(ui.__mem_func__(self.__SelectChannel), 6)
-
-
-		self.sitebutton.SetEvent(ui.__mem_func__(self.__OnClickSite))
-		self.discordbutton.SetEvent(ui.__mem_func__(self.__OnClickDiscord))
-		self.registerbutton.SetEvent(ui.__mem_func__(self.__OnClickRegister))
-
-		self.registerButton1.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 1)
-		self.registerButton2.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 2)
-		self.registerButton3.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 3)
-		self.registerButton4.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 4)
-		self.registerButton5.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 5)
-		self.registerButton6.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 6)
-
-		self.deleteButton1.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 1)
-		self.deleteButton2.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 2)
-		self.deleteButton3.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 3)
-		self.deleteButton4.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 4)
-		self.deleteButton5.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 5)
-		self.deleteButton6.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 6)
-
-
-		return 1
-
-		localeInfo.UI_DEF_FONT = uiDefFontBackup
-
-	def Connect(self, id, pwd):
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(localeInfo.LOGIN_CONNETING, self.OnProcessingCancel, localeInfo.UI_CANCEL)
-		self.stream.SetLoginInfo(id, pwd)
-		self.stream.Connect()
-
-	def OnProcessingCancel(self):
-		self.isLoginCanceled = True
-		self.stream.popupWindow.Close()
-
-
-	def __OnClickExitButton(self):
-		self.stream.SetPhaseWindow(0)
-
-	def __SetServerInfo(self, name):
-		net.SetServerInfo(name.strip())
-		self.serverInfo.SetText(name)
-
-	def __LoadLoginInfo(self, loginInfoFileName):
-		def getValue(element, name, default):
-			if [] != element.getElementsByTagName(name):
-				return element.getElementsByTagName(name).item(0).firstChild.nodeValue
-			else:
-				return default
-
-		self.id = None
-		self.pwd = None
-		# self.pin = None
-		self.loginnedServer = None
-		self.loginnedChannel = None
-		app.loggined = False
-
-		self.loginInfo = True
-		try:
-			server_name = logininfo.getAttribute("name")
-			channel_idx = int(logininfo.getAttribute("channel_idx"))
-		except:
-			return
-
-		try:
-			matched = False
-
-			for k, v in serverInfo.REGION_DICT[0].iteritems():
-				if v["name"] == server_name:
-					account_addr = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["ip"]
-					account_port = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["port"]
-
-					channel_info = v["channel"][channel_idx]
-					channel_name = channel_info["name"]
-					addr = channel_info["ip"]
-					port = channel_info["tcp_port"]
-
-					net.SetMarkServer(addr, port)
-					self.stream.SetConnectInfo(addr, port, account_addr, account_port)
-
-					matched = True
-					break
-
-			if False == matched:
-				return
-		except:
-			return
-
-		self.__SetServerInfo("%s, %s " % (server_name, channel_name))
-		id = getValue(logininfo, "id", "")
-		pwd = getValue(logininfo, "pwd", "")
-		# pin = getValue(logininfo, "pin", "")
-		self.idEditLine.SetText(id)
-		self.pwdEditLine.SetText(pwd)
-		# self.pinEditLine.SetText(pin)
-		slot = getValue(logininfo, "slot", "0")
-		locale = getValue(logininfo, "locale", "")
-		locale_dir = getValue(logininfo, "locale_dir", "")
-		is_auto_login = int(getValue(logininfo, "auto_login", "0"))
-
-		self.stream.SetCharacterSlot(int(slot))
-		self.stream.isAutoLogin=is_auto_login
-		self.stream.isAutoSelect=is_auto_login
-
-		if locale and locale_dir:
-			app.ForceSetLocale(locale, locale_dir)
-
-
-		return
-
-
-	def PopupDisplayMessage(self, msg):
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(msg)
-
-	def PopupNotifyMessage(self, msg, func=0):
-		if not func:
-			func=self.EmptyFunc
-
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(msg, func, localeInfo.UI_OK)
-
-
-	def OnPressExitKey(self):
-		self.stream.popupWindow.Close()
-		self.stream.SetPhaseWindow(0)
-		return True
-
-	def OnExit(self):
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(app.Exit, localeInfo.UI_OK)
-
-	def OnUpdate(self):
-		ServerStateChecker.Update()
-		for i in range(1,7):
-			if os.path.exists('UserData/Account/' + (str(i))+ '.cfg'):
-				accountfile = open('UserData/Account/' + (str(i))+ '.cfg', "r")
-				informations = (accountfile.read()).split("|")
-				self.registerButtons[i].SetText(informations[1])
-			else:
-				self.registerButtons[i].SetText(uiScriptLocale.FREE)
-
-
-	def EmptyFunc(self):
-		pass
-
-
-	def __GetRegionID(self):
-		return 0
-
-	def __GetServerID(self):
-		return self.serverList.GetSelectedItem()
-
-
-	def __ServerIDToServerIndex(self, regionID, targetServerID):
-		try:
-			regionDict = serverInfo.REGION_DICT[regionID]
-		except KeyError:
-			return -1
-
-		retServerIndex = 0
-		for eachServerID, regionDataDict in regionDict.items():
-			if eachServerID == targetServerID:
-				return retServerIndex
-
-			retServerIndex += 1
-		return -1
-
-	def __ChannelIDToChannelIndex(self, channelID):
-		return channelID - 1
-
-	def __OpenServerBoard(self):
-		loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
-		serverIndex = self.__ServerIDToServerIndex(loadRegionID, loadServerID)
-		channelIndex = self.__ChannelIDToChannelIndex(loadChannelID)
-		self.serverList.SelectItem(serverIndex)
-
-		self.loginBoard.Hide()
-
-	def __SelectChannel(self, channel):
-		self.ChannelButtons = { 1 : [self.ChannelButton1, serverInfo.SRV1["ch1"]], 2 : [self.ChannelButton2, serverInfo.SRV1["ch2"]], 3 : [self.ChannelButton3, serverInfo.SRV1["ch3"]], 4 : [self.ChannelButton4, serverInfo.SRV1["ch4"]], 5 : [self.ChannelButton5, serverInfo.SRV1["auth1"]], 6 : [self.ChannelButton6, serverInfo.SRV1["ch6"]] }
-		self.ChannelButton1.SetUp()
-		self.ChannelButton2.SetUp()
-		self.ChannelButton3.SetUp()
-		self.ChannelButton4.SetUp()
-		self.ChannelButton5.SetUp()
-		self.ChannelButton6.SetUp()
-		if channel == 1:
-			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH1")
-		elif channel == 2:
-			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH2")
-		elif channel == 3:
-			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH3")
-		elif channel == 4:
-			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH4")
-		self.ChannelButtons[channel][0].Down()
-		self.stream.SetConnectInfo(serverInfo.SRV1["host"], self.ChannelButtons[channel][1], serverInfo.SRV1["host"], serverInfo.SRV1["auth1"])
-		net.SetMarkServer(serverInfo.SRV1["host"], serverInfo.SRV1["ch1"])
-		app.SetGuildMarkPath("10.tga")
-		app.SetGuildSymbolPath("10")
-
-	def __SaveChannelInfo(self):
-		try:
-			file=open("channel.inf", "w")
-			file.write("%d %d %d" % (self.__GetServerID(), self.__GetChannelID(), self.__GetRegionID()))
-		except:
-			print "LoginWindow.__SaveChannelInfo - SaveError"
-
-	def __LoadChannelInfo(self):
-		try:
-			file=open("channel.inf")
-			lines=file.readlines()
-
-			if len(lines)>0:
-				tokens=lines[0].split()
-				selServerID=int(tokens[0])
-				selChannelID=int(tokens[1])
-
-				if len(tokens) == 3:
-					regionID = int(tokens[2])
-
-				return regionID, selServerID, selChannelID
-		except:
-			print "LoginWindow.__LoadChannelInfo - OpenError"
-			return -1, -1, -1
-	def __OpenLoginBoard(self):
-
-		loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
-		serverIndex = self.__ServerIDToServerIndex(loadRegionID, loadServerID)
-		channelIndex = self.__ChannelIDToChannelIndex(loadChannelID)
-		self.__SelectChannel(1)
-		self.serverList.SelectItem(serverIndex)
-
-		if app.loggined:
-			self.Connect(self.id, self.pwd)
-			self.loginBoard.Hide()
-		elif not self.stream.isAutoLogin:
-			self.loginBoard.Show()
-
-		if self.idEditLine == None:
-			self.idEditLine.SetText("")
-
-		if self.pwdEditLine == None:
-			self.pwdEditLine.SetText("")
-
-		# if self.pinEditLine == None:
-			# self.pinEditLine.SetText("")
-
-		self.idEditLine.SetFocus()
-
-	def __OnSelectRegionGroup(self):
-		self.__RefreshServerList()
-
-	def __OnSelectSettlementArea(self):
-		regionID = self.__GetRegionID()
-		serverID = self.serverListOnRegionBoard.GetSelectedItem()
-		serverIndex = self.__ServerIDToServerIndex(regionID, serverID)
-		self.serverList.SelectItem(serverIndex)
-		self.__OnSelectServer()
-
-	def __RefreshServerList(self):
-		regionID = self.__GetRegionID()
-		if not serverInfo.REGION_DICT.has_key(regionID):
-			return
-
-		self.serverList.ClearItem()
-
-		regionDict = serverInfo.REGION_DICT[regionID]
-		visible_index = 1
-		for id, regionDataDict in regionDict.items():
-			name = regionDataDict.get("name", "noname")
-			server_id = visible_index
-
-			self.serverList.InsertItem(id, "  %02d. %s" % (int(server_id), name))
-			visible_index += 1
-
-	def __OnSelectServer(self):
-		self.__RequestServerStateList()
-		self.__RefreshServerStateList()
-
-	def __RequestServerStateList(self):
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-
-		try:
-			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
-		except:
-			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
-			return
-
-		ServerStateChecker.Initialize();
-		for id, channelDataDict in channelDict.items():
-			key=channelDataDict["key"]
-			ip=channelDataDict["ip"]
-			udp_port=channelDataDict["udp_port"]
-			ServerStateChecker.AddChannel(key, ip, udp_port)
-
-		ServerStateChecker.Request()
-
-	def __RefreshServerStateList(self):
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-		try:
-			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
-		except:
-			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
-			return
-
-		for channelID, channelDataDict in channelDict.items():#06.01.2020
-			channelState = channelDataDict["state"]
-			self.ChannelTooltips = { 1 : self.ChannelButtonTooltip1, 2 : self.ChannelButtonTooltip2, 3 : self.ChannelButtonTooltip3, 4 : self.ChannelButtonTooltip4, 5 : self.ChannelButtonTooltip5, 6 : self.ChannelButtonTooltip6 }
-			if channelState == "NORM":
-				self.ChannelTooltips[channelID].SetText("|cff32cd32%s" % channelState)
-			elif channelState == "BUSY":
-				self.ChannelTooltips[channelID].SetText("|cffdaa520%s" % channelState)
-			elif channelState == "FULL":
-				self.ChannelTooltips[channelID].SetText("|cffff0000%s" % channelState)
-			else:
-				self.ChannelTooltips[channelID].SetText("|cffff0000%s" % channelState)
-
-	def __GetChannelName(self, regionID, selServerID, selChannelID):
-		try:
-			return serverInfo.REGION_DICT[regionID][selServerID]["channel"][selChannelID]["name"]
-		except KeyError:
-			if 9==selChannelID:
-				return localeInfo.CHANNEL_PVP
-			else:
-				return localeInfo.CHANNEL_NORMAL % (selChannelID)
-
-	def NotifyChannelState(self, addrKey, state):
-		try:
-			stateName=serverInfo.STATE_DICT[state]
-		except:
-			stateName=serverInfo.STATE_NONE
-
-		regionID=int(addrKey/1000)
-		serverID=int(addrKey/10) % 100
-		channelID=addrKey%10
-
-		try:
-			serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["state"] = stateName
-			self.__RefreshServerStateList()
-		except:
-			import exception
-			exception.Abort(localeInfo.CHANNEL_NOT_FIND_INFO)
-
-	def __OnClickExitServerButton(self):
-		print "exit server"
-		self.__OpenLoginBoard()
-
-
-	def __OnClickSelectRegionButton(self):
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-
-		if (not serverInfo.REGION_DICT.has_key(regionID)):
-			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_REGION)
-			return
-
-		if (not serverInfo.REGION_DICT[regionID].has_key(serverID)):
-			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_SERVER)
-			return
-
-		self.__SaveChannelInfo()
-		self.__RefreshServerList()
-		self.__OpenLoginBoard()
-
-	def OnClickRegisterButton(self, alper):#21.02.2019
-		global RegisteredID
-		global RegisteredPassword
-		# global RegisteredPin
-		al = self.registerButtons[alper].GetText()
-		if al.find(uiScriptLocale.FREE) != -1:
-			id = self.idEditLine.GetText()
-			pwd = self.pwdEditLine.GetText()
-			# pin = self.pinEditLine.GetText()
-			if id == "" or pwd == "":
-				self.PopupNotifyMessage(localeInfo.NOID_OR_PASSWORD)
-			else:
-				if not os.path.exists('UserData/Account/' + str(alper) + '.cfg'):#todo security reg
-					open('UserData/Account/' + str(alper) + '.cfg', "w").write("|"+str(id)+"|"+str(pwd)+"|")
-
-					self.registerButtons[alper].SetText(str(id))
-
-					self.PopupNotifyMessage(localeInfo.ACCOUNT_HAS_REGISTERED)
-				else:
-					pass
-		else:
-			accountfile = open('UserData/Account/' + str(alper)+ '.cfg', "r")
-			informations = (accountfile.read()).split("|")
-			self.Connect(informations[1], informations[2])
-			RegisteredID = informations[1]
-			RegisteredPassword = informations[2]
-			# RegisteredPin = informations[3]
-
-	def __OnClickdeleteButton(self, alper):
-		al = self.registerButtons[alper].GetText()
-
-		if al.find(uiScriptLocale.FREE) != -1:
-			self.PopupNotifyMessage(localeInfo.NO_DELETE_ACCOUNT)
-			return
-		else:
-			os.remove('UserData/Account/' + str(alper)+ '.cfg')
-			self.registerButtons[alper].SetText(uiScriptLocale.FREE)
-			self.PopupNotifyMessage(localeInfo.ACCOUNT_HAS_DELETED)
-
-	def __OnClickSite(self):
-		os.startfile("https://farques.com.tr")
-
-	def __OnClickDiscord(self):
-		os.startfile("https://discord.com/invite/v36Ru9zpJ3")
-	def __OnClickRegister(self):
-		os.startfile("https://farques.com.tr")
-
-	def OnKeyDown(self, key):
-		if 1 == key: #ESC
-			self.OnPressExitKey()
-		elif 59 == key: #F1
-			self.OnClickRegisterButton(1)
-		elif 60 == key: #F2
-			self.OnClickRegisterButton(2)
-		elif 61 == key: #F3
-			self.OnClickRegisterButton(3)
-		elif 62 == key: #F4
-			self.OnClickRegisterButton(4)
-		elif 64 == key: #F5
-			self.OnClickRegisterButton(5)
-		elif 65 == key: #F6
-			self.OnClickRegisterButton(6)
-		else:
-			return True
-		return True
-
-	def __OnClickLoginButton(self):
-		id = self.idEditLine.GetText()
-		pwd = self.pwdEditLine.GetText()
-		# pin = self.pinEditLine.GetText()
-
-		if len(id) == 0:
-			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_ID, self.SetIDEditLineFocus)
-			return
-
-		if len(pwd) == 0:
-			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_PASSWORD, self.SetPasswordEditLineFocus)
-			return
-
-		# if len(pin) == 0:
-			# self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_PIN, self.SetPinEditLineFocus)
-			# return
-
-		self.Connect(id, pwd)
+import app
+import net
+import ui
+import snd
+import wndMgr
+import musicInfo
+import serverInfo
+import systemSetting
+import ServerStateChecker
+import localeInfo
+import constInfo
+import uiCommon
+import ime
+import uiScriptLocale
+import time
+import dbg
+import uiGuild
+import os
+import serverCommandParser
+
+RegisteredID = ""
+# RegisteredPin = ""
+LOGIN_DELAY_SEC = 0.0 #Default 0.0
+
+def IsLoginDelay():
+	global LOGIN_DELAY_SEC
+	if LOGIN_DELAY_SEC > 0.0:
+		return True
+	else:
+		return False
+
+class ConnectingDialog(ui.ScriptWindow):
+
+	def __init__(self):
+		ui.ScriptWindow.__init__(self)
+		self.SetWindowName("ConnectingDialog")
+		self.__LoadDialog()
+		self.eventTimeOver = lambda *arg: None
+		self.eventExit = lambda *arg: None
+
+	def __del__(self):
+		ui.ScriptWindow.__del__(self)
+
+	def __LoadDialog(self):
+		try:
+			PythonScriptLoader = ui.PythonScriptLoader()
+			PythonScriptLoader.LoadScriptFile(self, "UIScript/ConnectingDialog.py")
+
+			self.board = self.GetChild("board")
+			self.message = self.GetChild("message")
+			self.countdownMessage = self.GetChild("countdown_message")
+
+		except:
+			import exception
+			exception.Abort("ConnectingDialog.LoadDialog.BindObject")
+
+	def Open(self, waitTime):
+		curTime = time.clock()
+		self.endTime = curTime + waitTime
+
+		self.Lock()
+		self.SetCenterPosition()
+		self.SetTop()
+		self.Show()
+
+	def Close(self):
+		self.Unlock()
+		self.ClearDictionary()
+		self.Hide()
+
+	def Destroy(self):
+		self.Hide()
+		self.ClearDictionary()
+
+	def SetText(self, text):
+		self.message.SetText(text)
+
+	def SetCountDownMessage(self, waitTime):
+		self.countdownMessage.SetText("%.0f%s" % (waitTime, localeInfo.SECOND))
+
+	def SAFE_SetTimeOverEvent(self, event):
+		self.eventTimeOver = ui.__mem_func__(event)
+
+	def SAFE_SetExitEvent(self, event):
+		self.eventExit = ui.__mem_func__(event)
+
+	def OnUpdate(self):
+		lastTime = max(0, self.endTime - time.clock())
+		if 0 == lastTime:
+			self.Close()
+			self.eventTimeOver()
+		else:
+			self.SetCountDownMessage(self.endTime - time.clock())
+
+	def OnPressExitKey(self):
+		self.eventExit()
+		return True
+
+class LoginWindow(ui.ScriptWindow):
+	def __init__(self, stream):
+		print "LoginWindow::LoginWindow"
+		ui.ScriptWindow.__init__(self)
+		self.SetWindowName("LoginWindow")
+		net.SetPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
+		net.SetAccountConnectorHandler(self)
+
+		self.connectingDialog = None
+		self.stream=stream
+		self.isNowCountDown=False
+
+
+
+	def __del__(self):
+		print "LoginWindow::~LoginWindow"
+		net.SetAccountConnectorHandler(0)
+		net.ClearPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
+		ui.ScriptWindow.__del__(self)
+
+
+		
+	def Open(self):
+		ServerStateChecker.Create(self)
+
+		print "LoginWindow::Open()"
+		self.loginFailureMsgDict={
+			"ALREADY"	: localeInfo.LOGIN_FAILURE_ALREAY,
+			"NOID"		: localeInfo.LOGIN_FAILURE_NOT_EXIST_ID,
+			"WRONGPWD"	: localeInfo.LOGIN_FAILURE_WRONG_PASSWORD,
+			"FULL"		: localeInfo.LOGIN_FAILURE_TOO_MANY_USER,
+			"SHUTDOWN"	: localeInfo.LOGIN_FAILURE_SHUTDOWN,
+			"NOTAVAIL"	: localeInfo.LOGIN_FAILURE_NOT_AVAIL,
+			"NOBILL"	: localeInfo.LOGIN_FAILURE_NOBILL,
+			"BLKLOGIN"	: localeInfo.LOGIN_FAILURE_BLOCK_LOGIN,
+			# "GUV_PC"	: localeInfo.LOGIN_FAILURE_GUV_PC,
+			# "MAC_YOK"	: localeInfo.LOGIN_FAILURE_MAC_YOK,
+			# "NOPIN"		: localeInfo.LOGIN_FAILURE_PIN,
+			# "NOCLIENT"	: localeInfo.LOGIN_FAILURE_CLIENT_VERSION,
+			# "NOSERVER"	: localeInfo.LOGIN_FAILURE_SERVER,
+		}
+
+		self.loginFailureFuncDict = {
+			"WRONGPWD"	: self.__DisconnectAndInputPassword,
+			"QUIT"		: app.Exit,
+		}
+
+		self.SetSize(wndMgr.GetScreenWidth(), wndMgr.GetScreenHeight())
+
+		if not self.__LoadScript("UIScript/LoginWindow.py"):
+			dbg.TraceError("LoginWindow.Open - __LoadScript Error")
+			return
+
+		# self.__LoadLoginInfo("loginInfo.xml")
+		app.loggined = False
+		if app.loggined:
+			self.loginFailureFuncDict = {
+			"WRONGPWD"	: app.Exit,
+			"WRONGMAT"	: app.Exit,
+			"QUIT"		: app.Exit,
+			}
+
+		if musicInfo.loginMusic:
+			snd.SetMusicVolume(systemSetting.GetMusicVolume())
+			snd.FadeInMusic("BGM/"+musicInfo.loginMusic)
+
+		snd.SetSoundVolume(systemSetting.GetSoundVolume())
+
+		ime.AddExceptKey(91)
+		ime.AddExceptKey(93)
+		self.Show()
+
+		self.__RefreshServerList()
+		self.__OpenLoginBoard()
+
+		#self.idEditLine.UpdatePlaceHolder()
+		#self.pwdEditLine.UpdatePlaceHolder()
+		# self.pinEditLine.UpdatePlaceHolder()
+
+		app.ShowCursor()
+
+	def Close(self):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		ServerStateChecker.Initialize(self)
+		print "---------------------------------------------------------------------------- CLOSE LOGIN WINDOW "
+
+		if musicInfo.loginMusic != "" and musicInfo.selectMusic != "":
+			snd.FadeOutMusic("BGM/"+musicInfo.loginMusic)
+
+		self.idEditLine.SetTabEvent(0)
+		self.idEditLine.SetReturnEvent(0)
+		self.pwdEditLine.SetReturnEvent(0)
+		self.pwdEditLine.SetTabEvent(0)
+		# self.pinEditLine.SetReturnEvent(0)
+		# self.pinEditLine.SetTabEvent(0)
+
+		self.loginBoard = None
+		self.idEditLine = None
+		self.connectingDialog = None
+
+		self.serverList = None
+
+		self.KillFocus()
+		self.Hide()
+
+		self.stream.popupWindow.Close()
+		self.loginFailureFuncDict=None
+		ime.ClearExceptKey()
+		app.HideCursor()
+
+
+
+
+	def __ExitGame(self):
+		app.Exit()
+
+	def SetIDEditLineFocus(self):
+		if self.idEditLine != None:
+			self.idEditLine.SetFocus()
+
+	def SetPasswordEditLineFocus(self):
+		if self.idEditLine != None:
+			self.idEditLine.SetText("")
+			self.idEditLine.SetFocus()
+
+		if self.pwdEditLine != None:
+			self.pwdEditLine.SetText("")
+
+		# if self.pinEditLine != None:
+			# self.pinEditLine.SetText("")
+
+	def OnEndCountDown(self):
+		self.isNowCountDown = False
+		self.OnConnectFailure()
+
+	def OnConnectFailure(self):
+
+		if self.isNowCountDown:
+			return
+
+		snd.PlaySound("sound/ui/loginfail.wav")
+
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		if app.loggined:
+			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.__ExitGame)
+		else:
+			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.SetPasswordEditLineFocus)
+
+	def OnHandShake(self):
+		snd.PlaySound("sound/ui/loginok.wav")
+
+
+	def OnLoginStart(self):
+		self.PopupDisplayMessage(localeInfo.LOGIN_PROCESSING)
+
+	def OnLoginFailure(self, error):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		try:
+			loginFailureMsg = self.loginFailureMsgDict[error]
+		except KeyError:
+			loginFailureMsg = localeInfo.LOGIN_FAILURE_UNKNOWN  + error
+
+		loginFailureFunc=self.loginFailureFuncDict.get(error, self.SetPasswordEditLineFocus)
+		if app.loggined:
+			self.PopupNotifyMessage(loginFailureMsg, self.__ExitGame)
+		else:
+			self.PopupNotifyMessage(loginFailureMsg, loginFailureFunc)
+
+		snd.PlaySound("sound/ui/loginfail.wav")
+
+	def __DisconnectAndInputID(self):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		self.SetIDEditLineFocus()
+		net.Disconnect()
+
+	def __DisconnectAndInputPassword(self):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		self.SetPasswordEditLineFocus()
+		net.Disconnect()
+
+	def __LoadScript(self, fileName):
+		try:
+			pyScrLoader = ui.PythonScriptLoader()
+			pyScrLoader.LoadScriptFile(self, fileName)
+		except:
+			import exception
+			exception.Abort("LoginWindow.__LoadScript.LoadObject")
+
+		try:
+			GetObject=self.GetChild
+			self.serverList				= GetObject("ServerList")
+			self.loginBoard				= GetObject("LoginBoard")
+			self.idEditLine				= GetObject("ID_EditLine")
+			self.pwdEditLine			= GetObject("Password_EditLine")
+			# self.pinEditLine			= GetObject("Pin_EditLine")
+			self.loginButton			= GetObject("LoginButton")
+			self.loginExitButton		= GetObject("LoginExitButton")
+
+			self.ChannelButton1			= GetObject("ChannelButton1")
+			self.ChannelButton2			= GetObject("ChannelButton2")
+			self.ChannelButton3			= GetObject("ChannelButton3")
+			self.ChannelButton4			= GetObject("ChannelButton4")
+			self.ChannelButton5			= GetObject("ChannelButton5")
+			self.ChannelButton6			= GetObject("ChannelButton6")
+
+			self.ChannelButtonTooltip1	= GetObject("ChannelButtonTooltip1")
+			self.ChannelButtonTooltip2	= GetObject("ChannelButtonTooltip2")
+			self.ChannelButtonTooltip3	= GetObject("ChannelButtonTooltip3")
+			self.ChannelButtonTooltip4	= GetObject("ChannelButtonTooltip4")
+			self.ChannelButtonTooltip5	= GetObject("ChannelButtonTooltip5")
+			self.ChannelButtonTooltip6	= GetObject("ChannelButtonTooltip6")
+
+			self.sitebutton			= GetObject("site")
+			self.discordbutton			= GetObject("discord")
+			self.registerbutton			= GetObject("register")
+
+			self.registerButton1		= GetObject("registerButton1")
+			self.registerButton2		= GetObject("registerButton2")
+			self.registerButton3		= GetObject("registerButton3")
+			self.registerButton4		= GetObject("registerButton4")
+			self.registerButton5		= GetObject("registerButton5")
+			self.registerButton6		= GetObject("registerButton6")
+			self.registerButtons		= { 1 : self.registerButton1, 2 : self.registerButton2, 3 : self.registerButton3, 4 : self.registerButton4 , 5 : self.registerButton5 , 6 : self.registerButton6 }
+
+			self.deleteButton1			= GetObject("deleteButton1")
+			self.deleteButton2			= GetObject("deleteButton2")
+			self.deleteButton3			= GetObject("deleteButton3")
+			self.deleteButton4			= GetObject("deleteButton4")
+			self.deleteButton5			= GetObject("deleteButton5")
+			self.deleteButton6			= GetObject("deleteButton6")
+			self.serverList.Hide()
+		except:
+			import exception
+			exception.Abort("LoginWindow.__LoadScript.BindObject")
+
+		self.loginButton.SetEvent(ui.__mem_func__(self.__OnClickLoginButton))
+		self.loginExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitButton))
+		self.serverList.SetEvent(ui.__mem_func__(self.__OnSelectServer))
+
+		self.idEditLine.SetReturnEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
+		self.idEditLine.SetTabEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
+		# self.idEditLine.SetPlaceHolder(" Username")
+
+		# self.pwdEditLine.SetReturnEvent(ui.__mem_func__(self.pinEditLine.SetFocus))
+		# self.pwdEditLine.SetTabEvent(ui.__mem_func__(self.pinEditLine.SetFocus))
+		# self.pwdEditLine.SetPlaceHolder(" Password")
+
+		# self.pinEditLine.SetReturnEvent(ui.__mem_func__(self.__OnClickLoginButton))
+		# self.pinEditLine.SetTabEvent(ui.__mem_func__(self.idEditLine.SetFocus))
+		# self.pinEditLine.SetPlaceHolder(" Pin", (0, -2))
+
+		self.ChannelButton1.SetEvent(ui.__mem_func__(self.__SelectChannel), 1)
+		self.ChannelButton2.SetEvent(ui.__mem_func__(self.__SelectChannel), 2)
+		self.ChannelButton3.SetEvent(ui.__mem_func__(self.__SelectChannel), 3)
+		self.ChannelButton4.SetEvent(ui.__mem_func__(self.__SelectChannel), 4)
+		self.ChannelButton5.SetEvent(ui.__mem_func__(self.__SelectChannel), 5)
+		self.ChannelButton6.SetEvent(ui.__mem_func__(self.__SelectChannel), 6)
+
+
+		self.sitebutton.SetEvent(ui.__mem_func__(self.__OnClickSite))
+		self.discordbutton.SetEvent(ui.__mem_func__(self.__OnClickDiscord))
+		self.registerbutton.SetEvent(ui.__mem_func__(self.__OnClickRegister))
+
+		self.registerButton1.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 1)
+		self.registerButton2.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 2)
+		self.registerButton3.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 3)
+		self.registerButton4.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 4)
+		self.registerButton5.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 5)
+		self.registerButton6.SetEvent(ui.__mem_func__(self.OnClickRegisterButton), 6)
+
+		self.deleteButton1.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 1)
+		self.deleteButton2.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 2)
+		self.deleteButton3.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 3)
+		self.deleteButton4.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 4)
+		self.deleteButton5.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 5)
+		self.deleteButton6.SetEvent(ui.__mem_func__(self.__OnClickdeleteButton), 6)
+
+
+		return 1
+
+		localeInfo.UI_DEF_FONT = uiDefFontBackup
+
+	def Connect(self, id, pwd):
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(localeInfo.LOGIN_CONNETING, self.OnProcessingCancel, localeInfo.UI_CANCEL)
+		self.stream.SetLoginInfo(id, pwd)
+		self.stream.Connect()
+
+	def OnProcessingCancel(self):
+		self.isLoginCanceled = True
+		self.stream.popupWindow.Close()
+
+
+	def __OnClickExitButton(self):
+		self.stream.SetPhaseWindow(0)
+
+	def __SetServerInfo(self, name):
+		net.SetServerInfo(name.strip())
+		self.serverInfo.SetText(name)
+
+	def __LoadLoginInfo(self, loginInfoFileName):
+		def getValue(element, name, default):
+			if [] != element.getElementsByTagName(name):
+				return element.getElementsByTagName(name).item(0).firstChild.nodeValue
+			else:
+				return default
+
+		self.id = None
+		self.pwd = None
+		# self.pin = None
+		self.loginnedServer = None
+		self.loginnedChannel = None
+		app.loggined = False
+
+		self.loginInfo = True
+		try:
+			server_name = logininfo.getAttribute("name")
+			channel_idx = int(logininfo.getAttribute("channel_idx"))
+		except:
+			return
+
+		try:
+			matched = False
+
+			for k, v in serverInfo.REGION_DICT[0].iteritems():
+				if v["name"] == server_name:
+					account_addr = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["ip"]
+					account_port = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["port"]
+
+					channel_info = v["channel"][channel_idx]
+					channel_name = channel_info["name"]
+					addr = channel_info["ip"]
+					port = channel_info["tcp_port"]
+
+					net.SetMarkServer(addr, port)
+					self.stream.SetConnectInfo(addr, port, account_addr, account_port)
+
+					matched = True
+					break
+
+			if False == matched:
+				return
+		except:
+			return
+
+		self.__SetServerInfo("%s, %s " % (server_name, channel_name))
+		id = getValue(logininfo, "id", "")
+		pwd = getValue(logininfo, "pwd", "")
+		# pin = getValue(logininfo, "pin", "")
+		self.idEditLine.SetText(id)
+		self.pwdEditLine.SetText(pwd)
+		# self.pinEditLine.SetText(pin)
+		slot = getValue(logininfo, "slot", "0")
+		locale = getValue(logininfo, "locale", "")
+		locale_dir = getValue(logininfo, "locale_dir", "")
+		is_auto_login = int(getValue(logininfo, "auto_login", "0"))
+
+		self.stream.SetCharacterSlot(int(slot))
+		self.stream.isAutoLogin=is_auto_login
+		self.stream.isAutoSelect=is_auto_login
+
+		if locale and locale_dir:
+			app.ForceSetLocale(locale, locale_dir)
+
+
+		return
+
+
+	def PopupDisplayMessage(self, msg):
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(msg)
+
+	def PopupNotifyMessage(self, msg, func=0):
+		if not func:
+			func=self.EmptyFunc
+
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(msg, func, localeInfo.UI_OK)
+
+
+	def OnPressExitKey(self):
+		self.stream.popupWindow.Close()
+		self.stream.SetPhaseWindow(0)
+		return True
+
+	def OnExit(self):
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(app.Exit, localeInfo.UI_OK)
+
+	def OnUpdate(self):
+		ServerStateChecker.Update()
+		for i in range(1,7):
+			path = 'UserData/Account/' + str(i) + '.cfg'
+			if os.path.exists(path):
+				try:
+					accountfile = open(path, "r")
+					raw = accountfile.read()
+					accountfile.close()
+					informations = raw.split("|")
+					# expected formats:
+					#   new: |id|
+					#   old: |id|pwd|
+					saved_id = informations[1] if len(informations) > 1 else ""
+					saved_pwd = informations[2] if len(informations) > 2 else ""
+
+					# sanitize legacy plaintext passwords on disk immediately
+					if saved_pwd:
+						try:
+							open(path, "w").write("|" + str(saved_id) + "|")
+						except:
+							pass
+
+					if saved_id:
+						self.registerButtons[i].SetText(saved_id)
+					else:
+						self.registerButtons[i].SetText(uiScriptLocale.FREE)
+				except:
+					self.registerButtons[i].SetText(uiScriptLocale.FREE)
+			else:
+				self.registerButtons[i].SetText(uiScriptLocale.FREE)
+
+
+	def EmptyFunc(self):
+		pass
+
+
+	def __GetRegionID(self):
+		return 0
+
+	def __GetServerID(self):
+		return self.serverList.GetSelectedItem()
+
+
+	def __ServerIDToServerIndex(self, regionID, targetServerID):
+		try:
+			regionDict = serverInfo.REGION_DICT[regionID]
+		except KeyError:
+			return -1
+
+		retServerIndex = 0
+		for eachServerID, regionDataDict in regionDict.items():
+			if eachServerID == targetServerID:
+				return retServerIndex
+
+			retServerIndex += 1
+		return -1
+
+	def __ChannelIDToChannelIndex(self, channelID):
+		return channelID - 1
+
+	def __OpenServerBoard(self):
+		loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
+		serverIndex = self.__ServerIDToServerIndex(loadRegionID, loadServerID)
+		channelIndex = self.__ChannelIDToChannelIndex(loadChannelID)
+		self.serverList.SelectItem(serverIndex)
+
+		self.loginBoard.Hide()
+
+	def __SelectChannel(self, channel):
+		self.ChannelButtons = { 1 : [self.ChannelButton1, serverInfo.SRV1["ch1"]], 2 : [self.ChannelButton2, serverInfo.SRV1["ch2"]], 3 : [self.ChannelButton3, serverInfo.SRV1["ch3"]], 4 : [self.ChannelButton4, serverInfo.SRV1["ch4"]], 5 : [self.ChannelButton5, serverInfo.SRV1["auth1"]], 6 : [self.ChannelButton6, serverInfo.SRV1["ch6"]] }
+		self.ChannelButton1.SetUp()
+		self.ChannelButton2.SetUp()
+		self.ChannelButton3.SetUp()
+		self.ChannelButton4.SetUp()
+		self.ChannelButton5.SetUp()
+		self.ChannelButton6.SetUp()
+		if channel == 1:
+			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH1")
+		elif channel == 2:
+			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH2")
+		elif channel == 3:
+			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH3")
+		elif channel == 4:
+			net.SetServerInfo(serverInfo.SERVER_1+" - "+"CH4")
+		self.ChannelButtons[channel][0].Down()
+		self.stream.SetConnectInfo(serverInfo.SRV1["host"], self.ChannelButtons[channel][1], serverInfo.SRV1["host"], serverInfo.SRV1["auth1"])
+		net.SetMarkServer(serverInfo.SRV1["host"], serverInfo.SRV1["ch1"])
+		app.SetGuildMarkPath("10.tga")
+		app.SetGuildSymbolPath("10")
+
+	def __SaveChannelInfo(self):
+		try:
+			file=open("channel.inf", "w")
+			file.write("%d %d %d" % (self.__GetServerID(), self.__GetChannelID(), self.__GetRegionID()))
+		except:
+			print "LoginWindow.__SaveChannelInfo - SaveError"
+
+	def __LoadChannelInfo(self):
+		try:
+			file=open("channel.inf")
+			lines=file.readlines()
+
+			if len(lines)>0:
+				tokens=lines[0].split()
+				selServerID=int(tokens[0])
+				selChannelID=int(tokens[1])
+
+				if len(tokens) == 3:
+					regionID = int(tokens[2])
+
+				return regionID, selServerID, selChannelID
+		except:
+			print "LoginWindow.__LoadChannelInfo - OpenError"
+			return -1, -1, -1
+	def __OpenLoginBoard(self):
+
+		loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
+		serverIndex = self.__ServerIDToServerIndex(loadRegionID, loadServerID)
+		channelIndex = self.__ChannelIDToChannelIndex(loadChannelID)
+		self.__SelectChannel(1)
+		self.serverList.SelectItem(serverIndex)
+
+		if app.loggined:
+			self.Connect(self.id, self.pwd)
+			self.loginBoard.Hide()
+		elif not self.stream.isAutoLogin:
+			self.loginBoard.Show()
+
+		if self.idEditLine == None:
+			self.idEditLine.SetText("")
+
+		if self.pwdEditLine == None:
+			self.pwdEditLine.SetText("")
+
+		# if self.pinEditLine == None:
+			# self.pinEditLine.SetText("")
+
+		self.idEditLine.SetFocus()
+
+	def __OnSelectRegionGroup(self):
+		self.__RefreshServerList()
+
+	def __OnSelectSettlementArea(self):
+		regionID = self.__GetRegionID()
+		serverID = self.serverListOnRegionBoard.GetSelectedItem()
+		serverIndex = self.__ServerIDToServerIndex(regionID, serverID)
+		self.serverList.SelectItem(serverIndex)
+		self.__OnSelectServer()
+
+	def __RefreshServerList(self):
+		regionID = self.__GetRegionID()
+		if not serverInfo.REGION_DICT.has_key(regionID):
+			return
+
+		self.serverList.ClearItem()
+
+		regionDict = serverInfo.REGION_DICT[regionID]
+		visible_index = 1
+		for id, regionDataDict in regionDict.items():
+			name = regionDataDict.get("name", "noname")
+			server_id = visible_index
+
+			self.serverList.InsertItem(id, "  %02d. %s" % (int(server_id), name))
+			visible_index += 1
+
+	def __OnSelectServer(self):
+		self.__RequestServerStateList()
+		self.__RefreshServerStateList()
+
+	def __RequestServerStateList(self):
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+
+		try:
+			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
+		except:
+			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
+			return
+
+		ServerStateChecker.Initialize();
+		for id, channelDataDict in channelDict.items():
+			key=channelDataDict["key"]
+			ip=channelDataDict["ip"]
+			udp_port=channelDataDict["udp_port"]
+			ServerStateChecker.AddChannel(key, ip, udp_port)
+
+		ServerStateChecker.Request()
+
+	def __RefreshServerStateList(self):
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+		try:
+			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
+		except:
+			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
+			return
+
+		for channelID, channelDataDict in channelDict.items():#06.01.2020
+			channelState = channelDataDict["state"]
+			self.ChannelTooltips = { 1 : self.ChannelButtonTooltip1, 2 : self.ChannelButtonTooltip2, 3 : self.ChannelButtonTooltip3, 4 : self.ChannelButtonTooltip4, 5 : self.ChannelButtonTooltip5, 6 : self.ChannelButtonTooltip6 }
+			if channelState == "NORM":
+				self.ChannelTooltips[channelID].SetText("|cff32cd32%s" % channelState)
+			elif channelState == "BUSY":
+				self.ChannelTooltips[channelID].SetText("|cffdaa520%s" % channelState)
+			elif channelState == "FULL":
+				self.ChannelTooltips[channelID].SetText("|cffff0000%s" % channelState)
+			else:
+				self.ChannelTooltips[channelID].SetText("|cffff0000%s" % channelState)
+
+	def __GetChannelName(self, regionID, selServerID, selChannelID):
+		try:
+			return serverInfo.REGION_DICT[regionID][selServerID]["channel"][selChannelID]["name"]
+		except KeyError:
+			if 9==selChannelID:
+				return localeInfo.CHANNEL_PVP
+			else:
+				return localeInfo.CHANNEL_NORMAL % (selChannelID)
+
+	def NotifyChannelState(self, addrKey, state):
+		try:
+			stateName=serverInfo.STATE_DICT[state]
+		except:
+			stateName=serverInfo.STATE_NONE
+
+		regionID=int(addrKey/1000)
+		serverID=int(addrKey/10) % 100
+		channelID=addrKey%10
+
+		try:
+			serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["state"] = stateName
+			self.__RefreshServerStateList()
+		except:
+			import exception
+			exception.Abort(localeInfo.CHANNEL_NOT_FIND_INFO)
+
+	def __OnClickExitServerButton(self):
+		print "exit server"
+		self.__OpenLoginBoard()
+
+
+	def __OnClickSelectRegionButton(self):
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+
+		if (not serverInfo.REGION_DICT.has_key(regionID)):
+			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_REGION)
+			return
+
+		if (not serverInfo.REGION_DICT[regionID].has_key(serverID)):
+			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_SERVER)
+			return
+
+		self.__SaveChannelInfo()
+		self.__RefreshServerList()
+		self.__OpenLoginBoard()
+
+	def OnClickRegisterButton(self, alper):#21.02.2019
+		global RegisteredID
+		# global RegisteredPin
+		al = self.registerButtons[alper].GetText()
+		if al.find(uiScriptLocale.FREE) != -1:
+			id = self.idEditLine.GetText()
+			# Never store passwords on disk
+			# pin = self.pinEditLine.GetText()
+			if id == "":
+				self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_ID, self.SetIDEditLineFocus)
+			else:
+				if not os.path.exists('UserData/Account/' + str(alper) + '.cfg'):#todo security reg
+					# Store ID only (no password)
+					open('UserData/Account/' + str(alper) + '.cfg', "w").write("|"+str(id)+"|")
+
+					self.registerButtons[alper].SetText(str(id))
+
+					self.PopupNotifyMessage(localeInfo.ACCOUNT_HAS_REGISTERED)
+				else:
+					pass
+		else:
+			path = 'UserData/Account/' + str(alper) + '.cfg'
+			try:
+				accountfile = open(path, "r")
+				raw = accountfile.read()
+				accountfile.close()
+				informations = raw.split("|")
+				saved_id = informations[1] if len(informations) > 1 else ""
+				saved_pwd = informations[2] if len(informations) > 2 else ""
+
+				# sanitize legacy format if password exists
+				if saved_pwd:
+					try:
+						open(path, "w").write("|"+str(saved_id)+"|")
+					except:
+						pass
+
+				if saved_id:
+					self.idEditLine.SetText(saved_id)
+					self.pwdEditLine.SetText("")
+					self.pwdEditLine.SetFocus()
+					RegisteredID = saved_id
+				else:
+					self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_ID, self.SetIDEditLineFocus)
+			except:
+				self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.SetIDEditLineFocus)
+			# RegisteredPin = informations[3]
+
+	def __OnClickdeleteButton(self, alper):
+		al = self.registerButtons[alper].GetText()
+
+		if al.find(uiScriptLocale.FREE) != -1:
+			self.PopupNotifyMessage(localeInfo.NO_DELETE_ACCOUNT)
+			return
+		else:
+			os.remove('UserData/Account/' + str(alper)+ '.cfg')
+			self.registerButtons[alper].SetText(uiScriptLocale.FREE)
+			self.PopupNotifyMessage(localeInfo.ACCOUNT_HAS_DELETED)
+
+	def __OnClickSite(self):
+		os.startfile("https://farques.com.tr")
+
+	def __OnClickDiscord(self):
+		os.startfile("https://discord.com/invite/v36Ru9zpJ3")
+	def __OnClickRegister(self):
+		os.startfile("https://farques.com.tr")
+
+	def OnKeyDown(self, key):
+		if 1 == key: #ESC
+			self.OnPressExitKey()
+		elif 59 == key: #F1
+			self.OnClickRegisterButton(1)
+		elif 60 == key: #F2
+			self.OnClickRegisterButton(2)
+		elif 61 == key: #F3
+			self.OnClickRegisterButton(3)
+		elif 62 == key: #F4
+			self.OnClickRegisterButton(4)
+		elif 64 == key: #F5
+			self.OnClickRegisterButton(5)
+		elif 65 == key: #F6
+			self.OnClickRegisterButton(6)
+		else:
+			return True
+		return True
+
+	def __OnClickLoginButton(self):
+		id = self.idEditLine.GetText()
+		pwd = self.pwdEditLine.GetText()
+		# pin = self.pinEditLine.GetText()
+
+		if len(id) == 0:
+			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_ID, self.SetIDEditLineFocus)
+			return
+
+		if len(pwd) == 0:
+			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_PASSWORD, self.SetPasswordEditLineFocus)
+			return
+
+		# if len(pin) == 0:
+			# self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_PIN, self.SetPinEditLineFocus)
+			# return
+
+		self.Connect(id, pwd)
diff --git a/client/pack/root/intrologin1.py b/client/pack/root/intrologin1.py
index c73d108..ff70fb0 100644
--- a/client/pack/root/intrologin1.py
+++ b/client/pack/root/intrologin1.py
@@ -1,1630 +1,1623 @@
-import dbg
-import app
-import net
-import ui
-import ime
-import snd
-import wndMgr
-import musicInfo
-import serverInfo
-import systemSetting
-import ServerStateChecker
-import localeInfo
-import constInfo
-import osfInfo
-import uiCommon
-import time
-import serverCommandParser
-import ime
-import uiScriptLocale
-import debugInfo
-
-LOGIN_DELAY_SEC = 0.0
-SKIP_LOGIN_PHASE = False
-SKIP_LOGIN_PHASE_SUPPORT_CHANNEL = False
-FULL_BACK_IMAGE = False
-
-VIRTUAL_KEYBOARD_NUM_KEYS = 46
-VIRTUAL_KEYBOARD_RAND_KEY = True
-
-def Suffle(src):
-	if VIRTUAL_KEYBOARD_RAND_KEY:
-		items = [item for item in src]
-
-		itemCount = len(items)
-		for oldPos in xrange(itemCount):
-			newPos = app.GetRandom(0, itemCount - 1)
-			items[newPos], items[oldPos] = items[oldPos], items[newPos]
-
-		return "".join(items)
-	else:
-		return src
-
-if localeInfo.IsNEWCIBN() or localeInfo.IsCIBN10():
-	LOGIN_DELAY_SEC = 60.0
-	FULL_BACK_IMAGE = True
-
-elif localeInfo.IsYMIR() or localeInfo.IsCHEONMA():
-	FULL_BACK_IMAGE = True
-
-elif localeInfo.IsHONGKONG():
-	FULL_BACK_IMAGE = True
-
-elif localeInfo.IsJAPAN():
-	FULL_BACK_IMAGE = True
-
-elif localeInfo.IsBRAZIL() or osfInfo.LOGIN_UI_MODIFY:
-	if app.LOGIN_COUNT_DOWN_UI_MODIFY:
-		LOGIN_DELAY_SEC = 30.0
-	else:
-		LOGIN_DELAY_SEC = 60.0
-
-def IsFullBackImage():
-	global FULL_BACK_IMAGE
-	return FULL_BACK_IMAGE
-
-def IsLoginDelay():
-	global LOGIN_DELAY_SEC
-	if LOGIN_DELAY_SEC > 0.0:
-		return True
-	else:
-		return False
-
-def GetLoginDelay():
-	global LOGIN_DELAY_SEC
-	return LOGIN_DELAY_SEC
-
-app.SetGuildMarkPath("test")
-
-class ConnectingDialog(ui.ScriptWindow):
-	def __init__(self):
-		ui.ScriptWindow.__init__(self)
-		self.__LoadDialog()
-		self.eventTimeOver = lambda *arg: None
-		self.eventExit = lambda *arg: None
-
-	def __del__(self):
-		ui.ScriptWindow.__del__(self)
-
-	def __LoadDialog(self):
-		try:
-			PythonScriptLoader = ui.PythonScriptLoader()
-			PythonScriptLoader.LoadScriptFile(self, "UIScript/ConnectingDialog.py")
-
-			self.board = self.GetChild("board")
-			self.message = self.GetChild("message")
-			self.countdownMessage = self.GetChild("countdown_message")
-
-		except:
-			import exception
-			exception.Abort("ConnectingDialog.LoadDialog.BindObject")
-
-	def Open(self, waitTime):
-		curTime = time.clock()
-		self.endTime = curTime + waitTime
-
-		self.Lock()
-		self.SetCenterPosition()
-		self.SetTop()
-		self.Show()
-
-	def Close(self):
-		self.Unlock()
-		self.Hide()
-
-	def Destroy(self):
-		self.Hide()
-		self.ClearDictionary()
-
-	def SetText(self, text):
-		self.message.SetText(text)
-
-	def SetCountDownMessage(self, waitTime):
-		self.countdownMessage.SetText("%.0f%s" % (waitTime, localeInfo.SECOND))
-
-	def SAFE_SetTimeOverEvent(self, event):
-		self.eventTimeOver = ui.__mem_func__(event)
-
-	def SAFE_SetExitEvent(self, event):
-		self.eventExit = ui.__mem_func__(event)
-
-	def OnUpdate(self):
-		lastTime = max(0, self.endTime - time.clock())
-		if 0 == lastTime:
-			self.Close()
-			self.eventTimeOver()
-		else:
-			self.SetCountDownMessage(self.endTime - time.clock())
-
-	def OnPressExitKey(self):
-		# self.eventExit()
-		return True
-
-if app.ENABLE_SERVER_SELECT_RENEWAL:
-	import uiToolTip
-	class ServerListBox(ui.ListBox2):
-		STATE_IMAGE_PATH = (
-			"",
-			"locale/common" + "/ui/login/choise_new.tga",
-			"locale/common" + "/ui/login/choise_special.tga",
-			"locale/common" + "/ui/login/choise_close.tga",
-			"locale/common" + "/ui/login/choise_close.tga",
-		)
-
-		SERVER_FLAG_IMAGE_PATH_DICT = {
-			"AE" : "d:/ymir work/ui/intro/login/server_flag_AE.sub",
-			"ALL" : "d:/ymir work/ui/intro/login/server_flag_ALL.sub",
-			"BR" : "d:/ymir work/ui/intro/login/server_flag_BR.sub",
-			"CZ" : "d:/ymir work/ui/intro/login/server_flag_CZ.sub",
-			"DE" : "d:/ymir work/ui/intro/login/server_flag_DE.sub",
-			"DK" : "d:/ymir work/ui/intro/login/server_flag_DK.sub",
-			"ES" : "d:/ymir work/ui/intro/login/server_flag_ES.sub",
-			"EU" : "d:/ymir work/ui/intro/login/server_flag_EU.sub",
-			"FR" : "d:/ymir work/ui/intro/login/server_flag_FR.sub",
-			"GR" : "d:/ymir work/ui/intro/login/server_flag_GR.sub",
-			"HU" : "d:/ymir work/ui/intro/login/server_flag_HU.sub",
-			"IT" : "d:/ymir work/ui/intro/login/server_flag_IT.sub",
-			"KR" : "d:/ymir work/ui/intro/login/server_flag_KR.sub",
-			"NL" : "d:/ymir work/ui/intro/login/server_flag_NL.sub",
-			"PL" : "d:/ymir work/ui/intro/login/server_flag_PL.sub",
-			"PT" : "d:/ymir work/ui/intro/login/server_flag_PT.sub",
-			"RO" : "d:/ymir work/ui/intro/login/server_flag_RO.sub",
-			"RU" : "d:/ymir work/ui/intro/login/server_flag_RU.sub",
-			"SP1" : "d:/ymir work/ui/intro/login/server_flag_SP1.sub",
-			"SP2" : "d:/ymir work/ui/intro/login/server_flag_SP2.sub",
-			"SP3" : "d:/ymir work/ui/intro/login/server_flag_SP3.sub",
-			"SP4" : "d:/ymir work/ui/intro/login/server_flag_SP4.sub",
-			"SP5" : "d:/ymir work/ui/intro/login/server_flag_SP5.sub",
-			"SP6" : "d:/ymir work/ui/intro/login/server_flag_SP6.sub",
-			"SP7" : "d:/ymir work/ui/intro/login/server_flag_SP7.sub",
-			"TR" : "d:/ymir work/ui/intro/login/server_flag_TR.sub",
-			"UK" : "d:/ymir work/ui/intro/login/server_flag_UK.sub"
-		}
-
-		def __init__(self, layer = "UI"):
-			ui.ListBox2.__init__(self, layer)
-			self.stateList = []
-			self.stateList2 = []
-			self.flagList = []
-			self.stateDict = {}
-			self.stateDict2 = {}
-			self.flagDict = {}
-			self.toolTip = uiToolTip.ToolTip()
-
-			self.STATE_IMAGE_TOOLTIP = (
-				"",
-				localeInfo.SERVER_STATUS_NEW,
-				localeInfo.SERVER_STATUS_SPECIAL,
-				localeInfo.SERVER_STATUS_CLOSE,
-				localeInfo.SERVER_STATUS_STANDBY,
-			)
-
-		def ClearItem(self):
-			ui.ListBox2.ClearItem(self)
-			self.stateList = []
-			self.stateList2 = []
-			self.flagList = []
-			self.stateDict = {}
-			self.stateDict2 = {}
-			self.flagDict = {}
-
-		def StateImageEventProgress(self, event_type, arg):
-			if "mouse_click" == event_type:
-				self.SelectItem(arg)
-			elif "mouse_over_in" == event_type:
-				arglen = len(self.STATE_IMAGE_TOOLTIP[arg])
-				pos_x, pos_y = wndMgr.GetMousePosition()
-
-				self.toolTip.ClearToolTip()
-				self.toolTip.SetThinBoardSize(11 * arglen)
-				self.toolTip.SetToolTipPosition(pos_x + 50, pos_y + 50)
-				self.toolTip.AppendTextLine(self.STATE_IMAGE_TOOLTIP[arg], 0xffffffff)
-				self.toolTip.Show()
-			elif "mouse_over_out" == event_type:
-				self.toolTip.Hide()
-
-		def FlagImageEventProgress(self, event_type, arg):
-			if "mouse_click" == event_type:
-				self.SelectItem(arg)
-
-		def GetState(self, line):
-			if line >= len(self.itemList) or line < 0:
-				return (0, 0)
-
-			if line >= len(self.stateList) or line >= len(self.stateList2):
-				return (0, 0)
-
-			return self.stateList[line], self.stateList2[line]
-
-		def _LocateItem(self):
-			pos = (0, self.TEMPORARY_PLACE)
-
-			self.showLineCount = 0
-			for textLine in self.itemList:
-				x, y = self._CalcRenderPos(pos, self.showLineCount)
-				if self.flagDict.get(self.showLineCount) != None:
-					flagWidth = self.flagDict[self.showLineCount].GetWidth()
-
-					self.flagDict[self.showLineCount].SetPosition(0, y - 3)
-					if localeInfo.IsARABIC():
-						self.flagDict[self.showLineCount].SetPosition(flagWidth, y - 3)
-						self.flagDict[self.showLineCount].SetWindowHorizontalAlignRight()
-
-					if localeInfo.IsARABIC():
-						textLine.SetPosition(x + flagWidth + 5, y)
-					else:
-						textLine.SetPosition(x + flagWidth, y)
-				else:
-					textLine.SetPosition(x, y)
-				textLine.Show()
-
-				if self.stateDict.get(self.showLineCount) != None:
-					w = app.GetTextWidth(textLine.GetText())
-
-					if self.flagDict.get(self.showLineCount) != None:
-						flagWidth = self.flagDict[self.showLineCount].GetWidth()
-					else:
-						flagWidth = 0
-
-					if localeInfo.IsARABIC():
-						self.stateDict[self.showLineCount].SetPosition(self.GetWidth() - w - flagWidth - 15, y - 3)
-					else:
-						self.stateDict[self.showLineCount].SetPosition(x + w + flagWidth + 5, y - 3)
-
-					imageWidth = self.stateDict[self.showLineCount].GetWidth()
-
-					if self.stateDict2.get(self.showLineCount) != None:
-						if localeInfo.IsARABIC():
-							self.stateDict2[self.showLineCount].SetPosition(self.GetWidth() - w - flagWidth - 15 - imageWidth, y - 3)
-							#self.stateDict2[self.showLineCount].SetPosition(x, y)
-						else:
-							self.stateDict2[self.showLineCount].SetPosition(x + w + flagWidth + 5 + imageWidth, y - 3)
-
-				self.showLineCount += 1
-
-		def InsertItem(self, number, text, state = 0, state2 = 0, flag = "ALL"):
-			self.keyDict[len(self.itemList)] = number
-			self.textDict[len(self.itemList)] = text
-			textLine = ui.TextLine()
-			textLine.SetParent(self)
-			textLine.SetText(text)
-			textLine.Show()
-
-			if self.itemCenterAlign:
-				textLine.SetWindowHorizontalAlignCenter()
-				textLine.SetHorizontalAlignCenter()
-			elif localeInfo.IsARABIC():
-				textLine.SetWindowHorizontalAlignRight()
-				textLine.SetHorizontalAlignLeft()
-
-			if state != 0:
-				imgBox = ui.ExpandedImageBox()
-				imgBox.SetParent(self)
-				imgBox.LoadImage(self.STATE_IMAGE_PATH[state])
-				imgBox.Show()
-
-				imgBox.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_click", len(self.itemList))
-				imgBox.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_in", state)
-				imgBox.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_out", 0)
-
-				self.stateDict[len(self.itemList)] = imgBox
-
-			if state2 != 0:
-				imgBox2 = ui.ExpandedImageBox()
-				imgBox2.SetParent(self)
-				imgBox2.LoadImage(self.STATE_IMAGE_PATH[state2])
-				imgBox2.Show()
-
-				imgBox2.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_click", len(self.itemList))
-				imgBox2.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_in", state2)
-				imgBox2.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_out", 0)
-
-				self.stateDict2[len(self.itemList)] = imgBox2
-
-			if flag.upper() in self.SERVER_FLAG_IMAGE_PATH_DICT.keys():
-				imgBox3 = ui.ExpandedImageBox()
-				imgBox3.SetParent(self)
-				imgBox3.LoadImage(self.SERVER_FLAG_IMAGE_PATH_DICT[flag.upper()])
-				imgBox3.Show()
-
-				imgBox3.SetEvent(ui.__mem_func__(self.FlagImageEventProgress), "mouse_click", len(self.itemList))
-				imgBox3.SetEvent(ui.__mem_func__(self.FlagImageEventProgress), "mouse_over_in", flag)
-				imgBox3.SetEvent(ui.__mem_func__(self.FlagImageEventProgress), "mouse_over_out", 0)
-
-				self.flagDict[len(self.itemList)] = imgBox3
-
-			self.itemList.append(textLine)
-			self.stateList.append(state)
-			self.stateList2.append(state2)
-			self.flagList.append(flag)
-
-			self._LocateItem()
-			self._RefreshForm()
-
-	class ChannelListBox(ui.ListBox):
-		TEMPORARY_PLACE = 3
-
-		def __init__(self, layer = "UI"):
-			ui.ListBox.__init__(self, layer)
-			self.stateList = []
-
-		def ClearItem(self):
-			ui.ListBox.ClearItem(self)
-			self.stateList = []
-
-		def InsertItem(self, number, text, text2, textColor = 0x00000000):
-			self.keyDict[len(self.itemList)] = number
-			self.textDict[len(self.itemList)] = text
-
-			textLine = ui.TextLine()
-			textLine.SetParent(self)
-			textLine.SetText(text)
-			textLine.Show()
-
-			if self.itemCenterAlign:
-				textLine.SetWindowHorizontalAlignCenter()
-				textLine.SetHorizontalAlignCenter()
-			elif localeInfo.IsARABIC():
-				textLine.SetWindowHorizontalAlignRight()
-				textLine.SetHorizontalAlignRight()
-
-			self.itemList.append(textLine)
-
-			statetextLine = ui.TextLine()
-			statetextLine.SetParent(textLine)
-			statetextLine.SetText(text2)
-			if textColor != 0x00000000:
-				statetextLine.SetPackedFontColor(textColor)
-			statetextLine.Show()
-
-			if self.itemCenterAlign:
-				statetextLine.SetWindowHorizontalAlignCenter()
-				statetextLine.SetHorizontalAlignCenter()
-
-			w, h = textLine.GetTextSize()
-			if localeInfo.IsARABIC():
-				statetextLine.SetPosition(10, 0)
-			else:
-				statetextLine.SetPosition(w, 0)
-
-			statetextLine.AddFlag("not_pick")
-
-			self.stateList.append(statetextLine)
-
-			self._LocateItem()
-
-class LoginWindow(ui.ScriptWindow):
-	IS_TEST = net.IsTest()
-
-	def __init__(self, stream):
-		# print "NEW LOGIN WINDOW -----------------------------------------------------------------------------"
-		ui.ScriptWindow.__init__(self)
-		net.SetPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
-		net.SetAccountConnectorHandler(self)
-
-		self.lastLoginTime = 0
-		self.inputDialog = None
-		self.connectingDialog = None
-		self.stream = stream
-		self.isNowCountDown = False
-		self.isStartError = False
-
-		self.xServerBoard = 0
-		self.yServerBoard = 0
-
-		self.loadingImage = None
-
-		self.virtualKeyboard = None
-		self.virtualKeyboardMode = "ALPHABET"
-		self.virtualKeyboardIsUpper = False
-
-		self.timeOutMsg = False;
-
-	def __del__(self):
-		net.ClearPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
-		net.SetAccountConnectorHandler(0)
-		ui.ScriptWindow.__del__(self)
-		# print "---------------------------------------------------------------------------- DELETE LOGIN WINDOW"
-
-	def Open(self):
-		ServerStateChecker.Create(self)
-
-		# print "LOGIN WINDOW OPEN ----------------------------------------------------------------------------"
-
-		self.loginFailureMsgDict = {
-			#"DEFAULT" : localeInfo.LOGIN_FAILURE_UNKNOWN,
-
-			"ALREADY" : localeInfo.LOGIN_FAILURE_ALREAY,
-			"NOID" : localeInfo.LOGIN_FAILURE_NOT_EXIST_ID,
-			"WRONGPWD" : localeInfo.LOGIN_FAILURE_WRONG_PASSWORD,
-			"FULL" : localeInfo.LOGIN_FAILURE_TOO_MANY_USER,
-			"SHUTDOWN" : localeInfo.LOGIN_FAILURE_SHUTDOWN,
-			"REPAIR" : localeInfo.LOGIN_FAILURE_REPAIR_ID,
-			"BLOCK" : localeInfo.LOGIN_FAILURE_BLOCK_ID,
-			#"WRONGMAT" : localeInfo.LOGIN_FAILURE_WRONG_MATRIX_CARD_NUMBER,
-			"QUIT" : localeInfo.LOGIN_FAILURE_WRONG_MATRIX_CARD_NUMBER_TRIPLE,
-			"BESAMEKEY" : localeInfo.LOGIN_FAILURE_BE_SAME_KEY,
-			"NOTAVAIL" : localeInfo.LOGIN_FAILURE_NOT_AVAIL,
-			"BLKLOGIN" : localeInfo.LOGIN_FAILURE_BLOCK_LOGIN,
-			"WEBBLK" : localeInfo.LOGIN_FAILURE_WEB_BLOCK,
-			#"BADSCLID" : localeInfo.LOGIN_FAILURE_WRONG_SOCIALID,
-			#"AGELIMIT" : localeInfo.LOGIN_FAILURE_SHUTDOWN_TIME,
-			#"LOCKED" : localeInfo.LOGIN_FAILURE_LOCKED,
-			"BACKENDERR" : localeInfo.LOGIN_FAILURE_BACKEND_ERR,
-			"INTEGRTING" : localeInfo.LOGIN_FAILURE_INTEGRTING,
-			"COUNTRYERR" : localeInfo.LOGIN_FAILURE_COUNTRY_ERR,
-			"IOVATION" : localeInfo.LOGIN_FAILURE_IOVATION_ERR,
-			"TNTERR" : localeInfo.LOGIN_FAILURE_TNT_SESSION,
-			"SERVER_CLOSED" : localeInfo.LOGIN_FAILURE_SERVER_CLOSED,
-			"SERVER_GRADE" : localeInfo.LOGIN_FAILURE_SERVER_GRADE,
-		}
-
-		self.loginFailureFuncDict = {
-			"WRONGPWD" : self.__DisconnectAndInputPassword,
-			#"WRONGMAT" : self.__DisconnectAndInputMatrix,
-			"QUIT" : app.Exit,
-		}
-
-		if localeInfo.IsEUROPE():
-			self.loginFailureMsgDict["CONFIRM"] = localeInfo.LOGIN_FAILURE_NOT_MAIL_CONFIRM
-
-		self.SetSize(wndMgr.GetScreenWidth(), wndMgr.GetScreenHeight())
-		self.SetWindowName("LoginWindow")
-
-		if not self.__LoadScript(uiScriptLocale.LOCALE_COMMON_UISCRIPT_PATH + "LoginWindow.py"):
-			dbg.TraceError("LoginWindow.Open - __LoadScript Error")
-			return
-
-		'''
-		if app.GetLoginType() == app.LOGIN_TYPE_NONE:
-			self.__LoadLoginInfo("loginInfo.xml")
-		else:
-			app.loggined = False
-		'''
-
-		self.__LoadLoginInfo("loginInfo.xml")
-
-		'''
-		if debugInfo.IsDebugMode():
-			self.__LoadLoginFile("loginInfo.py")
-		'''
-
-		if app.loggined:
-			self.loginFailureFuncDict = {
-				"WRONGPWD" : app.Exit,
-				#"WRONGMAT" : app.Exit,
-				"QUIT" : app.Exit,
-			}
-
-		if musicInfo.loginMusic != "":
-			snd.SetMusicVolume(systemSetting.GetMusicVolume())
-			snd.FadeInMusic("BGM/"+musicInfo.loginMusic)
-
-		snd.SetSoundVolume(systemSetting.GetSoundVolume())
-
-		# pevent key "[" "]"
-		ime.AddExceptKey(91)
-		ime.AddExceptKey(93)
-
-		self.Show()
-
-		global SKIP_LOGIN_PHASE
-		if SKIP_LOGIN_PHASE:
-			if self.isStartError:
-				self.connectBoard.Hide()
-				self.loginBoard.Hide()
-				self.serverBoard.Hide()
-				self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.__ExitGame)
-				return
-
-			if self.loginInfo:
-				self.serverBoard.Hide()
-			else:
-				self.__RefreshServerList()
-				self.__OpenServerBoard()
-		else:
-			connectingIP = self.stream.GetConnectAddr()
-			if connectingIP:
-				self.__OpenLoginBoard()
-				if IsFullBackImage():
-					self.GetChild("bg1").Hide()
-					self.GetChild("bg2").Show()
-			else:
-				self.__RefreshServerList()
-				self.__OpenServerBoard()
-
-		if app.ENABLE_LEFT_SEAT:
-			if net.IsLeftSeatLogOutState():
-				self.PopupNotifyMessage(localeInfo.LEFT_SEAT_LOGOUT)
-
-		app.ShowCursor()
-
-	def Close(self):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		ServerStateChecker.Initialize(self)
-
-		# print "---------------------------------------------------------------------------- CLOSE LOGIN WINDOW "
-		#
-		# selectMusicÀÌ ¾øÀ¸¸é BGMÀÌ ²÷±â¹Ç·Î µÎ°³ ´Ù Ã¼Å©ÇÑ´Ù. 
-		#
-		if musicInfo.loginMusic != "" and musicInfo.selectMusic != "":
-			snd.FadeOutMusic("BGM/"+musicInfo.loginMusic)
-
-		## NOTE : idEditLine¿Í pwdEditLineÀº ÀÌº¥Æ®°¡ ¼­·Î ¿¬°á µÇ¾îÀÖ¾î¼­
-		##		Event¸¦ °­Á¦·Î ÃÊ±âÈ­ ÇØÁÖ¾î¾ß¸¸ ÇÕ´Ï´Ù - [levites]
-		self.idEditLine.SetTabEvent(0)
-		self.idEditLine.SetReturnEvent(0)
-		self.pwdEditLine.SetReturnEvent(0)
-		self.pwdEditLine.SetTabEvent(0)
-
-		self.connectBoard = None
-		self.loginBoard = None
-		self.idEditLine = None
-		self.pwdEditLine = None
-		self.inputDialog = None
-		self.connectingDialog = None
-		self.loadingImage = None
-
-		self.serverBoard = None
-		self.serverList = None
-		self.channelList = None
-
-		self.VIRTUAL_KEY_ALPHABET_LOWERS = None
-		self.VIRTUAL_KEY_ALPHABET_UPPERS = None
-		self.VIRTUAL_KEY_SYMBOLS = None
-		self.VIRTUAL_KEY_NUMBERS = None
-
-		# VIRTUAL_KEYBOARD_BUG_FIX
-		if self.virtualKeyboard:
-			for keyIndex in xrange(0, VIRTUAL_KEYBOARD_NUM_KEYS+1):
-				key = self.GetChild2("key_%d" % keyIndex)
-				if key:
-					key.SetEvent(None)
-
-			self.GetChild("key_space").SetEvent(None)
-			self.GetChild("key_backspace").SetEvent(None)
-			self.GetChild("key_enter").SetEvent(None)
-			self.GetChild("key_shift").SetToggleDownEvent(None)
-			self.GetChild("key_shift").SetToggleUpEvent(None)
-			self.GetChild("key_at").SetToggleDownEvent(None)
-			self.GetChild("key_at").SetToggleUpEvent(None)
-
-			self.virtualKeyboard = None
-
-		self.KillFocus()
-		self.Hide()
-
-		self.stream.popupWindow.Close()
-		self.loginFailureFuncDict = None
-
-		ime.ClearExceptKey()
-
-		app.HideCursor()
-
-	def __SaveChannelInfo(self):
-		try:
-			file = open("channel.inf", "w")
-			file.write("%d %d %d" % (self.__GetServerID(), self.__GetChannelID(), self.__GetRegionID()))
-		except:
-			print "LoginWindow.__SaveChannelInfo - SaveError"
-
-	def __LoadChannelInfo(self):
-		try:
-			file = open("channel.inf")
-			lines = file.readlines()
-
-			if len(lines) > 0:
-				tokens = lines[0].split()
-
-				selServerID = int(tokens[0])
-				selChannelID = int(tokens[1])
-
-				if len(tokens) == 3:
-					regionID = int(tokens[2])
-
-				return regionID, selServerID, selChannelID
-
-		except:
-			print "LoginWindow.__LoadChannelInfo - OpenError"
-			return -1, -1, -1
-
-	def __ExitGame(self):
-		app.Exit()
-
-	def SetIDEditLineFocus(self):
-		if self.idEditLine != None:
-			self.idEditLine.SetFocus()
-
-	def SetPasswordEditLineFocus(self):
-		if localeInfo.IsEUROPE():
-			if self.idEditLine != None: #0000862: [M2EU] ·Î±×ÀÎÃ¢ ÆË¾÷ ¿¡·¯: Á¾·á½Ã ¸ÕÀú None ¼³Á¤µÊ
-				self.idEditLine.SetText("")
-				self.idEditLine.SetFocus() #0000685: [M2EU] ¾ÆÀÌµð/ºñ¹Ð¹øÈ£ À¯Ãß °¡´É ¹ö±× ¼öÁ¤: ¹«Á¶°Ç ¾ÆÀÌµð·Î Æ÷Ä¿½º°¡ °¡°Ô ¸¸µç´Ù
-
-			if self.pwdEditLine != None: #0000862: [M2EU] ·Î±×ÀÎÃ¢ ÆË¾÷ ¿¡·¯: Á¾·á½Ã ¸ÕÀú None ¼³Á¤µÊ
-				self.pwdEditLine.SetText("")
-		else:
-			if self.pwdEditLine != None:
-				self.pwdEditLine.SetFocus()
-
-	def OnEndCountDown(self):
-		self.isNowCountDown = False
-		if localeInfo.IsBRAZIL():
-			self.timeOutMsg = True
-		else:
-			self.timeOutMsg = False
-		self.OnConnectFailure()
-
-	if app.LOGIN_COUNT_DOWN_UI_MODIFY:
-		def SetNowCountDown(self, value):
-			self.isNowCountDown = value
-
-	def OnConnectFailure(self):
-		if self.isNowCountDown:
-			return
-
-		snd.PlaySound("sound/ui/loginfail.wav")
-
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		if app.loggined:
-			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.__ExitGame)
-		elif self.timeOutMsg:
-			self.PopupNotifyMessage(localeInfo.LOGIN_FAILURE_TIMEOUT, self.SetPasswordEditLineFocus)
-		else:
-			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.SetPasswordEditLineFocus)
-
-	def OnHandShake(self):
-		if not IsLoginDelay():
-			snd.PlaySound("sound/ui/loginok.wav")
-			self.PopupDisplayMessage(localeInfo.LOGIN_CONNECT_SUCCESS)
-
-	def OnLoginStart(self):
-		if not IsLoginDelay():
-			self.PopupDisplayMessage(localeInfo.LOGIN_PROCESSING)
-
-	def OnLoginFailure(self, error):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		try:
-			loginFailureMsg = self.loginFailureMsgDict[error]
-		except KeyError:
-			loginFailureMsg = localeInfo.LOGIN_FAILURE_UNKNOWN + error
-
-		#0000685: [M2EU] ¾ÆÀÌµð/ºñ¹Ð¹øÈ£ À¯Ãß °¡´É ¹ö±× ¼öÁ¤: ¹«Á¶°Ç ÆÐ½º¿öµå·Î Æ÷Ä¿½º°¡ °¡°Ô ¸¸µç´Ù
-		loginFailureFunc = self.loginFailureFuncDict.get(error, self.SetPasswordEditLineFocus)
-
-		if app.loggined:
-			self.PopupNotifyMessage(loginFailureMsg, self.__ExitGame)
-		else:
-			self.PopupNotifyMessage(loginFailureMsg, loginFailureFunc)
-
-		snd.PlaySound("sound/ui/loginfail.wav")
-
-	def __DisconnectAndInputID(self):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		self.SetIDEditLineFocus()
-		net.Disconnect()
-
-	def __DisconnectAndInputPassword(self):
-		if self.connectingDialog:
-			self.connectingDialog.Close()
-		self.connectingDialog = None
-
-		self.SetPasswordEditLineFocus()
-		net.Disconnect()
-
-	def __LoadScript(self, fileName):
-		import dbg
-		try:
-			pyScrLoader = ui.PythonScriptLoader()
-			pyScrLoader.LoadScriptFile(self, fileName)
-		except:
-			import exception
-			exception.Abort("LoginWindow.__LoadScript.LoadObject")
-		try:
-			GetObject = self.GetChild
-			self.serverBoard = GetObject("ServerBoard")
-			self.serverSelectButton = GetObject("ServerSelectButton")
-			self.serverExitButton = GetObject("ServerExitButton")
-			self.connectBoard = GetObject("ConnectBoard")
-			self.loginBoard = GetObject("LoginBoard")
-			self.idEditLine = GetObject("ID_EditLine")
-			self.pwdEditLine = GetObject("Password_EditLine")
-			self.serverInfo = GetObject("ConnectName")
-			self.selectConnectButton = GetObject("SelectConnectButton")
-			self.loginButton = GetObject("LoginButton")
-			self.loginExitButton = GetObject("LoginExitButton")
-
-			if app.ENABLE_SERVER_SELECT_RENEWAL:
-				self.serverList = ServerListBox()
-				self.serverList.SetParent(self.serverBoard)
-
-				if localeInfo.IsARABIC():
-					self.serverList.SetPosition(133, 40)
-					self.serverList.SetSize(232, 103 if serverInfo.SMALL_SERVER_SELECT_LIST else 171)
-					self.serverList.SetTextCenterAlign(0)
-				else:
-					self.serverList.SetPosition(10, 40)
-					self.serverList.SetSize(232, (103 if serverInfo.SMALL_SERVER_SELECT_LIST else 171) + 180)
-					self.serverList.SetTextCenterAlign(0)
-					self.serverList.SetRowCount(15)
-				self.serverList.Show()
-
-				self.channelList = ChannelListBox()
-				self.channelList.SetParent(self.serverBoard)
-
-				if localeInfo.IsARABIC():
-					self.channelList.SetPosition(10, 40)
-					self.channelList.SetSize(109, 112 if serverInfo.SMALL_SERVER_SELECT_LIST else 180)
-					self.channelList.SetTextCenterAlign(0)
-				else:
-					self.channelList.SetPosition(255, 40)
-					self.channelList.SetSize(109, 103 if serverInfo.SMALL_SERVER_SELECT_LIST else 171)
-					self.channelList.SetTextCenterAlign(0)
-				self.channelList.Show()
-			else:
-				self.serverList = GetObject("ServerList")
-				self.channelList = GetObject("ChannelList")
-
-			if localeInfo.IsVIETNAM():
-				self.checkButton = GetObject("CheckButton")
-				self.checkButton.Down()
-
-			self.virtualKeyboard = self.GetChild2("VirtualKeyboard")
-
-			if self.virtualKeyboard:
-				self.VIRTUAL_KEY_ALPHABET_UPPERS = Suffle(localeInfo.VIRTUAL_KEY_ALPHABET_UPPERS)
-				self.VIRTUAL_KEY_ALPHABET_LOWERS = "".join([localeInfo.VIRTUAL_KEY_ALPHABET_LOWERS[localeInfo.VIRTUAL_KEY_ALPHABET_UPPERS.index(e)] for e in self.VIRTUAL_KEY_ALPHABET_UPPERS])
-				if localeInfo.IsBRAZIL():
-					self.VIRTUAL_KEY_SYMBOLS_BR = Suffle(localeInfo.VIRTUAL_KEY_SYMBOLS_BR)
-				else:
-					self.VIRTUAL_KEY_SYMBOLS = Suffle(localeInfo.VIRTUAL_KEY_SYMBOLS)
-				self.VIRTUAL_KEY_NUMBERS = Suffle(localeInfo.VIRTUAL_KEY_NUMBERS)
-				self.__VirtualKeyboard_SetAlphabetMode()
-
-				self.GetChild("key_space").SetEvent(lambda : self.__VirtualKeyboard_PressKey(' '))
-				self.GetChild("key_backspace").SetEvent(lambda : self.__VirtualKeyboard_PressBackspace())
-				self.GetChild("key_enter").SetEvent(lambda : self.__VirtualKeyboard_PressReturn())
-				self.GetChild("key_shift").SetToggleDownEvent(lambda : self.__VirtualKeyboard_SetUpperMode())
-				self.GetChild("key_shift").SetToggleUpEvent(lambda : self.__VirtualKeyboard_SetLowerMode())
-				self.GetChild("key_at").SetToggleDownEvent(lambda : self.__VirtualKeyboard_SetSymbolMode())
-				self.GetChild("key_at").SetToggleUpEvent(lambda : self.__VirtualKeyboard_SetAlphabetMode())
-
-		except:
-			import exception
-			exception.Abort("LoginWindow.__LoadScript.BindObject")
-
-		if self.IS_TEST:
-			self.selectConnectButton.Hide()
-		else:
-			self.selectConnectButton.SetEvent(ui.__mem_func__(self.__OnClickSelectConnectButton))
-
-		self.serverBoard.OnKeyUp = ui.__mem_func__(self.__ServerBoard_OnKeyUp)
-		self.xServerBoard, self.yServerBoard = self.serverBoard.GetLocalPosition()
-
-		self.serverSelectButton.SetEvent(ui.__mem_func__(self.__OnClickSelectServerButton))
-		self.serverExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitButton))
-
-		self.loginButton.SetEvent(ui.__mem_func__(self.__OnClickLoginButton))
-		self.loginExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitButton))
-
-		self.serverList.SetEvent(ui.__mem_func__(self.__OnSelectServer))
-
-		self.idEditLine.SetReturnEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
-		self.idEditLine.SetTabEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
-
-		self.pwdEditLine.SetReturnEvent(ui.__mem_func__(self.__OnClickLoginButton))
-		self.pwdEditLine.SetTabEvent(ui.__mem_func__(self.idEditLine.SetFocus))
-
-		if IsFullBackImage():
-			self.GetChild("bg1").Show()
-			self.GetChild("bg2").Hide()
-
-		return 1
-
-	def __VirtualKeyboard_SetKeys(self, keyCodes):
-		uiDefFontBackup = localeInfo.UI_DEF_FONT
-		localeInfo.UI_DEF_FONT = localeInfo.UI_DEF_FONT_LARGE
-
-		keyIndex = 1
-		for keyCode in keyCodes:
-			key = self.GetChild2("key_%d" % keyIndex)
-			if key:
-				key.SetEvent(lambda x=keyCode: self.__VirtualKeyboard_PressKey(x))
-				key.SetText(keyCode)
-				key.ButtonText.SetFontColor(0, 0, 0)
-				keyIndex += 1
-
-		for keyIndex in xrange(keyIndex, VIRTUAL_KEYBOARD_NUM_KEYS+1):
-			key = self.GetChild2("key_%d" % keyIndex)
-			if key:
-				key.SetEvent(lambda x=' ': self.__VirtualKeyboard_PressKey(x))
-				key.SetText(' ')
-
-		localeInfo.UI_DEF_FONT = uiDefFontBackup
-
-	def __VirtualKeyboard_PressKey(self, code):
-		ime.PasteString(code)
-
-		# if self.virtualKeyboardMode == "ALPHABET" and self.virtualKeyboardIsUpper:
-			# self.__VirtualKeyboard_SetLowerMode()
-
-	def __VirtualKeyboard_PressBackspace(self):
-		ime.PasteBackspace()
-
-	def __VirtualKeyboard_PressReturn(self):
-		ime.PasteReturn()
-
-	def __VirtualKeyboard_SetUpperMode(self):
-		self.virtualKeyboardIsUpper = True
-
-		if self.virtualKeyboardMode == "ALPHABET":
-			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_ALPHABET_UPPERS)
-		elif self.virtualKeyboardMode == "NUMBER":
-			if localeInfo.IsBRAZIL():
-				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS_BR)
-			else:
-				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS)
-		else:
-			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_NUMBERS)
-
-	def __VirtualKeyboard_SetLowerMode(self):
-		self.virtualKeyboardIsUpper = False
-
-		if self.virtualKeyboardMode == "ALPHABET":
-			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_ALPHABET_LOWERS)
-		elif self.virtualKeyboardMode == "NUMBER":
-			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_NUMBERS)
-		else:
-			if localeInfo.IsBRAZIL():
-				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS_BR)
-			else:
-				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS)
-
-	def __VirtualKeyboard_SetAlphabetMode(self):
-		self.virtualKeyboardIsUpper = False
-		self.virtualKeyboardMode = "ALPHABET"
-		self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_ALPHABET_LOWERS)
-
-	def __VirtualKeyboard_SetNumberMode(self):
-		self.virtualKeyboardIsUpper = False
-		self.virtualKeyboardMode = "NUMBER"
-		self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_NUMBERS)
-
-	def __VirtualKeyboard_SetSymbolMode(self):
-		self.virtualKeyboardIsUpper = False
-		self.virtualKeyboardMode = "SYMBOL"
-		if localeInfo.IsBRAZIL():
-			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS_BR)
-		else:
-			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS)
-
-	def Connect(self, id, pwd):
-		if app.ENABLE_SERVER_SELECT_RENEWAL:
-			regionID = self.__GetRegionID()
-			serverID = self.__GetServerID()
-			channelID = self.__GetChannelID()
-
-			if (serverInfo.REGION_DICT.has_key(regionID)) and (serverInfo.REGION_DICT[regionID].has_key(serverID)):
-				try:
-					channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
-				except KeyError:
-					return
-
-				try:
-					state = channelDict[channelID]["state"]
-				except KeyError:
-					self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_CHANNEL)
-					return
-
-				# »óÅÂ°¡ CLOSED¸é°ú °°À¸¸é ÁøÀÔ ±ÝÁö
-				tokens = serverInfo.REGION_DICT[regionID][serverID].get("state", "NONE").split("|")
-				is_server_closed = False
-
-				for idx in xrange(len(tokens)):
-					if tokens[idx].strip() == "CLOSE":
-						is_server_closed = True
-
-				if is_server_closed == True:
-					self.PopupNotifyMessage(localeInfo.SERVER_NOTIFY_CLOSED)
-					return
-
-				# »óÅÂ°¡ FULL °ú °°À¸¸é ÁøÀÔ ±ÝÁö
-				if state == serverInfo.STATE_DICT[len(serverInfo.STATE_DICT) - 1]:
-					self.PopupNotifyMessage(localeInfo.CHANNEL_NOTIFY_FULL)
-					return
-
-		if constInfo.SEQUENCE_PACKET_ENABLE:
-			net.SetPacketSequenceMode()
-
-		if IsLoginDelay():
-			loginDelay = GetLoginDelay()
-			self.connectingDialog = ConnectingDialog()
-			self.connectingDialog.Open(loginDelay)
-			self.connectingDialog.SAFE_SetTimeOverEvent(self.OnEndCountDown)
-			self.connectingDialog.SAFE_SetExitEvent(self.OnPressExitKey)
-			self.isNowCountDown = True
-		else:
-			self.stream.popupWindow.Close()
-			self.stream.popupWindow.Open(localeInfo.LOGIN_CONNETING, self.SetPasswordEditLineFocus, localeInfo.UI_CANCEL)
-
-		self.stream.SetLoginInfo(id, pwd)
-		if app.LOGIN_COUNT_DOWN_UI_MODIFY:
-			connect_result = self.stream.Connect()
-			if not connect_result:
-				self.isNowCountDown = False
-		else:
-			self.stream.Connect()
-
-	def __OnClickExitButton(self):
-		self.stream.SetPhaseWindow(0)
-
-	def __SetServerInfo(self, name):
-		net.SetServerInfo(name.strip())
-		self.serverInfo.SetText(name)
-
-	def __LoadLoginInfo(self, loginInfoFileName):
-		def getValue(element, name, default):
-			if [] != element.getElementsByTagName(name):
-				return element.getElementsByTagName(name).item(0).firstChild.nodeValue
-			else:
-				return default
-
-		self.id = None
-		self.pwd = None
-		self.loginnedServer = None
-		self.loginnedChannel = None
-		app.loggined = False
-
-		self.loginInfo = True
-
-		from xml.dom.minidom import parse
-		try:
-			f = open(loginInfoFileName, "r")
-			dom = parse(f)
-		except:
-			return
-		serverLst = dom.getElementsByTagName("server")
-		if [] != dom.getElementsByTagName("logininfo"):
-			logininfo = dom.getElementsByTagName("logininfo")[0]
-		else:
-			return
-
-		try:
-			server_name = logininfo.getAttribute("name")
-			channel_idx = int(logininfo.getAttribute("channel_idx"))
-		except:
-			return
-
-		try:
-			matched = False
-
-			for k, v in serverInfo.REGION_DICT[0].iteritems():
-				if v["name"] == server_name:
-					account_addr = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["ip"]
-					account_port = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["port"]
-
-					channel_info = v["channel"][channel_idx]
-					channel_name = channel_info["name"]
-					addr = channel_info["ip"]
-					port = channel_info["tcp_port"]
-
-					net.SetMarkServer(addr, port)
-					self.stream.SetConnectInfo(addr, port, account_addr, account_port)
-
-					matched = True
-					break
-
-			if False == matched:
-				return
-		except:
-			return
-
-		if app.ENABLE_MOVE_CHANNEL:
-			self.serverInfo.SetText("%s, %s " % (server_name, channel_name))
-		else:
-			self.__SetServerInfo("%s, %s " % (server_name, channel_name))
-
-		id = getValue(logininfo, "id", "")
-		pwd = getValue(logininfo, "pwd", "")
-		self.idEditLine.SetText(id)
-		self.pwdEditLine.SetText(pwd)
-		slot = getValue(logininfo, "slot", "0")
-		locale = getValue(logininfo, "locale", "")
-		locale_dir = getValue(logininfo, "locale_dir", "")
-		is_auto_login = int(getValue(logininfo, "auto_login", "0"))
-
-		self.stream.SetCharacterSlot(int(slot))
-		self.stream.isAutoLogin = is_auto_login
-		self.stream.isAutoSelect = is_auto_login
-
-		if locale and locale_dir:
-			app.ForceSetLocale(locale, locale_dir)
-
-		if 0 != is_auto_login:
-			self.Connect(id, pwd)
-
-	'''
-	if debugInfo.IsDebugMode():
-		def __LoadLoginFile(self, loginInfoFileName):
-			try:
-				loginInfo = {}
-				execfile(loginInfoFileName, loginInfo)
-			except IOError:
-				print(\
-					"ÀÚµ¿ ·Î±×ÀÎÀ» ÇÏ½Ã·Á¸é" + loginInfoFileName + "ÆÄÀÏÀ» ÀÛ¼ºÇØÁÖ¼¼¿ä\n"\
-					"\n"\
-					"³»¿ë:\n"\
-					"================================================================\n"
-				);
-
-			self.id = None
-			self.pwd = None
-			self.loginnedServer = None
-			self.loginnedChannel = None
-			app.loggined = False
-
-			self.loginInfo = loginInfo
-	'''
-
-	def PopupDisplayMessage(self, msg):
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(msg)
-
-	def PopupNotifyMessage(self, msg, func = 0):
-		if not func:
-			func = self.EmptyFunc
-
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(msg, func, localeInfo.UI_OK)
-
-	def __OnCloseInputDialog(self):
-		if self.inputDialog:
-			self.inputDialog.Close()
-		self.inputDialog = None
-		return True
-
-	def OnPressExitKey(self):
-		self.stream.popupWindow.Close()
-		self.stream.SetPhaseWindow(0)
-		return True
-
-	def OnExit(self):
-		self.stream.popupWindow.Close()
-
-	def OnUpdate(self):
-		ServerStateChecker.Update()
-
-	def EmptyFunc(self):
-		pass
-
-	#####################################################################################
-
-	def __ServerBoard_OnKeyUp(self, key):
-		if self.serverBoard.IsShow():
-			if app.DIK_RETURN==key:
-				self.__OnClickSelectServerButton()
-		return True
-
-	def __GetRegionID(self):
-		return 0
-
-	def __GetServerID(self):
-		return self.serverList.GetSelectedItem()
-
-	def __GetChannelID(self):
-		return self.channelList.GetSelectedItem()
-
-	# SEVER_LIST_BUG_FIX
-	def __ServerIDToServerIndex(self, regionID, targetServerID):
-		try:
-			regionDict = serverInfo.REGION_DICT[regionID]
-		except KeyError:
-			return -1
-
-		retServerIndex = 0
-		for eachServerID, regionDataDict in regionDict.items():
-			if eachServerID == targetServerID:
-				return retServerIndex
-
-			retServerIndex += 1
-
-		return -1
-
-	def __ChannelIDToChannelIndex(self, channelID):
-		return channelID - 1
-	# END_OF_SEVER_LIST_BUG_FIX
-
-	def __OpenServerBoard(self):
-		loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
-
-		serverIndex = self.__ServerIDToServerIndex(loadRegionID, loadServerID)
-		channelIndex = self.__ChannelIDToChannelIndex(loadChannelID)
-
-		# ½Å±ÔÀ¯Àú ¼­¹ö ¼±ÅÃ ·ÎÁ÷.
-		if app.ENABLE_SERVER_SELECT_RENEWAL and serverIndex == -1: # ¼±ÅÃµÈ ¼­¹ö°¡ ¾øÀ» ¶§ ½Å±ÔÀ¯Àú¶ó°í ÆÇ´Ü
-			newIdx = serverInfo.SERVER_STATE_DICT.get("NEW", 0)
-			specialIdx = serverInfo.SERVER_STATE_DICT.get("SPECIAL", 0)
-			closeIdx = serverInfo.SERVER_STATE_DICT.get("CLOSE", 0)
-			standbyIdx = serverInfo.SERVER_STATE_DICT.get("STANDBY", 0)
-			serverSelect1st = -1;
-			serverSelect2nd = -1;
-			serverSelect3rd = -1;
-			serverSelect4th = -1;
-
-			for idx in xrange(self.serverList.GetItemCount()):
-				(state, state2) = self.serverList.GetState(idx)
-				if state == newIdx or state2 == newIdx: # 1¼øÀ§·Î NEW¸¦ ¼±ÅÃÇÑ´Ù.
-					serverSelect1st = idx
-					break
-				elif serverSelect2nd == -1 and (state == specialIdx or state2 == specialIdx): # 2¼øÀ§·Î SPECIAL¸¦ ¼±ÅÃÇÑ´Ù.
-					serverSelect2nd = idx
-				elif serverSelect3rd == -1 and (state != closeIdx and state2 != closeIdx): # 3¼øÀ§ Á¢¼Ó°¡´ÉÇÑ ¼­¹ö Áß ÃÖ»óÀ§.
-					serverSelect3rd = idx
-				elif serverSelect4th == -1 and (state != standbyIdx and state2 != standbyIdx):
-					serverSelect4th = idx
-
-			if serverSelect1st != -1:
-				serverIndex = serverSelect1st
-			elif serverSelect2nd != -1:
-				serverIndex = serverSelect2nd
-			elif serverSelect3rd != -1:
-				serverIndex = serverSelect3rd
-			elif serverSelect4th != -1:
-				serverIndex = serverSelect4th
-
-		self.serverList.SelectItem(serverIndex)
-
-		if localeInfo.IsEUROPE():
-			if app.ENABLE_NEW_USER_CARE:
-				self.channelList.SelectItem(channelIndex)
-			else:
-				self.channelList.SelectItem(app.GetRandom(0, self.channelList.GetItemCount()))
-		else:
-			if channelIndex >= 0:
-				self.channelList.SelectItem(channelIndex)
-
-		## Show/Hide ÄÚµå¿¡ ¹®Á¦°¡ ÀÖ¾î¼­ ÀÓ½Ã - [levites]
-		self.serverBoard.SetPosition(self.xServerBoard, self.yServerBoard)
-		self.serverBoard.Show()
-		self.connectBoard.Hide()
-		self.loginBoard.Hide()
-
-		if self.virtualKeyboard:
-			self.virtualKeyboard.Hide()
-
-		if app.loggined and not SKIP_LOGIN_PHASE_SUPPORT_CHANNEL:
-			self.serverList.SelectItem(self.loginnedServer - 1)
-			self.channelList.SelectItem(self.loginnedChannel - 1)
-			self.__OnClickSelectServerButton()
-
-	def __OpenLoginBoard(self):
-		self.serverExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitServerButton))
-		self.serverExitButton.SetText(localeInfo.UI_CLOSE)
-
-		self.serverBoard.SetPosition(self.xServerBoard, wndMgr.GetScreenHeight())
-		self.serverBoard.Hide()
-
-		if self.virtualKeyboard:
-			self.virtualKeyboard.Show()
-
-		if app.loggined:
-			self.Connect(self.id, self.pwd)
-			self.connectBoard.Hide()
-			self.loginBoard.Hide()
-		elif not self.stream.isAutoLogin:
-			self.connectBoard.Show()
-			self.loginBoard.Show()
-
-		## if users have the login infomation, then don't initialize.2005.9 haho
-		if self.idEditLine == None:
-			self.idEditLine.SetText("")
-		if self.pwdEditLine == None:
-			self.pwdEditLine.SetText("")
-
-		self.idEditLine.SetFocus()
-
-		global SKIP_LOGIN_PHASE
-		if SKIP_LOGIN_PHASE:
-			if not self.loginInfo:
-				self.connectBoard.Hide()
-
-	def __OnSelectRegionGroup(self):
-		self.__RefreshServerList()
-
-	def __OnSelectSettlementArea(self):
-		# SEVER_LIST_BUG_FIX
-		regionID = self.__GetRegionID()
-		serverID = self.serverListOnRegionBoard.GetSelectedItem()
-
-		serverIndex = self.__ServerIDToServerIndex(regionID, serverID)
-		self.serverList.SelectItem(serverIndex)
-		# END_OF_SEVER_LIST_BUG_FIX
-
-		self.__OnSelectServer()
-
-	def __RefreshServerList(self):
-		regionID = self.__GetRegionID()
-
-		if not serverInfo.REGION_DICT.has_key(regionID):
-			return
-
-		self.serverList.ClearItem()
-
-		regionDict = serverInfo.REGION_DICT[regionID]
-
-		# SEVER_LIST_BUG_FIX
-		visible_index = 1
-		if app.ENABLE_SERVER_SELECT_RENEWAL:
-			for id, regionDataDict in regionDict.items():
-				name = regionDataDict.get("name", "noname")
-				state = 0
-				state2 = 0
-				flag = regionDataDict.get("flag", "ALL")
-
-				tokens = regionDataDict.get("state", "NONE").split("|")
-				if len(tokens) == 1:
-					state = serverInfo.SERVER_STATE_DICT.get(tokens[0].strip(), 0)
-				elif len(tokens) == 2:
-					state = serverInfo.SERVER_STATE_DICT.get(tokens[0].strip(), 0)
-					state2 = serverInfo.SERVER_STATE_DICT.get(tokens[1].strip(), 0)
-
-				if localeInfo.IsBRAZIL() or localeInfo.IsCANADA():
-					self.serverList.InsertItem(id, "%s" % (name))
-				else:
-					if localeInfo.IsCIBN10():
-						if name[0] == "#":
-							self.serverList.InsertItem(-1, "  %s" % (name[1:]), 1)
-						else:
-							self.serverList.InsertItem(id, "  %s" % (name), 2)
-							visible_index += 1
-					else:
-						try:
-							server_id = serverInfo.SERVER_ID_DICT[id]
-						except:
-							server_id = visible_index
-
-						self.serverList.InsertItem(id, "  %s" % (name), state, state2, flag) # ¼­¹öÀÇ »óÅÂ ´ëÇÑ °ª ¼³Á¤.
-						# self.serverList.InsertItem(id, "  %02d. %s" % (int(server_id), name), state, state2, locale) # ¼­¹öÀÇ »óÅÂ ´ëÇÑ °ª ¼³Á¤.
-						#self.serverList.InsertItem(id, "  %s" % (name), state, state2)	# ¼­¹öÀÇ »óÅÂ ´ëÇÑ °ª ¼³Á¤.
-
-						visible_index += 1
-		else:
-			for id, regionDataDict in regionDict.items():
-				name = regionDataDict.get("name", "noname")
-				if localeInfo.IsBRAZIL() or localeInfo.IsCANADA():
-					self.serverList.InsertItem(id, "%s" % (name))
-				else:
-					if localeInfo.IsCIBN10():
-						if name[0] == "#":
-							self.serverList.InsertItem(-1, "  %s" % (name[1:]))
-						else:
-							self.serverList.InsertItem(id, "  %s" % (name))
-							visible_index += 1
-					else:
-						try:
-							server_id = serverInfo.SERVER_ID_DICT[id]
-						except:
-							server_id = visible_index
-
-						self.serverList.InsertItem(id, "  %02d. %s" % (int(server_id), name))
-
-						visible_index += 1
-		# END_OF_SEVER_LIST_BUG_FIX
-
-	def __OnSelectServer(self):
-		self.__OnCloseInputDialog()
-		self.__RequestServerStateList()
-		self.__RefreshServerStateList()
-
-	def __RequestServerStateList(self):
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-
-		try:
-			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
-		except:
-			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
-			return
-
-		ServerStateChecker.Initialize();
-		# ServerStateChecker.SetAuth(serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["ip"], serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["port"])
-		for id, channelDataDict in channelDict.items():
-			key = channelDataDict["key"]
-			ip = channelDataDict["ip"]
-			udp_port = channelDataDict["udp_port"]
-			ServerStateChecker.AddChannel(key, ip, udp_port)
-
-		ServerStateChecker.Request()
-
-	def __RefreshServerStateList(self):
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-		bakChannelID = self.channelList.GetSelectedItem()
-
-		self.channelList.ClearItem()
-
-		try:
-			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
-		except:
-			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
-			return
-
-		for channelID, channelDataDict in channelDict.items():
-			channelName = channelDataDict["name"]
-			channelState = channelDataDict["state"]
-			if app.ENABLE_SERVER_SELECT_RENEWAL:
-				channelStateColor = serverInfo.STATE_COLOR_DICT[channelState]
-				self.channelList.InsertItem(channelID, " %s" % channelName, " %s" % channelState, channelStateColor)
-			elif app.ENABLE_CHANNEL_LIST:
-				channelStateColor = serverInfo.STATE_COLOR_DICT[channelState]
-				self.channelList.InsertItem(channelID, " %s %s" % (channelName, channelState), channelStateColor)
-			else:
-				self.channelList.InsertItem(channelID, " %s %s" % (channelName, channelState))
-
-		self.channelList.SelectItem(bakChannelID - 1)
-
-	if app.ENABLE_CHANNEL_LIST or app.ENABLE_SERVER_SELECT_RENEWAL:
-		def AutoSelectChannel(self):
-			regionID = self.__GetRegionID()
-			serverID = self.__GetServerID()
-			bakChannelID = self.channelList.GetSelectedItem()
-
-			try:
-				channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
-			except:
-				print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
-				return
-
-			if bakChannelID>len(channelDict):
-				bakChannelID = 0
-
-			if app.ENABLE_SERVER_SELECT_RENEWAL:
-				if bakChannelID > 0:
-					self.channelList.SelectItem(bakChannelID - 1)
-					return
-
-				mostID = 0
-				most = 0
-				secondMostID = 0
-				secondMost = 0
-
-				for channelID, channelDataDict in channelDict.items():
-					channelState = serverInfo.STATE_REVERSE_DICT.get(channelDataDict["state"], 0)
-
-					if mostID == 0:
-						mostID = channelID
-						most = channelState
-					elif channelState > most:
-						secondMostID = mostID
-						secondMost = most
-						mostID = channelID
-						most = channelState
-					elif secondMostID == 0 or channelState > secondMost:
-						secondMostID = channelID
-						secondMost = channelState
-
-				if secondMost <= serverInfo.STATE_REVERSE_DICT.get("Vacant", 2):
-					self.channelList.SelectItem(mostID - 1)
-				else:
-					self.channelList.SelectItem(secondMostID - 1)
-			else:
-				AvailableChannelID = 0
-				BusyChannelID = 0
-
-				for channelID, channelDataDict in channelDict.items():
-					channelState = channelDataDict["state"]
-
-					if AvailableChannelID == 0 and channelState == serverInfo.STATE_DICT[1]:
-						AvailableChannelID = channelID
-
-					if BusyChannelID == 0 and channelState == serverInfo.STATE_DICT[2]:
-						BusyChannelID = channelID
-
-					# »óÅÂ°¡ FULLÀÌ³ª OFFLINEÀÌ¸é ´Ù¸¥ Ã¤³ÎÀ» ¼±ÅÃÇÏµµ·Ï ÇÔ
-					if bakChannelID == channelID and (channelState == serverInfo.STATE_DICT[0] or channelState == serverInfo.STATE_DICT[3]):
-						bakChannelID = 0
-
-				if bakChannelID == 0:
-					if AvailableChannelID != 0:
-						self.channelList.SelectItem(AvailableChannelID - 1)
-					elif BusyChannelID != 0:
-						self.channelList.SelectItem(BusyChannelID - 1)
-					else:
-						self.channelList.SelectItem(0)
-				else:
-					self.channelList.SelectItem(bakChannelID - 1)
-
-	def __GetChannelName(self, regionID, selServerID, selChannelID):
-		try:
-			return serverInfo.REGION_DICT[regionID][selServerID]["channel"][selChannelID]["name"]
-		except KeyError:
-			if 9 == selChannelID:
-				return localeInfo.CHANNEL_PVP
-			else:
-				return localeInfo.CHANNEL_NORMAL % (selChannelID)
-
-	def NotifyChannelState(self, addrKey, state):
-		try:
-			stateName = serverInfo.STATE_DICT[state]
-		except:
-			stateName = serverInfo.STATE_NONE
-
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-		channelID = addrKey % 10
-
-		try:
-			serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["state"] = stateName
-			self.__RefreshServerStateList()
-
-		except:
-			import exception
-			exception.Abort(localeInfo.CHANNEL_NOT_FIND_INFO)
-
-	def __OnClickExitServerButton(self):
-		print "exit server"
-		self.__OpenLoginBoard()
-
-		if IsFullBackImage():
-			self.GetChild("bg1").Hide()
-			self.GetChild("bg2").Show()
-
-	def __OnClickSelectRegionButton(self):
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-
-		if (not serverInfo.REGION_DICT.has_key(regionID)):
-			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_REGION)
-			return
-
-		if (not serverInfo.REGION_DICT[regionID].has_key(serverID)):
-			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_SERVER)
-			return
-
-		self.__SaveChannelInfo()
-
-		self.serverExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitServerButton))
-		self.serverExitButton.SetText(localeInfo.UI_CLOSE)
-
-		self.__RefreshServerList()
-		self.__OpenServerBoard()
-
-	def __OnClickSelectServerButton(self):
-		if IsFullBackImage():
-			self.GetChild("bg1").Hide()
-			self.GetChild("bg2").Show()
-
-		regionID = self.__GetRegionID()
-		serverID = self.__GetServerID()
-		channelID = self.__GetChannelID()
-
-		if (not serverInfo.REGION_DICT.has_key(regionID)):
-			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_REGION)
-			return
-
-		if (not serverInfo.REGION_DICT[regionID].has_key(serverID)):
-			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_SERVER)
-			return
-
-		try:
-			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
-		except KeyError:
-			return
-
-		try:
-			state = channelDict[channelID]["state"]
-		except KeyError:
-			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_CHANNEL)
-			return
-
-		if app.ENABLE_SERVER_SELECT_RENEWAL:
-			tokens = serverInfo.REGION_DICT[regionID][serverID].get("state", "NONE").split("|")
-			is_server_closed = False
-
-			for idx in xrange(len(tokens)):
-				if tokens[idx].strip() == "CLOSE":
-					is_server_closed = True
-
-			# »óÅÂ°¡ CLOSED¸é ÁøÀÔ ±ÝÁö
-			if is_server_closed == True:
-				self.PopupNotifyMessage(localeInfo.SERVER_NOTIFY_CLOSED)
-				return
-
-			# »óÅÂ°¡ FULL °ú °°À¸¸é ÁøÀÔ ±ÝÁö
-			if state == serverInfo.STATE_DICT[len(serverInfo.STATE_DICT) - 1]:
-				self.PopupNotifyMessage(localeInfo.CHANNEL_NOTIFY_FULL)
-				return
-		else:
-			# »óÅÂ°¡ FULL °ú °°À¸¸é ÁøÀÔ ±ÝÁö
-			if state == serverInfo.STATE_DICT[3]:
-				self.PopupNotifyMessage(localeInfo.CHANNEL_NOTIFY_FULL)
-				return
-
-		self.__SaveChannelInfo()
-
-		try:
-			serverName = serverInfo.REGION_DICT[regionID][serverID]["name"]
-			channelName = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["name"]
-			addrKey = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["key"]
-
-			if "Ãµ¸¶ ¼­¹ö" == serverName:
-				app.ForceSetLocale("ymir", "locale/ymir")
-			elif "Äèµµ ¼­¹ö" == serverName:
-				app.ForceSetLocale("we_korea", "locale/we_korea")
-
-		except:
-			print " ERROR __OnClickSelectServerButton(%d, %d, %d)" % (regionID, serverID, channelID)
-			serverName = localeInfo.CHANNEL_EMPTY_SERVER
-			channelName = localeInfo.CHANNEL_NORMAL % channelID
-
-		self.__SetServerInfo("%s, %s " % (serverName, channelName))
-
-		try:
-			ip = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["ip"]
-			tcp_port = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["tcp_port"]
-		except:
-			import exception
-			exception.Abort("LoginWindow.__OnClickSelectServerButton - ¼­¹ö ¼±ÅÃ ½ÇÆÐ")
-
-		try:
-			account_ip = serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["ip"]
-			account_port = serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["port"]
-		except:
-			account_ip = 0
-			account_port = 0
-
-		try:
-			markKey = regionID * 1000 + serverID * 10
-			markAddrValue=serverInfo.MARKADDR_DICT[markKey]
-			print("MarkAddrValue %s" % str(markKey))
-			net.SetMarkServer(markAddrValue["ip"], markAddrValue["tcp_port"])
-			app.SetGuildMarkPath(markAddrValue["mark"])
-			# GUILD_SYMBOL
-			app.SetGuildSymbolPath(markAddrValue["symbol_path"])
-			# END_OF_GUILD_SYMBOL
-
-		except:
-			import exception
-			exception.Abort("LoginWindow.__OnClickSelectServerButton - ¸¶Å© Á¤º¸ ¾øÀ½")
-
-		self.stream.SetConnectInfo(ip, tcp_port, account_ip, account_port)
-		print("SetConnectInfo %s, %s, %s, %s" % (str(ip), str(tcp_port), str(account_ip), str(account_port)))
-		self.__OpenLoginBoard()
-
-	def __OnClickSelectConnectButton(self):
-		if IsFullBackImage():
-			self.GetChild("bg1").Show()
-			self.GetChild("bg2").Hide()
-
-		self.__RefreshServerList()
-		self.__OpenServerBoard()
-
-	def __OnClickLoginButton(self):
-		id = self.idEditLine.GetText()
-		pwd = self.pwdEditLine.GetText()
-
-		if len(id) == 0:
-			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_ID, self.SetIDEditLineFocus)
-			return
-
-		if len(pwd) == 0:
-			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_PASSWORD, self.SetPasswordEditLineFocus)
-			return
-
-		self.Connect(id, pwd)
-
-	def SameLogin_OpenUI(self):
-		self.stream.popupWindow.Close()
-		self.stream.popupWindow.Open(localeInfo.LOGIN_FAILURE_SAMELOGIN, 0, localeInfo.UI_OK)
+import dbg
+import app
+import net
+import ui
+import ime
+import snd
+import wndMgr
+import musicInfo
+import serverInfo
+import systemSetting
+import ServerStateChecker
+import localeInfo
+import constInfo
+import osfInfo
+import uiCommon
+import time
+import serverCommandParser
+import ime
+import uiScriptLocale
+import debugInfo
+
+LOGIN_DELAY_SEC = 0.0
+SKIP_LOGIN_PHASE = False
+SKIP_LOGIN_PHASE_SUPPORT_CHANNEL = False
+FULL_BACK_IMAGE = False
+
+VIRTUAL_KEYBOARD_NUM_KEYS = 46
+VIRTUAL_KEYBOARD_RAND_KEY = True
+
+def Suffle(src):
+	if VIRTUAL_KEYBOARD_RAND_KEY:
+		items = [item for item in src]
+
+		itemCount = len(items)
+		for oldPos in xrange(itemCount):
+			newPos = app.GetRandom(0, itemCount - 1)
+			items[newPos], items[oldPos] = items[oldPos], items[newPos]
+
+		return "".join(items)
+	else:
+		return src
+
+if localeInfo.IsNEWCIBN() or localeInfo.IsCIBN10():
+	LOGIN_DELAY_SEC = 60.0
+	FULL_BACK_IMAGE = True
+
+elif localeInfo.IsYMIR() or localeInfo.IsCHEONMA():
+	FULL_BACK_IMAGE = True
+
+elif localeInfo.IsHONGKONG():
+	FULL_BACK_IMAGE = True
+
+elif localeInfo.IsJAPAN():
+	FULL_BACK_IMAGE = True
+
+elif localeInfo.IsBRAZIL() or osfInfo.LOGIN_UI_MODIFY:
+	if app.LOGIN_COUNT_DOWN_UI_MODIFY:
+		LOGIN_DELAY_SEC = 30.0
+	else:
+		LOGIN_DELAY_SEC = 60.0
+
+def IsFullBackImage():
+	global FULL_BACK_IMAGE
+	return FULL_BACK_IMAGE
+
+def IsLoginDelay():
+	global LOGIN_DELAY_SEC
+	if LOGIN_DELAY_SEC > 0.0:
+		return True
+	else:
+		return False
+
+def GetLoginDelay():
+	global LOGIN_DELAY_SEC
+	return LOGIN_DELAY_SEC
+
+app.SetGuildMarkPath("test")
+
+class ConnectingDialog(ui.ScriptWindow):
+	def __init__(self):
+		ui.ScriptWindow.__init__(self)
+		self.__LoadDialog()
+		self.eventTimeOver = lambda *arg: None
+		self.eventExit = lambda *arg: None
+
+	def __del__(self):
+		ui.ScriptWindow.__del__(self)
+
+	def __LoadDialog(self):
+		try:
+			PythonScriptLoader = ui.PythonScriptLoader()
+			PythonScriptLoader.LoadScriptFile(self, "UIScript/ConnectingDialog.py")
+
+			self.board = self.GetChild("board")
+			self.message = self.GetChild("message")
+			self.countdownMessage = self.GetChild("countdown_message")
+
+		except:
+			import exception
+			exception.Abort("ConnectingDialog.LoadDialog.BindObject")
+
+	def Open(self, waitTime):
+		curTime = time.clock()
+		self.endTime = curTime + waitTime
+
+		self.Lock()
+		self.SetCenterPosition()
+		self.SetTop()
+		self.Show()
+
+	def Close(self):
+		self.Unlock()
+		self.Hide()
+
+	def Destroy(self):
+		self.Hide()
+		self.ClearDictionary()
+
+	def SetText(self, text):
+		self.message.SetText(text)
+
+	def SetCountDownMessage(self, waitTime):
+		self.countdownMessage.SetText("%.0f%s" % (waitTime, localeInfo.SECOND))
+
+	def SAFE_SetTimeOverEvent(self, event):
+		self.eventTimeOver = ui.__mem_func__(event)
+
+	def SAFE_SetExitEvent(self, event):
+		self.eventExit = ui.__mem_func__(event)
+
+	def OnUpdate(self):
+		lastTime = max(0, self.endTime - time.clock())
+		if 0 == lastTime:
+			self.Close()
+			self.eventTimeOver()
+		else:
+			self.SetCountDownMessage(self.endTime - time.clock())
+
+	def OnPressExitKey(self):
+		# self.eventExit()
+		return True
+
+if app.ENABLE_SERVER_SELECT_RENEWAL:
+	import uiToolTip
+	class ServerListBox(ui.ListBox2):
+		STATE_IMAGE_PATH = (
+			"",
+			"locale/common" + "/ui/login/choise_new.tga",
+			"locale/common" + "/ui/login/choise_special.tga",
+			"locale/common" + "/ui/login/choise_close.tga",
+			"locale/common" + "/ui/login/choise_close.tga",
+		)
+
+		SERVER_FLAG_IMAGE_PATH_DICT = {
+			"AE" : "d:/ymir work/ui/intro/login/server_flag_AE.sub",
+			"ALL" : "d:/ymir work/ui/intro/login/server_flag_ALL.sub",
+			"BR" : "d:/ymir work/ui/intro/login/server_flag_BR.sub",
+			"CZ" : "d:/ymir work/ui/intro/login/server_flag_CZ.sub",
+			"DE" : "d:/ymir work/ui/intro/login/server_flag_DE.sub",
+			"DK" : "d:/ymir work/ui/intro/login/server_flag_DK.sub",
+			"ES" : "d:/ymir work/ui/intro/login/server_flag_ES.sub",
+			"EU" : "d:/ymir work/ui/intro/login/server_flag_EU.sub",
+			"FR" : "d:/ymir work/ui/intro/login/server_flag_FR.sub",
+			"GR" : "d:/ymir work/ui/intro/login/server_flag_GR.sub",
+			"HU" : "d:/ymir work/ui/intro/login/server_flag_HU.sub",
+			"IT" : "d:/ymir work/ui/intro/login/server_flag_IT.sub",
+			"KR" : "d:/ymir work/ui/intro/login/server_flag_KR.sub",
+			"NL" : "d:/ymir work/ui/intro/login/server_flag_NL.sub",
+			"PL" : "d:/ymir work/ui/intro/login/server_flag_PL.sub",
+			"PT" : "d:/ymir work/ui/intro/login/server_flag_PT.sub",
+			"RO" : "d:/ymir work/ui/intro/login/server_flag_RO.sub",
+			"RU" : "d:/ymir work/ui/intro/login/server_flag_RU.sub",
+			"SP1" : "d:/ymir work/ui/intro/login/server_flag_SP1.sub",
+			"SP2" : "d:/ymir work/ui/intro/login/server_flag_SP2.sub",
+			"SP3" : "d:/ymir work/ui/intro/login/server_flag_SP3.sub",
+			"SP4" : "d:/ymir work/ui/intro/login/server_flag_SP4.sub",
+			"SP5" : "d:/ymir work/ui/intro/login/server_flag_SP5.sub",
+			"SP6" : "d:/ymir work/ui/intro/login/server_flag_SP6.sub",
+			"SP7" : "d:/ymir work/ui/intro/login/server_flag_SP7.sub",
+			"TR" : "d:/ymir work/ui/intro/login/server_flag_TR.sub",
+			"UK" : "d:/ymir work/ui/intro/login/server_flag_UK.sub"
+		}
+
+		def __init__(self, layer = "UI"):
+			ui.ListBox2.__init__(self, layer)
+			self.stateList = []
+			self.stateList2 = []
+			self.flagList = []
+			self.stateDict = {}
+			self.stateDict2 = {}
+			self.flagDict = {}
+			self.toolTip = uiToolTip.ToolTip()
+
+			self.STATE_IMAGE_TOOLTIP = (
+				"",
+				localeInfo.SERVER_STATUS_NEW,
+				localeInfo.SERVER_STATUS_SPECIAL,
+				localeInfo.SERVER_STATUS_CLOSE,
+				localeInfo.SERVER_STATUS_STANDBY,
+			)
+
+		def ClearItem(self):
+			ui.ListBox2.ClearItem(self)
+			self.stateList = []
+			self.stateList2 = []
+			self.flagList = []
+			self.stateDict = {}
+			self.stateDict2 = {}
+			self.flagDict = {}
+
+		def StateImageEventProgress(self, event_type, arg):
+			if "mouse_click" == event_type:
+				self.SelectItem(arg)
+			elif "mouse_over_in" == event_type:
+				arglen = len(self.STATE_IMAGE_TOOLTIP[arg])
+				pos_x, pos_y = wndMgr.GetMousePosition()
+
+				self.toolTip.ClearToolTip()
+				self.toolTip.SetThinBoardSize(11 * arglen)
+				self.toolTip.SetToolTipPosition(pos_x + 50, pos_y + 50)
+				self.toolTip.AppendTextLine(self.STATE_IMAGE_TOOLTIP[arg], 0xffffffff)
+				self.toolTip.Show()
+			elif "mouse_over_out" == event_type:
+				self.toolTip.Hide()
+
+		def FlagImageEventProgress(self, event_type, arg):
+			if "mouse_click" == event_type:
+				self.SelectItem(arg)
+
+		def GetState(self, line):
+			if line >= len(self.itemList) or line < 0:
+				return (0, 0)
+
+			if line >= len(self.stateList) or line >= len(self.stateList2):
+				return (0, 0)
+
+			return self.stateList[line], self.stateList2[line]
+
+		def _LocateItem(self):
+			pos = (0, self.TEMPORARY_PLACE)
+
+			self.showLineCount = 0
+			for textLine in self.itemList:
+				x, y = self._CalcRenderPos(pos, self.showLineCount)
+				if self.flagDict.get(self.showLineCount) != None:
+					flagWidth = self.flagDict[self.showLineCount].GetWidth()
+
+					self.flagDict[self.showLineCount].SetPosition(0, y - 3)
+					if localeInfo.IsARABIC():
+						self.flagDict[self.showLineCount].SetPosition(flagWidth, y - 3)
+						self.flagDict[self.showLineCount].SetWindowHorizontalAlignRight()
+
+					if localeInfo.IsARABIC():
+						textLine.SetPosition(x + flagWidth + 5, y)
+					else:
+						textLine.SetPosition(x + flagWidth, y)
+				else:
+					textLine.SetPosition(x, y)
+				textLine.Show()
+
+				if self.stateDict.get(self.showLineCount) != None:
+					w = app.GetTextWidth(textLine.GetText())
+
+					if self.flagDict.get(self.showLineCount) != None:
+						flagWidth = self.flagDict[self.showLineCount].GetWidth()
+					else:
+						flagWidth = 0
+
+					if localeInfo.IsARABIC():
+						self.stateDict[self.showLineCount].SetPosition(self.GetWidth() - w - flagWidth - 15, y - 3)
+					else:
+						self.stateDict[self.showLineCount].SetPosition(x + w + flagWidth + 5, y - 3)
+
+					imageWidth = self.stateDict[self.showLineCount].GetWidth()
+
+					if self.stateDict2.get(self.showLineCount) != None:
+						if localeInfo.IsARABIC():
+							self.stateDict2[self.showLineCount].SetPosition(self.GetWidth() - w - flagWidth - 15 - imageWidth, y - 3)
+							#self.stateDict2[self.showLineCount].SetPosition(x, y)
+						else:
+							self.stateDict2[self.showLineCount].SetPosition(x + w + flagWidth + 5 + imageWidth, y - 3)
+
+				self.showLineCount += 1
+
+		def InsertItem(self, number, text, state = 0, state2 = 0, flag = "ALL"):
+			self.keyDict[len(self.itemList)] = number
+			self.textDict[len(self.itemList)] = text
+			textLine = ui.TextLine()
+			textLine.SetParent(self)
+			textLine.SetText(text)
+			textLine.Show()
+
+			if self.itemCenterAlign:
+				textLine.SetWindowHorizontalAlignCenter()
+				textLine.SetHorizontalAlignCenter()
+			elif localeInfo.IsARABIC():
+				textLine.SetWindowHorizontalAlignRight()
+				textLine.SetHorizontalAlignLeft()
+
+			if state != 0:
+				imgBox = ui.ExpandedImageBox()
+				imgBox.SetParent(self)
+				imgBox.LoadImage(self.STATE_IMAGE_PATH[state])
+				imgBox.Show()
+
+				imgBox.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_click", len(self.itemList))
+				imgBox.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_in", state)
+				imgBox.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_out", 0)
+
+				self.stateDict[len(self.itemList)] = imgBox
+
+			if state2 != 0:
+				imgBox2 = ui.ExpandedImageBox()
+				imgBox2.SetParent(self)
+				imgBox2.LoadImage(self.STATE_IMAGE_PATH[state2])
+				imgBox2.Show()
+
+				imgBox2.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_click", len(self.itemList))
+				imgBox2.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_in", state2)
+				imgBox2.SetEvent(ui.__mem_func__(self.StateImageEventProgress), "mouse_over_out", 0)
+
+				self.stateDict2[len(self.itemList)] = imgBox2
+
+			if flag.upper() in self.SERVER_FLAG_IMAGE_PATH_DICT.keys():
+				imgBox3 = ui.ExpandedImageBox()
+				imgBox3.SetParent(self)
+				imgBox3.LoadImage(self.SERVER_FLAG_IMAGE_PATH_DICT[flag.upper()])
+				imgBox3.Show()
+
+				imgBox3.SetEvent(ui.__mem_func__(self.FlagImageEventProgress), "mouse_click", len(self.itemList))
+				imgBox3.SetEvent(ui.__mem_func__(self.FlagImageEventProgress), "mouse_over_in", flag)
+				imgBox3.SetEvent(ui.__mem_func__(self.FlagImageEventProgress), "mouse_over_out", 0)
+
+				self.flagDict[len(self.itemList)] = imgBox3
+
+			self.itemList.append(textLine)
+			self.stateList.append(state)
+			self.stateList2.append(state2)
+			self.flagList.append(flag)
+
+			self._LocateItem()
+			self._RefreshForm()
+
+	class ChannelListBox(ui.ListBox):
+		TEMPORARY_PLACE = 3
+
+		def __init__(self, layer = "UI"):
+			ui.ListBox.__init__(self, layer)
+			self.stateList = []
+
+		def ClearItem(self):
+			ui.ListBox.ClearItem(self)
+			self.stateList = []
+
+		def InsertItem(self, number, text, text2, textColor = 0x00000000):
+			self.keyDict[len(self.itemList)] = number
+			self.textDict[len(self.itemList)] = text
+
+			textLine = ui.TextLine()
+			textLine.SetParent(self)
+			textLine.SetText(text)
+			textLine.Show()
+
+			if self.itemCenterAlign:
+				textLine.SetWindowHorizontalAlignCenter()
+				textLine.SetHorizontalAlignCenter()
+			elif localeInfo.IsARABIC():
+				textLine.SetWindowHorizontalAlignRight()
+				textLine.SetHorizontalAlignRight()
+
+			self.itemList.append(textLine)
+
+			statetextLine = ui.TextLine()
+			statetextLine.SetParent(textLine)
+			statetextLine.SetText(text2)
+			if textColor != 0x00000000:
+				statetextLine.SetPackedFontColor(textColor)
+			statetextLine.Show()
+
+			if self.itemCenterAlign:
+				statetextLine.SetWindowHorizontalAlignCenter()
+				statetextLine.SetHorizontalAlignCenter()
+
+			w, h = textLine.GetTextSize()
+			if localeInfo.IsARABIC():
+				statetextLine.SetPosition(10, 0)
+			else:
+				statetextLine.SetPosition(w, 0)
+
+			statetextLine.AddFlag("not_pick")
+
+			self.stateList.append(statetextLine)
+
+			self._LocateItem()
+
+class LoginWindow(ui.ScriptWindow):
+	IS_TEST = net.IsTest()
+
+	def __init__(self, stream):
+		# print "NEW LOGIN WINDOW -----------------------------------------------------------------------------"
+		ui.ScriptWindow.__init__(self)
+		net.SetPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
+		net.SetAccountConnectorHandler(self)
+
+		self.lastLoginTime = 0
+		self.inputDialog = None
+		self.connectingDialog = None
+		self.stream = stream
+		self.isNowCountDown = False
+		self.isStartError = False
+
+		self.xServerBoard = 0
+		self.yServerBoard = 0
+
+		self.loadingImage = None
+
+		self.virtualKeyboard = None
+		self.virtualKeyboardMode = "ALPHABET"
+		self.virtualKeyboardIsUpper = False
+
+		self.timeOutMsg = False;
+
+	def __del__(self):
+		net.ClearPhaseWindow(net.PHASE_WINDOW_LOGIN, self)
+		net.SetAccountConnectorHandler(0)
+		ui.ScriptWindow.__del__(self)
+		# print "---------------------------------------------------------------------------- DELETE LOGIN WINDOW"
+
+	def Open(self):
+		ServerStateChecker.Create(self)
+
+		# print "LOGIN WINDOW OPEN ----------------------------------------------------------------------------"
+
+		self.loginFailureMsgDict = {
+			#"DEFAULT" : localeInfo.LOGIN_FAILURE_UNKNOWN,
+
+			"ALREADY" : localeInfo.LOGIN_FAILURE_ALREAY,
+			"NOID" : localeInfo.LOGIN_FAILURE_NOT_EXIST_ID,
+			"WRONGPWD" : localeInfo.LOGIN_FAILURE_WRONG_PASSWORD,
+			"FULL" : localeInfo.LOGIN_FAILURE_TOO_MANY_USER,
+			"SHUTDOWN" : localeInfo.LOGIN_FAILURE_SHUTDOWN,
+			"REPAIR" : localeInfo.LOGIN_FAILURE_REPAIR_ID,
+			"BLOCK" : localeInfo.LOGIN_FAILURE_BLOCK_ID,
+			#"WRONGMAT" : localeInfo.LOGIN_FAILURE_WRONG_MATRIX_CARD_NUMBER,
+			"QUIT" : localeInfo.LOGIN_FAILURE_WRONG_MATRIX_CARD_NUMBER_TRIPLE,
+			"BESAMEKEY" : localeInfo.LOGIN_FAILURE_BE_SAME_KEY,
+			"NOTAVAIL" : localeInfo.LOGIN_FAILURE_NOT_AVAIL,
+			"BLKLOGIN" : localeInfo.LOGIN_FAILURE_BLOCK_LOGIN,
+			"WEBBLK" : localeInfo.LOGIN_FAILURE_WEB_BLOCK,
+			#"BADSCLID" : localeInfo.LOGIN_FAILURE_WRONG_SOCIALID,
+			#"AGELIMIT" : localeInfo.LOGIN_FAILURE_SHUTDOWN_TIME,
+			#"LOCKED" : localeInfo.LOGIN_FAILURE_LOCKED,
+			"BACKENDERR" : localeInfo.LOGIN_FAILURE_BACKEND_ERR,
+			"INTEGRTING" : localeInfo.LOGIN_FAILURE_INTEGRTING,
+			"COUNTRYERR" : localeInfo.LOGIN_FAILURE_COUNTRY_ERR,
+			"IOVATION" : localeInfo.LOGIN_FAILURE_IOVATION_ERR,
+			"TNTERR" : localeInfo.LOGIN_FAILURE_TNT_SESSION,
+			"SERVER_CLOSED" : localeInfo.LOGIN_FAILURE_SERVER_CLOSED,
+			"SERVER_GRADE" : localeInfo.LOGIN_FAILURE_SERVER_GRADE,
+		}
+
+		self.loginFailureFuncDict = {
+			"WRONGPWD" : self.__DisconnectAndInputPassword,
+			#"WRONGMAT" : self.__DisconnectAndInputMatrix,
+			"QUIT" : app.Exit,
+		}
+
+		if localeInfo.IsEUROPE():
+			self.loginFailureMsgDict["CONFIRM"] = localeInfo.LOGIN_FAILURE_NOT_MAIL_CONFIRM
+
+		self.SetSize(wndMgr.GetScreenWidth(), wndMgr.GetScreenHeight())
+		self.SetWindowName("LoginWindow")
+
+		if not self.__LoadScript(uiScriptLocale.LOCALE_COMMON_UISCRIPT_PATH + "LoginWindow.py"):
+			dbg.TraceError("LoginWindow.Open - __LoadScript Error")
+			return
+
+		self.__LoadLoginInfo("loginInfo.xml")
+
+		'''
+		if debugInfo.IsDebugMode():
+			self.__LoadLoginFile("loginInfo.py")
+		'''
+
+		if app.loggined:
+			self.loginFailureFuncDict = {
+				"WRONGPWD" : app.Exit,
+				#"WRONGMAT" : app.Exit,
+				"QUIT" : app.Exit,
+			}
+
+		if musicInfo.loginMusic != "":
+			snd.SetMusicVolume(systemSetting.GetMusicVolume())
+			snd.FadeInMusic("BGM/"+musicInfo.loginMusic)
+
+		snd.SetSoundVolume(systemSetting.GetSoundVolume())
+
+		# pevent key "[" "]"
+		ime.AddExceptKey(91)
+		ime.AddExceptKey(93)
+
+		self.Show()
+
+		global SKIP_LOGIN_PHASE
+		if SKIP_LOGIN_PHASE:
+			if self.isStartError:
+				self.connectBoard.Hide()
+				self.loginBoard.Hide()
+				self.serverBoard.Hide()
+				self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.__ExitGame)
+				return
+
+			if self.loginInfo:
+				self.serverBoard.Hide()
+			else:
+				self.__RefreshServerList()
+				self.__OpenServerBoard()
+		else:
+			connectingIP = self.stream.GetConnectAddr()
+			if connectingIP:
+				self.__OpenLoginBoard()
+				if IsFullBackImage():
+					self.GetChild("bg1").Hide()
+					self.GetChild("bg2").Show()
+			else:
+				self.__RefreshServerList()
+				self.__OpenServerBoard()
+
+		if app.ENABLE_LEFT_SEAT:
+			if net.IsLeftSeatLogOutState():
+				self.PopupNotifyMessage(localeInfo.LEFT_SEAT_LOGOUT)
+
+		app.ShowCursor()
+
+	def Close(self):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		ServerStateChecker.Initialize(self)
+
+		# print "---------------------------------------------------------------------------- CLOSE LOGIN WINDOW "
+		#
+		# selectMusic  BGM Ç· Î°  Ã¼Å©Ñ´. 
+		#
+		if musicInfo.loginMusic != "" and musicInfo.selectMusic != "":
+			snd.FadeOutMusic("BGM/"+musicInfo.loginMusic)
+
+		## NOTE : idEditLine pwdEditLine ÌºÆ®   Ç¾Ö¾î¼­
+		##		Event  Ê±È­ Ö¾ß¸ Õ´Ï´ - [levites]
+		self.idEditLine.SetTabEvent(0)
+		self.idEditLine.SetReturnEvent(0)
+		self.pwdEditLine.SetReturnEvent(0)
+		self.pwdEditLine.SetTabEvent(0)
+
+		self.connectBoard = None
+		self.loginBoard = None
+		self.idEditLine = None
+		self.pwdEditLine = None
+		self.inputDialog = None
+		self.connectingDialog = None
+		self.loadingImage = None
+
+		self.serverBoard = None
+		self.serverList = None
+		self.channelList = None
+
+		self.VIRTUAL_KEY_ALPHABET_LOWERS = None
+		self.VIRTUAL_KEY_ALPHABET_UPPERS = None
+		self.VIRTUAL_KEY_SYMBOLS = None
+		self.VIRTUAL_KEY_NUMBERS = None
+
+		# VIRTUAL_KEYBOARD_BUG_FIX
+		if self.virtualKeyboard:
+			for keyIndex in xrange(0, VIRTUAL_KEYBOARD_NUM_KEYS+1):
+				key = self.GetChild2("key_%d" % keyIndex)
+				if key:
+					key.SetEvent(None)
+
+			self.GetChild("key_space").SetEvent(None)
+			self.GetChild("key_backspace").SetEvent(None)
+			self.GetChild("key_enter").SetEvent(None)
+			self.GetChild("key_shift").SetToggleDownEvent(None)
+			self.GetChild("key_shift").SetToggleUpEvent(None)
+			self.GetChild("key_at").SetToggleDownEvent(None)
+			self.GetChild("key_at").SetToggleUpEvent(None)
+
+			self.virtualKeyboard = None
+
+		self.KillFocus()
+		self.Hide()
+
+		self.stream.popupWindow.Close()
+		self.loginFailureFuncDict = None
+
+		ime.ClearExceptKey()
+
+		app.HideCursor()
+
+	def __SaveChannelInfo(self):
+		try:
+			file = open("channel.inf", "w")
+			file.write("%d %d %d" % (self.__GetServerID(), self.__GetChannelID(), self.__GetRegionID()))
+		except:
+			print "LoginWindow.__SaveChannelInfo - SaveError"
+
+	def __LoadChannelInfo(self):
+		try:
+			file = open("channel.inf")
+			lines = file.readlines()
+
+			if len(lines) > 0:
+				tokens = lines[0].split()
+
+				selServerID = int(tokens[0])
+				selChannelID = int(tokens[1])
+
+				if len(tokens) == 3:
+					regionID = int(tokens[2])
+
+				return regionID, selServerID, selChannelID
+
+		except:
+			print "LoginWindow.__LoadChannelInfo - OpenError"
+			return -1, -1, -1
+
+	def __ExitGame(self):
+		app.Exit()
+
+	def SetIDEditLineFocus(self):
+		if self.idEditLine != None:
+			self.idEditLine.SetFocus()
+
+	def SetPasswordEditLineFocus(self):
+		if localeInfo.IsEUROPE():
+			if self.idEditLine != None: #0000862: [M2EU] Î±Ã¢ Ë¾ :   None 
+				self.idEditLine.SetText("")
+				self.idEditLine.SetFocus() #0000685: [M2EU] Ìµ/Ð¹È£    :  Ìµ Ä¿  
+
+			if self.pwdEditLine != None: #0000862: [M2EU] Î±Ã¢ Ë¾ :   None 
+				self.pwdEditLine.SetText("")
+		else:
+			if self.pwdEditLine != None:
+				self.pwdEditLine.SetFocus()
+
+	def OnEndCountDown(self):
+		self.isNowCountDown = False
+		if localeInfo.IsBRAZIL():
+			self.timeOutMsg = True
+		else:
+			self.timeOutMsg = False
+		self.OnConnectFailure()
+
+	if app.LOGIN_COUNT_DOWN_UI_MODIFY:
+		def SetNowCountDown(self, value):
+			self.isNowCountDown = value
+
+	def OnConnectFailure(self):
+		if self.isNowCountDown:
+			return
+
+		snd.PlaySound("sound/ui/loginfail.wav")
+
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		if app.loggined:
+			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.__ExitGame)
+		elif self.timeOutMsg:
+			self.PopupNotifyMessage(localeInfo.LOGIN_FAILURE_TIMEOUT, self.SetPasswordEditLineFocus)
+		else:
+			self.PopupNotifyMessage(localeInfo.LOGIN_CONNECT_FAILURE, self.SetPasswordEditLineFocus)
+
+	def OnHandShake(self):
+		if not IsLoginDelay():
+			snd.PlaySound("sound/ui/loginok.wav")
+			self.PopupDisplayMessage(localeInfo.LOGIN_CONNECT_SUCCESS)
+
+	def OnLoginStart(self):
+		if not IsLoginDelay():
+			self.PopupDisplayMessage(localeInfo.LOGIN_PROCESSING)
+
+	def OnLoginFailure(self, error):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		try:
+			loginFailureMsg = self.loginFailureMsgDict[error]
+		except KeyError:
+			loginFailureMsg = localeInfo.LOGIN_FAILURE_UNKNOWN + error
+
+		#0000685: [M2EU] Ìµ/Ð¹È£    :  Ð½ Ä¿  
+		loginFailureFunc = self.loginFailureFuncDict.get(error, self.SetPasswordEditLineFocus)
+
+		if app.loggined:
+			self.PopupNotifyMessage(loginFailureMsg, self.__ExitGame)
+		else:
+			self.PopupNotifyMessage(loginFailureMsg, loginFailureFunc)
+
+		snd.PlaySound("sound/ui/loginfail.wav")
+
+	def __DisconnectAndInputID(self):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		self.SetIDEditLineFocus()
+		net.Disconnect()
+
+	def __DisconnectAndInputPassword(self):
+		if self.connectingDialog:
+			self.connectingDialog.Close()
+		self.connectingDialog = None
+
+		self.SetPasswordEditLineFocus()
+		net.Disconnect()
+
+	def __LoadScript(self, fileName):
+		import dbg
+		try:
+			pyScrLoader = ui.PythonScriptLoader()
+			pyScrLoader.LoadScriptFile(self, fileName)
+		except:
+			import exception
+			exception.Abort("LoginWindow.__LoadScript.LoadObject")
+		try:
+			GetObject = self.GetChild
+			self.serverBoard = GetObject("ServerBoard")
+			self.serverSelectButton = GetObject("ServerSelectButton")
+			self.serverExitButton = GetObject("ServerExitButton")
+			self.connectBoard = GetObject("ConnectBoard")
+			self.loginBoard = GetObject("LoginBoard")
+			self.idEditLine = GetObject("ID_EditLine")
+			self.pwdEditLine = GetObject("Password_EditLine")
+			self.serverInfo = GetObject("ConnectName")
+			self.selectConnectButton = GetObject("SelectConnectButton")
+			self.loginButton = GetObject("LoginButton")
+			self.loginExitButton = GetObject("LoginExitButton")
+
+			if app.ENABLE_SERVER_SELECT_RENEWAL:
+				self.serverList = ServerListBox()
+				self.serverList.SetParent(self.serverBoard)
+
+				if localeInfo.IsARABIC():
+					self.serverList.SetPosition(133, 40)
+					self.serverList.SetSize(232, 103 if serverInfo.SMALL_SERVER_SELECT_LIST else 171)
+					self.serverList.SetTextCenterAlign(0)
+				else:
+					self.serverList.SetPosition(10, 40)
+					self.serverList.SetSize(232, (103 if serverInfo.SMALL_SERVER_SELECT_LIST else 171) + 180)
+					self.serverList.SetTextCenterAlign(0)
+					self.serverList.SetRowCount(15)
+				self.serverList.Show()
+
+				self.channelList = ChannelListBox()
+				self.channelList.SetParent(self.serverBoard)
+
+				if localeInfo.IsARABIC():
+					self.channelList.SetPosition(10, 40)
+					self.channelList.SetSize(109, 112 if serverInfo.SMALL_SERVER_SELECT_LIST else 180)
+					self.channelList.SetTextCenterAlign(0)
+				else:
+					self.channelList.SetPosition(255, 40)
+					self.channelList.SetSize(109, 103 if serverInfo.SMALL_SERVER_SELECT_LIST else 171)
+					self.channelList.SetTextCenterAlign(0)
+				self.channelList.Show()
+			else:
+				self.serverList = GetObject("ServerList")
+				self.channelList = GetObject("ChannelList")
+
+			if localeInfo.IsVIETNAM():
+				self.checkButton = GetObject("CheckButton")
+				self.checkButton.Down()
+
+			self.virtualKeyboard = self.GetChild2("VirtualKeyboard")
+
+			if self.virtualKeyboard:
+				self.VIRTUAL_KEY_ALPHABET_UPPERS = Suffle(localeInfo.VIRTUAL_KEY_ALPHABET_UPPERS)
+				self.VIRTUAL_KEY_ALPHABET_LOWERS = "".join([localeInfo.VIRTUAL_KEY_ALPHABET_LOWERS[localeInfo.VIRTUAL_KEY_ALPHABET_UPPERS.index(e)] for e in self.VIRTUAL_KEY_ALPHABET_UPPERS])
+				if localeInfo.IsBRAZIL():
+					self.VIRTUAL_KEY_SYMBOLS_BR = Suffle(localeInfo.VIRTUAL_KEY_SYMBOLS_BR)
+				else:
+					self.VIRTUAL_KEY_SYMBOLS = Suffle(localeInfo.VIRTUAL_KEY_SYMBOLS)
+				self.VIRTUAL_KEY_NUMBERS = Suffle(localeInfo.VIRTUAL_KEY_NUMBERS)
+				self.__VirtualKeyboard_SetAlphabetMode()
+
+				self.GetChild("key_space").SetEvent(lambda : self.__VirtualKeyboard_PressKey(' '))
+				self.GetChild("key_backspace").SetEvent(lambda : self.__VirtualKeyboard_PressBackspace())
+				self.GetChild("key_enter").SetEvent(lambda : self.__VirtualKeyboard_PressReturn())
+				self.GetChild("key_shift").SetToggleDownEvent(lambda : self.__VirtualKeyboard_SetUpperMode())
+				self.GetChild("key_shift").SetToggleUpEvent(lambda : self.__VirtualKeyboard_SetLowerMode())
+				self.GetChild("key_at").SetToggleDownEvent(lambda : self.__VirtualKeyboard_SetSymbolMode())
+				self.GetChild("key_at").SetToggleUpEvent(lambda : self.__VirtualKeyboard_SetAlphabetMode())
+
+		except:
+			import exception
+			exception.Abort("LoginWindow.__LoadScript.BindObject")
+
+		if self.IS_TEST:
+			self.selectConnectButton.Hide()
+		else:
+			self.selectConnectButton.SetEvent(ui.__mem_func__(self.__OnClickSelectConnectButton))
+
+		self.serverBoard.OnKeyUp = ui.__mem_func__(self.__ServerBoard_OnKeyUp)
+		self.xServerBoard, self.yServerBoard = self.serverBoard.GetLocalPosition()
+
+		self.serverSelectButton.SetEvent(ui.__mem_func__(self.__OnClickSelectServerButton))
+		self.serverExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitButton))
+
+		self.loginButton.SetEvent(ui.__mem_func__(self.__OnClickLoginButton))
+		self.loginExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitButton))
+
+		self.serverList.SetEvent(ui.__mem_func__(self.__OnSelectServer))
+
+		self.idEditLine.SetReturnEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
+		self.idEditLine.SetTabEvent(ui.__mem_func__(self.pwdEditLine.SetFocus))
+
+		self.pwdEditLine.SetReturnEvent(ui.__mem_func__(self.__OnClickLoginButton))
+		self.pwdEditLine.SetTabEvent(ui.__mem_func__(self.idEditLine.SetFocus))
+
+		if IsFullBackImage():
+			self.GetChild("bg1").Show()
+			self.GetChild("bg2").Hide()
+
+		return 1
+
+	def __VirtualKeyboard_SetKeys(self, keyCodes):
+		uiDefFontBackup = localeInfo.UI_DEF_FONT
+		localeInfo.UI_DEF_FONT = localeInfo.UI_DEF_FONT_LARGE
+
+		keyIndex = 1
+		for keyCode in keyCodes:
+			key = self.GetChild2("key_%d" % keyIndex)
+			if key:
+				key.SetEvent(lambda x=keyCode: self.__VirtualKeyboard_PressKey(x))
+				key.SetText(keyCode)
+				key.ButtonText.SetFontColor(0, 0, 0)
+				keyIndex += 1
+
+		for keyIndex in xrange(keyIndex, VIRTUAL_KEYBOARD_NUM_KEYS+1):
+			key = self.GetChild2("key_%d" % keyIndex)
+			if key:
+				key.SetEvent(lambda x=' ': self.__VirtualKeyboard_PressKey(x))
+				key.SetText(' ')
+
+		localeInfo.UI_DEF_FONT = uiDefFontBackup
+
+	def __VirtualKeyboard_PressKey(self, code):
+		ime.PasteString(code)
+
+		# if self.virtualKeyboardMode == "ALPHABET" and self.virtualKeyboardIsUpper:
+			# self.__VirtualKeyboard_SetLowerMode()
+
+	def __VirtualKeyboard_PressBackspace(self):
+		ime.PasteBackspace()
+
+	def __VirtualKeyboard_PressReturn(self):
+		ime.PasteReturn()
+
+	def __VirtualKeyboard_SetUpperMode(self):
+		self.virtualKeyboardIsUpper = True
+
+		if self.virtualKeyboardMode == "ALPHABET":
+			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_ALPHABET_UPPERS)
+		elif self.virtualKeyboardMode == "NUMBER":
+			if localeInfo.IsBRAZIL():
+				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS_BR)
+			else:
+				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS)
+		else:
+			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_NUMBERS)
+
+	def __VirtualKeyboard_SetLowerMode(self):
+		self.virtualKeyboardIsUpper = False
+
+		if self.virtualKeyboardMode == "ALPHABET":
+			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_ALPHABET_LOWERS)
+		elif self.virtualKeyboardMode == "NUMBER":
+			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_NUMBERS)
+		else:
+			if localeInfo.IsBRAZIL():
+				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS_BR)
+			else:
+				self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS)
+
+	def __VirtualKeyboard_SetAlphabetMode(self):
+		self.virtualKeyboardIsUpper = False
+		self.virtualKeyboardMode = "ALPHABET"
+		self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_ALPHABET_LOWERS)
+
+	def __VirtualKeyboard_SetNumberMode(self):
+		self.virtualKeyboardIsUpper = False
+		self.virtualKeyboardMode = "NUMBER"
+		self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_NUMBERS)
+
+	def __VirtualKeyboard_SetSymbolMode(self):
+		self.virtualKeyboardIsUpper = False
+		self.virtualKeyboardMode = "SYMBOL"
+		if localeInfo.IsBRAZIL():
+			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS_BR)
+		else:
+			self.__VirtualKeyboard_SetKeys(self.VIRTUAL_KEY_SYMBOLS)
+
+	def Connect(self, id, pwd):
+		if app.ENABLE_SERVER_SELECT_RENEWAL:
+			regionID = self.__GetRegionID()
+			serverID = self.__GetServerID()
+			channelID = self.__GetChannelID()
+
+			if (serverInfo.REGION_DICT.has_key(regionID)) and (serverInfo.REGION_DICT[regionID].has_key(serverID)):
+				try:
+					channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
+				except KeyError:
+					return
+
+				try:
+					state = channelDict[channelID]["state"]
+				except KeyError:
+					self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_CHANNEL)
+					return
+
+				# Â° CLOSED   
+				tokens = serverInfo.REGION_DICT[regionID][serverID].get("state", "NONE").split("|")
+				is_server_closed = False
+
+				for idx in xrange(len(tokens)):
+					if tokens[idx].strip() == "CLOSE":
+						is_server_closed = True
+
+				if is_server_closed == True:
+					self.PopupNotifyMessage(localeInfo.SERVER_NOTIFY_CLOSED)
+					return
+
+				# Â° FULL    
+				if state == serverInfo.STATE_DICT[len(serverInfo.STATE_DICT) - 1]:
+					self.PopupNotifyMessage(localeInfo.CHANNEL_NOTIFY_FULL)
+					return
+
+		if constInfo.SEQUENCE_PACKET_ENABLE:
+			net.SetPacketSequenceMode()
+
+		if IsLoginDelay():
+			loginDelay = GetLoginDelay()
+			self.connectingDialog = ConnectingDialog()
+			self.connectingDialog.Open(loginDelay)
+			self.connectingDialog.SAFE_SetTimeOverEvent(self.OnEndCountDown)
+			self.connectingDialog.SAFE_SetExitEvent(self.OnPressExitKey)
+			self.isNowCountDown = True
+		else:
+			self.stream.popupWindow.Close()
+			self.stream.popupWindow.Open(localeInfo.LOGIN_CONNETING, self.SetPasswordEditLineFocus, localeInfo.UI_CANCEL)
+
+		self.stream.SetLoginInfo(id, pwd)
+		if app.LOGIN_COUNT_DOWN_UI_MODIFY:
+			connect_result = self.stream.Connect()
+			if not connect_result:
+				self.isNowCountDown = False
+		else:
+			self.stream.Connect()
+
+	def __OnClickExitButton(self):
+		self.stream.SetPhaseWindow(0)
+
+	def __SetServerInfo(self, name):
+		net.SetServerInfo(name.strip())
+		self.serverInfo.SetText(name)
+
+	def __LoadLoginInfo(self, loginInfoFileName):
+		def getValue(element, name, default):
+			if [] != element.getElementsByTagName(name):
+				return element.getElementsByTagName(name).item(0).firstChild.nodeValue
+			else:
+				return default
+
+		self.id = None
+		self.pwd = None
+		self.loginnedServer = None
+		self.loginnedChannel = None
+		app.loggined = False
+
+		self.loginInfo = True
+
+		from xml.dom.minidom import parse
+		try:
+			f = open(loginInfoFileName, "r")
+			dom = parse(f)
+		except:
+			return
+		serverLst = dom.getElementsByTagName("server")
+		if [] != dom.getElementsByTagName("logininfo"):
+			logininfo = dom.getElementsByTagName("logininfo")[0]
+		else:
+			return
+
+		try:
+			server_name = logininfo.getAttribute("name")
+			channel_idx = int(logininfo.getAttribute("channel_idx"))
+		except:
+			return
+
+		try:
+			matched = False
+
+			for k, v in serverInfo.REGION_DICT[0].iteritems():
+				if v["name"] == server_name:
+					account_addr = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["ip"]
+					account_port = serverInfo.REGION_AUTH_SERVER_DICT[0][k]["port"]
+
+					channel_info = v["channel"][channel_idx]
+					channel_name = channel_info["name"]
+					addr = channel_info["ip"]
+					port = channel_info["tcp_port"]
+
+					net.SetMarkServer(addr, port)
+					self.stream.SetConnectInfo(addr, port, account_addr, account_port)
+
+					matched = True
+					break
+
+			if False == matched:
+				return
+		except:
+			return
+
+		if app.ENABLE_MOVE_CHANNEL:
+			self.serverInfo.SetText("%s, %s " % (server_name, channel_name))
+		else:
+			self.__SetServerInfo("%s, %s " % (server_name, channel_name))
+
+		id = getValue(logininfo, "id", "")
+		pwd = getValue(logininfo, "pwd", "")
+		self.idEditLine.SetText(id)
+		self.pwdEditLine.SetText(pwd)
+		slot = getValue(logininfo, "slot", "0")
+		locale = getValue(logininfo, "locale", "")
+		locale_dir = getValue(logininfo, "locale_dir", "")
+		is_auto_login = int(getValue(logininfo, "auto_login", "0"))
+
+		self.stream.SetCharacterSlot(int(slot))
+		self.stream.isAutoLogin = is_auto_login
+		self.stream.isAutoSelect = is_auto_login
+
+		if locale and locale_dir:
+			app.ForceSetLocale(locale, locale_dir)
+
+		if 0 != is_auto_login:
+			self.Connect(id, pwd)
+
+	'''
+	if debugInfo.IsDebugMode():
+		def __LoadLoginFile(self, loginInfoFileName):
+			try:
+				loginInfo = {}
+				execfile(loginInfoFileName, loginInfo)
+			except IOError:
+				print(\
+					"Úµ Î± Ï½Ã·" + loginInfoFileName + " Û¼Ö¼\n"\
+					"\n"\
+					":\n"\
+					"================================================================\n"
+				);
+
+			self.id = None
+			self.pwd = None
+			self.loginnedServer = None
+			self.loginnedChannel = None
+			app.loggined = False
+
+			self.loginInfo = loginInfo
+	'''
+
+	def PopupDisplayMessage(self, msg):
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(msg)
+
+	def PopupNotifyMessage(self, msg, func = 0):
+		if not func:
+			func = self.EmptyFunc
+
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(msg, func, localeInfo.UI_OK)
+
+	def __OnCloseInputDialog(self):
+		if self.inputDialog:
+			self.inputDialog.Close()
+		self.inputDialog = None
+		return True
+
+	def OnPressExitKey(self):
+		self.stream.popupWindow.Close()
+		self.stream.SetPhaseWindow(0)
+		return True
+
+	def OnExit(self):
+		self.stream.popupWindow.Close()
+
+	def OnUpdate(self):
+		ServerStateChecker.Update()
+
+	def EmptyFunc(self):
+		pass
+
+	#####################################################################################
+
+	def __ServerBoard_OnKeyUp(self, key):
+		if self.serverBoard.IsShow():
+			if app.DIK_RETURN==key:
+				self.__OnClickSelectServerButton()
+		return True
+
+	def __GetRegionID(self):
+		return 0
+
+	def __GetServerID(self):
+		return self.serverList.GetSelectedItem()
+
+	def __GetChannelID(self):
+		return self.channelList.GetSelectedItem()
+
+	# SEVER_LIST_BUG_FIX
+	def __ServerIDToServerIndex(self, regionID, targetServerID):
+		try:
+			regionDict = serverInfo.REGION_DICT[regionID]
+		except KeyError:
+			return -1
+
+		retServerIndex = 0
+		for eachServerID, regionDataDict in regionDict.items():
+			if eachServerID == targetServerID:
+				return retServerIndex
+
+			retServerIndex += 1
+
+		return -1
+
+	def __ChannelIDToChannelIndex(self, channelID):
+		return channelID - 1
+	# END_OF_SEVER_LIST_BUG_FIX
+
+	def __OpenServerBoard(self):
+		loadRegionID, loadServerID, loadChannelID = self.__LoadChannelInfo()
+
+		serverIndex = self.__ServerIDToServerIndex(loadRegionID, loadServerID)
+		channelIndex = self.__ChannelIDToChannelIndex(loadChannelID)
+
+		# Å±   .
+		if app.ENABLE_SERVER_SELECT_RENEWAL and serverIndex == -1: # Ãµ    Å± Ç´
+			newIdx = serverInfo.SERVER_STATE_DICT.get("NEW", 0)
+			specialIdx = serverInfo.SERVER_STATE_DICT.get("SPECIAL", 0)
+			closeIdx = serverInfo.SERVER_STATE_DICT.get("CLOSE", 0)
+			standbyIdx = serverInfo.SERVER_STATE_DICT.get("STANDBY", 0)
+			serverSelect1st = -1;
+			serverSelect2nd = -1;
+			serverSelect3rd = -1;
+			serverSelect4th = -1;
+
+			for idx in xrange(self.serverList.GetItemCount()):
+				(state, state2) = self.serverList.GetState(idx)
+				if state == newIdx or state2 == newIdx: # 1 NEW Ñ´.
+					serverSelect1st = idx
+					break
+				elif serverSelect2nd == -1 and (state == specialIdx or state2 == specialIdx): # 2 SPECIAL Ñ´.
+					serverSelect2nd = idx
+				elif serverSelect3rd == -1 and (state != closeIdx and state2 != closeIdx): # 3 Ó°   Ö».
+					serverSelect3rd = idx
+				elif serverSelect4th == -1 and (state != standbyIdx and state2 != standbyIdx):
+					serverSelect4th = idx
+
+			if serverSelect1st != -1:
+				serverIndex = serverSelect1st
+			elif serverSelect2nd != -1:
+				serverIndex = serverSelect2nd
+			elif serverSelect3rd != -1:
+				serverIndex = serverSelect3rd
+			elif serverSelect4th != -1:
+				serverIndex = serverSelect4th
+
+		self.serverList.SelectItem(serverIndex)
+
+		if localeInfo.IsEUROPE():
+			if app.ENABLE_NEW_USER_CARE:
+				self.channelList.SelectItem(channelIndex)
+			else:
+				self.channelList.SelectItem(app.GetRandom(0, self.channelList.GetItemCount()))
+		else:
+			if channelIndex >= 0:
+				self.channelList.SelectItem(channelIndex)
+
+		## Show/Hide Úµå¿¡  Ö¾î¼­ Ó½ - [levites]
+		self.serverBoard.SetPosition(self.xServerBoard, self.yServerBoard)
+		self.serverBoard.Show()
+		self.connectBoard.Hide()
+		self.loginBoard.Hide()
+
+		if self.virtualKeyboard:
+			self.virtualKeyboard.Hide()
+
+		if app.loggined and not SKIP_LOGIN_PHASE_SUPPORT_CHANNEL:
+			self.serverList.SelectItem(self.loginnedServer - 1)
+			self.channelList.SelectItem(self.loginnedChannel - 1)
+			self.__OnClickSelectServerButton()
+
+	def __OpenLoginBoard(self):
+		self.serverExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitServerButton))
+		self.serverExitButton.SetText(localeInfo.UI_CLOSE)
+
+		self.serverBoard.SetPosition(self.xServerBoard, wndMgr.GetScreenHeight())
+		self.serverBoard.Hide()
+
+		if self.virtualKeyboard:
+			self.virtualKeyboard.Show()
+
+		if app.loggined:
+			self.Connect(self.id, self.pwd)
+			self.connectBoard.Hide()
+			self.loginBoard.Hide()
+		elif not self.stream.isAutoLogin:
+			self.connectBoard.Show()
+			self.loginBoard.Show()
+
+		## if users have the login infomation, then don't initialize.2005.9 haho
+		if self.idEditLine == None:
+			self.idEditLine.SetText("")
+		if self.pwdEditLine == None:
+			self.pwdEditLine.SetText("")
+
+		self.idEditLine.SetFocus()
+
+		global SKIP_LOGIN_PHASE
+		if SKIP_LOGIN_PHASE:
+			if not self.loginInfo:
+				self.connectBoard.Hide()
+
+	def __OnSelectRegionGroup(self):
+		self.__RefreshServerList()
+
+	def __OnSelectSettlementArea(self):
+		# SEVER_LIST_BUG_FIX
+		regionID = self.__GetRegionID()
+		serverID = self.serverListOnRegionBoard.GetSelectedItem()
+
+		serverIndex = self.__ServerIDToServerIndex(regionID, serverID)
+		self.serverList.SelectItem(serverIndex)
+		# END_OF_SEVER_LIST_BUG_FIX
+
+		self.__OnSelectServer()
+
+	def __RefreshServerList(self):
+		regionID = self.__GetRegionID()
+
+		if not serverInfo.REGION_DICT.has_key(regionID):
+			return
+
+		self.serverList.ClearItem()
+
+		regionDict = serverInfo.REGION_DICT[regionID]
+
+		# SEVER_LIST_BUG_FIX
+		visible_index = 1
+		if app.ENABLE_SERVER_SELECT_RENEWAL:
+			for id, regionDataDict in regionDict.items():
+				name = regionDataDict.get("name", "noname")
+				state = 0
+				state2 = 0
+				flag = regionDataDict.get("flag", "ALL")
+
+				tokens = regionDataDict.get("state", "NONE").split("|")
+				if len(tokens) == 1:
+					state = serverInfo.SERVER_STATE_DICT.get(tokens[0].strip(), 0)
+				elif len(tokens) == 2:
+					state = serverInfo.SERVER_STATE_DICT.get(tokens[0].strip(), 0)
+					state2 = serverInfo.SERVER_STATE_DICT.get(tokens[1].strip(), 0)
+
+				if localeInfo.IsBRAZIL() or localeInfo.IsCANADA():
+					self.serverList.InsertItem(id, "%s" % (name))
+				else:
+					if localeInfo.IsCIBN10():
+						if name[0] == "#":
+							self.serverList.InsertItem(-1, "  %s" % (name[1:]), 1)
+						else:
+							self.serverList.InsertItem(id, "  %s" % (name), 2)
+							visible_index += 1
+					else:
+						try:
+							server_id = serverInfo.SERVER_ID_DICT[id]
+						except:
+							server_id = visible_index
+
+						self.serverList.InsertItem(id, "  %s" % (name), state, state2, flag) #     .
+						# self.serverList.InsertItem(id, "  %02d. %s" % (int(server_id), name), state, state2, locale) #     .
+						#self.serverList.InsertItem(id, "  %s" % (name), state, state2)	#     .
+
+						visible_index += 1
+		else:
+			for id, regionDataDict in regionDict.items():
+				name = regionDataDict.get("name", "noname")
+				if localeInfo.IsBRAZIL() or localeInfo.IsCANADA():
+					self.serverList.InsertItem(id, "%s" % (name))
+				else:
+					if localeInfo.IsCIBN10():
+						if name[0] == "#":
+							self.serverList.InsertItem(-1, "  %s" % (name[1:]))
+						else:
+							self.serverList.InsertItem(id, "  %s" % (name))
+							visible_index += 1
+					else:
+						try:
+							server_id = serverInfo.SERVER_ID_DICT[id]
+						except:
+							server_id = visible_index
+
+						self.serverList.InsertItem(id, "  %02d. %s" % (int(server_id), name))
+
+						visible_index += 1
+		# END_OF_SEVER_LIST_BUG_FIX
+
+	def __OnSelectServer(self):
+		self.__OnCloseInputDialog()
+		self.__RequestServerStateList()
+		self.__RefreshServerStateList()
+
+	def __RequestServerStateList(self):
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+
+		try:
+			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
+		except:
+			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
+			return
+
+		ServerStateChecker.Initialize();
+		# ServerStateChecker.SetAuth(serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["ip"], serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["port"])
+		for id, channelDataDict in channelDict.items():
+			key = channelDataDict["key"]
+			ip = channelDataDict["ip"]
+			udp_port = channelDataDict["udp_port"]
+			ServerStateChecker.AddChannel(key, ip, udp_port)
+
+		ServerStateChecker.Request()
+
+	def __RefreshServerStateList(self):
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+		bakChannelID = self.channelList.GetSelectedItem()
+
+		self.channelList.ClearItem()
+
+		try:
+			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
+		except:
+			print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
+			return
+
+		for channelID, channelDataDict in channelDict.items():
+			channelName = channelDataDict["name"]
+			channelState = channelDataDict["state"]
+			if app.ENABLE_SERVER_SELECT_RENEWAL:
+				channelStateColor = serverInfo.STATE_COLOR_DICT[channelState]
+				self.channelList.InsertItem(channelID, " %s" % channelName, " %s" % channelState, channelStateColor)
+			elif app.ENABLE_CHANNEL_LIST:
+				channelStateColor = serverInfo.STATE_COLOR_DICT[channelState]
+				self.channelList.InsertItem(channelID, " %s %s" % (channelName, channelState), channelStateColor)
+			else:
+				self.channelList.InsertItem(channelID, " %s %s" % (channelName, channelState))
+
+		self.channelList.SelectItem(bakChannelID - 1)
+
+	if app.ENABLE_CHANNEL_LIST or app.ENABLE_SERVER_SELECT_RENEWAL:
+		def AutoSelectChannel(self):
+			regionID = self.__GetRegionID()
+			serverID = self.__GetServerID()
+			bakChannelID = self.channelList.GetSelectedItem()
+
+			try:
+				channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
+			except:
+				print " __RequestServerStateList - serverInfo.REGION_DICT(%d, %d)" % (regionID, serverID)
+				return
+
+			if bakChannelID>len(channelDict):
+				bakChannelID = 0
+
+			if app.ENABLE_SERVER_SELECT_RENEWAL:
+				if bakChannelID > 0:
+					self.channelList.SelectItem(bakChannelID - 1)
+					return
+
+				mostID = 0
+				most = 0
+				secondMostID = 0
+				secondMost = 0
+
+				for channelID, channelDataDict in channelDict.items():
+					channelState = serverInfo.STATE_REVERSE_DICT.get(channelDataDict["state"], 0)
+
+					if mostID == 0:
+						mostID = channelID
+						most = channelState
+					elif channelState > most:
+						secondMostID = mostID
+						secondMost = most
+						mostID = channelID
+						most = channelState
+					elif secondMostID == 0 or channelState > secondMost:
+						secondMostID = channelID
+						secondMost = channelState
+
+				if secondMost <= serverInfo.STATE_REVERSE_DICT.get("Vacant", 2):
+					self.channelList.SelectItem(mostID - 1)
+				else:
+					self.channelList.SelectItem(secondMostID - 1)
+			else:
+				AvailableChannelID = 0
+				BusyChannelID = 0
+
+				for channelID, channelDataDict in channelDict.items():
+					channelState = channelDataDict["state"]
+
+					if AvailableChannelID == 0 and channelState == serverInfo.STATE_DICT[1]:
+						AvailableChannelID = channelID
+
+					if BusyChannelID == 0 and channelState == serverInfo.STATE_DICT[2]:
+						BusyChannelID = channelID
+
+					# Â° FULLÌ³ OFFLINEÌ¸ Ù¸ Ã¤ Ïµ 
+					if bakChannelID == channelID and (channelState == serverInfo.STATE_DICT[0] or channelState == serverInfo.STATE_DICT[3]):
+						bakChannelID = 0
+
+				if bakChannelID == 0:
+					if AvailableChannelID != 0:
+						self.channelList.SelectItem(AvailableChannelID - 1)
+					elif BusyChannelID != 0:
+						self.channelList.SelectItem(BusyChannelID - 1)
+					else:
+						self.channelList.SelectItem(0)
+				else:
+					self.channelList.SelectItem(bakChannelID - 1)
+
+	def __GetChannelName(self, regionID, selServerID, selChannelID):
+		try:
+			return serverInfo.REGION_DICT[regionID][selServerID]["channel"][selChannelID]["name"]
+		except KeyError:
+			if 9 == selChannelID:
+				return localeInfo.CHANNEL_PVP
+			else:
+				return localeInfo.CHANNEL_NORMAL % (selChannelID)
+
+	def NotifyChannelState(self, addrKey, state):
+		try:
+			stateName = serverInfo.STATE_DICT[state]
+		except:
+			stateName = serverInfo.STATE_NONE
+
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+		channelID = addrKey % 10
+
+		try:
+			serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["state"] = stateName
+			self.__RefreshServerStateList()
+
+		except:
+			import exception
+			exception.Abort(localeInfo.CHANNEL_NOT_FIND_INFO)
+
+	def __OnClickExitServerButton(self):
+		print "exit server"
+		self.__OpenLoginBoard()
+
+		if IsFullBackImage():
+			self.GetChild("bg1").Hide()
+			self.GetChild("bg2").Show()
+
+	def __OnClickSelectRegionButton(self):
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+
+		if (not serverInfo.REGION_DICT.has_key(regionID)):
+			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_REGION)
+			return
+
+		if (not serverInfo.REGION_DICT[regionID].has_key(serverID)):
+			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_SERVER)
+			return
+
+		self.__SaveChannelInfo()
+
+		self.serverExitButton.SetEvent(ui.__mem_func__(self.__OnClickExitServerButton))
+		self.serverExitButton.SetText(localeInfo.UI_CLOSE)
+
+		self.__RefreshServerList()
+		self.__OpenServerBoard()
+
+	def __OnClickSelectServerButton(self):
+		if IsFullBackImage():
+			self.GetChild("bg1").Hide()
+			self.GetChild("bg2").Show()
+
+		regionID = self.__GetRegionID()
+		serverID = self.__GetServerID()
+		channelID = self.__GetChannelID()
+
+		if (not serverInfo.REGION_DICT.has_key(regionID)):
+			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_REGION)
+			return
+
+		if (not serverInfo.REGION_DICT[regionID].has_key(serverID)):
+			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_SERVER)
+			return
+
+		try:
+			channelDict = serverInfo.REGION_DICT[regionID][serverID]["channel"]
+		except KeyError:
+			return
+
+		try:
+			state = channelDict[channelID]["state"]
+		except KeyError:
+			self.PopupNotifyMessage(localeInfo.CHANNEL_SELECT_CHANNEL)
+			return
+
+		if app.ENABLE_SERVER_SELECT_RENEWAL:
+			tokens = serverInfo.REGION_DICT[regionID][serverID].get("state", "NONE").split("|")
+			is_server_closed = False
+
+			for idx in xrange(len(tokens)):
+				if tokens[idx].strip() == "CLOSE":
+					is_server_closed = True
+
+			# Â° CLOSED  
+			if is_server_closed == True:
+				self.PopupNotifyMessage(localeInfo.SERVER_NOTIFY_CLOSED)
+				return
+
+			# Â° FULL    
+			if state == serverInfo.STATE_DICT[len(serverInfo.STATE_DICT) - 1]:
+				self.PopupNotifyMessage(localeInfo.CHANNEL_NOTIFY_FULL)
+				return
+		else:
+			# Â° FULL    
+			if state == serverInfo.STATE_DICT[3]:
+				self.PopupNotifyMessage(localeInfo.CHANNEL_NOTIFY_FULL)
+				return
+
+		self.__SaveChannelInfo()
+
+		try:
+			serverName = serverInfo.REGION_DICT[regionID][serverID]["name"]
+			channelName = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["name"]
+			addrKey = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["key"]
+
+			if "Ãµ " == serverName:
+				app.ForceSetLocale("ymir", "locale/ymir")
+			elif "èµµ " == serverName:
+				app.ForceSetLocale("we_korea", "locale/we_korea")
+
+		except:
+			print " ERROR __OnClickSelectServerButton(%d, %d, %d)" % (regionID, serverID, channelID)
+			serverName = localeInfo.CHANNEL_EMPTY_SERVER
+			channelName = localeInfo.CHANNEL_NORMAL % channelID
+
+		self.__SetServerInfo("%s, %s " % (serverName, channelName))
+
+		try:
+			ip = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["ip"]
+			tcp_port = serverInfo.REGION_DICT[regionID][serverID]["channel"][channelID]["tcp_port"]
+		except:
+			import exception
+			exception.Abort("LoginWindow.__OnClickSelectServerButton -   ")
+
+		try:
+			account_ip = serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["ip"]
+			account_port = serverInfo.REGION_AUTH_SERVER_DICT[regionID][serverID]["port"]
+		except:
+			account_ip = 0
+			account_port = 0
+
+		try:
+			markKey = regionID * 1000 + serverID * 10
+			markAddrValue=serverInfo.MARKADDR_DICT[markKey]
+			print("MarkAddrValue %s" % str(markKey))
+			net.SetMarkServer(markAddrValue["ip"], markAddrValue["tcp_port"])
+			app.SetGuildMarkPath(markAddrValue["mark"])
+			# GUILD_SYMBOL
+			app.SetGuildSymbolPath(markAddrValue["symbol_path"])
+			# END_OF_GUILD_SYMBOL
+
+		except:
+			import exception
+			exception.Abort("LoginWindow.__OnClickSelectServerButton - Å©  ")
+
+		self.stream.SetConnectInfo(ip, tcp_port, account_ip, account_port)
+		print("SetConnectInfo %s, %s, %s, %s" % (str(ip), str(tcp_port), str(account_ip), str(account_port)))
+		self.__OpenLoginBoard()
+
+	def __OnClickSelectConnectButton(self):
+		if IsFullBackImage():
+			self.GetChild("bg1").Show()
+			self.GetChild("bg2").Hide()
+
+		self.__RefreshServerList()
+		self.__OpenServerBoard()
+
+	def __OnClickLoginButton(self):
+		id = self.idEditLine.GetText()
+		pwd = self.pwdEditLine.GetText()
+
+		if len(id) == 0:
+			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_ID, self.SetIDEditLineFocus)
+			return
+
+		if len(pwd) == 0:
+			self.PopupNotifyMessage(localeInfo.LOGIN_INPUT_PASSWORD, self.SetPasswordEditLineFocus)
+			return
+
+		self.Connect(id, pwd)
+
+	def SameLogin_OpenUI(self):
+		self.stream.popupWindow.Close()
+		self.stream.popupWindow.Open(localeInfo.LOGIN_FAILURE_SAMELOGIN, 0, localeInfo.UI_OK)
diff --git a/client/pack/root/servercommandparser.py b/client/pack/root/servercommandparser.py
index d66ea55..9061480 100644
--- a/client/pack/root/servercommandparser.py
+++ b/client/pack/root/servercommandparser.py
@@ -1,109 +1,120 @@
-import net
-import background
-import stringCommander
-import constInfo
-import app
-
-class ServerCommandParser(object):
-	def __init__(self):
-		net.SetServerCommandParserWindow(self)
-		self.__ServerCommand_Build()
-
-	def __ServerCommand_Build(self):
-		serverCommandList = {
-			"DayMode" : self.__DayMode_Update,
-			"xmas_snow" : self.__XMasSnow_Enable,
-			"xmas_boom" : self.__XMasBoom_Enable,
-			"xmas_tree" : self.__XMasTree_Enable,
-			"newyear_boom" : self.__XMasBoom_Enable,
-			"item_mall" : self.__ItemMall_Open,
-		}
-
-		if app.ENABLE_MINI_GAME_RUMI:
-			serverCommandList["mini_game_okey"] = self.__MiniGameOkeyEvent
-			serverCommandList["mini_game_okey_normal"] = self.__MiniGameOkeyNormalEvent
-
-		if app.ENABLE_POPUP_NOTICE:
-			serverCommandList["PopupNoticeEventFlag"] = self.__SetPopupNoticeEventFlag
-			serverCommandList["PopupNoticeProcess"] = self.__PopupNoticeProcess
-
-		if app.ENABLE_MINI_GAME_YUTNORI:
-			serverCommandList["mini_game_yutnori"] = self.__MiniGameYutnori
-
-		if app.ENABLE_SUMMER_EVENT_ROULETTE:
-			serverCommandList["e_late_summer"] = self.__LateSummerEvent
-
-		if app.ENABLE_SNOWFLAKE_STICK_EVENT:
-			serverCommandList["snowflake_stick_event"] = self.__SnowflakeStickEvent
-
-		if app.ENABLE_FLOWER_EVENT:
-			serverCommandList["e_flower_drop"] = self.__FlowerEvent
-
-		self.serverCommander = stringCommander.Analyzer()
-		for serverCommandItem in serverCommandList.items():
-			self.serverCommander.SAFE_RegisterCallBack(
-				serverCommandItem[0], serverCommandItem[1]
-			)
-
-	def BINARY_ServerCommand_Run(self, line):
-		try:
-			print " BINARY_ServerCommand_Reserve", line
-			return self.serverCommander.Run(line)
-		except RuntimeError, msg:
-			import dbg
-			dbg.TraceError(msg)
-			return 0
-
-	def __PreserveCommand(self, line):
-		net.PreserveServerCommand(line)
-
-	if app.ENABLE_POPUP_NOTICE:
-		def __SetPopupNoticeEventFlag(self, flag_value):
-			self.__PreserveCommand("PopupNoticeEventFlag " + flag_value)
-
-		def __PopupNoticeProcess(self, is_checked, url):
-			self.__PreserveCommand("PopupNoticeProcess %d %s" % (int(is_checked), url))
-
-	def __DayMode_Update(self, mode):
-		self.__PreserveCommand("PRESERVE_DayMode " + mode)
-
-	def __ItemMall_Open(self):
-		self.__PreserveCommand("item_mall")
-
-	## ÀÓ½Ã
-	def __XMasBoom_Enable(self, mode):
-		if "1" == mode:
-			self.__PreserveCommand("PRESERVE_DayMode dark")
-		else:
-			self.__PreserveCommand("PRESERVE_DayMode light")
-
-	def __XMasSnow_Enable(self, mode):
-		self.__PreserveCommand("xmas_snow " + mode)
-
-	def __XMasTree_Enable(self, grade):
-		self.__PreserveCommand("xmas_tree " + grade)
-
-	if app.ENABLE_MINI_GAME_RUMI:
-		def __MiniGameOkeyEvent(self, enable):
-			self.__PreserveCommand("mini_game_okey " + enable)
-
-		def __MiniGameOkeyNormalEvent(self, enable):
-			self.__PreserveCommand("mini_game_okey_normal " + enable)
-
-	if app.ENABLE_MINI_GAME_YUTNORI:
-		def __MiniGameYutnori(self, enable):
-			self.__PreserveCommand("mini_game_yutnori " + enable)
-
-	if app.ENABLE_SUMMER_EVENT_ROULETTE:
-		def __LateSummerEvent(self, enable):
-			self.__PreserveCommand("e_late_summer " + enable)
-
-	if app.ENABLE_SNOWFLAKE_STICK_EVENT:
-		def __SnowflakeStickEvent(self, end_time):
-			self.__PreserveCommand("snowflake_stick_event " + end_time)
-
-	if app.ENABLE_FLOWER_EVENT:
-		def __FlowerEvent(self, enable):
-			self.__PreserveCommand("e_flower_drop " + enable)
-
-parserWnd = ServerCommandParser()
+import net
+import background
+import stringCommander
+import constInfo
+import app
+import re
+
+class ServerCommandParser(object):
+	def __init__(self):
+		net.SetServerCommandParserWindow(self)
+		self.__ServerCommand_Build()
+
+	def __ServerCommand_Build(self):
+		serverCommandList = {
+			"DayMode" : self.__DayMode_Update,
+			"xmas_snow" : self.__XMasSnow_Enable,
+			"xmas_boom" : self.__XMasBoom_Enable,
+			"xmas_tree" : self.__XMasTree_Enable,
+			"newyear_boom" : self.__XMasBoom_Enable,
+			"item_mall" : self.__ItemMall_Open,
+		}
+
+		if app.ENABLE_MINI_GAME_RUMI:
+			serverCommandList["mini_game_okey"] = self.__MiniGameOkeyEvent
+			serverCommandList["mini_game_okey_normal"] = self.__MiniGameOkeyNormalEvent
+
+		if app.ENABLE_POPUP_NOTICE:
+			serverCommandList["PopupNoticeEventFlag"] = self.__SetPopupNoticeEventFlag
+			serverCommandList["PopupNoticeProcess"] = self.__PopupNoticeProcess
+
+		if app.ENABLE_MINI_GAME_YUTNORI:
+			serverCommandList["mini_game_yutnori"] = self.__MiniGameYutnori
+
+		if app.ENABLE_SUMMER_EVENT_ROULETTE:
+			serverCommandList["e_late_summer"] = self.__LateSummerEvent
+
+		if app.ENABLE_SNOWFLAKE_STICK_EVENT:
+			serverCommandList["snowflake_stick_event"] = self.__SnowflakeStickEvent
+
+		if app.ENABLE_FLOWER_EVENT:
+			serverCommandList["e_flower_drop"] = self.__FlowerEvent
+
+		self.serverCommander = stringCommander.Analyzer()
+		for serverCommandItem in serverCommandList.items():
+			self.serverCommander.SAFE_RegisterCallBack(
+				serverCommandItem[0], serverCommandItem[1]
+			)
+
+	def BINARY_ServerCommand_Run(self, line):
+		try:
+			print " BINARY_ServerCommand_Reserve", line
+			return self.serverCommander.Run(line)
+		except RuntimeError, msg:
+			import dbg
+			dbg.TraceError(msg)
+			return 0
+
+	def __PreserveCommand(self, line):
+		net.PreserveServerCommand(line)
+
+	def __IsSafeWebURL(self, url):
+		if not isinstance(url, str):
+			return False
+		u = url.strip()
+		if not u or len(u) > 2048:
+			return False
+		lu = u.lower()
+		return lu.startswith("http://") or lu.startswith("https://")
+
+	if app.ENABLE_POPUP_NOTICE:
+		def __SetPopupNoticeEventFlag(self, flag_value):
+			self.__PreserveCommand("PopupNoticeEventFlag " + flag_value)
+
+		def __PopupNoticeProcess(self, is_checked, url):
+			if self.__IsSafeWebURL(url):
+				self.__PreserveCommand("PopupNoticeProcess %d %s" % (int(is_checked), url))
+
+	def __DayMode_Update(self, mode):
+		self.__PreserveCommand("PRESERVE_DayMode " + mode)
+
+	def __ItemMall_Open(self):
+		self.__PreserveCommand("item_mall")
+
+	## Ó½
+	def __XMasBoom_Enable(self, mode):
+		if "1" == mode:
+			self.__PreserveCommand("PRESERVE_DayMode dark")
+		else:
+			self.__PreserveCommand("PRESERVE_DayMode light")
+
+	def __XMasSnow_Enable(self, mode):
+		self.__PreserveCommand("xmas_snow " + mode)
+
+	def __XMasTree_Enable(self, grade):
+		self.__PreserveCommand("xmas_tree " + grade)
+
+	if app.ENABLE_MINI_GAME_RUMI:
+		def __MiniGameOkeyEvent(self, enable):
+			self.__PreserveCommand("mini_game_okey " + enable)
+
+		def __MiniGameOkeyNormalEvent(self, enable):
+			self.__PreserveCommand("mini_game_okey_normal " + enable)
+
+	if app.ENABLE_MINI_GAME_YUTNORI:
+		def __MiniGameYutnori(self, enable):
+			self.__PreserveCommand("mini_game_yutnori " + enable)
+
+	if app.ENABLE_SUMMER_EVENT_ROULETTE:
+		def __LateSummerEvent(self, enable):
+			self.__PreserveCommand("e_late_summer " + enable)
+
+	if app.ENABLE_SNOWFLAKE_STICK_EVENT:
+		def __SnowflakeStickEvent(self, end_time):
+			self.__PreserveCommand("snowflake_stick_event " + end_time)
+
+	if app.ENABLE_FLOWER_EVENT:
+		def __FlowerEvent(self, enable):
+			self.__PreserveCommand("e_flower_drop " + enable)
+
+parserWnd = ServerCommandParser()
diff --git a/client/pack/root/serverinfo.py b/client/pack/root/serverinfo.py
index 305438e..4426b03 100644
--- a/client/pack/root/serverinfo.py
+++ b/client/pack/root/serverinfo.py
@@ -1,51 +1,51 @@
-import app
-import localeInfo
-
-CLIENT_VERSION = "1"
-app.ServerName = None
-SERVER_1 = "|cffffd500|h Alena2"
-SRV1 = {
-	"name":"|cffffd500|h Alena2",
-	"host":"192.168.1.50",
-	"auth1":11150,
-	"ch1":12101,
-	"ch2":12101,
-	"ch3":12101,
-	"ch4":12101,
-	"ch5":12101,
-	"ch6":12101,
-		}
-
-STATE_NONE = '|cffff0000OFF'
-
-STATE_DICT = {
-	0 : "|cffff0000Off",
-	1 : "|cff00ff00NORMAL",
-	2 : "|cffffff00BUSY",
-	3 : "|cffff6060FULL"
-	}
-
-SERVER1_CHANNEL_DICT = {
-	1:{"key":11,"name":"CH1","ip":SRV1["host"],"tcp_port":SRV1["ch1"],"udp_port":SRV1["ch1"],"state":STATE_NONE,},
-	2:{"key":12,"name":"CH2","ip":SRV1["host"],"tcp_port":SRV1["ch2"],"udp_port":SRV1["ch2"],"state":STATE_NONE,},
-	3:{"key":13,"name":"CH3","ip":SRV1["host"],"tcp_port":SRV1["ch3"],"udp_port":SRV1["ch3"],"state":STATE_NONE,},
-	4:{"key":14,"name":"CH4","ip":SRV1["host"],"tcp_port":SRV1["ch4"],"udp_port":SRV1["ch4"],"state":STATE_NONE,},
-	5:{"key":15,"name":"CH5","ip":SRV1["host"],"tcp_port":SRV1["ch5"],"udp_port":SRV1["ch5"],"state":STATE_NONE,},
-	6:{"key":16,"name":"CH6","ip":SRV1["host"],"tcp_port":SRV1["ch6"],"udp_port":SRV1["ch6"],"state":STATE_NONE,},
-}
-
-REGION_AUTH_SERVER_DICT = {
-	0 : {
-		1 : { "ip":SRV1["host"], "port":SRV1["auth1"], },
-	}
-}
-
-REGION_DICT = {
-	0 : {
-		1 : { "name" :SRV1["name"], "channel" : SERVER1_CHANNEL_DICT, },
-	},
-}
-
-MARKADDR_DICT = {
-	10 : { "ip" : SRV1["host"], "tcp_port" : SRV1["ch1"], "mark" : "10.tga", "symbol_path" : "10", },
-}
+import app
+import localeInfo
+
+CLIENT_VERSION = "1"
+app.ServerName = None
+SERVER_1 = "|cffffd500|h Alena2"
+SRV1 = {
+	"name":"|cffffd500|h Alena2",
+	"host":"192.168.1.50",
+	"auth1":11150,
+	"ch1":12101,
+	"ch2":12102,
+	"ch3":12103,
+	"ch4":12104,
+	"ch5":12105,
+	"ch6":12106,
+		}
+
+STATE_NONE = '|cffff0000OFF'
+
+STATE_DICT = {
+	0 : "|cffff0000Off",
+	1 : "|cff00ff00NORMAL",
+	2 : "|cffffff00BUSY",
+	3 : "|cffff6060FULL"
+	}
+
+SERVER1_CHANNEL_DICT = {
+	1:{"key":11,"name":"CH1","ip":SRV1["host"],"tcp_port":SRV1["ch1"],"udp_port":SRV1["ch1"],"state":STATE_NONE,},
+	2:{"key":12,"name":"CH2","ip":SRV1["host"],"tcp_port":SRV1["ch2"],"udp_port":SRV1["ch2"],"state":STATE_NONE,},
+	3:{"key":13,"name":"CH3","ip":SRV1["host"],"tcp_port":SRV1["ch3"],"udp_port":SRV1["ch3"],"state":STATE_NONE,},
+	4:{"key":14,"name":"CH4","ip":SRV1["host"],"tcp_port":SRV1["ch4"],"udp_port":SRV1["ch4"],"state":STATE_NONE,},
+	5:{"key":15,"name":"CH5","ip":SRV1["host"],"tcp_port":SRV1["ch5"],"udp_port":SRV1["ch5"],"state":STATE_NONE,},
+	6:{"key":16,"name":"CH6","ip":SRV1["host"],"tcp_port":SRV1["ch6"],"udp_port":SRV1["ch6"],"state":STATE_NONE,},
+}
+
+REGION_AUTH_SERVER_DICT = {
+	0 : {
+		1 : { "ip":SRV1["host"], "port":SRV1["auth1"], },
+	}
+}
+
+REGION_DICT = {
+	0 : {
+		1 : { "name" :SRV1["name"], "channel" : SERVER1_CHANNEL_DICT, },
+	},
+}
+
+MARKADDR_DICT = {
+	10 : { "ip" : SRV1["host"], "tcp_port" : SRV1["ch1"], "mark" : "10.tga", "symbol_path" : "10", },
+}
diff --git a/client/pack/root/ui.py b/client/pack/root/ui.py
index 6122c50..2d07a3f 100644
--- a/client/pack/root/ui.py
+++ b/client/pack/root/ui.py
@@ -1,5891 +1,5934 @@
-import app
-import ime
-import grp
-import snd
-import wndMgr
-import item
-import skill
-import localeInfo
-import dbg
-# MARK_BUG_FIX
-import guild
-# END_OF_MARK_BUG_FIX
-
-from _weakref import proxy
-
-BACKGROUND_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 1.0)
-DARK_COLOR = grp.GenerateColor(0.2, 0.2, 0.2, 1.0)
-BRIGHT_COLOR = grp.GenerateColor(0.7, 0.7, 0.7, 1.0)
-
-if localeInfo.IsCANADA():
-	SELECT_COLOR = grp.GenerateColor(0.9, 0.03, 0.01, 0.4)
-else:
-	#SELECT_COLOR = grp.GenerateColor(0.0, 0.0, 0.5, 0.3)
-	SELECT_COLOR = grp.GenerateColor(0.2, 0.0, 0.5, 0.8) # ori
-	#SELECT_COLOR = grp.GenerateColor(0.9, 0.03, 0.01, 0.4) # red
-
-WHITE_COLOR = grp.GenerateColor(1.0, 1.0, 1.0, 0.5)
-HALF_WHITE_COLOR = grp.GenerateColor(1.0, 1.0, 1.0, 0.2)
-
-if app.ENABLE_KEYCHANGE_SYSTEM:
-	RED_COLOR = grp.GenerateColor(1.0, 0.0, 0.0, 0.5)
-	HALF_HALF_RED_COLOR = grp.GenerateColor(1.0, 0.0, 0.0, 0.4)
-	HALF_RED_COLOR = grp.GenerateColor(1.0, 0.0, 0.0, 0.3)
-
-createToolTipWindowDict = {}
-def RegisterCandidateWindowClass(codePage, candidateWindowClass):
-	EditLine.candidateWindowClassDict[codePage] = candidateWindowClass
-def RegisterToolTipWindow(type, createToolTipWindow):
-	createToolTipWindowDict[type] = createToolTipWindow
-
-app.SetDefaultFontName(localeInfo.UI_DEF_FONT)
-
-## Window Manager Event List##
-##############################
-## "OnMouseLeftButtonDown"
-## "OnMouseLeftButtonUp"
-## "OnMouseLeftButtonDoubleClick"
-## "OnMouseRightButtonDown"
-## "OnMouseRightButtonUp"
-## "OnMouseRightButtonDoubleClick"
-## "OnMouseDrag"
-## "OnSetFocus"
-## "OnKillFocus"
-## "OnMouseOverIn"
-## "OnMouseOverOut"
-## "OnRender"
-## "OnUpdate"
-## "OnKeyDown"
-## "OnKeyUp"
-## "OnTop"
-## "OnIMEUpdate" ## IME Only
-## "OnIMETab"	## IME Only
-## "OnIMEReturn" ## IME Only
-##############################
-## Window Manager Event List##
-
-class __mem_func__:
-	class __noarg_call__:
-		def __init__(self, cls, obj, func):
-			self.cls = cls
-			self.obj = proxy(obj)
-			self.func = proxy(func)
-
-		def __call__(self, *arg):
-			return self.func(self.obj)
-
-	class __arg_call__:
-		def __init__(self, cls, obj, func):
-			self.cls = cls
-			self.obj = proxy(obj)
-			self.func = proxy(func)
-
-		def __call__(self, *arg):
-			return self.func(self.obj, *arg)
-
-	def __init__(self, mfunc):
-		if mfunc.im_func.func_code.co_argcount>1:
-			self.call = __mem_func__.__arg_call__(mfunc.im_class, mfunc.im_self, mfunc.im_func)
-		else:
-			self.call = __mem_func__.__noarg_call__(mfunc.im_class, mfunc.im_self, mfunc.im_func)
-
-	def __call__(self, *arg):
-		return self.call(*arg)
-
-class Window(object):
-	def NoneMethod(cls):
-		pass
-
-	NoneMethod = classmethod(NoneMethod)
-
-	def __init__(self, layer = "UI"):
-		self.hWnd = None
-		self.parentWindow = 0
-		self.onMouseLeftButtonUpEvent = None
-		self.RegisterWindow(layer)
-		self.Hide()
-
-		if app.ENABLE_MAILBOX:
-			self.onMouseLeftButtonUpEventArgs = None
-			self.overFunc = None
-			self.overArgs = None
-			self.overOutFunc = None
-			self.overOutArgs = None
-
-		if app.ENABLE_MOUSE_WHEEL_TOP_WINDOW:
-			self.onMouseWheelEvent=None
-
-	def __del__(self):
-		wndMgr.Destroy(self.hWnd)
-
-		if app.ENABLE_MAILBOX:
-			self.onMouseLeftButtonUpEventArgs = None
-			self.overFunc = None
-			self.overArgs = None
-			self.overOutFunc = None
-			self.overOutArgs = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.Register(self, layer)
-
-	def Destroy(self):
-		pass
-
-	def GetWindowHandle(self):
-		return self.hWnd
-
-	def AddFlag(self, style):
-		wndMgr.AddFlag(self.hWnd, style)
-
-	def IsRTL(self):
-		return wndMgr.IsRTL(self.hWnd)
-
-	def SetWindowName(self, Name):
-		wndMgr.SetName(self.hWnd, Name)
-
-	def GetWindowName(self):
-		return wndMgr.GetName(self.hWnd)
-
-	def SetParent(self, parent):
-		wndMgr.SetParent(self.hWnd, parent.hWnd)
-
-	def SetParentProxy(self, parent):
-		self.parentWindow = proxy(parent)
-		wndMgr.SetParent(self.hWnd, parent.hWnd)
-
-	def GetParentProxy(self):
-		return self.parentWindow
-
-	def SetPickAlways(self):
-		wndMgr.SetPickAlways(self.hWnd)
-
-	def SetWindowHorizontalAlignLeft(self):
-		wndMgr.SetWindowHorizontalAlign(self.hWnd, wndMgr.HORIZONTAL_ALIGN_LEFT)
-
-	def SetWindowHorizontalAlignCenter(self):
-		wndMgr.SetWindowHorizontalAlign(self.hWnd, wndMgr.HORIZONTAL_ALIGN_CENTER)
-
-	def SetWindowHorizontalAlignRight(self):
-		wndMgr.SetWindowHorizontalAlign(self.hWnd, wndMgr.HORIZONTAL_ALIGN_RIGHT)
-
-	def SetWindowVerticalAlignTop(self):
-		wndMgr.SetWindowVerticalAlign(self.hWnd, wndMgr.VERTICAL_ALIGN_TOP)
-
-	def SetWindowVerticalAlignCenter(self):
-		wndMgr.SetWindowVerticalAlign(self.hWnd, wndMgr.VERTICAL_ALIGN_CENTER)
-
-	def SetWindowVerticalAlignBottom(self):
-		wndMgr.SetWindowVerticalAlign(self.hWnd, wndMgr.VERTICAL_ALIGN_BOTTOM)
-
-	def SetTop(self):
-		wndMgr.SetTop(self.hWnd)
-
-	def Show(self):
-		wndMgr.Show(self.hWnd)
-
-	def Hide(self):
-		wndMgr.Hide(self.hWnd)
-
-	def Lock(self):
-		wndMgr.Lock(self.hWnd)
-
-	def Unlock(self):
-		wndMgr.Unlock(self.hWnd)
-
-	def IsShow(self):
-		return wndMgr.IsShow(self.hWnd)
-
-	def UpdateRect(self):
-		wndMgr.UpdateRect(self.hWnd)
-
-	def SetSize(self, width, height):
-		wndMgr.SetWindowSize(self.hWnd, width, height)
-
-	def GetWidth(self):
-		return wndMgr.GetWindowWidth(self.hWnd)
-
-	def GetHeight(self):
-		return wndMgr.GetWindowHeight(self.hWnd)
-
-	def GetLocalPosition(self):
-		return wndMgr.GetWindowLocalPosition(self.hWnd)
-
-	if app.ENABLE_SEND_TARGET_INFO:
-		def GetLeft(self):
-			x, y = self.GetLocalPosition()
-			return x
-
-		def GetRight(self):
-			return self.GetLeft() + self.GetWidth()
-
-		def GetTop(self):
-			x, y = self.GetLocalPosition()
-			return y
-
-		def GetBottom(self):
-			return self.GetTop() + self.GetHeight()
-
-	def GetGlobalPosition(self):
-		return wndMgr.GetWindowGlobalPosition(self.hWnd)
-
-	def GetMouseLocalPosition(self):
-		return wndMgr.GetMouseLocalPosition(self.hWnd)
-
-	def GetRect(self):
-		return wndMgr.GetWindowRect(self.hWnd)
-
-	def SetPosition(self, x, y):
-		wndMgr.SetWindowPosition(self.hWnd, x, y)
-
-	def SetCenterPosition(self, x = 0, y = 0):
-		self.SetPosition((wndMgr.GetScreenWidth() - self.GetWidth()) / 2 + x, (wndMgr.GetScreenHeight() - self.GetHeight()) / 2 + y)
-
-	def IsFocus(self):
-		return wndMgr.IsFocus(self.hWnd)
-
-	def SetFocus(self):
-		wndMgr.SetFocus(self.hWnd)
-
-	def KillFocus(self):
-		wndMgr.KillFocus(self.hWnd)
-
-	def GetChildCount(self):
-		return wndMgr.GetChildCount(self.hWnd)
-
-	def IsIn(self):
-		return wndMgr.IsIn(self.hWnd)
-
-	if app.ENABLE_MAILBOX:
-		def SetOnMouseLeftButtonUpEvent(self, event, *args):
-			self.onMouseLeftButtonUpEvent = event
-			self.onMouseLeftButtonUpEventArgs = args
-
-		def OnMouseLeftButtonUp(self):
-			if self.onMouseLeftButtonUpEvent:
-				apply(self.onMouseLeftButtonUpEvent, self.onMouseLeftButtonUpEventArgs)
-	else:
-		def SetOnMouseLeftButtonUpEvent(self, event):
-			self.onMouseLeftButtonUpEvent = event
-
-		def OnMouseLeftButtonUp(self):
-			if self.onMouseLeftButtonUpEvent:
-				self.onMouseLeftButtonUpEvent()
-
-	if app.ENABLE_MOUSE_WHEEL_TOP_WINDOW:
-		def SetMouseWheelEvent(self, event):
-			self.onMouseWheelEvent = event
-
-		def OnMouseWheel(self, delta):
-			if self.onMouseWheelEvent:
-				return self.onMouseWheelEvent(delta)
-			return False
-
-	if app.ENABLE_MAILBOX:
-		def OnMouseOverIn(self):
-			if self.overFunc:
-				apply(self.overFunc, self.overArgs)
-
-		def OnMouseOverOut(self):
-			if self.overOutFunc:
-				apply(self.overOutFunc, self.overOutArgs)
-
-		def SetOverEvent(self, func, *args):
-			self.overFunc = func
-			self.overArgs = args
-
-		def SetOverOutEvent(self, func, *args):
-			self.overOutFunc = func
-			self.overOutArgs = args
-
-	if app.ENABLE_CLIP_MASK:
-		def SetClippingMaskRect(self, left, top, right, bottom):
-			wndMgr.SetClippingMaskRect(self.hWnd, left, top, right, bottom)
-
-		def SetClippingMaskWindow(self, clipping_mask_window):
-			wndMgr.SetClippingMaskWindow(self.hWnd, clipping_mask_window.hWnd)
-
-	def IsRendering(self):
-		return wndMgr.IsRendering(self.hWnd)
-
-class ListBoxEx(Window):
-	class Item(Window):
-		def __init__(self):
-			Window.__init__(self)
-
-		def __del__(self):
-			Window.__del__(self)
-
-		def SetParent(self, parent):
-			Window.SetParent(self, parent)
-			self.parent = proxy(parent)
-
-		def OnMouseLeftButtonDown(self):
-			self.parent.SelectItem(self)
-
-		def OnRender(self):
-			if self.parent.GetSelectedItem() == self:
-				self.OnSelectedRender()
-
-		def OnSelectedRender(self):
-			x, y = self.GetGlobalPosition()
-			grp.SetColor(grp.GenerateColor(0.0, 0.0, 0.7, 0.7))
-			grp.RenderBar(x, y, self.GetWidth(), self.GetHeight())
-
-	def __init__(self):
-		Window.__init__(self)
-
-		self.viewItemCount = 10
-		self.basePos = 0
-		self.itemHeight = 16
-		self.itemStep = 20
-		self.selItem = 0
-		self.itemList = []
-		self.onSelectItemEvent = lambda *arg: None
-
-		if localeInfo.IsARABIC():
-			self.itemWidth = 130
-		else:
-			self.itemWidth = 100
-
-		self.scrollBar = None
-		self.__UpdateSize()
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def __UpdateSize(self):
-		height = self.itemStep * self.__GetViewItemCount()
-
-		self.SetSize(self.itemWidth, height)
-
-	def IsEmpty(self):
-		if len(self.itemList) == 0:
-			return 1
-		return 0
-
-	def SetItemStep(self, itemStep):
-		self.itemStep = itemStep
-		self.__UpdateSize()
-
-	def SetItemSize(self, itemWidth, itemHeight):
-		self.itemWidth = itemWidth
-		self.itemHeight = itemHeight
-		self.__UpdateSize()
-
-	def SetViewItemCount(self, viewItemCount):
-		self.viewItemCount = viewItemCount
-
-	def SetSelectEvent(self, event):
-		self.onSelectItemEvent = event
-
-	def SetBasePos(self, basePos):
-		for oldItem in self.itemList[self.basePos:self.basePos + self.viewItemCount]:
-			oldItem.Hide()
-
-		self.basePos = basePos
-
-		pos = basePos
-		for newItem in self.itemList[self.basePos : self.basePos + self.viewItemCount]:
-			(x, y) = self.GetItemViewCoord(pos, newItem.GetWidth())
-			newItem.SetPosition(x, y)
-			newItem.Show()
-			pos += 1
-
-	def GetItemIndex(self, argItem):
-		return self.itemList.index(argItem)
-
-	def GetSelectedItem(self):
-		return self.selItem
-
-	def SelectIndex(self, index):
-		if index >= len(self.itemList) or index < 0:
-			self.selItem = None
-			return
-
-		try:
-			self.selItem = self.itemList[index]
-		except:
-			pass
-
-	def SelectItem(self, selItem):
-		self.selItem = selItem
-		self.onSelectItemEvent(selItem)
-
-	def RemoveAllItems(self):
-		self.selItem = None
-		self.itemList = []
-
-		if self.scrollBar:
-			self.scrollBar.SetPos(0)
-
-	def RemoveItem(self, delItem):
-		if delItem == self.selItem:
-			self.selItem = None
-
-		self.itemList.remove(delItem)
-
-	def AppendItem(self, newItem):
-		newItem.SetParent(self)
-		newItem.SetSize(self.itemWidth, self.itemHeight)
-
-		pos = len(self.itemList)
-		if self.__IsInViewRange(pos):
-			(x, y) = self.GetItemViewCoord(pos, newItem.GetWidth())
-			newItem.SetPosition(x, y)
-			newItem.Show()
-		else:
-			newItem.Hide()
-
-		self.itemList.append(newItem)
-
-	def SetScrollBar(self, scrollBar):
-		scrollBar.SetScrollEvent(__mem_func__(self.__OnScroll))
-		self.scrollBar = scrollBar
-
-	def __OnScroll(self):
-		self.SetBasePos(int(self.scrollBar.GetPos() * self.__GetScrollLen()))
-
-	def __GetScrollLen(self):
-		scrollLen = self.__GetItemCount() - self.__GetViewItemCount()
-		if scrollLen < 0:
-			return 0
-
-		return scrollLen
-
-	def __GetViewItemCount(self):
-		return self.viewItemCount
-
-	def __GetItemCount(self):
-		return len(self.itemList)
-
-	def GetItemViewCoord(self, pos, itemWidth):
-		if localeInfo.IsARABIC():
-			return (self.GetWidth() - itemWidth - 10, (pos-self.basePos) * self.itemStep)
-		else:
-			return (0, (pos - self.basePos) * self.itemStep)
-
-	def __IsInViewRange(self, pos):
-		if pos < self.basePos:
-			return 0
-
-		if pos >= self.basePos + self.viewItemCount:
-			return 0
-
-		return 1
-
-class CandidateListBox(ListBoxEx):
-
-	HORIZONTAL_MODE = 0
-	VERTICAL_MODE = 1
-
-	class Item(ListBoxEx.Item):
-		def __init__(self, text):
-			ListBoxEx.Item.__init__(self)
-
-			self.textBox=TextLine()
-			self.textBox.SetParent(self)
-			self.textBox.SetText(text)
-			self.textBox.Show()
-
-		def __del__(self):
-			ListBoxEx.Item.__del__(self)
-
-	def __init__(self, mode = HORIZONTAL_MODE):
-		ListBoxEx.__init__(self)
-		self.itemWidth=32
-		self.itemHeight=32
-		self.mode = mode
-
-	def __del__(self):
-		ListBoxEx.__del__(self)
-
-	def SetMode(self, mode):
-		self.mode = mode
-
-	def AppendItem(self, newItem):
-		ListBoxEx.AppendItem(self, newItem)
-
-	def GetItemViewCoord(self, pos):
-		if self.mode == self.HORIZONTAL_MODE:
-			return ((pos-self.basePos)*self.itemStep, 0)
-		elif self.mode == self.VERTICAL_MODE:
-			return (0, (pos-self.basePos)*self.itemStep)
-
-class TextLine(Window):
-	def __init__(self):
-		Window.__init__(self)
-		self.max = 0
-		self.SetFontName(localeInfo.UI_DEF_FONT)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterTextLine(self, layer)
-
-	def SetMax(self, max):
-		wndMgr.SetMax(self.hWnd, max)
-
-	def SetLimitWidth(self, width):
-		wndMgr.SetLimitWidth(self.hWnd, width)
-
-	def SetMultiLine(self):
-		wndMgr.SetMultiLine(self.hWnd, True)
-
-	def SetHorizontalAlignArabic(self):
-		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_ARABIC)
-
-	def SetHorizontalAlignLeft(self):
-		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_LEFT)
-
-	def SetHorizontalAlignRight(self):
-		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_RIGHT)
-
-	def SetHorizontalAlignCenter(self):
-		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_CENTER)
-
-	def SetVerticalAlignTop(self):
-		wndMgr.SetVerticalAlign(self.hWnd, wndMgr.TEXT_VERTICAL_ALIGN_TOP)
-
-	def SetVerticalAlignBottom(self):
-		wndMgr.SetVerticalAlign(self.hWnd, wndMgr.TEXT_VERTICAL_ALIGN_BOTTOM)
-
-	def SetVerticalAlignCenter(self):
-		wndMgr.SetVerticalAlign(self.hWnd, wndMgr.TEXT_VERTICAL_ALIGN_CENTER)
-
-	def SetSecret(self, Value=True):
-		wndMgr.SetSecret(self.hWnd, Value)
-
-	def SetOutline(self, Value=True):
-		wndMgr.SetOutline(self.hWnd, Value)
-
-	def SetFeather(self, value=True):
-		wndMgr.SetFeather(self.hWnd, value)
-
-	def SetFontName(self, fontName):
-		wndMgr.SetFontName(self.hWnd, fontName)
-
-	if app.WJ_MULTI_TEXTLINE:
-		def SetEnterToken(self, bool):
-			wndMgr.SetEnterToken(self.hWnd, bool)
-
-	def SetDefaultFontName(self):
-		wndMgr.SetFontName(self.hWnd, localeInfo.UI_DEF_FONT)
-
-	def SetFontColor(self, red, green, blue):
-		wndMgr.SetFontColor(self.hWnd, red, green, blue)
-
-	def SetTextColor(self, color):
-		self.SetPackedFontColor(color)
-
-	def SetPackedFontColor(self, color):
-		wndMgr.SetFontColor(self.hWnd, color)
-
-	def SetText(self, text):
-		wndMgr.SetText(self.hWnd, text)
-
-	def GetTextLineCount(self):
-		return wndMgr.GetTextLineCount(self.hWnd)
-
-	def DisableEnterToken(self):
-		wndMgr.DisableEnterToken(self.hWnd)
-
-	def SetLineHeight(self, Height):
-		wndMgr.SetLineHeight(self.hWnd, Height)
-
-	def GetLineHeight(self):
-		return wndMgr.GetLineHeight(self.hWnd)
-
-	def GetText(self):
-		return wndMgr.GetText(self.hWnd)
-
-	def GetTextSize(self):
-		return wndMgr.GetTextSize(self.hWnd)
-
-#if app.ENABLE_MINI_GAME_YUTNORI:
-class MoveTextLine(TextLine):
-	def __init__(self):
-		TextLine.__init__(self)
-		self.end_move_event_func = None
-		self.end_move_event_args = None
-
-	def __del__(self):
-		TextLine.__del__(self)
-		self.end_move_event_func = None
-		self.end_move_event_args = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterMoveTextLine(self, layer)
-
-	def SetMovePosition(self, dst_x, dst_y):
-		wndMgr.SetMovePosition(self.hWnd, dst_x, dst_y)
-
-	def SetMoveSpeed(self, speed):
-		wndMgr.SetMoveSpeed(self.hWnd, speed)
-
-	def MoveStart(self):
-		wndMgr.MoveStart(self.hWnd)
-	def MoveStop(self):
-		wndMgr.MoveStop(self.hWnd)
-	def GetMove(self):
-		return wndMgr.GetMove(self.hWnd)
-
-	def OnEndMove(self):
-		if self.end_move_event_func:
-			apply(self.end_move_event_func, self.end_move_event_args)
-
-	def SetEndMoveEvent(self, event, *args):
-		self.end_move_event_func = event
-		self.end_move_event_args = args
-
-class EmptyCandidateWindow(Window):
-	def __init__(self):
-		Window.__init__(self)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def Load(self):
-		pass
-
-	def SetCandidatePosition(self, x, y, textCount):
-		pass
-
-	def Clear(self):
-		pass
-
-	def Append(self, text):
-		pass
-
-	def Refresh(self):
-		pass
-
-	def Select(self):
-		pass
-
-class EditLine(TextLine):
-	candidateWindowClassDict = {}
-
-	def __init__(self):
-		TextLine.__init__(self)
-
-		if app.WJ_MULTI_TEXTLINE:
-			self.DisableEnterToken()
-		self.eventReturn = Window.NoneMethod
-		self.eventEscape = Window.NoneMethod
-#		self.eventTab = None
-		self.numberMode = False
-		self.UseCodePage = True # MT-679 °³ÀÎ »óÁ¡ Å¸ÀÌÆ²ÀÇ CodePage ÀÌ½´
-		self.useIME = True
-
-		self.eventUpdate = Window.NoneMethod
-		self.eventTab    = Window.NoneMethod
-		self.eventUpdateArgs = None
-		self.eventReturnArgs = None
-		self.eventEscapeArgs = None
-		self.eventTabArgs	= None
-
-		self.backgroundText = TextLine()
-		self.backgroundText.SetParent(self)
-		self.backgroundText.SetPosition(0, 0)
-		self.backgroundText.SetPackedFontColor(WHITE_COLOR)
-		self.backgroundText.Hide()
-
-		self.bCodePage = False
-
-		self.candidateWindowClass = None
-		self.candidateWindow = None
-		self.SetCodePage(app.GetDefaultCodePage())
-
-		self.readingWnd = ReadingWnd()
-		self.readingWnd.Hide()
-
-	def __del__(self):
-		TextLine.__del__(self)
-
-		self.eventReturn = Window.NoneMethod
-		self.eventEscape = Window.NoneMethod
-#		self.eventTab = None
-		self.eventUpdate = Window.NoneMethod
-		self.eventTab    = Window.NoneMethod
-		self.eventUpdateArgs = None
-		self.eventReturnArgs = None
-		self.eventEscapeArgs = None
-		self.eventTabArgs = None
-		self.backgroundText = None
-
-	def SetCodePage(self, codePage):
-		candidateWindowClass = EditLine.candidateWindowClassDict.get(codePage, EmptyCandidateWindow)
-		self.__SetCandidateClass(candidateWindowClass)
-
-	def __SetCandidateClass(self, candidateWindowClass):
-		if self.candidateWindowClass==candidateWindowClass:
-			return
-
-		self.candidateWindowClass = candidateWindowClass
-		self.candidateWindow = self.candidateWindowClass()
-		self.candidateWindow.Load()
-		self.candidateWindow.Hide()
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterTextLine(self, layer)
-
-	def SAFE_SetReturnEvent(self, event):
-		self.eventReturn = __mem_func__(event)
-
-	def SetReturnEvent(self, event):
-		self.eventReturn = event
-
-	def SAFE_SetUpdateEvent(self, event, *args):
-		self.eventUpdate = __mem_func__(event)
-		self.eventUpdateArgs = args
-
-	def SetUpdateEvent(self, event, *args):
-		self.eventUpdate = event
-		self.eventUpdateArgs = args
-
-	def SetEscapeEvent(self, event):
-		self.eventEscape = event
-
-	def SetTabEvent(self, event):
-		self.eventTab = event
-
-	def SetBackgroundText(self, text):
-		self.backgroundText.SetPosition(0, 0)
-		self.backgroundText.SetText(text)
-
-		if not self.backgroundText.IsShow():
-			self.backgroundText.Show()
-
-	def SetTipText(self, tipText):
-		input = self.GetText()
-		(widht, height) = self.GetTextSize()
-
-		tip = tipText[len(input):]
-		self.backgroundText.SetPosition(widht, 0)
-		self.backgroundText.SetText(tip)
-
-		if not self.backgroundText.IsShow():
-			self.backgroundText.Show()
-
-	def GetBackgroundText(self):
-		return self.backgroundText.GetText()
-
-	def SetMax(self, max):
-		self.max = max
-		wndMgr.SetMax(self.hWnd, self.max)
-		ime.SetMax(self.max)
-		self.SetUserMax(self.max)
-
-	def SetUserMax(self, max):
-		self.userMax = max
-		ime.SetUserMax(self.userMax)
-
-	def SetNumberMode(self):
-		self.numberMode = True
-
-	#MT-679 °³ÀÎ »óÁ¡ Å¸ÀÌÆ²ÀÇ CodePage ÀÌ½´
-	def SetUseCodePage(self, bUse = True):
-		self.UseCodePage = bUse
-
-	#def AddExceptKey(self, key):
-	#	ime.AddExceptKey(key)
-
-	#def ClearExceptKey(self):
-	#	ime.ClearExceptKey()
-
-	def SetIMEFlag(self, flag):
-		self.useIME = flag
-
-	def SetText(self, text):
-		wndMgr.SetText(self.hWnd, text)
-
-		if self.IsFocus():
-			ime.SetText(text)
-
-	def Enable(self):
-		wndMgr.ShowCursor(self.hWnd)
-
-	def Disable(self):
-		wndMgr.HideCursor(self.hWnd)
-
-	def SetEndPosition(self):
-		ime.MoveEnd()
-
-	def OnSetFocus(self):
-		Text = self.GetText()
-		ime.SetText(Text)
-		ime.SetMax(self.max)
-		ime.SetUserMax(self.userMax)
-		ime.SetCursorPosition(-1)
-		if self.numberMode:
-			ime.SetNumberMode()
-		else:
-			ime.SetStringMode()
-		ime.EnableCaptureInput()
-		if self.useIME:
-			ime.EnableIME()
-		else:
-			ime.DisableIME()
-
-		wndMgr.ShowCursor(self.hWnd, True)
-
-	def OnKillFocus(self):
-		self.SetText(ime.GetText(self.bCodePage))
-		self.OnIMECloseCandidateList()
-		self.OnIMECloseReadingWnd()
-		ime.DisableIME()
-		ime.DisableCaptureInput()
-		wndMgr.HideCursor(self.hWnd)
-
-	def OnIMEChangeCodePage(self):
-		self.SetCodePage(ime.GetCodePage())
-
-	def OnIMEOpenCandidateList(self):
-		self.candidateWindow.Show()
-		self.candidateWindow.Clear()
-		self.candidateWindow.Refresh()
-
-		gx, gy = self.GetGlobalPosition()
-		self.candidateWindow.SetCandidatePosition(gx, gy, len(self.GetText()))
-
-		return True
-
-	def OnIMECloseCandidateList(self):
-		self.candidateWindow.Hide()
-		return True
-
-	def OnIMEOpenReadingWnd(self):
-		gx, gy = self.GetGlobalPosition()
-		textlen = len(self.GetText())-2
-		reading = ime.GetReading()
-		readinglen = len(reading)
-		self.readingWnd.SetReadingPosition( gx + textlen*6-24-readinglen*6, gy )
-		self.readingWnd.SetText(reading)
-		if ime.GetReadingError() == 0:
-			self.readingWnd.SetTextColor(0xffffffff)
-		else:
-			self.readingWnd.SetTextColor(0xffff0000)
-		self.readingWnd.SetSize(readinglen * 6 + 4, 19)
-		self.readingWnd.Show()
-		return True
-
-	def OnIMECloseReadingWnd(self):
-		self.readingWnd.Hide()
-		return True
-
-	def IsNumber(self, text):
-		try:
-			int(text)
-			return True
-		except ValueError:
-			return False
-
-	def IsIncludeCodePage(self, text):
-		textLen = len(text)
-		idx = 0
-
-		while(idx < textLen):
-			n = text.find("@", idx)
-
-			if n == -1:
-				break
-			elif n+4 < textLen and self.IsNumber(text[n+1:n+4]) == True:
-				return True
-			else:
-				idx = n + 1
-
-		return False
-
-	def OnIMEUpdate(self):
-		# MT-679 °³ÀÎ »óÁ¡ Å¸ÀÌÆ²ÀÇ CodePage ÀÌ½´
-		if self.UseCodePage == False and self.IsIncludeCodePage(ime.GetText(self.bCodePage)) == True:
-			ime.SetText("")
-
-		snd.PlaySound("sound/ui/type.wav")
-		TextLine.SetText(self, ime.GetText(self.bCodePage))
-
-	def OnIMETab(self):
-		if self.eventTab:
-			self.eventTab()
-			return True
-
-		return False
-
-	def OnIMEReturn(self):
-		snd.PlaySound("sound/ui/click.wav")
-		self.eventReturn()
-
-		return True
-
-	def OnPressEscapeKey(self):
-		self.eventEscape()
-		return True
-
-	def OnKeyDown(self, key):
-		if app.DIK_F1 == key:
-			return False
-		if app.DIK_F2 == key:
-			return False
-		if app.DIK_F3 == key:
-			return False
-		if app.DIK_F4 == key:
-			return False
-		if app.DIK_LALT == key:
-			return False
-		if app.DIK_SYSRQ == key:
-			return False
-		if app.DIK_LCONTROL == key:
-			return False
-		if app.DIK_V == key:
-			if app.IsPressed(app.DIK_LCONTROL):
-				ime.PasteTextFromClipBoard()
-
-		return True
-
-	def OnKeyUp(self, key):
-		if app.DIK_F1 == key:
-			return False
-		if app.DIK_F2 == key:
-			return False
-		if app.DIK_F3 == key:
-			return False
-		if app.DIK_F4 == key:
-			return False
-		if app.DIK_LALT == key:
-			return False
-		if app.DIK_SYSRQ == key:
-			return False
-		if app.DIK_LCONTROL == key:
-			return False
-
-		return True
-
-	def OnIMEKeyDown(self, key):
-		# Left
-		if app.VK_LEFT == key:
-			ime.MoveLeft()
-			return True
-		# Right
-		if app.VK_RIGHT == key:
-			ime.MoveRight()
-			return True
-
-		# Home
-		if app.VK_HOME == key:
-			ime.MoveHome()
-			return True
-		# End
-		if app.VK_END == key:
-			ime.MoveEnd()
-			return True
-
-		# Delete
-		if app.VK_DELETE == key:
-			ime.Delete()
-			TextLine.SetText(self, ime.GetText(self.bCodePage))
-			return True
-
-		return True
-
-	# def OnMouseLeftButtonDown(self):
-		# self.SetFocus()
-
-	def OnMouseLeftButtonDown(self):
-		if False == self.IsIn():
-			return False
-
-		self.SetFocus()
-		PixelPosition = wndMgr.GetCursorPosition(self.hWnd)
-		ime.SetCursorPosition(PixelPosition)
-
-	if app.WJ_MULTI_TEXTLINE:
-		def DisableEnterToken(self):
-			wndMgr.DisableEnterToken(self.hWnd)
-
-class MarkBox(Window):
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterMarkBox(self, layer)
-
-	def Load(self):
-		wndMgr.MarkBox_Load(self.hWnd)
-
-	def SetScale(self, scale):
-		wndMgr.MarkBox_SetScale(self.hWnd, scale)
-
-	def SetIndex(self, guildID):
-		MarkID = guild.GuildIDToMarkID(guildID)
-		wndMgr.MarkBox_SetImageFilename(self.hWnd, guild.GetMarkImageFilenameByMarkID(MarkID))
-		wndMgr.MarkBox_SetIndex(self.hWnd, guild.GetMarkIndexByMarkID(MarkID))
-
-	def SetAlpha(self, alpha):
-		wndMgr.MarkBox_SetDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
-
-class ImageBox(Window):
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		self.eventDict = {}
-		self.eventFunc = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
-		self.eventArgs = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
-
-	def __del__(self):
-		Window.__del__(self)
-		self.eventFunc = None
-		self.eventArgs = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterImageBox(self, layer)
-
-	def LoadImage(self, imageName):
-		self.name=imageName
-		wndMgr.LoadImage(self.hWnd, imageName)
-
-		if len(self.eventDict)!=0:
-			print("LOAD IMAGE", self, self.eventDict)
-
-	def SetAlpha(self, alpha):
-		wndMgr.SetDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
-
-	if app.ENABLE_FISHING_GAME:
-		def SetDiffuseColor(self, r, g, b, alpha = 1.0):
-			wndMgr.SetDiffuseColor(self.hWnd, r, g, b, alpha)
-
-	def GetWidth(self):
-		return wndMgr.GetWidth(self.hWnd)
-
-	def GetHeight(self):
-		return wndMgr.GetHeight(self.hWnd)
-
-	def OnMouseOverIn(self):
-		try:
-			self.eventDict["MOUSE_OVER_IN"]()
-		except KeyError:
-			pass
-
-	def OnMouseOverOut(self):
-		try:
-			self.eventDict["MOUSE_OVER_OUT"]()
-		except KeyError:
-			pass
-
-	def SAFE_SetStringEvent(self, event, func):
-		self.eventDict[event]=__mem_func__(func)
-
-	def SetEvent(self, func, *args):
-		result = self.eventFunc.has_key(args[0])
-		if result:
-			self.eventFunc[args[0]] = func
-			self.eventArgs[args[0]] = args
-		else:
-			print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
-
-	def OnMouseLeftButtonUp(self):
-		if self.eventFunc["mouse_click"]:
-			apply(self.eventFunc["mouse_click"], self.eventArgs["mouse_click"])
-
-	def OnMouseOverIn(self):
-		if self.eventFunc["mouse_over_in"]:
-			apply(self.eventFunc["mouse_over_in"], self.eventArgs["mouse_over_in"])
-		else:
-			try:
-				self.eventDict["MOUSE_OVER_IN"]()
-			except KeyError:
-				pass
-
-	def OnMouseOverOut(self):
-		if self.eventFunc["mouse_over_out"]:
-			apply(self.eventFunc["mouse_over_out"], self.eventArgs["mouse_over_out"])
-		else:
-			try:
-				self.eventDict["MOUSE_OVER_OUT"]()
-			except KeyError:
-				pass
-
-	#if app.ENABLE_GROWTH_PET_SYSTEM
-	def LeftRightReverse(self):
-		wndMgr.LeftRightReverseImageBox(self.hWnd)
-
-	#if app.ENABLE_12ZI:
-	def SetCoolTime(self, time):
-		wndMgr.SetCoolTimeImageBox(self.hWnd, time)
-
-	def SetStartCoolTime(self, time):
-		wndMgr.SetStartCoolTimeImageBox(self.hWnd, time)
-
-	def SetScale(self, xScale, yScale):
-		wndMgr.SetScale(self.hWnd, xScale, yScale)
-
-class ImageBox2(Window):
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		self.eventDict={}
-		self.eventFunc = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
-		self.eventArgs = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
-
-	def __del__(self):
-		Window.__del__(self)
-		self.eventFunc = None
-		self.eventArgs = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterImageBox(self, layer)
-
-	def LoadImage(self, imageName):
-		self.name=imageName
-		wndMgr.LoadImage(self.hWnd, imageName)
-
-		if len(self.eventDict)!=0:
-			print("LOAD IMAGE", self, self.eventDict)
-
-	def SetAlpha(self, alpha):
-		wndMgr.SetDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
-
-	def GetWidth(self):
-		return wndMgr.GetWidth(self.hWnd)
-
-	def GetHeight(self):
-		return wndMgr.GetHeight(self.hWnd)
-
-	def OnMouseOverIn(self):
-		try:
-			self.eventDict["MOUSE_OVER_IN"]()
-		except KeyError:
-			pass
-
-	def OnMouseOverOut(self):
-		try:
-			self.eventDict["MOUSE_OVER_OUT"]()
-		except KeyError:
-			pass
-
-	def SAFE_SetStringEvent(self, event, func, *args):
-		self.eventDict[event]=__mem_func__(func)
-
-	def SetEvent(self, func, *args) :
-		result = self.eventFunc.has_key(args[0])
-		if result :
-			self.eventFunc[args[0]] = func
-			self.eventArgs[args[0]] = args
-		else :
-			print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
-
-	def OnMouseLeftButtonUp(self) :
-		if self.eventFunc["mouse_click"] :
-			apply(self.eventFunc["mouse_click"], self.eventArgs["mouse_click"])
-
-	def OnMouseOverIn(self) :
-		if self.eventFunc["mouse_over_in"] :
-			apply(self.eventFunc["mouse_over_in"], self.eventArgs["mouse_over_in"])
-		else:
-			try:
-				self.eventDict["MOUSE_OVER_IN"]()
-			except KeyError:
-				pass
-
-	def OnMouseOverOut(self) :
-		if self.eventFunc["mouse_over_out"] :
-			apply(self.eventFunc["mouse_over_out"], self.eventArgs["mouse_over_out"])
-		else :
-			try:
-				self.eventDict["MOUSE_OVER_OUT"]()
-			except KeyError:
-				pass
-
-class ExpandedImageBox(ImageBox):
-	def __init__(self, layer = "UI"):
-		ImageBox.__init__(self, layer)
-
-	def __del__(self):
-		ImageBox.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterExpandedImageBox(self, layer)
-
-	def SetScale(self, xScale, yScale):
-		wndMgr.SetScale(self.hWnd, xScale, yScale)
-
-	def SetOrigin(self, x, y):
-		wndMgr.SetOrigin(self.hWnd, x, y)
-
-	def SetRotation(self, rotation):
-		wndMgr.SetRotation(self.hWnd, rotation)
-
-	def SetRenderingMode(self, mode):
-		wndMgr.SetRenderingMode(self.hWnd, mode)
-
-	# [0.0, 1.0] »çÀÌÀÇ °ª¸¸Å­ ÆÛ¼¾Æ®·Î ±×¸®Áö ¾Ê´Â´Ù.
-	def SetRenderingRect(self, left, top, right, bottom):
-		wndMgr.SetRenderingRect(self.hWnd, left, top, right, bottom)
-
-	def SetClipRect(self, left, top, right, bottom, isVertical = False):
-		wndMgr.SetClipRect(self.hWnd, left, top, right, bottom, isVertical)
-
-	def SetPercentage(self, curValue, maxValue):
-		if maxValue:
-			self.SetRenderingRect(0.0, 0.0, -1.0 + float(curValue) / float(maxValue), 0.0)
-		else:
-			self.SetRenderingRect(0.0, 0.0, 0.0, 0.0)
-
-	def SetPercentageEx(self, minValue, curValue, maxValue):
-		if minValue and maxValue:
-			self.SetRenderingRect(0.0, 0.0, -1.0 + (float(curValue) - float(minValue)) / (float(maxValue) - float(minValue)), 0.0)
-		else:
-			self.SetRenderingRect(0.0, 0.0, 0.0, 0.0)
-
-	def GetWidth(self):
-		return wndMgr.GetWindowWidth(self.hWnd)
-
-	def GetHeight(self):
-		return wndMgr.GetWindowHeight(self.hWnd)
-
-class AniImageBox(Window):
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-		self.end_frame_event = None
-		if app.ENABLE_MINI_GAME_CATCH_KING:
-			self.end_frame_args = None
-		self.key_frame_event = None
-
-		if app.ENABLE_MINI_GAME_YUTNORI:
-			self.eventFunc = { "mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None }
-			self.eventArgs = { "mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None }
-
-	def __del__(self):
-		Window.__del__(self)
-		self.end_frame_event = None
-		if app.ENABLE_MINI_GAME_CATCH_KING:
-			self.end_frame_args = None
-		self.key_frame_event = None
-
-		if app.ENABLE_MINI_GAME_YUTNORI:
-			self.eventFunc = None
-			self.eventArgs = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterAniImageBox(self, layer)
-
-	def SetDelay(self, delay):
-		wndMgr.SetDelay(self.hWnd, delay)
-
-	if app.ENABLE_FISHING_GAME:
-		def SetRotation(self, rotation):
-			wndMgr.SetRotation(self.hWnd, rotation)
-
-	def AppendImage(self, filename):
-		wndMgr.AppendImage(self.hWnd, filename)
-
-	def SetPercentage(self, curValue, maxValue):
-		wndMgr.SetRenderingRect(self.hWnd, 0.0, 0.0, -1.0 + float(curValue) / float(maxValue), 0.0)
-
-	if app.ENABLE_MINI_GAME_CATCH_KING:
-		def OnEndFrame(self):
-			if self.end_frame_event:
-				apply(self.end_frame_event, self.end_frame_args)
-	else:
-		def OnEndFrame(self):
-			if self.end_frame_event:
-				self.end_frame_event()
-
-	if app.ENABLE_GROWTH_PET_SYSTEM:
-		def AppendImageScale(self, filename, scale_x, scale_y):
-			wndMgr.AppendImageScale(self.hWnd, filename, scale_x, scale_y)
-
-	#if app.ENABLE_GROWTH_PET_SYSTEM:
-	def SetPercentageWithScale(self, curValue, maxValue):
-		wndMgr.SetRenderingRectWithScale(self.hWnd, 0.0, 0.0, -1.0 + float(curValue) / float(maxValue), 0.0)
-
-	def SetScale(self, xScale, yScale):
-		wndMgr.SetAniImgScale(self.hWnd, xScale, yScale)
-
-	if app.ENABLE_MINI_GAME_CATCH_KING:
-		def SetEndFrameEvent(self, event, *args):
-			self.end_frame_event = event
-			self.end_frame_args = args
-	else:
-		def SetEndFrameEvent(self, event):
-			self.end_frame_event = event
-
-	def ResetFrame(self):
-		wndMgr.ResetFrame(self.hWnd)
-
-	def OnKeyFrame(self, cur_frame):
-		if self.key_frame_event:
-			self.key_frame_event(cur_frame)
-
-	def SetKeyFrameEvent(self, event):
-		self.key_frame_event = event
-
-	if app.ENABLE_MINI_GAME_YUTNORI:
-		def SetEvent(self, func, *args):
-			result = self.eventFunc.has_key(args[0])
-			if result:
-				self.eventFunc[args[0]] = func
-				self.eventArgs[args[0]] = args
-			else:
-				print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
-
-		def OnMouseLeftButtonUp(self):
-			if self.eventFunc["mouse_click"]:
-				apply(self.eventFunc["mouse_click"], self.eventArgs["mouse_click"])
-
-		def OnMouseOverIn(self):
-			if self.eventFunc["mouse_over_in"]:
-				apply(self.eventFunc["mouse_over_in"], self.eventArgs["mouse_over_in"])
-
-		def OnMouseOverOut(self):
-			if self.eventFunc["mouse_over_out"]:
-				apply(self.eventFunc["mouse_over_out"], self.eventArgs["mouse_over_out"])
-
-class MoveImageBox(ImageBox):
-	def __init__(self, layer = "UI"):
-		ImageBox.__init__(self, layer)
-		self.end_move_event = None
-
-	def __del__(self):
-		ImageBox.__del__(self)
-		self.end_move_event = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterMoveImageBox(self, layer)
-
-	def MoveStart(self):
-		wndMgr.MoveStart(self.hWnd)
-	def MoveStop(self):
-		wndMgr.MoveStop(self.hWnd)
-	def GetMove(self):
-		return wndMgr.GetMove(self.hWnd)
-
-	def SetMovePosition(self, dst_x, dst_y):
-		wndMgr.SetMovePosition(self.hWnd, dst_x, dst_y)
-
-	def SetMoveSpeed(self, speed):
-		wndMgr.SetMoveSpeed(self.hWnd, speed)
-
-	def OnEndMove(self):
-		if self.end_move_event:
-			self.end_move_event()
-
-	def SetEndMoveEvent(self, event):
-		self.end_move_event = event
-
-if app.ENABLE_MINI_GAME_YUTNORI:
-	class MoveScaleImageBox(MoveImageBox):
-		def __init__(self, layer = "UI"):
-			MoveImageBox.__init__(self, layer)
-
-		def __del__(self):
-			MoveImageBox.__del__(self)
-
-		def RegisterWindow(self, layer):
-			self.hWnd = wndMgr.RegisterMoveScaleImageBox(self, layer)
-
-		def SetMaxScale(self, scale):
-			wndMgr.SetMaxScale(self.hWnd, scale)
-
-		def SetMaxScaleRate(self, pivot):
-			wndMgr.SetMaxScaleRate(self.hWnd, pivot)
-
-		def SetScalePivotCenter(self, flag):
-			wndMgr.SetScalePivotCenter(self.hWnd, flag)
-
-class Button(Window):
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		self.eventFunc = None
-		self.eventArgs = None
-
-		self.ButtonText = None
-		self.ToolTipText = None
-
-		self.TextChild = []
-
-		if app.ENABLE_DETAILS_UI or app.ENABLE_MINI_GAME_YUTNORI:
-			self.overFunc = None
-			self.overArgs = None
-			self.overOutFunc = None
-			self.overOutArgs = None
-
-		self.showtooltipevent = None
-		self.showtooltiparg = None
-		self.hidetooltipevent = None
-		self.hidetooltiparg = None
-
-	def SetFontName(self, fontName):
-		wndMgr.SetFontName(self.hWnd, fontName)
-
-	def __del__(self):
-		Window.__del__(self)
-
-		self.eventFunc = None
-		self.eventArgs = None
-
-		if app.ENABLE_DETAILS_UI or app.ENABLE_MINI_GAME_YUTNORI:
-			self.overFunc = None
-			self.overArgs = None
-			self.overOutFunc = None
-			self.overOutArgs = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterButton(self, layer)
-
-	def SetUpVisual(self, filename):
-		wndMgr.SetUpVisual(self.hWnd, filename)
-
-	def SetOverVisual(self, filename):
-		wndMgr.SetOverVisual(self.hWnd, filename)
-
-	def SetDownVisual(self, filename):
-		wndMgr.SetDownVisual(self.hWnd, filename)
-
-	def SetDisableVisual(self, filename):
-		wndMgr.SetDisableVisual(self.hWnd, filename)
-
-	def GetUpVisualFileName(self):
-		return wndMgr.GetUpVisualFileName(self.hWnd)
-
-	def GetOverVisualFileName(self):
-		return wndMgr.GetOverVisualFileName(self.hWnd)
-
-	def GetDownVisualFileName(self):
-		return wndMgr.GetDownVisualFileName(self.hWnd)
-
-	def Flash(self):
-		wndMgr.Flash(self.hWnd)
-
-	def EnableFlash(self):
-		wndMgr.EnableFlash(self.hWnd)
-
-	def DisableFlash(self):
-		wndMgr.DisableFlash(self.hWnd)
-
-	def Enable(self):
-		wndMgr.Enable(self.hWnd)
-
-	def Disable(self):
-		wndMgr.Disable(self.hWnd)
-
-	def Down(self):
-		wndMgr.Down(self.hWnd)
-
-	def SetUp(self):
-		wndMgr.SetUp(self.hWnd)
-
-	def SAFE_SetEvent(self, func, *args):
-		self.eventFunc = __mem_func__(func)
-		self.eventArgs = args
-
-	def SetEvent(self, func, *args):
-		self.eventFunc = func
-		self.eventArgs = args
-
-	def Over(self):
-		wndMgr.Over(self.hWnd)
-
-	def LeftRightReverse(self):
-		wndMgr.LeftRightReverse(self.hWnd)
-
-	def SetTextColor(self, color):
-		if not self.ButtonText:
-			return
-		self.ButtonText.SetPackedFontColor(color)
-
-	def IsLockSlot(self, slot_number):
-		return wndMgr.IsLockSlot(self.hWnd, slot_number)
-
-	def SetText(self, text, height = 4):
-		if not self.ButtonText:
-			textLine = TextLine()
-			textLine.SetParent(self)
-			textLine.SetPosition(self.GetWidth()/2, self.GetHeight()/2)
-			textLine.SetVerticalAlignCenter()
-			textLine.SetHorizontalAlignCenter()
-			textLine.Show()
-			self.ButtonText = textLine
-
-		self.ButtonText.SetText(text)
-
-	if app.ENABLE_MINI_GAME_YUTNORI:
-		def SetAutoSizeText(self, text):
-			if not self.ButtonText:
-				textLine = TextLine()
-				textLine.SetParent(self)
-				textLine.SetVerticalAlignCenter()
-				textLine.SetHorizontalAlignCenter()
-				textLine.Show()
-				self.ButtonText = textLine
-
-			self.ButtonText.SetText(text)
-
-			imageWidth = self.GetButtonImageWidth()
-			imageHeight = self.GetButtonImageHeight()
-
-			if imageWidth == 0 or imageHeight == 0:
-				return
-
-			(textWidth, textHeight) = self.ButtonText.GetTextSize()
-			textWidth += imageWidth / 5
-			textHeight += imageHeight / 10
-
-			curWidth = self.GetWidth()
-			curHeight = self.GetHeight()
-
-			if curWidth < textWidth:
-				curWidth = textWidth
-
-			if curHeight < textHeight:
-				curHeight = textHeight
-
-			self.SetSize(curWidth, curHeight)
-			self.SetButtonScale(curWidth * 1.0 / imageWidth, curHeight * 1.0 / imageHeight)
-			self.ButtonText.SetPosition(self.GetWidth() / 2, self.GetHeight() / 2)
-
-	def AppendTextLineAllClear(self):
-		self.TextChild = []
-
-	def SetAppendTextChangeText(self, idx, text):
-		if not len(self.TextChild):
-			return
-
-		self.TextChild[idx].SetText(text)
-
-	def SetAppendTextColor(self, idx, color):
-		if not len(self.TextChild):
-			return
-
-		self.TextChild[idx].SetPackedFontColor(color)
-
-	def AppendTextLine(self, text
-		, font_size = localeInfo.UI_DEF_FONT
-		, font_color = grp.GenerateColor(0.7607, 0.7607, 0.7607, 1.0)
-		, text_sort = "center"
-		, pos_x = None
-		, pos_y = None):
-		textLine = TextLine()
-		textLine.SetParent(self)
-		textLine.SetFontName(font_size)
-		textLine.SetPackedFontColor(font_color)
-		textLine.SetText(text)
-		textLine.Show()
-
-		if not pos_x and not pos_y:
-			textLine.SetPosition(self.GetWidth() / 2, self.GetHeight() / 2)
-		else:
-			textLine.SetPosition(pos_x, pos_y)
-
-		textLine.SetVerticalAlignCenter()
-		if "center" == text_sort:
-			textLine.SetHorizontalAlignCenter()
-		elif "right" == text_sort:
-			textLine.SetHorizontalAlignRight()
-		elif "left" == text_sort:
-			textLine.SetHorizontalAlignLeft()
-
-		self.TextChild.append(textLine)
-
-	def SetFormToolTipText(self, type, text, x, y):
-		if not self.ToolTipText:
-			toolTip = createToolTipWindowDict[type]()
-			toolTip.SetParent(self)
-			toolTip.SetSize(0, 0)
-			toolTip.SetHorizontalAlignCenter()
-			if app.WJ_MULTI_TEXTLINE:
-				toolTip.DisableEnterToken()
-			toolTip.SetOutline()
-			toolTip.Hide()
-			toolTip.SetPosition(x + self.GetWidth() / 2, y)
-			self.ToolTipText = toolTip
-
-		self.ToolTipText.SetText(text)
-
-	def SetToolTipWindow(self, toolTip):
-		self.ToolTipText = toolTip
-		self.ToolTipText.SetParentProxy(self)
-
-	def SetToolTipText(self, text, x = 0, y = -19):
-		self.SetFormToolTipText("TEXT", text, x, y)
-
-	def CallEvent(self):
-		snd.PlaySound("sound/ui/click.wav")
-
-		if self.eventFunc:
-			apply(self.eventFunc, self.eventArgs)
-
-	def ShowToolTip(self):
-		if self.ToolTipText:
-			self.ToolTipText.Show()
-
-		if self.showtooltipevent:
-			apply(self.showtooltipevent, self.showtooltiparg)
-
-	def HideToolTip(self):
-		if self.ToolTipText:
-			self.ToolTipText.Hide()
-
-		if self.hidetooltipevent:
-			apply(self.hidetooltipevent, self.hidetooltiparg)
-
-	def SetShowToolTipEvent(self, func, *args):
-		self.showtooltipevent = func
-		self.showtooltiparg = args
-
-	def SetHideToolTipEvent(self, func, *args):
-		self.hidetooltipevent = func
-		self.hidetooltiparg = args
-
-	def IsDown(self):
-		return wndMgr.IsDown(self.hWnd)
-
-	def SetAlpha(self, alpha):
-		wndMgr.SetButtonDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
-
-	def GetText(self):
-		if self.ButtonText:
-			return self.ButtonText.GetText()
-		else:
-			return ""
-
-	def IsDisable(self):
-		return wndMgr.IsDisable(self.hWnd)
-
-	def SetScale(self, scale_x, scale_y):
-		wndMgr.SetButtonScale(self.hWnd, scale_x, scale_y)
-
-	def SetDiffuseColor(self, r, g, b, a):
-		wndMgr.SetButtonDiffuseColor(self.hWnd, r, g, b, a)
-
-	#if app.ENABLE_MONSTER_CARD:
-	def SetAlwaysToolTip(self, bFlag):
-		wndMgr.SetAlwaysToolTip(self.hWnd, bFlag)
-
-	if app.ENABLE_DETAILS_UI or app.ENABLE_MINI_GAME_YUTNORI:
-		def OnMouseOverIn(self):
-			if self.overFunc:
-				apply(self.overFunc, self.overArgs)
-
-		def OnMouseOverOut(self):
-			if self.overOutFunc:
-				apply(self.overOutFunc, self.overOutArgs)
-
-		def SetOverEvent(self, func, *args):
-			self.overFunc = func
-			self.overArgs = args
-
-		def SetOverOutEvent(self, func, *args):
-			self.overOutFunc = func
-			self.overOutArgs = args
-
-	if app.ENABLE_MINI_GAME_YUTNORI or app.ENABLE_LUCKY_BOX:
-		def SetButtonScale(self, xScale, yScale):
-			wndMgr.SetButtonScale(self.hWnd, xScale, yScale)
-
-		def GetButtonImageWidth(self):
-			return wndMgr.GetButtonImageWidth(self.hWnd)
-
-		def GetButtonImageHeight(self):
-			return wndMgr.GetButtonImageHeight(self.hWnd)
-
-	def SetTextAddPos(self, text, x_add = 0, y_add = 0, height = 4):
-		if not self.ButtonText:
-			textLine = TextLine()
-			textLine.SetParent(self)
-			textLine.SetPosition(self.GetWidth() / 2 + x_add, self.GetHeight() / 2 + y_add)
-			textLine.SetVerticalAlignCenter()
-			textLine.SetHorizontalAlignCenter()
-			textLine.Show()
-			self.ButtonText = textLine
-		self.ButtonText.SetText(text)
-
-class CheckBoxRefine(Window):
-	def __init__(self):
-		Window.__init__(self)
-		
-		self.backgroundImage = None
-		self.checkImage = None
-
-		self.eventFunc = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
-		self.eventArgs = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
-	
-		self.CreateElements()
-		
-	def __del__(self):
-		Window.__del__(self)
-		
-		self.backgroundImage = None
-		self.checkImage = None
-		
-		self.eventFunc = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
-		self.eventArgs = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
-		
-	def CreateElements(self):
-		self.backgroundImage = ImageBox()
-		self.backgroundImage.SetParent(self)
-		self.backgroundImage.AddFlag("not_pick")
-		self.backgroundImage.SetPosition(0, -2)
-		self.backgroundImage.LoadImage("d:/ymir work/ui/game/checkbox/checkbox.tga")
-		self.backgroundImage.Show()
-		
-		self.checkImage = ImageBox()
-		self.checkImage.SetParent(self)
-		self.checkImage.AddFlag("not_pick")
-		self.checkImage.SetPosition(0, -2)
-		self.checkImage.LoadImage("d:/ymir work/ui/game/checkbox/checked.tga")
-		self.checkImage.Hide()
-		
-		self.textInfo = TextLine()
-		self.textInfo.SetParent(self)
-		self.textInfo.SetPosition(20, -2)
-		self.textInfo.Show()
-		
-		self.SetSize(self.backgroundImage.GetWidth() + self.textInfo.GetTextSize()[0], self.backgroundImage.GetHeight() + self.textInfo.GetTextSize()[1])
-		
-	def SetTextInfo(self, info):
-		if self.textInfo:
-			self.textInfo.SetText(info)
-			
-		self.SetSize(self.backgroundImage.GetWidth() + self.textInfo.GetTextSize()[0], self.backgroundImage.GetHeight() + self.textInfo.GetTextSize()[1])
-		
-	def SetCheckStatus(self, flag):
-		if flag:
-			self.checkImage.Show()
-		else:
-			self.checkImage.Hide()
-	
-	def GetCheckStatus(self):
-		if self.checkImage:
-			return self.checkImage.IsShow()
-			
-		return False
-		
-	def SetEvent(self, func, *args) :
-		result = self.eventFunc.has_key(args[0])		
-		if result :
-			self.eventFunc[args[0]] = func
-			self.eventArgs[args[0]] = args
-		else :
-			print "[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0]
-		
-	def OnMouseLeftButtonUp(self):
-		if self.checkImage:
-			if self.checkImage.IsShow():
-				self.checkImage.Hide()
-
-				if self.eventFunc["ON_UNCKECK"]:
-					apply(self.eventFunc["ON_UNCKECK"], self.eventArgs["ON_UNCKECK"])
-			else:
-				self.checkImage.Show()
-
-				if self.eventFunc["ON_CHECK"]:
-					apply(self.eventFunc["ON_CHECK"], self.eventArgs["ON_CHECK"])
-
-class RadioButton(Button):
-	def __init__(self):
-		Button.__init__(self)
-
-	def __del__(self):
-		Button.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterRadioButton(self, layer)
-
-class RadioButtonGroup:
-	def __init__(self):
-		self.buttonGroup = []
-		self.selectedBtnIdx = -1
-
-	def __del__(self):
-		self.buttonGroup = []
-		self.selectedBtnIdx = -1
-
-	def Show(self):
-		for (button, selectEvent, unselectEvent) in self.buttonGroup:
-			button.Show()
-
-	def Hide(self):
-		for (button, selectEvent, unselectEvent) in self.buttonGroup:
-			button.Hide()
-
-	def SetText(self, idx, text):
-		if idx >= len(self.buttonGroup):
-			return
-		(button, selectEvent, unselectEvent) = self.buttonGroup[idx]
-		button.SetText(text)
-
-	def OnClick(self, btnIdx):
-		if btnIdx == self.selectedBtnIdx:
-			return
-		(button, selectEvent, unselectEvent) = self.buttonGroup[self.selectedBtnIdx]
-		if unselectEvent:
-			unselectEvent(self.selectedBtnIdx)
-		button.SetUp()
-
-		self.selectedBtnIdx = btnIdx
-		(button, selectEvent, unselectEvent) = self.buttonGroup[btnIdx]
-		if selectEvent:
-			selectEvent(btnIdx)
-
-		button.Down()
-
-	def AddButton(self, button, selectEvent, unselectEvent):
-		i = len(self.buttonGroup)
-		button.SetEvent(__mem_func__(self.OnClick),i)
-		self.buttonGroup.append([button, selectEvent, unselectEvent])
-		button.SetUp()
-
-	def Create(rawButtonGroup):
-		radioGroup = RadioButtonGroup()
-		for (button, selectEvent, unselectEvent) in rawButtonGroup:
-			radioGroup.AddButton(button, selectEvent, unselectEvent)
-
-		radioGroup.OnClick(0)
-
-		return radioGroup
-
-	Create=staticmethod(Create)
-
-class ToggleButton(Button):
-	def __init__(self):
-		Button.__init__(self)
-
-		self.eventUp = None
-		self.eventDown = None
-
-		self.eventUpArgs = None
-		self.eventDownArgs = None
-
-	def __del__(self):
-		Button.__del__(self)
-
-		self.eventUp = None
-		self.eventDown = None
-
-	def SetToggleUpEvent(self, event, *args):
-		self.eventUp = event
-		self.eventUpArgs = args
-
-	def SetToggleDownEvent(self, event, *args):
-		self.eventDown = event
-		self.eventDownArgs = args
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterToggleButton(self, layer)
-
-	def OnToggleUp(self):
-		if self.eventUp:
-			if self.eventUpArgs:
-				apply(self.eventUp, self.eventUpArgs)
-			else:
-				self.eventUp()
-
-	def OnToggleDown(self):
-		if self.eventDown:
-			if self.eventDownArgs:
-				apply(self.eventDown, self.eventDownArgs)
-			else:
-				self.eventDown()
-
-class DragButton(Button):
-	def __init__(self):
-		Button.__init__(self)
-		self.AddFlag("movable")
-
-		self.callbackEnable = True
-		self.eventMove = lambda: None
-
-	def __del__(self):
-		Button.__del__(self)
-
-		self.eventMove = lambda: None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterDragButton(self, layer)
-
-	def SetMoveEvent(self, event):
-		self.eventMove = event
-
-	def SetRestrictMovementArea(self, x, y, width, height):
-		wndMgr.SetRestrictMovementArea(self.hWnd, x, y, width, height)
-
-	def TurnOnCallBack(self):
-		self.callbackEnable = True
-
-	def TurnOffCallBack(self):
-		self.callbackEnable = False
-
-	def OnMove(self):
-		if self.callbackEnable:
-			self.eventMove()
-
-class NumberLine(Window):
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterNumberLine(self, layer)
-
-	def SetHorizontalAlignCenter(self):
-		wndMgr.SetNumberHorizontalAlignCenter(self.hWnd)
-
-	def SetHorizontalAlignRight(self):
-		wndMgr.SetNumberHorizontalAlignRight(self.hWnd)
-
-	def SetPath(self, path):
-		wndMgr.SetPath(self.hWnd, path)
-
-	if app.ENABLE_CHEQUE_SYSTEM:
-		def SetNumber(self, number, r = 1.0, g = 1.0, b = 1.0):
-			wndMgr.SetNumber(self.hWnd, number, r, g, b)
-	else:
-		def SetNumber(self, number):
-			wndMgr.SetNumber(self.hWnd, number)
-
-###################################################################################################
-## PythonScript Element
-###################################################################################################
-
-class Box(Window):
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterBox(self, layer)
-
-	def SetColor(self, color):
-		wndMgr.SetColor(self.hWnd, color)
-
-class Bar(Window):
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterBar(self, layer)
-
-	def SetColor(self, color):
-		wndMgr.SetColor(self.hWnd, color)
-
-class Line(Window):
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterLine(self, layer)
-
-	def SetColor(self, color):
-		wndMgr.SetColor(self.hWnd, color)
-
-class SlotBar(Window):
-
-	def __init__(self):
-		Window.__init__(self)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterBar3D(self, layer)
-
-## Same with SlotBar
-class Bar3D(Window):
-	def __init__(self):
-		Window.__init__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterBar3D(self, layer)
-
-	def SetColor(self, left, right, center):
-		wndMgr.SetColor(self.hWnd, left, right, center)
-
-class SlotWindow(Window):
-	def __init__(self):
-		Window.__init__(self)
-
-		self.StartIndex = 0
-
-		self.eventSelectEmptySlot = None
-		self.eventSelectItemSlot = None
-		self.eventUnselectEmptySlot = None
-		self.eventUnselectItemSlot = None
-		self.eventUseSlot = None
-		self.eventOverInItem = None
-		self.eventOverOutItem = None
-		self.eventPressedSlotButton = None
-
-		if app.ENABLE_EXTEND_INVEN_SYSTEM:
-			self.eventSelectEmptySlotWindow = None
-			self.eventSelectItemSlotWindow = None
-			self.eventUseSlotWindow = None
-			self.eventOverInItemSlotWindow = None
-			self.eventUnselectItemSlotWindow = None
-
-		self.eventSelectItemSlotArgs = None
-		self.eventOverInItemArgs = None
-
-	def __del__(self):
-		Window.__del__(self)
-
-		self.eventSelectEmptySlot = None
-		self.eventSelectItemSlot = None
-		self.eventUnselectEmptySlot = None
-		self.eventUnselectItemSlot = None
-		self.eventUseSlot = None
-		self.eventOverInItem = None
-		self.eventOverOutItem = None
-		self.eventPressedSlotButton = None
-
-		if app.ENABLE_EXTEND_INVEN_SYSTEM:
-			self.eventSelectEmptySlotWindow = None
-			self.eventSelectItemSlotWindow = None
-			self.eventUseSlotWindow = None
-			self.eventOverInItemSlotWindow = None
-			self.eventUnselectItemSlotWindow = None
-
-		self.eventSelectItemSlotArgs = None
-		self.eventOverInItemArgs = None
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterSlotWindow(self, layer)
-
-	def SetSlotStyle(self, style):
-		wndMgr.SetSlotStyle(self.hWnd, style)
-
-	def HasSlot(self, slotIndex):
-		return wndMgr.HasSlot(self.hWnd, slotIndex)
-
-	if app.ENABLE_GROWTH_PET_SYSTEM:
-		def SetSlotScale(self, xScale, yScale):
-			wndMgr.SetSlotScale(self.hWnd, xScale, yScale)
-
-	def HideSlotButton(self, slot_number):
-		wndMgr.HideSlotButton(self.hWnd, slot_number)
-
-	if app.ENABLE_SLOT_SCALE:
-		def SetSlotScale(self, xScale, yScale):
-			wndMgr.SetSlotScale(self.hWnd, xScale, yScale)
-
-		def SetSlotImage(self, slot_index, filename):
-			wndMgr.SetSlotImage(self.hWnd, slot_index, filename)
-
-	def SetSlotBaseImage(self, imageFileName, r, g, b, a):
-		wndMgr.SetSlotBaseImage(self.hWnd, imageFileName, r, g, b, a)
-
-	if app.ENABLE_GROWTH_PET_SYSTEM:
-		def SetSlotBaseImageScale(self, imageFileName, r, g, b, a, sx, sy):
-			wndMgr.SetSlotBaseImageScale(self.hWnd, imageFileName, r, g, b, a, sx, sy)
-
-	def SetBaseImageScale(self, xScale, yScale):
-		wndMgr.SetBaseImageScale(self.hWnd, xScale, yScale)
-
-	def SetCoverButton(self,\
-						slotIndex,\
-						upName="d:/ymir work/ui/public/slot_cover_button_01.sub",\
-						overName="d:/ymir work/ui/public/slot_cover_button_02.sub",\
-						downName="d:/ymir work/ui/public/slot_cover_button_03.sub",\
-						disableName="d:/ymir work/ui/public/slot_cover_button_04.sub",\
-						LeftButtonEnable = False,\
-						RightButtonEnable = True):
-		wndMgr.SetCoverButton(self.hWnd, slotIndex, upName, overName, downName, disableName, LeftButtonEnable, RightButtonEnable)
-
-	def SetCorverButtonScale(self, slotIndex, xScale, yScale):
-		wndMgr.SetCorverButtonScale(self.hWnd, slotIndex, xScale, yScale)
-
-	def EnableCoverButton(self, slotIndex):
-		wndMgr.EnableCoverButton(self.hWnd, slotIndex)
-
-	def DisableCoverButton(self, slotIndex):
-		wndMgr.DisableCoverButton(self.hWnd, slotIndex)
-
-	def SetAlwaysRenderCoverButton(self, slotIndex, bAlwaysRender = True):
-		wndMgr.SetAlwaysRenderCoverButton(self.hWnd, slotIndex, bAlwaysRender)
-
-	def AppendSlotButton(self, upName, overName, downName):
-		wndMgr.AppendSlotButton(self.hWnd, upName, overName, downName)
-
-	def ShowSlotButton(self, slotNumber):
-		wndMgr.ShowSlotButton(self.hWnd, slotNumber)
-
-	def HideAllSlotButton(self):
-		wndMgr.HideAllSlotButton(self.hWnd)
-
-	def AppendRequirementSignImage(self, filename):
-		wndMgr.AppendRequirementSignImage(self.hWnd, filename)
-
-	def ShowRequirementSign(self, slotNumber):
-		wndMgr.ShowRequirementSign(self.hWnd, slotNumber)
-
-	def HideRequirementSign(self, slotNumber):
-		wndMgr.HideRequirementSign(self.hWnd, slotNumber)
-
-	def ActivateSlot(self, slotNumber):
-		wndMgr.ActivateSlot(self.hWnd, slotNumber)
-
-	def DeactivateSlot(self, slotNumber):
-		wndMgr.DeactivateSlot(self.hWnd, slotNumber)
-
-	if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-		def SetSlotDiffuseColor(self, slotindex, colortype):
-			wndMgr.SetSlotDiffuseColor(self.hWnd, slotindex, colortype)
-
-	def SetSlotHighlightedGreeen(self, slotNumber):
-		wndMgr.SetSlotHighlightedGreeen(self.hWnd, slotNumber)
-
-	def DisableSlotHighlightedGreen(self, slotNumber):
-		wndMgr.DisableSlotHighlightedGreen(self.hWnd, slotNumber)
-
-	def ShowSlotBaseImage(self, slotNumber):
-		wndMgr.ShowSlotBaseImage(self.hWnd, slotNumber)
-
-	def HideSlotBaseImage(self, slotNumber):
-		wndMgr.HideSlotBaseImage(self.hWnd, slotNumber)
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def SAFE_SetButtonEvent(self, button, state, event, window = None):
-			if "LEFT" == button:
-				if "EMPTY" == state:
-					self.eventSelectEmptySlot = __mem_func__(event)
-					self.eventSelectEmptySlotWindow = window
-				elif "EXIST" == state:
-					self.eventSelectItemSlot = __mem_func__(event)
-					self.eventSelectItemSlotWindow = window
-				elif "ALWAYS" == state:
-					self.eventSelectEmptySlot = __mem_func__(event)
-					self.eventSelectEmptySlotWindow = window
-					self.eventSelectItemSlot = __mem_func__(event)
-					self.eventSelectItemSlotWindow = window
-			elif "RIGHT" == button:
-				if "EMPTY" == state:
-					self.eventUnselectEmptySlot = __mem_func__(event)
-				elif "EXIST" == state:
-					self.eventUnselectItemSlot = __mem_func__(event)
-					self.eventUnselectItemSlotWindow = window
-				elif "ALWAYS" == state:
-					self.eventUnselectEmptySlot = __mem_func__(event)
-					self.eventUnselectItemSlot = __mem_func__(event)
-					self.eventUnselectItemSlotWindow = window
-	else:
-		def SAFE_SetButtonEvent(self, button, state, event):
-			if "LEFT" == button:
-				if "EMPTY" == state:
-					self.eventSelectEmptySlot = __mem_func__(event)
-				elif "EXIST" == state:
-					self.eventSelectItemSlot = __mem_func__(event)
-				elif "ALWAYS" == state:
-					self.eventSelectEmptySlot = __mem_func__(event)
-					self.eventSelectItemSlot = __mem_func__(event)
-			elif "RIGHT" == button:
-				if "EMPTY" == state:
-					self.eventUnselectEmptySlot = __mem_func__(event)
-				elif "EXIST" == state:
-					self.eventUnselectItemSlot = __mem_func__(event)
-				elif "ALWAYS" == state:
-					self.eventUnselectEmptySlot = __mem_func__(event)
-					self.eventUnselectItemSlot = __mem_func__(event)
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def SetSelectEmptySlotEvent(self, empty, window = None):
-			self.eventSelectEmptySlot = empty
-			self.eventSelectEmptySlotWindow = window
-	else:
-		def SetSelectEmptySlotEvent(self, empty):
-			self.eventSelectEmptySlot = empty
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def SetSelectItemSlotEvent(self, item, window = None, *args):
-			self.eventSelectItemSlot = item
-			self.eventSelectItemSlotWindow = window
-			self.eventSelectItemSlotArgs = args
-	else:
-		def SetSelectItemSlotEvent(self, item, *args):
-			self.eventSelectItemSlot = item
-			self.eventSelectItemSlotArgs = args
-
-	def SetUnselectEmptySlotEvent(self, empty):
-		self.eventUnselectEmptySlot = empty
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def SetUnselectItemSlotEvent(self, item, window = None):
-			self.eventUnselectItemSlot = item
-			self.eventUnselectItemSlotWindow = window
-	else:
-		def SetUnselectItemSlotEvent(self, item):
-			self.eventUnselectItemSlot = item
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def SetUseSlotEvent(self, use, window = None):
-			self.eventUseSlot = use
-			self.eventUseSlotWindow = window
-	else:
-		def SetUseSlotEvent(self, use):
-			self.eventUseSlot = use
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def SetOverInItemEvent(self, event, window = None, *args):
-			self.eventOverInItem = event
-			self.eventOverInItemArgs = args
-			self.eventOverInItemSlotWindow = window
-	else:
-		def SetOverInItemEvent(self, event, *args):
-			self.eventOverInItem = event
-			self.eventOverInItemArgs = args
-
-	def SetOverOutItemEvent(self, event):
-		self.eventOverOutItem = event
-
-	def SetPressedSlotButtonEvent(self, event):
-		self.eventPressedSlotButton = event
-
-	def GetSlotCount(self):
-		return wndMgr.GetSlotCount(self.hWnd)
-
-	def SetUseMode(self, flag):
-		"TrueÀÏ¶§¸¸ ItemToItem ÀÌ °¡´ÉÇÑÁö º¸¿©ÁØ´Ù"
-		wndMgr.SetUseMode(self.hWnd, flag)
-
-	def SetUsableItem(self, flag):
-		"True¸é ÇöÀç °¡¸®Å² ¾ÆÀÌÅÛÀÌ ItemToItem Àû¿ë °¡´ÉÇÏ´Ù"
-		wndMgr.SetUsableItem(self.hWnd, flag)
-
-	## Slot
-	def SetSlotCoolTime(self, slotIndex, coolTime, elapsedTime = 0.0):
-		wndMgr.SetSlotCoolTime(self.hWnd, slotIndex, coolTime, elapsedTime)
-
-	def SetSlotCoolTimeColor(self, slotIndex, r, g, b, a):
-		wndMgr.SetSlotCoolTimeColor(self.hWnd, slotIndex, r, g, b, a)
-
-	if app.ENABLE_SLOT_COOLTIME_REFRESH_FIX:
-		def StoreSlotCoolTime(self, key, slotIndex, coolTime, elapsedTime = 0.0):
-			wndMgr.StoreSlotCoolTime(self.hWnd, key, slotIndex, coolTime, elapsedTime)
-
-		def RestoreSlotCoolTime(self, key):
-			wndMgr.RestoreSlotCoolTime(self.hWnd, key)
-
-	#if app.ENABLE_GROWTH_PET_SYSTEM:
-	def SetSlotCoolTimeInverse(self, slotIndex, coolTime, elapsedTime = 0.0):
-		wndMgr.SetSlotCoolTimeInverse(self.hWnd, slotIndex, coolTime, elapsedTime)
-
-	if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_MAILBOX:
-		def SetCanMouseEventSlot(self, slotIndex):
-			wndMgr.SetCanMouseEventSlot(self.hWnd, slotIndex)
-
-		def SetCantMouseEventSlot(self, slotIndex):
-			wndMgr.SetCantMouseEventSlot(self.hWnd, slotIndex)
-
-		def SetUnusableSlotOnTopWnd(self, slotIndex):
-			wndMgr.SetUnusableSlotOnTopWnd(self.hWnd, slotIndex)
-
-		def SetUsableSlotOnTopWnd(self, slotIndex):
-			wndMgr.SetUsableSlotOnTopWnd(self.hWnd, slotIndex)
-
-	def IsActiveSlot(self, slot_index):
-		return wndMgr.IsActiveSlot(self.hWnd, slot_index)
-
-	def DisableSlot(self, slotIndex):
-		wndMgr.DisableSlot(self.hWnd, slotIndex)
-
-	def EnableSlot(self, slotIndex):
-		wndMgr.EnableSlot(self.hWnd, slotIndex)
-
-	def LockSlot(self, slotIndex):
-		wndMgr.LockSlot(self.hWnd, slotIndex)
-
-	def UnlockSlot(self, slotIndex):
-		wndMgr.UnlockSlot(self.hWnd, slotIndex)
-
-	def RefreshSlot(self):
-		wndMgr.RefreshSlot(self.hWnd)
-
-	def ClearSlot(self, slotNumber):
-		wndMgr.ClearSlot(self.hWnd, slotNumber)
-
-	def ClearAllSlot(self):
-		wndMgr.ClearAllSlot(self.hWnd)
-
-	def AppendSlot(self, index, x, y, width, height):
-		wndMgr.AppendSlot(self.hWnd, index, x, y, width, height)
-
-	def SetSlot(self, slotIndex, itemIndex, width, height, icon, diffuseColor = (1.0, 1.0, 1.0, 1.0)):
-		wndMgr.SetSlot(self.hWnd, slotIndex, itemIndex, width, height, icon, diffuseColor)
-
-	def SetSlotCount(self, slotNumber, count):
-		wndMgr.SetSlotCount(self.hWnd, slotNumber, count)
-
-	def SetRealSlotNumber(self, slotNumber, realSlotNumber):
-		wndMgr.SetSlotRealNumber(self.hWnd, slotNumber, realSlotNumber)
-
-	def SetSlotCountNew(self, slotNumber, grade, count):
-		wndMgr.SetSlotCountNew(self.hWnd, slotNumber, grade, count)
-
-	def SetItemSlot(self, renderingSlotNumber, ItemIndex, ItemCount = 0, diffuseColor = (1.0, 1.0, 1.0, 1.0)):
-		if 0 == ItemIndex or None == ItemIndex:
-			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
-			return
-
-		item.SelectItem(ItemIndex)
-		itemIcon = item.GetIconImage()
-
-		item.SelectItem(ItemIndex)
-		(width, height) = item.GetItemSize()
-
-		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, ItemIndex, width, height, itemIcon, diffuseColor)
-		wndMgr.SetSlotCount(self.hWnd, renderingSlotNumber, ItemCount)
-
-	def SetSkillSlot(self, renderingSlotNumber, skillIndex, skillLevel):
-		skillIcon = skill.GetIconImage(skillIndex)
-
-		if 0 == skillIcon:
-			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
-			return
-
-		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, skillIndex, 1, 1, skillIcon)
-		wndMgr.SetSlotCount(self.hWnd, renderingSlotNumber, skillLevel)
-
-	def SetSkillSlotNew(self, renderingSlotNumber, skillIndex, skillGrade, skillLevel):
-
-		skillIcon = skill.GetIconImageNew(skillIndex, skillGrade)
-
-		if 0 == skillIcon:
-			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
-			return
-
-		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, skillIndex, 1, 1, skillIcon)
-
-	def SetEmotionSlot(self, renderingSlotNumber, emotionIndex):
-		import player
-		icon = player.GetEmotionIconImage(emotionIndex)
-
-		if 0 == icon:
-			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
-			return
-
-		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, emotionIndex, 1, 1, icon)
-
-	## Event
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def OnSelectEmptySlot(self, slotNumber):
-			if self.eventSelectEmptySlot:
-				if self.eventSelectEmptySlotWindow:
-					self.eventSelectEmptySlot(slotNumber, self.eventSelectEmptySlotWindow)
-				else:
-					self.eventSelectEmptySlot(slotNumber)
-	else:
-		def OnSelectEmptySlot(self, slotNumber):
-			if self.eventSelectEmptySlot:
-				self.eventSelectEmptySlot(slotNumber)
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def OnSelectItemSlot(self, slotNumber):
-			if self.eventSelectItemSlot:
-				if self.eventSelectItemSlotWindow:
-					if self.eventSelectItemSlotArgs:
-						apply(self.eventSelectItemSlot, self.eventSelectItemSlotArgs)
-					else:
-						self.eventSelectItemSlot(slotNumber, self.eventSelectItemSlotWindow)
-				else:
-					if self.eventSelectItemSlotArgs:
-						apply(self.eventSelectItemSlot, self.eventSelectItemSlotArgs)
-					else:
-						self.eventSelectItemSlot(slotNumber)
-	else:
-		def OnSelectItemSlot(self, slotNumber):
-			if self.eventSelectItemSlot:
-				if self.eventSelectItemSlotArgs:
-					apply(self.eventSelectItemSlot, self.eventSelectItemSlotArgs)
-				else:
-					self.eventSelectItemSlot(slotNumber)
-
-	def OnUnselectEmptySlot(self, slotNumber):
-		if self.eventUnselectEmptySlot:
-			self.eventUnselectEmptySlot(slotNumber)
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def OnUnselectItemSlot(self, slotNumber):
-			if self.eventUnselectItemSlot:
-				if self.eventUnselectItemSlotWindow:
-					self.eventUnselectItemSlot(slotNumber, self.eventUnselectItemSlotWindow)
-				else:
-					self.eventUnselectItemSlot(slotNumber)
-	else:
-		def OnUnselectItemSlot(self, slotNumber):
-			if self.eventUnselectItemSlot:
-				self.eventUnselectItemSlot(slotNumber)
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def OnUseSlot(self, slotNumber):
-			if self.eventUseSlot:
-				if self.eventUseSlotWindow:
-					self.eventUseSlot(slotNumber, self.eventUseSlotWindow)
-				else:
-					self.eventUseSlot(slotNumber)
-	else:
-		def OnUseSlot(self, slotNumber):
-			if self.eventUseSlot:
-				self.eventUseSlot(slotNumber)
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def OnOverInItem(self, slotNumber):
-			if self.eventOverInItem:
-				if None == self.eventOverInItemSlotWindow:
-					if self.eventOverInItemArgs:
-						apply(self.eventOverInItem, self.eventOverInItemArgs)
-					else:
-						self.eventOverInItem(slotNumber)
-				else:
-					if self.eventOverInItemArgs:
-						apply(self.eventOverInItem, self.eventOverInItemArgs)
-					else:
-						self.eventOverInItem(slotNumber, self.eventOverInItemSlotWindow)
-	else:
-		def OnOverInItem(self, slotNumber):
-			if self.eventOverInItem:
-				if self.eventOverInItemArgs:
-					apply(self.eventOverInItem, self.eventOverInItemArgs)
-				else:
-					self.eventOverInItem(slotNumber)
-
-	def OnOverOutItem(self):
-		if self.eventOverOutItem:
-			self.eventOverOutItem()
-
-	def OnPressedSlotButton(self, slotNumber):
-		if self.eventPressedSlotButton:
-			self.eventPressedSlotButton(slotNumber)
-
-	def GetStartIndex(self):
-		return 0
-
-	def GetSlotGlobalPosition(self, index):
-		return wndMgr.GetSlotGlobalPosition(self.hWnd, index)
-
-	def GetSlotLocalPosition(self, index):
-		return wndMgr.GetSlotLocalPosition(self.hWnd, index)
-
-	def SetSlotCoverImage(self, slotindex, filename):
-		wndMgr.SetSlotCoverImage(self.hWnd, slotindex, filename)
-
-	def EnableSlotCoverImage(self, slotindex, onoff):
-		wndMgr.EnableSlotCoverImage(self.hWnd, slotindex, onoff)
-
-	def SetSecondSlotCoverImage(self, slot_index, filename):
-		wndMgr.SetSecondSlotCoverImage(self.hWnd, slot_index, filename)
-
-	def EnableSecondSlotCoverImage(self, slot_index, onoff):
-		wndMgr.EnableSecondSlotCoverImage(self.hWnd, slot_index, onoff)
-
-	def SetSlotType(self, flag):
-		wndMgr.SetSlotType(self.hWnd, flag)
-
-	if app.ENABLE_HIGH_LIGHT_IMAGE:
-		def AppendHighLightImage(self, index, fileName, alphaSpeed = 0.0, rotationSpeed = 0.0, curAlpha = 1.0, diffuse = 0xFFFFFFFF):
-			wndMgr.AppendHighLightImage(self.hWnd, index, fileName, alphaSpeed, rotationSpeed, curAlpha, diffuse)
-
-		def EnableHighLightImage(self, slotIndex):
-			wndMgr.EnableHighLightImage(self.hWnd, slotIndex)
-
-		def DisableHighLightImage(self, slotIndex):
-			wndMgr.DisableHighLightImage(self.hWnd, slotIndex)
-
-	if app.ENABLE_GROWTH_PET_SYSTEM:
-		def SetSlotCoolTimeInverse(self, slotIndex, coolTime, elapsedTime = 0.0):
-			wndMgr.SetSlotCoolTimeInverse(self.hWnd, slotIndex, coolTime, elapsedTime)
-
-		def SetPetSkillSlotNew(self, renderingSlotNumber, petSkillIndex):
-		
-			petSkillIcon = skill.GetPetSkillIconImage(petSkillIndex)
-
-			if 0 == petSkillIcon:
-				wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
-				return
-
-			wndMgr.SetSlot(self.hWnd, renderingSlotNumber, petSkillIndex, 1, 1, petSkillIcon)
-
-class GridSlotWindow(SlotWindow):
-
-	def __init__(self):
-		SlotWindow.__init__(self)
-
-		self.startIndex = 0
-
-	def __del__(self):
-		SlotWindow.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterGridSlotWindow(self, layer)
-
-	def ArrangeSlot(self, StartIndex, xCount, yCount, xSize, ySize, xBlank, yBlank):
-
-		self.startIndex = StartIndex
-
-		wndMgr.ArrangeSlot(self.hWnd, StartIndex, xCount, yCount, xSize, ySize, xBlank, yBlank)
-		self.startIndex = StartIndex
-
-	def GetStartIndex(self):
-		return self.startIndex
-
-class TitleBar(Window):
-
-	BLOCK_WIDTH = 32
-	BLOCK_HEIGHT = 23
-
-	def __init__(self):
-		Window.__init__(self)
-		self.AddFlag("attach")
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def MakeTitleBar(self, width, color):
-
-		## ÇöÀç Color´Â »ç¿ëÇÏ°í ÀÖÁö ¾ÊÀ½
-
-		width = max(64, width)
-
-		imgLeft = ImageBox()
-		imgCenter = ExpandedImageBox()
-		imgRight = ImageBox()
-		imgLeft.AddFlag("not_pick")
-		imgCenter.AddFlag("not_pick")
-		imgRight.AddFlag("not_pick")
-		imgLeft.SetParent(self)
-		imgCenter.SetParent(self)
-		imgRight.SetParent(self)
-
-		if localeInfo.IsARABIC():
-			imgLeft.LoadImage("locale/ae/ui/pattern/titlebar_left.tga")
-			imgCenter.LoadImage("locale/ae/ui/pattern/titlebar_center.tga")
-			imgRight.LoadImage("locale/ae/ui/pattern/titlebar_right.tga")
-		else:
-			imgLeft.LoadImage("d:/ymir work/ui/pattern/titlebar_left.tga")
-			imgCenter.LoadImage("d:/ymir work/ui/pattern/titlebar_center.tga")
-			imgRight.LoadImage("d:/ymir work/ui/pattern/titlebar_right.tga")
-
-		imgLeft.Show()
-		imgCenter.Show()
-		imgRight.Show()
-
-		btnClose = Button()
-		btnClose.SetParent(self)
-		btnClose.SetUpVisual("d:/ymir work/ui/public/close_button_01.sub")
-		btnClose.SetOverVisual("d:/ymir work/ui/public/close_button_02.sub")
-		btnClose.SetDownVisual("d:/ymir work/ui/public/close_button_03.sub")
-		btnClose.SetToolTipText(localeInfo.UI_CLOSE, 0, -23)
-		btnClose.Show()
-
-		self.imgLeft = imgLeft
-		self.imgCenter = imgCenter
-		self.imgRight = imgRight
-		self.btnClose = btnClose
-
-		self.SetWidth(width)
-
-	def SetWidth(self, width):
-		self.imgCenter.SetRenderingRect(0.0, 0.0, float((width - self.BLOCK_WIDTH*2) - self.BLOCK_WIDTH) / self.BLOCK_WIDTH, 0.0)
-		self.imgCenter.SetPosition(self.BLOCK_WIDTH, 0)
-		self.imgRight.SetPosition(width - self.BLOCK_WIDTH, 0)
-
-		if localeInfo.IsARABIC():
-			self.btnClose.SetPosition(3, 3)
-		else:
-			self.btnClose.SetPosition(width - self.btnClose.GetWidth() - 3, 3)
-
-		self.SetSize(width, self.BLOCK_HEIGHT)
-
-	def SetCloseEvent(self, event):
-		self.btnClose.SetEvent(event)
-
-	if app.ENABLE_CHANGED_ATTR or app.ENABLE_DETAILS_UI or app.ENABLE_LUCKY_BOX:
-		def CloseButtonHide(self):
-			if localeInfo.IsARABIC():
-				self.imgLeft.LoadImage("d:/ymir work/ui/pattern/titlebar_right_02.tga")
-				self.imgLeft.LeftRightReverse()
-				self.btnClose.Hide()
-			else:
-				self.imgRight.LoadImage("d:/ymir work/ui/pattern/titlebar_right_02.tga")
-				self.btnClose.Hide()
-
-class HorizontalBar(Window):
-	BLOCK_WIDTH = 32
-	BLOCK_HEIGHT = 17
-
-	def __init__(self):
-		Window.__init__(self)
-		self.AddFlag("attach")
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def Create(self, width):
-
-		width = max(96, width)
-
-		imgLeft = ImageBox()
-		imgLeft.SetParent(self)
-		imgLeft.AddFlag("not_pick")
-		imgLeft.LoadImage("d:/ymir work/ui/pattern/horizontalbar_left.tga")
-		imgLeft.Show()
-
-		imgCenter = ExpandedImageBox()
-		imgCenter.SetParent(self)
-		imgCenter.AddFlag("not_pick")
-		imgCenter.LoadImage("d:/ymir work/ui/pattern/horizontalbar_center.tga")
-		imgCenter.Show()
-
-		imgRight = ImageBox()
-		imgRight.SetParent(self)
-		imgRight.AddFlag("not_pick")
-		imgRight.LoadImage("d:/ymir work/ui/pattern/horizontalbar_right.tga")
-		imgRight.Show()
-
-		self.imgLeft = imgLeft
-		self.imgCenter = imgCenter
-		self.imgRight = imgRight
-		self.SetWidth(width)
-
-	def SetWidth(self, width):
-		self.imgCenter.SetRenderingRect(0.0, 0.0, float((width - self.BLOCK_WIDTH*2) - self.BLOCK_WIDTH) / self.BLOCK_WIDTH, 0.0)
-		self.imgCenter.SetPosition(self.BLOCK_WIDTH, 0)
-		self.imgRight.SetPosition(width - self.BLOCK_WIDTH, 0)
-		self.SetSize(width, self.BLOCK_HEIGHT)
-
-class Gauge(Window):
-	SLOT_WIDTH = 16
-	SLOT_HEIGHT = 7
-
-	GAUGE_TEMPORARY_PLACE = 12
-	GAUGE_WIDTH = 16
-
-	def __init__(self):
-		Window.__init__(self)
-		self.width = 0
-	def __del__(self):
-		Window.__del__(self)
-
-	def MakeGauge(self, width, color):
-		self.width = max(48, width)
-
-		imgSlotLeft = ImageBox()
-		imgSlotLeft.SetParent(self)
-		imgSlotLeft.LoadImage("d:/ymir work/ui/pattern/gauge_slot_left.tga")
-		imgSlotLeft.Show()
-
-		imgSlotRight = ImageBox()
-		imgSlotRight.SetParent(self)
-		imgSlotRight.LoadImage("d:/ymir work/ui/pattern/gauge_slot_right.tga")
-		imgSlotRight.Show()
-		imgSlotRight.SetPosition(width - self.SLOT_WIDTH, 0)
-
-		imgSlotCenter = ExpandedImageBox()
-		imgSlotCenter.SetParent(self)
-		imgSlotCenter.LoadImage("d:/ymir work/ui/pattern/gauge_slot_center.tga")
-		imgSlotCenter.Show()
-		imgSlotCenter.SetRenderingRect(0.0, 0.0, float((width - self.SLOT_WIDTH*2) - self.SLOT_WIDTH) / self.SLOT_WIDTH, 0.0)
-		imgSlotCenter.SetPosition(self.SLOT_WIDTH, 0)
-
-		imgGauge = ExpandedImageBox()
-		imgGauge.SetParent(self)
-		imgGauge.LoadImage("d:/ymir work/ui/pattern/gauge_" + color + ".tga")
-		imgGauge.Show()
-		imgGauge.SetRenderingRect(0.0, 0.0, 0.0, 0.0)
-		imgGauge.SetPosition(self.GAUGE_TEMPORARY_PLACE, 0)
-
-		imgSlotLeft.AddFlag("attach")
-		imgSlotCenter.AddFlag("attach")
-		imgSlotRight.AddFlag("attach")
-
-		if app.WJ_SHOW_PARTY_ON_MINIMAP:
-			imgSlotLeft.AddFlag("not_pick")
-			imgSlotCenter.AddFlag("not_pick")
-			imgSlotRight.AddFlag("not_pick")
-			imgGauge.AddFlag("not_pick")
-
-		self.imgLeft = imgSlotLeft
-		self.imgCenter = imgSlotCenter
-		self.imgRight = imgSlotRight
-		self.imgGauge = imgGauge
-
-		self.SetSize(width, self.SLOT_HEIGHT)
-
-	def SetPercentage(self, curValue, maxValue):
-		# PERCENTAGE_MAX_VALUE_ZERO_DIVISION_ERROR
-		if maxValue > 0.0:
-			percentage = min(1.0, float(curValue)/float(maxValue))
-		else:
-			percentage = 0.0
-		# END_OF_PERCENTAGE_MAX_VALUE_ZERO_DIVISION_ERROR
-
-		gaugeSize = -1.0 + float(self.width - self.GAUGE_TEMPORARY_PLACE*2) * percentage / self.GAUGE_WIDTH
-		self.imgGauge.SetRenderingRect(0.0, 0.0, gaugeSize, 0.0)
-
-	if app.WJ_SHOW_PARTY_ON_MINIMAP:
-		def GaugeImgBoxAddFlag(self, flag):
-			self.imgLeft.AddFlag(flag)
-			self.imgCenter.AddFlag(flag)
-			self.imgRight.AddFlag(flag)
-			self.imgGauge.AddFlag(flag)
-
-class Board(Window):
-	CORNER_WIDTH = 32
-	CORNER_HEIGHT = 32
-	LINE_WIDTH = 128
-	LINE_HEIGHT = 128
-
-	LT = 0
-	LB = 1
-	RT = 2
-	RB = 3
-	L = 0
-	R = 1
-	T = 2
-	B = 3
-
-	def __init__(self):
-		Window.__init__(self)
-
-		self.MakeBoard("d:/ymir work/ui/pattern/Board_Corner_", "d:/ymir work/ui/pattern/Board_Line_")
-		self.MakeBase()
-
-	def MakeBoard(self, cornerPath, linePath):
-
-		CornerFileNames = [ cornerPath+dir+".tga" for dir in ("LeftTop", "LeftBottom", "RightTop", "RightBottom", ) ]
-		LineFileNames = [ linePath+dir+".tga" for dir in ("Left", "Right", "Top", "Bottom", ) ]
-		"""
-		CornerFileNames = (
-							"d:/ymir work/ui/pattern/Board_Corner_LeftTop.tga",
-							"d:/ymir work/ui/pattern/Board_Corner_LeftBottom.tga",
-							"d:/ymir work/ui/pattern/Board_Corner_RightTop.tga",
-							"d:/ymir work/ui/pattern/Board_Corner_RightBottom.tga",
-							)
-		LineFileNames = (
-							"d:/ymir work/ui/pattern/Board_Line_Left.tga",
-							"d:/ymir work/ui/pattern/Board_Line_Right.tga",
-							"d:/ymir work/ui/pattern/Board_Line_Top.tga",
-							"d:/ymir work/ui/pattern/Board_Line_Bottom.tga",
-							)
-		"""
-
-		self.Corners = []
-		for fileName in CornerFileNames:
-			Corner = ExpandedImageBox()
-			Corner.AddFlag("not_pick")
-			Corner.LoadImage(fileName)
-			Corner.SetParent(self)
-			Corner.SetPosition(0, 0)
-			Corner.Show()
-			self.Corners.append(Corner)
-
-		self.Lines = []
-		for fileName in LineFileNames:
-			Line = ExpandedImageBox()
-			Line.AddFlag("not_pick")
-			Line.LoadImage(fileName)
-			Line.SetParent(self)
-			Line.SetPosition(0, 0)
-			Line.Show()
-			self.Lines.append(Line)
-
-		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
-		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
-
-	def MakeBase(self):
-		self.Base = ExpandedImageBox()
-		self.Base.AddFlag("not_pick")
-		self.Base.LoadImage("d:/ymir work/ui/pattern/Board_Base.tga")
-		self.Base.SetParent(self)
-		self.Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Base.Show()
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def SetSize(self, width, height):
-		width = max(self.CORNER_WIDTH * 2, width)
-		height = max(self.CORNER_HEIGHT * 2, height)
-		Window.SetSize(self, width, height)
-
-		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
-		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
-		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
-		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
-
-		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
-		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
-		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-
-		if self.Base:
-			self.Base.SetRenderingRect(0, 0, horizontalShowingPercentage, verticalShowingPercentage)
-
-class BorderA(Window):
-	CORNER_WIDTH = 16
-	CORNER_HEIGHT = 16
-	LINE_WIDTH = 16
-	LINE_HEIGHT = 16
-	BOARD_COLOR = grp.GenerateColor(0.17, 0.027, 0.0, 0.70)
-
-
-	LT = 0
-	LB = 1
-	RT = 2
-	RB = 3
-	L = 0
-	R = 1
-	T = 2
-	B = 3
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		CornerFileNames = [ "d:/ymir work/ui/pattern/border_a/border_a_"+dir+".tga" for dir in ["Left_Top","Left_Bottom","Right_Top","Right_Bottom"] ]
-		LineFileNames = [ "d:/ymir work/ui/pattern/border_a/border_a_"+dir+".tga" for dir in ["Left","Right","Top","Bottom"] ]
-		#BaseFileName = "d:/ymir work/ui/pattern/border_a/border_center.tga"
-		
-		self.Corners = []
-		for fileName in CornerFileNames:
-			Corner = ExpandedImageBox()
-			Corner.AddFlag("not_pick")
-			Corner.LoadImage(fileName)
-			Corner.SetParent(self)
-			Corner.SetPosition(0, 0)
-			Corner.Show()
-			self.Corners.append(Corner)
-
-		self.Lines = []
-		for fileName in LineFileNames:
-			Line = ExpandedImageBox()
-			Line.AddFlag("not_pick")
-			Line.LoadImage(fileName)
-			Line.SetParent(self)
-			Line.SetPosition(0, 0)
-			Line.Show()
-			self.Lines.append(Line)
-
-		self.Base = ExpandedImageBox()
-		self.Base.AddFlag("not_pick")
-		self.Base.LoadImage("d:/ymir work/ui/pattern/border_a/border_a_center.tga")
-		self.Base.SetParent(self)
-		self.Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Base.Show()
-		
-		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
-		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def SetSize(self, width, height):
-
-		width = max(self.CORNER_WIDTH*2, width)
-		height = max(self.CORNER_HEIGHT*2, height)
-		Window.SetSize(self, width, height)
-
-		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
-		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
-		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
-		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
-
-		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
-		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
-		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-
-		if self.Base:
-			self.Base.SetRenderingRect(0, 0, horizontalShowingPercentage, verticalShowingPercentage)
-
-	def ShowInternal(self):
-		self.Base.Show()
-		for wnd in self.Lines:
-			wnd.Show()
-		for wnd in self.Corners:
-			wnd.Show()
-
-	def HideInternal(self):
-		self.Base.Hide()
-		for wnd in self.Lines:
-			wnd.Hide()
-		for wnd in self.Corners:
-			wnd.Hide()
-
-class MiddleBoard(Window):
-
-	CORNER_WIDTH = 16
-	CORNER_HEIGHT = 16
-	LINE_WIDTH = 16
-	LINE_HEIGHT = 16
-	BOARD_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 0.7)
-
-	LT = 0
-	LB = 1
-	RT = 2
-	RB = 3
-	L = 0
-	R = 1
-	T = 2
-	B = 3
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		CornerFileNames = [ "d:/ymir work/ui/pattern/ThinBoardB_Corner_" + dir + ".tga" for dir in [ "LeftTop", "LeftBottom", "RightTop", "RightBottom" ] ]
-		LineFileNames = [ "d:/ymir work/ui/pattern/ThinBoardB_Line_" + dir + ".tga" for dir in [ "Left", "Right", "Top", "Bottom" ] ]
-
-		self.Corners = []
-		for fileName in CornerFileNames:
-			Corner = ExpandedImageBox()
-			Corner.AddFlag("attach")
-			Corner.AddFlag("not_pick")
-			Corner.LoadImage(fileName)
-			Corner.SetParent(self)
-			Corner.SetPosition(0, 0)
-			Corner.Show()
-			self.Corners.append(Corner)
-
-		self.Lines = []
-		for fileName in LineFileNames:
-			Line = ExpandedImageBox()
-			Line.AddFlag("attach")
-			Line.AddFlag("not_pick")
-			Line.LoadImage(fileName)
-			Line.SetParent(self)
-			Line.SetPosition(0, 0)
-			Line.Show()
-			self.Lines.append(Line)
-
-		Base = Bar()
-		Base.SetParent(self)
-		Base.AddFlag("attach")
-		Base.AddFlag("not_pick")
-		Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		Base.SetColor(self.BOARD_COLOR)
-		Base.Show()
-		self.Base = Base
-
-		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
-		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def SetSize(self, width, height):
-		width = max(self.CORNER_WIDTH * 2, width)
-		height = max(self.CORNER_HEIGHT * 2, height)
-		Window.SetSize(self, width, height)
-
-		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
-		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
-		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
-		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
-
-		verticalShowingPercentage = float((height - self.CORNER_HEIGHT * 2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
-		horizontalShowingPercentage = float((width - self.CORNER_WIDTH * 2) - self.LINE_WIDTH) / self.LINE_WIDTH
-		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Base.SetSize(width - self.CORNER_WIDTH * 2, height - self.CORNER_HEIGHT * 2)
-
-	def ShowInternal(self):
-		self.Base.Show()
-		for wnd in self.Lines:
-			wnd.Show()
-		for wnd in self.Corners:
-			wnd.Show()
-
-	def HideInternal(self):
-		self.Base.Hide()
-		for wnd in self.Lines:
-			wnd.Hide()
-		for wnd in self.Corners:
-			wnd.Hide()
-
-class BoardWithTitleBar(Board):
-	def __init__(self):
-		Board.__init__(self)
-
-		titleBar = TitleBar()
-		titleBar.SetParent(self)
-		titleBar.MakeTitleBar(0, "red")
-		titleBar.SetPosition(8, 7)
-		titleBar.Show()
-
-		titleName = TextLine()
-		titleName.SetParent(titleBar)
-		titleName.SetPosition(0, 4)
-		titleName.SetWindowHorizontalAlignCenter()
-		titleName.SetHorizontalAlignCenter()
-		titleName.Show()
-
-		self.titleBar = titleBar
-		self.titleName = titleName
-
-		self.SetCloseEvent(self.Hide)
-
-	def __del__(self):
-		Board.__del__(self)
-		self.titleBar = None
-		self.titleName = None
-
-	def SetSize(self, width, height):
-		self.titleBar.SetWidth(width - 15)
-		#self.pickRestrictWindow.SetSize(width, height - 30)
-		Board.SetSize(self, width, height)
-		self.titleName.UpdateRect()
-
-	def SetTitleColor(self, color):
-		self.titleName.SetPackedFontColor(color)
-
-	def SetTitleName(self, name):
-		self.titleName.SetText(name)
-
-	def SetCloseEvent(self, event):
-		self.titleBar.SetCloseEvent(event)
-
-class ThinBoard(Window):
-	CORNER_WIDTH = 16
-	CORNER_HEIGHT = 16
-	LINE_WIDTH = 16
-	LINE_HEIGHT = 16
-	BOARD_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 0.51)
-
-	LT = 0
-	LB = 1
-	RT = 2
-	RB = 3
-	L = 0
-	R = 1
-	T = 2
-	B = 3
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		CornerFileNames = [ "d:/ymir work/ui/pattern/ThinBoard_Corner_"+dir+".tga" for dir in ["LeftTop","LeftBottom","RightTop","RightBottom"] ]
-		LineFileNames = [ "d:/ymir work/ui/pattern/ThinBoard_Line_"+dir+".tga" for dir in ["Left","Right","Top","Bottom"] ]
-
-		self.Corners = []
-		for fileName in CornerFileNames:
-			Corner = ExpandedImageBox()
-			Corner.AddFlag("attach")
-			Corner.AddFlag("not_pick")
-			Corner.LoadImage(fileName)
-			Corner.SetParent(self)
-			Corner.SetPosition(0, 0)
-			Corner.Show()
-			self.Corners.append(Corner)
-
-		self.Lines = []
-		for fileName in LineFileNames:
-			Line = ExpandedImageBox()
-			Line.AddFlag("attach")
-			Line.AddFlag("not_pick")
-			Line.LoadImage(fileName)
-			Line.SetParent(self)
-			Line.SetPosition(0, 0)
-			Line.Show()
-			self.Lines.append(Line)
-
-		Base = Bar()
-		Base.SetParent(self)
-		Base.AddFlag("attach")
-		Base.AddFlag("not_pick")
-		Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		Base.SetColor(self.BOARD_COLOR)
-		Base.Show()
-		self.Base = Base
-
-		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
-		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	if app.ENABLE_SEND_TARGET_INFO:
-		def ShowCorner(self, corner):
-			self.Corners[corner].Show()
-			self.SetSize(self.GetWidth(), self.GetHeight())
-
-		def HideCorners(self, corner):
-			self.Corners[corner].Hide()
-			self.SetSize(self.GetWidth(), self.GetHeight())
-
-		def ShowLine(self, line):
-			self.Lines[line].Show()
-			self.SetSize(self.GetWidth(), self.GetHeight())
-
-		def HideLine(self, line):
-			self.Lines[line].Hide()
-			self.SetSize(self.GetWidth(), self.GetHeight())
-
-	def SetSize(self, width, height):
-		width = max(self.CORNER_WIDTH*2, width)
-		height = max(self.CORNER_HEIGHT*2, height)
-		Window.SetSize(self, width, height)
-
-		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
-		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
-		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
-		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
-
-		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
-		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
-		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Base.SetSize(width - self.CORNER_WIDTH*2, height - self.CORNER_HEIGHT*2)
-
-	def ShowInternal(self):
-		self.Base.Show()
-		for wnd in self.Lines:
-			wnd.Show()
-		for wnd in self.Corners:
-			wnd.Show()
-
-	def HideInternal(self):
-		self.Base.Hide()
-		for wnd in self.Lines:
-			wnd.Hide()
-		for wnd in self.Corners:
-			wnd.Hide()
-
-class ThinBoardGold(Window):
-	CORNER_WIDTH = 16
-	CORNER_HEIGHT = 16
-	LINE_WIDTH = 16
-	LINE_HEIGHT = 16
-
-	LT = 0
-	LB = 1
-	RT = 2
-	RB = 3
-	L = 0
-	R = 1
-	T = 2
-	B = 3
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		CornerFileNames = [ "d:/ymir work/ui/pattern/thinboardgold/ThinBoard_Corner_"+dir+"_Gold.tga" for dir in ["LeftTop","LeftBottom","RightTop","RightBottom"] ]
-		LineFileNames = [ "d:/ymir work/ui/pattern/thinboardgold/ThinBoard_Line_"+dir+"_Gold.tga" for dir in ["Left","Right","Top","Bottom"] ]
-
-		self.MakeBase()
-
-		self.Corners = []
-		for fileName in CornerFileNames:
-			Corner = ExpandedImageBox()
-			Corner.AddFlag("attach")
-			Corner.AddFlag("not_pick")
-			Corner.LoadImage(fileName)
-			Corner.SetParent(self)
-			Corner.SetPosition(0, 0)
-			Corner.Show()
-			self.Corners.append(Corner)
-
-		self.Lines = []
-		for fileName in LineFileNames:
-			Line = ExpandedImageBox()
-			Line.AddFlag("attach")
-			Line.AddFlag("not_pick")
-			Line.LoadImage(fileName)
-			Line.SetParent(self)
-			Line.SetPosition(0, 0)
-			Line.Show()
-			self.Lines.append(Line)
-
-		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
-		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def SetSize(self, width, height):
-
-		width = max(self.CORNER_WIDTH*2, width)
-		height = max(self.CORNER_HEIGHT*2, height)
-		Window.SetSize(self, width, height)
-
-		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
-		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
-		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
-		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
-
-		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
-		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
-
-		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-
-		#self.Base.GetWidth()
-		#self.Base.GetHeight()
-		"""
-			Defalt Width : 128, Height : 128 
-			0.0 > 128, 1.0 > 256 
-		"""
-		if self.Base:
-			self.Base.SetRenderingRect(0, 0, (float(width)-32)/float(self.Base.GetWidth()) - 1.0, (float(height)-32)/float(self.Base.GetHeight()) - 1.0)
-
-	def MakeBase(self):
-		self.Base = ExpandedImageBox()
-		self.Base.AddFlag("not_pick")
-		self.Base.LoadImage("d:/ymir work/ui/pattern/Board_Base.tga")
-		self.Base.SetParent(self)
-		self.Base.SetPosition(16, 16)
-		self.Base.SetAlpha(0.8)
-		self.Base.Show()
-
-	def ShowInternal(self):
-		self.Base.Show()
-		for wnd in self.Lines:
-			wnd.Show()
-		for wnd in self.Corners:
-			wnd.Show()
-
-	def HideInternal(self):
-		self.Base.Hide()
-		for wnd in self.Lines:
-			wnd.Hide()
-		for wnd in self.Corners:
-			wnd.Hide()
-
-class ThinBoardCircle(Window):
-	CORNER_WIDTH = 4
-	CORNER_HEIGHT = 4
-	LINE_WIDTH = 4
-	LINE_HEIGHT = 4
-	BOARD_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 1.0)
-
-	LT = 0
-	LB = 1
-	RT = 2
-	RB = 3
-	L = 0
-	R = 1
-	T = 2
-	B = 3
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-
-		CornerFileNames = [ "d:/ymir work/ui/pattern/thinboardcircle/ThinBoard_Corner_"+dir+"_Circle.tga" for dir in ["LeftTop","LeftBottom","RightTop","RightBottom"] ]
-		LineFileNames = [ "d:/ymir work/ui/pattern/thinboardcircle/ThinBoard_Line_"+dir+"_Circle.tga" for dir in ["Left","Right","Top","Bottom"] ]
-
-		self.Corners = []
-		for fileName in CornerFileNames:
-			Corner = ExpandedImageBox()
-			Corner.AddFlag("attach")
-			Corner.AddFlag("not_pick")
-			Corner.LoadImage(fileName)
-			Corner.SetParent(self)
-			Corner.SetPosition(0, 0)
-			Corner.Show()
-			self.Corners.append(Corner)
-
-		self.Lines = []
-		for fileName in LineFileNames:
-			Line = ExpandedImageBox()
-			Line.AddFlag("attach")
-			Line.AddFlag("not_pick")
-			Line.LoadImage(fileName)
-			Line.SetParent(self)
-			Line.SetPosition(0, 0)
-			Line.Show()
-			self.Lines.append(Line)
-
-		Base = Bar()
-		Base.SetParent(self)
-		Base.AddFlag("attach")
-		Base.AddFlag("not_pick")
-		Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		Base.SetColor(self.BOARD_COLOR)
-		Base.Show()
-		self.Base = Base
-
-		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
-		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def SetSize(self, width, height):
-
-		width = max(self.CORNER_WIDTH*2, width)
-		height = max(self.CORNER_HEIGHT*2, height)
-		Window.SetSize(self, width, height)
-
-		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
-		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
-		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
-		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
-		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
-
-		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
-		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
-		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-		self.Base.SetSize(width - self.CORNER_WIDTH*2, height - self.CORNER_HEIGHT*2)
-
-	def ShowInternal(self):
-		self.Base.Show()
-		for wnd in self.Lines:
-			wnd.Show()
-		for wnd in self.Corners:
-			wnd.Show()
-
-	def HideInternal(self):
-		self.Base.Hide()
-		for wnd in self.Lines:
-			wnd.Hide()
-		for wnd in self.Corners:
-			wnd.Hide()
-
-if app.ENABLE_MYSHOP_DECO:
-	class ShopDecoTitle(Window):
-		DEFAULT_VALUE = 16
-		CORNER_WIDTH = 48
-		CORNER_HEIGHT = 32
-		LINE_WIDTH = 16
-		LINE_HEIGHT = 32
-
-		LT = 0
-		LB = 1
-		RT = 2
-		RB = 3
-		L = 0
-		R = 1
-		T = 2
-		B = 3
-
-		def __init__(self, type, layer = "UI"):
-			Window.__init__(self, layer)
-
-			CornerFileNames, LineFileNames = self.__GetFilePath(type)
-
-			if CornerFileNames == None or LineFileNames == None:
-				return
-
-			self.Corners = []
-			for fileName in CornerFileNames:
-				Corner = ExpandedImageBox()
-				Corner.AddFlag("attach")
-				Corner.AddFlag("not_pick")
-				Corner.LoadImage(fileName)
-				Corner.SetParent(self)
-				Corner.SetPosition(0, 0)
-				Corner.Show()
-				self.Corners.append(Corner)
-
-			self.Lines = []
-			for fileName in LineFileNames:
-				Line = ExpandedImageBox()
-				Line.AddFlag("attach")
-				Line.AddFlag("not_pick")
-				Line.LoadImage(fileName)
-				Line.SetParent(self)
-				Line.SetPosition(0, 0)
-				Line.Show()
-				self.Lines.append(Line)
-
-		def __del__(self):
-			Window.__del__(self)
-
-		def __GetFilePath(self, type):
-			import uiMyShopDecoration
-
-			CornerFileNames = [ uiMyShopDecoration.DECO_SHOP_TITLE_LIST[type][1] + "_" + dir + ".tga" for dir in [ "left_top", "left_bottom", "right_top", "right_bottom" ] ]
-			LineFileNames = [ uiMyShopDecoration.DECO_SHOP_TITLE_LIST[type][1] + "_" + dir + ".tga" for dir in [ "left", "right", "top", "bottom" ] ]
-
-			return CornerFileNames, LineFileNames
-
-		def SetSize(self, width, height):
-			width = max(self.DEFAULT_VALUE * 2, width)
-			height = max(self.DEFAULT_VALUE * 2, height)
-			Window.SetSize(self, width, height)
-
-			self.Corners[self.LT].SetPosition(-self.CORNER_WIDTH + self.DEFAULT_VALUE, -self.CORNER_HEIGHT + self.DEFAULT_VALUE)
-			self.Corners[self.LB].SetPosition(-self.CORNER_WIDTH + self.DEFAULT_VALUE, height - self.CORNER_HEIGHT + self.DEFAULT_VALUE)
-
-			self.Corners[self.RT].SetPosition(width - self.DEFAULT_VALUE, -self.CORNER_HEIGHT + self.DEFAULT_VALUE)
-			self.Corners[self.RB].SetPosition(width - self.DEFAULT_VALUE, height - self.CORNER_HEIGHT + self.DEFAULT_VALUE)
-
-			self.Lines[self.L].SetPosition(0, self.DEFAULT_VALUE)
-			self.Lines[self.R].SetPosition(width - self.DEFAULT_VALUE, self.DEFAULT_VALUE)
-			self.Lines[self.B].SetPosition(self.DEFAULT_VALUE, height - self.LINE_HEIGHT + self.DEFAULT_VALUE)
-			self.Lines[self.T].SetPosition(self.DEFAULT_VALUE, -self.LINE_HEIGHT + self.DEFAULT_VALUE)
-
-			verticalShowingPercentage = float((height - self.DEFAULT_VALUE * 2) - self.DEFAULT_VALUE) / self.DEFAULT_VALUE
-			horizontalShowingPercentage = float((width - self.DEFAULT_VALUE * 2) - self.DEFAULT_VALUE) / self.DEFAULT_VALUE
-
-			self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-			self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
-			self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-			self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
-
-		def ShowInternal(self):
-			for wnd in self.Lines:
-				wnd.Show()
-			for wnd in self.Corners:
-				wnd.Show()
-
-		def HideInternal(self):
-			for wnd in self.Lines:
-				wnd.Hide()
-			for wnd in self.Corners:
-				wnd.Hide()
-
-class ScrollBar(Window):
-	SCROLLBAR_WIDTH = 17
-	SCROLLBAR_MIDDLE_HEIGHT = 9
-	SCROLLBAR_BUTTON_WIDTH = 17
-	SCROLLBAR_BUTTON_HEIGHT = 17
-	MIDDLE_BAR_POS = 5
-	MIDDLE_BAR_UPPER_PLACE = 3
-	MIDDLE_BAR_DOWNER_PLACE = 4
-	TEMP_SPACE = MIDDLE_BAR_UPPER_PLACE + MIDDLE_BAR_DOWNER_PLACE
-
-	class MiddleBar(DragButton):
-		def __init__(self):
-			DragButton.__init__(self)
-			self.AddFlag("movable")
-			#self.AddFlag("restrict_x")
-
-		def MakeImage(self):
-			top = ImageBox()
-			top.SetParent(self)
-			top.LoadImage("d:/ymir work/ui/pattern/ScrollBar_Top.tga")
-			top.SetPosition(0, 0)
-			top.AddFlag("not_pick")
-			top.Show()
-			bottom = ImageBox()
-			bottom.SetParent(self)
-			bottom.LoadImage("d:/ymir work/ui/pattern/ScrollBar_Bottom.tga")
-			bottom.AddFlag("not_pick")
-			bottom.Show()
-
-			middle = ExpandedImageBox()
-			middle.SetParent(self)
-			middle.LoadImage("d:/ymir work/ui/pattern/ScrollBar_Middle.tga")
-			middle.SetPosition(0, 4)
-			middle.AddFlag("not_pick")
-			middle.Show()
-
-			self.top = top
-			self.bottom = bottom
-			self.middle = middle
-
-		def SetSize(self, height):
-			height = max(12, height)
-			DragButton.SetSize(self, 10, height)
-			self.bottom.SetPosition(0, height-4)
-
-			height -= 4*3
-			self.middle.SetRenderingRect(0, 0, 0, float(height)/4.0)
-
-	def __init__(self):
-		Window.__init__(self)
-
-		self.pageSize = 1
-		self.curPos = 0.0
-		self.eventScroll = lambda *arg: None
-		self.lockFlag = False
-		self.scrollStep = 0.20
-		self.scroll_span = 0
-
-		self.UpScrollButtonEvent = lambda *arg: None
-		self.DownScrollButtonEvent = lambda *arg: None
-
-		self.eventFuncCall = True
-
-		self.CreateScrollBar()
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def CreateScrollBar(self):
-		barSlot = Bar3D()
-		barSlot.SetParent(self)
-		barSlot.AddFlag("not_pick")
-		barSlot.Show()
-
-		middleBar = self.MiddleBar()
-		middleBar.SetParent(self)
-		middleBar.SetMoveEvent(__mem_func__(self.OnMove))
-		middleBar.Show()
-		middleBar.MakeImage()
-		middleBar.SetSize(12)
-
-		upButton = Button()
-		upButton.SetParent(self)
-		upButton.SetEvent(__mem_func__(self.OnUp))
-		upButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_up_button_01.sub")
-		upButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_up_button_02.sub")
-		upButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_up_button_03.sub")
-		upButton.Show()
-
-		downButton = Button()
-		downButton.SetParent(self)
-		downButton.SetEvent(__mem_func__(self.OnDown))
-		downButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_down_button_01.sub")
-		downButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_down_button_02.sub")
-		downButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_down_button_03.sub")
-		downButton.Show()
-
-		self.upButton = upButton
-		self.downButton = downButton
-		self.middleBar = middleBar
-		self.barSlot = barSlot
-
-		self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
-		self.SCROLLBAR_MIDDLE_HEIGHT = self.middleBar.GetHeight()
-		self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
-		self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
-
-	if app.ENABLE_MOUSE_WHEEL_TOP_WINDOW:
-		def OnMouseWheel(self, delta):
-			if delta > 0:
-				self.SetPos(self.curPos - (self.scrollStep/4))
-				return True
-			elif delta < 0:
-				self.SetPos(self.curPos + (self.scrollStep/4))
-				return True
-			return False
-
-	def Destroy(self):
-		self.middleBar = None
-		self.upButton = None
-		self.downButton = None
-		self.eventScroll = lambda *arg: None
-
-		self.UpScrollButtonEvent = lambda *arg: None
-		self.DownScrollButtonEvent = lambda *arg: None
-
-		self.eventFuncCall = True
-
-	def SetUpScrollButtonEvent(self, event):
-		self.UpScrollButtonEvent = event
-
-	def SetDownScrollButtonEvent(self, event):
-		self.DownScrollButtonEvent = event
-
-	def SetEvnetFuncCall(self, callable):
-		self.eventFuncCall = callable
-
-	def SetScrollEvent(self, event):
-		self.eventScroll = event
-
-	def SetMiddleBarSize(self, pageScale):
-		realHeight = self.GetHeight() - self.SCROLLBAR_BUTTON_HEIGHT*2
-		self.SCROLLBAR_MIDDLE_HEIGHT = int(pageScale * float(realHeight))
-		self.middleBar.SetSize(self.SCROLLBAR_MIDDLE_HEIGHT)
-		self.pageSize = (self.GetHeight() - self.SCROLLBAR_BUTTON_HEIGHT*2) - self.SCROLLBAR_MIDDLE_HEIGHT - (self.TEMP_SPACE)
-
-	def SetScrollBarSize(self, height):
-		self.pageSize = (height - self.SCROLLBAR_BUTTON_HEIGHT*2) - self.SCROLLBAR_MIDDLE_HEIGHT - (self.TEMP_SPACE)
-		self.SetSize(self.SCROLLBAR_WIDTH, height)
-		self.upButton.SetPosition(0, 0)
-		self.downButton.SetPosition(0, height - self.SCROLLBAR_BUTTON_HEIGHT)
-		self.middleBar.SetRestrictMovementArea(self.MIDDLE_BAR_POS, self.SCROLLBAR_BUTTON_HEIGHT + self.MIDDLE_BAR_UPPER_PLACE, self.MIDDLE_BAR_POS+2, height - self.SCROLLBAR_BUTTON_HEIGHT*2 - self.TEMP_SPACE)
-		self.middleBar.SetPosition(self.MIDDLE_BAR_POS, 0)
-
-		self.UpdateBarSlot()
-
-	def UpdateBarSlot(self):
-		self.barSlot.SetPosition(0, self.SCROLLBAR_BUTTON_HEIGHT)
-		self.barSlot.SetSize(self.GetWidth() - 2, self.GetHeight() - self.SCROLLBAR_BUTTON_HEIGHT*2 - 2)
-
-	def GetPos(self):
-		return self.curPos
-
-	def SetPos(self, pos, event_callable = True):
-		pos = max(0.0, pos)
-		pos = min(1.0, pos)
-
-		newPos = float(self.pageSize) * pos
-		if app.ENABLE_MAILBOX:
-			self.middleBar.SetPosition(self.MIDDLE_BAR_POS, round(float(newPos) + self.SCROLLBAR_BUTTON_HEIGHT + self.MIDDLE_BAR_UPPER_PLACE))
-		else:
-			self.middleBar.SetPosition(self.MIDDLE_BAR_POS, int(newPos) + self.SCROLLBAR_BUTTON_HEIGHT + self.MIDDLE_BAR_UPPER_PLACE)
-
-		self.OnMove(event_callable)
-
-	def SetScrollStep(self, step):
-		self.scrollStep = step
-
-	def GetScrollStep(self):
-		return self.scrollStep
-
-	def SetSpan(self, span):
-		self.scroll_span = span
-
-	def IncreaseSpan(self, span):
-		self.scroll_span += span
-
-	def GetSpan(self):
-		return self.scroll_span
-
-	def OnUp(self):
-		self.SetPos(self.curPos-self.scrollStep, self.eventFuncCall)
-		self.UpScrollButtonEvent()
-
-	def OnDown(self):
-		self.SetPos(self.curPos+self.scrollStep, self.eventFuncCall)
-		self.DownScrollButtonEvent()
-
-	def OnMove(self, event_callable = True):
-		if self.lockFlag:
-			return
-
-		if 0 == self.pageSize:
-			return
-
-		(xLocal, yLocal) = self.middleBar.GetLocalPosition()
-		self.curPos = float(yLocal - self.SCROLLBAR_BUTTON_HEIGHT - self.MIDDLE_BAR_UPPER_PLACE) / float(self.pageSize)
-
-		if event_callable:
-			self.eventScroll()
-
-	def OnMouseLeftButtonDown(self):
-		(xMouseLocalPosition, yMouseLocalPosition) = self.GetMouseLocalPosition()
-		pickedPos = yMouseLocalPosition - self.SCROLLBAR_BUTTON_HEIGHT - self.SCROLLBAR_MIDDLE_HEIGHT/2
-		newPos = float(pickedPos) / float(self.pageSize)
-		self.SetPos(newPos)
-
-	def LockScroll(self):
-		self.lockFlag = True
-
-	def UnlockScroll(self):
-		self.lockFlag = False
-
-	if app.ENABLE_MAILBOX:
-		def SetUpButtonSizeRefresh(self):
-			self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
-			self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
-			self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
-
-		def SetUpButtonUpVisual(self, img_path):
-			if self.upButton:
-				self.upButton.SetUpVisual(img_path)
-
-		def SetUpButtonOverVisual(self, img_path):
-			if self.upButton:
-				self.upButton.SetOverVisual(img_path)
-
-		def SetUpButtonDownVisual(self, img_path):
-			if self.upButton:
-				self.upButton.SetDownVisual(img_path)
-
-		def SetDownButtonUpVisual(self, img_path):
-			if self.downButton:
-				self.downButton.SetUpVisual(img_path)
-
-		def SetDownButtonOverVisual(self, img_path):
-			if self.downButton:
-				self.downButton.SetOverVisual(img_path)
-
-		def SetDownButtonDownVisual(self, img_path):
-			if self.downButton:
-				self.downButton.SetDownVisual(img_path)
-
-class ThinScrollBar(ScrollBar):
-	def CreateScrollBar(self):
-		middleBar = self.MiddleBar()
-		middleBar.SetParent(self)
-		middleBar.SetMoveEvent(__mem_func__(self.OnMove))
-		middleBar.Show()
-		middleBar.SetUpVisual("d:/ymir work/ui/public/scrollbar_thin_middle_button_01.sub")
-		middleBar.SetOverVisual("d:/ymir work/ui/public/scrollbar_thin_middle_button_02.sub")
-		middleBar.SetDownVisual("d:/ymir work/ui/public/scrollbar_thin_middle_button_03.sub")
-
-		upButton = Button()
-		upButton.SetParent(self)
-		upButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_thin_up_button_01.sub")
-		upButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_thin_up_button_02.sub")
-		upButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_thin_up_button_03.sub")
-		upButton.SetEvent(__mem_func__(self.OnUp))
-		upButton.Show()
-
-		downButton = Button()
-		downButton.SetParent(self)
-		downButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_thin_down_button_01.sub")
-		downButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_thin_down_button_02.sub")
-		downButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_thin_down_button_03.sub")
-		downButton.SetEvent(__mem_func__(self.OnDown))
-		downButton.Show()
-
-		self.middleBar = middleBar
-		self.upButton = upButton
-		self.downButton = downButton
-
-		self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
-		self.SCROLLBAR_MIDDLE_HEIGHT = self.middleBar.GetHeight()
-		self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
-		self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
-		self.MIDDLE_BAR_POS = 0
-		self.MIDDLE_BAR_UPPER_PLACE = 0
-		self.MIDDLE_BAR_DOWNER_PLACE = 0
-		self.TEMP_SPACE = 0
-
-	def UpdateBarSlot(self):
-		pass
-
-class SmallThinScrollBar(ScrollBar):
-
-	def CreateScrollBar(self):
-		middleBar = self.MiddleBar()
-		middleBar.SetParent(self)
-		middleBar.SetMoveEvent(__mem_func__(self.OnMove))
-		middleBar.Show()
-		middleBar.SetUpVisual("d:/ymir work/ui/public/scrollbar_small_thin_middle_button_01.sub")
-		middleBar.SetOverVisual("d:/ymir work/ui/public/scrollbar_small_thin_middle_button_01.sub")
-		middleBar.SetDownVisual("d:/ymir work/ui/public/scrollbar_small_thin_middle_button_01.sub")
-
-		upButton = Button()
-		upButton.SetParent(self)
-		upButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_small_thin_up_button_01.sub")
-		upButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_small_thin_up_button_02.sub")
-		upButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_small_thin_up_button_03.sub")
-		upButton.SetEvent(__mem_func__(self.OnUp))
-		upButton.Show()
-
-		downButton = Button()
-		downButton.SetParent(self)
-		downButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_small_thin_down_button_01.sub")
-		downButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_small_thin_down_button_02.sub")
-		downButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_small_thin_down_button_03.sub")
-		downButton.SetEvent(__mem_func__(self.OnDown))
-		downButton.Show()
-
-		self.middleBar = middleBar
-		self.upButton = upButton
-		self.downButton = downButton
-
-		self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
-		self.SCROLLBAR_MIDDLE_HEIGHT = self.middleBar.GetHeight()
-		self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
-		self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
-		self.MIDDLE_BAR_POS = 0
-		self.MIDDLE_BAR_UPPER_PLACE = 0
-		self.MIDDLE_BAR_DOWNER_PLACE = 0
-		self.TEMP_SPACE = 0
-
-	def UpdateBarSlot(self):
-		pass
-
-class SliderBar(Window):
-
-	def __init__(self):
-		Window.__init__(self)
-
-		self.curPos = 1.0
-		self.pageSize = 1.0
-		self.eventChange = None
-
-		self.__CreateBackGroundImage()
-		self.__CreateCursor()
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def __CreateBackGroundImage(self):
-		img = ImageBox()
-		img.SetParent(self)
-		img.LoadImage("d:/ymir work/ui/game/windows/sliderbar.sub")
-		img.Show()
-		self.backGroundImage = img
-
-		##
-		self.SetSize(self.backGroundImage.GetWidth(), self.backGroundImage.GetHeight())
-
-	def __CreateCursor(self):
-		cursor = DragButton()
-		cursor.AddFlag("movable")
-		cursor.AddFlag("restrict_y")
-		cursor.SetParent(self)
-		cursor.SetMoveEvent(__mem_func__(self.__OnMove))
-		cursor.SetUpVisual("d:/ymir work/ui/game/windows/sliderbar_cursor.sub")
-		cursor.SetOverVisual("d:/ymir work/ui/game/windows/sliderbar_cursor.sub")
-		cursor.SetDownVisual("d:/ymir work/ui/game/windows/sliderbar_cursor.sub")
-		cursor.Show()
-		self.cursor = cursor
-
-		##
-		self.cursor.SetRestrictMovementArea(0, 0, self.backGroundImage.GetWidth(), 0)
-		self.pageSize = self.backGroundImage.GetWidth() - self.cursor.GetWidth()
-
-	def __OnMove(self):
-		(xLocal, yLocal) = self.cursor.GetLocalPosition()
-		self.curPos = float(xLocal) / float(self.pageSize)
-
-		if self.eventChange:
-			self.eventChange()
-
-	def SetSliderPos(self, pos):
-		self.curPos = pos
-		self.cursor.SetPosition(int(self.pageSize * pos), 0)
-
-	def GetSliderPos(self):
-		return self.curPos
-
-	def SetEvent(self, event):
-		self.eventChange = event
-
-	def Enable(self):
-		self.cursor.Show()
-
-	def Disable(self):
-		self.cursor.Hide()
-
-	if app.ENABLE_FOV_OPTION:
-		def SetBackgroundVisual(self, filename):
-			if self.backGroundImage:
-				self.backGroundImage.LoadImage(filename)
-
-				self.SetSize(self.backGroundImage.GetWidth(), self.backGroundImage.GetHeight())
-				self.pageSize = self.backGroundImage.GetWidth() - self.cursor.GetWidth()
-
-			if self.cursor:
-				self.cursor.SetRestrictMovementArea(0, 0, self.backGroundImage.GetWidth(), 0)
-
-		def SetButtonVisual(self, path, up, over, down):
-			if self.cursor:
-				self.cursor.SetUpVisual(path + up)
-				self.cursor.SetOverVisual(path + over)
-				self.cursor.SetDownVisual(path + down)
-
-class ListBox(Window):
-
-	TEMPORARY_PLACE = 3
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-		self.overLine = -1
-		self.selectedLine = -1
-		self.width = 0
-		self.height = 0
-		self.stepSize = 17
-		self.basePos = 0
-		self.showLineCount = 0
-		self.itemCenterAlign = True
-		self.itemIgnoreAlign = False
-		self.itemList = []
-		self.keyDict = {}
-		self.textDict = {}
-		self.event = lambda *arg: None
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def SetWidth(self, width):
-		self.SetSize(width, self.height)
-
-	def SetSize(self, width, height):
-		Window.SetSize(self, width, height)
-		self.width = width
-		self.height = height
-
-	def SetTextCenterAlign(self, flag):
-		self.itemCenterAlign = flag
-
-	def SetTextIgnoreAlign(self, flag):
-		self.itemIgnoreAlign = flag
-
-	def SetBasePos(self, pos):
-		self.basePos = pos
-		self._LocateItem()
-
-	def ClearItem(self):
-		self.keyDict = {}
-		self.textDict = {}
-		self.itemList = []
-		self.overLine = -1
-		self.selectedLine = -1
-
-	if app.ENABLE_CHANNEL_LIST:
-		def InsertItem(self, number, text, textColor = 0x00000000):
-			self.keyDict[len(self.itemList)] = number
-			self.textDict[len(self.itemList)] = text
-
-			textLine = TextLine()
-			textLine.SetParent(self)
-			textLine.SetText(text)
-			if textColor != 0x00000000:
-				textLine.SetPackedFontColor(textColor)
-			textLine.Show()
-
-			if self.itemCenterAlign:
-				textLine.SetWindowHorizontalAlignCenter()
-				textLine.SetHorizontalAlignCenter()
-
-			self.itemList.append(textLine)
-
-			self._LocateItem()
-	else:
-		def InsertItem(self, number, text):
-			self.keyDict[len(self.itemList)] = number
-			self.textDict[len(self.itemList)] = text
-
-			textLine = TextLine()
-			textLine.SetParent(self)
-			textLine.SetText(text)
-			textLine.Show()
-
-			if self.itemCenterAlign:
-				textLine.SetWindowHorizontalAlignCenter()
-				textLine.SetHorizontalAlignCenter()
-
-			self.itemList.append(textLine)
-
-			self._LocateItem()
-
-	def ChangeItem(self, number, text):
-		for key, value in self.keyDict.items():
-			if value == number:
-				self.textDict[key] = text
-
-				if number < len(self.itemList):
-					self.itemList[key].SetText(text)
-
-				return
-
-	def LocateItem(self):
-		self._LocateItem()
-
-	def _LocateItem(self):
-		skipCount = self.basePos
-		yPos = 0
-		self.showLineCount = 0
-
-		for textLine in self.itemList:
-			textLine.Hide()
-
-			if skipCount > 0:
-				skipCount -= 1
-				continue
-
-			if self.itemIgnoreAlign:
-				textLine.SetPosition(0, yPos + 3)
-			else:
-				if localeInfo.IsARABIC():
-					w, h = textLine.GetTextSize()
-					textLine.SetPosition(w + 10, yPos + 3)
-				else:
-					textLine.SetPosition(0, yPos + 3)
-
-			yPos += self.stepSize
-
-			if yPos <= self.GetHeight():
-				self.showLineCount += 1
-				textLine.Show()
-
-	def ArrangeItem(self):
-		self.SetSize(self.width, len(self.itemList) * self.stepSize)
-		self._LocateItem()
-
-	def GetViewItemCount(self):
-		return int(self.GetHeight() / self.stepSize)
-
-	def GetItemCount(self):
-		return len(self.itemList)
-
-	def SetEvent(self, event):
-		self.event = event
-
-	def SelectItem(self, line):
-		if not self.keyDict.has_key(line):
-			return
-
-		self.selectedLine = line
-		self.event(self.keyDict.get(line, 0), self.textDict.get(line, "None"))
-
-	def GetSelectedItem(self):
-		return self.keyDict.get(self.selectedLine, 0)
-
-	def OnMouseLeftButtonDown(self):
-		if self.overLine < 0:
-			return
-
-	def OnMouseLeftButtonUp(self):
-		if self.overLine >= 0:
-			self.SelectItem(self.overLine+self.basePos)
-
-	def OnUpdate(self):
-		self.overLine = -1
-
-		if self.IsIn():
-			x, y = self.GetGlobalPosition()
-			height = self.GetHeight()
-			xMouse, yMouse = wndMgr.GetMousePosition()
-
-			if yMouse - y < height - 1:
-				self.overLine = (yMouse - y) / self.stepSize
-
-				if self.overLine < 0:
-					self.overLine = -1
-				if self.overLine >= len(self.itemList):
-					self.overLine = -1
-
-	def OnRender(self):
-		xRender, yRender = self.GetGlobalPosition()
-		yRender -= self.TEMPORARY_PLACE
-		widthRender = self.width
-		heightRender = self.height + self.TEMPORARY_PLACE * 2
-
-		if localeInfo.IsCIBN10:
-			if -1 != self.overLine and self.keyDict[self.overLine] != -1:
-				grp.SetColor(HALF_WHITE_COLOR)
-				grp.RenderBar(xRender + 2, yRender + self.overLine*self.stepSize + 4, self.width - 3, self.stepSize)
-
-			if -1 != self.selectedLine and self.keyDict[self.selectedLine] != -1:
-				if self.selectedLine >= self.basePos:
-					if self.selectedLine - self.basePos < self.showLineCount:
-						grp.SetColor(SELECT_COLOR)
-						grp.RenderBar(xRender + 2, yRender + (self.selectedLine-self.basePos)*self.stepSize + 4, self.width - 3, self.stepSize)
-
-		else:
-			if -1 != self.overLine:
-				grp.SetColor(HALF_WHITE_COLOR)
-				grp.RenderBar(xRender + 2, yRender + self.overLine*self.stepSize + 4, self.width - 3, self.stepSize)
-
-			if -1 != self.selectedLine:
-				if self.selectedLine >= self.basePos:
-					if self.selectedLine - self.basePos < self.showLineCount:
-						grp.SetColor(SELECT_COLOR)
-						grp.RenderBar(xRender + 2, yRender + (self.selectedLine-self.basePos)*self.stepSize + 4, self.width - 3, self.stepSize)
-
-class ListBox2(ListBox):
-	def __init__(self, *args, **kwargs):
-		ListBox.__init__(self, *args, **kwargs)
-		self.rowCount = 10
-		self.barWidth = 0
-		self.colCount = 0
-
-	def SetRowCount(self, rowCount):
-		self.rowCount = rowCount
-
-	def SetSize(self, width, height):
-		ListBox.SetSize(self, width, height)
-		self._RefreshForm()
-
-	def ClearItem(self):
-		ListBox.ClearItem(self)
-		self._RefreshForm()
-
-	def InsertItem(self, *args, **kwargs):
-		ListBox.InsertItem(self, *args, **kwargs)
-		self._RefreshForm()
-
-	def OnUpdate(self):
-		mpos = wndMgr.GetMousePosition()
-		self.overLine = self._CalcPointIndex(mpos)
-
-	def OnRender(self):
-		x, y = self.GetGlobalPosition()
-		pos = (x + 2, y)
-
-		if -1 != self.overLine:
-			grp.SetColor(HALF_WHITE_COLOR)
-			self._RenderBar(pos, self.overLine)
-
-		if -1 != self.selectedLine:
-			if self.selectedLine >= self.basePos:
-				if self.selectedLine - self.basePos < self.showLineCount:
-					grp.SetColor(SELECT_COLOR)
-					self._RenderBar(pos, self.selectedLine-self.basePos)
-
-	def _CalcPointIndex(self, mpos):
-		if self.IsIn():
-			px, py = mpos
-			gx, gy = self.GetGlobalPosition()
-			lx, ly = px - gx, py - gy
-
-			col = lx / self.barWidth
-			row = ly / self.stepSize
-			idx = col * self.rowCount + row
-			if col >= 0 and col < self.colCount:
-				if row >= 0 and row < self.rowCount:
-					if idx >= 0 and idx < len(self.itemList):
-						return idx
-
-		return -1
-
-	def _CalcRenderPos(self, pos, idx):
-		x, y = pos
-		row = idx % self.rowCount
-		col = idx / self.rowCount
-		return (x + col * self.barWidth, y + row * self.stepSize)
-
-	def _RenderBar(self, basePos, idx):
-		x, y = self._CalcRenderPos(basePos, idx)
-		grp.RenderBar(x, y, self.barWidth - 3, self.stepSize)
-
-	def _LocateItem(self):
-		pos = (0, self.TEMPORARY_PLACE)
-
-		self.showLineCount = 0
-		for textLine in self.itemList:
-			x, y = self._CalcRenderPos(pos, self.showLineCount)
-			textLine.SetPosition(x, y)
-			textLine.Show()
-
-			self.showLineCount += 1
-
-	def _RefreshForm(self):
-		if len(self.itemList) % self.rowCount:
-			self.colCount = len(self.itemList) / self.rowCount + 1
-		else:
-			self.colCount = len(self.itemList) / self.rowCount
-
-		if self.colCount:
-			self.barWidth = self.width / self.colCount
-		else:
-			self.barWidth = self.width
-
-class ComboBoxImage(Window):
-	class ListBoxWithBoard(ListBox):
-		def __init__(self, layer):
-			ListBox.__init__(self, layer)
-			self.SetTextIgnoreAlign(True)
-
-		def OnRender(self):
-			xRender, yRender = self.GetGlobalPosition()
-			yRender -= self.TEMPORARY_PLACE
-
-			widthRender = self.width
-			heightRender = self.height + self.TEMPORARY_PLACE * 2
-
-			grp.SetColor(BACKGROUND_COLOR)
-			grp.RenderBar(xRender, yRender, widthRender, heightRender)
-			grp.SetColor(DARK_COLOR)
-			grp.RenderLine(xRender, yRender, widthRender, 0)
-			grp.RenderLine(xRender, yRender, 0, heightRender)
-
-			ListBox.OnRender(self)
-
-	def __init__(self, parent, name, x ,y):
-		Window.__init__(self)
-		self.isSelected = False
-		self.isOver = False
-		self.isListOpened = False
-		self.event = lambda *arg: None
-		self.enable = True
-		self.imagebox = None
-
-		## imagebox
-		image = ImageBox()
-		image.SetParent(parent)
-		image.LoadImage(name)
-		image.SetPosition(x, y)
-		image.Show()
-		self.imagebox = image
-
-		## BaseSetting
-		self.x = x + 1
-		self.y = y + 1
-		self.width = self.imagebox.GetWidth() - 3
-		self.height = self.imagebox.GetHeight() - 3
-		self.SetParent(parent)
-
-		## TextLine
-		self.textLine = MakeTextLine(self)
-		self.textLine.SetText(localeInfo.UI_ITEM)
-
-		## ListBox
-		self.listBox = self.ListBoxWithBoard("TOP_MOST")
-		self.listBox.SetPickAlways()
-		self.listBox.SetParent(self)
-		self.listBox.SetEvent(__mem_func__(self.OnSelectItem))
-		self.listBox.Hide()
-
-		Window.SetPosition(self, self.x, self.y)
-		Window.SetSize(self, self.width, self.height)
-		self.textLine.UpdateRect()
-		self.__ArrangeListBox()
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def Destroy(self):
-		self.textLine = None
-		self.listBox = None
-		self.imagebox = None
-
-	def SetPosition(self, x, y):
-		Window.SetPosition(self, x, y)
-		self.imagebox.SetPosition(x, y)
-		self.x = x
-		self.y = y
-		self.__ArrangeListBox()
-
-	def SetSize(self, width, height):
-		Window.SetSize(self, width, height)
-		self.width = width
-		self.height = height
-		self.textLine.UpdateRect()
-		self.__ArrangeListBox()
-
-	def __ArrangeListBox(self):
-		self.listBox.SetPosition(0, self.height + 5)
-		self.listBox.SetWidth(self.width)
-
-	def Enable(self):
-		self.enable = True
-
-	def Disable(self):
-		self.enable = False
-		self.textLine.SetText("")
-		self.CloseListBox()
-
-	def SetEvent(self, event):
-		self.event = event
-
-	def ClearItem(self):
-		self.CloseListBox()
-		self.listBox.ClearItem()
-
-	def InsertItem(self, index, name):
-		self.listBox.InsertItem(index, name)
-		self.listBox.ArrangeItem()
-
-	def SetCurrentItem(self, text):
-		self.textLine.SetText(text)
-
-	def SelectItem(self, key):
-		self.listBox.SelectItem(key)
-
-	def OnSelectItem(self, index, name):
-		self.CloseListBox()
-		self.event(index)
-
-	def CloseListBox(self):
-		self.isListOpened = False
-		self.listBox.Hide()
-
-	def OnMouseLeftButtonDown(self):
-		if not self.enable:
-			return
-
-		self.isSelected = True
-
-	def OnMouseLeftButtonUp(self):
-		self.ToggleOpenCloseListBox()
-
-	def OnUpdate(self):
-		if not self.enable:
-			return
-
-		if self.IsIn():
-			self.isOver = True
-		else:
-			self.isOver = False
-
-	def OnRender(self):
-		self.x, self.y = self.GetGlobalPosition()
-		xRender = self.x
-		yRender = self.y
-		widthRender = self.width
-		heightRender = self.height
-		if self.isOver:
-			grp.SetColor(HALF_WHITE_COLOR)
-			grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
-			if self.isSelected:
-				grp.SetColor(WHITE_COLOR)
-				grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
-
-	def OpenListBox(self):
-		self.isListOpened = True
-		self.listBox.Show()
-
-		self.__ArrangeListBox()
-
-	def ToggleOpenCloseListBox(self):
-		if not self.enable:
-			return
-
-		self.isSelected = False
-
-		if self.isListOpened:
-			self.CloseListBox()
-		else:
-			if self.listBox.GetItemCount() > 0:
-				self.isListOpened = True
-				self.listBox.Show()
-				self.__ArrangeListBox()
-
-class ComboBox(Window):
-
-	class ListBoxWithBoard(ListBox):
-
-		def __init__(self, layer):
-			ListBox.__init__(self, layer)
-
-		def OnRender(self):
-			xRender, yRender = self.GetGlobalPosition()
-			yRender -= self.TEMPORARY_PLACE
-			widthRender = self.width
-			heightRender = self.height + self.TEMPORARY_PLACE*2
-			grp.SetColor(BACKGROUND_COLOR)
-			grp.RenderBar(xRender, yRender, widthRender, heightRender)
-			grp.SetColor(DARK_COLOR)
-			grp.RenderLine(xRender, yRender, widthRender, 0)
-			grp.RenderLine(xRender, yRender, 0, heightRender)
-			grp.SetColor(BRIGHT_COLOR)
-			grp.RenderLine(xRender, yRender+heightRender, widthRender, 0)
-			grp.RenderLine(xRender+widthRender, yRender, 0, heightRender)
-
-			ListBox.OnRender(self)
-
-	def __init__(self):
-		Window.__init__(self)
-		self.x = 0
-		self.y = 0
-		self.width = 0
-		self.height = 0
-		self.isSelected = False
-		self.isOver = False
-		self.isListOpened = False
-		self.event = lambda *arg: None
-		self.enable = True
-
-		self.textLine = MakeTextLine(self)
-		self.textLine.SetText(localeInfo.UI_ITEM)
-
-		self.listBox = self.ListBoxWithBoard("TOP_MOST")
-		self.listBox.SetPickAlways()
-		self.listBox.SetParent(self)
-		self.listBox.SetEvent(__mem_func__(self.OnSelectItem))
-		self.listBox.Hide()
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def Destroy(self):
-		self.textLine = None
-		self.listBox = None
-
-	def SetPosition(self, x, y):
-		Window.SetPosition(self, x, y)
-		self.x = x
-		self.y = y
-		self.__ArrangeListBox()
-
-	def SetSize(self, width, height):
-		Window.SetSize(self, width, height)
-		self.width = width
-		self.height = height
-		self.textLine.UpdateRect()
-		self.__ArrangeListBox()
-
-	def __ArrangeListBox(self):
-		self.listBox.SetPosition(0, self.height + 5)
-		self.listBox.SetWidth(self.width)
-
-	def Enable(self):
-		self.enable = True
-
-	def Disable(self):
-		self.enable = False
-		self.textLine.SetText("")
-		self.CloseListBox()
-
-	def SetEvent(self, event):
-		self.event = event
-
-	def ClearItem(self):
-		self.CloseListBox()
-		self.listBox.ClearItem()
-
-	def InsertItem(self, index, name):
-		self.listBox.InsertItem(index, name)
-		self.listBox.ArrangeItem()
-
-	def SetCurrentItem(self, text):
-		self.textLine.SetText(text)
-
-	def SelectItem(self, key):
-		self.listBox.SelectItem(key)
-
-	def OnSelectItem(self, index, name):
-		self.CloseListBox()
-		self.event(index)
-
-	def CloseListBox(self):
-		self.isListOpened = False
-		self.listBox.Hide()
-
-	def OnMouseLeftButtonDown(self):
-		if not self.enable:
-			return
-
-		self.isSelected = True
-
-	def OnMouseLeftButtonUp(self):
-		if not self.enable:
-			return
-
-		self.isSelected = False
-
-		if self.isListOpened:
-			self.CloseListBox()
-		else:
-			if self.listBox.GetItemCount() > 0:
-				self.isListOpened = True
-				self.listBox.Show()
-				self.__ArrangeListBox()
-
-	def OnUpdate(self):
-		if not self.enable:
-			return
-
-		if self.IsIn():
-			self.isOver = True
-		else:
-			self.isOver = False
-
-	def OnRender(self):
-		self.x, self.y = self.GetGlobalPosition()
-		xRender = self.x
-		yRender = self.y
-		widthRender = self.width
-		heightRender = self.height
-		grp.SetColor(BACKGROUND_COLOR)
-		grp.RenderBar(xRender, yRender, widthRender, heightRender)
-		grp.SetColor(DARK_COLOR)
-		grp.RenderLine(xRender, yRender, widthRender, 0)
-		grp.RenderLine(xRender, yRender, 0, heightRender)
-		grp.SetColor(BRIGHT_COLOR)
-		grp.RenderLine(xRender, yRender+heightRender, widthRender, 0)
-		grp.RenderLine(xRender+widthRender, yRender, 0, heightRender)
-
-		if self.isOver:
-			grp.SetColor(HALF_WHITE_COLOR)
-			grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
-
-			if self.isSelected:
-				grp.SetColor(WHITE_COLOR)
-				grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
-
-class RenderTarget(Window):
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-		
-		self.number = -1
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterRenderTarget(self, layer)
-		
-	def SetRenderTarget(self, number):
-		self.number = number
-		wndMgr.SetRenderTarget(self.hWnd, self.number)
-
-###################################################################################################
-## Python Script Loader
-###################################################################################################
-
-class ScriptWindow(Window):
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-		self.Children = []
-		self.ElementDictionary = {}
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def ClearDictionary(self):
-		self.Children = []
-		self.ElementDictionary = {}
-
-	def InsertChild(self, name, child):
-		self.ElementDictionary[name] = child
-
-	def IsChild(self, name):
-		return self.ElementDictionary.has_key(name)
-
-	def GetChild(self, name):
-		return self.ElementDictionary[name]
-
-	def GetChild2(self, name):
-		return self.ElementDictionary.get(name, None)
-
-class PythonScriptLoader(object):
-
-	BODY_KEY_LIST = ( "x", "y", "width", "height" )
-
-	#####
-
-	DEFAULT_KEY_LIST = ( "type", "x", "y", )
-	WINDOW_KEY_LIST = ( "width", "height", )
-	IMAGE_KEY_LIST = ( "image", )
-	EXPANDED_IMAGE_KEY_LIST = ( "image", )
-	ANI_IMAGE_KEY_LIST = ( "images", )
-	SLOT_KEY_LIST = ( "width", "height", "slot", )
-	CANDIDATE_LIST_KEY_LIST = ( "item_step", "item_xsize", "item_ysize", )
-	GRID_TABLE_KEY_LIST = ( "start_index", "x_count", "y_count", "x_step", "y_step", )
-	EDIT_LINE_KEY_LIST = ( "width", "height", "input_limit", )
-	COMBO_BOX_KEY_LIST = ( "width", "height", "item", )
-	TITLE_BAR_KEY_LIST = ( "width", )
-	HORIZONTAL_BAR_KEY_LIST = ( "width", )
-	BOARD_KEY_LIST = ( "width", "height", )
-	BOARD_WITH_TITLEBAR_KEY_LIST = ( "width", "height", "title", )
-	BOX_KEY_LIST = ( "width", "height", )
-	BAR_KEY_LIST = ( "width", "height", )
-	LINE_KEY_LIST = ( "width", "height", )
-	SLOTBAR_KEY_LIST = ( "width", "height", )
-	GAUGE_KEY_LIST = ( "width", "color", )
-	SCROLLBAR_KEY_LIST = ( "size", )
-	LIST_BOX_KEY_LIST = ( "width", "height", )
-	OUTLINE_WINDOW_KEY_LIST = ( "width", "height", )
-
-	if app.RENDER_TARGET:
-		RENDER_TARGET_KEY_LIST = ( "index", )
-
-	# app.ENABLE_FISH_EVENT
-	SP_GRID_TABLE_KEY_LIST = ( "start_index", "x_count", "y_count", "x_step", "y_step", )
-
-	if app.ENABLE_MAILBOX:
-		RENDER_BOX_KEY_LIST = ( "color", )
-
-	CIRCLE_KEY_LIST = ( "radius", "color", )
-
-	def __init__(self):
-		self.Clear()
-
-	def Clear(self):
-		self.ScriptDictionary = { "SCREEN_WIDTH" : wndMgr.GetScreenWidth(), "SCREEN_HEIGHT" : wndMgr.GetScreenHeight() }
-		self.InsertFunction = 0
-
-	def LoadScriptFile(self, window, FileName):
-		import exception
-		import exceptions
-		import os
-		import errno
-		self.Clear()
-
-		#print "===== Load Script File : %s" % (FileName)
-
-		#ui ÄÚµå´Â sandbox ³»¿¡¼­ ½ÇÇàµÇ¾î¾ßÇÑ´Ù.(º¿ÀÌ ²¸ÀÖÀ» ¿©Áö°¡ ÀÖ±â ¶§¹®¿¡)
-		#import sys
-		#from utils import Sandbox
-		#sandbox = Sandbox(True, ["uiScriptLocale", "localeInfo", "sys", "item", "app"])
-
-		# chr, player µîÀº sandbox ³»¿¡¼­ import°¡ Çã¿ëµÇÁö ¾Ê±â ¶§¹®¿¡,(º¿ÀÌ ¾Ç¿ëÇÒ ¿©Áö°¡ ¸Å¿ì Å­.)
-		#  ¹Ì¸® script dictionary¿¡ ÇÊ¿äÇÑ »ó¼ö¸¦ ³Ö¾î³õ´Â´Ù.
-		import chr
-		import player
-		import app
-		self.ScriptDictionary["PLAYER_NAME_MAX_LEN"] = chr.PLAYER_NAME_MAX_LEN
-		if app.ENABLE_DRAGON_SOUL_SYSTEM:
-			self.ScriptDictionary["DRAGON_SOUL_EQUIPMENT_SLOT_START"] = player.DRAGON_SOUL_EQUIPMENT_SLOT_START
-		self.ScriptDictionary["LOCALE_PATH"] = app.GetLocalePath()
-
-		try:
-			#sandbox.execfile(FileName, self.ScriptDictionary)
-			execfile(FileName, self.ScriptDictionary)
-		except IOError, err:
-			import sys
-			import dbg
-			dbg.TraceError("Failed to load script file : %s" % (FileName))
-			dbg.TraceError("error : %s" % (err))
-			exception.Abort("LoadScriptFile1")
-		except RuntimeError,err:
-			import sys
-			import dbg
-			dbg.TraceError("Failed to load script file : %s" % (FileName))
-			dbg.TraceError("error : %s" % (err))
-			exception.Abort("LoadScriptFile2")
-		except:
-			import sys
-			import dbg
-			dbg.TraceError("Failed to load script file : %s" % (FileName))
-			exception.Abort("LoadScriptFile!!!!!!!!!!!!!!")
-
-		#####
-
-		Body = self.ScriptDictionary["window"]
-		self.CheckKeyList("window", Body, self.BODY_KEY_LIST)
-
-		window.ClearDictionary()
-		self.InsertFunction = window.InsertChild
-
-		window.SetPosition(int(Body["x"]), int(Body["y"]))
-
-		if localeInfo.IsARABIC():
-			w = wndMgr.GetScreenWidth()
-			h = wndMgr.GetScreenHeight()
-			if Body.has_key("width"):
-				w = int(Body["width"])
-			if Body.has_key("height"):
-				h = int(Body["height"])
-
-			window.SetSize(w, h)
-		else:
-			window.SetSize(int(Body["width"]), int(Body["height"]))
-			if True == Body.has_key("style"):
-				for StyleList in Body["style"]:
-					window.AddFlag(StyleList)
-
-		self.LoadChildren(window, Body)
-
-	def LoadChildren(self, parent, dicChildren):
-
-		if localeInfo.IsARABIC():
-			parent.AddFlag( "rtl" )
-
-		if True == dicChildren.has_key("style"):
-			for style in dicChildren["style"]:
-				parent.AddFlag(style)
-
-		if False == dicChildren.has_key("children"):
-			return False
-
-		Index = 0
-
-		ChildrenList = dicChildren["children"]
-		parent.Children = range(len(ChildrenList))
-		for ElementValue in ChildrenList:
-			try:
-				Name = ElementValue["name"]
-			except KeyError:
-				Name = ElementValue["name"] = "NONAME"
-
-			try:
-				Type = ElementValue["type"]
-			except KeyError:
-				Type = ElementValue["type"] = "window"
-
-			if False == self.CheckKeyList(Name, ElementValue, self.DEFAULT_KEY_LIST):
-				del parent.Children[Index]
-				continue
-
-			if Type == "window":
-				parent.Children[Index] = ScriptWindow()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementWindow(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "outline_window":
-				parent.Children[Index] = OutlineWindow()
-				parent.Children[Index].SetParent(parent)
-				self.LoadOutlineWindow(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "button":
-				parent.Children[Index] = Button()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementButton(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "radio_button":
-				parent.Children[Index] = RadioButton()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementButton(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "toggle_button":
-				parent.Children[Index] = ToggleButton()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementButton(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "mark":
-				parent.Children[Index] = MarkBox()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementMark(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "image":
-				parent.Children[Index] = ImageBox()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementImage(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "expanded_image":
-				parent.Children[Index] = ExpandedImageBox()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementExpandedImage(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "ani_image":
-				parent.Children[Index] = AniImageBox()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementAniImage(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "slot":
-				parent.Children[Index] = SlotWindow()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementSlot(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "candidate_list":
-				parent.Children[Index] = CandidateListBox()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementCandidateList(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "grid_table":
-				parent.Children[Index] = GridSlotWindow()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementGridTable(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "text":
-				parent.Children[Index] = TextLine()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementText(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "editline":
-				parent.Children[Index] = EditLine()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementEditLine(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "titlebar":
-				parent.Children[Index] = TitleBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementTitleBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "horizontalbar":
-				parent.Children[Index] = HorizontalBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementHorizontalBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "board":
-				parent.Children[Index] = Board()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementBoard(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "middleboard":
-				parent.Children[Index] = MiddleBoard()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementBoard(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "board_with_titlebar":
-				parent.Children[Index] = BoardWithTitleBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementBoardWithTitleBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "border_a":
-				parent.Children[Index] = BorderA()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementBorderA(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "thinboard":
-				parent.Children[Index] = ThinBoard()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "thinboard_gold":
-				parent.Children[Index] = ThinBoardGold()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "thinboard_circle":
-				parent.Children[Index] = ThinBoardCircle()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "box":
-				parent.Children[Index] = Box()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementBox(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "bar":
-				parent.Children[Index] = Bar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "line":
-				parent.Children[Index] = Line()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementLine(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "slotbar":
-				parent.Children[Index] = SlotBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementSlotBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "gauge":
-				parent.Children[Index] = Gauge()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementGauge(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "scrollbar":
-				parent.Children[Index] = ScrollBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementScrollBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "thin_scrollbar":
-				parent.Children[Index] = ThinScrollBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementScrollBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "small_thin_scrollbar":
-				parent.Children[Index] = SmallThinScrollBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementScrollBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "sliderbar":
-				parent.Children[Index] = SliderBar()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementSliderBar(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "listbox":
-				parent.Children[Index] = ListBox()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementListBox(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "listbox2":
-				parent.Children[Index] = ListBox2()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementListBox2(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "listboxex":
-				parent.Children[Index] = ListBoxEx()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementListBoxEx(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "numberline":
-				parent.Children[Index] = NumberLine()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementNumberLine(parent.Children[Index], ElementValue, parent)
-
-			elif app.RENDER_TARGET and Type == "render_target":
-				parent.Children[Index] = RenderTarget()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementRenderTarget(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "middleboard" and app.ENABLE_LOADING_TIP:
-				parent.Children[Index] = ThinBoard()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "renderbox":
-				if app.ENABLE_MAILBOX:
-					parent.Children[Index] = RenderBox()
-					parent.Children[Index].SetParent(parent)
-					self.LoadElementRenderBox(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "circle":
-				parent.Children[Index] = Circle()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementCircle(parent.Children[Index], ElementValue, parent)
-
-			elif Type == "render_target":
-				parent.Children[Index] = RenderTarget()
-				parent.Children[Index].SetParent(parent)
-				self.LoadElementRenderTarget(parent.Children[Index], ElementValue, parent)
-
-			else:
-				Index += 1
-				continue
-
-			parent.Children[Index].SetWindowName(Name)
-			if 0 != self.InsertFunction:
-				self.InsertFunction(Name, parent.Children[Index])
-
-			self.LoadChildren(parent.Children[Index], ElementValue)
-			Index += 1
-
-	def CheckKeyList(self, name, value, key_list):
-
-		for DataKey in key_list:
-			if False == value.has_key(DataKey):
-				print("Failed to find data key", "[" + name + "/" + DataKey + "]")
-				return False
-
-		return True
-
-	def LoadDefaultData(self, window, value, parentWindow):
-		loc_x = int(value["x"])
-		loc_y = int(value["y"])
-		if value.has_key("vertical_align"):
-			if "center" == value["vertical_align"]:
-				window.SetWindowVerticalAlignCenter()
-			elif "bottom" == value["vertical_align"]:
-				window.SetWindowVerticalAlignBottom()
-
-		if parentWindow.IsRTL():
-			loc_x = int(value["x"]) + window.GetWidth()
-			if value.has_key("horizontal_align"):
-				if "center" == value["horizontal_align"]:
-					window.SetWindowHorizontalAlignCenter()
-					loc_x = - int(value["x"])
-				elif "right" == value["horizontal_align"]:
-					window.SetWindowHorizontalAlignLeft()
-					loc_x = int(value["x"]) - window.GetWidth()
-					## loc_x = parentWindow.GetWidth() - int(value["x"]) + window.GetWidth()
-			else:
-				window.SetWindowHorizontalAlignRight()
-
-			if value.has_key("all_align"):
-				window.SetWindowVerticalAlignCenter()
-				window.SetWindowHorizontalAlignCenter()
-				loc_x = - int(value["x"])
-		else:
-			if value.has_key("horizontal_align"):
-				if "center" == value["horizontal_align"]:
-					window.SetWindowHorizontalAlignCenter()
-				elif "right" == value["horizontal_align"]:
-					window.SetWindowHorizontalAlignRight()
-
-		window.SetPosition(loc_x, loc_y)
-		window.Show()
-
-	## Window
-	def LoadElementWindow(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.WINDOW_KEY_LIST):
-			return False
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Outline Window
-	def LoadOutlineWindow(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.OUTLINE_WINDOW_KEY_LIST):
-			return False
-
-		window.MakeOutlineWindow(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Button
-	def LoadElementButton(self, window, value, parentWindow):
-		if value.has_key("width") and value.has_key("height"):
-			window.SetSize(int(value["width"]), int(value["height"]))
-
-		if True == value.has_key("default_image"):
-			window.SetUpVisual(value["default_image"])
-		if True == value.has_key("over_image"):
-			window.SetOverVisual(value["over_image"])
-		if True == value.has_key("down_image"):
-			window.SetDownVisual(value["down_image"])
-		if True == value.has_key("disable_image"):
-			window.SetDisableVisual(value["disable_image"])
-
-		if True == value.has_key("text"):
-			if True == value.has_key("fontsize"):
-				fontSize = value["fontsize"]
-
-				if "LARGE" == fontSize:
-					window.AppendTextLine(value["text"], localeInfo.UI_DEF_FONT_LARGE)
-				elif "SMALL" == fontSize:
-					window.AppendTextLine(value["text"], localeInfo.UI_DEF_FONT_SMALL)
-				else:
-					window.AppendTextLine(value["text"])
-			else:
-				if True == value.has_key("text_height"):
-					window.SetText(value["text"], value["text_height"])
-				else:
-					window.SetText(value["text"])
-
-			if value.has_key("text_color"):
-				window.SetTextColor(value["text_color"])
-
-		if True == value.has_key("tooltip_text"):
-			if True == value.has_key("tooltip_x") and True == value.has_key("tooltip_y"):
-				window.SetToolTipText(value["tooltip_text"], int(value["tooltip_x"]), int(value["tooltip_y"]))
-			else:
-				window.SetToolTipText(value["tooltip_text"])
-
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Mark
-	def LoadElementMark(self, window, value, parentWindow):
-
-		#if False == self.CheckKeyList(value["name"], value, self.MARK_KEY_LIST):
-		#	return False
-
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Image
-	def LoadElementImage(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.IMAGE_KEY_LIST):
-			return False
-
-		window.LoadImage(value["image"])
-
-		if value.has_key("arabic_reverse"):
-			if value["arabic_reverse"]:
-				window.LeftRightReverse()
-
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## AniImage
-	def LoadElementAniImage(self, window, value, parentWindow):
-		if False == self.CheckKeyList(value["name"], value, self.ANI_IMAGE_KEY_LIST):
-			return False
-
-		if True == value.has_key("delay"):
-			window.SetDelay(value["delay"])
-
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
-				for image in value["images"]:
-					window.AppendImageScale(image, float(value["x_scale"]), float(value["y_scale"]))
-			else:
-				for image in value["images"]:
-					window.AppendImage(image)
-		else:
-			for image in value["images"]:
-				window.AppendImage(image)
-
-		if value.has_key("width") and value.has_key("height"):
-			window.SetSize(value["width"], value["height"])
-
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
-				window.SetScale(float(value["x_scale"]), float(value["y_scale"]))
-
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Expanded Image
-	def LoadElementExpandedImage(self, window, value, parentWindow):
-		if False == self.CheckKeyList(value["name"], value, self.EXPANDED_IMAGE_KEY_LIST):
-			return False
-
-		window.LoadImage(value["image"])
-
-		if True == value.has_key("x_origin") and True == value.has_key("y_origin"):
-			window.SetOrigin(float(value["x_origin"]), float(value["y_origin"]))
-
-		if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
-			window.SetScale(float(value["x_scale"]), float(value["y_scale"]))
-
-		if True == value.has_key("rect"):
-			RenderingRect = value["rect"]
-			window.SetRenderingRect(RenderingRect[0], RenderingRect[1], RenderingRect[2], RenderingRect[3])
-
-		if True == value.has_key("mode"):
-			mode = value["mode"]
-			if "MODULATE" == mode:
-				window.SetRenderingMode(wndMgr.RENDERING_MODE_MODULATE)
-
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Slot
-	def LoadElementSlot(self, window, value, parentWindow):
-		if False == self.CheckKeyList(value["name"], value, self.SLOT_KEY_LIST):
-			return False
-
-		global_x = int(value["x"])
-		global_y = int(value["y"])
-		global_width = int(value["width"])
-		global_height = int(value["height"])
-
-		window.SetPosition(global_x, global_y)
-		window.SetSize(global_width, global_height)
-		window.Show()
-
-		r = 1.0
-		g = 1.0
-		b = 1.0
-		a = 1.0
-
-		if True == value.has_key("image_r") and \
-			True == value.has_key("image_g") and \
-			True == value.has_key("image_b") and \
-			True == value.has_key("image_a"):
-			r = float(value["image_r"])
-			g = float(value["image_g"])
-			b = float(value["image_b"])
-			a = float(value["image_a"])
-
-		SLOT_ONE_KEY_LIST = ("index", "x", "y", "width", "height")
-
-		for slot in value["slot"]:
-			if True == self.CheckKeyList(value["name"] + " - one", slot, SLOT_ONE_KEY_LIST):
-				wndMgr.AppendSlot(window.hWnd,
-									int(slot["index"]),
-									int(slot["x"]),
-									int(slot["y"]),
-									int(slot["width"]),
-									int(slot["height"]))
-
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
-				window.SetSlotScale(float(value["x_scale"]), float(value["y_scale"]))
-
-		if app.ENABLE_SLOT_SCALE:
-			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
-				window.SetSlotScale(float(value["x_scale"]), float(value["y_scale"]))
-
-		if True == value.has_key("image"):
-			wndMgr.SetSlotBaseImage(window.hWnd,
-									value["image"],
-									r, g, b, a)
-
-		return True
-
-	def LoadElementCandidateList(self, window, value, parentWindow):
-		if False == self.CheckKeyList(value["name"], value, self.CANDIDATE_LIST_KEY_LIST):
-			return False
-
-		window.SetPosition(int(value["x"]), int(value["y"]))
-		window.SetItemSize(int(value["item_xsize"]), int(value["item_ysize"]))
-		window.SetItemStep(int(value["item_step"]))
-		window.Show()
-
-		return True
-
-	## Table
-	def LoadElementGridTable(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.GRID_TABLE_KEY_LIST):
-			return False
-
-		xBlank = 0
-		yBlank = 0
-		if True == value.has_key("x_blank"):
-			xBlank = int(value["x_blank"])
-		if True == value.has_key("y_blank"):
-			yBlank = int(value["y_blank"])
-
-		if localeInfo.IsARABIC():
-			pass
-		else:
-			window.SetPosition(int(value["x"]), int(value["y"]))
-
-		window.ArrangeSlot(	int(value["start_index"]),
-							int(value["x_count"]),
-							int(value["y_count"]),
-							int(value["x_step"]),
-							int(value["y_step"]),
-							xBlank,
-							yBlank)
-		if True == value.has_key("image"):
-			r = 1.0
-			g = 1.0
-			b = 1.0
-			a = 1.0
-			if True == value.has_key("image_r") and \
-				True == value.has_key("image_g") and \
-				True == value.has_key("image_b") and \
-				True == value.has_key("image_a"):
-				r = float(value["image_r"])
-				g = float(value["image_g"])
-				b = float(value["image_b"])
-				a = float(value["image_a"])
-			wndMgr.SetSlotBaseImage(window.hWnd, value["image"], r, g, b, a)
-
-		if True == value.has_key("style"):
-			if "select" == value["style"]:
-				wndMgr.SetSlotStyle(window.hWnd, wndMgr.SLOT_STYLE_SELECT)
-		if localeInfo.IsARABIC():
-			self.LoadDefaultData(window, value, parentWindow)
-		else:
-			window.Show()
-
-		return True
-
-	## Text
-	def LoadElementText(self, window, value, parentWindow):
-		if value.has_key("multi_line"):
-			if value["multi_line"]:
-				window.SetMultiLine()
-
-		if value.has_key("fontsize"):
-			fontSize = value["fontsize"]
-
-			if "LARGE" == fontSize:
-				window.SetFontName(localeInfo.UI_DEF_FONT_LARGE)
-
-		elif value.has_key("fontname"):
-			fontName = value["fontname"]
-			window.SetFontName(fontName)
-
-		if value.has_key("text_horizontal_align"):
-			if "left" == value["text_horizontal_align"]:
-				window.SetHorizontalAlignLeft()
-			elif "center" == value["text_horizontal_align"]:
-				window.SetHorizontalAlignCenter()
-			elif "right" == value["text_horizontal_align"]:
-				window.SetHorizontalAlignRight()
-
-		if value.has_key("text_vertical_align"):
-			if "top" == value["text_vertical_align"]:
-				window.SetVerticalAlignTop()
-			elif "center" == value["text_vertical_align"]:
-				window.SetVerticalAlignCenter()
-			elif "bottom" == value["text_vertical_align"]:
-				window.SetVerticalAlignBottom()
-
-		if value.has_key("all_align"):
-			window.SetHorizontalAlignCenter()
-			window.SetVerticalAlignCenter()
-			window.SetWindowHorizontalAlignCenter()
-			window.SetWindowVerticalAlignCenter()
-
-		if value.has_key("r") and value.has_key("g") and value.has_key("b"):
-			window.SetFontColor(float(value["r"]), float(value["g"]), float(value["b"]))
-		elif value.has_key("color"):
-			window.SetPackedFontColor(value["color"])
-		else:
-			window.SetFontColor(0.8549, 0.8549, 0.8549)
-
-		if value.has_key("outline"):
-			if value["outline"]:
-				window.SetOutline()
-		if True == value.has_key("text"):
-			window.SetText(value["text"])
-
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## EditLine
-	def LoadElementEditLine(self, window, value, parentWindow):
-		if False == self.CheckKeyList(value["name"], value, self.EDIT_LINE_KEY_LIST):
-			return False
-
-		if value.has_key("secret_flag"):
-			window.SetSecret(value["secret_flag"])
-		if value.has_key("with_codepage"):
-			if value["with_codepage"]:
-				window.bCodePage = True
-		if value.has_key("only_number"):
-			if value["only_number"]:
-				window.SetNumberMode()
-		if value.has_key("enable_codepage"):
-			window.SetIMEFlag(value["enable_codepage"])
-		if value.has_key("enable_ime"):
-			window.SetIMEFlag(value["enable_ime"])
-		if value.has_key("limit_width"):
-			window.SetLimitWidth(value["limit_width"])
-		if value.has_key("multi_line"):
-			if value["multi_line"]:
-				window.SetMultiLine()
-
-		window.SetMax(int(value["input_limit"]))
-		window.SetSize(int(value["width"]), int(value["height"]))
-
-		self.LoadElementText(window, value, parentWindow)
-
-		return True
-
-	## TitleBar
-	def LoadElementTitleBar(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.TITLE_BAR_KEY_LIST):
-			return False
-
-		window.MakeTitleBar(int(value["width"]), value.get("color", "red"))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## HorizontalBar
-	def LoadElementHorizontalBar(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.HORIZONTAL_BAR_KEY_LIST):
-			return False
-
-		window.Create(int(value["width"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Board
-	def LoadElementBoard(self, window, value, parentWindow):
-		if False == self.CheckKeyList(value["name"], value, self.BOARD_KEY_LIST):
-			return False
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Board With TitleBar
-	def LoadElementBoardWithTitleBar(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.BOARD_WITH_TITLEBAR_KEY_LIST):
-			return False
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		window.SetTitleName(value["title"])
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## BorderA
-	def LoadElementBorderA(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.BOARD_KEY_LIST):
-			return False
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## ThinBoard
-	def LoadElementThinBoard(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.BOARD_KEY_LIST):
-			return False
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Box
-	def LoadElementBox(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.BOX_KEY_LIST):
-			return False
-
-		if True == value.has_key("color"):
-			window.SetColor(value["color"])
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Bar
-	def LoadElementBar(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.BAR_KEY_LIST):
-			return False
-
-		if True == value.has_key("color"):
-			window.SetColor(value["color"])
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Line
-	def LoadElementLine(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.LINE_KEY_LIST):
-			return False
-
-		if True == value.has_key("color"):
-			window.SetColor(value["color"])
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Slot
-	def LoadElementSlotBar(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.SLOTBAR_KEY_LIST):
-			return False
-
-		window.SetSize(int(value["width"]), int(value["height"]))
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## Gauge
-	def LoadElementGauge(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.GAUGE_KEY_LIST):
-			return False
-
-		window.MakeGauge(value["width"], value["color"])
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## ScrollBar
-	def LoadElementScrollBar(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.SCROLLBAR_KEY_LIST):
-			return False
-
-		window.SetScrollBarSize(value["size"])
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## SliderBar
-	def LoadElementSliderBar(self, window, value, parentWindow):
-
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## ListBox
-	def LoadElementListBox(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.LIST_BOX_KEY_LIST):
-			return False
-
-		if value.has_key("item_align"):
-			window.SetTextCenterAlign(value["item_align"])
-
-		window.SetSize(value["width"], value["height"])
-		self.LoadDefaultData(window, value, parentWindow)
-
-		return True
-
-	## ListBox2
-	def LoadElementListBox2(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.LIST_BOX_KEY_LIST):
-			return False
-
-		window.SetRowCount(value.get("row_count", 10)) 
-		window.SetSize(value["width"], value["height"])
-		self.LoadDefaultData(window, value, parentWindow)
-
-		if value.has_key("item_align"):
-			window.SetTextCenterAlign(value["item_align"])
-
-		return True
-
-	def LoadElementListBoxEx(self, window, value, parentWindow):
-
-		if False == self.CheckKeyList(value["name"], value, self.LIST_BOX_KEY_LIST):
-			return False
-
-		window.SetSize(value["width"], value["height"])
-		self.LoadDefaultData(window, value, parentWindow)
-
-		if value.has_key("itemsize_x") and value.has_key("itemsize_y"):
-			window.SetItemSize(int(value["itemsize_x"]), int(value["itemsize_y"]))
-
-		if value.has_key("itemstep"):
-			window.SetItemStep(int(value["itemstep"]))
-
-		if value.has_key("viewcount"):
-			window.SetViewItemCount(int(value["viewcount"]))
-
-		return True
-
-	def LoadElementNumberLine(self, window, value, parentWindow):
-		self.LoadDefaultData(window, value, parentWindow)
-		return True
-
-	if app.RENDER_TARGET:
-		def LoadElementRenderTarget(self, window, value, parentWindow):
-			if False == self.CheckKeyList(value["name"], value, self.RENDER_TARGET_KEY_LIST):
-				return False
-
-			window.SetSize(value["width"], value["height"])
-
-			if True == value.has_key("style"):
-				for style in value["style"]:
-					window.AddFlag(style)
-
-			self.LoadDefaultData(window, value, parentWindow)
-
-			if value.has_key("index"):
-				window.SetRenderTarget(int(value["index"]))
-
-			return True
-
-	if app.ENABLE_MAILBOX:
-		def LoadElementRenderBox(self, window, value, parentWindow):
-			if False == self.CheckKeyList(value["name"], value, self.RENDER_BOX_KEY_LIST):
-				return False
-
-			window.SetSize(value["width"], value["height"])
-			self.LoadDefaultData(window, value, parentWindow)
-
-			if value.has_key("color"):
-				window.SetColor(int(value["color"]))
-
-			return True
-
-	def LoadElementCircle(self, window, value, parentWindow):
-		if False == self.CheckKeyList(value["name"], value, self.CIRCLE_KEY_LIST):
-			return False
-
-		window.SetSize(value["width"], value["height"])
-		self.LoadDefaultData(window, value, parentWindow)
-
-		if value.has_key("color"):
-			window.SetColor(value["color"])
-
-		return True
-
-class ReadingWnd(Bar):
-	def __init__(self):
-		Bar.__init__(self,"TOP_MOST")
-
-		self.__BuildText()
-		self.SetSize(80, 19)
-		self.Show()
-
-	def __del__(self):
-		Bar.__del__(self)
-
-	def __BuildText(self):
-		self.text = TextLine()
-		self.text.SetParent(self)
-		self.text.SetPosition(4, 3)
-		self.text.Show()
-
-	def SetText(self, text):
-		self.text.SetText(text)
-
-	def SetReadingPosition(self, x, y):
-		xPos = x + 2
-		yPos = y - self.GetHeight() - 2
-		self.SetPosition(xPos, yPos)
-
-	def SetTextColor(self, color):
-		self.text.SetPackedFontColor(color)
-
-def MakeSlotBar(parent, x, y, width, height):
-	slotBar = SlotBar()
-	slotBar.SetParent(parent)
-	slotBar.SetSize(width, height)
-	slotBar.SetPosition(x, y)
-	slotBar.Show()
-	return slotBar
-
-def MakeImageBox(parent, name, x, y):
-	image = ImageBox()
-	image.SetParent(parent)
-	image.LoadImage(name)
-	image.SetPosition(x, y)
-	image.Show()
-	return image
-
-def MakeTextLine(parent):
-	textLine = TextLine()
-	textLine.SetParent(parent)
-	textLine.SetWindowHorizontalAlignCenter()
-	textLine.SetWindowVerticalAlignCenter()
-	textLine.SetHorizontalAlignCenter()
-	textLine.SetVerticalAlignCenter()
-	if app.WJ_MULTI_TEXTLINE:
-		textLine.DisableEnterToken()
-	textLine.Show()
-	return textLine
-
-def AddTextLine(parent, x, y, text, outline = 0):
-	textLine = TextLine()
-	textLine.SetParent(parent)
-	textLine.SetPosition(x, y)
-	if outline != 0:
-		textLine.SetOutline()
-	textLine.SetText(text)
-	textLine.Show()
-	return textLine
-
-def MakeNewTextLine(parent, horizontalAlign = True, verticalAlgin = True, x = 0, y = 0):
-	textLine = TextLine()
-	textLine.SetParent(parent)
-	if horizontalAlign == True:
-		textLine.SetWindowHorizontalAlignCenter()
-	if verticalAlgin == True:
-		textLine.SetWindowVerticalAlignCenter()
-	textLine.SetHorizontalAlignCenter()
-	textLine.SetVerticalAlignCenter()
-	if app.WJ_MULTI_TEXTLINE:
-		textLine.DisableEnterToken()
-	if x != 0 and y != 0:
-		textLine.SetPosition(x, y)
-	textLine.Show()
-	return textLine
-
-def MakeExpandedImageBox(parent, name, x, y, flag = ""):
-	image = ExpandedImageBox()
-	image.SetParent(parent)
-	image.LoadImage(name)
-	image.SetPosition(x, y)
-	if flag != "":
-		image.AddFlag(flag)
-	image.Show()
-	return image
-
-def MakeButton(parent, x, y, tooltipText, path, up, over, down):
-	button = Button()
-	button.SetParent(parent)
-	button.SetPosition(x, y)
-	button.SetUpVisual(path + up)
-	button.SetOverVisual(path + over)
-	button.SetDownVisual(path + down)
-	button.SetToolTipText(tooltipText)
-	button.Show()
-	return button
-
-def RenderRoundBox(x, y, width, height, color):
-	grp.SetColor(color)
-	grp.RenderLine(x+2, y, width-3, 0)
-	grp.RenderLine(x+2, y+height, width-3, 0)
-	grp.RenderLine(x, y+2, 0, height-4)
-	grp.RenderLine(x+width, y+1, 0, height-3)
-	grp.RenderLine(x, y+2, 2, -2)
-	grp.RenderLine(x, y+height-2, 2, 2)
-	grp.RenderLine(x+width-2, y, 2, 2)
-	grp.RenderLine(x+width-2, y+height, 2, -2)
-
-def GenerateColor(r, g, b):
-	r = float(r) / 255.0
-	g = float(g) / 255.0
-	b = float(b) / 255.0
-	return grp.GenerateColor(r, g, b, 1.0)
-
-def EnablePaste(flag):
-	ime.EnablePaste(flag)
-
-def GetHyperlink():
-	return wndMgr.GetHyperlink()
-
-RegisterToolTipWindow("TEXT", TextLine)
-
-if app.RENDER_TARGET:
-	class RenderTarget(Window):
-		def __init__(self, layer = "UI"):
-			Window.__init__(self, layer)
-
-			self.number = -1
-
-		def __del__(self):
-			Window.__del__(self)
-
-		def RegisterWindow(self, layer):
-			self.hWnd = wndMgr.RegisterRenderTarget(self, layer)
-
-		def SetRenderTarget(self, number):
-			self.number = number
-			wndMgr.SetRenderTarget(self.hWnd, self.number)
-
-if app.ENABLE_MAILBOX:
-	class RenderBox(Window):
-		def __init__(self, layer = "UI"):
-			Window.__init__(self, layer)
-			self.color = 0xFF000000
-
-		def __del__(self):
-			Window.__del__(self)
-			self.color = 0xFF000000
-
-		def RegisterWindow(self, layer):
-			self.hWnd = wndMgr.Register(self, layer)
-
-		def SetColor(self, color):
-			self.color = color
-
-		def OnRender(self):
-			(x, y, width, height) = self.GetRect()
-			grp.SetColor(self.color)
-			grp.RenderBar(x, y, width, height)
-
-class Circle(Window):
-	def __init__(self):
-		Window.__init__(self)
-		self.color = 0xFF000000
-
-	def __del__(self):
-		Window.__del__(self)
-
-	def RegisterWindow(self, layer):
-		self.hWnd = wndMgr.RegisterCircle(self, layer)
-
-	def SetColor(self, color):
-		self.color = color
-		wndMgr.SetColor(self.hWnd, self.color)
-
-class OutlineWindow(Window):
-	PATTERN_PATH = "d:/ymir work/ui/pattern/"
-
-	def __init__(self, layer = "UI"):
-		Window.__init__(self, layer)
-		self.__Initialize()
-
-	def __del__(self):
-		Window.__del__(self)
-		self.__Initialize()
-
-	def __Initialize(self):
-		self.pattern_x_count = 0
-		self.pattern_y_count = 0
-		self.left_top_img = None
-		self.right_top_img = None
-		self.left_bottom_img = None
-		self.right_bottom_img = None
-		self.top_center_img = None
-		self.left_center_img = None
-		self.right_center_img = None
-		self.bottom_center_img = None
-		self.center_img = None
-
-	def MakeOutlineWindow(self, window_width, window_height):
-		self.AddFlag("ltr")
-		self.AddFlag("attach")
-		self.SetWindowName("outline_window")
-		self.SetSize(window_width, window_height)
-
-		self.pattern_x_count = (window_width - 32) / 16
-		self.pattern_y_count = (window_height - 32) / 16
-
-		self.left_top_img = ImageBox()
-		self.left_top_img.SetParent(self)
-		self.left_top_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_left_top.tga")
-		self.left_top_img.SetPosition(0, 0)
-		self.left_top_img.Show()
-
-		self.right_top_img = ImageBox()
-		self.right_top_img.SetParent(self)
-		self.right_top_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_right_top.tga")
-		self.right_top_img.SetPosition(window_width - 16, 0)
-		self.right_top_img.Show()
-
-		self.left_bottom_img = ImageBox()
-		self.left_bottom_img.SetParent(self)
-		self.left_bottom_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_left_bottom.tga")
-		self.left_bottom_img.SetPosition(0, window_height - 16)
-		self.left_bottom_img.Show()
-
-		self.right_bottom_img = ImageBox()
-		self.right_bottom_img.SetParent(self)
-		self.right_bottom_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_right_bottom.tga")
-		self.right_bottom_img.SetPosition(window_width - 16, window_height - 16)
-		self.right_bottom_img.Show()
-
-		self.top_center_img = ExpandedImageBox()
-		self.top_center_img.SetParent(self)
-		self.top_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_top.tga")
-		self.top_center_img.SetPosition(16, 0)
-		self.top_center_img.SetRenderingRect(0.0, 0.0, self.pattern_x_count, 0.0)
-		self.top_center_img.Show()
-
-		self.left_center_img = ExpandedImageBox()
-		self.left_center_img.SetParent(self)
-		self.left_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_left.tga")
-		self.left_center_img.SetPosition(0, 16)
-		self.left_center_img.SetRenderingRect(0.0, 0.0, 0.0, self.pattern_y_count)
-		self.left_center_img.Show()
-
-		self.right_center_img = ExpandedImageBox()
-		self.right_center_img.SetParent(self)
-		self.right_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_right.tga")
-		self.right_center_img.SetPosition(window_width - 16, 16)
-		self.right_center_img.SetRenderingRect(0.0, 0.0, 0.0, self.pattern_y_count)
-		self.right_center_img.Show()
-
-		self.bottom_center_img = ExpandedImageBox()
-		self.bottom_center_img.SetParent(self)
-		self.bottom_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_bottom.tga")
-		self.bottom_center_img.SetPosition(16, window_height - 16)
-		self.bottom_center_img.SetRenderingRect(0.0, 0.0, self.pattern_x_count, 0.0)
-		self.bottom_center_img.Show()
-
-		self.center_img = ExpandedImageBox()
-		self.center_img.SetParent(self)
-		self.center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_center.tga")
-		self.center_img.SetPosition(16, 16)
-		self.center_img.SetRenderingRect(0.0, 0.0, self.pattern_x_count, self.pattern_y_count)
-		self.center_img.Show()
-
-if app.ENABLE_SEND_TARGET_INFO:
-	class CheckBox(Window):
-		def __init__(self):
-			Window.__init__(self)
-
-			self.checkbox_image = None
-			self.check_image = None
-			self.text_line = None
-			self.check = False
-
-			self.event_func = { "check" : None, "uncheck" : None, }
-			self.event_args = { "check" : None, "uncheck" : None, }
-
-			self.__BuildCheckBox()
-
-		def __del__(self):
-			Window.__del__(self)
-
-			self.checkbox_image = None
-			self.check_image = None
-			self.text_line = None
-			self.check = False
-
-			self.event_func = { "check" : None, "uncheck" : None, }
-			self.event_args = { "check" : None, "uncheck" : None, }
-
-		def __BuildCheckBox(self):
-			checkbox_image = ImageBox()
-			checkbox_image.SetParent(self)
-			checkbox_image.AddFlag("not_pick")
-			checkbox_image.LoadImage("d:/ymir work/ui/game/quest/quest_checkbox.tga")
-			checkbox_image.Show()
-			self.checkbox_image = checkbox_image
-
-			check_image = ImageBox()
-			check_image.SetParent(self)
-			check_image.AddFlag("not_pick")
-			check_image.SetPosition(0, -4)
-			check_image.LoadImage("d:/ymir work/ui/game/quest/quest_checked.tga")
-			check_image.Hide()
-			self.check_image = check_image
-
-			text_line = TextLine()
-			text_line.SetParent(self)
-			text_line.SetPosition(17, -2)
-			text_line.Show()
-			self.text_line = text_line
-
-			self.SetSize(self.checkbox_image.GetWidth() + self.text_line.GetTextSize()[0], self.checkbox_image.GetHeight() + self.text_line.GetTextSize()[1])
-
-		def SetText(self, text, color = 0):
-			if self.text_line:
-				self.text_line.SetText(text)
-				if color:
-					self.text_line.SetPackedFontColor(color)
-
-			self.SetSize(self.checkbox_image.GetWidth() + self.text_line.GetTextSize()[0], self.checkbox_image.GetHeight() + self.text_line.GetTextSize()[1])
-
-		def SetCheckBox(self, check):
-			self.check = check
-			if check:
-				self.check_image.Show()
-			else:
-				self.check_image.Hide()
-
-		def IsChecked(self):
-			return self.check
-
-		def SetEvent(self, func, *args):
-			result = self.event_func.has_key(args[0])
-			if result:
-				self.event_func[args[0]] = func
-				self.event_args[args[0]] = args
-			else:
-				print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
-
-		def OnMouseLeftButtonUp(self):
-			if self.check != True:
-				self.check = True
-				self.check_image.Show()
-
-				if self.event_func["check"]:
-					apply(self.event_func["check"], self.event_args["check"])
-			else:
-				self.check = False
-				self.check_image.Hide()
-
-				if self.event_func["uncheck"]:
-					apply(self.event_func["uncheck"], self.event_args["uncheck"])
+import app
+import ime
+import grp
+import snd
+import wndMgr
+import item
+import skill
+import localeInfo
+import dbg
+# MARK_BUG_FIX
+import guild
+# END_OF_MARK_BUG_FIX
+
+from _weakref import proxy
+
+BACKGROUND_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 1.0)
+DARK_COLOR = grp.GenerateColor(0.2, 0.2, 0.2, 1.0)
+BRIGHT_COLOR = grp.GenerateColor(0.7, 0.7, 0.7, 1.0)
+
+if localeInfo.IsCANADA():
+	SELECT_COLOR = grp.GenerateColor(0.9, 0.03, 0.01, 0.4)
+else:
+	#SELECT_COLOR = grp.GenerateColor(0.0, 0.0, 0.5, 0.3)
+	SELECT_COLOR = grp.GenerateColor(0.2, 0.0, 0.5, 0.8) # ori
+	#SELECT_COLOR = grp.GenerateColor(0.9, 0.03, 0.01, 0.4) # red
+
+WHITE_COLOR = grp.GenerateColor(1.0, 1.0, 1.0, 0.5)
+HALF_WHITE_COLOR = grp.GenerateColor(1.0, 1.0, 1.0, 0.2)
+
+if app.ENABLE_KEYCHANGE_SYSTEM:
+	RED_COLOR = grp.GenerateColor(1.0, 0.0, 0.0, 0.5)
+	HALF_HALF_RED_COLOR = grp.GenerateColor(1.0, 0.0, 0.0, 0.4)
+	HALF_RED_COLOR = grp.GenerateColor(1.0, 0.0, 0.0, 0.3)
+
+createToolTipWindowDict = {}
+def RegisterCandidateWindowClass(codePage, candidateWindowClass):
+	EditLine.candidateWindowClassDict[codePage] = candidateWindowClass
+def RegisterToolTipWindow(type, createToolTipWindow):
+	createToolTipWindowDict[type] = createToolTipWindow
+
+app.SetDefaultFontName(localeInfo.UI_DEF_FONT)
+
+## Window Manager Event List##
+##############################
+## "OnMouseLeftButtonDown"
+## "OnMouseLeftButtonUp"
+## "OnMouseLeftButtonDoubleClick"
+## "OnMouseRightButtonDown"
+## "OnMouseRightButtonUp"
+## "OnMouseRightButtonDoubleClick"
+## "OnMouseDrag"
+## "OnSetFocus"
+## "OnKillFocus"
+## "OnMouseOverIn"
+## "OnMouseOverOut"
+## "OnRender"
+## "OnUpdate"
+## "OnKeyDown"
+## "OnKeyUp"
+## "OnTop"
+## "OnIMEUpdate" ## IME Only
+## "OnIMETab"	## IME Only
+## "OnIMEReturn" ## IME Only
+##############################
+## Window Manager Event List##
+
+class __mem_func__:
+	class __noarg_call__:
+		def __init__(self, cls, obj, func):
+			self.cls = cls
+			self.obj = proxy(obj)
+			self.func = proxy(func)
+
+		def __call__(self, *arg):
+			return self.func(self.obj)
+
+	class __arg_call__:
+		def __init__(self, cls, obj, func):
+			self.cls = cls
+			self.obj = proxy(obj)
+			self.func = proxy(func)
+
+		def __call__(self, *arg):
+			return self.func(self.obj, *arg)
+
+	def __init__(self, mfunc):
+		if mfunc.im_func.func_code.co_argcount>1:
+			self.call = __mem_func__.__arg_call__(mfunc.im_class, mfunc.im_self, mfunc.im_func)
+		else:
+			self.call = __mem_func__.__noarg_call__(mfunc.im_class, mfunc.im_self, mfunc.im_func)
+
+	def __call__(self, *arg):
+		return self.call(*arg)
+
+class Window(object):
+	def NoneMethod(cls):
+		pass
+
+	NoneMethod = classmethod(NoneMethod)
+
+	def __init__(self, layer = "UI"):
+		self.hWnd = None
+		self.parentWindow = 0
+		self.onMouseLeftButtonUpEvent = None
+		self.RegisterWindow(layer)
+		self.Hide()
+
+		if app.ENABLE_MAILBOX:
+			self.onMouseLeftButtonUpEventArgs = None
+			self.overFunc = None
+			self.overArgs = None
+			self.overOutFunc = None
+			self.overOutArgs = None
+
+		if app.ENABLE_MOUSE_WHEEL_TOP_WINDOW:
+			self.onMouseWheelEvent=None
+
+	def __del__(self):
+		wndMgr.Destroy(self.hWnd)
+
+		if app.ENABLE_MAILBOX:
+			self.onMouseLeftButtonUpEventArgs = None
+			self.overFunc = None
+			self.overArgs = None
+			self.overOutFunc = None
+			self.overOutArgs = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.Register(self, layer)
+
+	def Destroy(self):
+		pass
+
+	def GetWindowHandle(self):
+		return self.hWnd
+
+	def AddFlag(self, style):
+		wndMgr.AddFlag(self.hWnd, style)
+
+	def IsRTL(self):
+		return wndMgr.IsRTL(self.hWnd)
+
+	def SetWindowName(self, Name):
+		wndMgr.SetName(self.hWnd, Name)
+
+	def GetWindowName(self):
+		return wndMgr.GetName(self.hWnd)
+
+	def SetParent(self, parent):
+		wndMgr.SetParent(self.hWnd, parent.hWnd)
+
+	def SetParentProxy(self, parent):
+		self.parentWindow = proxy(parent)
+		wndMgr.SetParent(self.hWnd, parent.hWnd)
+
+	def GetParentProxy(self):
+		return self.parentWindow
+
+	def SetPickAlways(self):
+		wndMgr.SetPickAlways(self.hWnd)
+
+	def SetWindowHorizontalAlignLeft(self):
+		wndMgr.SetWindowHorizontalAlign(self.hWnd, wndMgr.HORIZONTAL_ALIGN_LEFT)
+
+	def SetWindowHorizontalAlignCenter(self):
+		wndMgr.SetWindowHorizontalAlign(self.hWnd, wndMgr.HORIZONTAL_ALIGN_CENTER)
+
+	def SetWindowHorizontalAlignRight(self):
+		wndMgr.SetWindowHorizontalAlign(self.hWnd, wndMgr.HORIZONTAL_ALIGN_RIGHT)
+
+	def SetWindowVerticalAlignTop(self):
+		wndMgr.SetWindowVerticalAlign(self.hWnd, wndMgr.VERTICAL_ALIGN_TOP)
+
+	def SetWindowVerticalAlignCenter(self):
+		wndMgr.SetWindowVerticalAlign(self.hWnd, wndMgr.VERTICAL_ALIGN_CENTER)
+
+	def SetWindowVerticalAlignBottom(self):
+		wndMgr.SetWindowVerticalAlign(self.hWnd, wndMgr.VERTICAL_ALIGN_BOTTOM)
+
+	def SetTop(self):
+		wndMgr.SetTop(self.hWnd)
+
+	def Show(self):
+		wndMgr.Show(self.hWnd)
+
+	def Hide(self):
+		wndMgr.Hide(self.hWnd)
+
+	def Lock(self):
+		wndMgr.Lock(self.hWnd)
+
+	def Unlock(self):
+		wndMgr.Unlock(self.hWnd)
+
+	def IsShow(self):
+		return wndMgr.IsShow(self.hWnd)
+
+	def UpdateRect(self):
+		wndMgr.UpdateRect(self.hWnd)
+
+	def SetSize(self, width, height):
+		wndMgr.SetWindowSize(self.hWnd, width, height)
+
+	def GetWidth(self):
+		return wndMgr.GetWindowWidth(self.hWnd)
+
+	def GetHeight(self):
+		return wndMgr.GetWindowHeight(self.hWnd)
+
+	def GetLocalPosition(self):
+		return wndMgr.GetWindowLocalPosition(self.hWnd)
+
+	if app.ENABLE_SEND_TARGET_INFO:
+		def GetLeft(self):
+			x, y = self.GetLocalPosition()
+			return x
+
+		def GetRight(self):
+			return self.GetLeft() + self.GetWidth()
+
+		def GetTop(self):
+			x, y = self.GetLocalPosition()
+			return y
+
+		def GetBottom(self):
+			return self.GetTop() + self.GetHeight()
+
+	def GetGlobalPosition(self):
+		return wndMgr.GetWindowGlobalPosition(self.hWnd)
+
+	def GetMouseLocalPosition(self):
+		return wndMgr.GetMouseLocalPosition(self.hWnd)
+
+	def GetRect(self):
+		return wndMgr.GetWindowRect(self.hWnd)
+
+	def SetPosition(self, x, y):
+		wndMgr.SetWindowPosition(self.hWnd, x, y)
+
+	def SetCenterPosition(self, x = 0, y = 0):
+		self.SetPosition((wndMgr.GetScreenWidth() - self.GetWidth()) / 2 + x, (wndMgr.GetScreenHeight() - self.GetHeight()) / 2 + y)
+
+	def IsFocus(self):
+		return wndMgr.IsFocus(self.hWnd)
+
+	def SetFocus(self):
+		wndMgr.SetFocus(self.hWnd)
+
+	def KillFocus(self):
+		wndMgr.KillFocus(self.hWnd)
+
+	def GetChildCount(self):
+		return wndMgr.GetChildCount(self.hWnd)
+
+	def IsIn(self):
+		return wndMgr.IsIn(self.hWnd)
+
+	if app.ENABLE_MAILBOX:
+		def SetOnMouseLeftButtonUpEvent(self, event, *args):
+			self.onMouseLeftButtonUpEvent = event
+			self.onMouseLeftButtonUpEventArgs = args
+
+		def OnMouseLeftButtonUp(self):
+			if self.onMouseLeftButtonUpEvent:
+				apply(self.onMouseLeftButtonUpEvent, self.onMouseLeftButtonUpEventArgs)
+	else:
+		def SetOnMouseLeftButtonUpEvent(self, event):
+			self.onMouseLeftButtonUpEvent = event
+
+		def OnMouseLeftButtonUp(self):
+			if self.onMouseLeftButtonUpEvent:
+				self.onMouseLeftButtonUpEvent()
+
+	if app.ENABLE_MOUSE_WHEEL_TOP_WINDOW:
+		def SetMouseWheelEvent(self, event):
+			self.onMouseWheelEvent = event
+
+		def OnMouseWheel(self, delta):
+			if self.onMouseWheelEvent:
+				return self.onMouseWheelEvent(delta)
+			return False
+
+	if app.ENABLE_MAILBOX:
+		def OnMouseOverIn(self):
+			if self.overFunc:
+				apply(self.overFunc, self.overArgs)
+
+		def OnMouseOverOut(self):
+			if self.overOutFunc:
+				apply(self.overOutFunc, self.overOutArgs)
+
+		def SetOverEvent(self, func, *args):
+			self.overFunc = func
+			self.overArgs = args
+
+		def SetOverOutEvent(self, func, *args):
+			self.overOutFunc = func
+			self.overOutArgs = args
+
+	if app.ENABLE_CLIP_MASK:
+		def SetClippingMaskRect(self, left, top, right, bottom):
+			wndMgr.SetClippingMaskRect(self.hWnd, left, top, right, bottom)
+
+		def SetClippingMaskWindow(self, clipping_mask_window):
+			wndMgr.SetClippingMaskWindow(self.hWnd, clipping_mask_window.hWnd)
+
+	def IsRendering(self):
+		return wndMgr.IsRendering(self.hWnd)
+
+class ListBoxEx(Window):
+	class Item(Window):
+		def __init__(self):
+			Window.__init__(self)
+
+		def __del__(self):
+			Window.__del__(self)
+
+		def SetParent(self, parent):
+			Window.SetParent(self, parent)
+			self.parent = proxy(parent)
+
+		def OnMouseLeftButtonDown(self):
+			self.parent.SelectItem(self)
+
+		def OnRender(self):
+			if self.parent.GetSelectedItem() == self:
+				self.OnSelectedRender()
+
+		def OnSelectedRender(self):
+			x, y = self.GetGlobalPosition()
+			grp.SetColor(grp.GenerateColor(0.0, 0.0, 0.7, 0.7))
+			grp.RenderBar(x, y, self.GetWidth(), self.GetHeight())
+
+	def __init__(self):
+		Window.__init__(self)
+
+		self.viewItemCount = 10
+		self.basePos = 0
+		self.itemHeight = 16
+		self.itemStep = 20
+		self.selItem = 0
+		self.itemList = []
+		self.onSelectItemEvent = lambda *arg: None
+
+		if localeInfo.IsARABIC():
+			self.itemWidth = 130
+		else:
+			self.itemWidth = 100
+
+		self.scrollBar = None
+		self.__UpdateSize()
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def __UpdateSize(self):
+		height = self.itemStep * self.__GetViewItemCount()
+
+		self.SetSize(self.itemWidth, height)
+
+	def IsEmpty(self):
+		if len(self.itemList) == 0:
+			return 1
+		return 0
+
+	def SetItemStep(self, itemStep):
+		self.itemStep = itemStep
+		self.__UpdateSize()
+
+	def SetItemSize(self, itemWidth, itemHeight):
+		self.itemWidth = itemWidth
+		self.itemHeight = itemHeight
+		self.__UpdateSize()
+
+	def SetViewItemCount(self, viewItemCount):
+		self.viewItemCount = viewItemCount
+
+	def SetSelectEvent(self, event):
+		self.onSelectItemEvent = event
+
+	def SetBasePos(self, basePos):
+		for oldItem in self.itemList[self.basePos:self.basePos + self.viewItemCount]:
+			oldItem.Hide()
+
+		self.basePos = basePos
+
+		pos = basePos
+		for newItem in self.itemList[self.basePos : self.basePos + self.viewItemCount]:
+			(x, y) = self.GetItemViewCoord(pos, newItem.GetWidth())
+			newItem.SetPosition(x, y)
+			newItem.Show()
+			pos += 1
+
+	def GetItemIndex(self, argItem):
+		return self.itemList.index(argItem)
+
+	def GetSelectedItem(self):
+		return self.selItem
+
+	def SelectIndex(self, index):
+		if index >= len(self.itemList) or index < 0:
+			self.selItem = None
+			return
+
+		try:
+			self.selItem = self.itemList[index]
+		except:
+			pass
+
+	def SelectItem(self, selItem):
+		self.selItem = selItem
+		self.onSelectItemEvent(selItem)
+
+	def RemoveAllItems(self):
+		self.selItem = None
+		self.itemList = []
+
+		if self.scrollBar:
+			self.scrollBar.SetPos(0)
+
+	def RemoveItem(self, delItem):
+		if delItem == self.selItem:
+			self.selItem = None
+
+		self.itemList.remove(delItem)
+
+	def AppendItem(self, newItem):
+		newItem.SetParent(self)
+		newItem.SetSize(self.itemWidth, self.itemHeight)
+
+		pos = len(self.itemList)
+		if self.__IsInViewRange(pos):
+			(x, y) = self.GetItemViewCoord(pos, newItem.GetWidth())
+			newItem.SetPosition(x, y)
+			newItem.Show()
+		else:
+			newItem.Hide()
+
+		self.itemList.append(newItem)
+
+	def SetScrollBar(self, scrollBar):
+		scrollBar.SetScrollEvent(__mem_func__(self.__OnScroll))
+		self.scrollBar = scrollBar
+
+	def __OnScroll(self):
+		self.SetBasePos(int(self.scrollBar.GetPos() * self.__GetScrollLen()))
+
+	def __GetScrollLen(self):
+		scrollLen = self.__GetItemCount() - self.__GetViewItemCount()
+		if scrollLen < 0:
+			return 0
+
+		return scrollLen
+
+	def __GetViewItemCount(self):
+		return self.viewItemCount
+
+	def __GetItemCount(self):
+		return len(self.itemList)
+
+	def GetItemViewCoord(self, pos, itemWidth):
+		if localeInfo.IsARABIC():
+			return (self.GetWidth() - itemWidth - 10, (pos-self.basePos) * self.itemStep)
+		else:
+			return (0, (pos - self.basePos) * self.itemStep)
+
+	def __IsInViewRange(self, pos):
+		if pos < self.basePos:
+			return 0
+
+		if pos >= self.basePos + self.viewItemCount:
+			return 0
+
+		return 1
+
+class CandidateListBox(ListBoxEx):
+
+	HORIZONTAL_MODE = 0
+	VERTICAL_MODE = 1
+
+	class Item(ListBoxEx.Item):
+		def __init__(self, text):
+			ListBoxEx.Item.__init__(self)
+
+			self.textBox=TextLine()
+			self.textBox.SetParent(self)
+			self.textBox.SetText(text)
+			self.textBox.Show()
+
+		def __del__(self):
+			ListBoxEx.Item.__del__(self)
+
+	def __init__(self, mode = HORIZONTAL_MODE):
+		ListBoxEx.__init__(self)
+		self.itemWidth=32
+		self.itemHeight=32
+		self.mode = mode
+
+	def __del__(self):
+		ListBoxEx.__del__(self)
+
+	def SetMode(self, mode):
+		self.mode = mode
+
+	def AppendItem(self, newItem):
+		ListBoxEx.AppendItem(self, newItem)
+
+	def GetItemViewCoord(self, pos):
+		if self.mode == self.HORIZONTAL_MODE:
+			return ((pos-self.basePos)*self.itemStep, 0)
+		elif self.mode == self.VERTICAL_MODE:
+			return (0, (pos-self.basePos)*self.itemStep)
+
+class TextLine(Window):
+	def __init__(self):
+		Window.__init__(self)
+		self.max = 0
+		self.SetFontName(localeInfo.UI_DEF_FONT)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterTextLine(self, layer)
+
+	def SetMax(self, max):
+		wndMgr.SetMax(self.hWnd, max)
+
+	def SetLimitWidth(self, width):
+		wndMgr.SetLimitWidth(self.hWnd, width)
+
+	def SetMultiLine(self):
+		wndMgr.SetMultiLine(self.hWnd, True)
+
+	def SetHorizontalAlignArabic(self):
+		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_ARABIC)
+
+	def SetHorizontalAlignLeft(self):
+		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_LEFT)
+
+	def SetHorizontalAlignRight(self):
+		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_RIGHT)
+
+	def SetHorizontalAlignCenter(self):
+		wndMgr.SetHorizontalAlign(self.hWnd, wndMgr.TEXT_HORIZONTAL_ALIGN_CENTER)
+
+	def SetVerticalAlignTop(self):
+		wndMgr.SetVerticalAlign(self.hWnd, wndMgr.TEXT_VERTICAL_ALIGN_TOP)
+
+	def SetVerticalAlignBottom(self):
+		wndMgr.SetVerticalAlign(self.hWnd, wndMgr.TEXT_VERTICAL_ALIGN_BOTTOM)
+
+	def SetVerticalAlignCenter(self):
+		wndMgr.SetVerticalAlign(self.hWnd, wndMgr.TEXT_VERTICAL_ALIGN_CENTER)
+
+	def SetSecret(self, Value=True):
+		wndMgr.SetSecret(self.hWnd, Value)
+
+	def SetOutline(self, Value=True):
+		wndMgr.SetOutline(self.hWnd, Value)
+
+	def SetFeather(self, value=True):
+		wndMgr.SetFeather(self.hWnd, value)
+
+	def SetFontName(self, fontName):
+		wndMgr.SetFontName(self.hWnd, fontName)
+
+	if app.WJ_MULTI_TEXTLINE:
+		def SetEnterToken(self, bool):
+			wndMgr.SetEnterToken(self.hWnd, bool)
+
+	def SetDefaultFontName(self):
+		wndMgr.SetFontName(self.hWnd, localeInfo.UI_DEF_FONT)
+
+	def SetFontColor(self, red, green, blue):
+		wndMgr.SetFontColor(self.hWnd, red, green, blue)
+
+	def SetTextColor(self, color):
+		self.SetPackedFontColor(color)
+
+	def SetPackedFontColor(self, color):
+		wndMgr.SetFontColor(self.hWnd, color)
+
+	def SetText(self, text):
+		wndMgr.SetText(self.hWnd, text)
+
+	def GetTextLineCount(self):
+		return wndMgr.GetTextLineCount(self.hWnd)
+
+	def DisableEnterToken(self):
+		wndMgr.DisableEnterToken(self.hWnd)
+
+	def SetLineHeight(self, Height):
+		wndMgr.SetLineHeight(self.hWnd, Height)
+
+	def GetLineHeight(self):
+		return wndMgr.GetLineHeight(self.hWnd)
+
+	def GetText(self):
+		return wndMgr.GetText(self.hWnd)
+
+	def GetTextSize(self):
+		return wndMgr.GetTextSize(self.hWnd)
+
+#if app.ENABLE_MINI_GAME_YUTNORI:
+class MoveTextLine(TextLine):
+	def __init__(self):
+		TextLine.__init__(self)
+		self.end_move_event_func = None
+		self.end_move_event_args = None
+
+	def __del__(self):
+		TextLine.__del__(self)
+		self.end_move_event_func = None
+		self.end_move_event_args = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterMoveTextLine(self, layer)
+
+	def SetMovePosition(self, dst_x, dst_y):
+		wndMgr.SetMovePosition(self.hWnd, dst_x, dst_y)
+
+	def SetMoveSpeed(self, speed):
+		wndMgr.SetMoveSpeed(self.hWnd, speed)
+
+	def MoveStart(self):
+		wndMgr.MoveStart(self.hWnd)
+	def MoveStop(self):
+		wndMgr.MoveStop(self.hWnd)
+	def GetMove(self):
+		return wndMgr.GetMove(self.hWnd)
+
+	def OnEndMove(self):
+		if self.end_move_event_func:
+			apply(self.end_move_event_func, self.end_move_event_args)
+
+	def SetEndMoveEvent(self, event, *args):
+		self.end_move_event_func = event
+		self.end_move_event_args = args
+
+class EmptyCandidateWindow(Window):
+	def __init__(self):
+		Window.__init__(self)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def Load(self):
+		pass
+
+	def SetCandidatePosition(self, x, y, textCount):
+		pass
+
+	def Clear(self):
+		pass
+
+	def Append(self, text):
+		pass
+
+	def Refresh(self):
+		pass
+
+	def Select(self):
+		pass
+
+class EditLine(TextLine):
+	candidateWindowClassDict = {}
+
+	def __init__(self):
+		TextLine.__init__(self)
+
+		if app.WJ_MULTI_TEXTLINE:
+			self.DisableEnterToken()
+		self.eventReturn = Window.NoneMethod
+		self.eventEscape = Window.NoneMethod
+#		self.eventTab = None
+		self.numberMode = False
+		self.UseCodePage = True # MT-679   Å¸Æ² CodePage Ì½
+		self.useIME = True
+
+		self.eventUpdate = Window.NoneMethod
+		self.eventTab    = Window.NoneMethod
+		self.eventUpdateArgs = None
+		self.eventReturnArgs = None
+		self.eventEscapeArgs = None
+		self.eventTabArgs	= None
+
+		self.backgroundText = TextLine()
+		self.backgroundText.SetParent(self)
+		self.backgroundText.SetPosition(0, 0)
+		self.backgroundText.SetPackedFontColor(WHITE_COLOR)
+		self.backgroundText.Hide()
+
+		self.bCodePage = False
+
+		self.candidateWindowClass = None
+		self.candidateWindow = None
+		self.SetCodePage(app.GetDefaultCodePage())
+
+		self.readingWnd = ReadingWnd()
+		self.readingWnd.Hide()
+
+	def __del__(self):
+		TextLine.__del__(self)
+
+		self.eventReturn = Window.NoneMethod
+		self.eventEscape = Window.NoneMethod
+#		self.eventTab = None
+		self.eventUpdate = Window.NoneMethod
+		self.eventTab    = Window.NoneMethod
+		self.eventUpdateArgs = None
+		self.eventReturnArgs = None
+		self.eventEscapeArgs = None
+		self.eventTabArgs = None
+		self.backgroundText = None
+
+	def SetCodePage(self, codePage):
+		candidateWindowClass = EditLine.candidateWindowClassDict.get(codePage, EmptyCandidateWindow)
+		self.__SetCandidateClass(candidateWindowClass)
+
+	def __SetCandidateClass(self, candidateWindowClass):
+		if self.candidateWindowClass==candidateWindowClass:
+			return
+
+		self.candidateWindowClass = candidateWindowClass
+		self.candidateWindow = self.candidateWindowClass()
+		self.candidateWindow.Load()
+		self.candidateWindow.Hide()
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterTextLine(self, layer)
+
+	def SAFE_SetReturnEvent(self, event):
+		self.eventReturn = __mem_func__(event)
+
+	def SetReturnEvent(self, event):
+		self.eventReturn = event
+
+	def SAFE_SetUpdateEvent(self, event, *args):
+		self.eventUpdate = __mem_func__(event)
+		self.eventUpdateArgs = args
+
+	def SetUpdateEvent(self, event, *args):
+		self.eventUpdate = event
+		self.eventUpdateArgs = args
+
+	def SetEscapeEvent(self, event):
+		self.eventEscape = event
+
+	def SetTabEvent(self, event):
+		self.eventTab = event
+
+	def SetBackgroundText(self, text):
+		self.backgroundText.SetPosition(0, 0)
+		self.backgroundText.SetText(text)
+
+		if not self.backgroundText.IsShow():
+			self.backgroundText.Show()
+
+	def SetTipText(self, tipText):
+		input = self.GetText()
+		(widht, height) = self.GetTextSize()
+
+		tip = tipText[len(input):]
+		self.backgroundText.SetPosition(widht, 0)
+		self.backgroundText.SetText(tip)
+
+		if not self.backgroundText.IsShow():
+			self.backgroundText.Show()
+
+	def GetBackgroundText(self):
+		return self.backgroundText.GetText()
+
+	def SetMax(self, max):
+		self.max = max
+		wndMgr.SetMax(self.hWnd, self.max)
+		ime.SetMax(self.max)
+		self.SetUserMax(self.max)
+
+	def SetUserMax(self, max):
+		self.userMax = max
+		ime.SetUserMax(self.userMax)
+
+	def SetNumberMode(self):
+		self.numberMode = True
+
+	#MT-679   Å¸Æ² CodePage Ì½
+	def SetUseCodePage(self, bUse = True):
+		self.UseCodePage = bUse
+
+	#def AddExceptKey(self, key):
+	#	ime.AddExceptKey(key)
+
+	#def ClearExceptKey(self):
+	#	ime.ClearExceptKey()
+
+	def SetIMEFlag(self, flag):
+		self.useIME = flag
+
+	def SetText(self, text):
+		wndMgr.SetText(self.hWnd, text)
+
+		if self.IsFocus():
+			ime.SetText(text)
+
+	def Enable(self):
+		wndMgr.ShowCursor(self.hWnd)
+
+	def Disable(self):
+		wndMgr.HideCursor(self.hWnd)
+
+	def SetEndPosition(self):
+		ime.MoveEnd()
+
+	def OnSetFocus(self):
+		Text = self.GetText()
+		ime.SetText(Text)
+		ime.SetMax(self.max)
+		ime.SetUserMax(self.userMax)
+		ime.SetCursorPosition(-1)
+		if self.numberMode:
+			ime.SetNumberMode()
+		else:
+			ime.SetStringMode()
+		ime.EnableCaptureInput()
+		if self.useIME:
+			ime.EnableIME()
+		else:
+			ime.DisableIME()
+
+		wndMgr.ShowCursor(self.hWnd, True)
+
+	def OnKillFocus(self):
+		self.SetText(ime.GetText(self.bCodePage))
+		self.OnIMECloseCandidateList()
+		self.OnIMECloseReadingWnd()
+		ime.DisableIME()
+		ime.DisableCaptureInput()
+		wndMgr.HideCursor(self.hWnd)
+
+	def OnIMEChangeCodePage(self):
+		self.SetCodePage(ime.GetCodePage())
+
+	def OnIMEOpenCandidateList(self):
+		self.candidateWindow.Show()
+		self.candidateWindow.Clear()
+		self.candidateWindow.Refresh()
+
+		gx, gy = self.GetGlobalPosition()
+		self.candidateWindow.SetCandidatePosition(gx, gy, len(self.GetText()))
+
+		return True
+
+	def OnIMECloseCandidateList(self):
+		self.candidateWindow.Hide()
+		return True
+
+	def OnIMEOpenReadingWnd(self):
+		gx, gy = self.GetGlobalPosition()
+		textlen = len(self.GetText())-2
+		reading = ime.GetReading()
+		readinglen = len(reading)
+		self.readingWnd.SetReadingPosition( gx + textlen*6-24-readinglen*6, gy )
+		self.readingWnd.SetText(reading)
+		if ime.GetReadingError() == 0:
+			self.readingWnd.SetTextColor(0xffffffff)
+		else:
+			self.readingWnd.SetTextColor(0xffff0000)
+		self.readingWnd.SetSize(readinglen * 6 + 4, 19)
+		self.readingWnd.Show()
+		return True
+
+	def OnIMECloseReadingWnd(self):
+		self.readingWnd.Hide()
+		return True
+
+	def IsNumber(self, text):
+		try:
+			int(text)
+			return True
+		except ValueError:
+			return False
+
+	def IsIncludeCodePage(self, text):
+		textLen = len(text)
+		idx = 0
+
+		while(idx < textLen):
+			n = text.find("@", idx)
+
+			if n == -1:
+				break
+			elif n+4 < textLen and self.IsNumber(text[n+1:n+4]) == True:
+				return True
+			else:
+				idx = n + 1
+
+		return False
+
+	def OnIMEUpdate(self):
+		# MT-679   Å¸Æ² CodePage Ì½
+		if self.UseCodePage == False and self.IsIncludeCodePage(ime.GetText(self.bCodePage)) == True:
+			ime.SetText("")
+
+		snd.PlaySound("sound/ui/type.wav")
+		TextLine.SetText(self, ime.GetText(self.bCodePage))
+
+	def OnIMETab(self):
+		if self.eventTab:
+			self.eventTab()
+			return True
+
+		return False
+
+	def OnIMEReturn(self):
+		snd.PlaySound("sound/ui/click.wav")
+		self.eventReturn()
+
+		return True
+
+	def OnPressEscapeKey(self):
+		self.eventEscape()
+		return True
+
+	def OnKeyDown(self, key):
+		if app.DIK_F1 == key:
+			return False
+		if app.DIK_F2 == key:
+			return False
+		if app.DIK_F3 == key:
+			return False
+		if app.DIK_F4 == key:
+			return False
+		if app.DIK_LALT == key:
+			return False
+		if app.DIK_SYSRQ == key:
+			return False
+		if app.DIK_LCONTROL == key:
+			return False
+		if app.DIK_V == key:
+			if app.IsPressed(app.DIK_LCONTROL):
+				ime.PasteTextFromClipBoard()
+
+		return True
+
+	def OnKeyUp(self, key):
+		if app.DIK_F1 == key:
+			return False
+		if app.DIK_F2 == key:
+			return False
+		if app.DIK_F3 == key:
+			return False
+		if app.DIK_F4 == key:
+			return False
+		if app.DIK_LALT == key:
+			return False
+		if app.DIK_SYSRQ == key:
+			return False
+		if app.DIK_LCONTROL == key:
+			return False
+
+		return True
+
+	def OnIMEKeyDown(self, key):
+		# Left
+		if app.VK_LEFT == key:
+			ime.MoveLeft()
+			return True
+		# Right
+		if app.VK_RIGHT == key:
+			ime.MoveRight()
+			return True
+
+		# Home
+		if app.VK_HOME == key:
+			ime.MoveHome()
+			return True
+		# End
+		if app.VK_END == key:
+			ime.MoveEnd()
+			return True
+
+		# Delete
+		if app.VK_DELETE == key:
+			ime.Delete()
+			TextLine.SetText(self, ime.GetText(self.bCodePage))
+			return True
+
+		return True
+
+	# def OnMouseLeftButtonDown(self):
+		# self.SetFocus()
+
+	def OnMouseLeftButtonDown(self):
+		if False == self.IsIn():
+			return False
+
+		self.SetFocus()
+		PixelPosition = wndMgr.GetCursorPosition(self.hWnd)
+		ime.SetCursorPosition(PixelPosition)
+
+	if app.WJ_MULTI_TEXTLINE:
+		def DisableEnterToken(self):
+			wndMgr.DisableEnterToken(self.hWnd)
+
+class MarkBox(Window):
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterMarkBox(self, layer)
+
+	def Load(self):
+		wndMgr.MarkBox_Load(self.hWnd)
+
+	def SetScale(self, scale):
+		wndMgr.MarkBox_SetScale(self.hWnd, scale)
+
+	def SetIndex(self, guildID):
+		MarkID = guild.GuildIDToMarkID(guildID)
+		wndMgr.MarkBox_SetImageFilename(self.hWnd, guild.GetMarkImageFilenameByMarkID(MarkID))
+		wndMgr.MarkBox_SetIndex(self.hWnd, guild.GetMarkIndexByMarkID(MarkID))
+
+	def SetAlpha(self, alpha):
+		wndMgr.MarkBox_SetDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
+
+class ImageBox(Window):
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		self.eventDict = {}
+		self.eventFunc = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
+		self.eventArgs = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
+
+	def __del__(self):
+		Window.__del__(self)
+		self.eventFunc = None
+		self.eventArgs = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterImageBox(self, layer)
+
+	def LoadImage(self, imageName):
+		self.name=imageName
+		wndMgr.LoadImage(self.hWnd, imageName)
+
+		if len(self.eventDict)!=0:
+			print("LOAD IMAGE", self, self.eventDict)
+
+	def SetAlpha(self, alpha):
+		wndMgr.SetDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
+
+	if app.ENABLE_FISHING_GAME:
+		def SetDiffuseColor(self, r, g, b, alpha = 1.0):
+			wndMgr.SetDiffuseColor(self.hWnd, r, g, b, alpha)
+
+	def GetWidth(self):
+		return wndMgr.GetWidth(self.hWnd)
+
+	def GetHeight(self):
+		return wndMgr.GetHeight(self.hWnd)
+
+	def OnMouseOverIn(self):
+		try:
+			self.eventDict["MOUSE_OVER_IN"]()
+		except KeyError:
+			pass
+
+	def OnMouseOverOut(self):
+		try:
+			self.eventDict["MOUSE_OVER_OUT"]()
+		except KeyError:
+			pass
+
+	def SAFE_SetStringEvent(self, event, func):
+		self.eventDict[event]=__mem_func__(func)
+
+	def SetEvent(self, func, *args):
+		result = self.eventFunc.has_key(args[0])
+		if result:
+			self.eventFunc[args[0]] = func
+			self.eventArgs[args[0]] = args
+		else:
+			print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
+
+	def OnMouseLeftButtonUp(self):
+		if self.eventFunc["mouse_click"]:
+			apply(self.eventFunc["mouse_click"], self.eventArgs["mouse_click"])
+
+	def OnMouseOverIn(self):
+		if self.eventFunc["mouse_over_in"]:
+			apply(self.eventFunc["mouse_over_in"], self.eventArgs["mouse_over_in"])
+		else:
+			try:
+				self.eventDict["MOUSE_OVER_IN"]()
+			except KeyError:
+				pass
+
+	def OnMouseOverOut(self):
+		if self.eventFunc["mouse_over_out"]:
+			apply(self.eventFunc["mouse_over_out"], self.eventArgs["mouse_over_out"])
+		else:
+			try:
+				self.eventDict["MOUSE_OVER_OUT"]()
+			except KeyError:
+				pass
+
+	#if app.ENABLE_GROWTH_PET_SYSTEM
+	def LeftRightReverse(self):
+		wndMgr.LeftRightReverseImageBox(self.hWnd)
+
+	#if app.ENABLE_12ZI:
+	def SetCoolTime(self, time):
+		wndMgr.SetCoolTimeImageBox(self.hWnd, time)
+
+	def SetStartCoolTime(self, time):
+		wndMgr.SetStartCoolTimeImageBox(self.hWnd, time)
+
+	def SetScale(self, xScale, yScale):
+		wndMgr.SetScale(self.hWnd, xScale, yScale)
+
+class ImageBox2(Window):
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		self.eventDict={}
+		self.eventFunc = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
+		self.eventArgs = {"mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None}
+
+	def __del__(self):
+		Window.__del__(self)
+		self.eventFunc = None
+		self.eventArgs = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterImageBox(self, layer)
+
+	def LoadImage(self, imageName):
+		self.name=imageName
+		wndMgr.LoadImage(self.hWnd, imageName)
+
+		if len(self.eventDict)!=0:
+			print("LOAD IMAGE", self, self.eventDict)
+
+	def SetAlpha(self, alpha):
+		wndMgr.SetDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
+
+	def GetWidth(self):
+		return wndMgr.GetWidth(self.hWnd)
+
+	def GetHeight(self):
+		return wndMgr.GetHeight(self.hWnd)
+
+	def OnMouseOverIn(self):
+		try:
+			self.eventDict["MOUSE_OVER_IN"]()
+		except KeyError:
+			pass
+
+	def OnMouseOverOut(self):
+		try:
+			self.eventDict["MOUSE_OVER_OUT"]()
+		except KeyError:
+			pass
+
+	def SAFE_SetStringEvent(self, event, func, *args):
+		self.eventDict[event]=__mem_func__(func)
+
+	def SetEvent(self, func, *args) :
+		result = self.eventFunc.has_key(args[0])
+		if result :
+			self.eventFunc[args[0]] = func
+			self.eventArgs[args[0]] = args
+		else :
+			print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
+
+	def OnMouseLeftButtonUp(self) :
+		if self.eventFunc["mouse_click"] :
+			apply(self.eventFunc["mouse_click"], self.eventArgs["mouse_click"])
+
+	def OnMouseOverIn(self) :
+		if self.eventFunc["mouse_over_in"] :
+			apply(self.eventFunc["mouse_over_in"], self.eventArgs["mouse_over_in"])
+		else:
+			try:
+				self.eventDict["MOUSE_OVER_IN"]()
+			except KeyError:
+				pass
+
+	def OnMouseOverOut(self) :
+		if self.eventFunc["mouse_over_out"] :
+			apply(self.eventFunc["mouse_over_out"], self.eventArgs["mouse_over_out"])
+		else :
+			try:
+				self.eventDict["MOUSE_OVER_OUT"]()
+			except KeyError:
+				pass
+
+class ExpandedImageBox(ImageBox):
+	def __init__(self, layer = "UI"):
+		ImageBox.__init__(self, layer)
+
+	def __del__(self):
+		ImageBox.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterExpandedImageBox(self, layer)
+
+	def SetScale(self, xScale, yScale):
+		wndMgr.SetScale(self.hWnd, xScale, yScale)
+
+	def SetOrigin(self, x, y):
+		wndMgr.SetOrigin(self.hWnd, x, y)
+
+	def SetRotation(self, rotation):
+		wndMgr.SetRotation(self.hWnd, rotation)
+
+	def SetRenderingMode(self, mode):
+		wndMgr.SetRenderingMode(self.hWnd, mode)
+
+	# [0.0, 1.0]  Å­ Û¼Æ® ×¸ Ê´Â´.
+	def SetRenderingRect(self, left, top, right, bottom):
+		wndMgr.SetRenderingRect(self.hWnd, left, top, right, bottom)
+
+	def SetClipRect(self, left, top, right, bottom, isVertical = False):
+		wndMgr.SetClipRect(self.hWnd, left, top, right, bottom, isVertical)
+
+	def SetPercentage(self, curValue, maxValue):
+		if maxValue:
+			self.SetRenderingRect(0.0, 0.0, -1.0 + float(curValue) / float(maxValue), 0.0)
+		else:
+			self.SetRenderingRect(0.0, 0.0, 0.0, 0.0)
+
+	def SetPercentageEx(self, minValue, curValue, maxValue):
+		if minValue and maxValue:
+			self.SetRenderingRect(0.0, 0.0, -1.0 + (float(curValue) - float(minValue)) / (float(maxValue) - float(minValue)), 0.0)
+		else:
+			self.SetRenderingRect(0.0, 0.0, 0.0, 0.0)
+
+	def GetWidth(self):
+		return wndMgr.GetWindowWidth(self.hWnd)
+
+	def GetHeight(self):
+		return wndMgr.GetWindowHeight(self.hWnd)
+
+class AniImageBox(Window):
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+		self.end_frame_event = None
+		if app.ENABLE_MINI_GAME_CATCH_KING:
+			self.end_frame_args = None
+		self.key_frame_event = None
+
+		if app.ENABLE_MINI_GAME_YUTNORI:
+			self.eventFunc = { "mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None }
+			self.eventArgs = { "mouse_click" : None, "mouse_over_in" : None, "mouse_over_out" : None }
+
+	def __del__(self):
+		Window.__del__(self)
+		self.end_frame_event = None
+		if app.ENABLE_MINI_GAME_CATCH_KING:
+			self.end_frame_args = None
+		self.key_frame_event = None
+
+		if app.ENABLE_MINI_GAME_YUTNORI:
+			self.eventFunc = None
+			self.eventArgs = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterAniImageBox(self, layer)
+
+	def SetDelay(self, delay):
+		wndMgr.SetDelay(self.hWnd, delay)
+
+	if app.ENABLE_FISHING_GAME:
+		def SetRotation(self, rotation):
+			wndMgr.SetRotation(self.hWnd, rotation)
+
+	def AppendImage(self, filename):
+		wndMgr.AppendImage(self.hWnd, filename)
+
+	def SetPercentage(self, curValue, maxValue):
+		wndMgr.SetRenderingRect(self.hWnd, 0.0, 0.0, -1.0 + float(curValue) / float(maxValue), 0.0)
+
+	if app.ENABLE_MINI_GAME_CATCH_KING:
+		def OnEndFrame(self):
+			if self.end_frame_event:
+				apply(self.end_frame_event, self.end_frame_args)
+	else:
+		def OnEndFrame(self):
+			if self.end_frame_event:
+				self.end_frame_event()
+
+	if app.ENABLE_GROWTH_PET_SYSTEM:
+		def AppendImageScale(self, filename, scale_x, scale_y):
+			wndMgr.AppendImageScale(self.hWnd, filename, scale_x, scale_y)
+
+	#if app.ENABLE_GROWTH_PET_SYSTEM:
+	def SetPercentageWithScale(self, curValue, maxValue):
+		wndMgr.SetRenderingRectWithScale(self.hWnd, 0.0, 0.0, -1.0 + float(curValue) / float(maxValue), 0.0)
+
+	def SetScale(self, xScale, yScale):
+		wndMgr.SetAniImgScale(self.hWnd, xScale, yScale)
+
+	if app.ENABLE_MINI_GAME_CATCH_KING:
+		def SetEndFrameEvent(self, event, *args):
+			self.end_frame_event = event
+			self.end_frame_args = args
+	else:
+		def SetEndFrameEvent(self, event):
+			self.end_frame_event = event
+
+	def ResetFrame(self):
+		wndMgr.ResetFrame(self.hWnd)
+
+	def OnKeyFrame(self, cur_frame):
+		if self.key_frame_event:
+			self.key_frame_event(cur_frame)
+
+	def SetKeyFrameEvent(self, event):
+		self.key_frame_event = event
+
+	if app.ENABLE_MINI_GAME_YUTNORI:
+		def SetEvent(self, func, *args):
+			result = self.eventFunc.has_key(args[0])
+			if result:
+				self.eventFunc[args[0]] = func
+				self.eventArgs[args[0]] = args
+			else:
+				print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
+
+		def OnMouseLeftButtonUp(self):
+			if self.eventFunc["mouse_click"]:
+				apply(self.eventFunc["mouse_click"], self.eventArgs["mouse_click"])
+
+		def OnMouseOverIn(self):
+			if self.eventFunc["mouse_over_in"]:
+				apply(self.eventFunc["mouse_over_in"], self.eventArgs["mouse_over_in"])
+
+		def OnMouseOverOut(self):
+			if self.eventFunc["mouse_over_out"]:
+				apply(self.eventFunc["mouse_over_out"], self.eventArgs["mouse_over_out"])
+
+class MoveImageBox(ImageBox):
+	def __init__(self, layer = "UI"):
+		ImageBox.__init__(self, layer)
+		self.end_move_event = None
+
+	def __del__(self):
+		ImageBox.__del__(self)
+		self.end_move_event = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterMoveImageBox(self, layer)
+
+	def MoveStart(self):
+		wndMgr.MoveStart(self.hWnd)
+	def MoveStop(self):
+		wndMgr.MoveStop(self.hWnd)
+	def GetMove(self):
+		return wndMgr.GetMove(self.hWnd)
+
+	def SetMovePosition(self, dst_x, dst_y):
+		wndMgr.SetMovePosition(self.hWnd, dst_x, dst_y)
+
+	def SetMoveSpeed(self, speed):
+		wndMgr.SetMoveSpeed(self.hWnd, speed)
+
+	def OnEndMove(self):
+		if self.end_move_event:
+			self.end_move_event()
+
+	def SetEndMoveEvent(self, event):
+		self.end_move_event = event
+
+if app.ENABLE_MINI_GAME_YUTNORI:
+	class MoveScaleImageBox(MoveImageBox):
+		def __init__(self, layer = "UI"):
+			MoveImageBox.__init__(self, layer)
+
+		def __del__(self):
+			MoveImageBox.__del__(self)
+
+		def RegisterWindow(self, layer):
+			self.hWnd = wndMgr.RegisterMoveScaleImageBox(self, layer)
+
+		def SetMaxScale(self, scale):
+			wndMgr.SetMaxScale(self.hWnd, scale)
+
+		def SetMaxScaleRate(self, pivot):
+			wndMgr.SetMaxScaleRate(self.hWnd, pivot)
+
+		def SetScalePivotCenter(self, flag):
+			wndMgr.SetScalePivotCenter(self.hWnd, flag)
+
+class Button(Window):
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		self.eventFunc = None
+		self.eventArgs = None
+
+		self.ButtonText = None
+		self.ToolTipText = None
+
+		self.TextChild = []
+
+		if app.ENABLE_DETAILS_UI or app.ENABLE_MINI_GAME_YUTNORI:
+			self.overFunc = None
+			self.overArgs = None
+			self.overOutFunc = None
+			self.overOutArgs = None
+
+		self.showtooltipevent = None
+		self.showtooltiparg = None
+		self.hidetooltipevent = None
+		self.hidetooltiparg = None
+
+	def SetFontName(self, fontName):
+		wndMgr.SetFontName(self.hWnd, fontName)
+
+	def __del__(self):
+		Window.__del__(self)
+
+		self.eventFunc = None
+		self.eventArgs = None
+
+		if app.ENABLE_DETAILS_UI or app.ENABLE_MINI_GAME_YUTNORI:
+			self.overFunc = None
+			self.overArgs = None
+			self.overOutFunc = None
+			self.overOutArgs = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterButton(self, layer)
+
+	def SetUpVisual(self, filename):
+		wndMgr.SetUpVisual(self.hWnd, filename)
+
+	def SetOverVisual(self, filename):
+		wndMgr.SetOverVisual(self.hWnd, filename)
+
+	def SetDownVisual(self, filename):
+		wndMgr.SetDownVisual(self.hWnd, filename)
+
+	def SetDisableVisual(self, filename):
+		wndMgr.SetDisableVisual(self.hWnd, filename)
+
+	def GetUpVisualFileName(self):
+		return wndMgr.GetUpVisualFileName(self.hWnd)
+
+	def GetOverVisualFileName(self):
+		return wndMgr.GetOverVisualFileName(self.hWnd)
+
+	def GetDownVisualFileName(self):
+		return wndMgr.GetDownVisualFileName(self.hWnd)
+
+	def Flash(self):
+		wndMgr.Flash(self.hWnd)
+
+	def EnableFlash(self):
+		wndMgr.EnableFlash(self.hWnd)
+
+	def DisableFlash(self):
+		wndMgr.DisableFlash(self.hWnd)
+
+	def Enable(self):
+		wndMgr.Enable(self.hWnd)
+
+	def Disable(self):
+		wndMgr.Disable(self.hWnd)
+
+	def Down(self):
+		wndMgr.Down(self.hWnd)
+
+	def SetUp(self):
+		wndMgr.SetUp(self.hWnd)
+
+	def SAFE_SetEvent(self, func, *args):
+		self.eventFunc = __mem_func__(func)
+		self.eventArgs = args
+
+	def SetEvent(self, func, *args):
+		self.eventFunc = func
+		self.eventArgs = args
+
+	def Over(self):
+		wndMgr.Over(self.hWnd)
+
+	def LeftRightReverse(self):
+		wndMgr.LeftRightReverse(self.hWnd)
+
+	def SetTextColor(self, color):
+		if not self.ButtonText:
+			return
+		self.ButtonText.SetPackedFontColor(color)
+
+	def IsLockSlot(self, slot_number):
+		return wndMgr.IsLockSlot(self.hWnd, slot_number)
+
+	def SetText(self, text, height = 4):
+		if not self.ButtonText:
+			textLine = TextLine()
+			textLine.SetParent(self)
+			textLine.SetPosition(self.GetWidth()/2, self.GetHeight()/2)
+			textLine.SetVerticalAlignCenter()
+			textLine.SetHorizontalAlignCenter()
+			textLine.Show()
+			self.ButtonText = textLine
+
+		self.ButtonText.SetText(text)
+
+	if app.ENABLE_MINI_GAME_YUTNORI:
+		def SetAutoSizeText(self, text):
+			if not self.ButtonText:
+				textLine = TextLine()
+				textLine.SetParent(self)
+				textLine.SetVerticalAlignCenter()
+				textLine.SetHorizontalAlignCenter()
+				textLine.Show()
+				self.ButtonText = textLine
+
+			self.ButtonText.SetText(text)
+
+			imageWidth = self.GetButtonImageWidth()
+			imageHeight = self.GetButtonImageHeight()
+
+			if imageWidth == 0 or imageHeight == 0:
+				return
+
+			(textWidth, textHeight) = self.ButtonText.GetTextSize()
+			textWidth += imageWidth / 5
+			textHeight += imageHeight / 10
+
+			curWidth = self.GetWidth()
+			curHeight = self.GetHeight()
+
+			if curWidth < textWidth:
+				curWidth = textWidth
+
+			if curHeight < textHeight:
+				curHeight = textHeight
+
+			self.SetSize(curWidth, curHeight)
+			self.SetButtonScale(curWidth * 1.0 / imageWidth, curHeight * 1.0 / imageHeight)
+			self.ButtonText.SetPosition(self.GetWidth() / 2, self.GetHeight() / 2)
+
+	def AppendTextLineAllClear(self):
+		self.TextChild = []
+
+	def SetAppendTextChangeText(self, idx, text):
+		if not len(self.TextChild):
+			return
+
+		self.TextChild[idx].SetText(text)
+
+	def SetAppendTextColor(self, idx, color):
+		if not len(self.TextChild):
+			return
+
+		self.TextChild[idx].SetPackedFontColor(color)
+
+	def AppendTextLine(self, text
+		, font_size = localeInfo.UI_DEF_FONT
+		, font_color = grp.GenerateColor(0.7607, 0.7607, 0.7607, 1.0)
+		, text_sort = "center"
+		, pos_x = None
+		, pos_y = None):
+		textLine = TextLine()
+		textLine.SetParent(self)
+		textLine.SetFontName(font_size)
+		textLine.SetPackedFontColor(font_color)
+		textLine.SetText(text)
+		textLine.Show()
+
+		if not pos_x and not pos_y:
+			textLine.SetPosition(self.GetWidth() / 2, self.GetHeight() / 2)
+		else:
+			textLine.SetPosition(pos_x, pos_y)
+
+		textLine.SetVerticalAlignCenter()
+		if "center" == text_sort:
+			textLine.SetHorizontalAlignCenter()
+		elif "right" == text_sort:
+			textLine.SetHorizontalAlignRight()
+		elif "left" == text_sort:
+			textLine.SetHorizontalAlignLeft()
+
+		self.TextChild.append(textLine)
+
+	def SetFormToolTipText(self, type, text, x, y):
+		if not self.ToolTipText:
+			toolTip = createToolTipWindowDict[type]()
+			toolTip.SetParent(self)
+			toolTip.SetSize(0, 0)
+			toolTip.SetHorizontalAlignCenter()
+			if app.WJ_MULTI_TEXTLINE:
+				toolTip.DisableEnterToken()
+			toolTip.SetOutline()
+			toolTip.Hide()
+			toolTip.SetPosition(x + self.GetWidth() / 2, y)
+			self.ToolTipText = toolTip
+
+		self.ToolTipText.SetText(text)
+
+	def SetToolTipWindow(self, toolTip):
+		self.ToolTipText = toolTip
+		self.ToolTipText.SetParentProxy(self)
+
+	def SetToolTipText(self, text, x = 0, y = -19):
+		self.SetFormToolTipText("TEXT", text, x, y)
+
+	def CallEvent(self):
+		snd.PlaySound("sound/ui/click.wav")
+
+		if self.eventFunc:
+			apply(self.eventFunc, self.eventArgs)
+
+	def ShowToolTip(self):
+		if self.ToolTipText:
+			self.ToolTipText.Show()
+
+		if self.showtooltipevent:
+			apply(self.showtooltipevent, self.showtooltiparg)
+
+	def HideToolTip(self):
+		if self.ToolTipText:
+			self.ToolTipText.Hide()
+
+		if self.hidetooltipevent:
+			apply(self.hidetooltipevent, self.hidetooltiparg)
+
+	def SetShowToolTipEvent(self, func, *args):
+		self.showtooltipevent = func
+		self.showtooltiparg = args
+
+	def SetHideToolTipEvent(self, func, *args):
+		self.hidetooltipevent = func
+		self.hidetooltiparg = args
+
+	def IsDown(self):
+		return wndMgr.IsDown(self.hWnd)
+
+	def SetAlpha(self, alpha):
+		wndMgr.SetButtonDiffuseColor(self.hWnd, 1.0, 1.0, 1.0, alpha)
+
+	def GetText(self):
+		if self.ButtonText:
+			return self.ButtonText.GetText()
+		else:
+			return ""
+
+	def IsDisable(self):
+		return wndMgr.IsDisable(self.hWnd)
+
+	def SetScale(self, scale_x, scale_y):
+		wndMgr.SetButtonScale(self.hWnd, scale_x, scale_y)
+
+	def SetDiffuseColor(self, r, g, b, a):
+		wndMgr.SetButtonDiffuseColor(self.hWnd, r, g, b, a)
+
+	#if app.ENABLE_MONSTER_CARD:
+	def SetAlwaysToolTip(self, bFlag):
+		wndMgr.SetAlwaysToolTip(self.hWnd, bFlag)
+
+	if app.ENABLE_DETAILS_UI or app.ENABLE_MINI_GAME_YUTNORI:
+		def OnMouseOverIn(self):
+			if self.overFunc:
+				apply(self.overFunc, self.overArgs)
+
+		def OnMouseOverOut(self):
+			if self.overOutFunc:
+				apply(self.overOutFunc, self.overOutArgs)
+
+		def SetOverEvent(self, func, *args):
+			self.overFunc = func
+			self.overArgs = args
+
+		def SetOverOutEvent(self, func, *args):
+			self.overOutFunc = func
+			self.overOutArgs = args
+
+	if app.ENABLE_MINI_GAME_YUTNORI or app.ENABLE_LUCKY_BOX:
+		def SetButtonScale(self, xScale, yScale):
+			wndMgr.SetButtonScale(self.hWnd, xScale, yScale)
+
+		def GetButtonImageWidth(self):
+			return wndMgr.GetButtonImageWidth(self.hWnd)
+
+		def GetButtonImageHeight(self):
+			return wndMgr.GetButtonImageHeight(self.hWnd)
+
+	def SetTextAddPos(self, text, x_add = 0, y_add = 0, height = 4):
+		if not self.ButtonText:
+			textLine = TextLine()
+			textLine.SetParent(self)
+			textLine.SetPosition(self.GetWidth() / 2 + x_add, self.GetHeight() / 2 + y_add)
+			textLine.SetVerticalAlignCenter()
+			textLine.SetHorizontalAlignCenter()
+			textLine.Show()
+			self.ButtonText = textLine
+		self.ButtonText.SetText(text)
+
+class CheckBoxRefine(Window):
+	def __init__(self):
+		Window.__init__(self)
+		
+		self.backgroundImage = None
+		self.checkImage = None
+
+		self.eventFunc = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
+		self.eventArgs = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
+	
+		self.CreateElements()
+		
+	def __del__(self):
+		Window.__del__(self)
+		
+		self.backgroundImage = None
+		self.checkImage = None
+		
+		self.eventFunc = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
+		self.eventArgs = { "ON_CHECK" : None, "ON_UNCKECK" : None, }
+		
+	def CreateElements(self):
+		self.backgroundImage = ImageBox()
+		self.backgroundImage.SetParent(self)
+		self.backgroundImage.AddFlag("not_pick")
+		self.backgroundImage.SetPosition(0, -2)
+		self.backgroundImage.LoadImage("d:/ymir work/ui/game/checkbox/checkbox.tga")
+		self.backgroundImage.Show()
+		
+		self.checkImage = ImageBox()
+		self.checkImage.SetParent(self)
+		self.checkImage.AddFlag("not_pick")
+		self.checkImage.SetPosition(0, -2)
+		self.checkImage.LoadImage("d:/ymir work/ui/game/checkbox/checked.tga")
+		self.checkImage.Hide()
+		
+		self.textInfo = TextLine()
+		self.textInfo.SetParent(self)
+		self.textInfo.SetPosition(20, -2)
+		self.textInfo.Show()
+		
+		self.SetSize(self.backgroundImage.GetWidth() + self.textInfo.GetTextSize()[0], self.backgroundImage.GetHeight() + self.textInfo.GetTextSize()[1])
+		
+	def SetTextInfo(self, info):
+		if self.textInfo:
+			self.textInfo.SetText(info)
+			
+		self.SetSize(self.backgroundImage.GetWidth() + self.textInfo.GetTextSize()[0], self.backgroundImage.GetHeight() + self.textInfo.GetTextSize()[1])
+		
+	def SetCheckStatus(self, flag):
+		if flag:
+			self.checkImage.Show()
+		else:
+			self.checkImage.Hide()
+	
+	def GetCheckStatus(self):
+		if self.checkImage:
+			return self.checkImage.IsShow()
+			
+		return False
+		
+	def SetEvent(self, func, *args) :
+		result = self.eventFunc.has_key(args[0])		
+		if result :
+			self.eventFunc[args[0]] = func
+			self.eventArgs[args[0]] = args
+		else :
+			print "[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0]
+		
+	def OnMouseLeftButtonUp(self):
+		if self.checkImage:
+			if self.checkImage.IsShow():
+				self.checkImage.Hide()
+
+				if self.eventFunc["ON_UNCKECK"]:
+					apply(self.eventFunc["ON_UNCKECK"], self.eventArgs["ON_UNCKECK"])
+			else:
+				self.checkImage.Show()
+
+				if self.eventFunc["ON_CHECK"]:
+					apply(self.eventFunc["ON_CHECK"], self.eventArgs["ON_CHECK"])
+
+class RadioButton(Button):
+	def __init__(self):
+		Button.__init__(self)
+
+	def __del__(self):
+		Button.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterRadioButton(self, layer)
+
+class RadioButtonGroup:
+	def __init__(self):
+		self.buttonGroup = []
+		self.selectedBtnIdx = -1
+
+	def __del__(self):
+		self.buttonGroup = []
+		self.selectedBtnIdx = -1
+
+	def Show(self):
+		for (button, selectEvent, unselectEvent) in self.buttonGroup:
+			button.Show()
+
+	def Hide(self):
+		for (button, selectEvent, unselectEvent) in self.buttonGroup:
+			button.Hide()
+
+	def SetText(self, idx, text):
+		if idx >= len(self.buttonGroup):
+			return
+		(button, selectEvent, unselectEvent) = self.buttonGroup[idx]
+		button.SetText(text)
+
+	def OnClick(self, btnIdx):
+		if btnIdx == self.selectedBtnIdx:
+			return
+		(button, selectEvent, unselectEvent) = self.buttonGroup[self.selectedBtnIdx]
+		if unselectEvent:
+			unselectEvent(self.selectedBtnIdx)
+		button.SetUp()
+
+		self.selectedBtnIdx = btnIdx
+		(button, selectEvent, unselectEvent) = self.buttonGroup[btnIdx]
+		if selectEvent:
+			selectEvent(btnIdx)
+
+		button.Down()
+
+	def AddButton(self, button, selectEvent, unselectEvent):
+		i = len(self.buttonGroup)
+		button.SetEvent(__mem_func__(self.OnClick),i)
+		self.buttonGroup.append([button, selectEvent, unselectEvent])
+		button.SetUp()
+
+	def Create(rawButtonGroup):
+		radioGroup = RadioButtonGroup()
+		for (button, selectEvent, unselectEvent) in rawButtonGroup:
+			radioGroup.AddButton(button, selectEvent, unselectEvent)
+
+		radioGroup.OnClick(0)
+
+		return radioGroup
+
+	Create=staticmethod(Create)
+
+class ToggleButton(Button):
+	def __init__(self):
+		Button.__init__(self)
+
+		self.eventUp = None
+		self.eventDown = None
+
+		self.eventUpArgs = None
+		self.eventDownArgs = None
+
+	def __del__(self):
+		Button.__del__(self)
+
+		self.eventUp = None
+		self.eventDown = None
+
+	def SetToggleUpEvent(self, event, *args):
+		self.eventUp = event
+		self.eventUpArgs = args
+
+	def SetToggleDownEvent(self, event, *args):
+		self.eventDown = event
+		self.eventDownArgs = args
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterToggleButton(self, layer)
+
+	def OnToggleUp(self):
+		if self.eventUp:
+			if self.eventUpArgs:
+				apply(self.eventUp, self.eventUpArgs)
+			else:
+				self.eventUp()
+
+	def OnToggleDown(self):
+		if self.eventDown:
+			if self.eventDownArgs:
+				apply(self.eventDown, self.eventDownArgs)
+			else:
+				self.eventDown()
+
+class DragButton(Button):
+	def __init__(self):
+		Button.__init__(self)
+		self.AddFlag("movable")
+
+		self.callbackEnable = True
+		self.eventMove = lambda: None
+
+	def __del__(self):
+		Button.__del__(self)
+
+		self.eventMove = lambda: None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterDragButton(self, layer)
+
+	def SetMoveEvent(self, event):
+		self.eventMove = event
+
+	def SetRestrictMovementArea(self, x, y, width, height):
+		wndMgr.SetRestrictMovementArea(self.hWnd, x, y, width, height)
+
+	def TurnOnCallBack(self):
+		self.callbackEnable = True
+
+	def TurnOffCallBack(self):
+		self.callbackEnable = False
+
+	def OnMove(self):
+		if self.callbackEnable:
+			self.eventMove()
+
+class NumberLine(Window):
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterNumberLine(self, layer)
+
+	def SetHorizontalAlignCenter(self):
+		wndMgr.SetNumberHorizontalAlignCenter(self.hWnd)
+
+	def SetHorizontalAlignRight(self):
+		wndMgr.SetNumberHorizontalAlignRight(self.hWnd)
+
+	def SetPath(self, path):
+		wndMgr.SetPath(self.hWnd, path)
+
+	if app.ENABLE_CHEQUE_SYSTEM:
+		def SetNumber(self, number, r = 1.0, g = 1.0, b = 1.0):
+			wndMgr.SetNumber(self.hWnd, number, r, g, b)
+	else:
+		def SetNumber(self, number):
+			wndMgr.SetNumber(self.hWnd, number)
+
+###################################################################################################
+## PythonScript Element
+###################################################################################################
+
+class Box(Window):
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterBox(self, layer)
+
+	def SetColor(self, color):
+		wndMgr.SetColor(self.hWnd, color)
+
+class Bar(Window):
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterBar(self, layer)
+
+	def SetColor(self, color):
+		wndMgr.SetColor(self.hWnd, color)
+
+class Line(Window):
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterLine(self, layer)
+
+	def SetColor(self, color):
+		wndMgr.SetColor(self.hWnd, color)
+
+class SlotBar(Window):
+
+	def __init__(self):
+		Window.__init__(self)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterBar3D(self, layer)
+
+## Same with SlotBar
+class Bar3D(Window):
+	def __init__(self):
+		Window.__init__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterBar3D(self, layer)
+
+	def SetColor(self, left, right, center):
+		wndMgr.SetColor(self.hWnd, left, right, center)
+
+class SlotWindow(Window):
+	def __init__(self):
+		Window.__init__(self)
+
+		self.StartIndex = 0
+
+		self.eventSelectEmptySlot = None
+		self.eventSelectItemSlot = None
+		self.eventUnselectEmptySlot = None
+		self.eventUnselectItemSlot = None
+		self.eventUseSlot = None
+		self.eventOverInItem = None
+		self.eventOverOutItem = None
+		self.eventPressedSlotButton = None
+
+		if app.ENABLE_EXTEND_INVEN_SYSTEM:
+			self.eventSelectEmptySlotWindow = None
+			self.eventSelectItemSlotWindow = None
+			self.eventUseSlotWindow = None
+			self.eventOverInItemSlotWindow = None
+			self.eventUnselectItemSlotWindow = None
+
+		self.eventSelectItemSlotArgs = None
+		self.eventOverInItemArgs = None
+
+	def __del__(self):
+		Window.__del__(self)
+
+		self.eventSelectEmptySlot = None
+		self.eventSelectItemSlot = None
+		self.eventUnselectEmptySlot = None
+		self.eventUnselectItemSlot = None
+		self.eventUseSlot = None
+		self.eventOverInItem = None
+		self.eventOverOutItem = None
+		self.eventPressedSlotButton = None
+
+		if app.ENABLE_EXTEND_INVEN_SYSTEM:
+			self.eventSelectEmptySlotWindow = None
+			self.eventSelectItemSlotWindow = None
+			self.eventUseSlotWindow = None
+			self.eventOverInItemSlotWindow = None
+			self.eventUnselectItemSlotWindow = None
+
+		self.eventSelectItemSlotArgs = None
+		self.eventOverInItemArgs = None
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterSlotWindow(self, layer)
+
+	def SetSlotStyle(self, style):
+		wndMgr.SetSlotStyle(self.hWnd, style)
+
+	def HasSlot(self, slotIndex):
+		return wndMgr.HasSlot(self.hWnd, slotIndex)
+
+	if app.ENABLE_GROWTH_PET_SYSTEM:
+		def SetSlotScale(self, xScale, yScale):
+			wndMgr.SetSlotScale(self.hWnd, xScale, yScale)
+
+	def HideSlotButton(self, slot_number):
+		wndMgr.HideSlotButton(self.hWnd, slot_number)
+
+	if app.ENABLE_SLOT_SCALE:
+		def SetSlotScale(self, xScale, yScale):
+			wndMgr.SetSlotScale(self.hWnd, xScale, yScale)
+
+		def SetSlotImage(self, slot_index, filename):
+			wndMgr.SetSlotImage(self.hWnd, slot_index, filename)
+
+	def SetSlotBaseImage(self, imageFileName, r, g, b, a):
+		wndMgr.SetSlotBaseImage(self.hWnd, imageFileName, r, g, b, a)
+
+	if app.ENABLE_GROWTH_PET_SYSTEM:
+		def SetSlotBaseImageScale(self, imageFileName, r, g, b, a, sx, sy):
+			wndMgr.SetSlotBaseImageScale(self.hWnd, imageFileName, r, g, b, a, sx, sy)
+
+	def SetBaseImageScale(self, xScale, yScale):
+		wndMgr.SetBaseImageScale(self.hWnd, xScale, yScale)
+
+	def SetCoverButton(self,\
+						slotIndex,\
+						upName="d:/ymir work/ui/public/slot_cover_button_01.sub",\
+						overName="d:/ymir work/ui/public/slot_cover_button_02.sub",\
+						downName="d:/ymir work/ui/public/slot_cover_button_03.sub",\
+						disableName="d:/ymir work/ui/public/slot_cover_button_04.sub",\
+						LeftButtonEnable = False,\
+						RightButtonEnable = True):
+		wndMgr.SetCoverButton(self.hWnd, slotIndex, upName, overName, downName, disableName, LeftButtonEnable, RightButtonEnable)
+
+	def SetCorverButtonScale(self, slotIndex, xScale, yScale):
+		wndMgr.SetCorverButtonScale(self.hWnd, slotIndex, xScale, yScale)
+
+	def EnableCoverButton(self, slotIndex):
+		wndMgr.EnableCoverButton(self.hWnd, slotIndex)
+
+	def DisableCoverButton(self, slotIndex):
+		wndMgr.DisableCoverButton(self.hWnd, slotIndex)
+
+	def SetAlwaysRenderCoverButton(self, slotIndex, bAlwaysRender = True):
+		wndMgr.SetAlwaysRenderCoverButton(self.hWnd, slotIndex, bAlwaysRender)
+
+	def AppendSlotButton(self, upName, overName, downName):
+		wndMgr.AppendSlotButton(self.hWnd, upName, overName, downName)
+
+	def ShowSlotButton(self, slotNumber):
+		wndMgr.ShowSlotButton(self.hWnd, slotNumber)
+
+	def HideAllSlotButton(self):
+		wndMgr.HideAllSlotButton(self.hWnd)
+
+	def AppendRequirementSignImage(self, filename):
+		wndMgr.AppendRequirementSignImage(self.hWnd, filename)
+
+	def ShowRequirementSign(self, slotNumber):
+		wndMgr.ShowRequirementSign(self.hWnd, slotNumber)
+
+	def HideRequirementSign(self, slotNumber):
+		wndMgr.HideRequirementSign(self.hWnd, slotNumber)
+
+	def ActivateSlot(self, slotNumber):
+		wndMgr.ActivateSlot(self.hWnd, slotNumber)
+
+	def DeactivateSlot(self, slotNumber):
+		wndMgr.DeactivateSlot(self.hWnd, slotNumber)
+
+	if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+		def SetSlotDiffuseColor(self, slotindex, colortype):
+			wndMgr.SetSlotDiffuseColor(self.hWnd, slotindex, colortype)
+
+	def SetSlotHighlightedGreeen(self, slotNumber):
+		wndMgr.SetSlotHighlightedGreeen(self.hWnd, slotNumber)
+
+	def DisableSlotHighlightedGreen(self, slotNumber):
+		wndMgr.DisableSlotHighlightedGreen(self.hWnd, slotNumber)
+
+	def ShowSlotBaseImage(self, slotNumber):
+		wndMgr.ShowSlotBaseImage(self.hWnd, slotNumber)
+
+	def HideSlotBaseImage(self, slotNumber):
+		wndMgr.HideSlotBaseImage(self.hWnd, slotNumber)
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def SAFE_SetButtonEvent(self, button, state, event, window = None):
+			if "LEFT" == button:
+				if "EMPTY" == state:
+					self.eventSelectEmptySlot = __mem_func__(event)
+					self.eventSelectEmptySlotWindow = window
+				elif "EXIST" == state:
+					self.eventSelectItemSlot = __mem_func__(event)
+					self.eventSelectItemSlotWindow = window
+				elif "ALWAYS" == state:
+					self.eventSelectEmptySlot = __mem_func__(event)
+					self.eventSelectEmptySlotWindow = window
+					self.eventSelectItemSlot = __mem_func__(event)
+					self.eventSelectItemSlotWindow = window
+			elif "RIGHT" == button:
+				if "EMPTY" == state:
+					self.eventUnselectEmptySlot = __mem_func__(event)
+				elif "EXIST" == state:
+					self.eventUnselectItemSlot = __mem_func__(event)
+					self.eventUnselectItemSlotWindow = window
+				elif "ALWAYS" == state:
+					self.eventUnselectEmptySlot = __mem_func__(event)
+					self.eventUnselectItemSlot = __mem_func__(event)
+					self.eventUnselectItemSlotWindow = window
+	else:
+		def SAFE_SetButtonEvent(self, button, state, event):
+			if "LEFT" == button:
+				if "EMPTY" == state:
+					self.eventSelectEmptySlot = __mem_func__(event)
+				elif "EXIST" == state:
+					self.eventSelectItemSlot = __mem_func__(event)
+				elif "ALWAYS" == state:
+					self.eventSelectEmptySlot = __mem_func__(event)
+					self.eventSelectItemSlot = __mem_func__(event)
+			elif "RIGHT" == button:
+				if "EMPTY" == state:
+					self.eventUnselectEmptySlot = __mem_func__(event)
+				elif "EXIST" == state:
+					self.eventUnselectItemSlot = __mem_func__(event)
+				elif "ALWAYS" == state:
+					self.eventUnselectEmptySlot = __mem_func__(event)
+					self.eventUnselectItemSlot = __mem_func__(event)
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def SetSelectEmptySlotEvent(self, empty, window = None):
+			self.eventSelectEmptySlot = empty
+			self.eventSelectEmptySlotWindow = window
+	else:
+		def SetSelectEmptySlotEvent(self, empty):
+			self.eventSelectEmptySlot = empty
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def SetSelectItemSlotEvent(self, item, window = None, *args):
+			self.eventSelectItemSlot = item
+			self.eventSelectItemSlotWindow = window
+			self.eventSelectItemSlotArgs = args
+	else:
+		def SetSelectItemSlotEvent(self, item, *args):
+			self.eventSelectItemSlot = item
+			self.eventSelectItemSlotArgs = args
+
+	def SetUnselectEmptySlotEvent(self, empty):
+		self.eventUnselectEmptySlot = empty
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def SetUnselectItemSlotEvent(self, item, window = None):
+			self.eventUnselectItemSlot = item
+			self.eventUnselectItemSlotWindow = window
+	else:
+		def SetUnselectItemSlotEvent(self, item):
+			self.eventUnselectItemSlot = item
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def SetUseSlotEvent(self, use, window = None):
+			self.eventUseSlot = use
+			self.eventUseSlotWindow = window
+	else:
+		def SetUseSlotEvent(self, use):
+			self.eventUseSlot = use
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def SetOverInItemEvent(self, event, window = None, *args):
+			self.eventOverInItem = event
+			self.eventOverInItemArgs = args
+			self.eventOverInItemSlotWindow = window
+	else:
+		def SetOverInItemEvent(self, event, *args):
+			self.eventOverInItem = event
+			self.eventOverInItemArgs = args
+
+	def SetOverOutItemEvent(self, event):
+		self.eventOverOutItem = event
+
+	def SetPressedSlotButtonEvent(self, event):
+		self.eventPressedSlotButton = event
+
+	def GetSlotCount(self):
+		return wndMgr.GetSlotCount(self.hWnd)
+
+	def SetUseMode(self, flag):
+		"TrueÏ¶ ItemToItem   Ø´"
+		wndMgr.SetUseMode(self.hWnd, flag)
+
+	def SetUsableItem(self, flag):
+		"True  Å²  ItemToItem  Ï´"
+		wndMgr.SetUsableItem(self.hWnd, flag)
+
+	## Slot
+	def SetSlotCoolTime(self, slotIndex, coolTime, elapsedTime = 0.0):
+		wndMgr.SetSlotCoolTime(self.hWnd, slotIndex, coolTime, elapsedTime)
+
+	def SetSlotCoolTimeColor(self, slotIndex, r, g, b, a):
+		wndMgr.SetSlotCoolTimeColor(self.hWnd, slotIndex, r, g, b, a)
+
+	if app.ENABLE_SLOT_COOLTIME_REFRESH_FIX:
+		def StoreSlotCoolTime(self, key, slotIndex, coolTime, elapsedTime = 0.0):
+			wndMgr.StoreSlotCoolTime(self.hWnd, key, slotIndex, coolTime, elapsedTime)
+
+		def RestoreSlotCoolTime(self, key):
+			wndMgr.RestoreSlotCoolTime(self.hWnd, key)
+
+	#if app.ENABLE_GROWTH_PET_SYSTEM:
+	def SetSlotCoolTimeInverse(self, slotIndex, coolTime, elapsedTime = 0.0):
+		wndMgr.SetSlotCoolTimeInverse(self.hWnd, slotIndex, coolTime, elapsedTime)
+
+	if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_MAILBOX:
+		def SetCanMouseEventSlot(self, slotIndex):
+			wndMgr.SetCanMouseEventSlot(self.hWnd, slotIndex)
+
+		def SetCantMouseEventSlot(self, slotIndex):
+			wndMgr.SetCantMouseEventSlot(self.hWnd, slotIndex)
+
+		def SetUnusableSlotOnTopWnd(self, slotIndex):
+			wndMgr.SetUnusableSlotOnTopWnd(self.hWnd, slotIndex)
+
+		def SetUsableSlotOnTopWnd(self, slotIndex):
+			wndMgr.SetUsableSlotOnTopWnd(self.hWnd, slotIndex)
+
+	def IsActiveSlot(self, slot_index):
+		return wndMgr.IsActiveSlot(self.hWnd, slot_index)
+
+	def DisableSlot(self, slotIndex):
+		wndMgr.DisableSlot(self.hWnd, slotIndex)
+
+	def EnableSlot(self, slotIndex):
+		wndMgr.EnableSlot(self.hWnd, slotIndex)
+
+	def LockSlot(self, slotIndex):
+		wndMgr.LockSlot(self.hWnd, slotIndex)
+
+	def UnlockSlot(self, slotIndex):
+		wndMgr.UnlockSlot(self.hWnd, slotIndex)
+
+	def RefreshSlot(self):
+		wndMgr.RefreshSlot(self.hWnd)
+
+	def ClearSlot(self, slotNumber):
+		wndMgr.ClearSlot(self.hWnd, slotNumber)
+
+	def ClearAllSlot(self):
+		wndMgr.ClearAllSlot(self.hWnd)
+
+	def AppendSlot(self, index, x, y, width, height):
+		wndMgr.AppendSlot(self.hWnd, index, x, y, width, height)
+
+	def SetSlot(self, slotIndex, itemIndex, width, height, icon, diffuseColor = (1.0, 1.0, 1.0, 1.0)):
+		wndMgr.SetSlot(self.hWnd, slotIndex, itemIndex, width, height, icon, diffuseColor)
+
+	def SetSlotCount(self, slotNumber, count):
+		wndMgr.SetSlotCount(self.hWnd, slotNumber, count)
+
+	def SetRealSlotNumber(self, slotNumber, realSlotNumber):
+		wndMgr.SetSlotRealNumber(self.hWnd, slotNumber, realSlotNumber)
+
+	def SetSlotCountNew(self, slotNumber, grade, count):
+		wndMgr.SetSlotCountNew(self.hWnd, slotNumber, grade, count)
+
+	def SetItemSlot(self, renderingSlotNumber, ItemIndex, ItemCount = 0, diffuseColor = (1.0, 1.0, 1.0, 1.0)):
+		if 0 == ItemIndex or None == ItemIndex:
+			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
+			return
+
+		item.SelectItem(ItemIndex)
+		itemIcon = item.GetIconImage()
+
+		item.SelectItem(ItemIndex)
+		(width, height) = item.GetItemSize()
+
+		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, ItemIndex, width, height, itemIcon, diffuseColor)
+		wndMgr.SetSlotCount(self.hWnd, renderingSlotNumber, ItemCount)
+
+	def SetSkillSlot(self, renderingSlotNumber, skillIndex, skillLevel):
+		skillIcon = skill.GetIconImage(skillIndex)
+
+		if 0 == skillIcon:
+			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
+			return
+
+		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, skillIndex, 1, 1, skillIcon)
+		wndMgr.SetSlotCount(self.hWnd, renderingSlotNumber, skillLevel)
+
+	def SetSkillSlotNew(self, renderingSlotNumber, skillIndex, skillGrade, skillLevel):
+
+		skillIcon = skill.GetIconImageNew(skillIndex, skillGrade)
+
+		if 0 == skillIcon:
+			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
+			return
+
+		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, skillIndex, 1, 1, skillIcon)
+
+	def SetEmotionSlot(self, renderingSlotNumber, emotionIndex):
+		import player
+		icon = player.GetEmotionIconImage(emotionIndex)
+
+		if 0 == icon:
+			wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
+			return
+
+		wndMgr.SetSlot(self.hWnd, renderingSlotNumber, emotionIndex, 1, 1, icon)
+
+	## Event
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def OnSelectEmptySlot(self, slotNumber):
+			if self.eventSelectEmptySlot:
+				if self.eventSelectEmptySlotWindow:
+					self.eventSelectEmptySlot(slotNumber, self.eventSelectEmptySlotWindow)
+				else:
+					self.eventSelectEmptySlot(slotNumber)
+	else:
+		def OnSelectEmptySlot(self, slotNumber):
+			if self.eventSelectEmptySlot:
+				self.eventSelectEmptySlot(slotNumber)
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def OnSelectItemSlot(self, slotNumber):
+			if self.eventSelectItemSlot:
+				if self.eventSelectItemSlotWindow:
+					if self.eventSelectItemSlotArgs:
+						apply(self.eventSelectItemSlot, self.eventSelectItemSlotArgs)
+					else:
+						self.eventSelectItemSlot(slotNumber, self.eventSelectItemSlotWindow)
+				else:
+					if self.eventSelectItemSlotArgs:
+						apply(self.eventSelectItemSlot, self.eventSelectItemSlotArgs)
+					else:
+						self.eventSelectItemSlot(slotNumber)
+	else:
+		def OnSelectItemSlot(self, slotNumber):
+			if self.eventSelectItemSlot:
+				if self.eventSelectItemSlotArgs:
+					apply(self.eventSelectItemSlot, self.eventSelectItemSlotArgs)
+				else:
+					self.eventSelectItemSlot(slotNumber)
+
+	def OnUnselectEmptySlot(self, slotNumber):
+		if self.eventUnselectEmptySlot:
+			self.eventUnselectEmptySlot(slotNumber)
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def OnUnselectItemSlot(self, slotNumber):
+			if self.eventUnselectItemSlot:
+				if self.eventUnselectItemSlotWindow:
+					self.eventUnselectItemSlot(slotNumber, self.eventUnselectItemSlotWindow)
+				else:
+					self.eventUnselectItemSlot(slotNumber)
+	else:
+		def OnUnselectItemSlot(self, slotNumber):
+			if self.eventUnselectItemSlot:
+				self.eventUnselectItemSlot(slotNumber)
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def OnUseSlot(self, slotNumber):
+			if self.eventUseSlot:
+				if self.eventUseSlotWindow:
+					self.eventUseSlot(slotNumber, self.eventUseSlotWindow)
+				else:
+					self.eventUseSlot(slotNumber)
+	else:
+		def OnUseSlot(self, slotNumber):
+			if self.eventUseSlot:
+				self.eventUseSlot(slotNumber)
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def OnOverInItem(self, slotNumber):
+			if self.eventOverInItem:
+				if None == self.eventOverInItemSlotWindow:
+					if self.eventOverInItemArgs:
+						apply(self.eventOverInItem, self.eventOverInItemArgs)
+					else:
+						self.eventOverInItem(slotNumber)
+				else:
+					if self.eventOverInItemArgs:
+						apply(self.eventOverInItem, self.eventOverInItemArgs)
+					else:
+						self.eventOverInItem(slotNumber, self.eventOverInItemSlotWindow)
+	else:
+		def OnOverInItem(self, slotNumber):
+			if self.eventOverInItem:
+				if self.eventOverInItemArgs:
+					apply(self.eventOverInItem, self.eventOverInItemArgs)
+				else:
+					self.eventOverInItem(slotNumber)
+
+	def OnOverOutItem(self):
+		if self.eventOverOutItem:
+			self.eventOverOutItem()
+
+	def OnPressedSlotButton(self, slotNumber):
+		if self.eventPressedSlotButton:
+			self.eventPressedSlotButton(slotNumber)
+
+	def GetStartIndex(self):
+		return 0
+
+	def GetSlotGlobalPosition(self, index):
+		return wndMgr.GetSlotGlobalPosition(self.hWnd, index)
+
+	def GetSlotLocalPosition(self, index):
+		return wndMgr.GetSlotLocalPosition(self.hWnd, index)
+
+	def SetSlotCoverImage(self, slotindex, filename):
+		wndMgr.SetSlotCoverImage(self.hWnd, slotindex, filename)
+
+	def EnableSlotCoverImage(self, slotindex, onoff):
+		wndMgr.EnableSlotCoverImage(self.hWnd, slotindex, onoff)
+
+	def SetSecondSlotCoverImage(self, slot_index, filename):
+		wndMgr.SetSecondSlotCoverImage(self.hWnd, slot_index, filename)
+
+	def EnableSecondSlotCoverImage(self, slot_index, onoff):
+		wndMgr.EnableSecondSlotCoverImage(self.hWnd, slot_index, onoff)
+
+	def SetSlotType(self, flag):
+		wndMgr.SetSlotType(self.hWnd, flag)
+
+	if app.ENABLE_HIGH_LIGHT_IMAGE:
+		def AppendHighLightImage(self, index, fileName, alphaSpeed = 0.0, rotationSpeed = 0.0, curAlpha = 1.0, diffuse = 0xFFFFFFFF):
+			wndMgr.AppendHighLightImage(self.hWnd, index, fileName, alphaSpeed, rotationSpeed, curAlpha, diffuse)
+
+		def EnableHighLightImage(self, slotIndex):
+			wndMgr.EnableHighLightImage(self.hWnd, slotIndex)
+
+		def DisableHighLightImage(self, slotIndex):
+			wndMgr.DisableHighLightImage(self.hWnd, slotIndex)
+
+	if app.ENABLE_GROWTH_PET_SYSTEM:
+		def SetSlotCoolTimeInverse(self, slotIndex, coolTime, elapsedTime = 0.0):
+			wndMgr.SetSlotCoolTimeInverse(self.hWnd, slotIndex, coolTime, elapsedTime)
+
+		def SetPetSkillSlotNew(self, renderingSlotNumber, petSkillIndex):
+		
+			petSkillIcon = skill.GetPetSkillIconImage(petSkillIndex)
+
+			if 0 == petSkillIcon:
+				wndMgr.ClearSlot(self.hWnd, renderingSlotNumber)
+				return
+
+			wndMgr.SetSlot(self.hWnd, renderingSlotNumber, petSkillIndex, 1, 1, petSkillIcon)
+
+class GridSlotWindow(SlotWindow):
+
+	def __init__(self):
+		SlotWindow.__init__(self)
+
+		self.startIndex = 0
+
+	def __del__(self):
+		SlotWindow.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterGridSlotWindow(self, layer)
+
+	def ArrangeSlot(self, StartIndex, xCount, yCount, xSize, ySize, xBlank, yBlank):
+
+		self.startIndex = StartIndex
+
+		wndMgr.ArrangeSlot(self.hWnd, StartIndex, xCount, yCount, xSize, ySize, xBlank, yBlank)
+		self.startIndex = StartIndex
+
+	def GetStartIndex(self):
+		return self.startIndex
+
+class TitleBar(Window):
+
+	BLOCK_WIDTH = 32
+	BLOCK_HEIGHT = 23
+
+	def __init__(self):
+		Window.__init__(self)
+		self.AddFlag("attach")
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def MakeTitleBar(self, width, color):
+
+		##  Color Ï°  
+
+		width = max(64, width)
+
+		imgLeft = ImageBox()
+		imgCenter = ExpandedImageBox()
+		imgRight = ImageBox()
+		imgLeft.AddFlag("not_pick")
+		imgCenter.AddFlag("not_pick")
+		imgRight.AddFlag("not_pick")
+		imgLeft.SetParent(self)
+		imgCenter.SetParent(self)
+		imgRight.SetParent(self)
+
+		if localeInfo.IsARABIC():
+			imgLeft.LoadImage("locale/ae/ui/pattern/titlebar_left.tga")
+			imgCenter.LoadImage("locale/ae/ui/pattern/titlebar_center.tga")
+			imgRight.LoadImage("locale/ae/ui/pattern/titlebar_right.tga")
+		else:
+			imgLeft.LoadImage("d:/ymir work/ui/pattern/titlebar_left.tga")
+			imgCenter.LoadImage("d:/ymir work/ui/pattern/titlebar_center.tga")
+			imgRight.LoadImage("d:/ymir work/ui/pattern/titlebar_right.tga")
+
+		imgLeft.Show()
+		imgCenter.Show()
+		imgRight.Show()
+
+		btnClose = Button()
+		btnClose.SetParent(self)
+		btnClose.SetUpVisual("d:/ymir work/ui/public/close_button_01.sub")
+		btnClose.SetOverVisual("d:/ymir work/ui/public/close_button_02.sub")
+		btnClose.SetDownVisual("d:/ymir work/ui/public/close_button_03.sub")
+		btnClose.SetToolTipText(localeInfo.UI_CLOSE, 0, -23)
+		btnClose.Show()
+
+		self.imgLeft = imgLeft
+		self.imgCenter = imgCenter
+		self.imgRight = imgRight
+		self.btnClose = btnClose
+
+		self.SetWidth(width)
+
+	def SetWidth(self, width):
+		self.imgCenter.SetRenderingRect(0.0, 0.0, float((width - self.BLOCK_WIDTH*2) - self.BLOCK_WIDTH) / self.BLOCK_WIDTH, 0.0)
+		self.imgCenter.SetPosition(self.BLOCK_WIDTH, 0)
+		self.imgRight.SetPosition(width - self.BLOCK_WIDTH, 0)
+
+		if localeInfo.IsARABIC():
+			self.btnClose.SetPosition(3, 3)
+		else:
+			self.btnClose.SetPosition(width - self.btnClose.GetWidth() - 3, 3)
+
+		self.SetSize(width, self.BLOCK_HEIGHT)
+
+	def SetCloseEvent(self, event):
+		self.btnClose.SetEvent(event)
+
+	if app.ENABLE_CHANGED_ATTR or app.ENABLE_DETAILS_UI or app.ENABLE_LUCKY_BOX:
+		def CloseButtonHide(self):
+			if localeInfo.IsARABIC():
+				self.imgLeft.LoadImage("d:/ymir work/ui/pattern/titlebar_right_02.tga")
+				self.imgLeft.LeftRightReverse()
+				self.btnClose.Hide()
+			else:
+				self.imgRight.LoadImage("d:/ymir work/ui/pattern/titlebar_right_02.tga")
+				self.btnClose.Hide()
+
+class HorizontalBar(Window):
+	BLOCK_WIDTH = 32
+	BLOCK_HEIGHT = 17
+
+	def __init__(self):
+		Window.__init__(self)
+		self.AddFlag("attach")
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def Create(self, width):
+
+		width = max(96, width)
+
+		imgLeft = ImageBox()
+		imgLeft.SetParent(self)
+		imgLeft.AddFlag("not_pick")
+		imgLeft.LoadImage("d:/ymir work/ui/pattern/horizontalbar_left.tga")
+		imgLeft.Show()
+
+		imgCenter = ExpandedImageBox()
+		imgCenter.SetParent(self)
+		imgCenter.AddFlag("not_pick")
+		imgCenter.LoadImage("d:/ymir work/ui/pattern/horizontalbar_center.tga")
+		imgCenter.Show()
+
+		imgRight = ImageBox()
+		imgRight.SetParent(self)
+		imgRight.AddFlag("not_pick")
+		imgRight.LoadImage("d:/ymir work/ui/pattern/horizontalbar_right.tga")
+		imgRight.Show()
+
+		self.imgLeft = imgLeft
+		self.imgCenter = imgCenter
+		self.imgRight = imgRight
+		self.SetWidth(width)
+
+	def SetWidth(self, width):
+		self.imgCenter.SetRenderingRect(0.0, 0.0, float((width - self.BLOCK_WIDTH*2) - self.BLOCK_WIDTH) / self.BLOCK_WIDTH, 0.0)
+		self.imgCenter.SetPosition(self.BLOCK_WIDTH, 0)
+		self.imgRight.SetPosition(width - self.BLOCK_WIDTH, 0)
+		self.SetSize(width, self.BLOCK_HEIGHT)
+
+class Gauge(Window):
+	SLOT_WIDTH = 16
+	SLOT_HEIGHT = 7
+
+	GAUGE_TEMPORARY_PLACE = 12
+	GAUGE_WIDTH = 16
+
+	def __init__(self):
+		Window.__init__(self)
+		self.width = 0
+	def __del__(self):
+		Window.__del__(self)
+
+	def MakeGauge(self, width, color):
+		self.width = max(48, width)
+
+		imgSlotLeft = ImageBox()
+		imgSlotLeft.SetParent(self)
+		imgSlotLeft.LoadImage("d:/ymir work/ui/pattern/gauge_slot_left.tga")
+		imgSlotLeft.Show()
+
+		imgSlotRight = ImageBox()
+		imgSlotRight.SetParent(self)
+		imgSlotRight.LoadImage("d:/ymir work/ui/pattern/gauge_slot_right.tga")
+		imgSlotRight.Show()
+		imgSlotRight.SetPosition(width - self.SLOT_WIDTH, 0)
+
+		imgSlotCenter = ExpandedImageBox()
+		imgSlotCenter.SetParent(self)
+		imgSlotCenter.LoadImage("d:/ymir work/ui/pattern/gauge_slot_center.tga")
+		imgSlotCenter.Show()
+		imgSlotCenter.SetRenderingRect(0.0, 0.0, float((width - self.SLOT_WIDTH*2) - self.SLOT_WIDTH) / self.SLOT_WIDTH, 0.0)
+		imgSlotCenter.SetPosition(self.SLOT_WIDTH, 0)
+
+		imgGauge = ExpandedImageBox()
+		imgGauge.SetParent(self)
+		imgGauge.LoadImage("d:/ymir work/ui/pattern/gauge_" + color + ".tga")
+		imgGauge.Show()
+		imgGauge.SetRenderingRect(0.0, 0.0, 0.0, 0.0)
+		imgGauge.SetPosition(self.GAUGE_TEMPORARY_PLACE, 0)
+
+		imgSlotLeft.AddFlag("attach")
+		imgSlotCenter.AddFlag("attach")
+		imgSlotRight.AddFlag("attach")
+
+		if app.WJ_SHOW_PARTY_ON_MINIMAP:
+			imgSlotLeft.AddFlag("not_pick")
+			imgSlotCenter.AddFlag("not_pick")
+			imgSlotRight.AddFlag("not_pick")
+			imgGauge.AddFlag("not_pick")
+
+		self.imgLeft = imgSlotLeft
+		self.imgCenter = imgSlotCenter
+		self.imgRight = imgSlotRight
+		self.imgGauge = imgGauge
+
+		self.SetSize(width, self.SLOT_HEIGHT)
+
+	def SetPercentage(self, curValue, maxValue):
+		# PERCENTAGE_MAX_VALUE_ZERO_DIVISION_ERROR
+		if maxValue > 0.0:
+			percentage = min(1.0, float(curValue)/float(maxValue))
+		else:
+			percentage = 0.0
+		# END_OF_PERCENTAGE_MAX_VALUE_ZERO_DIVISION_ERROR
+
+		gaugeSize = -1.0 + float(self.width - self.GAUGE_TEMPORARY_PLACE*2) * percentage / self.GAUGE_WIDTH
+		self.imgGauge.SetRenderingRect(0.0, 0.0, gaugeSize, 0.0)
+
+	if app.WJ_SHOW_PARTY_ON_MINIMAP:
+		def GaugeImgBoxAddFlag(self, flag):
+			self.imgLeft.AddFlag(flag)
+			self.imgCenter.AddFlag(flag)
+			self.imgRight.AddFlag(flag)
+			self.imgGauge.AddFlag(flag)
+
+class Board(Window):
+	CORNER_WIDTH = 32
+	CORNER_HEIGHT = 32
+	LINE_WIDTH = 128
+	LINE_HEIGHT = 128
+
+	LT = 0
+	LB = 1
+	RT = 2
+	RB = 3
+	L = 0
+	R = 1
+	T = 2
+	B = 3
+
+	def __init__(self):
+		Window.__init__(self)
+
+		self.MakeBoard("d:/ymir work/ui/pattern/Board_Corner_", "d:/ymir work/ui/pattern/Board_Line_")
+		self.MakeBase()
+
+	def MakeBoard(self, cornerPath, linePath):
+
+		CornerFileNames = [ cornerPath+dir+".tga" for dir in ("LeftTop", "LeftBottom", "RightTop", "RightBottom", ) ]
+		LineFileNames = [ linePath+dir+".tga" for dir in ("Left", "Right", "Top", "Bottom", ) ]
+		"""
+		CornerFileNames = (
+							"d:/ymir work/ui/pattern/Board_Corner_LeftTop.tga",
+							"d:/ymir work/ui/pattern/Board_Corner_LeftBottom.tga",
+							"d:/ymir work/ui/pattern/Board_Corner_RightTop.tga",
+							"d:/ymir work/ui/pattern/Board_Corner_RightBottom.tga",
+							)
+		LineFileNames = (
+							"d:/ymir work/ui/pattern/Board_Line_Left.tga",
+							"d:/ymir work/ui/pattern/Board_Line_Right.tga",
+							"d:/ymir work/ui/pattern/Board_Line_Top.tga",
+							"d:/ymir work/ui/pattern/Board_Line_Bottom.tga",
+							)
+		"""
+
+		self.Corners = []
+		for fileName in CornerFileNames:
+			Corner = ExpandedImageBox()
+			Corner.AddFlag("not_pick")
+			Corner.LoadImage(fileName)
+			Corner.SetParent(self)
+			Corner.SetPosition(0, 0)
+			Corner.Show()
+			self.Corners.append(Corner)
+
+		self.Lines = []
+		for fileName in LineFileNames:
+			Line = ExpandedImageBox()
+			Line.AddFlag("not_pick")
+			Line.LoadImage(fileName)
+			Line.SetParent(self)
+			Line.SetPosition(0, 0)
+			Line.Show()
+			self.Lines.append(Line)
+
+		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
+		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
+
+	def MakeBase(self):
+		self.Base = ExpandedImageBox()
+		self.Base.AddFlag("not_pick")
+		self.Base.LoadImage("d:/ymir work/ui/pattern/Board_Base.tga")
+		self.Base.SetParent(self)
+		self.Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Base.Show()
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def SetSize(self, width, height):
+		width = max(self.CORNER_WIDTH * 2, width)
+		height = max(self.CORNER_HEIGHT * 2, height)
+		Window.SetSize(self, width, height)
+
+		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
+		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
+		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
+		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
+
+		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
+		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
+		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+
+		if self.Base:
+			self.Base.SetRenderingRect(0, 0, horizontalShowingPercentage, verticalShowingPercentage)
+
+class BorderA(Window):
+	CORNER_WIDTH = 16
+	CORNER_HEIGHT = 16
+	LINE_WIDTH = 16
+	LINE_HEIGHT = 16
+	BOARD_COLOR = grp.GenerateColor(0.17, 0.027, 0.0, 0.70)
+
+
+	LT = 0
+	LB = 1
+	RT = 2
+	RB = 3
+	L = 0
+	R = 1
+	T = 2
+	B = 3
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		CornerFileNames = [ "d:/ymir work/ui/pattern/border_a/border_a_"+dir+".tga" for dir in ["Left_Top","Left_Bottom","Right_Top","Right_Bottom"] ]
+		LineFileNames = [ "d:/ymir work/ui/pattern/border_a/border_a_"+dir+".tga" for dir in ["Left","Right","Top","Bottom"] ]
+		#BaseFileName = "d:/ymir work/ui/pattern/border_a/border_center.tga"
+		
+		self.Corners = []
+		for fileName in CornerFileNames:
+			Corner = ExpandedImageBox()
+			Corner.AddFlag("not_pick")
+			Corner.LoadImage(fileName)
+			Corner.SetParent(self)
+			Corner.SetPosition(0, 0)
+			Corner.Show()
+			self.Corners.append(Corner)
+
+		self.Lines = []
+		for fileName in LineFileNames:
+			Line = ExpandedImageBox()
+			Line.AddFlag("not_pick")
+			Line.LoadImage(fileName)
+			Line.SetParent(self)
+			Line.SetPosition(0, 0)
+			Line.Show()
+			self.Lines.append(Line)
+
+		self.Base = ExpandedImageBox()
+		self.Base.AddFlag("not_pick")
+		self.Base.LoadImage("d:/ymir work/ui/pattern/border_a/border_a_center.tga")
+		self.Base.SetParent(self)
+		self.Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Base.Show()
+		
+		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
+		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def SetSize(self, width, height):
+
+		width = max(self.CORNER_WIDTH*2, width)
+		height = max(self.CORNER_HEIGHT*2, height)
+		Window.SetSize(self, width, height)
+
+		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
+		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
+		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
+		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
+
+		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
+		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
+		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+
+		if self.Base:
+			self.Base.SetRenderingRect(0, 0, horizontalShowingPercentage, verticalShowingPercentage)
+
+	def ShowInternal(self):
+		self.Base.Show()
+		for wnd in self.Lines:
+			wnd.Show()
+		for wnd in self.Corners:
+			wnd.Show()
+
+	def HideInternal(self):
+		self.Base.Hide()
+		for wnd in self.Lines:
+			wnd.Hide()
+		for wnd in self.Corners:
+			wnd.Hide()
+
+class MiddleBoard(Window):
+
+	CORNER_WIDTH = 16
+	CORNER_HEIGHT = 16
+	LINE_WIDTH = 16
+	LINE_HEIGHT = 16
+	BOARD_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 0.7)
+
+	LT = 0
+	LB = 1
+	RT = 2
+	RB = 3
+	L = 0
+	R = 1
+	T = 2
+	B = 3
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		CornerFileNames = [ "d:/ymir work/ui/pattern/ThinBoardB_Corner_" + dir + ".tga" for dir in [ "LeftTop", "LeftBottom", "RightTop", "RightBottom" ] ]
+		LineFileNames = [ "d:/ymir work/ui/pattern/ThinBoardB_Line_" + dir + ".tga" for dir in [ "Left", "Right", "Top", "Bottom" ] ]
+
+		self.Corners = []
+		for fileName in CornerFileNames:
+			Corner = ExpandedImageBox()
+			Corner.AddFlag("attach")
+			Corner.AddFlag("not_pick")
+			Corner.LoadImage(fileName)
+			Corner.SetParent(self)
+			Corner.SetPosition(0, 0)
+			Corner.Show()
+			self.Corners.append(Corner)
+
+		self.Lines = []
+		for fileName in LineFileNames:
+			Line = ExpandedImageBox()
+			Line.AddFlag("attach")
+			Line.AddFlag("not_pick")
+			Line.LoadImage(fileName)
+			Line.SetParent(self)
+			Line.SetPosition(0, 0)
+			Line.Show()
+			self.Lines.append(Line)
+
+		Base = Bar()
+		Base.SetParent(self)
+		Base.AddFlag("attach")
+		Base.AddFlag("not_pick")
+		Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		Base.SetColor(self.BOARD_COLOR)
+		Base.Show()
+		self.Base = Base
+
+		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
+		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def SetSize(self, width, height):
+		width = max(self.CORNER_WIDTH * 2, width)
+		height = max(self.CORNER_HEIGHT * 2, height)
+		Window.SetSize(self, width, height)
+
+		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
+		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
+		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
+		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
+
+		verticalShowingPercentage = float((height - self.CORNER_HEIGHT * 2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
+		horizontalShowingPercentage = float((width - self.CORNER_WIDTH * 2) - self.LINE_WIDTH) / self.LINE_WIDTH
+		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Base.SetSize(width - self.CORNER_WIDTH * 2, height - self.CORNER_HEIGHT * 2)
+
+	def ShowInternal(self):
+		self.Base.Show()
+		for wnd in self.Lines:
+			wnd.Show()
+		for wnd in self.Corners:
+			wnd.Show()
+
+	def HideInternal(self):
+		self.Base.Hide()
+		for wnd in self.Lines:
+			wnd.Hide()
+		for wnd in self.Corners:
+			wnd.Hide()
+
+class BoardWithTitleBar(Board):
+	def __init__(self):
+		Board.__init__(self)
+
+		titleBar = TitleBar()
+		titleBar.SetParent(self)
+		titleBar.MakeTitleBar(0, "red")
+		titleBar.SetPosition(8, 7)
+		titleBar.Show()
+
+		titleName = TextLine()
+		titleName.SetParent(titleBar)
+		titleName.SetPosition(0, 4)
+		titleName.SetWindowHorizontalAlignCenter()
+		titleName.SetHorizontalAlignCenter()
+		titleName.Show()
+
+		self.titleBar = titleBar
+		self.titleName = titleName
+
+		self.SetCloseEvent(self.Hide)
+
+	def __del__(self):
+		Board.__del__(self)
+		self.titleBar = None
+		self.titleName = None
+
+	def SetSize(self, width, height):
+		self.titleBar.SetWidth(width - 15)
+		#self.pickRestrictWindow.SetSize(width, height - 30)
+		Board.SetSize(self, width, height)
+		self.titleName.UpdateRect()
+
+	def SetTitleColor(self, color):
+		self.titleName.SetPackedFontColor(color)
+
+	def SetTitleName(self, name):
+		self.titleName.SetText(name)
+
+	def SetCloseEvent(self, event):
+		self.titleBar.SetCloseEvent(event)
+
+class ThinBoard(Window):
+	CORNER_WIDTH = 16
+	CORNER_HEIGHT = 16
+	LINE_WIDTH = 16
+	LINE_HEIGHT = 16
+	BOARD_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 0.51)
+
+	LT = 0
+	LB = 1
+	RT = 2
+	RB = 3
+	L = 0
+	R = 1
+	T = 2
+	B = 3
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		CornerFileNames = [ "d:/ymir work/ui/pattern/ThinBoard_Corner_"+dir+".tga" for dir in ["LeftTop","LeftBottom","RightTop","RightBottom"] ]
+		LineFileNames = [ "d:/ymir work/ui/pattern/ThinBoard_Line_"+dir+".tga" for dir in ["Left","Right","Top","Bottom"] ]
+
+		self.Corners = []
+		for fileName in CornerFileNames:
+			Corner = ExpandedImageBox()
+			Corner.AddFlag("attach")
+			Corner.AddFlag("not_pick")
+			Corner.LoadImage(fileName)
+			Corner.SetParent(self)
+			Corner.SetPosition(0, 0)
+			Corner.Show()
+			self.Corners.append(Corner)
+
+		self.Lines = []
+		for fileName in LineFileNames:
+			Line = ExpandedImageBox()
+			Line.AddFlag("attach")
+			Line.AddFlag("not_pick")
+			Line.LoadImage(fileName)
+			Line.SetParent(self)
+			Line.SetPosition(0, 0)
+			Line.Show()
+			self.Lines.append(Line)
+
+		Base = Bar()
+		Base.SetParent(self)
+		Base.AddFlag("attach")
+		Base.AddFlag("not_pick")
+		Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		Base.SetColor(self.BOARD_COLOR)
+		Base.Show()
+		self.Base = Base
+
+		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
+		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	if app.ENABLE_SEND_TARGET_INFO:
+		def ShowCorner(self, corner):
+			self.Corners[corner].Show()
+			self.SetSize(self.GetWidth(), self.GetHeight())
+
+		def HideCorners(self, corner):
+			self.Corners[corner].Hide()
+			self.SetSize(self.GetWidth(), self.GetHeight())
+
+		def ShowLine(self, line):
+			self.Lines[line].Show()
+			self.SetSize(self.GetWidth(), self.GetHeight())
+
+		def HideLine(self, line):
+			self.Lines[line].Hide()
+			self.SetSize(self.GetWidth(), self.GetHeight())
+
+	def SetSize(self, width, height):
+		width = max(self.CORNER_WIDTH*2, width)
+		height = max(self.CORNER_HEIGHT*2, height)
+		Window.SetSize(self, width, height)
+
+		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
+		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
+		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
+		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
+
+		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
+		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
+		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Base.SetSize(width - self.CORNER_WIDTH*2, height - self.CORNER_HEIGHT*2)
+
+	def ShowInternal(self):
+		self.Base.Show()
+		for wnd in self.Lines:
+			wnd.Show()
+		for wnd in self.Corners:
+			wnd.Show()
+
+	def HideInternal(self):
+		self.Base.Hide()
+		for wnd in self.Lines:
+			wnd.Hide()
+		for wnd in self.Corners:
+			wnd.Hide()
+
+class ThinBoardGold(Window):
+	CORNER_WIDTH = 16
+	CORNER_HEIGHT = 16
+	LINE_WIDTH = 16
+	LINE_HEIGHT = 16
+
+	LT = 0
+	LB = 1
+	RT = 2
+	RB = 3
+	L = 0
+	R = 1
+	T = 2
+	B = 3
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		CornerFileNames = [ "d:/ymir work/ui/pattern/thinboardgold/ThinBoard_Corner_"+dir+"_Gold.tga" for dir in ["LeftTop","LeftBottom","RightTop","RightBottom"] ]
+		LineFileNames = [ "d:/ymir work/ui/pattern/thinboardgold/ThinBoard_Line_"+dir+"_Gold.tga" for dir in ["Left","Right","Top","Bottom"] ]
+
+		self.MakeBase()
+
+		self.Corners = []
+		for fileName in CornerFileNames:
+			Corner = ExpandedImageBox()
+			Corner.AddFlag("attach")
+			Corner.AddFlag("not_pick")
+			Corner.LoadImage(fileName)
+			Corner.SetParent(self)
+			Corner.SetPosition(0, 0)
+			Corner.Show()
+			self.Corners.append(Corner)
+
+		self.Lines = []
+		for fileName in LineFileNames:
+			Line = ExpandedImageBox()
+			Line.AddFlag("attach")
+			Line.AddFlag("not_pick")
+			Line.LoadImage(fileName)
+			Line.SetParent(self)
+			Line.SetPosition(0, 0)
+			Line.Show()
+			self.Lines.append(Line)
+
+		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
+		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def SetSize(self, width, height):
+
+		width = max(self.CORNER_WIDTH*2, width)
+		height = max(self.CORNER_HEIGHT*2, height)
+		Window.SetSize(self, width, height)
+
+		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
+		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
+		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
+		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
+
+		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
+		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
+
+		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+
+		#self.Base.GetWidth()
+		#self.Base.GetHeight()
+		"""
+			Defalt Width : 128, Height : 128 
+			0.0 > 128, 1.0 > 256 
+		"""
+		if self.Base:
+			self.Base.SetRenderingRect(0, 0, (float(width)-32)/float(self.Base.GetWidth()) - 1.0, (float(height)-32)/float(self.Base.GetHeight()) - 1.0)
+
+	def MakeBase(self):
+		self.Base = ExpandedImageBox()
+		self.Base.AddFlag("not_pick")
+		self.Base.LoadImage("d:/ymir work/ui/pattern/Board_Base.tga")
+		self.Base.SetParent(self)
+		self.Base.SetPosition(16, 16)
+		self.Base.SetAlpha(0.8)
+		self.Base.Show()
+
+	def ShowInternal(self):
+		self.Base.Show()
+		for wnd in self.Lines:
+			wnd.Show()
+		for wnd in self.Corners:
+			wnd.Show()
+
+	def HideInternal(self):
+		self.Base.Hide()
+		for wnd in self.Lines:
+			wnd.Hide()
+		for wnd in self.Corners:
+			wnd.Hide()
+
+class ThinBoardCircle(Window):
+	CORNER_WIDTH = 4
+	CORNER_HEIGHT = 4
+	LINE_WIDTH = 4
+	LINE_HEIGHT = 4
+	BOARD_COLOR = grp.GenerateColor(0.0, 0.0, 0.0, 1.0)
+
+	LT = 0
+	LB = 1
+	RT = 2
+	RB = 3
+	L = 0
+	R = 1
+	T = 2
+	B = 3
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+
+		CornerFileNames = [ "d:/ymir work/ui/pattern/thinboardcircle/ThinBoard_Corner_"+dir+"_Circle.tga" for dir in ["LeftTop","LeftBottom","RightTop","RightBottom"] ]
+		LineFileNames = [ "d:/ymir work/ui/pattern/thinboardcircle/ThinBoard_Line_"+dir+"_Circle.tga" for dir in ["Left","Right","Top","Bottom"] ]
+
+		self.Corners = []
+		for fileName in CornerFileNames:
+			Corner = ExpandedImageBox()
+			Corner.AddFlag("attach")
+			Corner.AddFlag("not_pick")
+			Corner.LoadImage(fileName)
+			Corner.SetParent(self)
+			Corner.SetPosition(0, 0)
+			Corner.Show()
+			self.Corners.append(Corner)
+
+		self.Lines = []
+		for fileName in LineFileNames:
+			Line = ExpandedImageBox()
+			Line.AddFlag("attach")
+			Line.AddFlag("not_pick")
+			Line.LoadImage(fileName)
+			Line.SetParent(self)
+			Line.SetPosition(0, 0)
+			Line.Show()
+			self.Lines.append(Line)
+
+		Base = Bar()
+		Base.SetParent(self)
+		Base.AddFlag("attach")
+		Base.AddFlag("not_pick")
+		Base.SetPosition(self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		Base.SetColor(self.BOARD_COLOR)
+		Base.Show()
+		self.Base = Base
+
+		self.Lines[self.L].SetPosition(0, self.CORNER_HEIGHT)
+		self.Lines[self.T].SetPosition(self.CORNER_WIDTH, 0)
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def SetSize(self, width, height):
+
+		width = max(self.CORNER_WIDTH*2, width)
+		height = max(self.CORNER_HEIGHT*2, height)
+		Window.SetSize(self, width, height)
+
+		self.Corners[self.LB].SetPosition(0, height - self.CORNER_HEIGHT)
+		self.Corners[self.RT].SetPosition(width - self.CORNER_WIDTH, 0)
+		self.Corners[self.RB].SetPosition(width - self.CORNER_WIDTH, height - self.CORNER_HEIGHT)
+		self.Lines[self.R].SetPosition(width - self.CORNER_WIDTH, self.CORNER_HEIGHT)
+		self.Lines[self.B].SetPosition(self.CORNER_HEIGHT, height - self.CORNER_HEIGHT)
+
+		verticalShowingPercentage = float((height - self.CORNER_HEIGHT*2) - self.LINE_HEIGHT) / self.LINE_HEIGHT
+		horizontalShowingPercentage = float((width - self.CORNER_WIDTH*2) - self.LINE_WIDTH) / self.LINE_WIDTH
+		self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+		self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+		self.Base.SetSize(width - self.CORNER_WIDTH*2, height - self.CORNER_HEIGHT*2)
+
+	def ShowInternal(self):
+		self.Base.Show()
+		for wnd in self.Lines:
+			wnd.Show()
+		for wnd in self.Corners:
+			wnd.Show()
+
+	def HideInternal(self):
+		self.Base.Hide()
+		for wnd in self.Lines:
+			wnd.Hide()
+		for wnd in self.Corners:
+			wnd.Hide()
+
+if app.ENABLE_MYSHOP_DECO:
+	class ShopDecoTitle(Window):
+		DEFAULT_VALUE = 16
+		CORNER_WIDTH = 48
+		CORNER_HEIGHT = 32
+		LINE_WIDTH = 16
+		LINE_HEIGHT = 32
+
+		LT = 0
+		LB = 1
+		RT = 2
+		RB = 3
+		L = 0
+		R = 1
+		T = 2
+		B = 3
+
+		def __init__(self, type, layer = "UI"):
+			Window.__init__(self, layer)
+
+			CornerFileNames, LineFileNames = self.__GetFilePath(type)
+
+			if CornerFileNames == None or LineFileNames == None:
+				return
+
+			self.Corners = []
+			for fileName in CornerFileNames:
+				Corner = ExpandedImageBox()
+				Corner.AddFlag("attach")
+				Corner.AddFlag("not_pick")
+				Corner.LoadImage(fileName)
+				Corner.SetParent(self)
+				Corner.SetPosition(0, 0)
+				Corner.Show()
+				self.Corners.append(Corner)
+
+			self.Lines = []
+			for fileName in LineFileNames:
+				Line = ExpandedImageBox()
+				Line.AddFlag("attach")
+				Line.AddFlag("not_pick")
+				Line.LoadImage(fileName)
+				Line.SetParent(self)
+				Line.SetPosition(0, 0)
+				Line.Show()
+				self.Lines.append(Line)
+
+		def __del__(self):
+			Window.__del__(self)
+
+		def __GetFilePath(self, type):
+			import uiMyShopDecoration
+
+			CornerFileNames = [ uiMyShopDecoration.DECO_SHOP_TITLE_LIST[type][1] + "_" + dir + ".tga" for dir in [ "left_top", "left_bottom", "right_top", "right_bottom" ] ]
+			LineFileNames = [ uiMyShopDecoration.DECO_SHOP_TITLE_LIST[type][1] + "_" + dir + ".tga" for dir in [ "left", "right", "top", "bottom" ] ]
+
+			return CornerFileNames, LineFileNames
+
+		def SetSize(self, width, height):
+			width = max(self.DEFAULT_VALUE * 2, width)
+			height = max(self.DEFAULT_VALUE * 2, height)
+			Window.SetSize(self, width, height)
+
+			self.Corners[self.LT].SetPosition(-self.CORNER_WIDTH + self.DEFAULT_VALUE, -self.CORNER_HEIGHT + self.DEFAULT_VALUE)
+			self.Corners[self.LB].SetPosition(-self.CORNER_WIDTH + self.DEFAULT_VALUE, height - self.CORNER_HEIGHT + self.DEFAULT_VALUE)
+
+			self.Corners[self.RT].SetPosition(width - self.DEFAULT_VALUE, -self.CORNER_HEIGHT + self.DEFAULT_VALUE)
+			self.Corners[self.RB].SetPosition(width - self.DEFAULT_VALUE, height - self.CORNER_HEIGHT + self.DEFAULT_VALUE)
+
+			self.Lines[self.L].SetPosition(0, self.DEFAULT_VALUE)
+			self.Lines[self.R].SetPosition(width - self.DEFAULT_VALUE, self.DEFAULT_VALUE)
+			self.Lines[self.B].SetPosition(self.DEFAULT_VALUE, height - self.LINE_HEIGHT + self.DEFAULT_VALUE)
+			self.Lines[self.T].SetPosition(self.DEFAULT_VALUE, -self.LINE_HEIGHT + self.DEFAULT_VALUE)
+
+			verticalShowingPercentage = float((height - self.DEFAULT_VALUE * 2) - self.DEFAULT_VALUE) / self.DEFAULT_VALUE
+			horizontalShowingPercentage = float((width - self.DEFAULT_VALUE * 2) - self.DEFAULT_VALUE) / self.DEFAULT_VALUE
+
+			self.Lines[self.L].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+			self.Lines[self.R].SetRenderingRect(0, 0, 0, verticalShowingPercentage)
+			self.Lines[self.T].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+			self.Lines[self.B].SetRenderingRect(0, 0, horizontalShowingPercentage, 0)
+
+		def ShowInternal(self):
+			for wnd in self.Lines:
+				wnd.Show()
+			for wnd in self.Corners:
+				wnd.Show()
+
+		def HideInternal(self):
+			for wnd in self.Lines:
+				wnd.Hide()
+			for wnd in self.Corners:
+				wnd.Hide()
+
+class ScrollBar(Window):
+	SCROLLBAR_WIDTH = 17
+	SCROLLBAR_MIDDLE_HEIGHT = 9
+	SCROLLBAR_BUTTON_WIDTH = 17
+	SCROLLBAR_BUTTON_HEIGHT = 17
+	MIDDLE_BAR_POS = 5
+	MIDDLE_BAR_UPPER_PLACE = 3
+	MIDDLE_BAR_DOWNER_PLACE = 4
+	TEMP_SPACE = MIDDLE_BAR_UPPER_PLACE + MIDDLE_BAR_DOWNER_PLACE
+
+	class MiddleBar(DragButton):
+		def __init__(self):
+			DragButton.__init__(self)
+			self.AddFlag("movable")
+			#self.AddFlag("restrict_x")
+
+		def MakeImage(self):
+			top = ImageBox()
+			top.SetParent(self)
+			top.LoadImage("d:/ymir work/ui/pattern/ScrollBar_Top.tga")
+			top.SetPosition(0, 0)
+			top.AddFlag("not_pick")
+			top.Show()
+			bottom = ImageBox()
+			bottom.SetParent(self)
+			bottom.LoadImage("d:/ymir work/ui/pattern/ScrollBar_Bottom.tga")
+			bottom.AddFlag("not_pick")
+			bottom.Show()
+
+			middle = ExpandedImageBox()
+			middle.SetParent(self)
+			middle.LoadImage("d:/ymir work/ui/pattern/ScrollBar_Middle.tga")
+			middle.SetPosition(0, 4)
+			middle.AddFlag("not_pick")
+			middle.Show()
+
+			self.top = top
+			self.bottom = bottom
+			self.middle = middle
+
+		def SetSize(self, height):
+			height = max(12, height)
+			DragButton.SetSize(self, 10, height)
+			self.bottom.SetPosition(0, height-4)
+
+			height -= 4*3
+			self.middle.SetRenderingRect(0, 0, 0, float(height)/4.0)
+
+	def __init__(self):
+		Window.__init__(self)
+
+		self.pageSize = 1
+		self.curPos = 0.0
+		self.eventScroll = lambda *arg: None
+		self.lockFlag = False
+		self.scrollStep = 0.20
+		self.scroll_span = 0
+
+		self.UpScrollButtonEvent = lambda *arg: None
+		self.DownScrollButtonEvent = lambda *arg: None
+
+		self.eventFuncCall = True
+
+		self.CreateScrollBar()
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def CreateScrollBar(self):
+		barSlot = Bar3D()
+		barSlot.SetParent(self)
+		barSlot.AddFlag("not_pick")
+		barSlot.Show()
+
+		middleBar = self.MiddleBar()
+		middleBar.SetParent(self)
+		middleBar.SetMoveEvent(__mem_func__(self.OnMove))
+		middleBar.Show()
+		middleBar.MakeImage()
+		middleBar.SetSize(12)
+
+		upButton = Button()
+		upButton.SetParent(self)
+		upButton.SetEvent(__mem_func__(self.OnUp))
+		upButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_up_button_01.sub")
+		upButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_up_button_02.sub")
+		upButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_up_button_03.sub")
+		upButton.Show()
+
+		downButton = Button()
+		downButton.SetParent(self)
+		downButton.SetEvent(__mem_func__(self.OnDown))
+		downButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_down_button_01.sub")
+		downButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_down_button_02.sub")
+		downButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_down_button_03.sub")
+		downButton.Show()
+
+		self.upButton = upButton
+		self.downButton = downButton
+		self.middleBar = middleBar
+		self.barSlot = barSlot
+
+		self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
+		self.SCROLLBAR_MIDDLE_HEIGHT = self.middleBar.GetHeight()
+		self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
+		self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
+
+	if app.ENABLE_MOUSE_WHEEL_TOP_WINDOW:
+		def OnMouseWheel(self, delta):
+			if delta > 0:
+				self.SetPos(self.curPos - (self.scrollStep/4))
+				return True
+			elif delta < 0:
+				self.SetPos(self.curPos + (self.scrollStep/4))
+				return True
+			return False
+
+	def Destroy(self):
+		self.middleBar = None
+		self.upButton = None
+		self.downButton = None
+		self.eventScroll = lambda *arg: None
+
+		self.UpScrollButtonEvent = lambda *arg: None
+		self.DownScrollButtonEvent = lambda *arg: None
+
+		self.eventFuncCall = True
+
+	def SetUpScrollButtonEvent(self, event):
+		self.UpScrollButtonEvent = event
+
+	def SetDownScrollButtonEvent(self, event):
+		self.DownScrollButtonEvent = event
+
+	def SetEvnetFuncCall(self, callable):
+		self.eventFuncCall = callable
+
+	def SetScrollEvent(self, event):
+		self.eventScroll = event
+
+	def SetMiddleBarSize(self, pageScale):
+		realHeight = self.GetHeight() - self.SCROLLBAR_BUTTON_HEIGHT*2
+		self.SCROLLBAR_MIDDLE_HEIGHT = int(pageScale * float(realHeight))
+		self.middleBar.SetSize(self.SCROLLBAR_MIDDLE_HEIGHT)
+		self.pageSize = (self.GetHeight() - self.SCROLLBAR_BUTTON_HEIGHT*2) - self.SCROLLBAR_MIDDLE_HEIGHT - (self.TEMP_SPACE)
+
+	def SetScrollBarSize(self, height):
+		self.pageSize = (height - self.SCROLLBAR_BUTTON_HEIGHT*2) - self.SCROLLBAR_MIDDLE_HEIGHT - (self.TEMP_SPACE)
+		self.SetSize(self.SCROLLBAR_WIDTH, height)
+		self.upButton.SetPosition(0, 0)
+		self.downButton.SetPosition(0, height - self.SCROLLBAR_BUTTON_HEIGHT)
+		self.middleBar.SetRestrictMovementArea(self.MIDDLE_BAR_POS, self.SCROLLBAR_BUTTON_HEIGHT + self.MIDDLE_BAR_UPPER_PLACE, self.MIDDLE_BAR_POS+2, height - self.SCROLLBAR_BUTTON_HEIGHT*2 - self.TEMP_SPACE)
+		self.middleBar.SetPosition(self.MIDDLE_BAR_POS, 0)
+
+		self.UpdateBarSlot()
+
+	def UpdateBarSlot(self):
+		self.barSlot.SetPosition(0, self.SCROLLBAR_BUTTON_HEIGHT)
+		self.barSlot.SetSize(self.GetWidth() - 2, self.GetHeight() - self.SCROLLBAR_BUTTON_HEIGHT*2 - 2)
+
+	def GetPos(self):
+		return self.curPos
+
+	def SetPos(self, pos, event_callable = True):
+		pos = max(0.0, pos)
+		pos = min(1.0, pos)
+
+		newPos = float(self.pageSize) * pos
+		if app.ENABLE_MAILBOX:
+			self.middleBar.SetPosition(self.MIDDLE_BAR_POS, round(float(newPos) + self.SCROLLBAR_BUTTON_HEIGHT + self.MIDDLE_BAR_UPPER_PLACE))
+		else:
+			self.middleBar.SetPosition(self.MIDDLE_BAR_POS, int(newPos) + self.SCROLLBAR_BUTTON_HEIGHT + self.MIDDLE_BAR_UPPER_PLACE)
+
+		self.OnMove(event_callable)
+
+	def SetScrollStep(self, step):
+		self.scrollStep = step
+
+	def GetScrollStep(self):
+		return self.scrollStep
+
+	def SetSpan(self, span):
+		self.scroll_span = span
+
+	def IncreaseSpan(self, span):
+		self.scroll_span += span
+
+	def GetSpan(self):
+		return self.scroll_span
+
+	def OnUp(self):
+		self.SetPos(self.curPos-self.scrollStep, self.eventFuncCall)
+		self.UpScrollButtonEvent()
+
+	def OnDown(self):
+		self.SetPos(self.curPos+self.scrollStep, self.eventFuncCall)
+		self.DownScrollButtonEvent()
+
+	def OnMove(self, event_callable = True):
+		if self.lockFlag:
+			return
+
+		if 0 == self.pageSize:
+			return
+
+		(xLocal, yLocal) = self.middleBar.GetLocalPosition()
+		self.curPos = float(yLocal - self.SCROLLBAR_BUTTON_HEIGHT - self.MIDDLE_BAR_UPPER_PLACE) / float(self.pageSize)
+
+		if event_callable:
+			self.eventScroll()
+
+	def OnMouseLeftButtonDown(self):
+		(xMouseLocalPosition, yMouseLocalPosition) = self.GetMouseLocalPosition()
+		pickedPos = yMouseLocalPosition - self.SCROLLBAR_BUTTON_HEIGHT - self.SCROLLBAR_MIDDLE_HEIGHT/2
+		newPos = float(pickedPos) / float(self.pageSize)
+		self.SetPos(newPos)
+
+	def LockScroll(self):
+		self.lockFlag = True
+
+	def UnlockScroll(self):
+		self.lockFlag = False
+
+	if app.ENABLE_MAILBOX:
+		def SetUpButtonSizeRefresh(self):
+			self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
+			self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
+			self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
+
+		def SetUpButtonUpVisual(self, img_path):
+			if self.upButton:
+				self.upButton.SetUpVisual(img_path)
+
+		def SetUpButtonOverVisual(self, img_path):
+			if self.upButton:
+				self.upButton.SetOverVisual(img_path)
+
+		def SetUpButtonDownVisual(self, img_path):
+			if self.upButton:
+				self.upButton.SetDownVisual(img_path)
+
+		def SetDownButtonUpVisual(self, img_path):
+			if self.downButton:
+				self.downButton.SetUpVisual(img_path)
+
+		def SetDownButtonOverVisual(self, img_path):
+			if self.downButton:
+				self.downButton.SetOverVisual(img_path)
+
+		def SetDownButtonDownVisual(self, img_path):
+			if self.downButton:
+				self.downButton.SetDownVisual(img_path)
+
+class ThinScrollBar(ScrollBar):
+	def CreateScrollBar(self):
+		middleBar = self.MiddleBar()
+		middleBar.SetParent(self)
+		middleBar.SetMoveEvent(__mem_func__(self.OnMove))
+		middleBar.Show()
+		middleBar.SetUpVisual("d:/ymir work/ui/public/scrollbar_thin_middle_button_01.sub")
+		middleBar.SetOverVisual("d:/ymir work/ui/public/scrollbar_thin_middle_button_02.sub")
+		middleBar.SetDownVisual("d:/ymir work/ui/public/scrollbar_thin_middle_button_03.sub")
+
+		upButton = Button()
+		upButton.SetParent(self)
+		upButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_thin_up_button_01.sub")
+		upButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_thin_up_button_02.sub")
+		upButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_thin_up_button_03.sub")
+		upButton.SetEvent(__mem_func__(self.OnUp))
+		upButton.Show()
+
+		downButton = Button()
+		downButton.SetParent(self)
+		downButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_thin_down_button_01.sub")
+		downButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_thin_down_button_02.sub")
+		downButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_thin_down_button_03.sub")
+		downButton.SetEvent(__mem_func__(self.OnDown))
+		downButton.Show()
+
+		self.middleBar = middleBar
+		self.upButton = upButton
+		self.downButton = downButton
+
+		self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
+		self.SCROLLBAR_MIDDLE_HEIGHT = self.middleBar.GetHeight()
+		self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
+		self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
+		self.MIDDLE_BAR_POS = 0
+		self.MIDDLE_BAR_UPPER_PLACE = 0
+		self.MIDDLE_BAR_DOWNER_PLACE = 0
+		self.TEMP_SPACE = 0
+
+	def UpdateBarSlot(self):
+		pass
+
+class SmallThinScrollBar(ScrollBar):
+
+	def CreateScrollBar(self):
+		middleBar = self.MiddleBar()
+		middleBar.SetParent(self)
+		middleBar.SetMoveEvent(__mem_func__(self.OnMove))
+		middleBar.Show()
+		middleBar.SetUpVisual("d:/ymir work/ui/public/scrollbar_small_thin_middle_button_01.sub")
+		middleBar.SetOverVisual("d:/ymir work/ui/public/scrollbar_small_thin_middle_button_01.sub")
+		middleBar.SetDownVisual("d:/ymir work/ui/public/scrollbar_small_thin_middle_button_01.sub")
+
+		upButton = Button()
+		upButton.SetParent(self)
+		upButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_small_thin_up_button_01.sub")
+		upButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_small_thin_up_button_02.sub")
+		upButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_small_thin_up_button_03.sub")
+		upButton.SetEvent(__mem_func__(self.OnUp))
+		upButton.Show()
+
+		downButton = Button()
+		downButton.SetParent(self)
+		downButton.SetUpVisual("d:/ymir work/ui/public/scrollbar_small_thin_down_button_01.sub")
+		downButton.SetOverVisual("d:/ymir work/ui/public/scrollbar_small_thin_down_button_02.sub")
+		downButton.SetDownVisual("d:/ymir work/ui/public/scrollbar_small_thin_down_button_03.sub")
+		downButton.SetEvent(__mem_func__(self.OnDown))
+		downButton.Show()
+
+		self.middleBar = middleBar
+		self.upButton = upButton
+		self.downButton = downButton
+
+		self.SCROLLBAR_WIDTH = self.upButton.GetWidth()
+		self.SCROLLBAR_MIDDLE_HEIGHT = self.middleBar.GetHeight()
+		self.SCROLLBAR_BUTTON_WIDTH = self.upButton.GetWidth()
+		self.SCROLLBAR_BUTTON_HEIGHT = self.upButton.GetHeight()
+		self.MIDDLE_BAR_POS = 0
+		self.MIDDLE_BAR_UPPER_PLACE = 0
+		self.MIDDLE_BAR_DOWNER_PLACE = 0
+		self.TEMP_SPACE = 0
+
+	def UpdateBarSlot(self):
+		pass
+
+class SliderBar(Window):
+
+	def __init__(self):
+		Window.__init__(self)
+
+		self.curPos = 1.0
+		self.pageSize = 1.0
+		self.eventChange = None
+
+		self.__CreateBackGroundImage()
+		self.__CreateCursor()
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def __CreateBackGroundImage(self):
+		img = ImageBox()
+		img.SetParent(self)
+		img.LoadImage("d:/ymir work/ui/game/windows/sliderbar.sub")
+		img.Show()
+		self.backGroundImage = img
+
+		##
+		self.SetSize(self.backGroundImage.GetWidth(), self.backGroundImage.GetHeight())
+
+	def __CreateCursor(self):
+		cursor = DragButton()
+		cursor.AddFlag("movable")
+		cursor.AddFlag("restrict_y")
+		cursor.SetParent(self)
+		cursor.SetMoveEvent(__mem_func__(self.__OnMove))
+		cursor.SetUpVisual("d:/ymir work/ui/game/windows/sliderbar_cursor.sub")
+		cursor.SetOverVisual("d:/ymir work/ui/game/windows/sliderbar_cursor.sub")
+		cursor.SetDownVisual("d:/ymir work/ui/game/windows/sliderbar_cursor.sub")
+		cursor.Show()
+		self.cursor = cursor
+
+		##
+		self.cursor.SetRestrictMovementArea(0, 0, self.backGroundImage.GetWidth(), 0)
+		self.pageSize = self.backGroundImage.GetWidth() - self.cursor.GetWidth()
+
+	def __OnMove(self):
+		(xLocal, yLocal) = self.cursor.GetLocalPosition()
+		self.curPos = float(xLocal) / float(self.pageSize)
+
+		if self.eventChange:
+			self.eventChange()
+
+	def SetSliderPos(self, pos):
+		self.curPos = pos
+		self.cursor.SetPosition(int(self.pageSize * pos), 0)
+
+	def GetSliderPos(self):
+		return self.curPos
+
+	def SetEvent(self, event):
+		self.eventChange = event
+
+	def Enable(self):
+		self.cursor.Show()
+
+	def Disable(self):
+		self.cursor.Hide()
+
+	if app.ENABLE_FOV_OPTION:
+		def SetBackgroundVisual(self, filename):
+			if self.backGroundImage:
+				self.backGroundImage.LoadImage(filename)
+
+				self.SetSize(self.backGroundImage.GetWidth(), self.backGroundImage.GetHeight())
+				self.pageSize = self.backGroundImage.GetWidth() - self.cursor.GetWidth()
+
+			if self.cursor:
+				self.cursor.SetRestrictMovementArea(0, 0, self.backGroundImage.GetWidth(), 0)
+
+		def SetButtonVisual(self, path, up, over, down):
+			if self.cursor:
+				self.cursor.SetUpVisual(path + up)
+				self.cursor.SetOverVisual(path + over)
+				self.cursor.SetDownVisual(path + down)
+
+class ListBox(Window):
+
+	TEMPORARY_PLACE = 3
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+		self.overLine = -1
+		self.selectedLine = -1
+		self.width = 0
+		self.height = 0
+		self.stepSize = 17
+		self.basePos = 0
+		self.showLineCount = 0
+		self.itemCenterAlign = True
+		self.itemIgnoreAlign = False
+		self.itemList = []
+		self.keyDict = {}
+		self.textDict = {}
+		self.event = lambda *arg: None
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def SetWidth(self, width):
+		self.SetSize(width, self.height)
+
+	def SetSize(self, width, height):
+		Window.SetSize(self, width, height)
+		self.width = width
+		self.height = height
+
+	def SetTextCenterAlign(self, flag):
+		self.itemCenterAlign = flag
+
+	def SetTextIgnoreAlign(self, flag):
+		self.itemIgnoreAlign = flag
+
+	def SetBasePos(self, pos):
+		self.basePos = pos
+		self._LocateItem()
+
+	def ClearItem(self):
+		self.keyDict = {}
+		self.textDict = {}
+		self.itemList = []
+		self.overLine = -1
+		self.selectedLine = -1
+
+	if app.ENABLE_CHANNEL_LIST:
+		def InsertItem(self, number, text, textColor = 0x00000000):
+			self.keyDict[len(self.itemList)] = number
+			self.textDict[len(self.itemList)] = text
+
+			textLine = TextLine()
+			textLine.SetParent(self)
+			textLine.SetText(text)
+			if textColor != 0x00000000:
+				textLine.SetPackedFontColor(textColor)
+			textLine.Show()
+
+			if self.itemCenterAlign:
+				textLine.SetWindowHorizontalAlignCenter()
+				textLine.SetHorizontalAlignCenter()
+
+			self.itemList.append(textLine)
+
+			self._LocateItem()
+	else:
+		def InsertItem(self, number, text):
+			self.keyDict[len(self.itemList)] = number
+			self.textDict[len(self.itemList)] = text
+
+			textLine = TextLine()
+			textLine.SetParent(self)
+			textLine.SetText(text)
+			textLine.Show()
+
+			if self.itemCenterAlign:
+				textLine.SetWindowHorizontalAlignCenter()
+				textLine.SetHorizontalAlignCenter()
+
+			self.itemList.append(textLine)
+
+			self._LocateItem()
+
+	def ChangeItem(self, number, text):
+		for key, value in self.keyDict.items():
+			if value == number:
+				self.textDict[key] = text
+
+				if number < len(self.itemList):
+					self.itemList[key].SetText(text)
+
+				return
+
+	def LocateItem(self):
+		self._LocateItem()
+
+	def _LocateItem(self):
+		skipCount = self.basePos
+		yPos = 0
+		self.showLineCount = 0
+
+		for textLine in self.itemList:
+			textLine.Hide()
+
+			if skipCount > 0:
+				skipCount -= 1
+				continue
+
+			if self.itemIgnoreAlign:
+				textLine.SetPosition(0, yPos + 3)
+			else:
+				if localeInfo.IsARABIC():
+					w, h = textLine.GetTextSize()
+					textLine.SetPosition(w + 10, yPos + 3)
+				else:
+					textLine.SetPosition(0, yPos + 3)
+
+			yPos += self.stepSize
+
+			if yPos <= self.GetHeight():
+				self.showLineCount += 1
+				textLine.Show()
+
+	def ArrangeItem(self):
+		self.SetSize(self.width, len(self.itemList) * self.stepSize)
+		self._LocateItem()
+
+	def GetViewItemCount(self):
+		return int(self.GetHeight() / self.stepSize)
+
+	def GetItemCount(self):
+		return len(self.itemList)
+
+	def SetEvent(self, event):
+		self.event = event
+
+	def SelectItem(self, line):
+		if not self.keyDict.has_key(line):
+			return
+
+		self.selectedLine = line
+		self.event(self.keyDict.get(line, 0), self.textDict.get(line, "None"))
+
+	def GetSelectedItem(self):
+		return self.keyDict.get(self.selectedLine, 0)
+
+	def OnMouseLeftButtonDown(self):
+		if self.overLine < 0:
+			return
+
+	def OnMouseLeftButtonUp(self):
+		if self.overLine >= 0:
+			self.SelectItem(self.overLine+self.basePos)
+
+	def OnUpdate(self):
+		# Avoid work for invisible widgets (many UI elements tick every frame)
+		if not self.IsShow():
+			return
+
+		self.overLine = -1
+
+		if self.IsIn():
+			x, y = self.GetGlobalPosition()
+			height = self.GetHeight()
+			xMouse, yMouse = wndMgr.GetMousePosition()
+
+			if yMouse - y < height - 1:
+				self.overLine = (yMouse - y) / self.stepSize
+
+				if self.overLine < 0:
+					self.overLine = -1
+				if self.overLine >= len(self.itemList):
+					self.overLine = -1
+
+	def OnRender(self):
+		xRender, yRender = self.GetGlobalPosition()
+		yRender -= self.TEMPORARY_PLACE
+		widthRender = self.width
+		heightRender = self.height + self.TEMPORARY_PLACE * 2
+
+		if localeInfo.IsCIBN10:
+			if -1 != self.overLine and self.keyDict[self.overLine] != -1:
+				grp.SetColor(HALF_WHITE_COLOR)
+				grp.RenderBar(xRender + 2, yRender + self.overLine*self.stepSize + 4, self.width - 3, self.stepSize)
+
+			if -1 != self.selectedLine and self.keyDict[self.selectedLine] != -1:
+				if self.selectedLine >= self.basePos:
+					if self.selectedLine - self.basePos < self.showLineCount:
+						grp.SetColor(SELECT_COLOR)
+						grp.RenderBar(xRender + 2, yRender + (self.selectedLine-self.basePos)*self.stepSize + 4, self.width - 3, self.stepSize)
+
+		else:
+			if -1 != self.overLine:
+				grp.SetColor(HALF_WHITE_COLOR)
+				grp.RenderBar(xRender + 2, yRender + self.overLine*self.stepSize + 4, self.width - 3, self.stepSize)
+
+			if -1 != self.selectedLine:
+				if self.selectedLine >= self.basePos:
+					if self.selectedLine - self.basePos < self.showLineCount:
+						grp.SetColor(SELECT_COLOR)
+						grp.RenderBar(xRender + 2, yRender + (self.selectedLine-self.basePos)*self.stepSize + 4, self.width - 3, self.stepSize)
+
+class ListBox2(ListBox):
+	def __init__(self, *args, **kwargs):
+		ListBox.__init__(self, *args, **kwargs)
+		self.rowCount = 10
+		self.barWidth = 0
+		self.colCount = 0
+
+	def SetRowCount(self, rowCount):
+		self.rowCount = rowCount
+
+	def SetSize(self, width, height):
+		ListBox.SetSize(self, width, height)
+		self._RefreshForm()
+
+	def ClearItem(self):
+		ListBox.ClearItem(self)
+		self._RefreshForm()
+
+	def InsertItem(self, *args, **kwargs):
+		ListBox.InsertItem(self, *args, **kwargs)
+		self._RefreshForm()
+
+	def OnUpdate(self):
+		if not self.IsShow():
+			return
+
+		mpos = wndMgr.GetMousePosition()
+		self.overLine = self._CalcPointIndex(mpos)
+
+	def OnRender(self):
+		x, y = self.GetGlobalPosition()
+		pos = (x + 2, y)
+
+		if -1 != self.overLine:
+			grp.SetColor(HALF_WHITE_COLOR)
+			self._RenderBar(pos, self.overLine)
+
+		if -1 != self.selectedLine:
+			if self.selectedLine >= self.basePos:
+				if self.selectedLine - self.basePos < self.showLineCount:
+					grp.SetColor(SELECT_COLOR)
+					self._RenderBar(pos, self.selectedLine-self.basePos)
+
+	def _CalcPointIndex(self, mpos):
+		if self.IsIn():
+			px, py = mpos
+			gx, gy = self.GetGlobalPosition()
+			lx, ly = px - gx, py - gy
+
+			col = lx / self.barWidth
+			row = ly / self.stepSize
+			idx = col * self.rowCount + row
+			if col >= 0 and col < self.colCount:
+				if row >= 0 and row < self.rowCount:
+					if idx >= 0 and idx < len(self.itemList):
+						return idx
+
+		return -1
+
+	def _CalcRenderPos(self, pos, idx):
+		x, y = pos
+		row = idx % self.rowCount
+		col = idx / self.rowCount
+		return (x + col * self.barWidth, y + row * self.stepSize)
+
+	def _RenderBar(self, basePos, idx):
+		x, y = self._CalcRenderPos(basePos, idx)
+		grp.RenderBar(x, y, self.barWidth - 3, self.stepSize)
+
+	def _LocateItem(self):
+		pos = (0, self.TEMPORARY_PLACE)
+
+		self.showLineCount = 0
+		for textLine in self.itemList:
+			x, y = self._CalcRenderPos(pos, self.showLineCount)
+			textLine.SetPosition(x, y)
+			textLine.Show()
+
+			self.showLineCount += 1
+
+	def _RefreshForm(self):
+		if len(self.itemList) % self.rowCount:
+			self.colCount = len(self.itemList) / self.rowCount + 1
+		else:
+			self.colCount = len(self.itemList) / self.rowCount
+
+		if self.colCount:
+			self.barWidth = self.width / self.colCount
+		else:
+			self.barWidth = self.width
+
+class ComboBoxImage(Window):
+	class ListBoxWithBoard(ListBox):
+		def __init__(self, layer):
+			ListBox.__init__(self, layer)
+			self.SetTextIgnoreAlign(True)
+
+		def OnRender(self):
+			xRender, yRender = self.GetGlobalPosition()
+			yRender -= self.TEMPORARY_PLACE
+
+			widthRender = self.width
+			heightRender = self.height + self.TEMPORARY_PLACE * 2
+
+			grp.SetColor(BACKGROUND_COLOR)
+			grp.RenderBar(xRender, yRender, widthRender, heightRender)
+			grp.SetColor(DARK_COLOR)
+			grp.RenderLine(xRender, yRender, widthRender, 0)
+			grp.RenderLine(xRender, yRender, 0, heightRender)
+
+			ListBox.OnRender(self)
+
+	def __init__(self, parent, name, x ,y):
+		Window.__init__(self)
+		self.isSelected = False
+		self.isOver = False
+		self.isListOpened = False
+		self.event = lambda *arg: None
+		self.enable = True
+		self.imagebox = None
+
+		## imagebox
+		image = ImageBox()
+		image.SetParent(parent)
+		image.LoadImage(name)
+		image.SetPosition(x, y)
+		image.Show()
+		self.imagebox = image
+
+		## BaseSetting
+		self.x = x + 1
+		self.y = y + 1
+		self.width = self.imagebox.GetWidth() - 3
+		self.height = self.imagebox.GetHeight() - 3
+		self.SetParent(parent)
+
+		## TextLine
+		self.textLine = MakeTextLine(self)
+		self.textLine.SetText(localeInfo.UI_ITEM)
+
+		## ListBox
+		self.listBox = self.ListBoxWithBoard("TOP_MOST")
+		self.listBox.SetPickAlways()
+		self.listBox.SetParent(self)
+		self.listBox.SetEvent(__mem_func__(self.OnSelectItem))
+		self.listBox.Hide()
+
+		Window.SetPosition(self, self.x, self.y)
+		Window.SetSize(self, self.width, self.height)
+		self.textLine.UpdateRect()
+		self.__ArrangeListBox()
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def Destroy(self):
+		self.textLine = None
+		self.listBox = None
+		self.imagebox = None
+
+	def SetPosition(self, x, y):
+		Window.SetPosition(self, x, y)
+		self.imagebox.SetPosition(x, y)
+		self.x = x
+		self.y = y
+		self.__ArrangeListBox()
+
+	def SetSize(self, width, height):
+		Window.SetSize(self, width, height)
+		self.width = width
+		self.height = height
+		self.textLine.UpdateRect()
+		self.__ArrangeListBox()
+
+	def __ArrangeListBox(self):
+		self.listBox.SetPosition(0, self.height + 5)
+		self.listBox.SetWidth(self.width)
+
+	def Enable(self):
+		self.enable = True
+
+	def Disable(self):
+		self.enable = False
+		self.textLine.SetText("")
+		self.CloseListBox()
+
+	def SetEvent(self, event):
+		self.event = event
+
+	def ClearItem(self):
+		self.CloseListBox()
+		self.listBox.ClearItem()
+
+	def InsertItem(self, index, name):
+		self.listBox.InsertItem(index, name)
+		self.listBox.ArrangeItem()
+
+	def SetCurrentItem(self, text):
+		self.textLine.SetText(text)
+
+	def SelectItem(self, key):
+		self.listBox.SelectItem(key)
+
+	def OnSelectItem(self, index, name):
+		self.CloseListBox()
+		self.event(index)
+
+	def CloseListBox(self):
+		self.isListOpened = False
+		self.listBox.Hide()
+
+	def OnMouseLeftButtonDown(self):
+		if not self.enable:
+			return
+
+		self.isSelected = True
+
+	def OnMouseLeftButtonUp(self):
+		self.ToggleOpenCloseListBox()
+
+	def OnUpdate(self):
+		if not self.IsShow():
+			return
+
+		if not self.enable:
+			return
+
+		if self.IsIn():
+			self.isOver = True
+		else:
+			self.isOver = False
+
+	def OnRender(self):
+		self.x, self.y = self.GetGlobalPosition()
+		xRender = self.x
+		yRender = self.y
+		widthRender = self.width
+		heightRender = self.height
+		if self.isOver:
+			grp.SetColor(HALF_WHITE_COLOR)
+			grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
+			if self.isSelected:
+				grp.SetColor(WHITE_COLOR)
+				grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
+
+	def OpenListBox(self):
+		self.isListOpened = True
+		self.listBox.Show()
+
+		self.__ArrangeListBox()
+
+	def ToggleOpenCloseListBox(self):
+		if not self.enable:
+			return
+
+		self.isSelected = False
+
+		if self.isListOpened:
+			self.CloseListBox()
+		else:
+			if self.listBox.GetItemCount() > 0:
+				self.isListOpened = True
+				self.listBox.Show()
+				self.__ArrangeListBox()
+
+class ComboBox(Window):
+
+	class ListBoxWithBoard(ListBox):
+
+		def __init__(self, layer):
+			ListBox.__init__(self, layer)
+
+		def OnRender(self):
+			xRender, yRender = self.GetGlobalPosition()
+			yRender -= self.TEMPORARY_PLACE
+			widthRender = self.width
+			heightRender = self.height + self.TEMPORARY_PLACE*2
+			grp.SetColor(BACKGROUND_COLOR)
+			grp.RenderBar(xRender, yRender, widthRender, heightRender)
+			grp.SetColor(DARK_COLOR)
+			grp.RenderLine(xRender, yRender, widthRender, 0)
+			grp.RenderLine(xRender, yRender, 0, heightRender)
+			grp.SetColor(BRIGHT_COLOR)
+			grp.RenderLine(xRender, yRender+heightRender, widthRender, 0)
+			grp.RenderLine(xRender+widthRender, yRender, 0, heightRender)
+
+			ListBox.OnRender(self)
+
+	def __init__(self):
+		Window.__init__(self)
+		self.x = 0
+		self.y = 0
+		self.width = 0
+		self.height = 0
+		self.isSelected = False
+		self.isOver = False
+		self.isListOpened = False
+		self.event = lambda *arg: None
+		self.enable = True
+
+		self.textLine = MakeTextLine(self)
+		self.textLine.SetText(localeInfo.UI_ITEM)
+
+		self.listBox = self.ListBoxWithBoard("TOP_MOST")
+		self.listBox.SetPickAlways()
+		self.listBox.SetParent(self)
+		self.listBox.SetEvent(__mem_func__(self.OnSelectItem))
+		self.listBox.Hide()
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def Destroy(self):
+		self.textLine = None
+		self.listBox = None
+
+	def SetPosition(self, x, y):
+		Window.SetPosition(self, x, y)
+		self.x = x
+		self.y = y
+		self.__ArrangeListBox()
+
+	def SetSize(self, width, height):
+		Window.SetSize(self, width, height)
+		self.width = width
+		self.height = height
+		self.textLine.UpdateRect()
+		self.__ArrangeListBox()
+
+	def __ArrangeListBox(self):
+		self.listBox.SetPosition(0, self.height + 5)
+		self.listBox.SetWidth(self.width)
+
+	def Enable(self):
+		self.enable = True
+
+	def Disable(self):
+		self.enable = False
+		self.textLine.SetText("")
+		self.CloseListBox()
+
+	def SetEvent(self, event):
+		self.event = event
+
+	def ClearItem(self):
+		self.CloseListBox()
+		self.listBox.ClearItem()
+
+	def InsertItem(self, index, name):
+		self.listBox.InsertItem(index, name)
+		self.listBox.ArrangeItem()
+
+	def SetCurrentItem(self, text):
+		self.textLine.SetText(text)
+
+	def SelectItem(self, key):
+		self.listBox.SelectItem(key)
+
+	def OnSelectItem(self, index, name):
+		self.CloseListBox()
+		self.event(index)
+
+	def CloseListBox(self):
+		self.isListOpened = False
+		self.listBox.Hide()
+
+	def OnMouseLeftButtonDown(self):
+		if not self.enable:
+			return
+
+		self.isSelected = True
+
+	def OnMouseLeftButtonUp(self):
+		if not self.enable:
+			return
+
+		self.isSelected = False
+
+		if self.isListOpened:
+			self.CloseListBox()
+		else:
+			if self.listBox.GetItemCount() > 0:
+				self.isListOpened = True
+				self.listBox.Show()
+				self.__ArrangeListBox()
+
+	def OnUpdate(self):
+		if not self.IsShow():
+			return
+
+		if not self.enable:
+			return
+
+		if self.IsIn():
+			self.isOver = True
+		else:
+			self.isOver = False
+
+	def OnRender(self):
+		self.x, self.y = self.GetGlobalPosition()
+		xRender = self.x
+		yRender = self.y
+		widthRender = self.width
+		heightRender = self.height
+		grp.SetColor(BACKGROUND_COLOR)
+		grp.RenderBar(xRender, yRender, widthRender, heightRender)
+		grp.SetColor(DARK_COLOR)
+		grp.RenderLine(xRender, yRender, widthRender, 0)
+		grp.RenderLine(xRender, yRender, 0, heightRender)
+		grp.SetColor(BRIGHT_COLOR)
+		grp.RenderLine(xRender, yRender+heightRender, widthRender, 0)
+		grp.RenderLine(xRender+widthRender, yRender, 0, heightRender)
+
+		if self.isOver:
+			grp.SetColor(HALF_WHITE_COLOR)
+			grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
+
+			if self.isSelected:
+				grp.SetColor(WHITE_COLOR)
+				grp.RenderBar(xRender + 2, yRender + 3, self.width - 3, heightRender - 5)
+
+class RenderTarget(Window):
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+		
+		self.number = -1
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterRenderTarget(self, layer)
+		
+	def SetRenderTarget(self, number):
+		self.number = number
+		wndMgr.SetRenderTarget(self.hWnd, self.number)
+
+###################################################################################################
+## Python Script Loader
+###################################################################################################
+
+class ScriptWindow(Window):
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+		self.Children = []
+		self.ElementDictionary = {}
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def ClearDictionary(self):
+		self.Children = []
+		self.ElementDictionary = {}
+
+	def InsertChild(self, name, child):
+		self.ElementDictionary[name] = child
+
+	def IsChild(self, name):
+		return self.ElementDictionary.has_key(name)
+
+	def GetChild(self, name):
+		return self.ElementDictionary[name]
+
+	def GetChild2(self, name):
+		return self.ElementDictionary.get(name, None)
+
+class PythonScriptLoader(object):
+
+	BODY_KEY_LIST = ( "x", "y", "width", "height" )
+
+	#####
+
+	DEFAULT_KEY_LIST = ( "type", "x", "y", )
+	WINDOW_KEY_LIST = ( "width", "height", )
+	IMAGE_KEY_LIST = ( "image", )
+	EXPANDED_IMAGE_KEY_LIST = ( "image", )
+	ANI_IMAGE_KEY_LIST = ( "images", )
+	SLOT_KEY_LIST = ( "width", "height", "slot", )
+	CANDIDATE_LIST_KEY_LIST = ( "item_step", "item_xsize", "item_ysize", )
+	GRID_TABLE_KEY_LIST = ( "start_index", "x_count", "y_count", "x_step", "y_step", )
+	EDIT_LINE_KEY_LIST = ( "width", "height", "input_limit", )
+	COMBO_BOX_KEY_LIST = ( "width", "height", "item", )
+	TITLE_BAR_KEY_LIST = ( "width", )
+	HORIZONTAL_BAR_KEY_LIST = ( "width", )
+	BOARD_KEY_LIST = ( "width", "height", )
+	BOARD_WITH_TITLEBAR_KEY_LIST = ( "width", "height", "title", )
+	BOX_KEY_LIST = ( "width", "height", )
+	BAR_KEY_LIST = ( "width", "height", )
+	LINE_KEY_LIST = ( "width", "height", )
+	SLOTBAR_KEY_LIST = ( "width", "height", )
+	GAUGE_KEY_LIST = ( "width", "color", )
+	SCROLLBAR_KEY_LIST = ( "size", )
+	LIST_BOX_KEY_LIST = ( "width", "height", )
+	OUTLINE_WINDOW_KEY_LIST = ( "width", "height", )
+
+	if app.RENDER_TARGET:
+		RENDER_TARGET_KEY_LIST = ( "index", )
+
+	# app.ENABLE_FISH_EVENT
+	SP_GRID_TABLE_KEY_LIST = ( "start_index", "x_count", "y_count", "x_step", "y_step", )
+
+	if app.ENABLE_MAILBOX:
+		RENDER_BOX_KEY_LIST = ( "color", )
+
+	CIRCLE_KEY_LIST = ( "radius", "color", )
+
+	def __init__(self):
+		self.Clear()
+
+	def Clear(self):
+		self.ScriptDictionary = { "SCREEN_WIDTH" : wndMgr.GetScreenWidth(), "SCREEN_HEIGHT" : wndMgr.GetScreenHeight() }
+		self.InsertFunction = 0
+
+	def LoadScriptFile(self, window, FileName):
+		import exception
+		import exceptions
+		import os
+		import errno
+		self.Clear()
+
+		#print "===== Load Script File : %s" % (FileName)
+
+		# Security hardening:
+		# UI definitions are executed via execfile(). FileName must never be absolute,
+		# contain drive letters, or allow traversal. Only allow packed UI paths.
+		if not isinstance(FileName, str):
+			exception.Abort("LoadScriptFile: invalid filename type")
+
+		# normalize separators early (Windows/backslashes)
+		_safeName = FileName.replace("\\", "/")
+
+		# basic length sanity
+		if len(_safeName) == 0 or len(_safeName) > 260:
+			exception.Abort("LoadScriptFile: invalid filename length")
+
+		# reject absolute paths / drive letters / home paths
+		if ":" in _safeName or _safeName.startswith("/") or _safeName.startswith("~"):
+			exception.Abort("LoadScriptFile: invalid filename path")
+
+		# normalize and block traversal
+		_norm = os.path.normpath(_safeName).replace("\\", "/")
+		if _norm == ".." or _norm.startswith("../") or "/../" in ("/" + _norm + "/"):
+			exception.Abort("LoadScriptFile: path traversal blocked")
+
+		# allow only standard UI script roots
+		_low = _norm.lower()
+		if not (_low.startswith("uiscript/") or _low.startswith("locale/")):
+			exception.Abort("LoadScriptFile: blocked script root")
+
+		# use normalized safe path
+		FileName = _norm
+
+		#ui ì½ëë sandbox ë´ìì ì¤íëì´ì¼íë¤.(ë´ì´ ê½í ì¬ì§ê° ìê¸° ëë¬¸ì)
+		#import sys
+		#from utils import Sandbox
+		#sandbox = Sandbox(True, ["uiScriptLocale", "localeInfo", "sys", "item", "app"])
+
+		# chr, player  sandbox  import  Ê± ,( Ç¿  Å¿ Å­.)
+		#  Ì¸ script dictionary Ê¿  Ö¾Â´.
+		import chr
+		import player
+		import app
+		self.ScriptDictionary["PLAYER_NAME_MAX_LEN"] = chr.PLAYER_NAME_MAX_LEN
+		if app.ENABLE_DRAGON_SOUL_SYSTEM:
+			self.ScriptDictionary["DRAGON_SOUL_EQUIPMENT_SLOT_START"] = player.DRAGON_SOUL_EQUIPMENT_SLOT_START
+		self.ScriptDictionary["LOCALE_PATH"] = app.GetLocalePath()
+
+		try:
+			#sandbox.execfile(FileName, self.ScriptDictionary)
+			execfile(FileName, self.ScriptDictionary)
+		except IOError, err:
+			import sys
+			import dbg
+			dbg.TraceError("Failed to load script file : %s" % (FileName))
+			dbg.TraceError("error : %s" % (err))
+			exception.Abort("LoadScriptFile1")
+		except RuntimeError,err:
+			import sys
+			import dbg
+			dbg.TraceError("Failed to load script file : %s" % (FileName))
+			dbg.TraceError("error : %s" % (err))
+			exception.Abort("LoadScriptFile2")
+		except:
+			import sys
+			import dbg
+			dbg.TraceError("Failed to load script file : %s" % (FileName))
+			exception.Abort("LoadScriptFile!!!!!!!!!!!!!!")
+
+		#####
+
+		Body = self.ScriptDictionary["window"]
+		self.CheckKeyList("window", Body, self.BODY_KEY_LIST)
+
+		window.ClearDictionary()
+		self.InsertFunction = window.InsertChild
+
+		window.SetPosition(int(Body["x"]), int(Body["y"]))
+
+		if localeInfo.IsARABIC():
+			w = wndMgr.GetScreenWidth()
+			h = wndMgr.GetScreenHeight()
+			if Body.has_key("width"):
+				w = int(Body["width"])
+			if Body.has_key("height"):
+				h = int(Body["height"])
+
+			window.SetSize(w, h)
+		else:
+			window.SetSize(int(Body["width"]), int(Body["height"]))
+			if True == Body.has_key("style"):
+				for StyleList in Body["style"]:
+					window.AddFlag(StyleList)
+
+		self.LoadChildren(window, Body)
+
+	def LoadChildren(self, parent, dicChildren):
+
+		if localeInfo.IsARABIC():
+			parent.AddFlag( "rtl" )
+
+		if True == dicChildren.has_key("style"):
+			for style in dicChildren["style"]:
+				parent.AddFlag(style)
+
+		if False == dicChildren.has_key("children"):
+			return False
+
+		Index = 0
+
+		ChildrenList = dicChildren["children"]
+		parent.Children = range(len(ChildrenList))
+		for ElementValue in ChildrenList:
+			try:
+				Name = ElementValue["name"]
+			except KeyError:
+				Name = ElementValue["name"] = "NONAME"
+
+			try:
+				Type = ElementValue["type"]
+			except KeyError:
+				Type = ElementValue["type"] = "window"
+
+			if False == self.CheckKeyList(Name, ElementValue, self.DEFAULT_KEY_LIST):
+				del parent.Children[Index]
+				continue
+
+			if Type == "window":
+				parent.Children[Index] = ScriptWindow()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementWindow(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "outline_window":
+				parent.Children[Index] = OutlineWindow()
+				parent.Children[Index].SetParent(parent)
+				self.LoadOutlineWindow(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "button":
+				parent.Children[Index] = Button()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementButton(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "radio_button":
+				parent.Children[Index] = RadioButton()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementButton(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "toggle_button":
+				parent.Children[Index] = ToggleButton()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementButton(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "mark":
+				parent.Children[Index] = MarkBox()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementMark(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "image":
+				parent.Children[Index] = ImageBox()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementImage(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "expanded_image":
+				parent.Children[Index] = ExpandedImageBox()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementExpandedImage(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "ani_image":
+				parent.Children[Index] = AniImageBox()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementAniImage(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "slot":
+				parent.Children[Index] = SlotWindow()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementSlot(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "candidate_list":
+				parent.Children[Index] = CandidateListBox()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementCandidateList(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "grid_table":
+				parent.Children[Index] = GridSlotWindow()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementGridTable(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "text":
+				parent.Children[Index] = TextLine()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementText(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "editline":
+				parent.Children[Index] = EditLine()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementEditLine(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "titlebar":
+				parent.Children[Index] = TitleBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementTitleBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "horizontalbar":
+				parent.Children[Index] = HorizontalBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementHorizontalBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "board":
+				parent.Children[Index] = Board()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementBoard(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "middleboard":
+				parent.Children[Index] = MiddleBoard()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementBoard(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "board_with_titlebar":
+				parent.Children[Index] = BoardWithTitleBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementBoardWithTitleBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "border_a":
+				parent.Children[Index] = BorderA()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementBorderA(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "thinboard":
+				parent.Children[Index] = ThinBoard()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "thinboard_gold":
+				parent.Children[Index] = ThinBoardGold()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "thinboard_circle":
+				parent.Children[Index] = ThinBoardCircle()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "box":
+				parent.Children[Index] = Box()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementBox(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "bar":
+				parent.Children[Index] = Bar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "line":
+				parent.Children[Index] = Line()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementLine(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "slotbar":
+				parent.Children[Index] = SlotBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementSlotBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "gauge":
+				parent.Children[Index] = Gauge()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementGauge(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "scrollbar":
+				parent.Children[Index] = ScrollBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementScrollBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "thin_scrollbar":
+				parent.Children[Index] = ThinScrollBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementScrollBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "small_thin_scrollbar":
+				parent.Children[Index] = SmallThinScrollBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementScrollBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "sliderbar":
+				parent.Children[Index] = SliderBar()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementSliderBar(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "listbox":
+				parent.Children[Index] = ListBox()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementListBox(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "listbox2":
+				parent.Children[Index] = ListBox2()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementListBox2(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "listboxex":
+				parent.Children[Index] = ListBoxEx()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementListBoxEx(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "numberline":
+				parent.Children[Index] = NumberLine()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementNumberLine(parent.Children[Index], ElementValue, parent)
+
+			elif app.RENDER_TARGET and Type == "render_target":
+				parent.Children[Index] = RenderTarget()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementRenderTarget(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "middleboard" and app.ENABLE_LOADING_TIP:
+				parent.Children[Index] = ThinBoard()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementThinBoard(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "renderbox":
+				if app.ENABLE_MAILBOX:
+					parent.Children[Index] = RenderBox()
+					parent.Children[Index].SetParent(parent)
+					self.LoadElementRenderBox(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "circle":
+				parent.Children[Index] = Circle()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementCircle(parent.Children[Index], ElementValue, parent)
+
+			elif Type == "render_target":
+				parent.Children[Index] = RenderTarget()
+				parent.Children[Index].SetParent(parent)
+				self.LoadElementRenderTarget(parent.Children[Index], ElementValue, parent)
+
+			else:
+				Index += 1
+				continue
+
+			parent.Children[Index].SetWindowName(Name)
+			if 0 != self.InsertFunction:
+				self.InsertFunction(Name, parent.Children[Index])
+
+			self.LoadChildren(parent.Children[Index], ElementValue)
+			Index += 1
+
+	def CheckKeyList(self, name, value, key_list):
+
+		for DataKey in key_list:
+			if False == value.has_key(DataKey):
+				print("Failed to find data key", "[" + name + "/" + DataKey + "]")
+				return False
+
+		return True
+
+	def LoadDefaultData(self, window, value, parentWindow):
+		loc_x = int(value["x"])
+		loc_y = int(value["y"])
+		if value.has_key("vertical_align"):
+			if "center" == value["vertical_align"]:
+				window.SetWindowVerticalAlignCenter()
+			elif "bottom" == value["vertical_align"]:
+				window.SetWindowVerticalAlignBottom()
+
+		if parentWindow.IsRTL():
+			loc_x = int(value["x"]) + window.GetWidth()
+			if value.has_key("horizontal_align"):
+				if "center" == value["horizontal_align"]:
+					window.SetWindowHorizontalAlignCenter()
+					loc_x = - int(value["x"])
+				elif "right" == value["horizontal_align"]:
+					window.SetWindowHorizontalAlignLeft()
+					loc_x = int(value["x"]) - window.GetWidth()
+					## loc_x = parentWindow.GetWidth() - int(value["x"]) + window.GetWidth()
+			else:
+				window.SetWindowHorizontalAlignRight()
+
+			if value.has_key("all_align"):
+				window.SetWindowVerticalAlignCenter()
+				window.SetWindowHorizontalAlignCenter()
+				loc_x = - int(value["x"])
+		else:
+			if value.has_key("horizontal_align"):
+				if "center" == value["horizontal_align"]:
+					window.SetWindowHorizontalAlignCenter()
+				elif "right" == value["horizontal_align"]:
+					window.SetWindowHorizontalAlignRight()
+
+		window.SetPosition(loc_x, loc_y)
+		window.Show()
+
+	## Window
+	def LoadElementWindow(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.WINDOW_KEY_LIST):
+			return False
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Outline Window
+	def LoadOutlineWindow(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.OUTLINE_WINDOW_KEY_LIST):
+			return False
+
+		window.MakeOutlineWindow(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Button
+	def LoadElementButton(self, window, value, parentWindow):
+		if value.has_key("width") and value.has_key("height"):
+			window.SetSize(int(value["width"]), int(value["height"]))
+
+		if True == value.has_key("default_image"):
+			window.SetUpVisual(value["default_image"])
+		if True == value.has_key("over_image"):
+			window.SetOverVisual(value["over_image"])
+		if True == value.has_key("down_image"):
+			window.SetDownVisual(value["down_image"])
+		if True == value.has_key("disable_image"):
+			window.SetDisableVisual(value["disable_image"])
+
+		if True == value.has_key("text"):
+			if True == value.has_key("fontsize"):
+				fontSize = value["fontsize"]
+
+				if "LARGE" == fontSize:
+					window.AppendTextLine(value["text"], localeInfo.UI_DEF_FONT_LARGE)
+				elif "SMALL" == fontSize:
+					window.AppendTextLine(value["text"], localeInfo.UI_DEF_FONT_SMALL)
+				else:
+					window.AppendTextLine(value["text"])
+			else:
+				if True == value.has_key("text_height"):
+					window.SetText(value["text"], value["text_height"])
+				else:
+					window.SetText(value["text"])
+
+			if value.has_key("text_color"):
+				window.SetTextColor(value["text_color"])
+
+		if True == value.has_key("tooltip_text"):
+			if True == value.has_key("tooltip_x") and True == value.has_key("tooltip_y"):
+				window.SetToolTipText(value["tooltip_text"], int(value["tooltip_x"]), int(value["tooltip_y"]))
+			else:
+				window.SetToolTipText(value["tooltip_text"])
+
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Mark
+	def LoadElementMark(self, window, value, parentWindow):
+
+		#if False == self.CheckKeyList(value["name"], value, self.MARK_KEY_LIST):
+		#	return False
+
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Image
+	def LoadElementImage(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.IMAGE_KEY_LIST):
+			return False
+
+		window.LoadImage(value["image"])
+
+		if value.has_key("arabic_reverse"):
+			if value["arabic_reverse"]:
+				window.LeftRightReverse()
+
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## AniImage
+	def LoadElementAniImage(self, window, value, parentWindow):
+		if False == self.CheckKeyList(value["name"], value, self.ANI_IMAGE_KEY_LIST):
+			return False
+
+		if True == value.has_key("delay"):
+			window.SetDelay(value["delay"])
+
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
+				for image in value["images"]:
+					window.AppendImageScale(image, float(value["x_scale"]), float(value["y_scale"]))
+			else:
+				for image in value["images"]:
+					window.AppendImage(image)
+		else:
+			for image in value["images"]:
+				window.AppendImage(image)
+
+		if value.has_key("width") and value.has_key("height"):
+			window.SetSize(value["width"], value["height"])
+
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
+				window.SetScale(float(value["x_scale"]), float(value["y_scale"]))
+
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Expanded Image
+	def LoadElementExpandedImage(self, window, value, parentWindow):
+		if False == self.CheckKeyList(value["name"], value, self.EXPANDED_IMAGE_KEY_LIST):
+			return False
+
+		window.LoadImage(value["image"])
+
+		if True == value.has_key("x_origin") and True == value.has_key("y_origin"):
+			window.SetOrigin(float(value["x_origin"]), float(value["y_origin"]))
+
+		if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
+			window.SetScale(float(value["x_scale"]), float(value["y_scale"]))
+
+		if True == value.has_key("rect"):
+			RenderingRect = value["rect"]
+			window.SetRenderingRect(RenderingRect[0], RenderingRect[1], RenderingRect[2], RenderingRect[3])
+
+		if True == value.has_key("mode"):
+			mode = value["mode"]
+			if "MODULATE" == mode:
+				window.SetRenderingMode(wndMgr.RENDERING_MODE_MODULATE)
+
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Slot
+	def LoadElementSlot(self, window, value, parentWindow):
+		if False == self.CheckKeyList(value["name"], value, self.SLOT_KEY_LIST):
+			return False
+
+		global_x = int(value["x"])
+		global_y = int(value["y"])
+		global_width = int(value["width"])
+		global_height = int(value["height"])
+
+		window.SetPosition(global_x, global_y)
+		window.SetSize(global_width, global_height)
+		window.Show()
+
+		r = 1.0
+		g = 1.0
+		b = 1.0
+		a = 1.0
+
+		if True == value.has_key("image_r") and \
+			True == value.has_key("image_g") and \
+			True == value.has_key("image_b") and \
+			True == value.has_key("image_a"):
+			r = float(value["image_r"])
+			g = float(value["image_g"])
+			b = float(value["image_b"])
+			a = float(value["image_a"])
+
+		SLOT_ONE_KEY_LIST = ("index", "x", "y", "width", "height")
+
+		for slot in value["slot"]:
+			if True == self.CheckKeyList(value["name"] + " - one", slot, SLOT_ONE_KEY_LIST):
+				wndMgr.AppendSlot(window.hWnd,
+									int(slot["index"]),
+									int(slot["x"]),
+									int(slot["y"]),
+									int(slot["width"]),
+									int(slot["height"]))
+
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
+				window.SetSlotScale(float(value["x_scale"]), float(value["y_scale"]))
+
+		if app.ENABLE_SLOT_SCALE:
+			if True == value.has_key("x_scale") and True == value.has_key("y_scale"):
+				window.SetSlotScale(float(value["x_scale"]), float(value["y_scale"]))
+
+		if True == value.has_key("image"):
+			wndMgr.SetSlotBaseImage(window.hWnd,
+									value["image"],
+									r, g, b, a)
+
+		return True
+
+	def LoadElementCandidateList(self, window, value, parentWindow):
+		if False == self.CheckKeyList(value["name"], value, self.CANDIDATE_LIST_KEY_LIST):
+			return False
+
+		window.SetPosition(int(value["x"]), int(value["y"]))
+		window.SetItemSize(int(value["item_xsize"]), int(value["item_ysize"]))
+		window.SetItemStep(int(value["item_step"]))
+		window.Show()
+
+		return True
+
+	## Table
+	def LoadElementGridTable(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.GRID_TABLE_KEY_LIST):
+			return False
+
+		xBlank = 0
+		yBlank = 0
+		if True == value.has_key("x_blank"):
+			xBlank = int(value["x_blank"])
+		if True == value.has_key("y_blank"):
+			yBlank = int(value["y_blank"])
+
+		if localeInfo.IsARABIC():
+			pass
+		else:
+			window.SetPosition(int(value["x"]), int(value["y"]))
+
+		window.ArrangeSlot(	int(value["start_index"]),
+							int(value["x_count"]),
+							int(value["y_count"]),
+							int(value["x_step"]),
+							int(value["y_step"]),
+							xBlank,
+							yBlank)
+		if True == value.has_key("image"):
+			r = 1.0
+			g = 1.0
+			b = 1.0
+			a = 1.0
+			if True == value.has_key("image_r") and \
+				True == value.has_key("image_g") and \
+				True == value.has_key("image_b") and \
+				True == value.has_key("image_a"):
+				r = float(value["image_r"])
+				g = float(value["image_g"])
+				b = float(value["image_b"])
+				a = float(value["image_a"])
+			wndMgr.SetSlotBaseImage(window.hWnd, value["image"], r, g, b, a)
+
+		if True == value.has_key("style"):
+			if "select" == value["style"]:
+				wndMgr.SetSlotStyle(window.hWnd, wndMgr.SLOT_STYLE_SELECT)
+		if localeInfo.IsARABIC():
+			self.LoadDefaultData(window, value, parentWindow)
+		else:
+			window.Show()
+
+		return True
+
+	## Text
+	def LoadElementText(self, window, value, parentWindow):
+		if value.has_key("multi_line"):
+			if value["multi_line"]:
+				window.SetMultiLine()
+
+		if value.has_key("fontsize"):
+			fontSize = value["fontsize"]
+
+			if "LARGE" == fontSize:
+				window.SetFontName(localeInfo.UI_DEF_FONT_LARGE)
+
+		elif value.has_key("fontname"):
+			fontName = value["fontname"]
+			window.SetFontName(fontName)
+
+		if value.has_key("text_horizontal_align"):
+			if "left" == value["text_horizontal_align"]:
+				window.SetHorizontalAlignLeft()
+			elif "center" == value["text_horizontal_align"]:
+				window.SetHorizontalAlignCenter()
+			elif "right" == value["text_horizontal_align"]:
+				window.SetHorizontalAlignRight()
+
+		if value.has_key("text_vertical_align"):
+			if "top" == value["text_vertical_align"]:
+				window.SetVerticalAlignTop()
+			elif "center" == value["text_vertical_align"]:
+				window.SetVerticalAlignCenter()
+			elif "bottom" == value["text_vertical_align"]:
+				window.SetVerticalAlignBottom()
+
+		if value.has_key("all_align"):
+			window.SetHorizontalAlignCenter()
+			window.SetVerticalAlignCenter()
+			window.SetWindowHorizontalAlignCenter()
+			window.SetWindowVerticalAlignCenter()
+
+		if value.has_key("r") and value.has_key("g") and value.has_key("b"):
+			window.SetFontColor(float(value["r"]), float(value["g"]), float(value["b"]))
+		elif value.has_key("color"):
+			window.SetPackedFontColor(value["color"])
+		else:
+			window.SetFontColor(0.8549, 0.8549, 0.8549)
+
+		if value.has_key("outline"):
+			if value["outline"]:
+				window.SetOutline()
+		if True == value.has_key("text"):
+			window.SetText(value["text"])
+
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## EditLine
+	def LoadElementEditLine(self, window, value, parentWindow):
+		if False == self.CheckKeyList(value["name"], value, self.EDIT_LINE_KEY_LIST):
+			return False
+
+		if value.has_key("secret_flag"):
+			window.SetSecret(value["secret_flag"])
+		if value.has_key("with_codepage"):
+			if value["with_codepage"]:
+				window.bCodePage = True
+		if value.has_key("only_number"):
+			if value["only_number"]:
+				window.SetNumberMode()
+		if value.has_key("enable_codepage"):
+			window.SetIMEFlag(value["enable_codepage"])
+		if value.has_key("enable_ime"):
+			window.SetIMEFlag(value["enable_ime"])
+		if value.has_key("limit_width"):
+			window.SetLimitWidth(value["limit_width"])
+		if value.has_key("multi_line"):
+			if value["multi_line"]:
+				window.SetMultiLine()
+
+		window.SetMax(int(value["input_limit"]))
+		window.SetSize(int(value["width"]), int(value["height"]))
+
+		self.LoadElementText(window, value, parentWindow)
+
+		return True
+
+	## TitleBar
+	def LoadElementTitleBar(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.TITLE_BAR_KEY_LIST):
+			return False
+
+		window.MakeTitleBar(int(value["width"]), value.get("color", "red"))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## HorizontalBar
+	def LoadElementHorizontalBar(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.HORIZONTAL_BAR_KEY_LIST):
+			return False
+
+		window.Create(int(value["width"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Board
+	def LoadElementBoard(self, window, value, parentWindow):
+		if False == self.CheckKeyList(value["name"], value, self.BOARD_KEY_LIST):
+			return False
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Board With TitleBar
+	def LoadElementBoardWithTitleBar(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.BOARD_WITH_TITLEBAR_KEY_LIST):
+			return False
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		window.SetTitleName(value["title"])
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## BorderA
+	def LoadElementBorderA(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.BOARD_KEY_LIST):
+			return False
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## ThinBoard
+	def LoadElementThinBoard(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.BOARD_KEY_LIST):
+			return False
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Box
+	def LoadElementBox(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.BOX_KEY_LIST):
+			return False
+
+		if True == value.has_key("color"):
+			window.SetColor(value["color"])
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Bar
+	def LoadElementBar(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.BAR_KEY_LIST):
+			return False
+
+		if True == value.has_key("color"):
+			window.SetColor(value["color"])
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Line
+	def LoadElementLine(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.LINE_KEY_LIST):
+			return False
+
+		if True == value.has_key("color"):
+			window.SetColor(value["color"])
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Slot
+	def LoadElementSlotBar(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.SLOTBAR_KEY_LIST):
+			return False
+
+		window.SetSize(int(value["width"]), int(value["height"]))
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## Gauge
+	def LoadElementGauge(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.GAUGE_KEY_LIST):
+			return False
+
+		window.MakeGauge(value["width"], value["color"])
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## ScrollBar
+	def LoadElementScrollBar(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.SCROLLBAR_KEY_LIST):
+			return False
+
+		window.SetScrollBarSize(value["size"])
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## SliderBar
+	def LoadElementSliderBar(self, window, value, parentWindow):
+
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## ListBox
+	def LoadElementListBox(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.LIST_BOX_KEY_LIST):
+			return False
+
+		if value.has_key("item_align"):
+			window.SetTextCenterAlign(value["item_align"])
+
+		window.SetSize(value["width"], value["height"])
+		self.LoadDefaultData(window, value, parentWindow)
+
+		return True
+
+	## ListBox2
+	def LoadElementListBox2(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.LIST_BOX_KEY_LIST):
+			return False
+
+		window.SetRowCount(value.get("row_count", 10)) 
+		window.SetSize(value["width"], value["height"])
+		self.LoadDefaultData(window, value, parentWindow)
+
+		if value.has_key("item_align"):
+			window.SetTextCenterAlign(value["item_align"])
+
+		return True
+
+	def LoadElementListBoxEx(self, window, value, parentWindow):
+
+		if False == self.CheckKeyList(value["name"], value, self.LIST_BOX_KEY_LIST):
+			return False
+
+		window.SetSize(value["width"], value["height"])
+		self.LoadDefaultData(window, value, parentWindow)
+
+		if value.has_key("itemsize_x") and value.has_key("itemsize_y"):
+			window.SetItemSize(int(value["itemsize_x"]), int(value["itemsize_y"]))
+
+		if value.has_key("itemstep"):
+			window.SetItemStep(int(value["itemstep"]))
+
+		if value.has_key("viewcount"):
+			window.SetViewItemCount(int(value["viewcount"]))
+
+		return True
+
+	def LoadElementNumberLine(self, window, value, parentWindow):
+		self.LoadDefaultData(window, value, parentWindow)
+		return True
+
+	if app.RENDER_TARGET:
+		def LoadElementRenderTarget(self, window, value, parentWindow):
+			if False == self.CheckKeyList(value["name"], value, self.RENDER_TARGET_KEY_LIST):
+				return False
+
+			window.SetSize(value["width"], value["height"])
+
+			if True == value.has_key("style"):
+				for style in value["style"]:
+					window.AddFlag(style)
+
+			self.LoadDefaultData(window, value, parentWindow)
+
+			if value.has_key("index"):
+				window.SetRenderTarget(int(value["index"]))
+
+			return True
+
+	if app.ENABLE_MAILBOX:
+		def LoadElementRenderBox(self, window, value, parentWindow):
+			if False == self.CheckKeyList(value["name"], value, self.RENDER_BOX_KEY_LIST):
+				return False
+
+			window.SetSize(value["width"], value["height"])
+			self.LoadDefaultData(window, value, parentWindow)
+
+			if value.has_key("color"):
+				window.SetColor(int(value["color"]))
+
+			return True
+
+	def LoadElementCircle(self, window, value, parentWindow):
+		if False == self.CheckKeyList(value["name"], value, self.CIRCLE_KEY_LIST):
+			return False
+
+		window.SetSize(value["width"], value["height"])
+		self.LoadDefaultData(window, value, parentWindow)
+
+		if value.has_key("color"):
+			window.SetColor(value["color"])
+
+		return True
+
+class ReadingWnd(Bar):
+	def __init__(self):
+		Bar.__init__(self,"TOP_MOST")
+
+		self.__BuildText()
+		self.SetSize(80, 19)
+		self.Show()
+
+	def __del__(self):
+		Bar.__del__(self)
+
+	def __BuildText(self):
+		self.text = TextLine()
+		self.text.SetParent(self)
+		self.text.SetPosition(4, 3)
+		self.text.Show()
+
+	def SetText(self, text):
+		self.text.SetText(text)
+
+	def SetReadingPosition(self, x, y):
+		xPos = x + 2
+		yPos = y - self.GetHeight() - 2
+		self.SetPosition(xPos, yPos)
+
+	def SetTextColor(self, color):
+		self.text.SetPackedFontColor(color)
+
+def MakeSlotBar(parent, x, y, width, height):
+	slotBar = SlotBar()
+	slotBar.SetParent(parent)
+	slotBar.SetSize(width, height)
+	slotBar.SetPosition(x, y)
+	slotBar.Show()
+	return slotBar
+
+def MakeImageBox(parent, name, x, y):
+	image = ImageBox()
+	image.SetParent(parent)
+	image.LoadImage(name)
+	image.SetPosition(x, y)
+	image.Show()
+	return image
+
+def MakeTextLine(parent):
+	textLine = TextLine()
+	textLine.SetParent(parent)
+	textLine.SetWindowHorizontalAlignCenter()
+	textLine.SetWindowVerticalAlignCenter()
+	textLine.SetHorizontalAlignCenter()
+	textLine.SetVerticalAlignCenter()
+	if app.WJ_MULTI_TEXTLINE:
+		textLine.DisableEnterToken()
+	textLine.Show()
+	return textLine
+
+def AddTextLine(parent, x, y, text, outline = 0):
+	textLine = TextLine()
+	textLine.SetParent(parent)
+	textLine.SetPosition(x, y)
+	if outline != 0:
+		textLine.SetOutline()
+	textLine.SetText(text)
+	textLine.Show()
+	return textLine
+
+def MakeNewTextLine(parent, horizontalAlign = True, verticalAlgin = True, x = 0, y = 0):
+	textLine = TextLine()
+	textLine.SetParent(parent)
+	if horizontalAlign == True:
+		textLine.SetWindowHorizontalAlignCenter()
+	if verticalAlgin == True:
+		textLine.SetWindowVerticalAlignCenter()
+	textLine.SetHorizontalAlignCenter()
+	textLine.SetVerticalAlignCenter()
+	if app.WJ_MULTI_TEXTLINE:
+		textLine.DisableEnterToken()
+	if x != 0 and y != 0:
+		textLine.SetPosition(x, y)
+	textLine.Show()
+	return textLine
+
+def MakeExpandedImageBox(parent, name, x, y, flag = ""):
+	image = ExpandedImageBox()
+	image.SetParent(parent)
+	image.LoadImage(name)
+	image.SetPosition(x, y)
+	if flag != "":
+		image.AddFlag(flag)
+	image.Show()
+	return image
+
+def MakeButton(parent, x, y, tooltipText, path, up, over, down):
+	button = Button()
+	button.SetParent(parent)
+	button.SetPosition(x, y)
+	button.SetUpVisual(path + up)
+	button.SetOverVisual(path + over)
+	button.SetDownVisual(path + down)
+	button.SetToolTipText(tooltipText)
+	button.Show()
+	return button
+
+def RenderRoundBox(x, y, width, height, color):
+	grp.SetColor(color)
+	grp.RenderLine(x+2, y, width-3, 0)
+	grp.RenderLine(x+2, y+height, width-3, 0)
+	grp.RenderLine(x, y+2, 0, height-4)
+	grp.RenderLine(x+width, y+1, 0, height-3)
+	grp.RenderLine(x, y+2, 2, -2)
+	grp.RenderLine(x, y+height-2, 2, 2)
+	grp.RenderLine(x+width-2, y, 2, 2)
+	grp.RenderLine(x+width-2, y+height, 2, -2)
+
+def GenerateColor(r, g, b):
+	r = float(r) / 255.0
+	g = float(g) / 255.0
+	b = float(b) / 255.0
+	return grp.GenerateColor(r, g, b, 1.0)
+
+def EnablePaste(flag):
+	ime.EnablePaste(flag)
+
+def GetHyperlink():
+	return wndMgr.GetHyperlink()
+
+RegisterToolTipWindow("TEXT", TextLine)
+
+if app.RENDER_TARGET:
+	class RenderTarget(Window):
+		def __init__(self, layer = "UI"):
+			Window.__init__(self, layer)
+
+			self.number = -1
+
+		def __del__(self):
+			Window.__del__(self)
+
+		def RegisterWindow(self, layer):
+			self.hWnd = wndMgr.RegisterRenderTarget(self, layer)
+
+		def SetRenderTarget(self, number):
+			self.number = number
+			wndMgr.SetRenderTarget(self.hWnd, self.number)
+
+if app.ENABLE_MAILBOX:
+	class RenderBox(Window):
+		def __init__(self, layer = "UI"):
+			Window.__init__(self, layer)
+			self.color = 0xFF000000
+
+		def __del__(self):
+			Window.__del__(self)
+			self.color = 0xFF000000
+
+		def RegisterWindow(self, layer):
+			self.hWnd = wndMgr.Register(self, layer)
+
+		def SetColor(self, color):
+			self.color = color
+
+		def OnRender(self):
+			(x, y, width, height) = self.GetRect()
+			grp.SetColor(self.color)
+			grp.RenderBar(x, y, width, height)
+
+class Circle(Window):
+	def __init__(self):
+		Window.__init__(self)
+		self.color = 0xFF000000
+
+	def __del__(self):
+		Window.__del__(self)
+
+	def RegisterWindow(self, layer):
+		self.hWnd = wndMgr.RegisterCircle(self, layer)
+
+	def SetColor(self, color):
+		self.color = color
+		wndMgr.SetColor(self.hWnd, self.color)
+
+class OutlineWindow(Window):
+	PATTERN_PATH = "d:/ymir work/ui/pattern/"
+
+	def __init__(self, layer = "UI"):
+		Window.__init__(self, layer)
+		self.__Initialize()
+
+	def __del__(self):
+		Window.__del__(self)
+		self.__Initialize()
+
+	def __Initialize(self):
+		self.pattern_x_count = 0
+		self.pattern_y_count = 0
+		self.left_top_img = None
+		self.right_top_img = None
+		self.left_bottom_img = None
+		self.right_bottom_img = None
+		self.top_center_img = None
+		self.left_center_img = None
+		self.right_center_img = None
+		self.bottom_center_img = None
+		self.center_img = None
+
+	def MakeOutlineWindow(self, window_width, window_height):
+		self.AddFlag("ltr")
+		self.AddFlag("attach")
+		self.SetWindowName("outline_window")
+		self.SetSize(window_width, window_height)
+
+		self.pattern_x_count = (window_width - 32) / 16
+		self.pattern_y_count = (window_height - 32) / 16
+
+		self.left_top_img = ImageBox()
+		self.left_top_img.SetParent(self)
+		self.left_top_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_left_top.tga")
+		self.left_top_img.SetPosition(0, 0)
+		self.left_top_img.Show()
+
+		self.right_top_img = ImageBox()
+		self.right_top_img.SetParent(self)
+		self.right_top_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_right_top.tga")
+		self.right_top_img.SetPosition(window_width - 16, 0)
+		self.right_top_img.Show()
+
+		self.left_bottom_img = ImageBox()
+		self.left_bottom_img.SetParent(self)
+		self.left_bottom_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_left_bottom.tga")
+		self.left_bottom_img.SetPosition(0, window_height - 16)
+		self.left_bottom_img.Show()
+
+		self.right_bottom_img = ImageBox()
+		self.right_bottom_img.SetParent(self)
+		self.right_bottom_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_right_bottom.tga")
+		self.right_bottom_img.SetPosition(window_width - 16, window_height - 16)
+		self.right_bottom_img.Show()
+
+		self.top_center_img = ExpandedImageBox()
+		self.top_center_img.SetParent(self)
+		self.top_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_top.tga")
+		self.top_center_img.SetPosition(16, 0)
+		self.top_center_img.SetRenderingRect(0.0, 0.0, self.pattern_x_count, 0.0)
+		self.top_center_img.Show()
+
+		self.left_center_img = ExpandedImageBox()
+		self.left_center_img.SetParent(self)
+		self.left_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_left.tga")
+		self.left_center_img.SetPosition(0, 16)
+		self.left_center_img.SetRenderingRect(0.0, 0.0, 0.0, self.pattern_y_count)
+		self.left_center_img.Show()
+
+		self.right_center_img = ExpandedImageBox()
+		self.right_center_img.SetParent(self)
+		self.right_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_right.tga")
+		self.right_center_img.SetPosition(window_width - 16, 16)
+		self.right_center_img.SetRenderingRect(0.0, 0.0, 0.0, self.pattern_y_count)
+		self.right_center_img.Show()
+
+		self.bottom_center_img = ExpandedImageBox()
+		self.bottom_center_img.SetParent(self)
+		self.bottom_center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_bottom.tga")
+		self.bottom_center_img.SetPosition(16, window_height - 16)
+		self.bottom_center_img.SetRenderingRect(0.0, 0.0, self.pattern_x_count, 0.0)
+		self.bottom_center_img.Show()
+
+		self.center_img = ExpandedImageBox()
+		self.center_img.SetParent(self)
+		self.center_img.LoadImage(OutlineWindow.PATTERN_PATH + "border_A_center.tga")
+		self.center_img.SetPosition(16, 16)
+		self.center_img.SetRenderingRect(0.0, 0.0, self.pattern_x_count, self.pattern_y_count)
+		self.center_img.Show()
+
+if app.ENABLE_SEND_TARGET_INFO:
+	class CheckBox(Window):
+		def __init__(self):
+			Window.__init__(self)
+
+			self.checkbox_image = None
+			self.check_image = None
+			self.text_line = None
+			self.check = False
+
+			self.event_func = { "check" : None, "uncheck" : None, }
+			self.event_args = { "check" : None, "uncheck" : None, }
+
+			self.__BuildCheckBox()
+
+		def __del__(self):
+			Window.__del__(self)
+
+			self.checkbox_image = None
+			self.check_image = None
+			self.text_line = None
+			self.check = False
+
+			self.event_func = { "check" : None, "uncheck" : None, }
+			self.event_args = { "check" : None, "uncheck" : None, }
+
+		def __BuildCheckBox(self):
+			checkbox_image = ImageBox()
+			checkbox_image.SetParent(self)
+			checkbox_image.AddFlag("not_pick")
+			checkbox_image.LoadImage("d:/ymir work/ui/game/quest/quest_checkbox.tga")
+			checkbox_image.Show()
+			self.checkbox_image = checkbox_image
+
+			check_image = ImageBox()
+			check_image.SetParent(self)
+			check_image.AddFlag("not_pick")
+			check_image.SetPosition(0, -4)
+			check_image.LoadImage("d:/ymir work/ui/game/quest/quest_checked.tga")
+			check_image.Hide()
+			self.check_image = check_image
+
+			text_line = TextLine()
+			text_line.SetParent(self)
+			text_line.SetPosition(17, -2)
+			text_line.Show()
+			self.text_line = text_line
+
+			self.SetSize(self.checkbox_image.GetWidth() + self.text_line.GetTextSize()[0], self.checkbox_image.GetHeight() + self.text_line.GetTextSize()[1])
+
+		def SetText(self, text, color = 0):
+			if self.text_line:
+				self.text_line.SetText(text)
+				if color:
+					self.text_line.SetPackedFontColor(color)
+
+			self.SetSize(self.checkbox_image.GetWidth() + self.text_line.GetTextSize()[0], self.checkbox_image.GetHeight() + self.text_line.GetTextSize()[1])
+
+		def SetCheckBox(self, check):
+			self.check = check
+			if check:
+				self.check_image.Show()
+			else:
+				self.check_image.Hide()
+
+		def IsChecked(self):
+			return self.check
+
+		def SetEvent(self, func, *args):
+			result = self.event_func.has_key(args[0])
+			if result:
+				self.event_func[args[0]] = func
+				self.event_args[args[0]] = args
+			else:
+				print("[ERROR] ui.py SetEvent, Can`t Find has_key : %s" % args[0])
+
+		def OnMouseLeftButtonUp(self):
+			if self.check != True:
+				self.check = True
+				self.check_image.Show()
+
+				if self.event_func["check"]:
+					apply(self.event_func["check"], self.event_args["check"])
+			else:
+				self.check = False
+				self.check_image.Hide()
+
+				if self.event_func["uncheck"]:
+					apply(self.event_func["uncheck"], self.event_args["uncheck"])
diff --git a/client/pack/root/uiinventory.py b/client/pack/root/uiinventory.py
index 790f19a..40c5243 100644
--- a/client/pack/root/uiinventory.py
+++ b/client/pack/root/uiinventory.py
@@ -1,3698 +1,3739 @@
-import ui
-import player
-import mouseModule
-import net
-import app
-import snd
-import item
-import player
-import chat
-import grp
-import uiScriptLocale
-import uiRefine
-import uiAttachMetin
-import uiPickMoney
-import uiCommon
-import uiPrivateShopBuilder # °³ÀÎ»óÁ¡ ¿­µ¿¾È ItemMove ¹æÁö
-import localeInfo
-import constInfo
-import ime
-import wndMgr
-
-if app.ENABLE_CHEQUE_SYSTEM:
-	import uiToolTip
-	import uiPickETC
-
-ITEM_FLAG_APPLICABLE = 1 << 14
-
-if app.ENABLE_EXTEND_INVEN_SYSTEM:
-	EX_INVEN_COVER_IMG_OPEN = "d:/ymir work/ui/game/windows/ex_inven_cover_button_open.sub"
-	EX_INVEN_COVER_IMG_CLOSE = "d:/ymir work/ui/game/windows/ex_inven_cover_button_close.sub"
-
-if app.ENABLE_HIDE_COSTUME_SYSTEM:
-	import chr
-
-def ReprGetItemIndex(window):
-	return lambda pos : player.GetItemIndex(window, pos)
-
-def ReprGetItemCount(window):
-	return lambda pos : player.GetItemCount(window, pos)
-
-if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-	class EquipmentWindow(ui.ScriptWindow):
-		EQUIPMENT_CHANGE_COOLTIME = 3
-		EXPANSION_CHANGE_HEIGHT_SIZE = 20
-
-		def __init__(self):
-			self.wnd_costume = None
-			self.wnd_inventory = None
-			self.wnd_belt = None
-
-			ui.ScriptWindow.__init__(self)
-
-			self.__Initialize()
-			self.__LoadWindow()
-
-		def __del__(self):
-			ui.ScriptWindow.__del__(self)
-
-		def __Initialize(self):
-			self.is_loaded = 0
-
-			self.interface = None
-
-			self.current_page = 0
-			self.tab_btn = []
-			self.tab_img = []
-
-		def __LoadWindow(self):
-			if self.is_loaded == 1:
-				return
-
-			self.is_loaded = 1
-
-			try:
-				pyScrLoader = ui.PythonScriptLoader()
-				pyScrLoader.LoadScriptFile(self, "UIScript/EquipmentDialog.py")
-			except:
-				import exception
-				exception.Abort("CostumeWindow.LoadWindow.LoadObject")
-
-			try:
-				self.GetChild("board").SetTitleName(localeInfo.EQUIPMENT_TITLE_NAME)
-				self.GetChild("board").SetCloseEvent(ui.__mem_func__(self.Close))
-
-				self.equipment_slot = self.GetChild("equipment_slot")
-				self.unique_slot = self.GetChild("unique_slot")
-
-				self.dragon_soul_button = self.GetChild("dragon_soul_button")
-				self.mall_button = self.GetChild("mall_button")
-				self.premium_private_shop_button = self.GetChild("premium_private_shop_button")
-				self.costume_button = self.GetChild("costume_button")
-
-				self.tab_btn = []
-				self.tab_btn.append(self.GetChild("tab_btn_01"))
-				self.tab_btn.append(self.GetChild("tab_btn_02"))
-
-				self.tab_img = []
-				self.tab_img.append(self.GetChild("tab_img_01"))
-				self.tab_img.append(self.GetChild("tab_img_02"))
-
-				for btn in self.tab_btn:
-					btn.Hide()
-
-				for img in self.tab_img:
-					img.Hide()
-			except:
-				import exception
-				exception.Abort("EquipmentWindow.LoadWindow.BindObject")
-
-			self.equipment_slot.SetSlotType(player.SLOT_TYPE_EQUIPMENT)
-			self.unique_slot.SetSlotType(player.SLOT_TYPE_EQUIPMENT)
-
-			self.dragon_soul_button.SetEvent(ui.__mem_func__(self.__ClickDSSButton))
-			self.mall_button.SetEvent(ui.__mem_func__(self.__ClickMallButton))
-			self.premium_private_shop_button.SetEvent(ui.__mem_func__(self.__ClickPremiumPrivateShopButton))
-			self.costume_button.SetEvent(ui.__mem_func__(self.__ClickCostumeButton))
-
-		def __CreateCostumeWindow(self):
-			pass
-
-		def BindInterface(self, interface):
-			from _weakref import proxy
-			self.interface = proxy(interface)
-
-		def BindInventoryWindow(self, inventory_window):
-			from _weakref import proxy
-			self.wnd_inventory = proxy(inventory_window)
-
-			x, y = self.wnd_inventory.GetGlobalPosition()
-			self.SetPosition(x, y - self.GetHeight())
-
-			self.equipment_slot.SetOverInItemEvent(ui.__mem_func__(self.wnd_inventory.OverInItem), player.EQUIPMENT)
-			self.equipment_slot.SetOverOutItemEvent(ui.__mem_func__(self.wnd_inventory.OverOutItem))
-			self.equipment_slot.SetUnselectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
-			self.equipment_slot.SetUseSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
-			self.equipment_slot.SetSelectEmptySlotEvent(ui.__mem_func__(self.wnd_inventory.SelectEmptySlot), player.EQUIPMENT)
-			self.equipment_slot.SetSelectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.SelectItemSlot), player.EQUIPMENT)
-
-			self.unique_slot.SetOverInItemEvent(ui.__mem_func__(self.wnd_inventory.OverInItem), player.EQUIPMENT)
-			self.unique_slot.SetOverOutItemEvent(ui.__mem_func__(self.wnd_inventory.OverOutItem))
-			self.unique_slot.SetUnselectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
-			self.unique_slot.SetUseSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
-			self.unique_slot.SetSelectEmptySlotEvent(ui.__mem_func__(self.wnd_inventory.SelectEmptySlot), player.EQUIPMENT)
-			self.unique_slot.SetSelectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.SelectItemSlot), player.EQUIPMENT)
-
-			self.wnd_costume = CostumeWindow(self.wnd_inventory)
-			self.wnd_belt = BeltInventoryWindow(self.wnd_inventory)
-			self.wnd_belt.SetMoveParentWindow(self)
-
-		def __ClickDSSButton(self):
-			self.interface.ToggleDragonSoulWindow()
-
-		def __ClickMallButton(self):
-			net.SendCommandPacket("/click_mall")
-
-		def __ClickPremiumPrivateShopButton(self):
-			self.interface.TogglePrivateShopPanelWindow()
-
-		def __ClickCostumeButton(self):
-			if not self.wnd_costume:
-				return
-
-			if not self.wnd_costume.IsShow():
-				self.wnd_costume.Show()
-			else:
-				self.wnd_costume.Close()
-
-		def ShowCostumeInventory(self):
-			if self.wnd_costume:
-				self.wnd_costume.Show()
-
-		def Show(self):
-			self.__LoadWindow()
-
-			if self.wnd_costume and self.wnd_costume.IsOpen():
-				self.wnd_costume.Show()
-
-			if self.wnd_belt:
-				self.wnd_belt.Show()
-
-			ui.ScriptWindow.Show(self)
-			self.SetTop()
-
-		def Hide(self):
-			if self.wnd_costume:
-				self.wnd_costume.Hide()
-
-			if self.wnd_belt:
-				self.wnd_belt.Hide()
-
-			ui.ScriptWindow.Hide(self)
-
-		def OnTop(self):
-			(x, y) = self.GetLocalPosition()
-			if y < 0:
-				self.SetPosition(x, 0)
-
-		def Close(self):
-			self.Hide()
-
-		def OnPressEscapeKey(self):
-			self.Close()
-			return True
-
-		def Destroy(self):
-			if self.wnd_costume:
-				del self.wnd_costume
-				self.wnd_costume = None
-
-			if self.wnd_belt:
-				del self.wnd_belt
-				self.wnd_belt = None
-
-		def RefreshSlot(self):
-			self.__RefreshEquipmentSlot()
-			self.__RefreshUniqueSlot()
-
-			if self.wnd_belt:
-				self.wnd_belt.RefreshSlot()
-
-		def __RefreshEquipmentSlot(self):
-			if not self.equipment_slot:
-				return
-
-			getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
-			getItemCount = ReprGetItemCount(player.EQUIPMENT)
-			setItemVNum = self.equipment_slot.SetItemSlot
-
-			for i in xrange(player.WEAR_MAX): ## 32 ( 0 ~ 31 )
-				itemCount = getItemCount(i)
-				if itemCount <= 1:
-					itemCount = 0
-
-				setItemVNum(i, getItemVNum(i), itemCount)
-
-				if app.ENABLE_CHANGE_LOOK_SYSTEM:
-					if not player.GetChangeLookVnum(player.EQUIPMENT, i) == 0:
-						self.equipment_slot.SetSlotCoverImage(i, "icon/item/ingame_convert_Mark.tga")
-					else:
-						self.equipment_slot.EnableSlotCoverImage(i,False)
-
-			self.equipment_slot.RefreshSlot()
-
-			if self.wnd_costume:
-				self.wnd_costume.RefreshCostumeSlot()
-
-		def __RefreshUniqueSlot(self):
-			if not self.unique_slot:
-				return
-
-			getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
-			getItemCount = ReprGetItemCount(player.EQUIPMENT)
-			setItemVNum = self.unique_slot.SetItemSlot
-
-			for i in xrange(player.WEAR_MAX):
-				itemCount = getItemCount(i)
-				if itemCount <= 1:
-					itemCount = 0
-
-				setItemVNum(i, getItemVNum(i), itemCount)
-
-			self.unique_slot.RefreshSlot()
-
-		def OnMoveWindow(self, x, y):
-			if self.wnd_belt:
-				self.wnd_belt.SetMoveParentWindow(self)
-
-		def GetBeltWnd(self):
-			return self.wnd_belt
-
-		def __RequestChangeEquipmentpage(self, page_index): pass
-		def __UseChangeEquipmentPageSkill(self, page_index): pass
-		def AdditionalEquipmentPageSetting(self, page_index): pass
-		def EquipmentPageTabSetting(self, page_index): pass
-		def IsActiveAdditionalEquipmentPage(self): pass
-		def ToggleEquipmentPage(self): pass
-
-		if app.ENABLE_HIDE_COSTUME_SYSTEM:
-			def SetHiddenCostumePart(self, part, hidden):
-				if self.wnd_costume:
-					self.wnd_costume.SetHiddenCostumePart(part, hidden)
-
-class CostumeWindow(ui.ScriptWindow):
-	def __init__(self, wndInventory):
-		import exception
-
-		if not wndInventory:
-			exception.Abort("wndInventory parameter must be set to InventoryWindow")
-			return
-
-		ui.ScriptWindow.__init__(self)
-
-		self.isLoaded = 0
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.isOpen = 0
-
-		if app.ENABLE_HIDE_COSTUME_SYSTEM:
-			self.slot_image_dict = {}
-			self.slot_btn_dict = {}
-
-			self.visible_wnd_dict = { item.COSTUME_TYPE_BODY : (62, 45), item.COSTUME_TYPE_HAIR : (62, 9), }
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				self.visible_wnd_dict.update({ item.COSTUME_TYPE_ACCE : (70, 126) })
-			if app.ENABLE_WEAPON_COSTUME_SYSTEM:
-				self.visible_wnd_dict.update({ item.COSTUME_TYPE_WEAPON : (13, 13) })
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				self.visible_wnd_dict.update({ item.COSTUME_TYPE_AURA : (37, 126) })
-
-		self.wndInventory = wndInventory;
-
-		self.__LoadWindow()
-
-	def __del__(self):
-		ui.ScriptWindow.__del__(self)
-
-	def Show(self):
-		self.__LoadWindow()
-		self.RefreshCostumeSlot()
-
-		ui.ScriptWindow.Show(self)
-		self.SetTop()
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.isOpen = 1
-
-	if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-		def IsOpen(self):
-			return self.isOpen
-
-	def Close(self):
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.isOpen = 0
-
-		self.Hide()
-
-	def __LoadWindow(self):
-		if self.isLoaded == 1:
-			return
-
-		self.isLoaded = 1
-
-		try:
-			pyScrLoader = ui.PythonScriptLoader()
-			pyScrLoader.LoadScriptFile(self, "UIScript/CostumeWindow.py")
-		except:
-			import exception
-			exception.Abort("CostumeWindow.LoadWindow.LoadObject")
-
-		try:
-			wndEquip = self.GetChild("CostumeSlot")
-			if app.ENABLE_HIDE_COSTUME_SYSTEM:
-				self.base_image = self.GetChild("Costume_Base")
-
-			self.GetChild("TitleBar").SetCloseEvent(ui.__mem_func__(self.Close))
-
-		except:
-			import exception
-			exception.Abort("CostumeWindow.LoadWindow.BindObject")
-
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			x, y = self.wndInventory.GetGlobalPosition()
-			self.SetPosition(x - 150, y - self.wndInventory.GetHeight() + 65)
-			(x, y) = self.GetLocalPosition()
-			if y < 0:
-				self.SetPosition(x, 0)
-
-		if app.ENABLE_HIDE_COSTUME_SYSTEM:
-			## Slot Image List
-			self.slot_image_dict = {}
-			for key, (x, y) in self.visible_wnd_dict.items():
-				slot_image = ui.ImageBox()
-				slot_image.SetParent(self.base_image)
-				slot_image.AddFlag("not_pick")
-				slot_image.SetPosition(x + 4, y + 4)
-				if key == item.COSTUME_TYPE_BODY:
-					slot_image.LoadImage("d:/ymir work/ui/game/costume/hideslot_02.tga")
-				elif app.ENABLE_WEAPON_COSTUME_SYSTEM and key == item.COSTUME_TYPE_WEAPON:
-					slot_image.LoadImage("d:/ymir work/ui/game/costume/hideslot_03.tga")
-				else:
-					slot_image.LoadImage("d:/ymir work/ui/game/costume/hideslot_01.tga")
-				slot_image.Hide()
-				self.slot_image_dict[key] = slot_image
-
-			## Slot Button List
-			self.slot_btn_dict = {}
-			for key, (x, y) in self.visible_wnd_dict.items():
-				btn = ui.Button()
-				btn.SetParent(self.base_image)
-				btn.SetPosition(x, y)
-				btn.SetUpVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
-				btn.SetOverVisual("d:/ymir work/ui/game/costume/eye_normal_02.tga")
-				btn.SetDownVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
-				btn.SetToolTipText(localeInfo.HIDE_COSTUME_TOOLTIP)
-				btn.SetEvent(ui.__mem_func__(self.__ClickVisibleButton), key, 1)
-				btn.Show()
-				self.slot_btn_dict[key] = btn
-
-		## Equipment
-		wndEquip.SetOverInItemEvent(ui.__mem_func__(self.wndInventory.OverInItem), player.EQUIPMENT)
-		wndEquip.SetOverOutItemEvent(ui.__mem_func__(self.wndInventory.OverOutItem))
-		wndEquip.SetUnselectItemSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.EQUIPMENT)
-		wndEquip.SetUseSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.EQUIPMENT)
-		wndEquip.SetSelectEmptySlotEvent(ui.__mem_func__(self.wndInventory.SelectEmptySlot), player.EQUIPMENT)
-		wndEquip.SetSelectItemSlotEvent(ui.__mem_func__(self.wndInventory.SelectItemSlot), player.EQUIPMENT)
-
-		self.wndEquip = wndEquip
-
-	def RefreshCostumeSlot(self):
-		getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
-
-		for i in xrange(item.COSTUME_SLOT_COUNT):
-			slotNumber = item.COSTUME_SLOT_START + i
-			self.wndEquip.SetItemSlot(slotNumber, getItemVNum(slotNumber), 0)
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if not player.GetChangeLookVnum(player.EQUIPMENT, slotNumber) == 0:
-					self.wndEquip.SetSlotCoverImage(slotNumber, "icon/item/ingame_convert_Mark.tga")
-				else:
-					self.wndEquip.EnableSlotCoverImage(slotNumber, False)
-
-		if app.ENABLE_WEAPON_COSTUME_SYSTEM:
-			self.wndEquip.SetItemSlot(item.COSTUME_SLOT_WEAPON, getItemVNum(item.COSTUME_SLOT_WEAPON), 0)
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if not player.GetChangeLookVnum(player.EQUIPMENT, item.COSTUME_SLOT_WEAPON) == 0:
-					self.wndEquip.SetSlotCoverImage(item.COSTUME_SLOT_WEAPON, "icon/item/ingame_convert_Mark.tga")
-				else:
-					self.wndEquip.EnableSlotCoverImage(item.COSTUME_SLOT_WEAPON, False)
-
-		self.wndEquip.RefreshSlot()
-
-	if app.ENABLE_HIDE_COSTUME_SYSTEM:
-		def __ClickVisibleButton(self, part, hidden):
-			if part in self.visible_wnd_dict:
-				net.SendCommandPacket("/hide_costume_part %d %d" % (part, hidden))
-
-		def SetHiddenCostumePart(self, part, hidden):
-			if not part in self.visible_wnd_dict:
-				return
-
-			btn = self.slot_btn_dict[part]
-			if hidden:
-				btn.SetUpVisual("d:/ymir work/ui/game/costume/eye_closed_01.tga")
-				btn.SetOverVisual("d:/ymir work/ui/game/costume/eye_closed_02.tga")
-				btn.SetDownVisual("d:/ymir work/ui/game/costume/eye_closed_01.tga")
-				btn.SetToolTipText(localeInfo.SHOW_COSTUME_TOOLTIP)
-				btn.SetEvent(ui.__mem_func__(self.__ClickVisibleButton), part, 0)
-				self.slot_image_dict[part].Show()
-			else:
-				btn.SetUpVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
-				btn.SetOverVisual("d:/ymir work/ui/game/costume/eye_normal_02.tga")
-				btn.SetDownVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
-				btn.SetToolTipText(localeInfo.HIDE_COSTUME_TOOLTIP)
-				btn.SetEvent(ui.__mem_func__(self.__ClickVisibleButton), part, 1)
-				self.slot_image_dict[part].Hide()
-
-class BeltInventoryWindow(ui.ScriptWindow):
-	def __init__(self, wndInventory):
-		import exception
-
-		if not wndInventory:
-			exception.Abort("wndInventory parameter must be set to InventoryWindow")
-			return
-
-		ui.ScriptWindow.__init__(self)
-
-		self.isLoaded = 0
-		self.wndInventory = wndInventory;
-
-		self.wndBeltInventoryLayer = None
-		self.wndBeltInventorySlot = None
-		self.expandBtn = None
-		self.minBtn = None
-
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.parent = None
-
-		self.__LoadWindow()
-
-	def __del__(self):
-		ui.ScriptWindow.__del__(self)
-
-	def Show(self, openBeltSlot = False):
-		self.__LoadWindow()
-		self.RefreshSlot()
-
-		ui.ScriptWindow.Show(self)
-
-		if openBeltSlot:
-			self.OpenInventory()
-		else:
-			self.CloseInventory()
-
-		self.SetTop()
-
-	def Close(self):
-		self.Hide()
-
-	def IsOpeningInventory(self):
-		return self.wndBeltInventoryLayer.IsShow()
-
-	def OpenInventory(self):
-		self.wndBeltInventoryLayer.Show()
-		self.expandBtn.Hide()
-
-		self.AdjustPosition()
-
-	def CloseInventory(self):
-		self.wndBeltInventoryLayer.Hide()
-		self.expandBtn.Show()
-
-		self.AdjustPosition()
-
-	## ÇöÀç ÀÎº¥Åä¸® À§Ä¡¸¦ ±âÁØÀ¸·Î BASE À§Ä¡¸¦ °è»ê, ¸®ÅÏ.. ¼ýÀÚ ÇÏµåÄÚµùÇÏ±â Á¤¸» ½ÈÁö¸¸ ¹æ¹ýÀÌ ¾ø´Ù..
-	def GetBasePosition(self):
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			x, y = self.parent.GetGlobalPosition()
-			return x - 148, y + 65
-		else:
-			x, y = self.wndInventory.GetGlobalPosition()
-			return x - 148, y + 241
-
-	def AdjustPosition(self):
-		bx, by = self.GetBasePosition()
-
-		if self.IsOpeningInventory():
-			self.SetPosition(bx, by)
-
-			if localeInfo.IsARABIC():
-				self.SetPosition(bx, by)
-				self.wndBeltInventoryLayer.SetPosition(self.ORIGINAL_WIDTH - 5, 0)
-			else:
-				self.SetPosition(bx, by)
-				self.SetSize(self.ORIGINAL_WIDTH, self.GetHeight())
-		else:
-			if localeInfo.IsARABIC():
-				self.SetPosition(bx + 140 , by)
-				self.wndBeltInventoryLayer.SetPosition(self.ORIGINAL_WIDTH - 10, 0)
-				self.expandBtn.SetPosition(self.ORIGINAL_WIDTH + 1 , 15)
-			else:
-				self.SetPosition(bx + 138, by);
-				self.SetSize(10, self.GetHeight())
-
-	def __LoadWindow(self):
-		if self.isLoaded == 1:
-			return
-
-		self.isLoaded = 1
-
-		try:
-			pyScrLoader = ui.PythonScriptLoader()
-			pyScrLoader.LoadScriptFile(self, "UIScript/BeltInventoryWindow.py")
-		except:
-			import exception
-			exception.Abort("BeltInventoryWindow.LoadWindow.LoadObject")
-
-		try:
-			self.ORIGINAL_WIDTH = self.GetWidth()
-			wndBeltInventorySlot = self.GetChild("BeltInventorySlot")
-			self.wndBeltInventoryLayer = self.GetChild("BeltInventoryLayer")
-			self.expandBtn = self.GetChild("ExpandBtn")
-			self.minBtn = self.GetChild("MinimizeBtn")
-
-			self.expandBtn.SetEvent(ui.__mem_func__(self.OpenInventory))
-			self.minBtn.SetEvent(ui.__mem_func__(self.CloseInventory))
-
-			if localeInfo.IsARABIC() :
-				self.minBtn.SetPosition(self.minBtn.GetWidth() + 3, 15)
-
-			for i in xrange(item.BELT_INVENTORY_SLOT_COUNT):
-				slotNumber = item.BELT_INVENTORY_SLOT_START + i
-				wndBeltInventorySlot.SetCoverButton(slotNumber,
-					"d:/ymir work/ui/game/quest/slot_button_01.sub",\
-					"d:/ymir work/ui/game/quest/slot_button_01.sub",\
-					"d:/ymir work/ui/game/quest/slot_button_01.sub",\
-					"d:/ymir work/ui/game/belt_inventory/slot_disabled.tga", False, False)
-		except:
-			import exception
-			exception.Abort("CostumeWindow.LoadWindow.BindObject")
-
-		## Equipment
-		wndBeltInventorySlot.SetOverInItemEvent(ui.__mem_func__(self.wndInventory.OverInItem), player.BELT_INVENTORY)
-		wndBeltInventorySlot.SetOverOutItemEvent(ui.__mem_func__(self.wndInventory.OverOutItem))
-		wndBeltInventorySlot.SetUnselectItemSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.BELT_INVENTORY)
-		wndBeltInventorySlot.SetUseSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.BELT_INVENTORY)
-		wndBeltInventorySlot.SetSelectEmptySlotEvent(ui.__mem_func__(self.wndInventory.SelectEmptySlot), player.BELT_INVENTORY)
-		wndBeltInventorySlot.SetSelectItemSlotEvent(ui.__mem_func__(self.wndInventory.SelectItemSlot), player.BELT_INVENTORY)
-
-		## MT-436 slot bug fix
-		wndBeltInventorySlot.SetSlotType(player.SLOT_TYPE_BELT_INVENTORY)
-		self.wndBeltInventorySlot = wndBeltInventorySlot
-
-	def RefreshSlot(self):
-		getItemVNum = ReprGetItemIndex(player.BELT_INVENTORY)
-		getItemCount = ReprGetItemCount(player.BELT_INVENTORY)
-
-		for i in xrange(item.BELT_INVENTORY_SLOT_COUNT):
-			slotNumber = item.BELT_INVENTORY_SLOT_START + i
-			self.wndBeltInventorySlot.SetItemSlot(slotNumber, getItemVNum(slotNumber), getItemCount(slotNumber))
-			self.wndBeltInventorySlot.SetAlwaysRenderCoverButton(slotNumber, True)
-
-			if player.IsAvailableBeltInventoryCell(slotNumber):
-				self.wndBeltInventorySlot.EnableCoverButton(slotNumber)
-			else:
-				self.wndBeltInventorySlot.DisableCoverButton(slotNumber)
-
-		self.wndBeltInventorySlot.RefreshSlot()
-
-	def OnTop(self):
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			pass
-		else:
-			if self.wndInventory:
-				self.wndInventory.SetClickBeltInventory(True)
-				self.wndInventory.SetTop()
-
-	if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-		def SetMoveParentWindow(self, move_window):
-			from _weakref import proxy
-			self.parent = proxy(move_window)
-			self.AdjustPosition()
-
-class InventoryWindow(ui.ScriptWindow):
-	USE_TYPE_TUPLE = (
-		"USE_CLEAN_SOCKET",
-		"USE_CHANGE_ATTRIBUTE",
-		"USE_ADD_ATTRIBUTE",
-		"USE_ADD_ATTRIBUTE2",
-		"USE_ADD_ACCESSORY_SOCKET",
-		"USE_PUT_INTO_ACCESSORY_SOCKET",
-		"USE_PUT_INTO_BELT_SOCKET",
-		"USE_PUT_INTO_RING_SOCKET"
-	)
-
-	if app.ENABLE_MOVE_COSTUME_ATTR:
-		USE_TYPE_TUPLE += ("USE_CHANGE_COSTUME_ATTR", "USE_RESET_COSTUME_ATTR",)
-
-	if app.ENABLE_CHANGED_ATTR:
-		USE_TYPE_TUPLE += ("USE_SELECT_ATTRIBUTE",)
-
-	if app.ENABLE_ATTR_6TH_7TH:
-		USE_TYPE_TUPLE += ("USE_CHANGE_ATTRIBUTE2",)
-
-	if app.ENABLE_REFINE_ELEMENT_SYSTEM:
-		USE_TYPE_TUPLE += ("USE_ELEMENT_UPGRADE", "USE_ELEMENT_DOWNGRADE", "USE_ELEMENT_CHANGE",)
-
-	questionDialog = None
-	tooltipItem = None
-
-	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-		wndCostume = None
-		wndBelt = None
-
-	dlgPickMoney = None
-	if app.ENABLE_CHEQUE_SYSTEM:
-		dlgPickETC = None
-
-	if app.WJ_ENABLE_TRADABLE_ICON:
-		bindWnds = []
-
-	sellingSlotNumber = -1
-	sellingSlotWindow = player.INVENTORY
-
-	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-		isOpenedCostumeWindowWhenClosingInventory = 0 # ÀÎº¥Åä¸® ´ÝÀ» ¶§ ÄÚ½ºÃõÀÌ ¿­·ÁÀÖ¾ú´ÂÁö ¿©ºÎ-_-; ³×ÀÌ¹Ö ¤¸¤µ
-		isOpenedBeltWindowWhenClosingInventory = 0 # ÀÎº¥Åä¸® ´ÝÀ» ¶§ º§Æ® ÀÎº¥Åä¸®°¡ ¿­·ÁÀÖ¾ú´ÂÁö ¿©ºÎ-_-; ³×ÀÌ¹Ö ¤¸¤µ
-
-	if app.ENABLE_GROWTH_PET_SYSTEM:
-		petHatchingWindow	= None
-		petFeedWindow		= None
-		petNameChangeWindow = None
-
-	isLoaded = 0
-	interface = None
-	pop = None
-
-	def __init__(self):
-		if app.ENABLE_GEM_SYSTEM:
-			self.wndExpandedMoneyBar = None
-			self.wndGem = None
-
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.wndEquipment = None
-
-		ui.ScriptWindow.__init__(self)
-
-		self.isOpenedBeltWindowWhenClosingInventory = 0 # ÀÎº¥Åä¸® ´ÝÀ» ¶§ º§Æ® ÀÎº¥Åä¸®°¡ ¿­·ÁÀÖ¾ú´ÂÁö ¿©ºÎ-_-; ³×ÀÌ¹Ö ¤¸¤µ
-
-		self.__LoadWindow()
-
-		self.IsClickBeltInventory = False
-
-	def __del__(self):
-		ui.ScriptWindow.__del__(self)
-		if app.ENABLE_GEM_SYSTEM:
-			self.wndExpandedMoneyBar = None
-			self.wndGem = None
-
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.wndEquipment = None
-
-	def SetClickBeltInventory(self, isclick):
-		self.IsClickBeltInventory = isclick
-
-	def Show(self):
-		self.__LoadWindow()
-
-		ui.ScriptWindow.Show(self)
-
-		self.RefreshItemSlot()
-		self.RefreshStatus()
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			# ÀÎº¥Åä¸®¸¦ ´ÝÀ» ¶§ ÄÚ½ºÃõÀÌ ¿­·ÁÀÖ¾ú´Ù¸é ÀÎº¥Åä¸®¸¦ ¿­ ¶§ ÄÚ½ºÃõµµ °°ÀÌ ¿­µµ·Ï ÇÔ.
-			if self.isOpenedCostumeWindowWhenClosingInventory and self.wndCostume:
-				self.wndCostume.Show()
-
-			# ÀÎº¥Åä¸®¸¦ ´ÝÀ» ¶§ º§Æ® ÀÎº¥Åä¸®°¡ ¿­·ÁÀÖ¾ú´Ù¸é °°ÀÌ ¿­µµ·Ï ÇÔ.
-			if self.wndBelt:
-				self.wndBelt.Show(self.isOpenedBeltWindowWhenClosingInventory)
-
-		if app.ENABLE_GEM_SYSTEM:
-			if self.wndExpandedMoneyBar:
-				self.wndExpandedMoneyBar.Show()
-
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			if self.wndEquipment:
-				self.wndEquipment.Show()
-
-	def BindInterfaceClass(self, interface):
-		from _weakref import proxy
-		self.interface = proxy(interface)
-
-	if app.WJ_ENABLE_TRADABLE_ICON:
-		def BindWindow(self, wnd):
-			self.bindWnds.append(wnd)
-
-	def __LoadWindow(self):
-		if self.isLoaded == 1:
-			return
-
-		self.isLoaded = 1
-
-		try:
-			pyScrLoader = ui.PythonScriptLoader()
-			pyScrLoader.LoadScriptFile(self, uiScriptLocale.LOCALE_COMMON_UISCRIPT_PATH + "InventoryWindow.py")
-		except:
-			import exception
-			exception.Abort("InventoryWindow.LoadWindow.LoadObject")
-
-		try:
-			wndItem = self.GetChild("ItemSlot")
-			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-				wndEquip = self.GetChild("EquipmentSlot")
-			self.GetChild("TitleBar").SetCloseEvent(ui.__mem_func__(self.Close))
-			self.wndMoney = self.GetChild("Money")
-			self.wndMoneySlot = self.GetChild("Money_Slot")
-			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-				self.mallButton = self.GetChild2("MallButton")
-				self.DSSButton = self.GetChild2("DSSButton")
-				self.costumeButton = self.GetChild2("CostumeButton")
-
-			if app.ENABLE_CHEQUE_SYSTEM:
-				self.wndCheque = self.GetChild("Cheque")
-				self.wndChequeSlot = self.GetChild("Cheque_Slot")
-
-				if app.ENABLE_GEM_SYSTEM:
-					self.wndMoneyIcon = self.GetChild("Money_Icon")
-					self.wndChequeIcon = self.GetChild("Cheque_Icon")
-					self.wndMoneyIcon.Hide()
-					self.wndMoneySlot.Hide()
-					self.wndChequeIcon.Hide()
-					self.wndChequeSlot.Hide()
-
-					## ³ôÀÌ Á¶Àý
-					height = self.GetHeight()
-					width = self.GetWidth()
-					self.SetSize(width, height - 22)
-					self.GetChild("board").SetSize(width, height - 22)
-
-				else:
-					self.wndMoneyIcon = self.GetChild("Money_Icon")
-					self.wndChequeIcon = self.GetChild("Cheque_Icon")
-
-					self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 0)
-					self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 1)
-
-					self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 0)
-					self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 1)
-
-					self.toolTip = uiToolTip.ToolTip()
-					self.toolTip.ClearToolTip()
-
-			self.inventoryTab = []
-			self.inventoryTab.append(self.GetChild("Inventory_Tab_01"))
-			self.inventoryTab.append(self.GetChild("Inventory_Tab_02"))
-			self.inventoryTab.append(self.GetChild("Inventory_Tab_03"))
-			self.inventoryTab.append(self.GetChild("Inventory_Tab_04"))
-
-			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-				self.equipmentTab = []
-				self.equipmentTab.append(self.GetChild("Equipment_Tab_01"))
-				self.equipmentTab.append(self.GetChild("Equipment_Tab_02"))
-
-				# Belt Inventory Window
-				self.wndBelt = None
-
-			self.dlgQuestion = uiCommon.QuestionDialog2()
-			self.dlgQuestion.Close()
-
-			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-				self.wndBelt = BeltInventoryWindow(self)
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				self.listHighlightedAcceSlot = []
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				self.listHighlightedChangeLookSlot = []
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				self.listHighlightedAuraSlot = []
-
-			if app.ENABLE_CUBE_RENEWAL:
-				self.listHighlightedCubeSlot = []
-
-			if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-				self.listHighlightedSlot = []
-
-			if app.ENABLE_EXTEND_INVEN_SYSTEM:
-				self.ExInvenQuestionDlg = uiCommon.QuestionDialog()
-				self.ExInvenQuestionDlg.Close()
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				self.clear_aura_item_question_dialog = None
-
-			if app.ENABLE_GEM_CONVERTER:
-				self.gem_converter_question_dialog = None
-				self.gem_converter_item_pos = (-1, -1)
-
-			if app.ENABLE_GROWTH_PET_SYSTEM:
-				self.PetItemQuestionDlg = uiCommon.QuestionDialog()
-				self.PetItemQuestionDlg.Close()
-
-				self.PetSkillDelDlg = uiCommon.QuestionDialog2()
-				self.PetSkillDelDlg.Close()
-				self.PetSkillAllDelBookIndex = -1
-		except:
-			import exception
-			exception.Abort("InventoryWindow.LoadWindow.BindObject")
-
-		## Item
-		wndItem.SetSelectEmptySlotEvent(ui.__mem_func__(self.SelectEmptySlot), player.INVENTORY)
-		wndItem.SetSelectItemSlotEvent(ui.__mem_func__(self.SelectItemSlot), player.INVENTORY)
-		wndItem.SetUnselectItemSlotEvent(ui.__mem_func__(self.UseItemSlot), player.INVENTORY)
-		wndItem.SetUseSlotEvent(ui.__mem_func__(self.UseItemSlot), player.INVENTORY)
-		wndItem.SetOverInItemEvent(ui.__mem_func__(self.OverInItem), player.INVENTORY)
-		wndItem.SetOverOutItemEvent(ui.__mem_func__(self.OverOutItem))
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			## Equipment
-			wndEquip.SetSelectEmptySlotEvent(ui.__mem_func__(self.SelectEmptySlot), player.EQUIPMENT)
-			wndEquip.SetSelectItemSlotEvent(ui.__mem_func__(self.SelectItemSlot), player.EQUIPMENT)
-			wndEquip.SetUnselectItemSlotEvent(ui.__mem_func__(self.UseItemSlot), player.EQUIPMENT)
-			wndEquip.SetUseSlotEvent(ui.__mem_func__(self.UseItemSlot), player.EQUIPMENT)
-			wndEquip.SetOverInItemEvent(ui.__mem_func__(self.OverInItem), player.EQUIPMENT)
-			wndEquip.SetOverOutItemEvent(ui.__mem_func__(self.OverOutItem))
-
-		## PickMoneyDialog
-		dlgPickMoney = uiPickMoney.PickMoneyDialog()
-		dlgPickMoney.LoadDialog()
-		dlgPickMoney.Hide()
-
-		## PickETCDialog
-		if app.ENABLE_CHEQUE_SYSTEM:
-			dlgPickETC = uiPickETC.PickETCDialog()
-			dlgPickETC.LoadDialog()
-			dlgPickETC.Hide()
-			self.dlgPickETC = dlgPickETC
-
-		## RefineDialog
-		self.refineDialog = uiRefine.RefineDialog()
-		self.refineDialog.Hide()
-
-		## AttachMetinDialog
-		self.attachMetinDialog = uiAttachMetin.AttachMetinDialog()
-		self.attachMetinDialog.Hide()
-
-		## MoneySlot
-		if app.ENABLE_CHEQUE_SYSTEM:
-			self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 0)
-			self.wndChequeSlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 1)
-		else:
-			self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog))
-
-		for inven_index in range(player.INVENTORY_PAGE_COUNT): ## 0, 1, 2, 3
-			self.inventoryTab[inven_index].SetEvent(lambda arg = inven_index : self.SetInventoryPage(arg))
-		self.inventoryTab[0].Down()
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.equipmentTab[0].SetEvent(lambda arg = 0: self.SetEquipmentPage(arg))
-			self.equipmentTab[1].SetEvent(lambda arg = 1: self.SetEquipmentPage(arg))
-			self.equipmentTab[0].Down()
-			self.equipmentTab[0].Hide()
-			self.equipmentTab[1].Hide()
-
-		## MT-436 slot bug fix
-		wndItem.SetSlotType(player.SLOT_TYPE_INVENTORY)
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			wndEquip.SetSlotType(player.SLOT_TYPE_EQUIPMENT)
-
-		self.wndItem = wndItem
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.wndEquip = wndEquip
-		self.dlgPickMoney = dlgPickMoney
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			# MallButton
-			if self.mallButton:
-				self.mallButton.SetEvent(ui.__mem_func__(self.ClickMallButton))
-
-			if self.DSSButton:
-				self.DSSButton.SetEvent(ui.__mem_func__(self.ClickDSSButton))
-
-			# Costume Button
-			if self.costumeButton:
-				self.costumeButton.SetEvent(ui.__mem_func__(self.ClickCostumeButton))
-
-			self.wndCostume = None
-
-		if app.ENABLE_EXTEND_INVEN_SYSTEM:
-			## Extend Inven Button
-			self.__CreateExtendInvenButton()
-
-		## Refresh
-		self.SetInventoryPage(0)
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.SetEquipmentPage(0)
-		self.RefreshItemSlot()
-		self.RefreshStatus()
-
-	def Destroy(self):
-		self.ClearDictionary()
-
-		self.dlgPickMoney.Destroy()
-		self.dlgPickMoney = 0
-
-		if app.ENABLE_CHEQUE_SYSTEM:
-			self.dlgPickETC.Destroy()
-			self.dlgPickETC = 0
-
-		self.refineDialog.Destroy()
-		self.refineDialog = 0
-
-		self.attachMetinDialog.Destroy()
-		self.attachMetinDialog = 0
-
-		self.tooltipItem = None
-		self.wndItem = 0
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.wndEquip = 0
-		self.dlgPickMoney = 0
-		self.wndMoney = 0
-		self.wndMoneySlot = 0
-		self.questionDialog = None
-		self.mallButton = None
-		self.DSSButton = None
-		self.interface = None
-		if app.WJ_ENABLE_TRADABLE_ICON:
-			self.bindWnds = []
-
-		if app.ENABLE_CHEQUE_SYSTEM:
-			self.wndCheque = 0
-			self.wndChequeSlot = 0
-			self.dlgPickETC = 0
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			if self.wndCostume:
-				self.wndCostume.Destroy()
-				self.wndCostume = 0
-
-			if self.wndBelt:
-				self.wndBelt.Destroy()
-				self.wndBelt = None
-
-		self.inventoryTab = []
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.equipmentTab = []
-
-		if app.ENABLE_EXTEND_INVEN_SYSTEM:
-			self.ExInvenButton = []
-
-			if self.ExInvenQuestionDlg:
-				self.ExInvenQuestionDlg.Close()
-
-		if app.ENABLE_AURA_COSTUME_SYSTEM:
-			if self.clear_aura_item_question_dialog:
-				self.clear_aura_item_question_dialog.Close()
-			self.clear_aura_item_question_dialog = None
-
-		if app.ENABLE_GEM_CONVERTER:
-			if self.gem_converter_question_dialog:
-				self.gem_converter_question_dialog.Close()
-			self.gem_converter_question_dialog = None
-
-		if self.pop:
-			self.pop.Destroy()
-			self.pop = None
-
-		if app.ENABLE_GEM_SYSTEM:
-			self.wndExpandedMoneyBar = None
-
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			if self.petHatchingWindow:
-				self.petHatchingWindow = None
-
-			if self.petFeedWindow:
-				self.petFeedWindow = None
-
-			if self.petNameChangeWindow:
-				self.petNameChangeWindow = None
-
-	def Hide(self):
-		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS():
-			self.OnCloseQuestionDialog()
-			return
-
-		if None != self.tooltipItem:
-			self.tooltipItem.HideToolTip()
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			if self.wndCostume:
-				self.isOpenedCostumeWindowWhenClosingInventory = self.wndCostume.IsShow() # ÀÎº¥Åä¸® Ã¢ÀÌ ´ÝÈú ¶§ ÄÚ½ºÃõÀÌ ¿­·Á ÀÖ¾ú´Â°¡?
-				self.wndCostume.Close()
-
-			if self.wndBelt:
-				self.isOpenedBeltWindowWhenClosingInventory = self.wndBelt.IsOpeningInventory() # ÀÎº¥Åä¸® Ã¢ÀÌ ´ÝÈú ¶§ º§Æ® ÀÎº¥Åä¸®µµ ¿­·Á ÀÖ¾ú´Â°¡?
-				#print "Is Opening Belt Inven?? ", self.isOpenedBeltWindowWhenClosingInventory
-				self.wndBelt.Close()
-
-		if self.dlgPickMoney:
-			self.dlgPickMoney.Close()
-
-		if app.ENABLE_CHEQUE_SYSTEM:
-			if self.dlgPickETC:
-				self.dlgPickETC.Close()
-
-		if app.ENABLE_GEM_SYSTEM:
-			if self.wndExpandedMoneyBar:
-				self.wndExpandedMoneyBar.Close()
-
-		wndMgr.Hide(self.hWnd)
-
-	def Close(self):
-		self.Hide()
-
-	if app.ENABLE_GEM_SYSTEM:
-		def SetExpandedMoneyBar(self, wndBar):
-			self.wndExpandedMoneyBar = wndBar
-
-			if self.wndExpandedMoneyBar:
-				self.wndMoneySlot = self.wndExpandedMoneyBar.GetMoneySlot()
-				self.wndMoney = self.wndExpandedMoneyBar.GetMoney()
-
-				if app.ENABLE_CHEQUE_SYSTEM:
-					## ¾ç °ü·Ã
-					self.wndMoneyIcon = self.wndExpandedMoneyBar.GetMoneyIcon()
-					if self.wndMoneyIcon:
-						self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 0)
-						self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 0)
-					if self.wndMoneySlot:
-						self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 0)
-
-					## 2Â÷È­Æó °ü·Ã
-					self.wndChequeIcon = self.wndExpandedMoneyBar.GetChequeIcon()
-					if self.wndChequeIcon:
-						self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 1)
-						self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 1)
-					self.wndChequeSlot = self.wndExpandedMoneyBar.GetChequeSlot()
-					if self.wndChequeSlot:
-						self.wndChequeSlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 1)
-					self.wndCheque = self.wndExpandedMoneyBar.GetCheque()
-
-					## º¸¼® °ü·Ã
-					self.wndGemIcon = self.wndExpandedMoneyBar.GetGemIcon()
-					if self.wndGemIcon:
-						self.wndGemIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 2)
-						self.wndGemIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 2)
-					self.wndGem = self.wndExpandedMoneyBar.GetGem()
-
-					self.toolTip = uiToolTip.ToolTip()
-					self.toolTip.ClearToolTip()
-				else:
-					if self.wndMoneySlot:
-						self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog))
-
-	def SetInventoryPage(self, page):
-		self.inventoryPageIndex = page
-
-		for index in range(len(self.inventoryTab)):
-			if index == page:
-				continue
-
-			self.inventoryTab[index].SetUp()
-
-		self.RefreshBagSlotWindow()
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		## Extend Inven Button
-		def __CreateExtendInvenButton(self):
-			parent = self.GetChild("board")
-
-			self.ExInvenButton = []
-			start_x = 8
-			start_y = 246
-			if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-				start_y = 55
-			img_height = 32
-
-			for button_index in range(player.EX_INVENTORY_STAGE_MAX): ## 18
-				ex_inven_button = ui.Button()
-
-				increase_y = img_height * (button_index % (player.EX_INVENTORY_STAGE_MAX / player.EX_INVENTORY_PAGE_COUNT))
-
-				ex_inven_button.SetParent(parent)
-				ex_inven_button.SetPosition(start_x, start_y + increase_y)
-				ex_inven_button.SetUpVisual(EX_INVEN_COVER_IMG_CLOSE)
-				ex_inven_button.SetOverVisual(EX_INVEN_COVER_IMG_CLOSE)
-				ex_inven_button.SetDownVisual(EX_INVEN_COVER_IMG_CLOSE)
-				ex_inven_button.SetDisableVisual(EX_INVEN_COVER_IMG_CLOSE)
-				ex_inven_button.SetEvent(ui.__mem_func__(self.__ClickExtendInvenButton), button_index + 1)
-				ex_inven_button.Hide()
-				self.ExInvenButton.append(ex_inven_button)
-
-		def __ClickExtendInvenButton(self, index):
-			net.SendExtendInvenButtonClick(index)
-
-		def __HideAllExtendInvenButton(self):
-			for index in range(len(self.ExInvenButton)):
-				self.ExInvenButton[index].Hide()
-
-		def __ShowExtendInvenButton(self, cur_stage):
-			## self.inventoryPageIndex ´Â 0,1,2,3 ¶ó¼­ EX_INVENTORY_PAGE_START -1 À» »ç¿ëÇÑ´Ù.
-			if self.inventoryPageIndex < player.EX_INVENTORY_PAGE_START - 1:
-				return
-
-			## ÇÑ ÆäÀÌÁö ´ç º¸¿©ÁÙ ´Ü°è¼ö
-			count = player.EX_INVENTORY_STAGE_MAX / player.EX_INVENTORY_PAGE_COUNT
-
-			## ÃÖ¼Ò, ÃÖ´ë
-			min_range = (self.inventoryPageIndex - player.EX_INVENTORY_PAGE_START + 1) * count
-			max_range = min_range + count
-
-			for button_index in range(min_range, max_range):
-				if button_index == cur_stage:
-					self.ExInvenButton[button_index].SetUpVisual(EX_INVEN_COVER_IMG_OPEN)
-					self.ExInvenButton[button_index].SetOverVisual(EX_INVEN_COVER_IMG_OPEN)
-					self.ExInvenButton[button_index].SetDownVisual(EX_INVEN_COVER_IMG_OPEN)
-					self.ExInvenButton[button_index].SetDisableVisual(EX_INVEN_COVER_IMG_OPEN)
-
-				if button_index < cur_stage:
-					self.ExInvenButton[button_index].Hide()
-				else:
-					self.ExInvenButton[button_index].Show()
-
-		def ExInvenItemUseMsg(self, item_vnum, msg, enough_count):
-			## °³¼ö ºÎÁ·
-			if player.EX_INVEN_FAIL_FALL_SHORT == msg:
-				self.__OpenExInvenFallShortCountMsgDlg(enough_count)
-
-			## °³¼ö°¡ ÃæºÐÇÔ
-			elif player.EX_INVEN_SUCCESS == msg:
-				self.__OpenExInvenQuestionDlg(enough_count)
-
-			## 4¹øÆäÀÌÁö ¸¶Áö¸·ÀÓ
-			elif player.EX_INVEN_FAIL_FOURTH_PAGE_STAGE_MAX == msg:
-				self.__OpenExInvenMsgDlg(localeInfo.EXINVEN_USE_ITEM_FAIL_FOURTH_PAGE_STAGE_MAX)
-				return
-
-			else:
-				return
-
-		def __OpenExInvenMsgDlg(self, msg):
-			popup = uiCommon.PopupDialog()
-			popup.SetText(msg)
-			popup.SetAcceptEvent(self.__OnClosePopupDialog)
-			w, h = popup.GetTextSize()
-			popup.SetWidth(w + 40)
-			line_count = popup.GetTextLineCount()
-
-			if line_count > 1:
-				height = popup.GetLineHeight()
-				popup.SetLineHeight(height + 3)
-
-			popup.Open()
-
-			if self.pop:
-				self.pop.Destroy()
-
-			self.pop = popup
-
-		def __OpenExInvenFallShortCountMsgDlg(self, enough_count):
-			popup = uiCommon.PopupDialog()
-			popup.SetText(localeInfo.EXINVEN_USE_ITEM_FAIL_FALL_SHORT % (enough_count))
-			popup.SetAcceptEvent(self.__OnClosePopupDialog)
-			popup.Open()
-
-			if self.pop:
-				self.pop.Destroy()
-
-			self.pop = popup
-
-		def __OpenExInvenQuestionDlg(self, enough_count):
-			if self.ExInvenQuestionDlg:
-				self.ExInvenQuestionDlg.SetText(localeInfo.EXINVEN_USE_ITEM_QUESTION % enough_count)
-				self.ExInvenQuestionDlg.SetAcceptEvent(ui.__mem_func__(self.__AcceptExInvenItemUse))
-				self.ExInvenQuestionDlg.SetCancelEvent(ui.__mem_func__(self.__CancelExInvenItemUse))
-				w, h = self.ExInvenQuestionDlg.GetTextSize()
-				self.ExInvenQuestionDlg.SetWidth(w + 40)
-				self.ExInvenQuestionDlg.Open()
-
-		def __AcceptExInvenItemUse(self):
-			net.SendExtendInvenUpgrade()
-			self.ExInvenQuestionDlg.Close()
-
-		def __CancelExInvenItemUse(self):
-			self.ExInvenQuestionDlg.Close()
-
-	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-		def SetEquipmentPage(self, page):
-			self.equipmentPageIndex = page
-			self.equipmentTab[1 - page].SetUp()
-			self.RefreshEquipSlotWindow()
-
-		def ClickMallButton(self):
-			net.SendCommandPacket("/click_mall")
-
-		# DSSButton
-		def ClickDSSButton(self):
-			self.interface.ToggleDragonSoulWindow()
-
-		def ClickCostumeButton(self):
-			if self.wndCostume:
-				if self.wndCostume.IsShow():
-					self.wndCostume.Hide()
-				else:
-					self.wndCostume.Show()
-			else:
-				self.wndCostume = CostumeWindow(self)
-				self.wndCostume.Show()
-
-		def ShowCostumeInventory(self):
-			if self.wndCostume:
-				if not self.wndCostume.IsShow():
-					self.wndCostume.Show()
-			else:
-				self.wndCostume = CostumeWindow(self)
-				self.wndCostume.Show()
-
-	def OpenPickMoneyDialog(self, focus_idx = 0):
-		if mouseModule.mouseController.isAttached():
-			attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
-			if player.SLOT_TYPE_SAFEBOX == mouseModule.mouseController.GetAttachedType():
-				if player.ITEM_MONEY == mouseModule.mouseController.GetAttachedItemIndex():
-					net.SendSafeboxWithdrawMoneyPacket(mouseModule.mouseController.GetAttachedItemCount())
-					snd.PlaySound("sound/ui/money.wav")
-
-			mouseModule.mouseController.DeattachObject()
-		else:
-			curMoney = player.GetElk()
-			curCheque = player.GetCheque()
-
-			if curMoney <= 0 and curCheque <= 0:
-				return
-
-			self.dlgPickMoney.SetTitleName(localeInfo.PICK_MONEY_TITLE)
-			self.dlgPickMoney.SetAcceptEvent(ui.__mem_func__(self.OnPickMoney))
-			self.dlgPickMoney.Open(curMoney, curCheque)
-			self.dlgPickMoney.SetMax(7) # ÀÎº¥Åä¸® 990000 Á¦ÇÑ ¹ö±× ¼öÁ¤
-			if app.ENABLE_CHEQUE_SYSTEM:
-				self.dlgPickMoney.SetFocus(focus_idx)
-
-	if app.ENABLE_CHEQUE_SYSTEM:
-		def OnPickMoney(self, money, cheque):
-			mouseModule.mouseController.AttachMoney(self, player.SLOT_TYPE_INVENTORY, money, cheque)
-	else:
-		def OnPickMoney(self, money):
-			mouseModule.mouseController.AttachMoney(self, player.SLOT_TYPE_INVENTORY, money)
-
-	def OnPickItem(self, count):
-		if app.ENABLE_CHEQUE_SYSTEM:
-			itemSlotWindow = self.dlgPickETC.itemGlobalSlotWindow
-			itemSlotIndex = self.dlgPickETC.itemGlobalSlotIndex
-		else:
-			itemSlotWindow = self.dlgPickMoney.itemGlobalSlotWindow
-			itemSlotIndex = self.dlgPickMoney.itemGlobalSlotIndex
-
-		selectedItemVNum = player.GetItemIndex(itemSlotWindow, itemSlotIndex)
-		slotType = player.WindowTypeToSlotType(itemSlotWindow)
-		mouseModule.mouseController.AttachObject(self, slotType, itemSlotIndex, selectedItemVNum, count)
-
-	def __InventoryLocalSlotPosToGlobalSlotPos(self, local, window_type = player.INVENTORY):
-		if player.INVENTORY == window_type:
-			return self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE + local
-		else:
-			return local
-
-	def RefreshBagSlotWindow(self):
-		if not self.wndItem:
-			return
-
-		getItemVNum = player.GetItemIndex
-		getItemCount = player.GetItemCount
-		setItemVNum = self.wndItem.SetItemSlot
-
-		## ¸®ÇÁ·¹½¬ ÇÏ±âÀü¿¡ ÇÏÀÌ¶óÀÌÆ® ¸ðµÎ ²ö´Ù.
-		for i in xrange(self.wndItem.GetSlotCount()):
-			self.wndItem.DeactivateSlot(i)
-
-		if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_MAILBOX:
-			if self.interface:
-				onTopWindow = self.interface.GetOnTopWindow()
-
-		for i in xrange(player.INVENTORY_PAGE_SIZE):
-			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
-
-			itemCount = getItemCount(slotNumber)
-			# itemCount == 0ÀÌ¸é ¼ÒÄÏÀ» ºñ¿î´Ù.
-			if 0 == itemCount:
-				self.wndItem.ClearSlot(i)
-				continue
-			elif 1 == itemCount:
-				itemCount = 0
-
-			itemVnum = getItemVNum(slotNumber)
-			setItemVNum(i, itemVnum, itemCount)
-
-			## ÀÚµ¿¹°¾à (HP: #72723 ~ #72726, SP: #72727 ~ #72730) Æ¯¼öÃ³¸® - ¾ÆÀÌÅÛÀÎµ¥µµ ½½·Ô¿¡ È°¼ºÈ­/ºñÈ°¼ºÈ­ Ç¥½Ã¸¦ À§ÇÑ ÀÛ¾÷ÀÓ - [hyo]
-			if constInfo.IS_AUTO_POTION(itemVnum):
-				# metinSocket - [0] : È°¼ºÈ­ ¿©ºÎ, [1] : »ç¿ëÇÑ ¾ç, [2] : ÃÖ´ë ¿ë·®
-				metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]
-				tempSlotNum = slotNumber
-				if tempSlotNum >= player.INVENTORY_PAGE_SIZE:
-					tempSlotNum -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
-
-				isActivated = 0 != metinSocket[0]
-
-				if isActivated:
-					self.wndItem.ActivateSlot(tempSlotNum)
-
-					potionType = 0
-					if constInfo.IS_AUTO_POTION_HP(itemVnum):
-						potionType = player.AUTO_POTION_TYPE_HP
-					elif constInfo.IS_AUTO_POTION_SP(itemVnum):
-						potionType = player.AUTO_POTION_TYPE_SP
-
-					player.SetAutoPotionInfo(potionType, player.INVENTORY, slotNumber)
-				else:
-					self.wndItem.DeactivateSlot(tempSlotNum)
-
-			if app.ENABLE_GROWTH_PET_SYSTEM:
-				if constInfo.IS_PET_ITEM(itemVnum):
-					self.__ActivePetHighlightSlot(slotNumber)
-					self.__SetCoolTimePetItemSlot(slotNumber, itemVnum)
-
-			if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_MAILBOX:
-				if itemVnum and self.interface and onTopWindow:
-					if self.interface.MarkUnusableInvenSlotOnTopWnd(onTopWindow, slotNumber):
-						self.wndItem.SetUnusableSlotOnTopWnd(i)
-					else:
-						self.wndItem.SetUsableSlotOnTopWnd(i)
-				else:
-					self.wndItem.SetUsableSlotOnTopWnd(i)
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if not player.GetChangeLookVnum(player.INVENTORY, slotNumber) == 0:
-					self.wndItem.SetSlotCoverImage(i, "icon/item/ingame_convert_Mark.tga")
-				else:
-					self.wndItem.EnableSlotCoverImage(i, False)
-
-			if app.ENABLE_GEM_CONVERTER:
-				if slotNumber in self.gem_converter_item_pos:
-					self.wndItem.SetCantMouseEventSlot(i)
-
-			if app.ENABLE_SOUL_SYSTEM:
-				if item.IsSoulItem(itemVnum):
-					metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]
-					tempSlotNum = slotNumber
-					if tempSlotNum >= player.INVENTORY_PAGE_SIZE:
-						tempSlotNum -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
-
-					if 0 != metinSocket[1]:
-						self.wndItem.ActivateSlot(tempSlotNum)
-					else:
-						self.wndItem.DeactivateSlot(tempSlotNum)
-
-			## [MT-662] ÀÏ¹ÝÆê ¼ÒÈ¯Ç¥½Ã ¸¶Å©
-			if (item.ITEM_TYPE_QUEST == item.GetItemType() and item.QUEST_PET_PAY == item.GetItemSubType()) or\
-				(item.ITEM_TYPE_PET == item.GetItemType() and item.PET_PAY == item.GetItemSubType()):
-				metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]
-				tempSlotNum = slotNumber
-				if tempSlotNum >= player.INVENTORY_PAGE_SIZE:
-					tempSlotNum -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
-				if 0 != metinSocket[1]:
-					self.wndItem.ActivateSlot(tempSlotNum)
-				else:
-					self.wndItem.DeactivateSlot(tempSlotNum)
-
-		self.__HighlightSlot_Refresh()
-
-		if app.ENABLE_EXTEND_INVEN_SYSTEM:
-			self.__RefreshExinvenCoverSlot()
-			self.__RefreshExinvenSlotState()
-
-		self.wndItem.RefreshSlot()
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			if self.wndBelt:
-				self.wndBelt.RefreshSlot()
-
-		if app.WJ_ENABLE_TRADABLE_ICON:
-			map(lambda wnd:wnd.RefreshLockedSlot(), self.bindWnds)
-
-	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-		def RefreshEquipSlotWindow(self):
-			getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
-			getItemCount = ReprGetItemCount(player.EQUIPMENT)
-			setItemVNum = self.wndEquip.SetItemSlot
-
-			for i in xrange(player.WEAR_MAX): ## 32 ( 0 ~ 31 )
-				itemCount = getItemCount(i)
-				if itemCount <= 1:
-					itemCount = 0
-				setItemVNum(i, getItemVNum(i), itemCount)
-
-				if app.ENABLE_CHANGE_LOOK_SYSTEM:
-					if not player.GetChangeLookVnum(player.EQUIPMENT, i) == 0:
-						self.wndEquip.SetSlotCoverImage(i, "icon/item/ingame_convert_Mark.tga")
-					else:
-						self.wndEquip.EnableSlotCoverImage(i,False)
-
-			self.wndEquip.RefreshSlot()
-
-			if self.wndCostume:
-				self.wndCostume.RefreshCostumeSlot()
-
-	def RefreshItemSlot(self):
-		self.RefreshBagSlotWindow()
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			self.RefreshEquipSlotWindow()
-
-	if app.ENABLE_EXTEND_INVEN_SYSTEM:
-		def __RefreshExinvenCoverSlot(self):
-			cur_stage = player.GetExtendInvenStage()
-
-			self.__HideAllExtendInvenButton()
-			self.__ShowExtendInvenButton(cur_stage)
-
-		def __RefreshExinvenSlotState(self):
-			inventory_max = player.GetExtendInvenMax()
-
-			for i in xrange(player.INVENTORY_PAGE_SIZE):
-				slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
-
-				if slotNumber >= inventory_max:
-					self.wndItem.LockSlot(i)
-				else:
-					self.wndItem.UnlockSlot(i)
-
-	def RefreshStatus(self):
-		money = player.GetElk()
-		self.wndMoney.SetText(localeInfo.NumberToMoneyString(money))
-
-		if app.ENABLE_CHEQUE_SYSTEM:
-			cheque = player.GetCheque()
-			self.wndCheque.SetText(str(cheque))
-
-		if app.ENABLE_GEM_SYSTEM:
-			if self.wndGem:
-				gem = player.GetGem()
-				self.wndGem.SetText(localeInfo.NumberToMoneyString(gem))
-
-	def SetItemToolTip(self, tooltipItemvalue):
-		from _weakref import proxy
-		self.tooltipItem = proxy(tooltipItemvalue)
-
-	def SellItem(self):
-		if self.sellingSlotitemIndex == player.GetItemIndex(self.sellingSlotWindow, self.sellingSlotNumber):
-			if self.sellingSlotitemCount == player.GetItemCount(self.sellingSlotWindow, self.sellingSlotNumber):
-				## ¿ëÈ¥¼®µµ ÆÈ¸®°Ô ÇÏ´Â ±â´É Ãß°¡ÇÏ¸é¼­ ÀÎÀÚ type Ãß°¡
-				net.SendShopSellPacketNew(self.sellingSlotNumber, self.questionDialog.count, self.sellingSlotWindow)
-				snd.PlaySound("sound/ui/money.wav")
-		self.OnCloseQuestionDialog()
-
-	def OnDetachMetinFromItem(self):
-		if None == self.questionDialog:
-			return
-
-		self.__SendUseItemToItemPacket(self.questionDialog.sourceWindow, self.questionDialog.sourcePos, self.questionDialog.targetWindow, self.questionDialog.targetPos)
-		self.OnCloseQuestionDialog()
-
-	def OnCloseQuestionDialog(self):
-		if not self.questionDialog:
-			return
-
-		self.questionDialog.Close()
-		self.questionDialog = None
-		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-	## Slot Event
-	def SelectEmptySlot(self, selectedSlotPos, selectedSlotWindow):
-		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS() == 1:
-			return
-
-		## ¾Ç¼¼¼­¸® Ã¢ÀÌ ¿­·ÁÀÖÀ¸¸é
-		## ¾ÆÀÌÅÛ ÀÌµ¿ ±ÝÁö.
-		if app.ENABLE_ACCE_COSTUME_SYSTEM:
-			if player.GetAcceRefineWindowOpen():
-				return
-
-		if app.ENABLE_CHANGE_LOOK_SYSTEM:
-			if player.GetChangeLookWindowOpen():
-				return
-
-		if app.ENABLE_AURA_COSTUME_SYSTEM:
-			if player.IsAuraWindowOpen():
-				return
-
-		if app.ENABLE_ATTR_6TH_7TH:
-			if self.interface.wndAttr67Add.IsShow():
-				return
-
-		selectedSlotPos = self.__InventoryLocalSlotPosToGlobalSlotPos(selectedSlotPos, selectedSlotWindow)
-
-		if mouseModule.mouseController.isAttached():
-			attachedSlotType = mouseModule.mouseController.GetAttachedType()
-			attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
-			attachedItemCount = mouseModule.mouseController.GetAttachedItemCount()
-			attachedItemIndex = mouseModule.mouseController.GetAttachedItemIndex()
-
-			if player.SLOT_TYPE_INVENTORY == attachedSlotType:
-				if attachedSlotPos >= player.ITEM_SLOT_COUNT:
-					mouseModule.mouseController.DeattachObject()
-					return
-
-				self.__SendMoveItemPacket(player.INVENTORY, attachedSlotPos, selectedSlotWindow, selectedSlotPos, attachedItemCount)
-
-				if item.IsRefineScroll(attachedItemIndex):
-					self.interface.SetUseItemMode(False)
-
-			elif player.SLOT_TYPE_EQUIPMENT == attachedSlotType:
-				if attachedSlotPos >= player.WEAR_MAX:
-					mouseModule.mouseController.DeattachObject()
-					return
-
-				self.__SendMoveItemPacket(player.EQUIPMENT, attachedSlotPos, selectedSlotWindow, selectedSlotPos, attachedItemCount)
-
-			elif player.SLOT_TYPE_BELT_INVENTORY == attachedSlotType:
-				if attachedSlotPos >= item.BELT_INVENTORY_SLOT_COUNT:
-					mouseModule.mouseController.DeattachObject()
-					return
-
-				self.__SendMoveItemPacket(player.BELT_INVENTORY, attachedSlotPos, selectedSlotWindow, selectedSlotPos, attachedItemCount)
-
-			elif player.SLOT_TYPE_PRIVATE_SHOP == attachedSlotType:
-				mouseModule.mouseController.RunCallBack("INVENTORY")
-
-			elif player.SLOT_TYPE_SHOP == attachedSlotType:
-				net.SendShopBuyPacket(attachedSlotPos)
-
-			elif player.SLOT_TYPE_SAFEBOX == attachedSlotType:
-				if player.ITEM_MONEY == attachedItemIndex:
-					net.SendSafeboxWithdrawMoneyPacket(mouseModule.mouseController.GetAttachedItemCount())
-					snd.PlaySound("sound/ui/money.wav")
-				else:
-					net.SendSafeboxCheckoutPacket(attachedSlotPos, selectedSlotWindow, selectedSlotPos)
-
-			elif player.SLOT_TYPE_MALL == attachedSlotType:
-				net.SendMallCheckoutPacket(attachedSlotPos, selectedSlotWindow, selectedSlotPos)
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if player.SLOT_TYPE_ACCE == attachedSlotType:
-					#net.SendAcceRefineCheckOut(attachedSlotPos)
-					pass
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if player.SLOT_TYPE_CHANGE_LOOK == attachedSlotType:
-					#net.SendChangeLookCheckOut(attachedSlotPos)
-					pass
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if player.SLOT_TYPE_AURA == attachedSlotType:
-					#net.SendAuraRefineCheckOut(attachedSlotPos)
-					pass
-
-			mouseModule.mouseController.DeattachObject()
-
-	def SelectItemSlot(self, itemSlotIndex, window_type):
-		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS() == 1:
-			return
-
-		itemSlotIndex = self.__InventoryLocalSlotPosToGlobalSlotPos(itemSlotIndex, window_type)
-
-		if mouseModule.mouseController.isAttached():
-			attachedSlotType = mouseModule.mouseController.GetAttachedType()
-			attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
-			attachedItemVID = mouseModule.mouseController.GetAttachedItemIndex()
-
-			if player.SLOT_TYPE_INVENTORY == attachedSlotType or\
-				player.SLOT_TYPE_BELT_INVENTORY == attachedSlotType:
-				if attachedSlotPos >= player.ITEM_SLOT_COUNT:
-					mouseModule.mouseController.DeattachObject()
-					return
-
-				attachedWindow = player.SlotTypeToInvenType(attachedSlotType)
-				self.__DropSrcItemToDestItemInInventory(attachedItemVID, attachedWindow, attachedSlotPos, window_type, itemSlotIndex)
-
-			mouseModule.mouseController.DeattachObject()
-		else:
-			curCursorNum = app.GetCursor()
-			if app.SELL == curCursorNum:
-				self.__SellItem(window_type, itemSlotIndex)
-
-			elif app.BUY == curCursorNum:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.SHOP_BUY_INFO)
-
-			elif app.IsPressed(app.DIK_LALT):
-				link = player.GetItemLink(window_type, itemSlotIndex)
-				ime.PasteString(link)
-
-			elif app.IsPressed(app.DIK_LSHIFT):
-				itemCount = player.GetItemCount(window_type, itemSlotIndex)
-
-				if itemCount > 1:
-					if app.ENABLE_CHEQUE_SYSTEM:
-						self.dlgPickETC.SetTitleName(localeInfo.PICK_ITEM_TITLE)
-						self.dlgPickETC.SetAcceptEvent(ui.__mem_func__(self.OnPickItem))
-						self.dlgPickETC.Open(itemCount)
-						self.dlgPickETC.itemGlobalSlotIndex = itemSlotIndex
-						self.dlgPickETC.itemGlobalSlotWindow = window_type
-					else:
-						self.dlgPickMoney.SetTitleName(localeInfo.PICK_ITEM_TITLE)
-						self.dlgPickMoney.SetAcceptEvent(ui.__mem_func__(self.OnPickItem))
-						self.dlgPickMoney.Open(itemCount)
-						self.dlgPickMoney.itemGlobalSlotIndex = itemSlotIndex
-						self.dlgPickMoney.itemGlobalSlotWindow = window_type
-
-				if app.ENABLE_GROWTH_PET_SYSTEM:
-					if item.GetItemType() == item.ITEM_TYPE_PET and item.GetItemSubType() == item.PET_UPBRINGING:
-						self.interface.TogglePetInformationWindow()
-						return
-
-			elif app.IsPressed(app.DIK_LCONTROL):
-				itemIndex = player.GetItemIndex(window_type, itemSlotIndex)
-
-				if True == item.CanAddToQuickSlotItem(itemIndex):
-					if window_type == player.INVENTORY:
-						player.RequestAddToEmptyLocalQuickSlot(player.SLOT_TYPE_INVENTORY, itemSlotIndex)
-					elif window_type == player.BELT_INVENTORY:
-						player.RequestAddToEmptyLocalQuickSlot(player.SLOT_TYPE_BELT_INVENTORY, itemSlotIndex)
-				else:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.QUICKSLOT_REGISTER_DISABLE_ITEM)
-
-			else:
-				selectedItemVNum = player.GetItemIndex(window_type, itemSlotIndex)
-				itemCount = player.GetItemCount(window_type, itemSlotIndex)
-				attachSlotType = player.WindowTypeToSlotType(window_type)
-
-				if app.ENABLE_GROWTH_PET_SYSTEM:
-					if self.__CanAttachGrowthPetItem(selectedItemVNum, itemSlotIndex):
-						mouseModule.mouseController.AttachObject(self, player.SLOT_TYPE_INVENTORY, itemSlotIndex, selectedItemVNum, itemCount)
-				else:
-					mouseModule.mouseController.AttachObject(self, attachSlotType, itemSlotIndex, selectedItemVNum, itemCount)
-
-				if self.__IsUsableItemToItem(selectedItemVNum, itemSlotIndex):
-					self.interface.SetUseItemMode(True)
-				else:
-					self.interface.SetUseItemMode(False)
-
-				snd.PlaySound("sound/ui/pick.wav")
-
-	def __DropSrcItemToDestItemInInventory(self, srcItemVID, srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos):
-		if srcItemSlotWindow == dstItemSlotWindow:
-			if srcItemSlotPos == dstItemSlotPos:
-				return
-
-		## ¾Ç¼¼¼­¸® Ã¢ÀÌ ¿­·ÁÀÖÀ¸¸é
-		## ¾ÆÀÌÅÛ ÀÌµ¿ ±ÝÁö.
-		if app.ENABLE_ACCE_COSTUME_SYSTEM:
-			if player.GetAcceRefineWindowOpen():
-				return
-
-		if app.ENABLE_CHANGE_LOOK_SYSTEM:
-			if player.GetChangeLookWindowOpen():
-				return
-
-		if app.ENABLE_AURA_COSTUME_SYSTEM:
-			if player.IsAuraWindowOpen():
-				return
-
-		if app.ENABLE_ATTR_6TH_7TH:
-			if self.interface.wndAttr67Add.IsShow():
-				return
-
-		## [MT-462]
-		if player.GetItemIndex(srcItemSlotWindow, srcItemSlotPos) == player.GetItemIndex(dstItemSlotWindow, dstItemSlotPos) \
-			and (player.GetItemFlags(srcItemSlotWindow, srcItemSlotPos) & item.ITEM_FLAG_STACKABLE) \
-			and player.IsEquipmentSlot(dstItemSlotWindow, dstItemSlotPos) == False:
-			self.__SendMoveItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, 0)
-			return
-
-		if app.ENABLE_SOULBIND_SYSTEM:
-			# cyh itemseal 2013 11 08
-			if item.IsSealScroll(srcItemVID):
-				if player.CanSealItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
-					self.__OpenQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-
-		useType = item.GetUseType(srcItemVID)
-
-		if item.IsRefineScroll(srcItemVID):
-			self.RefineItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-			self.interface.SetUseItemMode(False)
-
-		elif item.IsMetin(srcItemVID):
-			self.AttachMetinToItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-
-		elif item.IsDetachScroll(srcItemVID):
-			self.DetachMetinFromItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-
-		elif item.IsKey(srcItemVID):
-			self.__SendUseItemToItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-
-		elif (player.GetItemFlags(srcItemSlotPos) & ITEM_FLAG_APPLICABLE) == ITEM_FLAG_APPLICABLE:
-			self.__SendUseItemToItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-
-		elif useType in self.USE_TYPE_TUPLE:
-			if app.ENABLE_REFINE_ELEMENT_SYSTEM:
-				if "USE_ELEMENT_UPGRADE" == useType:
-					if not uiRefine.RefineElementDialog.CanRefineElementUpgrade(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, True, False):
-						return
-
-				elif "USE_ELEMENT_DOWNGRADE" == useType:
-					if not uiRefine.RefineElementDialog.CanRefineElementDowngrade(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, True, False):
-						return
-
-				elif "USE_ELEMENT_CHANGE" == useType:
-					if not uiRefine.RefineElementChangeDialog.CanRefineElementChange(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, True, False):
-						return
-
-			self.__SendUseItemToItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-
-		else:
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if item.IsAcceScroll(srcItemVID):
-					if player.CanAcceClearItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
-						self.__OpenQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-						return
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if item.IsChangeLookClearScroll(srcItemVID):
-					if dstItemSlotWindow != player.INVENTORY:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.CHANGE_LOOK_DO_NOT_EQUIP_ITEM)
-						return
-
-					if player.CanChangeLookClearItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
-						self.__OpenQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-						return
-
-			if app.ENABLE_GROWTH_PET_SYSTEM:
-				if self.__IsPetItem(srcItemVID):
-					if self.__SendUsePetItemToItemPacket(srcItemVID, srcItemSlotPos, dstItemSlotPos):
-						return
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if srcItemVID == item.ITEM_VNUM_AURA_CLEAR:
-					if player.CanAuraClearItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
-						self.__UseAuraClearItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-						return
-
-			if app.ENABLE_SET_ITEM:
-				if item.IsSetClearScroll(srcItemVID):
-					if player.CanSetItemClear(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
-						self.__OpenSetClearItemQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-						return
-
-			if app.ENABLE_GEM_CONVERTER:
-				if srcItemVID == item.ITEM_VNUM_GEM_CONVERTER:
-					if self.__CanUseGemConverter(srcItemVID, srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos):
-						self.__UseGemConverter(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
-						return
-
-			## ÀÌµ¿½ÃÅ² °÷ÀÌ ÀåÂø ½½·ÔÀÏ °æ¿ì ¾ÆÀÌÅÛÀ» »ç¿ëÇØ¼­ ÀåÂø ½ÃÅ²´Ù - [levites]
-			if player.IsEquipmentSlot(dstItemSlotWindow, dstItemSlotPos):
-				## µé°í ÀÖ´Â ¾ÆÀÌÅÛÀÌ ÀåºñÀÏ¶§¸¸
-				if item.IsEquipmentVID(srcItemVID):
-					self.__UseItem(srcItemSlotPos, srcItemSlotWindow)
-			else:
-				self.__SendMoveItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, 0)
-
-	def __OpenQuestionDialog(self, srcItemWindow, srcItemPos, dstItemWindow, dstItemPos):
-		if self.interface.IsShowDlgQuestionWindow():
-			self.interface.CloseDlgQuestionWindow()
-
-		getItemVNum = player.GetItemIndex
-		self.srcItemPos = srcItemPos
-		self.dstItemPos = dstItemPos
-
-		self.srcItemWindow = srcItemWindow
-		self.dstItemWindow = dstItemWindow
-
-		self.dlgQuestion.SetAcceptEvent(ui.__mem_func__(self.__Accept))
-		self.dlgQuestion.SetCancelEvent(ui.__mem_func__(self.__Cancel))
-
-		self.dlgQuestion.SetText1("%s" % item.GetItemName(getItemVNum(srcItemPos)) )
-		self.dlgQuestion.SetText2(localeInfo.INVENTORY_REALLY_USE_ITEM)
-
-		self.dlgQuestion.Open()
-
-		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-
-	def __Accept(self):
-		self.dlgQuestion.Close()
-		self.__SendUseItemToItemPacket(self.srcItemWindow, self.srcItemPos, self.dstItemWindow, self.dstItemPos)
-		self.srcItemPos = (0, 0)
-		self.dstItemPos = (0, 0)
-
-		self.srcItemWindow = None
-		self.dstItemWindow = None
-
-		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-	def __Cancel(self):
-		self.srcItemPos = (0, 0)
-		self.dstItemPos = (0, 0)
-		self.dlgQuestion.Close()
-
-		self.srcItemWindow = None
-		self.dstItemWindow = None
-
-		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-	if app.ENABLE_SET_ITEM:
-		def __OpenSetClearItemQuestionDialog(self, srcItemWindow, srcItemPos, dstItemWindow, dstItemPos):
-			if self.interface.IsShowDlgQuestionWindow():
-				self.interface.CloseDlgQuestionWindow()
-
-			getItemVNum = player.GetItemIndex
-			self.srcItemPos = srcItemPos
-			self.dstItemPos = dstItemPos
-
-			self.srcItemWindow = srcItemWindow
-			self.dstItemWindow = dstItemWindow
-
-			self.dlgQuestion.SetAcceptEvent(ui.__mem_func__(self.__SetClearItemAccept))
-			self.dlgQuestion.SetCancelEvent(ui.__mem_func__(self.__SetClearItemCancel))
-
-			self.dlgQuestion.SetText1(localeInfo.SET_ITEM_CLEAR_CONFIRM_QUESTION)
-			self.dlgQuestion.SetText2(localeInfo.SET_ITEM_CLEAR_CONFIRM_QUESTION_2)
-			self.dlgQuestion.Open()
-
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-
-		def __SetClearItemAccept(self):
-			self.__Accept()
-
-		def __SetClearItemCancel(self):
-			self.__Cancel()
-
-	def __SellItem(self, window_type, itemSlotPos):
-		if not player.IsEquipmentSlot(window_type, itemSlotPos):
-			itemIndex = player.GetItemIndex(window_type, itemSlotPos)
-			itemCount = player.GetItemCount(window_type, itemSlotPos)
-
-			self.sellingSlotWindow = window_type
-			self.sellingSlotNumber = itemSlotPos
-			self.sellingSlotitemIndex = itemIndex
-			self.sellingSlotitemCount = itemCount
-
-			item.SelectItem(itemIndex)
-			## ¾ÈÆ¼ ÇÃ·¹±× °Ë»ç ºüÁ®¼­ Ãß°¡
-			## 20140220
-			if item.IsAntiFlag(item.ANTIFLAG_SELL):
-				popup = uiCommon.PopupDialog()
-				popup.SetText(localeInfo.SHOP_CANNOT_SELL_ITEM)
-				popup.SetAcceptEvent(self.__OnClosePopupDialog)
-				popup.Open()
-				self.popup = popup
-				return
-
-			itemPrice = item.GetISellItemPrice()
-
-			if item.Is1GoldItem():
-				itemPrice = itemCount / itemPrice / 5
-			else:
-				itemPrice = itemPrice * itemCount / 5
-
-			item.GetItemName(itemIndex)
-			itemName = item.GetItemName()
-			if app.ENABLE_SET_ITEM:
-				itemName = item.GetItemNameBySetValue(player.GetItemSetValue(window_type, itemSlotPos))
-
-			self.questionDialog = uiCommon.QuestionDialog()
-			self.questionDialog.SetText(localeInfo.DO_YOU_SELL_ITEM(itemName, itemCount, itemPrice))
-			self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.SellItem))
-			self.questionDialog.SetCancelEvent(ui.__mem_func__(self.OnCloseQuestionDialog))
-			self.questionDialog.Open()
-			self.questionDialog.count = itemCount
-
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-
-	def __OnClosePopupDialog(self):
-		self.pop = None
-
-	def RefineItem(self, scrollSlotWindow, scrollSlotPos, targetSlotWindow, targetSlotPos):
-		scrollIndex = player.GetItemIndex(scrollSlotWindow, scrollSlotPos)
-		targetIndex = player.GetItemIndex(targetSlotWindow, targetSlotPos)
-
-		if player.REFINE_OK != player.CanRefine(scrollIndex, targetSlotWindow, targetSlotPos):
-			return
-
-		if app.ENABLE_REFINE_RENEWAL:
-			constInfo.AUTO_REFINE_TYPE = 1
-			constInfo.AUTO_REFINE_DATA["ITEM"][0] = scrollSlotPos
-			constInfo.AUTO_REFINE_DATA["ITEM"][1] = targetSlotPos
-
-		###########################################################
-		self.__SendUseItemToItemPacket(scrollSlotWindow, scrollSlotPos, targetSlotWindow, targetSlotPos)
-		#net.SendItemUseToItemPacket(scrollSlotPos, targetSlotPos)
-		return
-		###########################################################
-
-		###########################################################
-		#net.SendRequestRefineInfoPacket(targetSlotPos)
-		#return
-		###########################################################
-
-		result = player.CanRefine(scrollIndex, targetSlotPos)
-
-		if player.REFINE_ALREADY_MAX_SOCKET_COUNT == result:
-			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NO_MORE_SOCKET)
-
-		elif player.REFINE_NEED_MORE_GOOD_SCROLL == result:
-			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NEED_BETTER_SCROLL)
-
-		elif player.REFINE_CANT_MAKE_SOCKET_ITEM == result:
-			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_SOCKET_DISABLE_ITEM)
-
-		elif player.REFINE_NOT_NEXT_GRADE_ITEM == result:
-			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_UPGRADE_DISABLE_ITEM)
-
-		elif player.REFINE_CANT_REFINE_METIN_TO_EQUIPMENT == result:
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_EQUIP_ITEM)
-
-		if player.REFINE_OK != result:
-			return
-
-		self.refineDialog.Open(scrollSlotPos, targetSlotPos)
-
-	def DetachMetinFromItem(self, scrollSlotWindow, scrollSlotPos, targetSlotWindow, targetSlotPos):
-		scrollIndex = player.GetItemIndex(scrollSlotWindow, scrollSlotPos)
-		targetIndex = player.GetItemIndex(targetSlotWindow, targetSlotPos)
-
-		if not player.CanDetach(scrollIndex, targetSlotWindow, targetSlotPos):
-			if app.ENABLE_ACCE_COSTUME_SYSTEM and item.IsAcceScroll(scrollIndex):
-				return
-
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_METIN_INSEPARABLE_ITEM)
-			return
-
-		self.questionDialog = uiCommon.QuestionDialog()
-		if (app.ENABLE_ACCE_COSTUME_SYSTEM or app.ENABLE_AURA_COSTUME_SYSTEM) and item.IsAcceScroll(scrollIndex):
-			self.questionDialog.SetText(localeInfo.AURA_CLEAR_QUESTION_WHEN_USE)
-		elif app.ENABLE_CHANGE_LOOK_SYSTEM and item.IsChangeLookClearScroll(scrollIndex):
-			self.questionDialog.SetText(localeInfo.CHANGE_LOOK_CHANGE_ITEM)
-		else:
-			self.questionDialog.SetText(localeInfo.REFINE_DO_YOU_SEPARATE_METIN)
-		self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.OnDetachMetinFromItem))
-		self.questionDialog.SetCancelEvent(ui.__mem_func__(self.OnCloseQuestionDialog))
-		self.questionDialog.Open()
-		self.questionDialog.sourcePos = scrollSlotPos
-		self.questionDialog.targetPos = targetSlotPos
-
-		self.questionDialog.sourceWindow = scrollSlotWindow
-		self.questionDialog.targetWindow = targetSlotWindow
-
-	def AttachMetinToItem(self, metinSlotWindow, metinSlotPos, targetSlotWindow, targetSlotPos):
-		metinIndex = player.GetItemIndex(metinSlotWindow, metinSlotPos)
-		targetIndex = player.GetItemIndex(targetSlotWindow, targetSlotPos)
-
-		item.SelectItem(metinIndex)
-		itemName = item.GetItemName()
-		if app.ENABLE_SET_ITEM:
-			itemName = item.GetItemNameBySetValue(player.GetItemSetValue(metinSlotWindow, metinSlotPos))
-
-		result = player.CanAttachMetin(metinIndex, targetSlotWindow, targetSlotPos)
-
-		if player.ATTACH_METIN_NOT_MATCHABLE_ITEM == result:
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_CAN_NOT_ATTACH(itemName))
-
-		if player.ATTACH_METIN_NO_MATCHABLE_SOCKET == result:
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NO_SOCKET(itemName))
-
-		elif player.ATTACH_METIN_NOT_EXIST_GOLD_SOCKET == result:
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NO_GOLD_SOCKET(itemName))
-
-		elif player.ATTACH_METIN_CANT_ATTACH_TO_EQUIPMENT == result:
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_EQUIP_ITEM)
-
-		if player.ATTACH_METIN_OK != result:
-			return
-
-		self.attachMetinDialog.Open(metinSlotWindow, metinSlotPos, targetSlotWindow, targetSlotPos)
-
-	def OverOutItem(self):
-		self.wndItem.SetUsableItem(False)
-		if None != self.tooltipItem:
-			self.tooltipItem.HideToolTip()
-
-	def OverInItem(self, overSlotPos, window_type):
-		overInvenSlotPos = self.__InventoryLocalSlotPosToGlobalSlotPos(overSlotPos, window_type)
-		self.wndItem.SetUsableItem(False)
-
-		getItemVNum = ReprGetItemIndex(window_type)
-		itemVnum = getItemVNum(overInvenSlotPos)
-
-		if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-			if window_type == player.INVENTORY:
-				self.DelHighlightSlot(overInvenSlotPos)
-
-		if mouseModule.mouseController.isAttached():
-			attachedItemType = mouseModule.mouseController.GetAttachedType()
-
-			if player.SLOT_TYPE_INVENTORY == attachedItemType:
-				attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
-				attachedItemVNum = mouseModule.mouseController.GetAttachedItemIndex()
-
-				if self.__CanUseSrcItemToDstItem(attachedItemVNum, player.INVENTORY, attachedSlotPos, window_type, overInvenSlotPos):
-					self.wndItem.SetUsableItem(True)
-					self.ShowToolTip(overInvenSlotPos, window_type)
-					return
-
-		self.ShowToolTip(overInvenSlotPos, window_type)
-
-	def __IsUsableItemToItem(self, srcItemVNum, srcSlotPos):
-		"´Ù¸¥ ¾ÆÀÌÅÛ¿¡ »ç¿ëÇÒ ¼ö ÀÖ´Â ¾ÆÀÌÅÛÀÎ°¡?"
-
-		if item.IsRefineScroll(srcItemVNum):
-			return True
-		elif app.ENABLE_SOULBIND_SYSTEM and item.IsSealScroll(srcItemVNum):
-			return True
-		elif item.IsMetin(srcItemVNum):
-			return True
-		elif item.IsDetachScroll(srcItemVNum):
-			return True
-		elif item.IsKey(srcItemVNum):
-			return True
-		elif item.IsItemUsedForDragonSoul(srcItemVNum):
-			return True
-		elif (player.GetItemFlags(srcSlotPos) & ITEM_FLAG_APPLICABLE) == ITEM_FLAG_APPLICABLE:
-			return True
-		else:
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if item.IsAcceScroll(srcItemVNum):
-					return True
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if item.IsChangeLookClearScroll(srcItemVNum):
-					return True
-
-			if app.ENABLE_GROWTH_PET_SYSTEM:
-				if self.__IsUsablePetItem(srcItemVNum):
-					return True
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if item.ITEM_VNUM_AURA_CLEAR == srcItemVNum:
-					return True
-
-			if app.ENABLE_SET_ITEM:
-				if item.IsSetClearScroll(srcItemVNum):
-					return True
-
-			if app.ENABLE_GEM_CONVERTER:
-				if srcItemVNum == item.ITEM_VNUM_GEM_CONVERTER:
-					return True
-
-			if item.GetUseType(srcItemVNum) in self.USE_TYPE_TUPLE:
-				return True
-
-		return False
-
-	def __CanUseSrcItemToDstItem(self, srcItemVNum, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):
-		## ´ë»ó ¾ÆÀÌÅÛ¿¡ »ç¿ëÇÒ ¼ö ÀÖ´Â°¡?
-		if srcSlotWindow == dstSlotWindow:
-			if srcSlotPos == dstSlotPos:
-				return False
-
-		## [MT-462]: Stackable UseMode ÀÌ°í..
-		#if srcItemVNum == player.GetItemIndex(dstSlotWindow, dstSlotPos) and \
-		#	(player.GetItemFlags(dstSlotWindow, dstSlotPos) & item.ITEM_FLAG_STACKABLE):
-		#	return True
-
-		if item.IsRefineScroll(srcItemVNum):
-			if player.REFINE_OK == player.CanRefine(srcItemVNum, dstSlotWindow, dstSlotPos):
-				return True
-
-		elif app.ENABLE_SOULBIND_SYSTEM and item.IsSealScroll(srcItemVNum):
-			if player.CanSealItem(srcItemVNum, dstSlotWindow, dstSlotPos):
-				return True
-
-		elif item.IsMetin(srcItemVNum):
-			if player.ATTACH_METIN_OK == player.CanAttachMetin(srcItemVNum, dstSlotWindow, dstSlotPos):
-				return True
-
-		elif item.IsDetachScroll(srcItemVNum):
-			if player.DETACH_METIN_OK == player.CanDetach(srcItemVNum, dstSlotWindow, dstSlotPos):
-				return True
-
-		elif item.IsKey(srcItemVNum):
-			if player.CanUnlock(srcItemVNum, dstSlotWindow, dstSlotPos):
-				return True
-
-		elif (player.GetItemFlags(srcSlotWindow, srcSlotPos) & ITEM_FLAG_APPLICABLE) == ITEM_FLAG_APPLICABLE:
-			return True
-
-		else:
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if item.IsAcceScroll(srcItemVNum):
-					if player.CanAcceClearItem(srcItemVNum, dstSlotWindow, dstSlotPos):
-						return True
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if item.IsChangeLookClearScroll(srcItemVNum):
-					if player.CanChangeLookClearItem(srcItemVNum, dstSlotWindow, dstSlotPos):
-						return True
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if item.ITEM_VNUM_AURA_CLEAR == srcItemVNum:
-					if player.CanAuraClearItem(srcItemVNum, dstSlotWindow, dstSlotPos):
-						return True
-
-			if app.ENABLE_SET_ITEM:
-				if item.IsSetClearScroll(srcItemVNum):
-					if player.CanSetItemClear(srcItemVNum, dstSlotWindow, dstSlotPos):
-						return True
-
-			if app.ENABLE_GEM_CONVERTER:
-				if srcItemVNum == item.ITEM_VNUM_GEM_CONVERTER:
-					if self.__CanUseGemConverter(srcItemVNum, dstSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):
-						return True
-
-			if app.ENABLE_GROWTH_PET_SYSTEM:
-				if self.__CanUseSrcPetItemToDstPetItem(srcItemVNum, srcSlotPos, dstSlotPos):
-					return True
-
-			useType = item.GetUseType(srcItemVNum)
-
-			if app.ENABLE_ATTR_6TH_7TH:
-				if "USE_CHANGE_ATTRIBUTE2" == useType:
-					if self.__CanChangeItemAttr67List(player.INVENTORY, dstSlotPos):
-						return True
-
-			if "USE_CLEAN_SOCKET" == useType:
-				if self.__CanCleanBrokenMetinStone(dstSlotWindow, dstSlotPos):
-					return True
-
-			elif "USE_CHANGE_ATTRIBUTE" == useType:
-				if self.__CanChangeItemAttrList(dstSlotWindow, dstSlotPos):
-					return True
-
-			elif "USE_ADD_ATTRIBUTE" == useType:
-				if self.__CanAddItemAttr(dstSlotWindow, dstSlotPos):
-					return True
-
-			elif "USE_ADD_ATTRIBUTE2" == useType:
-				if self.__CanAddItemAttr2(dstSlotWindow, dstSlotPos):
-					return True
-
-			elif "USE_ADD_ACCESSORY_SOCKET" == useType:
-				if self.__CanAddAccessorySocket(dstSlotWindow, dstSlotPos):
-					return True
-
-			elif "USE_PUT_INTO_ACCESSORY_SOCKET" == useType:
-				if self.__CanPutAccessorySocket(dstSlotWindow, dstSlotPos, srcItemVNum):
-					return True
-
-			elif "USE_PUT_INTO_BELT_SOCKET" == useType:
-				dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-				item.SelectItem(dstItemVNum)
-				if item.ITEM_TYPE_BELT == item.GetItemType():
-					return True
-
-			elif app.ENABLE_MOVE_COSTUME_ATTR and "USE_CHANGE_COSTUME_ATTR" == useType:
-				if self.__CanChangeCostumeAttrList(dstSlotWindow, dstSlotPos):
-					return True
-
-			elif app.ENABLE_MOVE_COSTUME_ATTR and "USE_RESET_COSTUME_ATTR" == useType:
-				if self.__CanResetCostumeAttr(dstSlotWindow, dstSlotPos):
-					return True
-
-			else:
-				if app.ENABLE_CHANGED_ATTR and "USE_SELECT_ATTRIBUTE" == useType:
-					if self.__CanChangeItemAttrList(dstSlotWindow, dstSlotPos):
-						return True
-
-				if app.ENABLE_REFINE_ELEMENT_SYSTEM:
-					if "USE_ELEMENT_UPGRADE" == useType:
-						if uiRefine.RefineElementDialog.CanRefineElementUpgrade(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, False, False):
-							return True
-
-					if "USE_ELEMENT_DOWNGRADE" == useType:
-						if uiRefine.RefineElementDialog.CanRefineElementDowngrade(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, False, False):
-							return True
-
-					if "USE_ELEMENT_CHANGE" == useType:
-						if uiRefine.RefineElementChangeDialog.CanRefineElementChange(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, False, False):
-							return True
-
-		return False
-
-	def __CanCleanBrokenMetinStone(self, dstSlotWindow, dstSlotPos):
-		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-		if dstItemVNum == 0:
-			return False
-
-		item.SelectItem(dstItemVNum)
-
-		if item.ITEM_TYPE_WEAPON != item.GetItemType() and item.ITEM_TYPE_ARMOR != item.GetItemType():
-			return False
-
-		for i in xrange(player.METIN_SOCKET_MAX_NUM):
-			if player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, i) == constInfo.ERROR_METIN_STONE:
-				return True
-
-		return False
-
-	def __CanChangeItemAttrList(self, dstSlotWindow, dstSlotPos):
-		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-		if dstItemVNum == 0:
-			return False
-
-		item.SelectItem(dstItemVNum)
-
-		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
-			return False
-
-		# Àç°æºñ¼­
-		if app.ENABLE_NEW_USER_CARE:
-			if item.IsAntiFlag(item.ITEM_ANTIFLAG_ENCHANT):
-				return False
-
-		if app.ENABLE_SOULBIND_SYSTEM:
-			if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
-				return False
-
-		for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
-			type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
-			if type != 0:
-				return True
-
-		return False
-
-	def __CanPutAccessorySocket(self, dstSlotWindow, dstSlotPos, mtrlVnum):
-		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-		if dstItemVNum == 0:
-			return False
-
-		item.SelectItem(dstItemVNum)
-
-		if item.GetItemType() != item.ITEM_TYPE_ARMOR:
-			return False
-
-		if not item.GetItemSubType() in (item.ARMOR_WRIST, item.ARMOR_NECK, item.ARMOR_EAR):
-			return False
-
-		curCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 0)
-		maxCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 1)
-
-		if mtrlVnum != constInfo.GET_ACCESSORY_MATERIAL_VNUM(dstItemVNum, item.GetItemSubType()):
-			return False
-
-		if curCount >= maxCount:
-			return False
-
-		return True
-
-	def __CanAddAccessorySocket(self, dstSlotWindow, dstSlotPos):
-		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-		if dstItemVNum == 0:
-			return False
-
-		item.SelectItem(dstItemVNum)
-
-		if not item.GetItemType() in (item.ITEM_TYPE_ARMOR, item.ITEM_TYPE_BELT):
-			return False
-
-		if not item.GetItemSubType() in (item.ARMOR_WRIST, item.ARMOR_NECK, item.ARMOR_EAR) and not item.GetItemType() == item.ITEM_TYPE_BELT:
-			return False
-
-		curCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 0)
-		maxCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 1)
-
-		ACCESSORY_SOCKET_MAX_SIZE = 3
-		if maxCount >= ACCESSORY_SOCKET_MAX_SIZE:
-			return False
-
-		return True
-
-	if app.ENABLE_ATTR_6TH_7TH:
-		def __CanChangeItemAttr67List(self, dstSlotWindow, dstSlotPos):
-			dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-			if dstItemVNum == 0:
-				return False
-
-			item.SelectItem(dstItemVNum)
-
-			if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
-				return False
-
-			if app.ENABLE_QUIVER_SYSTEM:
-				if (item.GetItemType() == item.ITEM_TYPE_WEAPON and item.GetItemSubType() in (item.WEAPON_ARROW, item.WEAPON_QUIVER)):
-					return False
-			else:
-				if (item.GetItemType() == item.ITEM_TYPE_WEAPON and item.GetItemSubType() == item.WEAPON_ARROW):
-					return False
-
-			# Àç°æºñ¼­
-			if app.ENABLE_NEW_USER_CARE:
-				if item.IsAntiFlag(item.ITEM_ANTIFLAG_ENCHANT):
-					return False
-
-			if app.ENABLE_SOULBIND_SYSTEM:
-				if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
-					return False
-
-			attrCount = 0
-			for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
-				type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
-				if type != 0:
-					attrCount += 1
-
-			if attrCount > player.ATTRIBUTE_SLOT_MAX_NUM - 2 and attrCount <= player.ATTRIBUTE_SLOT_MAX_NUM:
-				return True
-
-			return False
-
-	def __CanAddItemAttr(self, dstSlotWindow, dstSlotPos):
-		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-		if dstItemVNum == 0:
-			return False
-
-		item.SelectItem(dstItemVNum)
-
-		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
-			return False
-
-		# Àç°¡ºñ¼­
-		if app.ENABLE_NEW_USER_CARE:
-			if item.IsAntiFlag(item.ITEM_ANTIFLAG_REINFORCE):
-				return False
-
-		if app.ENABLE_SOULBIND_SYSTEM:
-			if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
-				return False
-
-		attrCount = 0
-		for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
-			type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
-			if type != 0:
-				attrCount += 1
-
-		if attrCount < 4:
-			return True
-
-		return False
-
-	def __CanAddItemAttr2(self, dstSlotWindow, dstSlotPos):
-		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-		if dstItemVNum == 0:
-			return False
-
-		item.SelectItem(dstItemVNum)
-
-		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
-			return False
-
-		# Àç°¡ºñ¼­
-		if app.ENABLE_NEW_USER_CARE:
-			if item.IsAntiFlag(item.ITEM_ANTIFLAG_REINFORCE):
-				return False
-
-		if app.ENABLE_SOULBIND_SYSTEM:
-			if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
-				return False
-
-		attrCount = 0
-		for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
-			type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
-			if type != 0:
-				attrCount += 1
-
-		if attrCount == 4:
-			return True
-
-		return False
-
-	if app.ENABLE_MOVE_COSTUME_ATTR:
-		def __CanChangeCostumeAttrList(self, dstSlotWindow, dstSlotPos):
-			dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-			if dstItemVNum == 0:
-				return False
-
-			item.SelectItem(dstItemVNum)
-
-			if item.GetItemType() != item.ITEM_TYPE_COSTUME:
-				return False
-
-			if app.ENABLE_MOUNT_COSTUME_SYSTEM:
-				if item.GetItemSubType() == item.COSTUME_TYPE_MOUNT:
-					return False
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
-					return False
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if item.GetItemSubType() == item.COSTUME_TYPE_AURA:
-					return False
-
-			for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
-				type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
-				if type != 0:
-					return True
-
-			return False
-
-		def __CanResetCostumeAttr(self, dstSlotWindow, dstSlotPos):
-			dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
-			if dstItemVNum == 0:
-				return False
-
-			item.SelectItem(dstItemVNum)
-
-			if item.GetItemType() != item.ITEM_TYPE_COSTUME:
-				return False
-
-			if app.ENABLE_MOUNT_COSTUME_SYSTEM:
-				if item.GetItemSubType() == item.COSTUME_TYPE_MOUNT:
-					return False
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
-					return False
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if item.GetItemSubType() == item.COSTUME_TYPE_AURA:
-					return False
-
-			for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
-				type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
-				if type != 0:
-					return True
-
-			return False
-
-	def ShowToolTip(self, slotIndex, window_type):
-		if None != self.tooltipItem:
-			self.tooltipItem.SetInventoryItem(slotIndex, window_type)
-
-	def OnTop(self):
-		if None != self.tooltipItem:
-			self.tooltipItem.SetTop()
-
-		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			if self.wndBelt:
-				if self.IsClickBeltInventory == False:
-					self.wndBelt.SetTop()
-				else:
-					self.IsClickBeltInventory = False
-
-			if self.wndCostume:
-				self.wndCostume.SetTop()
-
-		if app.WJ_ENABLE_TRADABLE_ICON:
-			map(lambda wnd:wnd.RefreshLockedSlot(), self.bindWnds)
-
-	def OnPressEscapeKey(self):
-		self.Close()
-		return True
-
-	def UseItemSlot(self, slotIndex, window):
-		curCursorNum = app.GetCursor()
-		if app.SELL == curCursorNum:
-			return
-
-		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS():
-			return
-
-		slotIndex = self.__InventoryLocalSlotPosToGlobalSlotPos(slotIndex, window)
-
-		if app.ENABLE_DRAGON_SOUL_SYSTEM:
-			if self.wndDragonSoulRefine.IsShow():
-				self.wndDragonSoulRefine.AutoSetItem((window, slotIndex), 1)
-				return
-
-		self.__UseItem(slotIndex, window)
-		mouseModule.mouseController.DeattachObject()
-		self.OverOutItem()
-
-	def __UseItem(self, slotIndex, slotWindow):
-		ItemVNum = player.GetItemIndex(slotWindow, slotIndex)
-		item.SelectItem(ItemVNum)
-
-		## ¾Ç¼¼¼­¸® Ã¢ÀÌ ¿­·ÁÀÖÀ¸¸é
-		## ¾Ç¼¼¼­¸® ¾ÆÀÌÅÛ, ¹«±â, °©¿Ê ¿Ü¿£ ¾Æ¹« »ç¿ë ¾ÈµÊ.
-		if app.ENABLE_ACCE_COSTUME_SYSTEM:
-			if player.GetAcceRefineWindowOpen():
-				self.__UseItemAcce(slotIndex, slotWindow)
-				return
-
-		if app.ENABLE_GROWTH_PET_SYSTEM:
-			itemType = item.GetItemType()
-			
-			if self.interface.wndPetInfoWindow.AttachItemToPetWindow(player.INVENTORY, player.SLOT_TYPE_INVENTORY, slotIndex):
-				return
-				
-			if self.PetSkillDelDlg and self.PetSkillDelDlg.IsShow():
-				self.__PetSkillDeleteQuestionDialogCancel()
-
-			if item.ITEM_TYPE_PET == itemType:
-				self.__UseItemPet(slotIndex)
-				return
-
-		if app.ENABLE_CHANGE_LOOK_SYSTEM:
-			if player.GetChangeLookWindowOpen():
-				return
-
-		if app.ENABLE_AURA_COSTUME_SYSTEM:
-			if player.IsAuraWindowOpen():
-				self.__UseItemAura(slotIndex, slotWindow)
-				return
-
-		if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR:
-			if self.interface.AttachInvenItemToOtherWindowSlot(slotIndex, slotWindow):
-				return
-
-		if app.ENABLE_FLOWER_EVENT:
-			if 25121 == ItemVNum or 25122 == ItemVNum or 25123 == ItemVNum or 25124 == ItemVNum or 25125 == ItemVNum:
-				value1 = item.GetValue(0)
-				value2 = item.GetValue(1)
-				value3 = item.GetApplyPoint(value2)
-
-				if item.CheckAffect(value1, value3):
-					pass
-				else:
-					if item.CheckAffect(value1, 0):
-						self.questionDialog = uiCommon.QuestionDialog2()
-						self.questionDialog.SetText1(localeInfo.FLOWER_EVENT_USE_ITEM_TEXT1)
-						self.questionDialog.SetText2(localeInfo.FLOWER_EVENT_USE_ITEM_TEXT2)
-						self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnAccept))
-						self.questionDialog.SetCancelEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnCancel))
-						self.questionDialog.Open()
-						self.questionDialog.slotIndex = slotIndex
-						self.questionDialog.slotWindow = slotWindow
-						constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-						return
-
-		if item.IsFlag(item.ITEM_FLAG_CONFIRM_WHEN_USE):
-			self.questionDialog = uiCommon.QuestionDialog()
-			self.questionDialog.SetText(localeInfo.INVENTORY_REALLY_USE_ITEM2)
-			self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnAccept))
-			self.questionDialog.SetCancelEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnCancel))
-			self.questionDialog.Open()
-			self.questionDialog.slotIndex = slotIndex
-
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-		else:
-			self.__SendUseItemPacket(slotIndex, slotWindow)
-
-	def SetCanMouseEventSlot(self, inven_slot_index):
-		if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
-			page = self.GetInventoryPageIndex() # range 0, 1, 2, 3
-			inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
-		self.wndItem.SetCanMouseEventSlot(inven_slot_index)
-
-	def SetCantMouseEventSlot(self, inven_slot_index):
-		if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
-			page = self.GetInventoryPageIndex() # range 0, 1, 2, 3
-			inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
-		self.wndItem.SetCantMouseEventSlot(inven_slot_index)
-
-	if app.ENABLE_ACCE_COSTUME_SYSTEM:
-		def __UseItemAcce(self, slotIndex, slotWindow):
-			AcceSlot = player.FindMoveAcceItemSlot()
-
-			if slotWindow != player.INVENTORY:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOT_USINGITEM)
-				return
-
-			UsingAcceSlot = player.FindActivatedAcceSlot(slotWindow, slotIndex)
-
-			if app.ENABLE_SOULBIND_SYSTEM:
-				## ºÀÀÎ¾ÆÀÌÅÛ °É·¯³¿
-				if player.GetItemSealDate(player.INVENTORY, slotIndex) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOT_SEALITEM)
-					return
-
-			## Á¶ÇÕÃ¢
-			if player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_COMBINE:
-				if item.GetItemType() == item.ITEM_TYPE_COSTUME:
-					if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
-						if app.ENABLE_ACCE_SECOND_COSTUME_SYSTEM:
-							## Àü¼³µî±Þ ÃÖ°í Èí¼öÀ² 25%
-							socketInDrainValue = player.GetItemMetinSocket(slotIndex, 1)
-							if socketInDrainValue >= player.ACCE_MAX_DRAINRATE:
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_MAX_DRAINRATE)
-								return
-						else:
-							if item.GetRefinedVnum() == 0: ## Àü¼±µî±Þ ¾ÆÀÌÅÛÀº °É·¯³¿.
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_MAXGRADE)
-								return
-
-						if UsingAcceSlot == player.ACCE_SLOT_MAX:
-							if AcceSlot != player.ACCE_SLOT_MAX:
-								if not player.FindUsingAcceSlot(AcceSlot) == player.NPOS():
-									return
-
-								if player.FindUsingAcceSlot(player.ACCE_SLOT_LEFT) == player.NPOS():
-									if AcceSlot == player.ACCE_SLOT_RIGHT:
-										return
-
-							player.SetAcceActivatedItemSlot(AcceSlot, slotIndex)
-							net.SendAcceRefineCheckIn(player.INVENTORY, slotIndex, AcceSlot, player.GetAcceRefineWindowType())
-					else:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCE)
-						return
-				else:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCE)
-					return
-
-			## Èí¼öÃ¢
-			elif player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_ABSORB:
-				isAbsorbItem = False
-				if item.GetItemType() == item.ITEM_TYPE_COSTUME:
-					if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
-						if not player.GetItemMetinSocket(slotIndex, 0) == 0:
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOTABSORBITEM)
-							return
-
-						if UsingAcceSlot == player.ACCE_SLOT_MAX:
-							if not AcceSlot == player.ACCE_SLOT_LEFT: ## ¾Ç¼¼¼­¸®¾ÆÀÌÅÛÀº ¿ÞÂÊ ½½·Ô¿¡¸¸
-								return
-
-							player.SetAcceActivatedItemSlot(AcceSlot, slotIndex)
-							net.SendAcceRefineCheckIn(player.INVENTORY, slotIndex, AcceSlot, player.GetAcceRefineWindowType())
-					else:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
-						return
-
-				elif item.GetItemType() == item.ITEM_TYPE_WEAPON: ## ¹«±â·ù.
-					isAbsorbItem = True
-
-				elif item.GetItemType() == item.ITEM_TYPE_ARMOR: ## °©¿Ê·ù
-					if item.GetItemSubType() == item.ARMOR_BODY:
-						isAbsorbItem = True
-					else:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
-						return
-				else:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
-					return
-
-				if localeInfo.IsBRAZIL():
-					## ºê¶óÁú¿¡¼­ ¾Æ·¡ ³ª¿­µÈ ¾ÆÀÌÅÛÀº ´É·ÂÄ¡°¡ »ó´çÈ÷ °­ÇØ¼­ Èí¼ö ¾ÈµÇ°Ô ÇØ´Þ¶ó°í Á¶¸§.
-					## ¾îÂ¿¼ö ¾øÀÌ ÇÏµåÄÚµùÇÔ. 
-					itemvnum = item.GetVnum()
-					if itemvnum == 11979 or itemvnum == 11980 or itemvnum == 11981 or itemvnum == 11982 or itemvnum == 11971 or itemvnum == 11972 or itemvnum == 11973 or itemvnum == 11974:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_DONOT_ABSORDITEM)
-						return
-
-				if app.ENABLE_ACCE_SECOND_COSTUME_SYSTEM:
-					itemvnum = item.GetVnum()
-					if item.IsWeddingItem(itemvnum) == 1:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
-						return
-
-				if isAbsorbItem:
-					if UsingAcceSlot == player.ACCE_SLOT_MAX:
-						if not AcceSlot == player.ACCE_SLOT_RIGHT: ## Èí¼öµÉ ¾ÆÀÌÅÛÀº ¿À¸¥ÂÊ ½½·Ô¿¡¸¸
-							if player.FindUsingAcceSlot(player.ACCE_SLOT_RIGHT) == player.NPOS():
-								AcceSlot = player.ACCE_SLOT_RIGHT
-							else:
-								return
-
-						popup = uiCommon.QuestionDialog()
-						popup.SetText(localeInfo.ACCE_DEL_ABSORDITEM)
-						popup.SetAcceptEvent(lambda arg1 = slotIndex, arg2 = AcceSlot: self.OnAcceAcceptEvent(arg1, arg2))
-						popup.SetCancelEvent(self.OnAcceCloseEvent)
-						popup.Open()
-						self.pop = popup
-
-			## °æ°í ¸Þ½ÃÁö ¶ç¿ì±â.
-			if not player.FindUsingAcceSlot(player.ACCE_SLOT_RIGHT) == player.NPOS() and not player.FindUsingAcceSlot(player.ACCE_SLOT_LEFT) == player.NPOS():
-				if AcceSlot != player.ACCE_SLOT_MAX:
-					popup = uiCommon.PopupDialog()
-					if player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_COMBINE:
-
-						if app.ENABLE_ACCE_SECOND_COSTUME_SYSTEM:
-							socketInDrainValue = player.GetAcceItemMetinSocket(0, 1)
-							socketInDrainValue2 = player.GetAcceItemMetinSocket(1, 1)
-							socketInDrainValue3 = player.GetItemMetinSocket(slotIndex, 1)
-							## ¸ÞÀÎ ¼­¹ö Áß. µî·ÏµÈ ¾ÆÀÌÅÛÀÌ Àü¼³ÀÏ¶§ °æ°í ¸Þ½ÃÁö º¯°æ.
-							if socketInDrainValue > 0 or socketInDrainValue2 > 0 or socketInDrainValue3 > 0:
-								popup.SetText(localeInfo.ACCE_DEL_SERVEITEM2)
-							else:
-								popup.SetText(localeInfo.ACCE_DEL_SERVEITEM)
-						else:
-							popup.SetText(localeInfo.ACCE_DEL_SERVEITEM)
-
-						popup.SetAcceptEvent(self.__OnClosePopupDialog)
-						popup.Open()
-						self.pop = popup
-
-		## ¾ÆÀÌÅÛ Èí¼ö½Ã Èí¼öµÉ ¾ÆÀÌÅÛ ÇÒÁö ¾ÈÇÒÁö ¼±ÅÃ ÆË¾÷
-		def OnAcceAcceptEvent(self, slotIndex, AcceSlot):
-			self.pop.Close()
-			self.pop = None
-
-			player.SetAcceActivatedItemSlot(AcceSlot, slotIndex)
-			net.SendAcceRefineCheckIn(player.INVENTORY, slotIndex, AcceSlot, player.GetAcceRefineWindowType())
-
-		def OnAcceCloseEvent(self):
-			self.pop.Close()
-			self.pop = None
-
-	if app.ENABLE_AURA_COSTUME_SYSTEM:
-		def __UseItemAura(self, slotIndex, slotWindow):
-			AuraSlot = player.FindMoveAuraItemSlot()
-
-			if slotWindow != player.INVENTORY:
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOT_USINGITEM)
-				return
-
-			UsingAuraSlot = player.FindActivatedAuraSlot(player.INVENTORY, slotIndex)
-
-			if player.GetAuraCurrentItemSlotCount() >= player.AURA_SLOT_MAX <= UsingAuraSlot:
-				return
-
-			if app.ENABLE_SOULBIND_SYSTEM:
-				## ºÀÀÎ¾ÆÀÌÅÛ °É·¯³¿
-				if player.GetItemSealDate(player.INVENTORY, slotIndex) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_SEALITEM)
-					return
-
-			if player.GetAuraWindowType() == player.AURA_WINDOW_TYPE_ABSORB:
-				isAbsorbItem = False
-				if item.GetItemType() == item.ITEM_TYPE_COSTUME:
-					if item.GetItemSubType() == item.COSTUME_TYPE_AURA:
-						if not player.GetItemMetinSocket(slotIndex, item.ITEM_SOCKET_AURA_DRAIN_ITEM_VNUM) == 0:
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_ABSORBITEM)
-							return
-
-						if UsingAuraSlot == player.AURA_SLOT_MAX:
-							if AuraSlot != player.AURA_SLOT_MAIN:
-								return
-
-							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
-					else:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_REFINEITEM)
-						return
-
-				elif item.GetItemType() == item.ITEM_TYPE_ARMOR:
-					if item.GetItemSubType() in [item.ARMOR_SHIELD, item.ARMOR_WRIST, item.ARMOR_NECK, item.ARMOR_EAR]:
-						if player.FindUsingAuraSlot(player.AURA_SLOT_MAIN) == player.NPOS():
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_REGISTER_AURAITEM)
-							return
-
-						isAbsorbItem = True
-					else:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_REFINEITEM)
-						return
-				else:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_REFINEITEM)
-					return
-
-				if isAbsorbItem:
-					if UsingAuraSlot == player.AURA_SLOT_MAX:
-						if AuraSlot != player.AURA_SLOT_SUB:
-							if player.FindUsingAuraSlot(player.AURA_SLOT_SUB) == player.NPOS():
-								AuraSlot = player.AURA_SLOT_SUB
-							else:
-								return
-
-						popup = uiCommon.QuestionDialog()
-						popup.SetText(localeInfo.AURA_NOTICE_DEL_ABSORDITEM)
-						popup.SetAcceptEvent(lambda arg1 = slotIndex, arg2 = AuraSlot: self.OnAuraAcceptEvent(arg1, arg2))
-						popup.SetCancelEvent(self.OnAuraCloseEvent)
-						popup.Open()
-						self.pop = popup
-
-			elif player.GetAuraWindowType() == player.AURA_WINDOW_TYPE_GROWTH:
-				if UsingAuraSlot == player.AURA_SLOT_MAX:
-					if AuraSlot == player.AURA_SLOT_MAIN:
-						if item.GetItemType() == item.ITEM_TYPE_COSTUME and item.GetItemSubType() == item.COSTUME_TYPE_AURA:
-							socketLevelValue = player.GetItemMetinSocket(slotIndex, item.ITEM_SOCKET_AURA_LEVEL_VALUE)
-							curLevel = (socketLevelValue / 100000) - 1000
-							curExp = socketLevelValue % 100000;
-							if curLevel >= player.AURA_MAX_LEVEL:
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_MAX_LEVEL)
-								return
-
-							#if curExp >= player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_NEED_EXP):
-							#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_GROWTHITEM)
-							#	return
-
-							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
-						else:
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_AURAITEM)
-							return
-
-					elif AuraSlot == player.AURA_SLOT_SUB:
-						if player.FindUsingAuraSlot(player.AURA_SLOT_MAIN) != player.NPOS():
-							if item.GetItemType() == item.ITEM_TYPE_RESOURCE and item.GetItemSubType() == item.RESOURCE_AURA:
-								if UsingAuraSlot == player.AURA_SLOT_MAX:
-									if AuraSlot != player.AURA_SLOT_SUB:
-										return
-
-								net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
-							#else:
-							#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_AURARESOURCE)
-							#	return
-						else:
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_REGISTER_AURAITEM)
-							return
-
-			elif player.GetAuraWindowType() == player.AURA_WINDOW_TYPE_EVOLVE:
-				if UsingAuraSlot == player.AURA_SLOT_MAX:
-					if AuraSlot == player.AURA_SLOT_MAIN:
-						if item.GetItemType() == item.ITEM_TYPE_COSTUME and item.GetItemSubType() == item.COSTUME_TYPE_AURA:
-							socketLevelValue = player.GetItemMetinSocket(slotIndex, item.ITEM_SOCKET_AURA_LEVEL_VALUE)
-							curLevel = (socketLevelValue / 100000) - 1000
-							curExp = socketLevelValue % 100000;
-							if curLevel >= player.AURA_MAX_LEVEL:
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_MAX_LEVEL)
-								return
-
-							if curLevel != player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_LEVEL_MAX) or curExp < player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_NEED_EXP):
-								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEM)
-								return
-
-							if player.FindUsingAuraSlot(AuraSlot) != player.NPOS():
-								return
-
-							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
-						else:
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_AURAITEM)
-							return
-
-					elif AuraSlot == player.AURA_SLOT_SUB:
-						Cell = player.FindUsingAuraSlot(player.AURA_SLOT_MAIN)
-						if Cell == player.NPOS():
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_REGISTER_AURAITEM)
-							return
-
-						socketLevelValue = player.GetItemMetinSocket(*(Cell + (item.ITEM_SOCKET_AURA_LEVEL_VALUE,)))
-						curLevel = (socketLevelValue / 100000) - 1000
-						curExp = socketLevelValue % 100000;
-						if curLevel >= player.AURA_MAX_LEVEL:
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_MAX_LEVEL)
-							return
-
-						if curExp < player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_NEED_EXP):
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEM)
-							return
-
-						if player.GetItemIndex(slotIndex) != player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_MATERIAL_VNUM):
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEM)
-							return
-
-						if player.GetItemCount(slotIndex) < player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_MATERIAL_COUNT):
-							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEMCOUNT)
-							return
-
-						if UsingAuraSlot == player.AURA_SLOT_MAX:
-							if AuraSlot != player.AURA_SLOT_MAX:
-								if player.FindUsingAuraSlot(AuraSlot) != player.NPOS():
-									return
-
-							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
-
-		def OnAuraAcceptEvent(self, slotIndex, AuraSlot):
-			self.OnAuraCloseEvent()
-			net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
-
-		def OnAuraCloseEvent(self):
-			self.pop.Close()
-			self.pop = None
-
-		def __UseAuraClearItem(self, src_item_window, src_item_pos, dst_item_window, dst_item_pos):
-			if self.clear_aura_item_question_dialog:
-				return
-
-			if app.ENABLE_SOULBIND_SYSTEM:
-				if player.GetItemSealDate(dst_item_window, dst_item_pos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_CLEAR_CANNOT_USE_SEALED_ITEM)
-					return
-
-			question_dialog = uiCommon.QuestionDialog()
-			question_dialog.SetText(localeInfo.AURA_CLEAR_QUESTION_WHEN_USE)
-			question_dialog.SetAcceptEvent(ui.__mem_func__(self.__AuraClearItemAccept))
-			question_dialog.SetCancelEvent(ui.__mem_func__(self.__AuraClearItemCancel))
-			question_dialog.Open()
-			question_dialog.srcItemWindow = src_item_window
-			question_dialog.srcItemPos = src_item_pos
-			question_dialog.dstItemWindow = dst_item_window
-			question_dialog.dstItemPos = dst_item_pos
-			self.clear_aura_item_question_dialog = question_dialog
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-
-		def __AuraClearItemAccept(self):
-			if self.clear_aura_item_question_dialog:
-				self.__SendUseItemToItemPacket(\
-					self.clear_aura_item_question_dialog.srcItemWindow,\
-					self.clear_aura_item_question_dialog.srcItemPos,\
-					self.clear_aura_item_question_dialog.dstItemWindow,\
-					self.clear_aura_item_question_dialog.dstItemPos)
-
-			self.__AuraClearQuestionDialogClose()
-
-		def __AuraClearItemCancel(self):
-			self.__AuraClearQuestionDialogClose()
-
-		def __AuraClearQuestionDialogClose(self):
-			if self.clear_aura_item_question_dialog:
-				self.clear_aura_item_question_dialog.Close()
-			self.clear_aura_item_question_dialog = None
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-	if app.ENABLE_GEM_CONVERTER:
-		def __CanUseGemConverter(self, src_item_vnum, src_item_window, src_item_pos, dst_item_window, dst_item_pos):
-			if src_item_window == dst_item_window and src_item_pos == dst_item_pos:
-				return False
-
-			if src_item_vnum != item.ITEM_VNUM_GEM_CONVERTER:
-				return False
-
-			item.SelectItem(src_item_vnum)
-
-			gem_conv_count = player.GetItemCount(src_item_window, src_item_pos)
-			gem_stone_vnum = player.GetItemIndex(dst_item_window, dst_item_pos)
-			gem_stone_count = player.GetItemCount(dst_item_window, dst_item_pos)
-
-			need_gem_stone_count = gem_conv_count * item.GetValue(0)
-
-			if gem_stone_vnum != item.ITEM_VNUM_GEM_STONE:
-				return False
-
-			if gem_stone_count < need_gem_stone_count:
-				return False
-
-			return True
-
-		def __UseGemConverter(self, src_item_window, src_item_pos, dst_item_window, dst_item_pos):
-			if self.gem_converter_question_dialog:
-				return
-
-			self.gem_converter_item_pos = (src_item_pos, dst_item_pos)
-
-			self.SetCantMouseEventSlot(src_item_pos)
-			self.SetCantMouseEventSlot(dst_item_pos)
-
-			question_dialog = uiCommon.QuestionDialog()
-			question_dialog.SetText(localeInfo.GEM_CONVERTER_MESSAGE_USE_CONVERTER_QUESTION)
-			question_dialog.SetAcceptEvent(ui.__mem_func__(self.__AcceptGemConverterUse))
-			question_dialog.SetCancelEvent(ui.__mem_func__(self.__CancelGemConverterUse))
-			question_dialog.Open()
-			question_dialog.srcItemWindow = src_item_window
-			question_dialog.srcItemPos = src_item_pos
-			question_dialog.dstItemWindow = dst_item_window
-			question_dialog.dstItemPos = dst_item_pos
-			self.gem_converter_question_dialog = question_dialog
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
-
-		def __AcceptGemConverterUse(self):
-			if not self.gem_converter_question_dialog:
-				return
-
-			gem_conv_vnum = player.GetItemIndex(self.gem_converter_question_dialog.srcItemWindow, self.gem_converter_question_dialog.srcItemPos)
-			gem_conv_count = player.GetItemCount(self.gem_converter_question_dialog.srcItemWindow, self.gem_converter_question_dialog.srcItemPos)
-			gem_stone_count = player.GetItemCount(self.gem_converter_question_dialog.dstItemWindow, self.gem_converter_question_dialog.dstItemPos)
-
-			item.SelectItem(gem_conv_vnum)
-			need_gem_stone_count = gem_conv_count * item.GetValue(0)
-			conv_to_gem = need_gem_stone_count / item.GetValue(0)
-			conv_cost = gem_conv_count * item.GetValue(1)
-
-			if gem_stone_count < need_gem_stone_count:
-				self.__CancelGemConverterUse()
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_NOT_ENOUGH_GEMSTONE % localeInfo.NumberToMoneyString(need_gem_stone_count))
-				return
-
-			if player.GetElk() < conv_cost:
-				self.__CancelGemConverterUse()
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_NOT_ENOUGH_GOLD)
-				return
-
-			if player.GetGem() + conv_to_gem >= player.GEM_MAX:
-				self.__CancelGemConverterUse()
-				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_GEM_MAX)
-				return
-
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_CONVERT_SUCCESS_GEM_STONE % gem_conv_count)
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_CONVERT_SUCCESS_CONVERTER % need_gem_stone_count)
-
-			self.__SendUseItemToItemPacket(\
-				self.gem_converter_question_dialog.srcItemWindow,\
-				self.gem_converter_question_dialog.srcItemPos,\
-				self.gem_converter_question_dialog.dstItemWindow,\
-				self.gem_converter_question_dialog.dstItemPos)
-
-			self.__CancelGemConverterUse()
-
-		def __CancelGemConverterUse(self):
-			for i in self.gem_converter_item_pos:
-				self.SetCanMouseEventSlot(i)
-			self.gem_converter_item_pos = [-1, -1]
-
-			self.__CloseGemConverterUseQuestionDialog()
-
-		def __CloseGemConverterUseQuestionDialog(self):
-			if self.gem_converter_question_dialog:
-				self.gem_converter_question_dialog.Close()
-			self.gem_converter_question_dialog = None
-			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
-
-	def __UseItemQuestionDialog_OnCancel(self):
-		self.OnCloseQuestionDialog()
-
-	def __UseItemQuestionDialog_OnAccept(self):
-		self.__SendUseItemPacket(self.questionDialog.slotIndex)
-		self.OnCloseQuestionDialog()
-
-	def __SendUseItemToItemPacket(self, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):
-		# °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ »ç¿ë ¹æÁö
-		if uiPrivateShopBuilder.IsBuildingPrivateShop():
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_ITEM_FAILURE_PRIVATE_SHOP)
-			return
-
-		#if self.interface.IsShowDlgQuestionWindow():
-		#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DONT_USE_ITEM_WHEN_SHOW_CONFIRM)
-		#	return
-
-		net.SendItemUseToItemPacket(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos)
-
-	def __SendUseItemPacket(self, slotPos, slotWindow = player.INVENTORY):
-		# °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ »ç¿ë ¹æÁö
-		if uiPrivateShopBuilder.IsBuildingPrivateShop():
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_ITEM_FAILURE_PRIVATE_SHOP)
-			return
-
-		#if self.interface.IsShowDlgQuestionWindow():
-		#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DONT_USE_ITEM_WHEN_SHOW_CONFIRM)
-		#	return
-
-		net.SendItemUsePacket(slotWindow, slotPos)
-
-	def __SendMoveItemPacket(self, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, srcItemCount):
-		# °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ »ç¿ë ¹æÁö
-		if uiPrivateShopBuilder.IsBuildingPrivateShop():
-			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.MOVE_ITEM_FAILURE_PRIVATE_SHOP)
-			return
-
-		#if self.interface.IsShowDlgQuestionWindow():
-		#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DONT_USE_ITEM_WHEN_SHOW_CONFIRM)
-		#	return
-
-		net.SendItemMovePacket(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, srcItemCount)
-
-	def SetDragonSoulRefineWindow(self, DragonSoulRefine):
-		from _weakref import proxy
-		self.wndDragonSoulRefine = proxy(DragonSoulRefine)
-
-	def OnMoveWindow(self, x, y):
-		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-			pass
-		else:
-			if self.wndBelt:
-				self.wndBelt.AdjustPosition()
-
-	# ¾Ç¼¼¼­¸® ½½·Ô Å×µÎ¸® Ãß°¡, Á¦°Å.
-	## HilightSlot Change
-	def DeactivateSlot(self, slotindex, type):
-		if type == wndMgr.HILIGHTSLOT_MAX:
-			return
-
-		if app.ENABLE_ACCE_COSTUME_SYSTEM:
-			if type == wndMgr.HILIGHTSLOT_ACCE:
-				self.__DelHighlightSlotAcce(slotindex)
-
-		if app.ENABLE_CHANGE_LOOK_SYSTEM:
-			if type == wndMgr.HILIGHTSLOT_CHANGE_LOOK:
-				self.__DelHighlightSlotChangeLook(slotindex)
-
-		if app.ENABLE_AURA_COSTUME_SYSTEM:
-			if type == wndMgr.HILIGHTSLOT_AURA:
-				self.__DelHighlightSlotAura(slotindex)
-
-		if app.ENABLE_CUBE_RENEWAL:
-			if type == wndMgr.HILIGHTSLOT_CUBE:
-				self.__DelHighlightSlotCube(slotindex)
-
-	## HilightSlot Change
-	def ActivateSlot(self, slotindex, type):
-		if type == wndMgr.HILIGHTSLOT_MAX:
-			return
-
-		#if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-		#	self.DelHighlightSlot(slotindex)
-
-		if app.ENABLE_ACCE_COSTUME_SYSTEM:
-			if type == wndMgr.HILIGHTSLOT_ACCE:
-				self.__AddHighlightSlotAcce(slotindex)
-
-		if app.ENABLE_CHANGE_LOOK_SYSTEM:
-			if type == wndMgr.HILIGHTSLOT_CHANGE_LOOK:
-				self.__AddHighlightSlotChangeLook(slotindex)
-
-		if app.ENABLE_AURA_COSTUME_SYSTEM:
-			if type == wndMgr.HILIGHTSLOT_AURA:
-				self.__AddHighlightSlotAura(slotindex)
-
-		if app.ENABLE_CUBE_RENEWAL:
-			if type == wndMgr.HILIGHTSLOT_CUBE:
-				self.__AddHighlightSlotCube(slotindex)
-
-	if app.ENABLE_ACCE_COSTUME_SYSTEM:
-		## ¾Ç¼¼¼­¸® ¿ë ÇÏÀÌ¶óÀÌÆ® list Ãß°¡.
-		def __AddHighlightSlotAcce(self, slotIndex):
-			if not slotIndex in self.listHighlightedAcceSlot:
-				self.listHighlightedAcceSlot.append(slotIndex)
-
-		## ¾Ç¼¼¼­¸® ¿ë ÇÏÀÌ¶óÀÌÆ® list »èÁ¦.
-		def __DelHighlightSlotAcce(self, slotIndex):
-			if slotIndex in self.listHighlightedAcceSlot:
-				if slotIndex >= player.INVENTORY_PAGE_SIZE:
-					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-					self.wndItem.SetCanMouseEventSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-				else:
-					self.wndItem.DeactivateSlot(slotIndex)
-					self.wndItem.SetCanMouseEventSlot(slotIndex)
-
-				self.listHighlightedAcceSlot.remove(slotIndex)
-
-	if app.ENABLE_CHANGE_LOOK_SYSTEM:
-		def __AddHighlightSlotChangeLook(self, slotIndex):
-			if not slotIndex in self.listHighlightedChangeLookSlot:
-				self.listHighlightedChangeLookSlot.append(slotIndex)
-
-		def __DelHighlightSlotChangeLook(self, slotIndex):
-			if slotIndex in self.listHighlightedChangeLookSlot:
-				if slotIndex >= player.INVENTORY_PAGE_SIZE:
-					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-					self.wndItem.SetCanMouseEventSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-				else:
-					self.wndItem.DeactivateSlot(slotIndex)
-					self.wndItem.SetCanMouseEventSlot(slotIndex)
-				self.listHighlightedChangeLookSlot.remove(slotIndex)
-
-	if app.ENABLE_CUBE_RENEWAL:
-		def __AddHighlightSlotCube(self, slotIndex):
-			if not slotIndex in self.listHighlightedCubeSlot:
-				self.listHighlightedCubeSlot.append(slotIndex)
-
-		def __DelHighlightSlotCube(self, slotIndex):
-			if slotIndex in self.listHighlightedCubeSlot:
-				if slotIndex >= player.INVENTORY_PAGE_SIZE:
-					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-				else:
-					self.wndItem.DeactivateSlot(slotIndex)
-				self.listHighlightedCubeSlot.remove(slotIndex)
-
-	if app.ENABLE_AURA_COSTUME_SYSTEM:
-		def __AddHighlightSlotAura(self, slotIndex):
-			if not slotIndex in self.listHighlightedAuraSlot:
-				self.listHighlightedAuraSlot.append(slotIndex)
-
-		def __DelHighlightSlotAura(self, slotIndex):
-			if slotIndex in self.listHighlightedAuraSlot:
-				if slotIndex >= player.INVENTORY_PAGE_SIZE:
-					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-					self.wndItem.SetCanMouseEventSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-				else:
-					self.wndItem.DeactivateSlot(slotIndex)
-					self.wndItem.SetCanMouseEventSlot(slotIndex)
-				self.listHighlightedAuraSlot.remove(slotIndex)
-
-	## ÇÏÀÌ¶óÀÌÆ® ¸®ÇÁ·¹½¬.
-	def __HighlightSlot_Refresh(self):
-		## ¾Ç¼¼¼­¸®.
-		for i in xrange(self.wndItem.GetSlotCount()):
-			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if slotNumber in self.listHighlightedAcceSlot:
-					self.wndItem.ActivateSlot(i)
-					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_GREEN)
-					self.wndItem.SetCantMouseEventSlot(i)
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if slotNumber in self.listHighlightedChangeLookSlot:
-					self.wndItem.ActivateSlot(i)
-					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_RED)
-					self.wndItem.SetCantMouseEventSlot(i)
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if slotNumber in self.listHighlightedAuraSlot:
-					self.wndItem.ActivateSlot(i)
-					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_GREEN)
-					self.wndItem.SetCantMouseEventSlot(i)
-
-			if app.ENABLE_CUBE_RENEWAL:
-				if slotNumber in self.listHighlightedCubeSlot:
-					self.wndItem.ActivateSlot(i)
-					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_RED)
-
-			## HilightSlot Change
-			if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-				if slotNumber in self.listHighlightedSlot:
-					self.wndItem.ActivateSlot(i)
-					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_MAX)
-
-	## ¾Ç¼¼¼­¸® ¿ë ÇÏÀÌ¶óÀÌÆ® list Å¬¸®¾î.
-	def __HighlightSlot_Clear(self):
-		## ¾Ç¼¼¼­¸®
-		for i in xrange(self.wndItem.GetSlotCount()):
-			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
-
-			if app.ENABLE_ACCE_COSTUME_SYSTEM:
-				if slotNumber in self.listHighlightedAcceSlot:
-					self.wndItem.DeactivateSlot(i)
-					self.wndItem.SetCanMouseEventSlot(i)
-					self.listHighlightedAcceSlot.remove(slotNumber)
-
-			if app.ENABLE_CHANGE_LOOK_SYSTEM:
-				if slotNumber in self.listHighlightedChangeLookSlot:
-					self.wndItem.DeactivateSlot(i)
-					self.wndItem.SetCanMouseEventSlot(i)
-					self.listHighlightedChangeLookSlot.remove(slotNumber)
-
-			if app.ENABLE_AURA_COSTUME_SYSTEM:
-				if slotNumber in self.listHighlightedAuraSlot:
-					self.wndItem.DeactivateSlot(i)
-					self.wndItem.SetCanMouseEventSlot(i)
-					self.listHighlightedAuraSlot.remove(slotNumber)
-
-			if app.ENABLE_CUBE_RENEWAL:
-				if slotNumber in self.listHighlightedCubeSlot:
-					self.wndItem.DeactivateSlot(i)
-					self.listHighlightedCubeSlot.remove(slotNumber)
-
-			## HilightSlot Change
-			if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-				if slotNumber in self.listHighlightedSlot:
-					self.wndItem.DeactivateSlot(i)
-					self.listHighlightedSlot.remove(slotNumber)
-
-	if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
-		# ½½·Ô highlight °ü·Ã
-		## Ãß°¡
-		def HighlightSlot(self, slot):
-			#slot°ª¿¡ ´ëÇÑ ¿¹¿ÜÃ³¸®.
-			if slot > player.INVENTORY_PAGE_SIZE * player.INVENTORY_PAGE_COUNT:
-				return
-
-			if not slot in self.listHighlightedSlot:
-				self.listHighlightedSlot.append(slot)
-
-		## »èÁ¦
-		def DelHighlightSlot(self, inventorylocalslot):
-			if inventorylocalslot in self.listHighlightedSlot:
-				if inventorylocalslot >= player.INVENTORY_PAGE_SIZE:
-					self.wndItem.DeactivateSlot(inventorylocalslot - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
-				else:
-					self.wndItem.DeactivateSlot(inventorylocalslot)
-
-				self.listHighlightedSlot.remove(inventorylocalslot)
-
-		# ½½·Ô highlight °ü·Ã ³¡
-
-	# wj.2014.12.2. ÀÎº¥Åä¸®¿Í DSÀÎº¥ °£ÀÇ »óÅÂ¸¦ È®ÀÎ ¹× ¼³Á¤ÇÏ±â À§ÇÑ ÇÔ¼ö.
-	def IsDlgQuestionShow(self):
-		if self.dlgQuestion.IsShow():
-			return True
-		else:
-			return False
-
-	def CancelDlgQuestion(self):
-		self.__Cancel()
-
-	def SetUseItemMode(self, bUse):
-		self.wndItem.SetUseMode(bUse)
-
-	if app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_CHEQUE_SYSTEM or app.ENABLE_ATTR_6TH_7TH:
-		def GetInventoryPageIndex(self):
-			## 0 or 1
-			return self.inventoryPageIndex
-
-	if app.ENABLE_GROWTH_PET_SYSTEM:
-		def __UseItemPet(self, slotIndex):
-			itemSubType = item.GetItemSubType()		
-			if item.PET_EGG == itemSubType:
-				self.petHatchingWindow.HatchingWindowOpen(player.INVENTORY, slotIndex)
-				
-			elif item.PET_UPBRINGING == itemSubType:
-				if self.__CanUseGrowthPet(slotIndex):
-					self.__SendUseItemPacket(slotIndex)
-						
-			elif item.PET_BAG == itemSubType:
-				if self.__CanUsePetBagItem(slotIndex):
-					if self.questionDialog:
-						self.questionDialog.Close()
-						
-					self.questionDialog = uiCommon.QuestionDialog()
-					self.questionDialog.SetText(localeInfo.INVENTORY_REALLY_USE_PET_BAG_TAKE_OUT)
-					self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnAccept))
-					self.questionDialog.SetCancelEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnCancel))
-					self.questionDialog.slotIndex = slotIndex
-					self.questionDialog.Open()
-
-			if item.PET_SKILL_ALL_DEL_BOOK == itemSubType:
-				pet_id = player.GetActivePetItemId()
-				if 0 == pet_id:
-					return
-				(skill_count, pet_skill1, pet_skill_level1, pet_skill_cool1, pet_skill2, pet_skill_level2, pet_skill_cool2, pet_skill3, pet_skill_level3, pet_skill_cool3) = player.GetPetSkill(pet_id)
-				if 0 == pet_skill1 and 0 == pet_skill2 and 0 == pet_skill3:
-					popup = uiCommon.PopupDialog()
-					popup.SetText(localeInfo.PET_EMPTY_SKILL_SLOT_USE_ITEM)
-					popup.SetAcceptEvent(self.__OnClosePopupDialog)
-					popup.Open()
-					self.pop = popup
-					return
-			
-				self.PetSkillAllDelBookIndex = slotIndex
-				self.SetCantMouseEventSlot( self.PetSkillAllDelBookIndex )
-				
-				self.PetSkillDelDlg.SetAcceptEvent(ui.__mem_func__(self.__PetSkillDeleteQuestionDialogAccept))
-				self.PetSkillDelDlg.SetCancelEvent(ui.__mem_func__(self.__PetSkillDeleteQuestionDialogCancel))
-				
-				self.PetSkillDelDlg.SetText1( localeInfo.PET_SKILL_DELETE_QUESTION_DLG_MSG1 )
-				self.PetSkillDelDlg.SetText2( localeInfo.PET_SKILL_DELETE_QUESTION_DLG_MSG2 )
-				(w,h) = self.PetSkillDelDlg.GetTextSize1()
-				self.PetSkillDelDlg.SetWidth(w+100)
-				self.PetSkillDelDlg.Open()
-				
-		def __OnClosePopupDialog(self):
-			self.pop = None
-
-		def __ActivePetHighlightSlot(self, slotNumber):
-			active_id = player.GetActivePetItemId()
-			
-			if active_id == player.GetItemMetinSocket(player.INVENTORY, slotNumber, 2):
-				
-				if slotNumber >= player.INVENTORY_PAGE_SIZE:
-					slotNumber -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
-			
-				self.wndItem.ActivateSlot(slotNumber)
-			else:
-				if slotNumber >= player.INVENTORY_PAGE_SIZE:
-					slotNumber -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
-					
-				self.wndItem.DeactivateSlot(slotNumber)
-
-		def __SetCoolTimePetItemSlot(self, slotNumber, itemVnum):
-		
-			item.SelectItem(itemVnum)
-			itemSubType = item.GetItemSubType()
-		
-			if itemSubType not in [item.PET_UPBRINGING, item.PET_BAG]:
-				return
-				
-			if itemSubType == item.PET_BAG:
-				id = player.GetItemMetinSocket(player.INVENTORY, slotNumber, 2)
-				if id == 0:
-					return
-			
-			(limitType, limitValue) = item.GetLimit(0)
-
-			if itemSubType == item.PET_UPBRINGING:
-				limitValue = player.GetItemMetinSocket(player.INVENTORY, slotNumber, 1)
-					
-			if limitType in [item.LIMIT_REAL_TIME, item.LIMIT_REAL_TIME_START_FIRST_USE]:
-								
-				sock_time   = player.GetItemMetinSocket(player.INVENTORY, slotNumber, 0)
-				
-				remain_time = max(0, sock_time - app.GetGlobalTimeStamp())
-			
-				if slotNumber >= player.INVENTORY_PAGE_SIZE:
-					slotNumber -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
-
-				self.wndItem.SetSlotCoolTimeInverse(slotNumber, limitValue, limitValue - remain_time)
-
-		def __IsPetItem(self, srcItemVID):
-			item.SelectItem(srcItemVID)
-			
-			if item.GetItemType() == item.ITEM_TYPE_PET:
-				return True
-			
-			return False
-
-		def __SendUsePetItemToItemPacket(self, srcItemVID, srcItemSlotPos, dstItemSlotPos):
-			if self.__CanUseSrcPetItemToDstPetItem(srcItemVID, srcItemSlotPos, dstItemSlotPos):
-				srcItemVnum		= player.GetItemIndex(srcItemSlotPos)
-				item.SelectItem( srcItemVnum )
-				srcItemType		= item.GetItemType()
-				srcItemSubType	= item.GetItemSubType()
-				
-				if item.ITEM_TYPE_PET == srcItemType:					
-					if srcItemSubType in [item.PET_FEEDSTUFF, item.PET_BAG]:
-						self.__OpenPetItemQuestionDialog(srcItemSlotPos, dstItemSlotPos)
-					elif item.PET_NAME_CHANGE == srcItemSubType:
-						self.__UseItemPetNameChange(srcItemSlotPos, dstItemSlotPos)
-				return True
-				
-			return False
-			
-		def __UseItemPetNameChange(self, srcSlotPos, dstSlotPos):
-			if self.petNameChangeWindow:
-				self.petNameChangeWindow.NameChangeWindowOpen(srcSlotPos, dstSlotPos)
-
-		def __IsUsablePetItem(self, srcItemVNum):
-			item.SelectItem(srcItemVNum)
-			srcItemType		= item.GetItemType()
-			srcItemSubType	= item.GetItemSubType()
-
-			if srcItemType != item.ITEM_TYPE_PET:
-				return False
-			
-			if srcItemSubType not in [item.PET_UPBRINGING, item.PET_FEEDSTUFF, item.PET_BAG, item.PET_NAME_CHANGE]:
-				return False
-			
-			return True
-
-		def __CanUseSrcPetItemToDstPetItem(self, srcItemVNum, srcSlotPos, dstSlotPos):
-			item.SelectItem(srcItemVNum)
-			srcItemType		= item.GetItemType()
-			srcItemSubType	= item.GetItemSubType()
-			
-			if srcItemType != item.ITEM_TYPE_PET:
-				return False
-			
-			if srcItemSubType == item.PET_FEEDSTUFF:		
-				detIndex = player.GetItemIndex(dstSlotPos)
-				item.SelectItem(detIndex)
-				
-				dstItemType		= item.GetItemType()
-				dstItemSubType	= item.GetItemSubType()
-				
-				if dstItemType != item.ITEM_TYPE_PET:
-					return False
-					
-				if dstItemSubType not in [item.PET_UPBRINGING]:
-					return False
-					
-				if dstItemSubType == item.PET_BAG:
-					incaseTime = player.GetItemMetinSocket(dstSlotPos, 1)
-					if incaseTime == 0:
-						return False
-			
-			elif srcItemSubType == item.PET_BAG:
-				detIndex = player.GetItemIndex(dstSlotPos)
-				item.SelectItem(detIndex)
-				
-				dstItemType		= item.GetItemType()
-				dstItemSubType	= item.GetItemSubType()
-				
-				if dstItemType != item.ITEM_TYPE_PET:
-					return False
-					
-				if dstItemSubType not in [item.PET_UPBRINGING, item.PET_BAG]:
-					return False
-			
-				lifeTime = player.GetItemMetinSocket(dstSlotPos, 0)
-					
-				if dstItemSubType == item.PET_UPBRINGING:
-					if lifeTime < app.GetGlobalTimeStamp():
-						return False
-
-					srcIncase = player.GetItemMetinSocket(srcSlotPos, 1)
-					if srcIncase != 0:
-						return False
-					
-				elif dstItemSubType == item.PET_BAG:
-					if lifeTime > app.GetGlobalTimeStamp():
-						return False
-						
-					srcIncase = player.GetItemMetinSocket(srcSlotPos, 1)
-					if srcIncase != 0:
-						return False
-					
-					destIncase = player.GetItemMetinSocket(dstSlotPos, 1)
-					if destIncase == 0:
-						return False
-						
-			elif srcItemSubType == item.PET_NAME_CHANGE:
-				detIndex = player.GetItemIndex(dstSlotPos)
-				item.SelectItem(detIndex)
-				
-				dstItemType		= item.GetItemType()
-				dstItemSubType	= item.GetItemSubType()
-				
-				if dstItemType != item.ITEM_TYPE_PET:
-					return False
-					
-				if dstItemSubType not in [item.PET_UPBRINGING]:
-					return False
-					
-			else:
-				return False
-			
-			return True
-
-		def __CanUseGrowthPet(self, slotIndex):
-			if not player.GetItemMetinSocket(player.INVENTORY, slotIndex, 2):
-				return False
-				
-			(limitType, limitValue) = item.GetLimit(0)
-			remain_time = 999
-			if item.LIMIT_REAL_TIME == limitType:
-				sock_time   = player.GetItemMetinSocket(player.INVENTORY, slotIndex, 0)
-				if app.GetGlobalTimeStamp() > sock_time:
-					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.PET_CAN_NOT_SUMMON_BECAUSE_LIFE_TIME_END)
-					return False
-					
-			return True
-
-		def __CanUsePetBagItem(self, slotIndex):
-			if not player.GetItemMetinSocket(player.INVENTORY, slotIndex, 2):
-				return False
-				
-			(limitType, limitValue) = item.GetLimit(0)
-			remain_time = 999
-			if item.LIMIT_REAL_TIME_START_FIRST_USE == limitType:
-				sock_time   = player.GetItemMetinSocket(player.INVENTORY, slotIndex, 0)
-				use_cnt	    = player.GetItemMetinSocket(player.INVENTORY, slotIndex, 1)
-				
-				if use_cnt:
-					if app.GetGlobalTimeStamp() > sock_time:
-						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.PET_CAN_NOT_USE_BAG)
-						return False;
-						
-			return True
-
-		def __CanAttachGrowthPetItem(self, itemVNum, itemSlotIndex):
-			activePetId = player.GetActivePetItemId()
-			if activePetId == 0:
-				return True
-			
-			item.SelectItem(itemVNum)
-			itemType	= item.GetItemType()
-			itemSubType = item.GetItemSubType()
-			
-			if item.ITEM_TYPE_PET == itemType and itemSubType == item.PET_UPBRINGING:
-				petId = player.GetItemMetinSocket(itemSlotIndex, 2)
-				if petId == activePetId:
-					return False
-					
-					
-			return True
-
-		def SetPetHatchingWindow(self, window):
-			self.petHatchingWindow = window
-
-		def SetPetNameChangeWindow(self, window):
-			self.petNameChangeWindow = window
-
-		def SetPetFeedWindow(self, window):
-			self.petFeedWindow = window
-
-		def ItemMoveFeedWindow(self, slotWindow, slotIndex):
-			if not self.petFeedWindow:
-				return
-				
-			self.petFeedWindow.ItemMoveFeedWindow(slotWindow, slotIndex)
-
-		def __OpenPetBagQuestionDialog(self, srcItemSlotPos, dstItemSlotPos):
-			if self.interface.IsShowDlgQuestionWindow():
-				self.interface.CloseDlgQuestionWindow()
-
-		def __OpenPetItemQuestionDialog(self, srcItemPos, dstItemPos):
-			if self.interface.IsShowDlgQuestionWindow():
-				self.interface.CloseDlgQuestionWindow()
-			
-			getItemVNum=player.GetItemIndex
-			self.srcItemPos = srcItemPos
-			self.dstItemPos = dstItemPos
-
-			srcItemVnum = getItemVNum(srcItemPos)
-			dstItemVnum = getItemVNum(dstItemPos)
-			
-			item.SelectItem( srcItemVnum )
-			src_item_name = item.GetItemName( srcItemVnum )
-			srcItemType		= item.GetItemType()
-			srcItemSubType	= item.GetItemSubType()
-			
-			item.SelectItem( dstItemVnum )
-			dst_item_name = item.GetItemName( getItemVNum(dstItemPos) )
-			
-			self.PetItemQuestionDlg.SetAcceptEvent(ui.__mem_func__(self.__PetItemAccept))
-			self.PetItemQuestionDlg.SetCancelEvent(ui.__mem_func__(self.__PetItemCancel))
-			
-			if item.ITEM_TYPE_PET == srcItemType:
-				if item.PET_FEEDSTUFF == srcItemSubType:
-					self.PetItemQuestionDlg.SetText( localeInfo.INVENTORY_REALLY_USE_PET_FEEDSTUFF_ITEM % ( src_item_name, dst_item_name ) )
-					self.PetItemQuestionDlg.Open()
-				
-				elif item.PET_BAG == srcItemSubType:
-					self.PetItemQuestionDlg.SetText( localeInfo.INVENTORY_REALLY_USE_PET_BAG_ITEM )
-					self.PetItemQuestionDlg.Open()
-				
-		def __PetItemAccept(self):
-			self.PetItemQuestionDlg.Close()
-			self.__SendUseItemToItemPacket(self.srcItemPos, self.dstItemPos)
-			self.srcItemPos = (0, 0)
-			self.dstItemPos = (0, 0)
-			self.srcItemWindow = None
-			self.dstItemWindow = None
-
-		def __PetItemCancel(self):
-			self.srcItemPos = (0, 0)
-			self.dstItemPos = (0, 0)
-			self.PetItemQuestionDlg.Close()
-
-		def __PetSkillDeleteQuestionDialogAccept(self):
-			net.SendPetDeleteAllSkill( self.PetSkillAllDelBookIndex )	
-			self.__PetSkillDeleteQuestionDialogCancel()
-			
-		def __PetSkillDeleteQuestionDialogCancel(self):
-			self.PetSkillDelDlg.Close()
-			self.SetCanMouseEventSlot( self.PetSkillAllDelBookIndex )
-			self.PetSkillAllDelBookIndex = -1
-			
-		def SetCanMouseEventSlot(self, inven_slot_index):
-			if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
-				page = self.GetInventoryPageIndex() # range 0,1,2,3
-				inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
-			self.wndItem.SetCanMouseEventSlot(inven_slot_index)
-			
-		def SetCantMouseEventSlot(self, inven_slot_index):
-			if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
-				page = self.GetInventoryPageIndex() # range 0,1,2,3
-				inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
-			self.wndItem.SetCantMouseEventSlot(inven_slot_index)
-
-	if app.ENABLE_CHEQUE_SYSTEM:
-		def OverInToolTip(self, arg) :
-			arglen = len(str(arg))
-			pos_x, pos_y = wndMgr.GetMousePosition()
-
-			self.toolTip.ClearToolTip()
-			self.toolTip.SetThinBoardSize(11 * arglen)
-			self.toolTip.SetToolTipPosition(pos_x + 5, pos_y - 5)
-			self.toolTip.AppendTextLine(arg, 0xffffff00)
-			self.toolTip.Show()
-
-		def OverOutToolTip(self) :
-			self.toolTip.Hide()
-
-		def EventProgress(self, event_type, idx):
-			if "mouse_over_in" == str(event_type):
-				if idx == 0:
-					self.OverInToolTip(localeInfo.CHEQUE_SYSTEM_UNIT_YANG)
-				elif idx == 1:
-					self.OverInToolTip(localeInfo.CHEQUE_SYSTEM_UNIT_WON)
-				elif app.ENABLE_GEM_SYSTEM and idx == 2:
-					self.OverInToolTip(localeInfo.GEM_SYSTEM_NAME)
-				else:
-					return
-			elif "mouse_over_out" == str(event_type):
-				self.OverOutToolTip()
-			else:
-				return
-
-	if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-		def BindEquipmentWindow(self, equipment_window):
-			self.wndEquipment = equipment_window
-
-	def UseInventoryItemInQuickSlot(self, global_slot_index):
-		self.__UseItem(global_slot_index, player.INVENTORY)
-
-	if app.ENABLE_HIDE_COSTUME_SYSTEM:
-		def SetHiddenCostumePart(self, part, hidden):
-			if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
-				if self.wndEquipment:
-					self.wndEquipment.SetHiddenCostumePart(part, hidden)
-			else:
-				if self.wndCostume:
-					self.wndCostume.SetHiddenCostumePart(part, hidden)
+import ui
+import player
+import mouseModule
+import net
+import app
+import snd
+import item
+import player
+import chat
+import grp
+import uiScriptLocale
+import uiRefine
+import uiAttachMetin
+import uiPickMoney
+import uiCommon
+import uiPrivateShopBuilder # Î»  ItemMove 
+import localeInfo
+import constInfo
+import ime
+import wndMgr
+
+if app.ENABLE_CHEQUE_SYSTEM:
+	import uiToolTip
+	import uiPickETC
+
+ITEM_FLAG_APPLICABLE = 1 << 14
+
+if app.ENABLE_EXTEND_INVEN_SYSTEM:
+	EX_INVEN_COVER_IMG_OPEN = "d:/ymir work/ui/game/windows/ex_inven_cover_button_open.sub"
+	EX_INVEN_COVER_IMG_CLOSE = "d:/ymir work/ui/game/windows/ex_inven_cover_button_close.sub"
+
+if app.ENABLE_HIDE_COSTUME_SYSTEM:
+	import chr
+
+def ReprGetItemIndex(window):
+	return lambda pos : player.GetItemIndex(window, pos)
+
+def ReprGetItemCount(window):
+	return lambda pos : player.GetItemCount(window, pos)
+
+if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+	class EquipmentWindow(ui.ScriptWindow):
+		EQUIPMENT_CHANGE_COOLTIME = 3
+		EXPANSION_CHANGE_HEIGHT_SIZE = 20
+
+		def __init__(self):
+			self.wnd_costume = None
+			self.wnd_inventory = None
+			self.wnd_belt = None
+
+			ui.ScriptWindow.__init__(self)
+
+			self.__Initialize()
+			self.__LoadWindow()
+
+		def __del__(self):
+			ui.ScriptWindow.__del__(self)
+
+		def __Initialize(self):
+			self.is_loaded = 0
+
+			self.interface = None
+
+			self.current_page = 0
+			self.tab_btn = []
+			self.tab_img = []
+
+		def __LoadWindow(self):
+			if self.is_loaded == 1:
+				return
+
+			self.is_loaded = 1
+
+			try:
+				pyScrLoader = ui.PythonScriptLoader()
+				pyScrLoader.LoadScriptFile(self, "UIScript/EquipmentDialog.py")
+			except:
+				import exception
+				exception.Abort("CostumeWindow.LoadWindow.LoadObject")
+
+			try:
+				self.GetChild("board").SetTitleName(localeInfo.EQUIPMENT_TITLE_NAME)
+				self.GetChild("board").SetCloseEvent(ui.__mem_func__(self.Close))
+
+				self.equipment_slot = self.GetChild("equipment_slot")
+				self.unique_slot = self.GetChild("unique_slot")
+
+				self.dragon_soul_button = self.GetChild("dragon_soul_button")
+				self.mall_button = self.GetChild("mall_button")
+				self.premium_private_shop_button = self.GetChild("premium_private_shop_button")
+				self.costume_button = self.GetChild("costume_button")
+
+				self.tab_btn = []
+				self.tab_btn.append(self.GetChild("tab_btn_01"))
+				self.tab_btn.append(self.GetChild("tab_btn_02"))
+
+				self.tab_img = []
+				self.tab_img.append(self.GetChild("tab_img_01"))
+				self.tab_img.append(self.GetChild("tab_img_02"))
+
+				for btn in self.tab_btn:
+					btn.Hide()
+
+				for img in self.tab_img:
+					img.Hide()
+			except:
+				import exception
+				exception.Abort("EquipmentWindow.LoadWindow.BindObject")
+
+			self.equipment_slot.SetSlotType(player.SLOT_TYPE_EQUIPMENT)
+			self.unique_slot.SetSlotType(player.SLOT_TYPE_EQUIPMENT)
+
+			self.dragon_soul_button.SetEvent(ui.__mem_func__(self.__ClickDSSButton))
+			self.mall_button.SetEvent(ui.__mem_func__(self.__ClickMallButton))
+			self.premium_private_shop_button.SetEvent(ui.__mem_func__(self.__ClickPremiumPrivateShopButton))
+			self.costume_button.SetEvent(ui.__mem_func__(self.__ClickCostumeButton))
+
+		def __CreateCostumeWindow(self):
+			pass
+
+		def BindInterface(self, interface):
+			from _weakref import proxy
+			self.interface = proxy(interface)
+
+		def BindInventoryWindow(self, inventory_window):
+			from _weakref import proxy
+			self.wnd_inventory = proxy(inventory_window)
+
+			x, y = self.wnd_inventory.GetGlobalPosition()
+			self.SetPosition(x, y - self.GetHeight())
+
+			self.equipment_slot.SetOverInItemEvent(ui.__mem_func__(self.wnd_inventory.OverInItem), player.EQUIPMENT)
+			self.equipment_slot.SetOverOutItemEvent(ui.__mem_func__(self.wnd_inventory.OverOutItem))
+			self.equipment_slot.SetUnselectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
+			self.equipment_slot.SetUseSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
+			self.equipment_slot.SetSelectEmptySlotEvent(ui.__mem_func__(self.wnd_inventory.SelectEmptySlot), player.EQUIPMENT)
+			self.equipment_slot.SetSelectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.SelectItemSlot), player.EQUIPMENT)
+
+			self.unique_slot.SetOverInItemEvent(ui.__mem_func__(self.wnd_inventory.OverInItem), player.EQUIPMENT)
+			self.unique_slot.SetOverOutItemEvent(ui.__mem_func__(self.wnd_inventory.OverOutItem))
+			self.unique_slot.SetUnselectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
+			self.unique_slot.SetUseSlotEvent(ui.__mem_func__(self.wnd_inventory.UseItemSlot), player.EQUIPMENT)
+			self.unique_slot.SetSelectEmptySlotEvent(ui.__mem_func__(self.wnd_inventory.SelectEmptySlot), player.EQUIPMENT)
+			self.unique_slot.SetSelectItemSlotEvent(ui.__mem_func__(self.wnd_inventory.SelectItemSlot), player.EQUIPMENT)
+
+			self.wnd_costume = CostumeWindow(self.wnd_inventory)
+			self.wnd_belt = BeltInventoryWindow(self.wnd_inventory)
+			self.wnd_belt.SetMoveParentWindow(self)
+
+		def __ClickDSSButton(self):
+			self.interface.ToggleDragonSoulWindow()
+
+		def __ClickMallButton(self):
+			net.SendCommandPacket("/click_mall")
+
+		def __ClickPremiumPrivateShopButton(self):
+			self.interface.TogglePrivateShopPanelWindow()
+
+		def __ClickCostumeButton(self):
+			if not self.wnd_costume:
+				return
+
+			if not self.wnd_costume.IsShow():
+				self.wnd_costume.Show()
+			else:
+				self.wnd_costume.Close()
+
+		def ShowCostumeInventory(self):
+			if self.wnd_costume:
+				self.wnd_costume.Show()
+
+		def Show(self):
+			self.__LoadWindow()
+
+			if self.wnd_costume and self.wnd_costume.IsOpen():
+				self.wnd_costume.Show()
+
+			if self.wnd_belt:
+				self.wnd_belt.Show()
+
+			ui.ScriptWindow.Show(self)
+			self.SetTop()
+
+		def Hide(self):
+			if self.wnd_costume:
+				self.wnd_costume.Hide()
+
+			if self.wnd_belt:
+				self.wnd_belt.Hide()
+
+			ui.ScriptWindow.Hide(self)
+
+		def OnTop(self):
+			(x, y) = self.GetLocalPosition()
+			if y < 0:
+				self.SetPosition(x, 0)
+
+		def Close(self):
+			self.Hide()
+
+		def OnPressEscapeKey(self):
+			self.Close()
+			return True
+
+		def Destroy(self):
+			if self.wnd_costume:
+				del self.wnd_costume
+				self.wnd_costume = None
+
+			if self.wnd_belt:
+				del self.wnd_belt
+				self.wnd_belt = None
+
+		def RefreshSlot(self):
+			self.__RefreshEquipmentSlot()
+			self.__RefreshUniqueSlot()
+
+			if self.wnd_belt:
+				self.wnd_belt.RefreshSlot()
+
+		def __RefreshEquipmentSlot(self):
+			if not self.equipment_slot:
+				return
+
+			getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
+			getItemCount = ReprGetItemCount(player.EQUIPMENT)
+			setItemVNum = self.equipment_slot.SetItemSlot
+
+			for i in xrange(player.WEAR_MAX): ## 32 ( 0 ~ 31 )
+				itemCount = getItemCount(i)
+				if itemCount <= 1:
+					itemCount = 0
+
+				setItemVNum(i, getItemVNum(i), itemCount)
+
+				if app.ENABLE_CHANGE_LOOK_SYSTEM:
+					if not player.GetChangeLookVnum(player.EQUIPMENT, i) == 0:
+						self.equipment_slot.SetSlotCoverImage(i, "icon/item/ingame_convert_Mark.tga")
+					else:
+						self.equipment_slot.EnableSlotCoverImage(i,False)
+
+			self.equipment_slot.RefreshSlot()
+
+			if self.wnd_costume:
+				self.wnd_costume.RefreshCostumeSlot()
+
+		def __RefreshUniqueSlot(self):
+			if not self.unique_slot:
+				return
+
+			getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
+			getItemCount = ReprGetItemCount(player.EQUIPMENT)
+			setItemVNum = self.unique_slot.SetItemSlot
+
+			for i in xrange(player.WEAR_MAX):
+				itemCount = getItemCount(i)
+				if itemCount <= 1:
+					itemCount = 0
+
+				setItemVNum(i, getItemVNum(i), itemCount)
+
+			self.unique_slot.RefreshSlot()
+
+		def OnMoveWindow(self, x, y):
+			if self.wnd_belt:
+				self.wnd_belt.SetMoveParentWindow(self)
+
+		def GetBeltWnd(self):
+			return self.wnd_belt
+
+		def __RequestChangeEquipmentpage(self, page_index): pass
+		def __UseChangeEquipmentPageSkill(self, page_index): pass
+		def AdditionalEquipmentPageSetting(self, page_index): pass
+		def EquipmentPageTabSetting(self, page_index): pass
+		def IsActiveAdditionalEquipmentPage(self): pass
+		def ToggleEquipmentPage(self): pass
+
+		if app.ENABLE_HIDE_COSTUME_SYSTEM:
+			def SetHiddenCostumePart(self, part, hidden):
+				if self.wnd_costume:
+					self.wnd_costume.SetHiddenCostumePart(part, hidden)
+
+class CostumeWindow(ui.ScriptWindow):
+	def __init__(self, wndInventory):
+		import exception
+
+		if not wndInventory:
+			exception.Abort("wndInventory parameter must be set to InventoryWindow")
+			return
+
+		ui.ScriptWindow.__init__(self)
+
+		self.isLoaded = 0
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.isOpen = 0
+
+		if app.ENABLE_HIDE_COSTUME_SYSTEM:
+			self.slot_image_dict = {}
+			self.slot_btn_dict = {}
+
+			self.visible_wnd_dict = { item.COSTUME_TYPE_BODY : (62, 45), item.COSTUME_TYPE_HAIR : (62, 9), }
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				self.visible_wnd_dict.update({ item.COSTUME_TYPE_ACCE : (70, 126) })
+			if app.ENABLE_WEAPON_COSTUME_SYSTEM:
+				self.visible_wnd_dict.update({ item.COSTUME_TYPE_WEAPON : (13, 13) })
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				self.visible_wnd_dict.update({ item.COSTUME_TYPE_AURA : (37, 126) })
+
+		self.wndInventory = wndInventory;
+
+		self.__LoadWindow()
+
+	def __del__(self):
+		ui.ScriptWindow.__del__(self)
+
+	def Show(self):
+		self.__LoadWindow()
+		self.RefreshCostumeSlot()
+
+		ui.ScriptWindow.Show(self)
+		self.SetTop()
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.isOpen = 1
+
+	if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+		def IsOpen(self):
+			return self.isOpen
+
+	def Close(self):
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.isOpen = 0
+
+		self.Hide()
+
+	def __LoadWindow(self):
+		if self.isLoaded == 1:
+			return
+
+		self.isLoaded = 1
+
+		try:
+			pyScrLoader = ui.PythonScriptLoader()
+			pyScrLoader.LoadScriptFile(self, "UIScript/CostumeWindow.py")
+		except:
+			import exception
+			exception.Abort("CostumeWindow.LoadWindow.LoadObject")
+
+		try:
+			wndEquip = self.GetChild("CostumeSlot")
+			if app.ENABLE_HIDE_COSTUME_SYSTEM:
+				self.base_image = self.GetChild("Costume_Base")
+
+			self.GetChild("TitleBar").SetCloseEvent(ui.__mem_func__(self.Close))
+
+		except:
+			import exception
+			exception.Abort("CostumeWindow.LoadWindow.BindObject")
+
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			x, y = self.wndInventory.GetGlobalPosition()
+			self.SetPosition(x - 150, y - self.wndInventory.GetHeight() + 65)
+			(x, y) = self.GetLocalPosition()
+			if y < 0:
+				self.SetPosition(x, 0)
+
+		if app.ENABLE_HIDE_COSTUME_SYSTEM:
+			## Slot Image List
+			self.slot_image_dict = {}
+			for key, (x, y) in self.visible_wnd_dict.items():
+				slot_image = ui.ImageBox()
+				slot_image.SetParent(self.base_image)
+				slot_image.AddFlag("not_pick")
+				slot_image.SetPosition(x + 4, y + 4)
+				if key == item.COSTUME_TYPE_BODY:
+					slot_image.LoadImage("d:/ymir work/ui/game/costume/hideslot_02.tga")
+				elif app.ENABLE_WEAPON_COSTUME_SYSTEM and key == item.COSTUME_TYPE_WEAPON:
+					slot_image.LoadImage("d:/ymir work/ui/game/costume/hideslot_03.tga")
+				else:
+					slot_image.LoadImage("d:/ymir work/ui/game/costume/hideslot_01.tga")
+				slot_image.Hide()
+				self.slot_image_dict[key] = slot_image
+
+			## Slot Button List
+			self.slot_btn_dict = {}
+			for key, (x, y) in self.visible_wnd_dict.items():
+				btn = ui.Button()
+				btn.SetParent(self.base_image)
+				btn.SetPosition(x, y)
+				btn.SetUpVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
+				btn.SetOverVisual("d:/ymir work/ui/game/costume/eye_normal_02.tga")
+				btn.SetDownVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
+				btn.SetToolTipText(localeInfo.HIDE_COSTUME_TOOLTIP)
+				btn.SetEvent(ui.__mem_func__(self.__ClickVisibleButton), key, 1)
+				btn.Show()
+				self.slot_btn_dict[key] = btn
+
+		## Equipment
+		wndEquip.SetOverInItemEvent(ui.__mem_func__(self.wndInventory.OverInItem), player.EQUIPMENT)
+		wndEquip.SetOverOutItemEvent(ui.__mem_func__(self.wndInventory.OverOutItem))
+		wndEquip.SetUnselectItemSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.EQUIPMENT)
+		wndEquip.SetUseSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.EQUIPMENT)
+		wndEquip.SetSelectEmptySlotEvent(ui.__mem_func__(self.wndInventory.SelectEmptySlot), player.EQUIPMENT)
+		wndEquip.SetSelectItemSlotEvent(ui.__mem_func__(self.wndInventory.SelectItemSlot), player.EQUIPMENT)
+
+		self.wndEquip = wndEquip
+
+	def RefreshCostumeSlot(self):
+		getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
+
+		for i in xrange(item.COSTUME_SLOT_COUNT):
+			slotNumber = item.COSTUME_SLOT_START + i
+			self.wndEquip.SetItemSlot(slotNumber, getItemVNum(slotNumber), 0)
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if not player.GetChangeLookVnum(player.EQUIPMENT, slotNumber) == 0:
+					self.wndEquip.SetSlotCoverImage(slotNumber, "icon/item/ingame_convert_Mark.tga")
+				else:
+					self.wndEquip.EnableSlotCoverImage(slotNumber, False)
+
+		if app.ENABLE_WEAPON_COSTUME_SYSTEM:
+			self.wndEquip.SetItemSlot(item.COSTUME_SLOT_WEAPON, getItemVNum(item.COSTUME_SLOT_WEAPON), 0)
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if not player.GetChangeLookVnum(player.EQUIPMENT, item.COSTUME_SLOT_WEAPON) == 0:
+					self.wndEquip.SetSlotCoverImage(item.COSTUME_SLOT_WEAPON, "icon/item/ingame_convert_Mark.tga")
+				else:
+					self.wndEquip.EnableSlotCoverImage(item.COSTUME_SLOT_WEAPON, False)
+
+		self.wndEquip.RefreshSlot()
+
+	if app.ENABLE_HIDE_COSTUME_SYSTEM:
+		def __ClickVisibleButton(self, part, hidden):
+			if part in self.visible_wnd_dict:
+				net.SendCommandPacket("/hide_costume_part %d %d" % (part, hidden))
+
+		def SetHiddenCostumePart(self, part, hidden):
+			if not part in self.visible_wnd_dict:
+				return
+
+			btn = self.slot_btn_dict[part]
+			if hidden:
+				btn.SetUpVisual("d:/ymir work/ui/game/costume/eye_closed_01.tga")
+				btn.SetOverVisual("d:/ymir work/ui/game/costume/eye_closed_02.tga")
+				btn.SetDownVisual("d:/ymir work/ui/game/costume/eye_closed_01.tga")
+				btn.SetToolTipText(localeInfo.SHOW_COSTUME_TOOLTIP)
+				btn.SetEvent(ui.__mem_func__(self.__ClickVisibleButton), part, 0)
+				self.slot_image_dict[part].Show()
+			else:
+				btn.SetUpVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
+				btn.SetOverVisual("d:/ymir work/ui/game/costume/eye_normal_02.tga")
+				btn.SetDownVisual("d:/ymir work/ui/game/costume/eye_normal_01.tga")
+				btn.SetToolTipText(localeInfo.HIDE_COSTUME_TOOLTIP)
+				btn.SetEvent(ui.__mem_func__(self.__ClickVisibleButton), part, 1)
+				self.slot_image_dict[part].Hide()
+
+class BeltInventoryWindow(ui.ScriptWindow):
+	def __init__(self, wndInventory):
+		import exception
+
+		if not wndInventory:
+			exception.Abort("wndInventory parameter must be set to InventoryWindow")
+			return
+
+		ui.ScriptWindow.__init__(self)
+
+		self.isLoaded = 0
+		self.wndInventory = wndInventory;
+
+		self.wndBeltInventoryLayer = None
+		self.wndBeltInventorySlot = None
+		self.expandBtn = None
+		self.minBtn = None
+
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.parent = None
+
+		self.__LoadWindow()
+
+	def __del__(self):
+		ui.ScriptWindow.__del__(self)
+
+	def Show(self, openBeltSlot = False):
+		self.__LoadWindow()
+		self.RefreshSlot()
+
+		ui.ScriptWindow.Show(self)
+
+		if openBeltSlot:
+			self.OpenInventory()
+		else:
+			self.CloseInventory()
+
+		self.SetTop()
+
+	def Close(self):
+		self.Hide()
+
+	def IsOpeningInventory(self):
+		return self.wndBeltInventoryLayer.IsShow()
+
+	def OpenInventory(self):
+		self.wndBeltInventoryLayer.Show()
+		self.expandBtn.Hide()
+
+		self.AdjustPosition()
+
+	def CloseInventory(self):
+		self.wndBeltInventoryLayer.Hide()
+		self.expandBtn.Show()
+
+		self.AdjustPosition()
+
+	##  Îºä¸® Ä¡  BASE Ä¡ , ..  ÏµÚµÏ±    ..
+	def GetBasePosition(self):
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			x, y = self.parent.GetGlobalPosition()
+			return x - 148, y + 65
+		else:
+			x, y = self.wndInventory.GetGlobalPosition()
+			return x - 148, y + 241
+
+	def AdjustPosition(self):
+		bx, by = self.GetBasePosition()
+
+		if self.IsOpeningInventory():
+			self.SetPosition(bx, by)
+
+			if localeInfo.IsARABIC():
+				self.SetPosition(bx, by)
+				self.wndBeltInventoryLayer.SetPosition(self.ORIGINAL_WIDTH - 5, 0)
+			else:
+				self.SetPosition(bx, by)
+				self.SetSize(self.ORIGINAL_WIDTH, self.GetHeight())
+		else:
+			if localeInfo.IsARABIC():
+				self.SetPosition(bx + 140 , by)
+				self.wndBeltInventoryLayer.SetPosition(self.ORIGINAL_WIDTH - 10, 0)
+				self.expandBtn.SetPosition(self.ORIGINAL_WIDTH + 1 , 15)
+			else:
+				self.SetPosition(bx + 138, by);
+				self.SetSize(10, self.GetHeight())
+
+	def __LoadWindow(self):
+		if self.isLoaded == 1:
+			return
+
+		self.isLoaded = 1
+
+		try:
+			pyScrLoader = ui.PythonScriptLoader()
+			pyScrLoader.LoadScriptFile(self, "UIScript/BeltInventoryWindow.py")
+		except:
+			import exception
+			exception.Abort("BeltInventoryWindow.LoadWindow.LoadObject")
+
+		try:
+			self.ORIGINAL_WIDTH = self.GetWidth()
+			wndBeltInventorySlot = self.GetChild("BeltInventorySlot")
+			self.wndBeltInventoryLayer = self.GetChild("BeltInventoryLayer")
+			self.expandBtn = self.GetChild("ExpandBtn")
+			self.minBtn = self.GetChild("MinimizeBtn")
+
+			self.expandBtn.SetEvent(ui.__mem_func__(self.OpenInventory))
+			self.minBtn.SetEvent(ui.__mem_func__(self.CloseInventory))
+
+			if localeInfo.IsARABIC() :
+				self.minBtn.SetPosition(self.minBtn.GetWidth() + 3, 15)
+
+			for i in xrange(item.BELT_INVENTORY_SLOT_COUNT):
+				slotNumber = item.BELT_INVENTORY_SLOT_START + i
+				wndBeltInventorySlot.SetCoverButton(slotNumber,
+					"d:/ymir work/ui/game/quest/slot_button_01.sub",\
+					"d:/ymir work/ui/game/quest/slot_button_01.sub",\
+					"d:/ymir work/ui/game/quest/slot_button_01.sub",\
+					"d:/ymir work/ui/game/belt_inventory/slot_disabled.tga", False, False)
+		except:
+			import exception
+			exception.Abort("CostumeWindow.LoadWindow.BindObject")
+
+		## Equipment
+		wndBeltInventorySlot.SetOverInItemEvent(ui.__mem_func__(self.wndInventory.OverInItem), player.BELT_INVENTORY)
+		wndBeltInventorySlot.SetOverOutItemEvent(ui.__mem_func__(self.wndInventory.OverOutItem))
+		wndBeltInventorySlot.SetUnselectItemSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.BELT_INVENTORY)
+		wndBeltInventorySlot.SetUseSlotEvent(ui.__mem_func__(self.wndInventory.UseItemSlot), player.BELT_INVENTORY)
+		wndBeltInventorySlot.SetSelectEmptySlotEvent(ui.__mem_func__(self.wndInventory.SelectEmptySlot), player.BELT_INVENTORY)
+		wndBeltInventorySlot.SetSelectItemSlotEvent(ui.__mem_func__(self.wndInventory.SelectItemSlot), player.BELT_INVENTORY)
+
+		## MT-436 slot bug fix
+		wndBeltInventorySlot.SetSlotType(player.SLOT_TYPE_BELT_INVENTORY)
+		self.wndBeltInventorySlot = wndBeltInventorySlot
+
+	def RefreshSlot(self):
+		getItemVNum = ReprGetItemIndex(player.BELT_INVENTORY)
+		getItemCount = ReprGetItemCount(player.BELT_INVENTORY)
+
+		for i in xrange(item.BELT_INVENTORY_SLOT_COUNT):
+			slotNumber = item.BELT_INVENTORY_SLOT_START + i
+			self.wndBeltInventorySlot.SetItemSlot(slotNumber, getItemVNum(slotNumber), getItemCount(slotNumber))
+			self.wndBeltInventorySlot.SetAlwaysRenderCoverButton(slotNumber, True)
+
+			if player.IsAvailableBeltInventoryCell(slotNumber):
+				self.wndBeltInventorySlot.EnableCoverButton(slotNumber)
+			else:
+				self.wndBeltInventorySlot.DisableCoverButton(slotNumber)
+
+		self.wndBeltInventorySlot.RefreshSlot()
+
+	def OnTop(self):
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			pass
+		else:
+			if self.wndInventory:
+				self.wndInventory.SetClickBeltInventory(True)
+				self.wndInventory.SetTop()
+
+	if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+		def SetMoveParentWindow(self, move_window):
+			from _weakref import proxy
+			self.parent = proxy(move_window)
+			self.AdjustPosition()
+
+class InventoryWindow(ui.ScriptWindow):
+	USE_TYPE_TUPLE = (
+		"USE_CLEAN_SOCKET",
+		"USE_CHANGE_ATTRIBUTE",
+		"USE_ADD_ATTRIBUTE",
+		"USE_ADD_ATTRIBUTE2",
+		"USE_ADD_ACCESSORY_SOCKET",
+		"USE_PUT_INTO_ACCESSORY_SOCKET",
+		"USE_PUT_INTO_BELT_SOCKET",
+		"USE_PUT_INTO_RING_SOCKET"
+	)
+
+	if app.ENABLE_MOVE_COSTUME_ATTR:
+		USE_TYPE_TUPLE += ("USE_CHANGE_COSTUME_ATTR", "USE_RESET_COSTUME_ATTR",)
+
+	if app.ENABLE_CHANGED_ATTR:
+		USE_TYPE_TUPLE += ("USE_SELECT_ATTRIBUTE",)
+
+	if app.ENABLE_ATTR_6TH_7TH:
+		USE_TYPE_TUPLE += ("USE_CHANGE_ATTRIBUTE2",)
+
+	if app.ENABLE_REFINE_ELEMENT_SYSTEM:
+		USE_TYPE_TUPLE += ("USE_ELEMENT_UPGRADE", "USE_ELEMENT_DOWNGRADE", "USE_ELEMENT_CHANGE",)
+
+	questionDialog = None
+	tooltipItem = None
+
+	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+		wndCostume = None
+		wndBelt = None
+
+	dlgPickMoney = None
+	if app.ENABLE_CHEQUE_SYSTEM:
+		dlgPickETC = None
+
+	if app.WJ_ENABLE_TRADABLE_ICON:
+		bindWnds = []
+
+	sellingSlotNumber = -1
+	sellingSlotWindow = player.INVENTORY
+
+	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+		isOpenedCostumeWindowWhenClosingInventory = 0 # Îºä¸®   Ú½ Ö¾ -_-; Ì¹ 
+		isOpenedBeltWindowWhenClosingInventory = 0 # Îºä¸®   Æ® Îºä¸® Ö¾ -_-; Ì¹ 
+
+	if app.ENABLE_GROWTH_PET_SYSTEM:
+		petHatchingWindow	= None
+		petFeedWindow		= None
+		petNameChangeWindow = None
+
+	isLoaded = 0
+	interface = None
+	pop = None
+
+	def __init__(self):
+		if app.ENABLE_GEM_SYSTEM:
+			self.wndExpandedMoneyBar = None
+			self.wndGem = None
+
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.wndEquipment = None
+
+		ui.ScriptWindow.__init__(self)
+
+		self.isOpenedBeltWindowWhenClosingInventory = 0 # Îºä¸®   Æ® Îºä¸® Ö¾ -_-; Ì¹ 
+
+		self.__LoadWindow()
+
+		self.IsClickBeltInventory = False
+
+	def __del__(self):
+		ui.ScriptWindow.__del__(self)
+		if app.ENABLE_GEM_SYSTEM:
+			self.wndExpandedMoneyBar = None
+			self.wndGem = None
+
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.wndEquipment = None
+
+	def SetClickBeltInventory(self, isclick):
+		self.IsClickBeltInventory = isclick
+
+	def Show(self):
+		self.__LoadWindow()
+
+		ui.ScriptWindow.Show(self)
+
+		self.RefreshItemSlot()
+		self.RefreshStatus()
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			# Îºä¸®   Ú½ Ö¾Ù¸ Îºä¸®   Ú½   .
+			if self.isOpenedCostumeWindowWhenClosingInventory and self.wndCostume:
+				self.wndCostume.Show()
+
+			# Îºä¸®   Æ® Îºä¸® Ö¾Ù¸   .
+			if self.wndBelt:
+				self.wndBelt.Show(self.isOpenedBeltWindowWhenClosingInventory)
+
+		if app.ENABLE_GEM_SYSTEM:
+			if self.wndExpandedMoneyBar:
+				self.wndExpandedMoneyBar.Show()
+
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			if self.wndEquipment:
+				self.wndEquipment.Show()
+
+	def BindInterfaceClass(self, interface):
+		from _weakref import proxy
+		self.interface = proxy(interface)
+
+	if app.WJ_ENABLE_TRADABLE_ICON:
+		def BindWindow(self, wnd):
+			self.bindWnds.append(wnd)
+
+	def __LoadWindow(self):
+		if self.isLoaded == 1:
+			return
+
+		self.isLoaded = 1
+
+		try:
+			pyScrLoader = ui.PythonScriptLoader()
+			pyScrLoader.LoadScriptFile(self, uiScriptLocale.LOCALE_COMMON_UISCRIPT_PATH + "InventoryWindow.py")
+		except:
+			import exception
+			exception.Abort("InventoryWindow.LoadWindow.LoadObject")
+
+		try:
+			wndItem = self.GetChild("ItemSlot")
+			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+				wndEquip = self.GetChild("EquipmentSlot")
+			self.GetChild("TitleBar").SetCloseEvent(ui.__mem_func__(self.Close))
+			self.wndMoney = self.GetChild("Money")
+			self.wndMoneySlot = self.GetChild("Money_Slot")
+			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+				self.mallButton = self.GetChild2("MallButton")
+				self.DSSButton = self.GetChild2("DSSButton")
+				self.costumeButton = self.GetChild2("CostumeButton")
+
+			if app.ENABLE_CHEQUE_SYSTEM:
+				self.wndCheque = self.GetChild("Cheque")
+				self.wndChequeSlot = self.GetChild("Cheque_Slot")
+
+				if app.ENABLE_GEM_SYSTEM:
+					self.wndMoneyIcon = self.GetChild("Money_Icon")
+					self.wndChequeIcon = self.GetChild("Cheque_Icon")
+					self.wndMoneyIcon.Hide()
+					self.wndMoneySlot.Hide()
+					self.wndChequeIcon.Hide()
+					self.wndChequeSlot.Hide()
+
+					##  
+					height = self.GetHeight()
+					width = self.GetWidth()
+					self.SetSize(width, height - 22)
+					self.GetChild("board").SetSize(width, height - 22)
+
+				else:
+					self.wndMoneyIcon = self.GetChild("Money_Icon")
+					self.wndChequeIcon = self.GetChild("Cheque_Icon")
+
+					self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 0)
+					self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 1)
+
+					self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 0)
+					self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 1)
+
+					self.toolTip = uiToolTip.ToolTip()
+					self.toolTip.ClearToolTip()
+
+			self.inventoryTab = []
+			self.inventoryTab.append(self.GetChild("Inventory_Tab_01"))
+			self.inventoryTab.append(self.GetChild("Inventory_Tab_02"))
+			self.inventoryTab.append(self.GetChild("Inventory_Tab_03"))
+			self.inventoryTab.append(self.GetChild("Inventory_Tab_04"))
+
+			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+				self.equipmentTab = []
+				self.equipmentTab.append(self.GetChild("Equipment_Tab_01"))
+				self.equipmentTab.append(self.GetChild("Equipment_Tab_02"))
+
+				# Belt Inventory Window
+				self.wndBelt = None
+
+			self.dlgQuestion = uiCommon.QuestionDialog2()
+			self.dlgQuestion.Close()
+
+			if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+				self.wndBelt = BeltInventoryWindow(self)
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				self.listHighlightedAcceSlot = []
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				self.listHighlightedChangeLookSlot = []
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				self.listHighlightedAuraSlot = []
+
+			if app.ENABLE_CUBE_RENEWAL:
+				self.listHighlightedCubeSlot = []
+
+			if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+				self.listHighlightedSlot = []
+
+			if app.ENABLE_EXTEND_INVEN_SYSTEM:
+				self.ExInvenQuestionDlg = uiCommon.QuestionDialog()
+				self.ExInvenQuestionDlg.Close()
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				self.clear_aura_item_question_dialog = None
+
+			if app.ENABLE_GEM_CONVERTER:
+				self.gem_converter_question_dialog = None
+				self.gem_converter_item_pos = (-1, -1)
+
+			if app.ENABLE_GROWTH_PET_SYSTEM:
+				self.PetItemQuestionDlg = uiCommon.QuestionDialog()
+				self.PetItemQuestionDlg.Close()
+
+				self.PetSkillDelDlg = uiCommon.QuestionDialog2()
+				self.PetSkillDelDlg.Close()
+				self.PetSkillAllDelBookIndex = -1
+		except:
+			import exception
+			exception.Abort("InventoryWindow.LoadWindow.BindObject")
+
+		## Item
+		wndItem.SetSelectEmptySlotEvent(ui.__mem_func__(self.SelectEmptySlot), player.INVENTORY)
+		wndItem.SetSelectItemSlotEvent(ui.__mem_func__(self.SelectItemSlot), player.INVENTORY)
+		wndItem.SetUnselectItemSlotEvent(ui.__mem_func__(self.UseItemSlot), player.INVENTORY)
+		wndItem.SetUseSlotEvent(ui.__mem_func__(self.UseItemSlot), player.INVENTORY)
+		wndItem.SetOverInItemEvent(ui.__mem_func__(self.OverInItem), player.INVENTORY)
+		wndItem.SetOverOutItemEvent(ui.__mem_func__(self.OverOutItem))
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			## Equipment
+			wndEquip.SetSelectEmptySlotEvent(ui.__mem_func__(self.SelectEmptySlot), player.EQUIPMENT)
+			wndEquip.SetSelectItemSlotEvent(ui.__mem_func__(self.SelectItemSlot), player.EQUIPMENT)
+			wndEquip.SetUnselectItemSlotEvent(ui.__mem_func__(self.UseItemSlot), player.EQUIPMENT)
+			wndEquip.SetUseSlotEvent(ui.__mem_func__(self.UseItemSlot), player.EQUIPMENT)
+			wndEquip.SetOverInItemEvent(ui.__mem_func__(self.OverInItem), player.EQUIPMENT)
+			wndEquip.SetOverOutItemEvent(ui.__mem_func__(self.OverOutItem))
+
+		## PickMoneyDialog
+		dlgPickMoney = uiPickMoney.PickMoneyDialog()
+		dlgPickMoney.LoadDialog()
+		dlgPickMoney.Hide()
+
+		## PickETCDialog
+		if app.ENABLE_CHEQUE_SYSTEM:
+			dlgPickETC = uiPickETC.PickETCDialog()
+			dlgPickETC.LoadDialog()
+			dlgPickETC.Hide()
+			self.dlgPickETC = dlgPickETC
+
+		## RefineDialog
+		self.refineDialog = uiRefine.RefineDialog()
+		self.refineDialog.Hide()
+
+		## AttachMetinDialog
+		self.attachMetinDialog = uiAttachMetin.AttachMetinDialog()
+		self.attachMetinDialog.Hide()
+
+		## MoneySlot
+		if app.ENABLE_CHEQUE_SYSTEM:
+			self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 0)
+			self.wndChequeSlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 1)
+		else:
+			self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog))
+
+		# Bind all visible inventory tabs (UI has 4; some binaries expose only 2 via player.INVENTORY_PAGE_COUNT)
+		max_pages = self.__GetMaxInventoryPages()
+		for inven_index in range(min(max_pages, len(self.inventoryTab))):
+			self.inventoryTab[inven_index].SetEvent(lambda arg = inven_index : self.SetInventoryPage(arg))
+		for inven_index in range(min(max_pages, len(self.inventoryTab)), len(self.inventoryTab)):
+			# Hide unused tabs to avoid desync/ghost slot mapping
+			self.inventoryTab[inven_index].Hide()
+		self.inventoryTab[0].Down()
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.equipmentTab[0].SetEvent(lambda arg = 0: self.SetEquipmentPage(arg))
+			self.equipmentTab[1].SetEvent(lambda arg = 1: self.SetEquipmentPage(arg))
+			self.equipmentTab[0].Down()
+			self.equipmentTab[0].Hide()
+			self.equipmentTab[1].Hide()
+
+		## MT-436 slot bug fix
+		wndItem.SetSlotType(player.SLOT_TYPE_INVENTORY)
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			wndEquip.SetSlotType(player.SLOT_TYPE_EQUIPMENT)
+
+		self.wndItem = wndItem
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.wndEquip = wndEquip
+		self.dlgPickMoney = dlgPickMoney
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			# MallButton
+			if self.mallButton:
+				self.mallButton.SetEvent(ui.__mem_func__(self.ClickMallButton))
+
+			if self.DSSButton:
+				self.DSSButton.SetEvent(ui.__mem_func__(self.ClickDSSButton))
+
+			# Costume Button
+			if self.costumeButton:
+				self.costumeButton.SetEvent(ui.__mem_func__(self.ClickCostumeButton))
+
+			self.wndCostume = None
+
+		if app.ENABLE_EXTEND_INVEN_SYSTEM:
+			## Extend Inven Button
+			self.__CreateExtendInvenButton()
+
+		## Refresh
+		self.SetInventoryPage(0)
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.SetEquipmentPage(0)
+		self.RefreshItemSlot()
+		self.RefreshStatus()
+
+	def Destroy(self):
+		self.ClearDictionary()
+
+		self.dlgPickMoney.Destroy()
+		self.dlgPickMoney = 0
+
+		if app.ENABLE_CHEQUE_SYSTEM:
+			self.dlgPickETC.Destroy()
+			self.dlgPickETC = 0
+
+		self.refineDialog.Destroy()
+		self.refineDialog = 0
+
+		self.attachMetinDialog.Destroy()
+		self.attachMetinDialog = 0
+
+		self.tooltipItem = None
+		self.wndItem = 0
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.wndEquip = 0
+		self.dlgPickMoney = 0
+		self.wndMoney = 0
+		self.wndMoneySlot = 0
+		self.questionDialog = None
+		self.mallButton = None
+		self.DSSButton = None
+		self.interface = None
+		if app.WJ_ENABLE_TRADABLE_ICON:
+			self.bindWnds = []
+
+		if app.ENABLE_CHEQUE_SYSTEM:
+			self.wndCheque = 0
+			self.wndChequeSlot = 0
+			self.dlgPickETC = 0
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			if self.wndCostume:
+				self.wndCostume.Destroy()
+				self.wndCostume = 0
+
+			if self.wndBelt:
+				self.wndBelt.Destroy()
+				self.wndBelt = None
+
+		self.inventoryTab = []
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.equipmentTab = []
+
+		if app.ENABLE_EXTEND_INVEN_SYSTEM:
+			self.ExInvenButton = []
+
+			if self.ExInvenQuestionDlg:
+				self.ExInvenQuestionDlg.Close()
+
+		if app.ENABLE_AURA_COSTUME_SYSTEM:
+			if self.clear_aura_item_question_dialog:
+				self.clear_aura_item_question_dialog.Close()
+			self.clear_aura_item_question_dialog = None
+
+		if app.ENABLE_GEM_CONVERTER:
+			if self.gem_converter_question_dialog:
+				self.gem_converter_question_dialog.Close()
+			self.gem_converter_question_dialog = None
+
+		if self.pop:
+			self.pop.Destroy()
+			self.pop = None
+
+		if app.ENABLE_GEM_SYSTEM:
+			self.wndExpandedMoneyBar = None
+
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			if self.petHatchingWindow:
+				self.petHatchingWindow = None
+
+			if self.petFeedWindow:
+				self.petFeedWindow = None
+
+			if self.petNameChangeWindow:
+				self.petNameChangeWindow = None
+
+	def Hide(self):
+		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS():
+			self.OnCloseQuestionDialog()
+			return
+
+		if None != self.tooltipItem:
+			self.tooltipItem.HideToolTip()
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			if self.wndCostume:
+				self.isOpenedCostumeWindowWhenClosingInventory = self.wndCostume.IsShow() # Îºä¸® Ã¢   Ú½  Ö¾Â°?
+				self.wndCostume.Close()
+
+			if self.wndBelt:
+				self.isOpenedBeltWindowWhenClosingInventory = self.wndBelt.IsOpeningInventory() # Îºä¸® Ã¢   Æ® Îºä¸®  Ö¾Â°?
+				#print "Is Opening Belt Inven?? ", self.isOpenedBeltWindowWhenClosingInventory
+				self.wndBelt.Close()
+
+		if self.dlgPickMoney:
+			self.dlgPickMoney.Close()
+
+		if app.ENABLE_CHEQUE_SYSTEM:
+			if self.dlgPickETC:
+				self.dlgPickETC.Close()
+
+		if app.ENABLE_GEM_SYSTEM:
+			if self.wndExpandedMoneyBar:
+				self.wndExpandedMoneyBar.Close()
+
+		wndMgr.Hide(self.hWnd)
+
+	def Close(self):
+		self.Hide()
+
+	if app.ENABLE_GEM_SYSTEM:
+		def SetExpandedMoneyBar(self, wndBar):
+			self.wndExpandedMoneyBar = wndBar
+
+			if self.wndExpandedMoneyBar:
+				self.wndMoneySlot = self.wndExpandedMoneyBar.GetMoneySlot()
+				self.wndMoney = self.wndExpandedMoneyBar.GetMoney()
+
+				if app.ENABLE_CHEQUE_SYSTEM:
+					##  
+					self.wndMoneyIcon = self.wndExpandedMoneyBar.GetMoneyIcon()
+					if self.wndMoneyIcon:
+						self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 0)
+						self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 0)
+					if self.wndMoneySlot:
+						self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 0)
+
+					## 2È­ 
+					self.wndChequeIcon = self.wndExpandedMoneyBar.GetChequeIcon()
+					if self.wndChequeIcon:
+						self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 1)
+						self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 1)
+					self.wndChequeSlot = self.wndExpandedMoneyBar.GetChequeSlot()
+					if self.wndChequeSlot:
+						self.wndChequeSlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 1)
+					self.wndCheque = self.wndExpandedMoneyBar.GetCheque()
+
+					##  
+					self.wndGemIcon = self.wndExpandedMoneyBar.GetGemIcon()
+					if self.wndGemIcon:
+						self.wndGemIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 2)
+						self.wndGemIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_out", 2)
+					self.wndGem = self.wndExpandedMoneyBar.GetGem()
+
+					self.toolTip = uiToolTip.ToolTip()
+					self.toolTip.ClearToolTip()
+				else:
+					if self.wndMoneySlot:
+						self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog))
+
+	def __GetMaxInventoryPages(self):
+		"""Best-effort max page count to keep UI tabs and slot mapping consistent.
+		Some clients expose only 2 pages via player.INVENTORY_PAGE_COUNT while the UI/script has 4.
+		"""
+		# Primary: derive from total slots / page size (stable even if INVENTORY_PAGE_COUNT is wrong)
+		try:
+			page_size = int(player.INVENTORY_PAGE_SIZE)
+			total_slots = int(player.INVENTORY_SLOT_COUNT)
+			calc = int(total_slots / page_size) if page_size > 0 else 0
+		except:
+			calc = 0
+
+		# Secondary: keep at least the engine-reported page count
+		try:
+			calc = max(calc, int(player.INVENTORY_PAGE_COUNT))
+		except:
+			pass
+
+		# UI cap
+		try:
+			calc = min(calc, len(self.inventoryTab))
+		except:
+			pass
+
+		return max(1, calc)
+
+	def SetInventoryPage(self, page):
+		max_pages = self.__GetMaxInventoryPages()
+		try:
+			page = int(page)
+		except:
+			page = 0
+		if page < 0:
+			page = 0
+		elif page >= max_pages:
+			page = max_pages - 1
+
+		self.inventoryPageIndex = page
+
+		for index in range(len(self.inventoryTab)):
+			if index == page:
+				self.inventoryTab[index].Down()
+			else:
+				self.inventoryTab[index].SetUp()
+
+		self.RefreshBagSlotWindow()
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		## Extend Inven Button
+		def __CreateExtendInvenButton(self):
+			parent = self.GetChild("board")
+
+			self.ExInvenButton = []
+			start_x = 8
+			start_y = 246
+			if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+				start_y = 55
+			img_height = 32
+
+			for button_index in range(player.EX_INVENTORY_STAGE_MAX): ## 18
+				ex_inven_button = ui.Button()
+
+				increase_y = img_height * (button_index % (player.EX_INVENTORY_STAGE_MAX / player.EX_INVENTORY_PAGE_COUNT))
+
+				ex_inven_button.SetParent(parent)
+				ex_inven_button.SetPosition(start_x, start_y + increase_y)
+				ex_inven_button.SetUpVisual(EX_INVEN_COVER_IMG_CLOSE)
+				ex_inven_button.SetOverVisual(EX_INVEN_COVER_IMG_CLOSE)
+				ex_inven_button.SetDownVisual(EX_INVEN_COVER_IMG_CLOSE)
+				ex_inven_button.SetDisableVisual(EX_INVEN_COVER_IMG_CLOSE)
+				ex_inven_button.SetEvent(ui.__mem_func__(self.__ClickExtendInvenButton), button_index + 1)
+				ex_inven_button.Hide()
+				self.ExInvenButton.append(ex_inven_button)
+
+		def __ClickExtendInvenButton(self, index):
+			net.SendExtendInvenButtonClick(index)
+
+		def __HideAllExtendInvenButton(self):
+			for index in range(len(self.ExInvenButton)):
+				self.ExInvenButton[index].Hide()
+
+		def __ShowExtendInvenButton(self, cur_stage):
+			## self.inventoryPageIndex  0,1,2,3  EX_INVENTORY_PAGE_START -1  Ñ´.
+			if self.inventoryPageIndex < player.EX_INVENTORY_PAGE_START - 1:
+				return
+
+			##     Ü°
+			count = player.EX_INVENTORY_STAGE_MAX / player.EX_INVENTORY_PAGE_COUNT
+
+			## Ö¼, Ö´
+			min_range = (self.inventoryPageIndex - player.EX_INVENTORY_PAGE_START + 1) * count
+			max_range = min_range + count
+
+			for button_index in range(min_range, max_range):
+				if button_index == cur_stage:
+					self.ExInvenButton[button_index].SetUpVisual(EX_INVEN_COVER_IMG_OPEN)
+					self.ExInvenButton[button_index].SetOverVisual(EX_INVEN_COVER_IMG_OPEN)
+					self.ExInvenButton[button_index].SetDownVisual(EX_INVEN_COVER_IMG_OPEN)
+					self.ExInvenButton[button_index].SetDisableVisual(EX_INVEN_COVER_IMG_OPEN)
+
+				if button_index < cur_stage:
+					self.ExInvenButton[button_index].Hide()
+				else:
+					self.ExInvenButton[button_index].Show()
+
+		def ExInvenItemUseMsg(self, item_vnum, msg, enough_count):
+			##  
+			if player.EX_INVEN_FAIL_FALL_SHORT == msg:
+				self.__OpenExInvenFallShortCountMsgDlg(enough_count)
+
+			##  
+			elif player.EX_INVEN_SUCCESS == msg:
+				self.__OpenExInvenQuestionDlg(enough_count)
+
+			## 4 
+			elif player.EX_INVEN_FAIL_FOURTH_PAGE_STAGE_MAX == msg:
+				self.__OpenExInvenMsgDlg(localeInfo.EXINVEN_USE_ITEM_FAIL_FOURTH_PAGE_STAGE_MAX)
+				return
+
+			else:
+				return
+
+		def __OpenExInvenMsgDlg(self, msg):
+			popup = uiCommon.PopupDialog()
+			popup.SetText(msg)
+			popup.SetAcceptEvent(self.__OnClosePopupDialog)
+			w, h = popup.GetTextSize()
+			popup.SetWidth(w + 40)
+			line_count = popup.GetTextLineCount()
+
+			if line_count > 1:
+				height = popup.GetLineHeight()
+				popup.SetLineHeight(height + 3)
+
+			popup.Open()
+
+			if self.pop:
+				self.pop.Destroy()
+
+			self.pop = popup
+
+		def __OpenExInvenFallShortCountMsgDlg(self, enough_count):
+			popup = uiCommon.PopupDialog()
+			popup.SetText(localeInfo.EXINVEN_USE_ITEM_FAIL_FALL_SHORT % (enough_count))
+			popup.SetAcceptEvent(self.__OnClosePopupDialog)
+			popup.Open()
+
+			if self.pop:
+				self.pop.Destroy()
+
+			self.pop = popup
+
+		def __OpenExInvenQuestionDlg(self, enough_count):
+			if self.ExInvenQuestionDlg:
+				self.ExInvenQuestionDlg.SetText(localeInfo.EXINVEN_USE_ITEM_QUESTION % enough_count)
+				self.ExInvenQuestionDlg.SetAcceptEvent(ui.__mem_func__(self.__AcceptExInvenItemUse))
+				self.ExInvenQuestionDlg.SetCancelEvent(ui.__mem_func__(self.__CancelExInvenItemUse))
+				w, h = self.ExInvenQuestionDlg.GetTextSize()
+				self.ExInvenQuestionDlg.SetWidth(w + 40)
+				self.ExInvenQuestionDlg.Open()
+
+		def __AcceptExInvenItemUse(self):
+			net.SendExtendInvenUpgrade()
+			self.ExInvenQuestionDlg.Close()
+
+		def __CancelExInvenItemUse(self):
+			self.ExInvenQuestionDlg.Close()
+
+	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+		def SetEquipmentPage(self, page):
+			self.equipmentPageIndex = page
+			self.equipmentTab[1 - page].SetUp()
+			self.RefreshEquipSlotWindow()
+
+		def ClickMallButton(self):
+			net.SendCommandPacket("/click_mall")
+
+		# DSSButton
+		def ClickDSSButton(self):
+			self.interface.ToggleDragonSoulWindow()
+
+		def ClickCostumeButton(self):
+			if self.wndCostume:
+				if self.wndCostume.IsShow():
+					self.wndCostume.Hide()
+				else:
+					self.wndCostume.Show()
+			else:
+				self.wndCostume = CostumeWindow(self)
+				self.wndCostume.Show()
+
+		def ShowCostumeInventory(self):
+			if self.wndCostume:
+				if not self.wndCostume.IsShow():
+					self.wndCostume.Show()
+			else:
+				self.wndCostume = CostumeWindow(self)
+				self.wndCostume.Show()
+
+	def OpenPickMoneyDialog(self, focus_idx = 0):
+		if mouseModule.mouseController.isAttached():
+			attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
+			if player.SLOT_TYPE_SAFEBOX == mouseModule.mouseController.GetAttachedType():
+				if player.ITEM_MONEY == mouseModule.mouseController.GetAttachedItemIndex():
+					net.SendSafeboxWithdrawMoneyPacket(mouseModule.mouseController.GetAttachedItemCount())
+					snd.PlaySound("sound/ui/money.wav")
+
+			mouseModule.mouseController.DeattachObject()
+		else:
+			curMoney = player.GetElk()
+			curCheque = player.GetCheque()
+
+			if curMoney <= 0 and curCheque <= 0:
+				return
+
+			self.dlgPickMoney.SetTitleName(localeInfo.PICK_MONEY_TITLE)
+			self.dlgPickMoney.SetAcceptEvent(ui.__mem_func__(self.OnPickMoney))
+			self.dlgPickMoney.Open(curMoney, curCheque)
+			self.dlgPickMoney.SetMax(7) # Îºä¸® 990000   
+			if app.ENABLE_CHEQUE_SYSTEM:
+				self.dlgPickMoney.SetFocus(focus_idx)
+
+	if app.ENABLE_CHEQUE_SYSTEM:
+		def OnPickMoney(self, money, cheque):
+			mouseModule.mouseController.AttachMoney(self, player.SLOT_TYPE_INVENTORY, money, cheque)
+	else:
+		def OnPickMoney(self, money):
+			mouseModule.mouseController.AttachMoney(self, player.SLOT_TYPE_INVENTORY, money)
+
+	def OnPickItem(self, count):
+		if app.ENABLE_CHEQUE_SYSTEM:
+			itemSlotWindow = self.dlgPickETC.itemGlobalSlotWindow
+			itemSlotIndex = self.dlgPickETC.itemGlobalSlotIndex
+		else:
+			itemSlotWindow = self.dlgPickMoney.itemGlobalSlotWindow
+			itemSlotIndex = self.dlgPickMoney.itemGlobalSlotIndex
+
+		selectedItemVNum = player.GetItemIndex(itemSlotWindow, itemSlotIndex)
+		slotType = player.WindowTypeToSlotType(itemSlotWindow)
+		mouseModule.mouseController.AttachObject(self, slotType, itemSlotIndex, selectedItemVNum, count)
+
+	def __InventoryLocalSlotPosToGlobalSlotPos(self, local, window_type = player.INVENTORY):
+		if player.INVENTORY == window_type:
+			return self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE + local
+		else:
+			return local
+
+	def RefreshBagSlotWindow(self):
+		if not self.wndItem:
+			return
+
+		getItemVNum = player.GetItemIndex
+		getItemCount = player.GetItemCount
+		setItemVNum = self.wndItem.SetItemSlot
+
+		##  Ï± Ì¶Æ®  .
+		for i in xrange(self.wndItem.GetSlotCount()):
+			self.wndItem.DeactivateSlot(i)
+
+		if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_MAILBOX:
+			if self.interface:
+				onTopWindow = self.interface.GetOnTopWindow()
+
+		for i in xrange(player.INVENTORY_PAGE_SIZE):
+			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
+
+			itemCount = getItemCount(slotNumber)
+			# itemCount == 0Ì¸  .
+			if 0 == itemCount:
+				self.wndItem.ClearSlot(i)
+				continue
+			elif 1 == itemCount:
+				itemCount = 0
+
+			itemVnum = getItemVNum(slotNumber)
+			setItemVNum(i, itemVnum, itemCount)
+
+			## Úµ (HP: #72723 ~ #72726, SP: #72727 ~ #72730) Æ¯Ã³ - Îµ Ô¿ È°È­/È°È­ Ç¥Ã¸  Û¾ - [hyo]
+			if constInfo.IS_AUTO_POTION(itemVnum):
+				# metinSocket - [0] : È°È­ , [1] :  , [2] : Ö´ ë·®
+				metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]
+				tempSlotNum = slotNumber
+				if tempSlotNum >= player.INVENTORY_PAGE_SIZE:
+					tempSlotNum -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
+
+				isActivated = 0 != metinSocket[0]
+
+				if isActivated:
+					self.wndItem.ActivateSlot(tempSlotNum)
+
+					potionType = 0
+					if constInfo.IS_AUTO_POTION_HP(itemVnum):
+						potionType = player.AUTO_POTION_TYPE_HP
+					elif constInfo.IS_AUTO_POTION_SP(itemVnum):
+						potionType = player.AUTO_POTION_TYPE_SP
+
+					player.SetAutoPotionInfo(potionType, player.INVENTORY, slotNumber)
+				else:
+					self.wndItem.DeactivateSlot(tempSlotNum)
+
+			if app.ENABLE_GROWTH_PET_SYSTEM:
+				if constInfo.IS_PET_ITEM(itemVnum):
+					self.__ActivePetHighlightSlot(slotNumber)
+					self.__SetCoolTimePetItemSlot(slotNumber, itemVnum)
+
+			if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_MAILBOX:
+				if itemVnum and self.interface and onTopWindow:
+					if self.interface.MarkUnusableInvenSlotOnTopWnd(onTopWindow, slotNumber):
+						self.wndItem.SetUnusableSlotOnTopWnd(i)
+					else:
+						self.wndItem.SetUsableSlotOnTopWnd(i)
+				else:
+					self.wndItem.SetUsableSlotOnTopWnd(i)
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if not player.GetChangeLookVnum(player.INVENTORY, slotNumber) == 0:
+					self.wndItem.SetSlotCoverImage(i, "icon/item/ingame_convert_Mark.tga")
+				else:
+					self.wndItem.EnableSlotCoverImage(i, False)
+
+			if app.ENABLE_GEM_CONVERTER:
+				if slotNumber in self.gem_converter_item_pos:
+					self.wndItem.SetCantMouseEventSlot(i)
+
+			if app.ENABLE_SOUL_SYSTEM:
+				if item.IsSoulItem(itemVnum):
+					metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]
+					tempSlotNum = slotNumber
+					if tempSlotNum >= player.INVENTORY_PAGE_SIZE:
+						tempSlotNum -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
+
+					if 0 != metinSocket[1]:
+						self.wndItem.ActivateSlot(tempSlotNum)
+					else:
+						self.wndItem.DeactivateSlot(tempSlotNum)
+
+			## [MT-662] Ï¹ È¯Ç¥ Å©
+			if (item.ITEM_TYPE_QUEST == item.GetItemType() and item.QUEST_PET_PAY == item.GetItemSubType()) or\
+				(item.ITEM_TYPE_PET == item.GetItemType() and item.PET_PAY == item.GetItemSubType()):
+				metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]
+				tempSlotNum = slotNumber
+				if tempSlotNum >= player.INVENTORY_PAGE_SIZE:
+					tempSlotNum -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
+				if 0 != metinSocket[1]:
+					self.wndItem.ActivateSlot(tempSlotNum)
+				else:
+					self.wndItem.DeactivateSlot(tempSlotNum)
+
+		self.__HighlightSlot_Refresh()
+
+		if app.ENABLE_EXTEND_INVEN_SYSTEM:
+			self.__RefreshExinvenCoverSlot()
+			self.__RefreshExinvenSlotState()
+
+		self.wndItem.RefreshSlot()
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			if self.wndBelt:
+				self.wndBelt.RefreshSlot()
+
+		if app.WJ_ENABLE_TRADABLE_ICON:
+			map(lambda wnd:wnd.RefreshLockedSlot(), self.bindWnds)
+
+	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+		def RefreshEquipSlotWindow(self):
+			getItemVNum = ReprGetItemIndex(player.EQUIPMENT)
+			getItemCount = ReprGetItemCount(player.EQUIPMENT)
+			setItemVNum = self.wndEquip.SetItemSlot
+
+			for i in xrange(player.WEAR_MAX): ## 32 ( 0 ~ 31 )
+				itemCount = getItemCount(i)
+				if itemCount <= 1:
+					itemCount = 0
+				setItemVNum(i, getItemVNum(i), itemCount)
+
+				if app.ENABLE_CHANGE_LOOK_SYSTEM:
+					if not player.GetChangeLookVnum(player.EQUIPMENT, i) == 0:
+						self.wndEquip.SetSlotCoverImage(i, "icon/item/ingame_convert_Mark.tga")
+					else:
+						self.wndEquip.EnableSlotCoverImage(i,False)
+
+			self.wndEquip.RefreshSlot()
+
+			if self.wndCostume:
+				self.wndCostume.RefreshCostumeSlot()
+
+	def RefreshItemSlot(self):
+		self.RefreshBagSlotWindow()
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			self.RefreshEquipSlotWindow()
+
+	if app.ENABLE_EXTEND_INVEN_SYSTEM:
+		def __RefreshExinvenCoverSlot(self):
+			cur_stage = player.GetExtendInvenStage()
+
+			self.__HideAllExtendInvenButton()
+			self.__ShowExtendInvenButton(cur_stage)
+
+		def __RefreshExinvenSlotState(self):
+			inventory_max = player.GetExtendInvenMax()
+
+			for i in xrange(player.INVENTORY_PAGE_SIZE):
+				slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
+
+				if slotNumber >= inventory_max:
+					self.wndItem.LockSlot(i)
+				else:
+					self.wndItem.UnlockSlot(i)
+
+	def RefreshStatus(self):
+		money = player.GetElk()
+		self.wndMoney.SetText(localeInfo.NumberToMoneyString(money))
+
+		if app.ENABLE_CHEQUE_SYSTEM:
+			cheque = player.GetCheque()
+			self.wndCheque.SetText(str(cheque))
+
+		if app.ENABLE_GEM_SYSTEM:
+			if self.wndGem:
+				gem = player.GetGem()
+				self.wndGem.SetText(localeInfo.NumberToMoneyString(gem))
+
+	def SetItemToolTip(self, tooltipItemvalue):
+		from _weakref import proxy
+		self.tooltipItem = proxy(tooltipItemvalue)
+
+	def SellItem(self):
+		if self.sellingSlotitemIndex == player.GetItemIndex(self.sellingSlotWindow, self.sellingSlotNumber):
+			if self.sellingSlotitemCount == player.GetItemCount(self.sellingSlotWindow, self.sellingSlotNumber):
+				## È¥ È¸ Ï´  ß°Ï¸é¼­  type ß°
+				net.SendShopSellPacketNew(self.sellingSlotNumber, self.questionDialog.count, self.sellingSlotWindow)
+				snd.PlaySound("sound/ui/money.wav")
+		self.OnCloseQuestionDialog()
+
+	def OnDetachMetinFromItem(self):
+		if None == self.questionDialog:
+			return
+
+		self.__SendUseItemToItemPacket(self.questionDialog.sourceWindow, self.questionDialog.sourcePos, self.questionDialog.targetWindow, self.questionDialog.targetPos)
+		self.OnCloseQuestionDialog()
+
+	def OnCloseQuestionDialog(self):
+		if not self.questionDialog:
+			return
+
+		self.questionDialog.Close()
+		self.questionDialog = None
+		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+	## Slot Event
+	def SelectEmptySlot(self, selectedSlotPos, selectedSlotWindow):
+		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS() == 1:
+			return
+
+		## Ç¼ Ã¢ 
+		##  Ìµ .
+		if app.ENABLE_ACCE_COSTUME_SYSTEM:
+			if player.GetAcceRefineWindowOpen():
+				return
+
+		if app.ENABLE_CHANGE_LOOK_SYSTEM:
+			if player.GetChangeLookWindowOpen():
+				return
+
+		if app.ENABLE_AURA_COSTUME_SYSTEM:
+			if player.IsAuraWindowOpen():
+				return
+
+		if app.ENABLE_ATTR_6TH_7TH:
+			if self.interface.wndAttr67Add.IsShow():
+				return
+
+		selectedSlotPos = self.__InventoryLocalSlotPosToGlobalSlotPos(selectedSlotPos, selectedSlotWindow)
+
+		if mouseModule.mouseController.isAttached():
+			attachedSlotType = mouseModule.mouseController.GetAttachedType()
+			attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
+			attachedItemCount = mouseModule.mouseController.GetAttachedItemCount()
+			attachedItemIndex = mouseModule.mouseController.GetAttachedItemIndex()
+
+			if player.SLOT_TYPE_INVENTORY == attachedSlotType:
+				if attachedSlotPos >= player.ITEM_SLOT_COUNT:
+					mouseModule.mouseController.DeattachObject()
+					return
+
+				self.__SendMoveItemPacket(player.INVENTORY, attachedSlotPos, selectedSlotWindow, selectedSlotPos, attachedItemCount)
+
+				if item.IsRefineScroll(attachedItemIndex):
+					self.interface.SetUseItemMode(False)
+
+			elif player.SLOT_TYPE_EQUIPMENT == attachedSlotType:
+				if attachedSlotPos >= player.WEAR_MAX:
+					mouseModule.mouseController.DeattachObject()
+					return
+
+				self.__SendMoveItemPacket(player.EQUIPMENT, attachedSlotPos, selectedSlotWindow, selectedSlotPos, attachedItemCount)
+
+			elif player.SLOT_TYPE_BELT_INVENTORY == attachedSlotType:
+				if attachedSlotPos >= item.BELT_INVENTORY_SLOT_COUNT:
+					mouseModule.mouseController.DeattachObject()
+					return
+
+				self.__SendMoveItemPacket(player.BELT_INVENTORY, attachedSlotPos, selectedSlotWindow, selectedSlotPos, attachedItemCount)
+
+			elif player.SLOT_TYPE_PRIVATE_SHOP == attachedSlotType:
+				mouseModule.mouseController.RunCallBack("INVENTORY")
+
+			elif player.SLOT_TYPE_SHOP == attachedSlotType:
+				net.SendShopBuyPacket(attachedSlotPos)
+
+			elif player.SLOT_TYPE_SAFEBOX == attachedSlotType:
+				if player.ITEM_MONEY == attachedItemIndex:
+					net.SendSafeboxWithdrawMoneyPacket(mouseModule.mouseController.GetAttachedItemCount())
+					snd.PlaySound("sound/ui/money.wav")
+				else:
+					net.SendSafeboxCheckoutPacket(attachedSlotPos, selectedSlotWindow, selectedSlotPos)
+
+			elif player.SLOT_TYPE_MALL == attachedSlotType:
+				net.SendMallCheckoutPacket(attachedSlotPos, selectedSlotWindow, selectedSlotPos)
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if player.SLOT_TYPE_ACCE == attachedSlotType:
+					#net.SendAcceRefineCheckOut(attachedSlotPos)
+					pass
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if player.SLOT_TYPE_CHANGE_LOOK == attachedSlotType:
+					#net.SendChangeLookCheckOut(attachedSlotPos)
+					pass
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if player.SLOT_TYPE_AURA == attachedSlotType:
+					#net.SendAuraRefineCheckOut(attachedSlotPos)
+					pass
+
+			mouseModule.mouseController.DeattachObject()
+
+	def SelectItemSlot(self, itemSlotIndex, window_type):
+		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS() == 1:
+			return
+
+		itemSlotIndex = self.__InventoryLocalSlotPosToGlobalSlotPos(itemSlotIndex, window_type)
+
+		if mouseModule.mouseController.isAttached():
+			attachedSlotType = mouseModule.mouseController.GetAttachedType()
+			attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
+			attachedItemVID = mouseModule.mouseController.GetAttachedItemIndex()
+
+			if player.SLOT_TYPE_INVENTORY == attachedSlotType or\
+				player.SLOT_TYPE_BELT_INVENTORY == attachedSlotType:
+				if attachedSlotPos >= player.ITEM_SLOT_COUNT:
+					mouseModule.mouseController.DeattachObject()
+					return
+
+				attachedWindow = player.SlotTypeToInvenType(attachedSlotType)
+				self.__DropSrcItemToDestItemInInventory(attachedItemVID, attachedWindow, attachedSlotPos, window_type, itemSlotIndex)
+
+			mouseModule.mouseController.DeattachObject()
+		else:
+			curCursorNum = app.GetCursor()
+			if app.SELL == curCursorNum:
+				self.__SellItem(window_type, itemSlotIndex)
+
+			elif app.BUY == curCursorNum:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.SHOP_BUY_INFO)
+
+			elif app.IsPressed(app.DIK_LALT):
+				link = player.GetItemLink(window_type, itemSlotIndex)
+				ime.PasteString(link)
+
+			elif app.IsPressed(app.DIK_LSHIFT):
+				itemCount = player.GetItemCount(window_type, itemSlotIndex)
+
+				if itemCount > 1:
+					if app.ENABLE_CHEQUE_SYSTEM:
+						self.dlgPickETC.SetTitleName(localeInfo.PICK_ITEM_TITLE)
+						self.dlgPickETC.SetAcceptEvent(ui.__mem_func__(self.OnPickItem))
+						self.dlgPickETC.Open(itemCount)
+						self.dlgPickETC.itemGlobalSlotIndex = itemSlotIndex
+						self.dlgPickETC.itemGlobalSlotWindow = window_type
+					else:
+						self.dlgPickMoney.SetTitleName(localeInfo.PICK_ITEM_TITLE)
+						self.dlgPickMoney.SetAcceptEvent(ui.__mem_func__(self.OnPickItem))
+						self.dlgPickMoney.Open(itemCount)
+						self.dlgPickMoney.itemGlobalSlotIndex = itemSlotIndex
+						self.dlgPickMoney.itemGlobalSlotWindow = window_type
+
+				if app.ENABLE_GROWTH_PET_SYSTEM:
+					if item.GetItemType() == item.ITEM_TYPE_PET and item.GetItemSubType() == item.PET_UPBRINGING:
+						self.interface.TogglePetInformationWindow()
+						return
+
+			elif app.IsPressed(app.DIK_LCONTROL):
+				itemIndex = player.GetItemIndex(window_type, itemSlotIndex)
+
+				if True == item.CanAddToQuickSlotItem(itemIndex):
+					if window_type == player.INVENTORY:
+						player.RequestAddToEmptyLocalQuickSlot(player.SLOT_TYPE_INVENTORY, itemSlotIndex)
+					elif window_type == player.BELT_INVENTORY:
+						player.RequestAddToEmptyLocalQuickSlot(player.SLOT_TYPE_BELT_INVENTORY, itemSlotIndex)
+				else:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.QUICKSLOT_REGISTER_DISABLE_ITEM)
+
+			else:
+				selectedItemVNum = player.GetItemIndex(window_type, itemSlotIndex)
+				itemCount = player.GetItemCount(window_type, itemSlotIndex)
+				attachSlotType = player.WindowTypeToSlotType(window_type)
+
+				if app.ENABLE_GROWTH_PET_SYSTEM:
+					if self.__CanAttachGrowthPetItem(selectedItemVNum, itemSlotIndex):
+						mouseModule.mouseController.AttachObject(self, player.SLOT_TYPE_INVENTORY, itemSlotIndex, selectedItemVNum, itemCount)
+				else:
+					mouseModule.mouseController.AttachObject(self, attachSlotType, itemSlotIndex, selectedItemVNum, itemCount)
+
+				if self.__IsUsableItemToItem(selectedItemVNum, itemSlotIndex):
+					self.interface.SetUseItemMode(True)
+				else:
+					self.interface.SetUseItemMode(False)
+
+				snd.PlaySound("sound/ui/pick.wav")
+
+	def __DropSrcItemToDestItemInInventory(self, srcItemVID, srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos):
+		if srcItemSlotWindow == dstItemSlotWindow:
+			if srcItemSlotPos == dstItemSlotPos:
+				return
+
+		## Ç¼ Ã¢ 
+		##  Ìµ .
+		if app.ENABLE_ACCE_COSTUME_SYSTEM:
+			if player.GetAcceRefineWindowOpen():
+				return
+
+		if app.ENABLE_CHANGE_LOOK_SYSTEM:
+			if player.GetChangeLookWindowOpen():
+				return
+
+		if app.ENABLE_AURA_COSTUME_SYSTEM:
+			if player.IsAuraWindowOpen():
+				return
+
+		if app.ENABLE_ATTR_6TH_7TH:
+			if self.interface.wndAttr67Add.IsShow():
+				return
+
+		## [MT-462]
+		if player.GetItemIndex(srcItemSlotWindow, srcItemSlotPos) == player.GetItemIndex(dstItemSlotWindow, dstItemSlotPos) \
+			and (player.GetItemFlags(srcItemSlotWindow, srcItemSlotPos) & item.ITEM_FLAG_STACKABLE) \
+			and player.IsEquipmentSlot(dstItemSlotWindow, dstItemSlotPos) == False:
+			self.__SendMoveItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, 0)
+			return
+
+		if app.ENABLE_SOULBIND_SYSTEM:
+			# cyh itemseal 2013 11 08
+			if item.IsSealScroll(srcItemVID):
+				if player.CanSealItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
+					self.__OpenQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+
+		useType = item.GetUseType(srcItemVID)
+
+		if item.IsRefineScroll(srcItemVID):
+			self.RefineItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+			self.interface.SetUseItemMode(False)
+
+		elif item.IsMetin(srcItemVID):
+			self.AttachMetinToItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+
+		elif item.IsDetachScroll(srcItemVID):
+			self.DetachMetinFromItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+
+		elif item.IsKey(srcItemVID):
+			self.__SendUseItemToItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+
+		elif (player.GetItemFlags(srcItemSlotPos) & ITEM_FLAG_APPLICABLE) == ITEM_FLAG_APPLICABLE:
+			self.__SendUseItemToItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+
+		elif useType in self.USE_TYPE_TUPLE:
+			if app.ENABLE_REFINE_ELEMENT_SYSTEM:
+				if "USE_ELEMENT_UPGRADE" == useType:
+					if not uiRefine.RefineElementDialog.CanRefineElementUpgrade(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, True, False):
+						return
+
+				elif "USE_ELEMENT_DOWNGRADE" == useType:
+					if not uiRefine.RefineElementDialog.CanRefineElementDowngrade(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, True, False):
+						return
+
+				elif "USE_ELEMENT_CHANGE" == useType:
+					if not uiRefine.RefineElementChangeDialog.CanRefineElementChange(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, True, False):
+						return
+
+			self.__SendUseItemToItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+
+		else:
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if item.IsAcceScroll(srcItemVID):
+					if player.CanAcceClearItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
+						self.__OpenQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+						return
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if item.IsChangeLookClearScroll(srcItemVID):
+					if dstItemSlotWindow != player.INVENTORY:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.CHANGE_LOOK_DO_NOT_EQUIP_ITEM)
+						return
+
+					if player.CanChangeLookClearItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
+						self.__OpenQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+						return
+
+			if app.ENABLE_GROWTH_PET_SYSTEM:
+				if self.__IsPetItem(srcItemVID):
+					if self.__SendUsePetItemToItemPacket(srcItemVID, srcItemSlotPos, dstItemSlotPos):
+						return
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if srcItemVID == item.ITEM_VNUM_AURA_CLEAR:
+					if player.CanAuraClearItem(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
+						self.__UseAuraClearItem(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+						return
+
+			if app.ENABLE_SET_ITEM:
+				if item.IsSetClearScroll(srcItemVID):
+					if player.CanSetItemClear(srcItemVID, dstItemSlotWindow, dstItemSlotPos):
+						self.__OpenSetClearItemQuestionDialog(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+						return
+
+			if app.ENABLE_GEM_CONVERTER:
+				if srcItemVID == item.ITEM_VNUM_GEM_CONVERTER:
+					if self.__CanUseGemConverter(srcItemVID, srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos):
+						self.__UseGemConverter(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)
+						return
+
+			## ÌµÅ²      Ø¼  Å² - [levites]
+			if player.IsEquipmentSlot(dstItemSlotWindow, dstItemSlotPos):
+				##  Ö´  Ï¶
+				if item.IsEquipmentVID(srcItemVID):
+					self.__UseItem(srcItemSlotPos, srcItemSlotWindow)
+			else:
+				self.__SendMoveItemPacket(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos, 0)
+
+	def __OpenQuestionDialog(self, srcItemWindow, srcItemPos, dstItemWindow, dstItemPos):
+		if self.interface.IsShowDlgQuestionWindow():
+			self.interface.CloseDlgQuestionWindow()
+
+		getItemVNum = player.GetItemIndex
+		self.srcItemPos = srcItemPos
+		self.dstItemPos = dstItemPos
+
+		self.srcItemWindow = srcItemWindow
+		self.dstItemWindow = dstItemWindow
+
+		self.dlgQuestion.SetAcceptEvent(ui.__mem_func__(self.__Accept))
+		self.dlgQuestion.SetCancelEvent(ui.__mem_func__(self.__Cancel))
+
+		self.dlgQuestion.SetText1("%s" % item.GetItemName(getItemVNum(srcItemPos)) )
+		self.dlgQuestion.SetText2(localeInfo.INVENTORY_REALLY_USE_ITEM)
+
+		self.dlgQuestion.Open()
+
+		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+
+	def __Accept(self):
+		self.dlgQuestion.Close()
+		self.__SendUseItemToItemPacket(self.srcItemWindow, self.srcItemPos, self.dstItemWindow, self.dstItemPos)
+		self.srcItemPos = (0, 0)
+		self.dstItemPos = (0, 0)
+
+		self.srcItemWindow = None
+		self.dstItemWindow = None
+
+		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+	def __Cancel(self):
+		self.srcItemPos = (0, 0)
+		self.dstItemPos = (0, 0)
+		self.dlgQuestion.Close()
+
+		self.srcItemWindow = None
+		self.dstItemWindow = None
+
+		constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+	if app.ENABLE_SET_ITEM:
+		def __OpenSetClearItemQuestionDialog(self, srcItemWindow, srcItemPos, dstItemWindow, dstItemPos):
+			if self.interface.IsShowDlgQuestionWindow():
+				self.interface.CloseDlgQuestionWindow()
+
+			getItemVNum = player.GetItemIndex
+			self.srcItemPos = srcItemPos
+			self.dstItemPos = dstItemPos
+
+			self.srcItemWindow = srcItemWindow
+			self.dstItemWindow = dstItemWindow
+
+			self.dlgQuestion.SetAcceptEvent(ui.__mem_func__(self.__SetClearItemAccept))
+			self.dlgQuestion.SetCancelEvent(ui.__mem_func__(self.__SetClearItemCancel))
+
+			self.dlgQuestion.SetText1(localeInfo.SET_ITEM_CLEAR_CONFIRM_QUESTION)
+			self.dlgQuestion.SetText2(localeInfo.SET_ITEM_CLEAR_CONFIRM_QUESTION_2)
+			self.dlgQuestion.Open()
+
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+
+		def __SetClearItemAccept(self):
+			self.__Accept()
+
+		def __SetClearItemCancel(self):
+			self.__Cancel()
+
+	def __SellItem(self, window_type, itemSlotPos):
+		if not player.IsEquipmentSlot(window_type, itemSlotPos):
+			itemIndex = player.GetItemIndex(window_type, itemSlotPos)
+			itemCount = player.GetItemCount(window_type, itemSlotPos)
+
+			self.sellingSlotWindow = window_type
+			self.sellingSlotNumber = itemSlotPos
+			self.sellingSlotitemIndex = itemIndex
+			self.sellingSlotitemCount = itemCount
+
+			item.SelectItem(itemIndex)
+			## Æ¼ Ã· Ë»  ß°
+			## 20140220
+			if item.IsAntiFlag(item.ANTIFLAG_SELL):
+				popup = uiCommon.PopupDialog()
+				popup.SetText(localeInfo.SHOP_CANNOT_SELL_ITEM)
+				popup.SetAcceptEvent(self.__OnClosePopupDialog)
+				popup.Open()
+				self.popup = popup
+				return
+
+			itemPrice = item.GetISellItemPrice()
+
+			if item.Is1GoldItem():
+				itemPrice = itemCount / itemPrice / 5
+			else:
+				itemPrice = itemPrice * itemCount / 5
+
+			item.GetItemName(itemIndex)
+			itemName = item.GetItemName()
+			if app.ENABLE_SET_ITEM:
+				itemName = item.GetItemNameBySetValue(player.GetItemSetValue(window_type, itemSlotPos))
+
+			self.questionDialog = uiCommon.QuestionDialog()
+			self.questionDialog.SetText(localeInfo.DO_YOU_SELL_ITEM(itemName, itemCount, itemPrice))
+			self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.SellItem))
+			self.questionDialog.SetCancelEvent(ui.__mem_func__(self.OnCloseQuestionDialog))
+			self.questionDialog.Open()
+			self.questionDialog.count = itemCount
+
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+
+	def __OnClosePopupDialog(self):
+		self.pop = None
+
+	def RefineItem(self, scrollSlotWindow, scrollSlotPos, targetSlotWindow, targetSlotPos):
+		scrollIndex = player.GetItemIndex(scrollSlotWindow, scrollSlotPos)
+		targetIndex = player.GetItemIndex(targetSlotWindow, targetSlotPos)
+
+		if player.REFINE_OK != player.CanRefine(scrollIndex, targetSlotWindow, targetSlotPos):
+			return
+
+		if app.ENABLE_REFINE_RENEWAL:
+			constInfo.AUTO_REFINE_TYPE = 1
+			constInfo.AUTO_REFINE_DATA["ITEM"][0] = scrollSlotPos
+			constInfo.AUTO_REFINE_DATA["ITEM"][1] = targetSlotPos
+
+		###########################################################
+		self.__SendUseItemToItemPacket(scrollSlotWindow, scrollSlotPos, targetSlotWindow, targetSlotPos)
+		#net.SendItemUseToItemPacket(scrollSlotPos, targetSlotPos)
+		return
+		###########################################################
+
+		###########################################################
+		#net.SendRequestRefineInfoPacket(targetSlotPos)
+		#return
+		###########################################################
+
+		result = player.CanRefine(scrollIndex, targetSlotPos)
+
+		if player.REFINE_ALREADY_MAX_SOCKET_COUNT == result:
+			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NO_MORE_SOCKET)
+
+		elif player.REFINE_NEED_MORE_GOOD_SCROLL == result:
+			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NEED_BETTER_SCROLL)
+
+		elif player.REFINE_CANT_MAKE_SOCKET_ITEM == result:
+			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_SOCKET_DISABLE_ITEM)
+
+		elif player.REFINE_NOT_NEXT_GRADE_ITEM == result:
+			#snd.PlaySound("sound/ui/jaeryun_fail.wav")
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_UPGRADE_DISABLE_ITEM)
+
+		elif player.REFINE_CANT_REFINE_METIN_TO_EQUIPMENT == result:
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_EQUIP_ITEM)
+
+		if player.REFINE_OK != result:
+			return
+
+		self.refineDialog.Open(scrollSlotPos, targetSlotPos)
+
+	def DetachMetinFromItem(self, scrollSlotWindow, scrollSlotPos, targetSlotWindow, targetSlotPos):
+		scrollIndex = player.GetItemIndex(scrollSlotWindow, scrollSlotPos)
+		targetIndex = player.GetItemIndex(targetSlotWindow, targetSlotPos)
+
+		if not player.CanDetach(scrollIndex, targetSlotWindow, targetSlotPos):
+			if app.ENABLE_ACCE_COSTUME_SYSTEM and item.IsAcceScroll(scrollIndex):
+				return
+
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_METIN_INSEPARABLE_ITEM)
+			return
+
+		self.questionDialog = uiCommon.QuestionDialog()
+		if (app.ENABLE_ACCE_COSTUME_SYSTEM or app.ENABLE_AURA_COSTUME_SYSTEM) and item.IsAcceScroll(scrollIndex):
+			self.questionDialog.SetText(localeInfo.AURA_CLEAR_QUESTION_WHEN_USE)
+		elif app.ENABLE_CHANGE_LOOK_SYSTEM and item.IsChangeLookClearScroll(scrollIndex):
+			self.questionDialog.SetText(localeInfo.CHANGE_LOOK_CHANGE_ITEM)
+		else:
+			self.questionDialog.SetText(localeInfo.REFINE_DO_YOU_SEPARATE_METIN)
+		self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.OnDetachMetinFromItem))
+		self.questionDialog.SetCancelEvent(ui.__mem_func__(self.OnCloseQuestionDialog))
+		self.questionDialog.Open()
+		self.questionDialog.sourcePos = scrollSlotPos
+		self.questionDialog.targetPos = targetSlotPos
+
+		self.questionDialog.sourceWindow = scrollSlotWindow
+		self.questionDialog.targetWindow = targetSlotWindow
+
+	def AttachMetinToItem(self, metinSlotWindow, metinSlotPos, targetSlotWindow, targetSlotPos):
+		metinIndex = player.GetItemIndex(metinSlotWindow, metinSlotPos)
+		targetIndex = player.GetItemIndex(targetSlotWindow, targetSlotPos)
+
+		item.SelectItem(metinIndex)
+		itemName = item.GetItemName()
+		if app.ENABLE_SET_ITEM:
+			itemName = item.GetItemNameBySetValue(player.GetItemSetValue(metinSlotWindow, metinSlotPos))
+
+		result = player.CanAttachMetin(metinIndex, targetSlotWindow, targetSlotPos)
+
+		if player.ATTACH_METIN_NOT_MATCHABLE_ITEM == result:
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_CAN_NOT_ATTACH(itemName))
+
+		if player.ATTACH_METIN_NO_MATCHABLE_SOCKET == result:
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NO_SOCKET(itemName))
+
+		elif player.ATTACH_METIN_NOT_EXIST_GOLD_SOCKET == result:
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_NO_GOLD_SOCKET(itemName))
+
+		elif player.ATTACH_METIN_CANT_ATTACH_TO_EQUIPMENT == result:
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.REFINE_FAILURE_EQUIP_ITEM)
+
+		if player.ATTACH_METIN_OK != result:
+			return
+
+		self.attachMetinDialog.Open(metinSlotWindow, metinSlotPos, targetSlotWindow, targetSlotPos)
+
+	def OverOutItem(self):
+		self.wndItem.SetUsableItem(False)
+		if None != self.tooltipItem:
+			self.tooltipItem.HideToolTip()
+
+	def OverInItem(self, overSlotPos, window_type):
+		overInvenSlotPos = self.__InventoryLocalSlotPosToGlobalSlotPos(overSlotPos, window_type)
+		self.wndItem.SetUsableItem(False)
+
+		getItemVNum = ReprGetItemIndex(window_type)
+		itemVnum = getItemVNum(overInvenSlotPos)
+
+		if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+			if window_type == player.INVENTORY:
+				self.DelHighlightSlot(overInvenSlotPos)
+
+		if mouseModule.mouseController.isAttached():
+			attachedItemType = mouseModule.mouseController.GetAttachedType()
+
+			if player.SLOT_TYPE_INVENTORY == attachedItemType:
+				attachedSlotPos = mouseModule.mouseController.GetAttachedSlotNumber()
+				attachedItemVNum = mouseModule.mouseController.GetAttachedItemIndex()
+
+				if self.__CanUseSrcItemToDstItem(attachedItemVNum, player.INVENTORY, attachedSlotPos, window_type, overInvenSlotPos):
+					self.wndItem.SetUsableItem(True)
+					self.ShowToolTip(overInvenSlotPos, window_type)
+					return
+
+		self.ShowToolTip(overInvenSlotPos, window_type)
+
+	def __IsUsableItemToItem(self, srcItemVNum, srcSlotPos):
+		"Ù¸ Û¿   Ö´ Î°?"
+
+		if item.IsRefineScroll(srcItemVNum):
+			return True
+		elif app.ENABLE_SOULBIND_SYSTEM and item.IsSealScroll(srcItemVNum):
+			return True
+		elif item.IsMetin(srcItemVNum):
+			return True
+		elif item.IsDetachScroll(srcItemVNum):
+			return True
+		elif item.IsKey(srcItemVNum):
+			return True
+		elif item.IsItemUsedForDragonSoul(srcItemVNum):
+			return True
+		elif (player.GetItemFlags(srcSlotPos) & ITEM_FLAG_APPLICABLE) == ITEM_FLAG_APPLICABLE:
+			return True
+		else:
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if item.IsAcceScroll(srcItemVNum):
+					return True
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if item.IsChangeLookClearScroll(srcItemVNum):
+					return True
+
+			if app.ENABLE_GROWTH_PET_SYSTEM:
+				if self.__IsUsablePetItem(srcItemVNum):
+					return True
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if item.ITEM_VNUM_AURA_CLEAR == srcItemVNum:
+					return True
+
+			if app.ENABLE_SET_ITEM:
+				if item.IsSetClearScroll(srcItemVNum):
+					return True
+
+			if app.ENABLE_GEM_CONVERTER:
+				if srcItemVNum == item.ITEM_VNUM_GEM_CONVERTER:
+					return True
+
+			if item.GetUseType(srcItemVNum) in self.USE_TYPE_TUPLE:
+				return True
+
+		return False
+
+	def __CanUseSrcItemToDstItem(self, srcItemVNum, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):
+		##  Û¿   Ö´Â°?
+		if srcSlotWindow == dstSlotWindow:
+			if srcSlotPos == dstSlotPos:
+				return False
+
+		## [MT-462]: Stackable UseMode Ì°..
+		#if srcItemVNum == player.GetItemIndex(dstSlotWindow, dstSlotPos) and \
+		#	(player.GetItemFlags(dstSlotWindow, dstSlotPos) & item.ITEM_FLAG_STACKABLE):
+		#	return True
+
+		if item.IsRefineScroll(srcItemVNum):
+			if player.REFINE_OK == player.CanRefine(srcItemVNum, dstSlotWindow, dstSlotPos):
+				return True
+
+		elif app.ENABLE_SOULBIND_SYSTEM and item.IsSealScroll(srcItemVNum):
+			if player.CanSealItem(srcItemVNum, dstSlotWindow, dstSlotPos):
+				return True
+
+		elif item.IsMetin(srcItemVNum):
+			if player.ATTACH_METIN_OK == player.CanAttachMetin(srcItemVNum, dstSlotWindow, dstSlotPos):
+				return True
+
+		elif item.IsDetachScroll(srcItemVNum):
+			if player.DETACH_METIN_OK == player.CanDetach(srcItemVNum, dstSlotWindow, dstSlotPos):
+				return True
+
+		elif item.IsKey(srcItemVNum):
+			if player.CanUnlock(srcItemVNum, dstSlotWindow, dstSlotPos):
+				return True
+
+		elif (player.GetItemFlags(srcSlotWindow, srcSlotPos) & ITEM_FLAG_APPLICABLE) == ITEM_FLAG_APPLICABLE:
+			return True
+
+		else:
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if item.IsAcceScroll(srcItemVNum):
+					if player.CanAcceClearItem(srcItemVNum, dstSlotWindow, dstSlotPos):
+						return True
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if item.IsChangeLookClearScroll(srcItemVNum):
+					if player.CanChangeLookClearItem(srcItemVNum, dstSlotWindow, dstSlotPos):
+						return True
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if item.ITEM_VNUM_AURA_CLEAR == srcItemVNum:
+					if player.CanAuraClearItem(srcItemVNum, dstSlotWindow, dstSlotPos):
+						return True
+
+			if app.ENABLE_SET_ITEM:
+				if item.IsSetClearScroll(srcItemVNum):
+					if player.CanSetItemClear(srcItemVNum, dstSlotWindow, dstSlotPos):
+						return True
+
+			if app.ENABLE_GEM_CONVERTER:
+				if srcItemVNum == item.ITEM_VNUM_GEM_CONVERTER:
+					if self.__CanUseGemConverter(srcItemVNum, dstSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):
+						return True
+
+			if app.ENABLE_GROWTH_PET_SYSTEM:
+				if self.__CanUseSrcPetItemToDstPetItem(srcItemVNum, srcSlotPos, dstSlotPos):
+					return True
+
+			useType = item.GetUseType(srcItemVNum)
+
+			if app.ENABLE_ATTR_6TH_7TH:
+				if "USE_CHANGE_ATTRIBUTE2" == useType:
+					if self.__CanChangeItemAttr67List(player.INVENTORY, dstSlotPos):
+						return True
+
+			if "USE_CLEAN_SOCKET" == useType:
+				if self.__CanCleanBrokenMetinStone(dstSlotWindow, dstSlotPos):
+					return True
+
+			elif "USE_CHANGE_ATTRIBUTE" == useType:
+				if self.__CanChangeItemAttrList(dstSlotWindow, dstSlotPos):
+					return True
+
+			elif "USE_ADD_ATTRIBUTE" == useType:
+				if self.__CanAddItemAttr(dstSlotWindow, dstSlotPos):
+					return True
+
+			elif "USE_ADD_ATTRIBUTE2" == useType:
+				if self.__CanAddItemAttr2(dstSlotWindow, dstSlotPos):
+					return True
+
+			elif "USE_ADD_ACCESSORY_SOCKET" == useType:
+				if self.__CanAddAccessorySocket(dstSlotWindow, dstSlotPos):
+					return True
+
+			elif "USE_PUT_INTO_ACCESSORY_SOCKET" == useType:
+				if self.__CanPutAccessorySocket(dstSlotWindow, dstSlotPos, srcItemVNum):
+					return True
+
+			elif "USE_PUT_INTO_BELT_SOCKET" == useType:
+				dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+				item.SelectItem(dstItemVNum)
+				if item.ITEM_TYPE_BELT == item.GetItemType():
+					return True
+
+			elif app.ENABLE_MOVE_COSTUME_ATTR and "USE_CHANGE_COSTUME_ATTR" == useType:
+				if self.__CanChangeCostumeAttrList(dstSlotWindow, dstSlotPos):
+					return True
+
+			elif app.ENABLE_MOVE_COSTUME_ATTR and "USE_RESET_COSTUME_ATTR" == useType:
+				if self.__CanResetCostumeAttr(dstSlotWindow, dstSlotPos):
+					return True
+
+			else:
+				if app.ENABLE_CHANGED_ATTR and "USE_SELECT_ATTRIBUTE" == useType:
+					if self.__CanChangeItemAttrList(dstSlotWindow, dstSlotPos):
+						return True
+
+				if app.ENABLE_REFINE_ELEMENT_SYSTEM:
+					if "USE_ELEMENT_UPGRADE" == useType:
+						if uiRefine.RefineElementDialog.CanRefineElementUpgrade(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, False, False):
+							return True
+
+					if "USE_ELEMENT_DOWNGRADE" == useType:
+						if uiRefine.RefineElementDialog.CanRefineElementDowngrade(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, False, False):
+							return True
+
+					if "USE_ELEMENT_CHANGE" == useType:
+						if uiRefine.RefineElementChangeDialog.CanRefineElementChange(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, False, False):
+							return True
+
+		return False
+
+	def __CanCleanBrokenMetinStone(self, dstSlotWindow, dstSlotPos):
+		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+		if dstItemVNum == 0:
+			return False
+
+		item.SelectItem(dstItemVNum)
+
+		if item.ITEM_TYPE_WEAPON != item.GetItemType() and item.ITEM_TYPE_ARMOR != item.GetItemType():
+			return False
+
+		for i in xrange(player.METIN_SOCKET_MAX_NUM):
+			if player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, i) == constInfo.ERROR_METIN_STONE:
+				return True
+
+		return False
+
+	def __CanChangeItemAttrList(self, dstSlotWindow, dstSlotPos):
+		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+		if dstItemVNum == 0:
+			return False
+
+		item.SelectItem(dstItemVNum)
+
+		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
+			return False
+
+		# 
+		if app.ENABLE_NEW_USER_CARE:
+			if item.IsAntiFlag(item.ITEM_ANTIFLAG_ENCHANT):
+				return False
+
+		if app.ENABLE_SOULBIND_SYSTEM:
+			if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
+				return False
+
+		for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
+			type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
+			if type != 0:
+				return True
+
+		return False
+
+	def __CanPutAccessorySocket(self, dstSlotWindow, dstSlotPos, mtrlVnum):
+		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+		if dstItemVNum == 0:
+			return False
+
+		item.SelectItem(dstItemVNum)
+
+		if item.GetItemType() != item.ITEM_TYPE_ARMOR:
+			return False
+
+		if not item.GetItemSubType() in (item.ARMOR_WRIST, item.ARMOR_NECK, item.ARMOR_EAR):
+			return False
+
+		curCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 0)
+		maxCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 1)
+
+		if mtrlVnum != constInfo.GET_ACCESSORY_MATERIAL_VNUM(dstItemVNum, item.GetItemSubType()):
+			return False
+
+		if curCount >= maxCount:
+			return False
+
+		return True
+
+	def __CanAddAccessorySocket(self, dstSlotWindow, dstSlotPos):
+		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+		if dstItemVNum == 0:
+			return False
+
+		item.SelectItem(dstItemVNum)
+
+		if not item.GetItemType() in (item.ITEM_TYPE_ARMOR, item.ITEM_TYPE_BELT):
+			return False
+
+		if not item.GetItemSubType() in (item.ARMOR_WRIST, item.ARMOR_NECK, item.ARMOR_EAR) and not item.GetItemType() == item.ITEM_TYPE_BELT:
+			return False
+
+		curCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 0)
+		maxCount = player.GetItemMetinSocket(dstSlotWindow, dstSlotPos, 1)
+
+		ACCESSORY_SOCKET_MAX_SIZE = 3
+		if maxCount >= ACCESSORY_SOCKET_MAX_SIZE:
+			return False
+
+		return True
+
+	if app.ENABLE_ATTR_6TH_7TH:
+		def __CanChangeItemAttr67List(self, dstSlotWindow, dstSlotPos):
+			dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+			if dstItemVNum == 0:
+				return False
+
+			item.SelectItem(dstItemVNum)
+
+			if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
+				return False
+
+			if app.ENABLE_QUIVER_SYSTEM:
+				if (item.GetItemType() == item.ITEM_TYPE_WEAPON and item.GetItemSubType() in (item.WEAPON_ARROW, item.WEAPON_QUIVER)):
+					return False
+			else:
+				if (item.GetItemType() == item.ITEM_TYPE_WEAPON and item.GetItemSubType() == item.WEAPON_ARROW):
+					return False
+
+			# 
+			if app.ENABLE_NEW_USER_CARE:
+				if item.IsAntiFlag(item.ITEM_ANTIFLAG_ENCHANT):
+					return False
+
+			if app.ENABLE_SOULBIND_SYSTEM:
+				if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
+					return False
+
+			attrCount = 0
+			for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
+				type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
+				if type != 0:
+					attrCount += 1
+
+			if attrCount > player.ATTRIBUTE_SLOT_MAX_NUM - 2 and attrCount <= player.ATTRIBUTE_SLOT_MAX_NUM:
+				return True
+
+			return False
+
+	def __CanAddItemAttr(self, dstSlotWindow, dstSlotPos):
+		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+		if dstItemVNum == 0:
+			return False
+
+		item.SelectItem(dstItemVNum)
+
+		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
+			return False
+
+		# ç°¡
+		if app.ENABLE_NEW_USER_CARE:
+			if item.IsAntiFlag(item.ITEM_ANTIFLAG_REINFORCE):
+				return False
+
+		if app.ENABLE_SOULBIND_SYSTEM:
+			if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
+				return False
+
+		attrCount = 0
+		for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
+			type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
+			if type != 0:
+				attrCount += 1
+
+		if attrCount < 4:
+			return True
+
+		return False
+
+	def __CanAddItemAttr2(self, dstSlotWindow, dstSlotPos):
+		dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+		if dstItemVNum == 0:
+			return False
+
+		item.SelectItem(dstItemVNum)
+
+		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):
+			return False
+
+		# ç°¡
+		if app.ENABLE_NEW_USER_CARE:
+			if item.IsAntiFlag(item.ITEM_ANTIFLAG_REINFORCE):
+				return False
+
+		if app.ENABLE_SOULBIND_SYSTEM:
+			if player.GetItemSealDate(dstSlotWindow, dstSlotPos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
+				return False
+
+		attrCount = 0
+		for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
+			type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
+			if type != 0:
+				attrCount += 1
+
+		if attrCount == 4:
+			return True
+
+		return False
+
+	if app.ENABLE_MOVE_COSTUME_ATTR:
+		def __CanChangeCostumeAttrList(self, dstSlotWindow, dstSlotPos):
+			dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+			if dstItemVNum == 0:
+				return False
+
+			item.SelectItem(dstItemVNum)
+
+			if item.GetItemType() != item.ITEM_TYPE_COSTUME:
+				return False
+
+			if app.ENABLE_MOUNT_COSTUME_SYSTEM:
+				if item.GetItemSubType() == item.COSTUME_TYPE_MOUNT:
+					return False
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
+					return False
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if item.GetItemSubType() == item.COSTUME_TYPE_AURA:
+					return False
+
+			for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
+				type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
+				if type != 0:
+					return True
+
+			return False
+
+		def __CanResetCostumeAttr(self, dstSlotWindow, dstSlotPos):
+			dstItemVNum = player.GetItemIndex(dstSlotWindow, dstSlotPos)
+			if dstItemVNum == 0:
+				return False
+
+			item.SelectItem(dstItemVNum)
+
+			if item.GetItemType() != item.ITEM_TYPE_COSTUME:
+				return False
+
+			if app.ENABLE_MOUNT_COSTUME_SYSTEM:
+				if item.GetItemSubType() == item.COSTUME_TYPE_MOUNT:
+					return False
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
+					return False
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if item.GetItemSubType() == item.COSTUME_TYPE_AURA:
+					return False
+
+			for i in xrange(player.ATTRIBUTE_SLOT_MAX_NUM):
+				type, value = player.GetItemAttribute(dstSlotWindow, dstSlotPos, i)
+				if type != 0:
+					return True
+
+			return False
+
+	def ShowToolTip(self, slotIndex, window_type):
+		if None != self.tooltipItem:
+			self.tooltipItem.SetInventoryItem(slotIndex, window_type)
+
+	def OnTop(self):
+		if None != self.tooltipItem:
+			self.tooltipItem.SetTop()
+
+		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			if self.wndBelt:
+				if self.IsClickBeltInventory == False:
+					self.wndBelt.SetTop()
+				else:
+					self.IsClickBeltInventory = False
+
+			if self.wndCostume:
+				self.wndCostume.SetTop()
+
+		if app.WJ_ENABLE_TRADABLE_ICON:
+			map(lambda wnd:wnd.RefreshLockedSlot(), self.bindWnds)
+
+	def OnPressEscapeKey(self):
+		self.Close()
+		return True
+
+	def UseItemSlot(self, slotIndex, window):
+		curCursorNum = app.GetCursor()
+		if app.SELL == curCursorNum:
+			return
+
+		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS():
+			return
+
+		slotIndex = self.__InventoryLocalSlotPosToGlobalSlotPos(slotIndex, window)
+
+		if app.ENABLE_DRAGON_SOUL_SYSTEM:
+			if self.wndDragonSoulRefine.IsShow():
+				self.wndDragonSoulRefine.AutoSetItem((window, slotIndex), 1)
+				return
+
+		self.__UseItem(slotIndex, window)
+		mouseModule.mouseController.DeattachObject()
+		self.OverOutItem()
+
+	def __UseItem(self, slotIndex, slotWindow):
+		ItemVNum = player.GetItemIndex(slotWindow, slotIndex)
+		item.SelectItem(ItemVNum)
+
+		## Ç¼ Ã¢ 
+		## Ç¼ , ,  Ü¿ Æ¹  Èµ.
+		if app.ENABLE_ACCE_COSTUME_SYSTEM:
+			if player.GetAcceRefineWindowOpen():
+				self.__UseItemAcce(slotIndex, slotWindow)
+				return
+
+		if app.ENABLE_GROWTH_PET_SYSTEM:
+			itemType = item.GetItemType()
+			
+			if self.interface.wndPetInfoWindow.AttachItemToPetWindow(player.INVENTORY, player.SLOT_TYPE_INVENTORY, slotIndex):
+				return
+				
+			if self.PetSkillDelDlg and self.PetSkillDelDlg.IsShow():
+				self.__PetSkillDeleteQuestionDialogCancel()
+
+			if item.ITEM_TYPE_PET == itemType:
+				self.__UseItemPet(slotIndex)
+				return
+
+		if app.ENABLE_CHANGE_LOOK_SYSTEM:
+			if player.GetChangeLookWindowOpen():
+				return
+
+		if app.ENABLE_AURA_COSTUME_SYSTEM:
+			if player.IsAuraWindowOpen():
+				self.__UseItemAura(slotIndex, slotWindow)
+				return
+
+		if app.WJ_ENABLE_TRADABLE_ICON or app.ENABLE_MOVE_COSTUME_ATTR:
+			if self.interface.AttachInvenItemToOtherWindowSlot(slotIndex, slotWindow):
+				return
+
+		if app.ENABLE_FLOWER_EVENT:
+			if 25121 == ItemVNum or 25122 == ItemVNum or 25123 == ItemVNum or 25124 == ItemVNum or 25125 == ItemVNum:
+				value1 = item.GetValue(0)
+				value2 = item.GetValue(1)
+				value3 = item.GetApplyPoint(value2)
+
+				if item.CheckAffect(value1, value3):
+					pass
+				else:
+					if item.CheckAffect(value1, 0):
+						self.questionDialog = uiCommon.QuestionDialog2()
+						self.questionDialog.SetText1(localeInfo.FLOWER_EVENT_USE_ITEM_TEXT1)
+						self.questionDialog.SetText2(localeInfo.FLOWER_EVENT_USE_ITEM_TEXT2)
+						self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnAccept))
+						self.questionDialog.SetCancelEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnCancel))
+						self.questionDialog.Open()
+						self.questionDialog.slotIndex = slotIndex
+						self.questionDialog.slotWindow = slotWindow
+						constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+						return
+
+		if item.IsFlag(item.ITEM_FLAG_CONFIRM_WHEN_USE):
+			self.questionDialog = uiCommon.QuestionDialog()
+			self.questionDialog.SetText(localeInfo.INVENTORY_REALLY_USE_ITEM2)
+			self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnAccept))
+			self.questionDialog.SetCancelEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnCancel))
+			self.questionDialog.Open()
+			self.questionDialog.slotIndex = slotIndex
+
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+		else:
+			self.__SendUseItemPacket(slotIndex, slotWindow)
+
+	def SetCanMouseEventSlot(self, inven_slot_index):
+		if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
+			page = self.GetInventoryPageIndex() # range 0, 1, 2, 3
+			inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
+		self.wndItem.SetCanMouseEventSlot(inven_slot_index)
+
+	def SetCantMouseEventSlot(self, inven_slot_index):
+		if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
+			page = self.GetInventoryPageIndex() # range 0, 1, 2, 3
+			inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
+		self.wndItem.SetCantMouseEventSlot(inven_slot_index)
+
+	if app.ENABLE_ACCE_COSTUME_SYSTEM:
+		def __UseItemAcce(self, slotIndex, slotWindow):
+			AcceSlot = player.FindMoveAcceItemSlot()
+
+			if slotWindow != player.INVENTORY:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOT_USINGITEM)
+				return
+
+			UsingAcceSlot = player.FindActivatedAcceSlot(slotWindow, slotIndex)
+
+			if app.ENABLE_SOULBIND_SYSTEM:
+				## Î¾ É·
+				if player.GetItemSealDate(player.INVENTORY, slotIndex) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOT_SEALITEM)
+					return
+
+			## Ã¢
+			if player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_COMBINE:
+				if item.GetItemType() == item.ITEM_TYPE_COSTUME:
+					if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
+						if app.ENABLE_ACCE_SECOND_COSTUME_SYSTEM:
+							##  Ö°  25%
+							socketInDrainValue = player.GetItemMetinSocket(slotIndex, 1)
+							if socketInDrainValue >= player.ACCE_MAX_DRAINRATE:
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_MAX_DRAINRATE)
+								return
+						else:
+							if item.GetRefinedVnum() == 0: ##   É·.
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_MAXGRADE)
+								return
+
+						if UsingAcceSlot == player.ACCE_SLOT_MAX:
+							if AcceSlot != player.ACCE_SLOT_MAX:
+								if not player.FindUsingAcceSlot(AcceSlot) == player.NPOS():
+									return
+
+								if player.FindUsingAcceSlot(player.ACCE_SLOT_LEFT) == player.NPOS():
+									if AcceSlot == player.ACCE_SLOT_RIGHT:
+										return
+
+							player.SetAcceActivatedItemSlot(AcceSlot, slotIndex)
+							net.SendAcceRefineCheckIn(player.INVENTORY, slotIndex, AcceSlot, player.GetAcceRefineWindowType())
+					else:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCE)
+						return
+				else:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCE)
+					return
+
+			## Ã¢
+			elif player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_ABSORB:
+				isAbsorbItem = False
+				if item.GetItemType() == item.ITEM_TYPE_COSTUME:
+					if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:
+						if not player.GetItemMetinSocket(slotIndex, 0) == 0:
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOTABSORBITEM)
+							return
+
+						if UsingAcceSlot == player.ACCE_SLOT_MAX:
+							if not AcceSlot == player.ACCE_SLOT_LEFT: ## Ç¼  Ô¿
+								return
+
+							player.SetAcceActivatedItemSlot(AcceSlot, slotIndex)
+							net.SendAcceRefineCheckIn(player.INVENTORY, slotIndex, AcceSlot, player.GetAcceRefineWindowType())
+					else:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
+						return
+
+				elif item.GetItemType() == item.ITEM_TYPE_WEAPON: ## .
+					isAbsorbItem = True
+
+				elif item.GetItemType() == item.ITEM_TYPE_ARMOR: ## Ê·
+					if item.GetItemSubType() == item.ARMOR_BODY:
+						isAbsorbItem = True
+					else:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
+						return
+				else:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
+					return
+
+				if localeInfo.IsBRAZIL():
+					##  Æ·   É·Ä¡  Ø¼  ÈµÇ° Ø´Þ¶ .
+					## Â¿  ÏµÚµ. 
+					itemvnum = item.GetVnum()
+					if itemvnum == 11979 or itemvnum == 11980 or itemvnum == 11981 or itemvnum == 11982 or itemvnum == 11971 or itemvnum == 11972 or itemvnum == 11973 or itemvnum == 11974:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_DONOT_ABSORDITEM)
+						return
+
+				if app.ENABLE_ACCE_SECOND_COSTUME_SYSTEM:
+					itemvnum = item.GetVnum()
+					if item.IsWeddingItem(itemvnum) == 1:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)
+						return
+
+				if isAbsorbItem:
+					if UsingAcceSlot == player.ACCE_SLOT_MAX:
+						if not AcceSlot == player.ACCE_SLOT_RIGHT: ##    Ô¿
+							if player.FindUsingAcceSlot(player.ACCE_SLOT_RIGHT) == player.NPOS():
+								AcceSlot = player.ACCE_SLOT_RIGHT
+							else:
+								return
+
+						popup = uiCommon.QuestionDialog()
+						popup.SetText(localeInfo.ACCE_DEL_ABSORDITEM)
+						popup.SetAcceptEvent(lambda arg1 = slotIndex, arg2 = AcceSlot: self.OnAcceAcceptEvent(arg1, arg2))
+						popup.SetCancelEvent(self.OnAcceCloseEvent)
+						popup.Open()
+						self.pop = popup
+
+			##  Þ½ .
+			if not player.FindUsingAcceSlot(player.ACCE_SLOT_RIGHT) == player.NPOS() and not player.FindUsingAcceSlot(player.ACCE_SLOT_LEFT) == player.NPOS():
+				if AcceSlot != player.ACCE_SLOT_MAX:
+					popup = uiCommon.PopupDialog()
+					if player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_COMBINE:
+
+						if app.ENABLE_ACCE_SECOND_COSTUME_SYSTEM:
+							socketInDrainValue = player.GetAcceItemMetinSocket(0, 1)
+							socketInDrainValue2 = player.GetAcceItemMetinSocket(1, 1)
+							socketInDrainValue3 = player.GetItemMetinSocket(slotIndex, 1)
+							##   . Ïµ  Ï¶  Þ½ .
+							if socketInDrainValue > 0 or socketInDrainValue2 > 0 or socketInDrainValue3 > 0:
+								popup.SetText(localeInfo.ACCE_DEL_SERVEITEM2)
+							else:
+								popup.SetText(localeInfo.ACCE_DEL_SERVEITEM)
+						else:
+							popup.SetText(localeInfo.ACCE_DEL_SERVEITEM)
+
+						popup.SetAcceptEvent(self.__OnClosePopupDialog)
+						popup.Open()
+						self.pop = popup
+
+		##        Ë¾
+		def OnAcceAcceptEvent(self, slotIndex, AcceSlot):
+			self.pop.Close()
+			self.pop = None
+
+			player.SetAcceActivatedItemSlot(AcceSlot, slotIndex)
+			net.SendAcceRefineCheckIn(player.INVENTORY, slotIndex, AcceSlot, player.GetAcceRefineWindowType())
+
+		def OnAcceCloseEvent(self):
+			self.pop.Close()
+			self.pop = None
+
+	if app.ENABLE_AURA_COSTUME_SYSTEM:
+		def __UseItemAura(self, slotIndex, slotWindow):
+			AuraSlot = player.FindMoveAuraItemSlot()
+
+			if slotWindow != player.INVENTORY:
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOT_USINGITEM)
+				return
+
+			UsingAuraSlot = player.FindActivatedAuraSlot(player.INVENTORY, slotIndex)
+
+			if player.GetAuraCurrentItemSlotCount() >= player.AURA_SLOT_MAX <= UsingAuraSlot:
+				return
+
+			if app.ENABLE_SOULBIND_SYSTEM:
+				## Î¾ É·
+				if player.GetItemSealDate(player.INVENTORY, slotIndex) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_SEALITEM)
+					return
+
+			if player.GetAuraWindowType() == player.AURA_WINDOW_TYPE_ABSORB:
+				isAbsorbItem = False
+				if item.GetItemType() == item.ITEM_TYPE_COSTUME:
+					if item.GetItemSubType() == item.COSTUME_TYPE_AURA:
+						if not player.GetItemMetinSocket(slotIndex, item.ITEM_SOCKET_AURA_DRAIN_ITEM_VNUM) == 0:
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_ABSORBITEM)
+							return
+
+						if UsingAuraSlot == player.AURA_SLOT_MAX:
+							if AuraSlot != player.AURA_SLOT_MAIN:
+								return
+
+							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
+					else:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_REFINEITEM)
+						return
+
+				elif item.GetItemType() == item.ITEM_TYPE_ARMOR:
+					if item.GetItemSubType() in [item.ARMOR_SHIELD, item.ARMOR_WRIST, item.ARMOR_NECK, item.ARMOR_EAR]:
+						if player.FindUsingAuraSlot(player.AURA_SLOT_MAIN) == player.NPOS():
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_REGISTER_AURAITEM)
+							return
+
+						isAbsorbItem = True
+					else:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_REFINEITEM)
+						return
+				else:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_REFINEITEM)
+					return
+
+				if isAbsorbItem:
+					if UsingAuraSlot == player.AURA_SLOT_MAX:
+						if AuraSlot != player.AURA_SLOT_SUB:
+							if player.FindUsingAuraSlot(player.AURA_SLOT_SUB) == player.NPOS():
+								AuraSlot = player.AURA_SLOT_SUB
+							else:
+								return
+
+						popup = uiCommon.QuestionDialog()
+						popup.SetText(localeInfo.AURA_NOTICE_DEL_ABSORDITEM)
+						popup.SetAcceptEvent(lambda arg1 = slotIndex, arg2 = AuraSlot: self.OnAuraAcceptEvent(arg1, arg2))
+						popup.SetCancelEvent(self.OnAuraCloseEvent)
+						popup.Open()
+						self.pop = popup
+
+			elif player.GetAuraWindowType() == player.AURA_WINDOW_TYPE_GROWTH:
+				if UsingAuraSlot == player.AURA_SLOT_MAX:
+					if AuraSlot == player.AURA_SLOT_MAIN:
+						if item.GetItemType() == item.ITEM_TYPE_COSTUME and item.GetItemSubType() == item.COSTUME_TYPE_AURA:
+							socketLevelValue = player.GetItemMetinSocket(slotIndex, item.ITEM_SOCKET_AURA_LEVEL_VALUE)
+							curLevel = (socketLevelValue / 100000) - 1000
+							curExp = socketLevelValue % 100000;
+							if curLevel >= player.AURA_MAX_LEVEL:
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_MAX_LEVEL)
+								return
+
+							#if curExp >= player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_NEED_EXP):
+							#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_GROWTHITEM)
+							#	return
+
+							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
+						else:
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_AURAITEM)
+							return
+
+					elif AuraSlot == player.AURA_SLOT_SUB:
+						if player.FindUsingAuraSlot(player.AURA_SLOT_MAIN) != player.NPOS():
+							if item.GetItemType() == item.ITEM_TYPE_RESOURCE and item.GetItemSubType() == item.RESOURCE_AURA:
+								if UsingAuraSlot == player.AURA_SLOT_MAX:
+									if AuraSlot != player.AURA_SLOT_SUB:
+										return
+
+								net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
+							#else:
+							#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_AURARESOURCE)
+							#	return
+						else:
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_REGISTER_AURAITEM)
+							return
+
+			elif player.GetAuraWindowType() == player.AURA_WINDOW_TYPE_EVOLVE:
+				if UsingAuraSlot == player.AURA_SLOT_MAX:
+					if AuraSlot == player.AURA_SLOT_MAIN:
+						if item.GetItemType() == item.ITEM_TYPE_COSTUME and item.GetItemSubType() == item.COSTUME_TYPE_AURA:
+							socketLevelValue = player.GetItemMetinSocket(slotIndex, item.ITEM_SOCKET_AURA_LEVEL_VALUE)
+							curLevel = (socketLevelValue / 100000) - 1000
+							curExp = socketLevelValue % 100000;
+							if curLevel >= player.AURA_MAX_LEVEL:
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_MAX_LEVEL)
+								return
+
+							if curLevel != player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_LEVEL_MAX) or curExp < player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_NEED_EXP):
+								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEM)
+								return
+
+							if player.FindUsingAuraSlot(AuraSlot) != player.NPOS():
+								return
+
+							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
+						else:
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_AURAITEM)
+							return
+
+					elif AuraSlot == player.AURA_SLOT_SUB:
+						Cell = player.FindUsingAuraSlot(player.AURA_SLOT_MAIN)
+						if Cell == player.NPOS():
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_POSSIBLE_REGISTER_AURAITEM)
+							return
+
+						socketLevelValue = player.GetItemMetinSocket(*(Cell + (item.ITEM_SOCKET_AURA_LEVEL_VALUE,)))
+						curLevel = (socketLevelValue / 100000) - 1000
+						curExp = socketLevelValue % 100000;
+						if curLevel >= player.AURA_MAX_LEVEL:
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_MAX_LEVEL)
+							return
+
+						if curExp < player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_NEED_EXP):
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEM)
+							return
+
+						if player.GetItemIndex(slotIndex) != player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_MATERIAL_VNUM):
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEM)
+							return
+
+						if player.GetItemCount(slotIndex) < player.GetAuraRefineInfo(curLevel, item.AURA_REFINE_INFO_MATERIAL_COUNT):
+							chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_EVOLUTION_ITEMCOUNT)
+							return
+
+						if UsingAuraSlot == player.AURA_SLOT_MAX:
+							if AuraSlot != player.AURA_SLOT_MAX:
+								if player.FindUsingAuraSlot(AuraSlot) != player.NPOS():
+									return
+
+							net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
+
+		def OnAuraAcceptEvent(self, slotIndex, AuraSlot):
+			self.OnAuraCloseEvent()
+			net.SendAuraRefineCheckIn(player.INVENTORY, slotIndex, AuraSlot, player.GetAuraWindowType())
+
+		def OnAuraCloseEvent(self):
+			self.pop.Close()
+			self.pop = None
+
+		def __UseAuraClearItem(self, src_item_window, src_item_pos, dst_item_window, dst_item_pos):
+			if self.clear_aura_item_question_dialog:
+				return
+
+			if app.ENABLE_SOULBIND_SYSTEM:
+				if player.GetItemSealDate(dst_item_window, dst_item_pos) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_CLEAR_CANNOT_USE_SEALED_ITEM)
+					return
+
+			question_dialog = uiCommon.QuestionDialog()
+			question_dialog.SetText(localeInfo.AURA_CLEAR_QUESTION_WHEN_USE)
+			question_dialog.SetAcceptEvent(ui.__mem_func__(self.__AuraClearItemAccept))
+			question_dialog.SetCancelEvent(ui.__mem_func__(self.__AuraClearItemCancel))
+			question_dialog.Open()
+			question_dialog.srcItemWindow = src_item_window
+			question_dialog.srcItemPos = src_item_pos
+			question_dialog.dstItemWindow = dst_item_window
+			question_dialog.dstItemPos = dst_item_pos
+			self.clear_aura_item_question_dialog = question_dialog
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+
+		def __AuraClearItemAccept(self):
+			if self.clear_aura_item_question_dialog:
+				self.__SendUseItemToItemPacket(\
+					self.clear_aura_item_question_dialog.srcItemWindow,\
+					self.clear_aura_item_question_dialog.srcItemPos,\
+					self.clear_aura_item_question_dialog.dstItemWindow,\
+					self.clear_aura_item_question_dialog.dstItemPos)
+
+			self.__AuraClearQuestionDialogClose()
+
+		def __AuraClearItemCancel(self):
+			self.__AuraClearQuestionDialogClose()
+
+		def __AuraClearQuestionDialogClose(self):
+			if self.clear_aura_item_question_dialog:
+				self.clear_aura_item_question_dialog.Close()
+			self.clear_aura_item_question_dialog = None
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+	if app.ENABLE_GEM_CONVERTER:
+		def __CanUseGemConverter(self, src_item_vnum, src_item_window, src_item_pos, dst_item_window, dst_item_pos):
+			if src_item_window == dst_item_window and src_item_pos == dst_item_pos:
+				return False
+
+			if src_item_vnum != item.ITEM_VNUM_GEM_CONVERTER:
+				return False
+
+			item.SelectItem(src_item_vnum)
+
+			gem_conv_count = player.GetItemCount(src_item_window, src_item_pos)
+			gem_stone_vnum = player.GetItemIndex(dst_item_window, dst_item_pos)
+			gem_stone_count = player.GetItemCount(dst_item_window, dst_item_pos)
+
+			need_gem_stone_count = gem_conv_count * item.GetValue(0)
+
+			if gem_stone_vnum != item.ITEM_VNUM_GEM_STONE:
+				return False
+
+			if gem_stone_count < need_gem_stone_count:
+				return False
+
+			return True
+
+		def __UseGemConverter(self, src_item_window, src_item_pos, dst_item_window, dst_item_pos):
+			if self.gem_converter_question_dialog:
+				return
+
+			self.gem_converter_item_pos = (src_item_pos, dst_item_pos)
+
+			self.SetCantMouseEventSlot(src_item_pos)
+			self.SetCantMouseEventSlot(dst_item_pos)
+
+			question_dialog = uiCommon.QuestionDialog()
+			question_dialog.SetText(localeInfo.GEM_CONVERTER_MESSAGE_USE_CONVERTER_QUESTION)
+			question_dialog.SetAcceptEvent(ui.__mem_func__(self.__AcceptGemConverterUse))
+			question_dialog.SetCancelEvent(ui.__mem_func__(self.__CancelGemConverterUse))
+			question_dialog.Open()
+			question_dialog.srcItemWindow = src_item_window
+			question_dialog.srcItemPos = src_item_pos
+			question_dialog.dstItemWindow = dst_item_window
+			question_dialog.dstItemPos = dst_item_pos
+			self.gem_converter_question_dialog = question_dialog
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(1)
+
+		def __AcceptGemConverterUse(self):
+			if not self.gem_converter_question_dialog:
+				return
+
+			gem_conv_vnum = player.GetItemIndex(self.gem_converter_question_dialog.srcItemWindow, self.gem_converter_question_dialog.srcItemPos)
+			gem_conv_count = player.GetItemCount(self.gem_converter_question_dialog.srcItemWindow, self.gem_converter_question_dialog.srcItemPos)
+			gem_stone_count = player.GetItemCount(self.gem_converter_question_dialog.dstItemWindow, self.gem_converter_question_dialog.dstItemPos)
+
+			item.SelectItem(gem_conv_vnum)
+			need_gem_stone_count = gem_conv_count * item.GetValue(0)
+			conv_to_gem = need_gem_stone_count / item.GetValue(0)
+			conv_cost = gem_conv_count * item.GetValue(1)
+
+			if gem_stone_count < need_gem_stone_count:
+				self.__CancelGemConverterUse()
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_NOT_ENOUGH_GEMSTONE % localeInfo.NumberToMoneyString(need_gem_stone_count))
+				return
+
+			if player.GetElk() < conv_cost:
+				self.__CancelGemConverterUse()
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_NOT_ENOUGH_GOLD)
+				return
+
+			if player.GetGem() + conv_to_gem >= player.GEM_MAX:
+				self.__CancelGemConverterUse()
+				chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_GEM_MAX)
+				return
+
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_CONVERT_SUCCESS_GEM_STONE % gem_conv_count)
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.GEM_CONVERTER_MESSAGE_CONVERT_SUCCESS_CONVERTER % need_gem_stone_count)
+
+			self.__SendUseItemToItemPacket(\
+				self.gem_converter_question_dialog.srcItemWindow,\
+				self.gem_converter_question_dialog.srcItemPos,\
+				self.gem_converter_question_dialog.dstItemWindow,\
+				self.gem_converter_question_dialog.dstItemPos)
+
+			self.__CancelGemConverterUse()
+
+		def __CancelGemConverterUse(self):
+			for i in self.gem_converter_item_pos:
+				self.SetCanMouseEventSlot(i)
+			self.gem_converter_item_pos = [-1, -1]
+
+			self.__CloseGemConverterUseQuestionDialog()
+
+		def __CloseGemConverterUseQuestionDialog(self):
+			if self.gem_converter_question_dialog:
+				self.gem_converter_question_dialog.Close()
+			self.gem_converter_question_dialog = None
+			constInfo.SET_ITEM_QUESTION_DIALOG_STATUS(0)
+
+	def __UseItemQuestionDialog_OnCancel(self):
+		self.OnCloseQuestionDialog()
+
+	def __UseItemQuestionDialog_OnAccept(self):
+		self.__SendUseItemPacket(self.questionDialog.slotIndex)
+		self.OnCloseQuestionDialog()
+
+	def __SendUseItemToItemPacket(self, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):
+		# Î»  Ö´    
+		if uiPrivateShopBuilder.IsBuildingPrivateShop():
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_ITEM_FAILURE_PRIVATE_SHOP)
+			return
+
+		#if self.interface.IsShowDlgQuestionWindow():
+		#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DONT_USE_ITEM_WHEN_SHOW_CONFIRM)
+		#	return
+
+		net.SendItemUseToItemPacket(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos)
+
+	def __SendUseItemPacket(self, slotPos, slotWindow = player.INVENTORY):
+		# Î»  Ö´    
+		if uiPrivateShopBuilder.IsBuildingPrivateShop():
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_ITEM_FAILURE_PRIVATE_SHOP)
+			return
+
+		#if self.interface.IsShowDlgQuestionWindow():
+		#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DONT_USE_ITEM_WHEN_SHOW_CONFIRM)
+		#	return
+
+		net.SendItemUsePacket(slotWindow, slotPos)
+
+	def __SendMoveItemPacket(self, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, srcItemCount):
+		# Î»  Ö´    
+		if uiPrivateShopBuilder.IsBuildingPrivateShop():
+			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.MOVE_ITEM_FAILURE_PRIVATE_SHOP)
+			return
+
+		#if self.interface.IsShowDlgQuestionWindow():
+		#	chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.DONT_USE_ITEM_WHEN_SHOW_CONFIRM)
+		#	return
+
+		net.SendItemMovePacket(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, srcItemCount)
+
+	def SetDragonSoulRefineWindow(self, DragonSoulRefine):
+		from _weakref import proxy
+		self.wndDragonSoulRefine = proxy(DragonSoulRefine)
+
+	def OnMoveWindow(self, x, y):
+		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+			pass
+		else:
+			if self.wndBelt:
+				self.wndBelt.AdjustPosition()
+
+	# Ç¼  ×µÎ¸ ß°, .
+	## HilightSlot Change
+	def DeactivateSlot(self, slotindex, type):
+		if type == wndMgr.HILIGHTSLOT_MAX:
+			return
+
+		if app.ENABLE_ACCE_COSTUME_SYSTEM:
+			if type == wndMgr.HILIGHTSLOT_ACCE:
+				self.__DelHighlightSlotAcce(slotindex)
+
+		if app.ENABLE_CHANGE_LOOK_SYSTEM:
+			if type == wndMgr.HILIGHTSLOT_CHANGE_LOOK:
+				self.__DelHighlightSlotChangeLook(slotindex)
+
+		if app.ENABLE_AURA_COSTUME_SYSTEM:
+			if type == wndMgr.HILIGHTSLOT_AURA:
+				self.__DelHighlightSlotAura(slotindex)
+
+		if app.ENABLE_CUBE_RENEWAL:
+			if type == wndMgr.HILIGHTSLOT_CUBE:
+				self.__DelHighlightSlotCube(slotindex)
+
+	## HilightSlot Change
+	def ActivateSlot(self, slotindex, type):
+		if type == wndMgr.HILIGHTSLOT_MAX:
+			return
+
+		#if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+		#	self.DelHighlightSlot(slotindex)
+
+		if app.ENABLE_ACCE_COSTUME_SYSTEM:
+			if type == wndMgr.HILIGHTSLOT_ACCE:
+				self.__AddHighlightSlotAcce(slotindex)
+
+		if app.ENABLE_CHANGE_LOOK_SYSTEM:
+			if type == wndMgr.HILIGHTSLOT_CHANGE_LOOK:
+				self.__AddHighlightSlotChangeLook(slotindex)
+
+		if app.ENABLE_AURA_COSTUME_SYSTEM:
+			if type == wndMgr.HILIGHTSLOT_AURA:
+				self.__AddHighlightSlotAura(slotindex)
+
+		if app.ENABLE_CUBE_RENEWAL:
+			if type == wndMgr.HILIGHTSLOT_CUBE:
+				self.__AddHighlightSlotCube(slotindex)
+
+	if app.ENABLE_ACCE_COSTUME_SYSTEM:
+		## Ç¼  Ì¶Æ® list ß°.
+		def __AddHighlightSlotAcce(self, slotIndex):
+			if not slotIndex in self.listHighlightedAcceSlot:
+				self.listHighlightedAcceSlot.append(slotIndex)
+
+		## Ç¼  Ì¶Æ® list .
+		def __DelHighlightSlotAcce(self, slotIndex):
+			if slotIndex in self.listHighlightedAcceSlot:
+				if slotIndex >= player.INVENTORY_PAGE_SIZE:
+					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+					self.wndItem.SetCanMouseEventSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+				else:
+					self.wndItem.DeactivateSlot(slotIndex)
+					self.wndItem.SetCanMouseEventSlot(slotIndex)
+
+				self.listHighlightedAcceSlot.remove(slotIndex)
+
+	if app.ENABLE_CHANGE_LOOK_SYSTEM:
+		def __AddHighlightSlotChangeLook(self, slotIndex):
+			if not slotIndex in self.listHighlightedChangeLookSlot:
+				self.listHighlightedChangeLookSlot.append(slotIndex)
+
+		def __DelHighlightSlotChangeLook(self, slotIndex):
+			if slotIndex in self.listHighlightedChangeLookSlot:
+				if slotIndex >= player.INVENTORY_PAGE_SIZE:
+					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+					self.wndItem.SetCanMouseEventSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+				else:
+					self.wndItem.DeactivateSlot(slotIndex)
+					self.wndItem.SetCanMouseEventSlot(slotIndex)
+				self.listHighlightedChangeLookSlot.remove(slotIndex)
+
+	if app.ENABLE_CUBE_RENEWAL:
+		def __AddHighlightSlotCube(self, slotIndex):
+			if not slotIndex in self.listHighlightedCubeSlot:
+				self.listHighlightedCubeSlot.append(slotIndex)
+
+		def __DelHighlightSlotCube(self, slotIndex):
+			if slotIndex in self.listHighlightedCubeSlot:
+				if slotIndex >= player.INVENTORY_PAGE_SIZE:
+					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+				else:
+					self.wndItem.DeactivateSlot(slotIndex)
+				self.listHighlightedCubeSlot.remove(slotIndex)
+
+	if app.ENABLE_AURA_COSTUME_SYSTEM:
+		def __AddHighlightSlotAura(self, slotIndex):
+			if not slotIndex in self.listHighlightedAuraSlot:
+				self.listHighlightedAuraSlot.append(slotIndex)
+
+		def __DelHighlightSlotAura(self, slotIndex):
+			if slotIndex in self.listHighlightedAuraSlot:
+				if slotIndex >= player.INVENTORY_PAGE_SIZE:
+					self.wndItem.DeactivateSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+					self.wndItem.SetCanMouseEventSlot(slotIndex - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+				else:
+					self.wndItem.DeactivateSlot(slotIndex)
+					self.wndItem.SetCanMouseEventSlot(slotIndex)
+				self.listHighlightedAuraSlot.remove(slotIndex)
+
+	## Ì¶Æ® .
+	def __HighlightSlot_Refresh(self):
+		## Ç¼.
+		for i in xrange(self.wndItem.GetSlotCount()):
+			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if slotNumber in self.listHighlightedAcceSlot:
+					self.wndItem.ActivateSlot(i)
+					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_GREEN)
+					self.wndItem.SetCantMouseEventSlot(i)
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if slotNumber in self.listHighlightedChangeLookSlot:
+					self.wndItem.ActivateSlot(i)
+					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_RED)
+					self.wndItem.SetCantMouseEventSlot(i)
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if slotNumber in self.listHighlightedAuraSlot:
+					self.wndItem.ActivateSlot(i)
+					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_GREEN)
+					self.wndItem.SetCantMouseEventSlot(i)
+
+			if app.ENABLE_CUBE_RENEWAL:
+				if slotNumber in self.listHighlightedCubeSlot:
+					self.wndItem.ActivateSlot(i)
+					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_RED)
+
+			## HilightSlot Change
+			if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+				if slotNumber in self.listHighlightedSlot:
+					self.wndItem.ActivateSlot(i)
+					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_MAX)
+
+	## Ç¼  Ì¶Æ® list Å¬.
+	def __HighlightSlot_Clear(self):
+		## Ç¼
+		for i in xrange(self.wndItem.GetSlotCount()):
+			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)
+
+			if app.ENABLE_ACCE_COSTUME_SYSTEM:
+				if slotNumber in self.listHighlightedAcceSlot:
+					self.wndItem.DeactivateSlot(i)
+					self.wndItem.SetCanMouseEventSlot(i)
+					self.listHighlightedAcceSlot.remove(slotNumber)
+
+			if app.ENABLE_CHANGE_LOOK_SYSTEM:
+				if slotNumber in self.listHighlightedChangeLookSlot:
+					self.wndItem.DeactivateSlot(i)
+					self.wndItem.SetCanMouseEventSlot(i)
+					self.listHighlightedChangeLookSlot.remove(slotNumber)
+
+			if app.ENABLE_AURA_COSTUME_SYSTEM:
+				if slotNumber in self.listHighlightedAuraSlot:
+					self.wndItem.DeactivateSlot(i)
+					self.wndItem.SetCanMouseEventSlot(i)
+					self.listHighlightedAuraSlot.remove(slotNumber)
+
+			if app.ENABLE_CUBE_RENEWAL:
+				if slotNumber in self.listHighlightedCubeSlot:
+					self.wndItem.DeactivateSlot(i)
+					self.listHighlightedCubeSlot.remove(slotNumber)
+
+			## HilightSlot Change
+			if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+				if slotNumber in self.listHighlightedSlot:
+					self.wndItem.DeactivateSlot(i)
+					self.listHighlightedSlot.remove(slotNumber)
+
+	if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:
+		#  highlight 
+		## ß°
+		def HighlightSlot(self, slot):
+			#slot  Ã³.
+			if slot > player.INVENTORY_PAGE_SIZE * player.INVENTORY_PAGE_COUNT:
+				return
+
+			if not slot in self.listHighlightedSlot:
+				self.listHighlightedSlot.append(slot)
+
+		## 
+		def DelHighlightSlot(self, inventorylocalslot):
+			if inventorylocalslot in self.listHighlightedSlot:
+				if inventorylocalslot >= player.INVENTORY_PAGE_SIZE:
+					self.wndItem.DeactivateSlot(inventorylocalslot - (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE))
+				else:
+					self.wndItem.DeactivateSlot(inventorylocalslot)
+
+				self.listHighlightedSlot.remove(inventorylocalslot)
+
+		#  highlight  
+
+	# wj.2014.12.2. Îºä¸® DSÎº  Â¸ È®  Ï±  Ô¼.
+	def IsDlgQuestionShow(self):
+		if self.dlgQuestion.IsShow():
+			return True
+		else:
+			return False
+
+	def CancelDlgQuestion(self):
+		self.__Cancel()
+
+	def SetUseItemMode(self, bUse):
+		self.wndItem.SetUseMode(bUse)
+
+	if app.ENABLE_MOVE_COSTUME_ATTR or app.ENABLE_CHEQUE_SYSTEM or app.ENABLE_ATTR_6TH_7TH:
+		def GetInventoryPageIndex(self):
+			## 0 or 1
+			return self.inventoryPageIndex
+
+	if app.ENABLE_GROWTH_PET_SYSTEM:
+		def __UseItemPet(self, slotIndex):
+			itemSubType = item.GetItemSubType()		
+			if item.PET_EGG == itemSubType:
+				self.petHatchingWindow.HatchingWindowOpen(player.INVENTORY, slotIndex)
+				
+			elif item.PET_UPBRINGING == itemSubType:
+				if self.__CanUseGrowthPet(slotIndex):
+					self.__SendUseItemPacket(slotIndex)
+						
+			elif item.PET_BAG == itemSubType:
+				if self.__CanUsePetBagItem(slotIndex):
+					if self.questionDialog:
+						self.questionDialog.Close()
+						
+					self.questionDialog = uiCommon.QuestionDialog()
+					self.questionDialog.SetText(localeInfo.INVENTORY_REALLY_USE_PET_BAG_TAKE_OUT)
+					self.questionDialog.SetAcceptEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnAccept))
+					self.questionDialog.SetCancelEvent(ui.__mem_func__(self.__UseItemQuestionDialog_OnCancel))
+					self.questionDialog.slotIndex = slotIndex
+					self.questionDialog.Open()
+
+			if item.PET_SKILL_ALL_DEL_BOOK == itemSubType:
+				pet_id = player.GetActivePetItemId()
+				if 0 == pet_id:
+					return
+				(skill_count, pet_skill1, pet_skill_level1, pet_skill_cool1, pet_skill2, pet_skill_level2, pet_skill_cool2, pet_skill3, pet_skill_level3, pet_skill_cool3) = player.GetPetSkill(pet_id)
+				if 0 == pet_skill1 and 0 == pet_skill2 and 0 == pet_skill3:
+					popup = uiCommon.PopupDialog()
+					popup.SetText(localeInfo.PET_EMPTY_SKILL_SLOT_USE_ITEM)
+					popup.SetAcceptEvent(self.__OnClosePopupDialog)
+					popup.Open()
+					self.pop = popup
+					return
+			
+				self.PetSkillAllDelBookIndex = slotIndex
+				self.SetCantMouseEventSlot( self.PetSkillAllDelBookIndex )
+				
+				self.PetSkillDelDlg.SetAcceptEvent(ui.__mem_func__(self.__PetSkillDeleteQuestionDialogAccept))
+				self.PetSkillDelDlg.SetCancelEvent(ui.__mem_func__(self.__PetSkillDeleteQuestionDialogCancel))
+				
+				self.PetSkillDelDlg.SetText1( localeInfo.PET_SKILL_DELETE_QUESTION_DLG_MSG1 )
+				self.PetSkillDelDlg.SetText2( localeInfo.PET_SKILL_DELETE_QUESTION_DLG_MSG2 )
+				(w,h) = self.PetSkillDelDlg.GetTextSize1()
+				self.PetSkillDelDlg.SetWidth(w+100)
+				self.PetSkillDelDlg.Open()
+				
+		def __OnClosePopupDialog(self):
+			self.pop = None
+
+		def __ActivePetHighlightSlot(self, slotNumber):
+			active_id = player.GetActivePetItemId()
+			
+			if active_id == player.GetItemMetinSocket(player.INVENTORY, slotNumber, 2):
+				
+				if slotNumber >= player.INVENTORY_PAGE_SIZE:
+					slotNumber -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
+			
+				self.wndItem.ActivateSlot(slotNumber)
+			else:
+				if slotNumber >= player.INVENTORY_PAGE_SIZE:
+					slotNumber -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
+					
+				self.wndItem.DeactivateSlot(slotNumber)
+
+		def __SetCoolTimePetItemSlot(self, slotNumber, itemVnum):
+		
+			item.SelectItem(itemVnum)
+			itemSubType = item.GetItemSubType()
+		
+			if itemSubType not in [item.PET_UPBRINGING, item.PET_BAG]:
+				return
+				
+			if itemSubType == item.PET_BAG:
+				id = player.GetItemMetinSocket(player.INVENTORY, slotNumber, 2)
+				if id == 0:
+					return
+			
+			(limitType, limitValue) = item.GetLimit(0)
+
+			if itemSubType == item.PET_UPBRINGING:
+				limitValue = player.GetItemMetinSocket(player.INVENTORY, slotNumber, 1)
+					
+			if limitType in [item.LIMIT_REAL_TIME, item.LIMIT_REAL_TIME_START_FIRST_USE]:
+								
+				sock_time   = player.GetItemMetinSocket(player.INVENTORY, slotNumber, 0)
+				
+				remain_time = max(0, sock_time - app.GetGlobalTimeStamp())
+			
+				if slotNumber >= player.INVENTORY_PAGE_SIZE:
+					slotNumber -= (self.inventoryPageIndex * player.INVENTORY_PAGE_SIZE)
+
+				self.wndItem.SetSlotCoolTimeInverse(slotNumber, limitValue, limitValue - remain_time)
+
+		def __IsPetItem(self, srcItemVID):
+			item.SelectItem(srcItemVID)
+			
+			if item.GetItemType() == item.ITEM_TYPE_PET:
+				return True
+			
+			return False
+
+		def __SendUsePetItemToItemPacket(self, srcItemVID, srcItemSlotPos, dstItemSlotPos):
+			if self.__CanUseSrcPetItemToDstPetItem(srcItemVID, srcItemSlotPos, dstItemSlotPos):
+				srcItemVnum		= player.GetItemIndex(srcItemSlotPos)
+				item.SelectItem( srcItemVnum )
+				srcItemType		= item.GetItemType()
+				srcItemSubType	= item.GetItemSubType()
+				
+				if item.ITEM_TYPE_PET == srcItemType:					
+					if srcItemSubType in [item.PET_FEEDSTUFF, item.PET_BAG]:
+						self.__OpenPetItemQuestionDialog(srcItemSlotPos, dstItemSlotPos)
+					elif item.PET_NAME_CHANGE == srcItemSubType:
+						self.__UseItemPetNameChange(srcItemSlotPos, dstItemSlotPos)
+				return True
+				
+			return False
+			
+		def __UseItemPetNameChange(self, srcSlotPos, dstSlotPos):
+			if self.petNameChangeWindow:
+				self.petNameChangeWindow.NameChangeWindowOpen(srcSlotPos, dstSlotPos)
+
+		def __IsUsablePetItem(self, srcItemVNum):
+			item.SelectItem(srcItemVNum)
+			srcItemType		= item.GetItemType()
+			srcItemSubType	= item.GetItemSubType()
+
+			if srcItemType != item.ITEM_TYPE_PET:
+				return False
+			
+			if srcItemSubType not in [item.PET_UPBRINGING, item.PET_FEEDSTUFF, item.PET_BAG, item.PET_NAME_CHANGE]:
+				return False
+			
+			return True
+
+		def __CanUseSrcPetItemToDstPetItem(self, srcItemVNum, srcSlotPos, dstSlotPos):
+			item.SelectItem(srcItemVNum)
+			srcItemType		= item.GetItemType()
+			srcItemSubType	= item.GetItemSubType()
+			
+			if srcItemType != item.ITEM_TYPE_PET:
+				return False
+			
+			if srcItemSubType == item.PET_FEEDSTUFF:		
+				detIndex = player.GetItemIndex(dstSlotPos)
+				item.SelectItem(detIndex)
+				
+				dstItemType		= item.GetItemType()
+				dstItemSubType	= item.GetItemSubType()
+				
+				if dstItemType != item.ITEM_TYPE_PET:
+					return False
+					
+				if dstItemSubType not in [item.PET_UPBRINGING]:
+					return False
+					
+				if dstItemSubType == item.PET_BAG:
+					incaseTime = player.GetItemMetinSocket(dstSlotPos, 1)
+					if incaseTime == 0:
+						return False
+			
+			elif srcItemSubType == item.PET_BAG:
+				detIndex = player.GetItemIndex(dstSlotPos)
+				item.SelectItem(detIndex)
+				
+				dstItemType		= item.GetItemType()
+				dstItemSubType	= item.GetItemSubType()
+				
+				if dstItemType != item.ITEM_TYPE_PET:
+					return False
+					
+				if dstItemSubType not in [item.PET_UPBRINGING, item.PET_BAG]:
+					return False
+			
+				lifeTime = player.GetItemMetinSocket(dstSlotPos, 0)
+					
+				if dstItemSubType == item.PET_UPBRINGING:
+					if lifeTime < app.GetGlobalTimeStamp():
+						return False
+
+					srcIncase = player.GetItemMetinSocket(srcSlotPos, 1)
+					if srcIncase != 0:
+						return False
+					
+				elif dstItemSubType == item.PET_BAG:
+					if lifeTime > app.GetGlobalTimeStamp():
+						return False
+						
+					srcIncase = player.GetItemMetinSocket(srcSlotPos, 1)
+					if srcIncase != 0:
+						return False
+					
+					destIncase = player.GetItemMetinSocket(dstSlotPos, 1)
+					if destIncase == 0:
+						return False
+						
+			elif srcItemSubType == item.PET_NAME_CHANGE:
+				detIndex = player.GetItemIndex(dstSlotPos)
+				item.SelectItem(detIndex)
+				
+				dstItemType		= item.GetItemType()
+				dstItemSubType	= item.GetItemSubType()
+				
+				if dstItemType != item.ITEM_TYPE_PET:
+					return False
+					
+				if dstItemSubType not in [item.PET_UPBRINGING]:
+					return False
+					
+			else:
+				return False
+			
+			return True
+
+		def __CanUseGrowthPet(self, slotIndex):
+			if not player.GetItemMetinSocket(player.INVENTORY, slotIndex, 2):
+				return False
+				
+			(limitType, limitValue) = item.GetLimit(0)
+			remain_time = 999
+			if item.LIMIT_REAL_TIME == limitType:
+				sock_time   = player.GetItemMetinSocket(player.INVENTORY, slotIndex, 0)
+				if app.GetGlobalTimeStamp() > sock_time:
+					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.PET_CAN_NOT_SUMMON_BECAUSE_LIFE_TIME_END)
+					return False
+					
+			return True
+
+		def __CanUsePetBagItem(self, slotIndex):
+			if not player.GetItemMetinSocket(player.INVENTORY, slotIndex, 2):
+				return False
+				
+			(limitType, limitValue) = item.GetLimit(0)
+			remain_time = 999
+			if item.LIMIT_REAL_TIME_START_FIRST_USE == limitType:
+				sock_time   = player.GetItemMetinSocket(player.INVENTORY, slotIndex, 0)
+				use_cnt	    = player.GetItemMetinSocket(player.INVENTORY, slotIndex, 1)
+				
+				if use_cnt:
+					if app.GetGlobalTimeStamp() > sock_time:
+						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.PET_CAN_NOT_USE_BAG)
+						return False;
+						
+			return True
+
+		def __CanAttachGrowthPetItem(self, itemVNum, itemSlotIndex):
+			activePetId = player.GetActivePetItemId()
+			if activePetId == 0:
+				return True
+			
+			item.SelectItem(itemVNum)
+			itemType	= item.GetItemType()
+			itemSubType = item.GetItemSubType()
+			
+			if item.ITEM_TYPE_PET == itemType and itemSubType == item.PET_UPBRINGING:
+				petId = player.GetItemMetinSocket(itemSlotIndex, 2)
+				if petId == activePetId:
+					return False
+					
+					
+			return True
+
+		def SetPetHatchingWindow(self, window):
+			self.petHatchingWindow = window
+
+		def SetPetNameChangeWindow(self, window):
+			self.petNameChangeWindow = window
+
+		def SetPetFeedWindow(self, window):
+			self.petFeedWindow = window
+
+		def ItemMoveFeedWindow(self, slotWindow, slotIndex):
+			if not self.petFeedWindow:
+				return
+				
+			self.petFeedWindow.ItemMoveFeedWindow(slotWindow, slotIndex)
+
+		def __OpenPetBagQuestionDialog(self, srcItemSlotPos, dstItemSlotPos):
+			if self.interface.IsShowDlgQuestionWindow():
+				self.interface.CloseDlgQuestionWindow()
+
+		def __OpenPetItemQuestionDialog(self, srcItemPos, dstItemPos):
+			if self.interface.IsShowDlgQuestionWindow():
+				self.interface.CloseDlgQuestionWindow()
+			
+			getItemVNum=player.GetItemIndex
+			self.srcItemPos = srcItemPos
+			self.dstItemPos = dstItemPos
+
+			srcItemVnum = getItemVNum(srcItemPos)
+			dstItemVnum = getItemVNum(dstItemPos)
+			
+			item.SelectItem( srcItemVnum )
+			src_item_name = item.GetItemName( srcItemVnum )
+			srcItemType		= item.GetItemType()
+			srcItemSubType	= item.GetItemSubType()
+			
+			item.SelectItem( dstItemVnum )
+			dst_item_name = item.GetItemName( getItemVNum(dstItemPos) )
+			
+			self.PetItemQuestionDlg.SetAcceptEvent(ui.__mem_func__(self.__PetItemAccept))
+			self.PetItemQuestionDlg.SetCancelEvent(ui.__mem_func__(self.__PetItemCancel))
+			
+			if item.ITEM_TYPE_PET == srcItemType:
+				if item.PET_FEEDSTUFF == srcItemSubType:
+					self.PetItemQuestionDlg.SetText( localeInfo.INVENTORY_REALLY_USE_PET_FEEDSTUFF_ITEM % ( src_item_name, dst_item_name ) )
+					self.PetItemQuestionDlg.Open()
+				
+				elif item.PET_BAG == srcItemSubType:
+					self.PetItemQuestionDlg.SetText( localeInfo.INVENTORY_REALLY_USE_PET_BAG_ITEM )
+					self.PetItemQuestionDlg.Open()
+				
+		def __PetItemAccept(self):
+			self.PetItemQuestionDlg.Close()
+			self.__SendUseItemToItemPacket(self.srcItemPos, self.dstItemPos)
+			self.srcItemPos = (0, 0)
+			self.dstItemPos = (0, 0)
+			self.srcItemWindow = None
+			self.dstItemWindow = None
+
+		def __PetItemCancel(self):
+			self.srcItemPos = (0, 0)
+			self.dstItemPos = (0, 0)
+			self.PetItemQuestionDlg.Close()
+
+		def __PetSkillDeleteQuestionDialogAccept(self):
+			net.SendPetDeleteAllSkill( self.PetSkillAllDelBookIndex )	
+			self.__PetSkillDeleteQuestionDialogCancel()
+			
+		def __PetSkillDeleteQuestionDialogCancel(self):
+			self.PetSkillDelDlg.Close()
+			self.SetCanMouseEventSlot( self.PetSkillAllDelBookIndex )
+			self.PetSkillAllDelBookIndex = -1
+			
+		def SetCanMouseEventSlot(self, inven_slot_index):
+			if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
+				page = self.GetInventoryPageIndex() # range 0,1,2,3
+				inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
+			self.wndItem.SetCanMouseEventSlot(inven_slot_index)
+			
+		def SetCantMouseEventSlot(self, inven_slot_index):
+			if inven_slot_index >= player.INVENTORY_PAGE_SIZE:
+				page = self.GetInventoryPageIndex() # range 0,1,2,3
+				inven_slot_index -= (page * player.INVENTORY_PAGE_SIZE)
+			self.wndItem.SetCantMouseEventSlot(inven_slot_index)
+
+	if app.ENABLE_CHEQUE_SYSTEM:
+		def OverInToolTip(self, arg) :
+			arglen = len(str(arg))
+			pos_x, pos_y = wndMgr.GetMousePosition()
+
+			self.toolTip.ClearToolTip()
+			self.toolTip.SetThinBoardSize(11 * arglen)
+			self.toolTip.SetToolTipPosition(pos_x + 5, pos_y - 5)
+			self.toolTip.AppendTextLine(arg, 0xffffff00)
+			self.toolTip.Show()
+
+		def OverOutToolTip(self) :
+			self.toolTip.Hide()
+
+		def EventProgress(self, event_type, idx):
+			if "mouse_over_in" == str(event_type):
+				if idx == 0:
+					self.OverInToolTip(localeInfo.CHEQUE_SYSTEM_UNIT_YANG)
+				elif idx == 1:
+					self.OverInToolTip(localeInfo.CHEQUE_SYSTEM_UNIT_WON)
+				elif app.ENABLE_GEM_SYSTEM and idx == 2:
+					self.OverInToolTip(localeInfo.GEM_SYSTEM_NAME)
+				else:
+					return
+			elif "mouse_over_out" == str(event_type):
+				self.OverOutToolTip()
+			else:
+				return
+
+	if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+		def BindEquipmentWindow(self, equipment_window):
+			self.wndEquipment = equipment_window
+
+	def UseInventoryItemInQuickSlot(self, global_slot_index):
+		self.__UseItem(global_slot_index, player.INVENTORY)
+
+	if app.ENABLE_HIDE_COSTUME_SYSTEM:
+		def SetHiddenCostumePart(self, part, hidden):
+			if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:
+				if self.wndEquipment:
+					self.wndEquipment.SetHiddenCostumePart(part, hidden)
+			else:
+				if self.wndCostume:
+					self.wndCostume.SetHiddenCostumePart(part, hidden)
diff --git a/client/pack/root/uipopupnotice.py b/client/pack/root/uipopupnotice.py
index 91829c5..cbfeb7a 100644
--- a/client/pack/root/uipopupnotice.py
+++ b/client/pack/root/uipopupnotice.py
@@ -1,164 +1,176 @@
-import app
-import net
-import player
-import ui
-import localeInfo
-
-class PopupNoticeWindow(ui.ScriptWindow):
-	def __init__(self):
-		ui.ScriptWindow.__init__(self)
-
-		self.title_bar = None
-		self.title_name = None
-		self.checkbox = None
-		self.check_image = None
-		self.web_box = None
-
-		self.url = None
-		self.popup_event_flag_value = 0
-		self.is_not_show_checked = 0
-		self.is_hide_when_quest_open = 0
-
-		self.prev_pos = None
-
-		self.interface = None
-		self.game_button_window = None
-
-	def __del__(self):
-		ui.ScriptWindow.__del__(self)
-
-	def LoadWindow(self):
-		try:
-			PythonScriptLoader = ui.PythonScriptLoader()
-			PythonScriptLoader.LoadScriptFile(self, "UIScript/PopupNoticeWindow.py")
-		except:
-			import exception
-			exception.Abort("PopupNoticeWindow.LoadWindow.LoadObject")
-
-		try:
-			GetObject = self.GetChild
-			self.title_bar = GetObject("TitleBar")
-			self.title_name = GetObject("TitleName")
-			self.checkbox = GetObject("checkbox")
-			self.check_image = GetObject("checkbox_bg")
-			self.web_box = GetObject("webBox")
-		except:
-			import exception
-			exception.Abort("PopupNoticeWindow.LoadWindow.BindObject")
-
-		self.title_bar.SetCloseEvent(ui.__mem_func__(self.__OnCloseButtonClick))
-		self.check_image.SetEvent(ui.__mem_func__(self.__OnClickCheckBox), "mouse_click")
-		self.checkbox.Hide()
-
-	def Destroy(self):
-		app.HideWebPage(app.BROWSER_TYPE_POPUP_NOTICE)
-
-		self.ClearDictionary()
-		self.title_bar = None
-		self.title_name = None
-		self.checkbox = None
-		self.check_image = None
-		self.web_box = None
-
-		self.prev_pos = None
-
-		self.interface = None
-		self.game_button_window = None
-
-	def Refresh(self):
-		pass
-
-	def __OnCloseButtonClick(self):
-		self.Close()
-
-	def Close(self):
-		self.is_hide_when_quest_open = 0
-		net.SendCommandPacket("/popup_notice_check " + str(self.is_not_show_checked))
-
-		app.HideWebPage(app.BROWSER_TYPE_POPUP_NOTICE)
-		self.Hide()
-
-	def OnPressEscapeKey(self):
-		self.Close()
-		return True
-
-	def BindInterface(self, interface):
-		self.interface = interface
-
-	def BindGameButtonWindow(self, game_button_window):
-		self.game_button_window = game_button_window
-
-	def InitWebPage(self):
-		pass
-
-	def __OnClickCheckBox(self, event_type):
-		if "mouse_click" == event_type :
-			if not self.is_not_show_checked:
-				self.is_not_show_checked = 1
-				self.checkbox.Show()
-			else:
-				self.is_not_show_checked = 0
-				self.checkbox.Hide()
-
-	def SetTitle(self, title):
-		self.title_name.SetText(title)
-
-	def SetPopupNoticeEventFlag(self, flag_value):
-		self.popup_event_flag_value = flag_value
-
-		if self.game_button_window:
-			self.game_button_window.CheckGameButton()
-
-	def GetPopupNoticeEventFlagValue(self):
-		return self.popup_event_flag_value
-
-	def PopupNoticeProcess(self, is_checked, url):
-		self.is_not_show_checked = is_checked
-		self.url = url
-
-		if is_checked != True:
-			self.Open(url, is_checked)
-
-	def Open(self, url, is_checked):
-		self.Refresh()
-		self.Show()
-		self.SetCenterPosition()
-
-		if not self.web_box:
-			return
-
-		x, y = self.web_box.GetGlobalPosition()
-		ex, ey = x + self.web_box.GetWidth() + 1, y + self.web_box.GetHeight() + 1
-		app.ShowWebPage(app.BROWSER_TYPE_POPUP_NOTICE, url, (x, y, ex, ey))
-
-		if is_checked:
-			self.checkbox.Show()
-		else:
-			self.checkbox.Hide()
-
-		self.is_hide_when_quest_open = 1
-
-	def OnUpdate(self):
-		if not self.web_box:
-			return
-
-		new_pos = self.web_box.GetGlobalPosition()
-		if new_pos == self.prev_pos:
-			return
-
-		self.prev_pos = new_pos
-
-		x, y = new_pos
-		ex, ey = x + self.web_box.GetWidth() + 1, y + self.web_box.GetHeight() + 1
-		app.MoveWebPage(app.BROWSER_TYPE_POPUP_NOTICE, (x, y, ex, ey))
-
-	def OnClickPopupNoticeUIOpen(self):
-		self.Open(self.url, self.is_not_show_checked)
-
-	def CloseWhenOpenQuest(self):
-		app.HideWebPage(app.BROWSER_TYPE_POPUP_NOTICE)
-		self.Hide()
-
-	def OpenWhenOpenQuest(self):
-		if self.is_hide_when_quest_open:
-			self.OnClickPopupNoticeUIOpen()
+import app
+import net
+import player
+import ui
+import localeInfo
+
+def _IsSafeWebURL(url):
+	if not isinstance(url, str):
+		return False
+	u = url.strip()
+	if not u or len(u) > 2048:
+		return False
+	lu = u.lower()
+	return lu.startswith("http://") or lu.startswith("https://")
+
+class PopupNoticeWindow(ui.ScriptWindow):
+	def __init__(self):
+		ui.ScriptWindow.__init__(self)
+
+		self.title_bar = None
+		self.title_name = None
+		self.checkbox = None
+		self.check_image = None
+		self.web_box = None
+
+		self.url = None
+		self.popup_event_flag_value = 0
+		self.is_not_show_checked = 0
+		self.is_hide_when_quest_open = 0
+
+		self.prev_pos = None
+
+		self.interface = None
+		self.game_button_window = None
+
+	def __del__(self):
+		ui.ScriptWindow.__del__(self)
+
+	def LoadWindow(self):
+		try:
+			PythonScriptLoader = ui.PythonScriptLoader()
+			PythonScriptLoader.LoadScriptFile(self, "UIScript/PopupNoticeWindow.py")
+		except:
+			import exception
+			exception.Abort("PopupNoticeWindow.LoadWindow.LoadObject")
+
+		try:
+			GetObject = self.GetChild
+			self.title_bar = GetObject("TitleBar")
+			self.title_name = GetObject("TitleName")
+			self.checkbox = GetObject("checkbox")
+			self.check_image = GetObject("checkbox_bg")
+			self.web_box = GetObject("webBox")
+		except:
+			import exception
+			exception.Abort("PopupNoticeWindow.LoadWindow.BindObject")
+
+		self.title_bar.SetCloseEvent(ui.__mem_func__(self.__OnCloseButtonClick))
+		self.check_image.SetEvent(ui.__mem_func__(self.__OnClickCheckBox), "mouse_click")
+		self.checkbox.Hide()
+
+	def Destroy(self):
+		app.HideWebPage(app.BROWSER_TYPE_POPUP_NOTICE)
+
+		self.ClearDictionary()
+		self.title_bar = None
+		self.title_name = None
+		self.checkbox = None
+		self.check_image = None
+		self.web_box = None
+
+		self.prev_pos = None
+
+		self.interface = None
+		self.game_button_window = None
+
+	def Refresh(self):
+		pass
+
+	def __OnCloseButtonClick(self):
+		self.Close()
+
+	def Close(self):
+		self.is_hide_when_quest_open = 0
+		net.SendCommandPacket("/popup_notice_check " + str(self.is_not_show_checked))
+
+		app.HideWebPage(app.BROWSER_TYPE_POPUP_NOTICE)
+		self.Hide()
+
+	def OnPressEscapeKey(self):
+		self.Close()
+		return True
+
+	def BindInterface(self, interface):
+		self.interface = interface
+
+	def BindGameButtonWindow(self, game_button_window):
+		self.game_button_window = game_button_window
+
+	def InitWebPage(self):
+		pass
+
+	def __OnClickCheckBox(self, event_type):
+		if "mouse_click" == event_type :
+			if not self.is_not_show_checked:
+				self.is_not_show_checked = 1
+				self.checkbox.Show()
+			else:
+				self.is_not_show_checked = 0
+				self.checkbox.Hide()
+
+	def SetTitle(self, title):
+		self.title_name.SetText(title)
+
+	def SetPopupNoticeEventFlag(self, flag_value):
+		self.popup_event_flag_value = flag_value
+
+		if self.game_button_window:
+			self.game_button_window.CheckGameButton()
+
+	def GetPopupNoticeEventFlagValue(self):
+		return self.popup_event_flag_value
+
+	def PopupNoticeProcess(self, is_checked, url):
+		self.is_not_show_checked = is_checked
+		self.url = url
+
+		if is_checked != True:
+			self.Open(url, is_checked)
+
+	def Open(self, url, is_checked):
+		if not _IsSafeWebURL(url):
+			return
+
+		self.Refresh()
+		self.Show()
+		self.SetCenterPosition()
+
+		if not self.web_box:
+			return
+
+		x, y = self.web_box.GetGlobalPosition()
+		ex, ey = x + self.web_box.GetWidth() + 1, y + self.web_box.GetHeight() + 1
+		app.ShowWebPage(app.BROWSER_TYPE_POPUP_NOTICE, url, (x, y, ex, ey))
+
+		if is_checked:
+			self.checkbox.Show()
+		else:
+			self.checkbox.Hide()
+
+		self.is_hide_when_quest_open = 1
+
+	def OnUpdate(self):
+		if not self.web_box:
+			return
+
+		new_pos = self.web_box.GetGlobalPosition()
+		if new_pos == self.prev_pos:
+			return
+
+		self.prev_pos = new_pos
+
+		x, y = new_pos
+		ex, ey = x + self.web_box.GetWidth() + 1, y + self.web_box.GetHeight() + 1
+		app.MoveWebPage(app.BROWSER_TYPE_POPUP_NOTICE, (x, y, ex, ey))
+
+	def OnClickPopupNoticeUIOpen(self):
+		self.Open(self.url, self.is_not_show_checked)
+
+	def CloseWhenOpenQuest(self):
+		app.HideWebPage(app.BROWSER_TYPE_POPUP_NOTICE)
+		self.Hide()
+
+	def OpenWhenOpenQuest(self):
+		if self.is_hide_when_quest_open:
+			self.OnClickPopupNoticeUIOpen()
diff --git a/client/pack/root/uiscript/inventorywindow.py b/client/pack/root/uiscript/inventorywindow.py
index 5ddc680..dd6a324 100644
--- a/client/pack/root/uiscript/inventorywindow.py
+++ b/client/pack/root/uiscript/inventorywindow.py
@@ -1,261 +1,261 @@
-import uiScriptLocale
-
-EQUIPMENT_START_INDEX = 90
-
-window = {
-	"name" : "InventoryWindow",
-
-	## 600 - (width + ¿À¸¥ÂÊÀ¸·Î ºÎÅÍ ¶ç¿ì±â 24 px)
-	"x" : SCREEN_WIDTH - 176 - 200,
-	"y" : SCREEN_HEIGHT - 37 - 565,
-
-	"style" : ("movable", "float",),
-
-	"width" : 176,
-	"height" : 565,
-
-	"children" :
-	(
-		{
-			"name" : "board",
-			"type" : "board",
-			"style" : ("attach",),
-
-			"x" : 0,
-			"y" : 0,
-
-			"width" : 176,
-			"height" : 565,
-
-			"children" :
-			(
-				## Title
-				{
-					"name" : "TitleBar",
-					"type" : "titlebar",
-					"style" : ("attach",),
-
-					"x" : 8,
-					"y" : 7,
-
-					"width" : 161,
-					"color" : "yellow",
-
-					"children" :
-					(
-						{ "name":"TitleName", "type":"text", "x":77, "y":3, "text":uiScriptLocale.INVENTORY_PAGE_BUTTON_TOOLTIP_2, "text_horizontal_align":"center" },
-					),
-				},
-
-				## Equipment Slot
-				{
-					"name" : "Equipment_Base",
-					"type" : "image",
-
-					"x" : 10,
-					"y" : 33,
-
-					"image" : "d:/ymir work/ui/game/windows/equipment_base.sub",
-
-					"children" :
-					(
-
-						{
-							"name" : "EquipmentSlot",
-							"type" : "slot",
-
-							"x" : 3,
-							"y" : 3,
-
-							"width" : 150,
-							"height" : 182,
-
-							"slot" : (
-										{"index":EQUIPMENT_START_INDEX+0, "x":39, "y":37, "width":32, "height":64},
-										{"index":EQUIPMENT_START_INDEX+1, "x":39, "y":2, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+2, "x":39, "y":145, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+3, "x":75, "y":67, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+4, "x":3, "y":3, "width":32, "height":96},
-										{"index":EQUIPMENT_START_INDEX+5, "x":114, "y":84, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+6, "x":114, "y":52, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+7, "x":2, "y":113, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+8, "x":75, "y":113, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+9, "x":114, "y":1, "width":32, "height":32},
-										{"index":EQUIPMENT_START_INDEX+10, "x":75, "y":35, "width":32, "height":32},
-									),
-						},
-
-						{
-							"name" : "Equipment_Tab_01",
-							"type" : "radio_button",
-
-							"x" : 86,
-							"y" : 161,
-
-							"default_image" : "d:/ymir work/ui/game/windows/tab_button_small_01.sub",
-							"over_image" : "d:/ymir work/ui/game/windows/tab_button_small_02.sub",
-							"down_image" : "d:/ymir work/ui/game/windows/tab_button_small_03.sub",
-
-							"children" :
-							(
-								{
-									"name" : "Equipment_Tab_01_Print",
-									"type" : "text",
-
-									"x" : 0,
-									"y" : 0,
-
-									"all_align" : "center",
-
-									"text" : "I",
-								},
-							),
-						},
-						{
-							"name" : "Equipment_Tab_02",
-							"type" : "radio_button",
-
-							"x" : 86 + 32,
-							"y" : 161,
-
-							"default_image" : "d:/ymir work/ui/game/windows/tab_button_small_01.sub",
-							"over_image" : "d:/ymir work/ui/game/windows/tab_button_small_02.sub",
-							"down_image" : "d:/ymir work/ui/game/windows/tab_button_small_03.sub",
-
-							"children" :
-							(
-								{
-									"name" : "Equipment_Tab_02_Print",
-									"type" : "text",
-
-									"x" : 0,
-									"y" : 0,
-
-									"all_align" : "center",
-
-									"text" : "II",
-								},
-							),
-						},
-
-					),
-				},
-
-				{
-					"name" : "Inventory_Tab_01",
-					"type" : "radio_button",
-
-					"x" : 10,
-					"y" : 33 + 191,
-
-					"default_image" : "d:/ymir work/ui/game/windows/tab_button_large_01.sub",
-					"over_image" : "d:/ymir work/ui/game/windows/tab_button_large_02.sub",
-					"down_image" : "d:/ymir work/ui/game/windows/tab_button_large_03.sub",
-					"tooltip_text" : uiScriptLocale.INVENTORY_PAGE_BUTTON_TOOLTIP_1,
-
-					"children" :
-					(
-						{
-							"name" : "Inventory_Tab_01_Print",
-							"type" : "text",
-
-							"x" : 0,
-							"y" : 0,
-
-							"all_align" : "center",
-
-							"text" : "I",
-						},
-					),
-				},
-				{
-					"name" : "Inventory_Tab_02",
-					"type" : "radio_button",
-
-					"x" : 10 + 78,
-					"y" : 33 + 191,
-
-					"default_image" : "d:/ymir work/ui/game/windows/tab_button_large_01.sub",
-					"over_image" : "d:/ymir work/ui/game/windows/tab_button_large_02.sub",
-					"down_image" : "d:/ymir work/ui/game/windows/tab_button_large_03.sub",
-					"tooltip_text" : uiScriptLocale.INVENTORY_PAGE_BUTTON_TOOLTIP_2,
-
-					"children" :
-					(
-						{
-							"name" : "Inventory_Tab_02_Print",
-							"type" : "text",
-
-							"x" : 0,
-							"y" : 0,
-
-							"all_align" : "center",
-
-							"text" : "II",
-						},
-					),
-				},
-
-				## Item Slot
-				{
-					"name" : "ItemSlot",
-					"type" : "grid_table",
-
-					"x" : 8,
-					"y" : 246,
-
-					"start_index" : 0,
-					"x_count" : 5,
-					"y_count" : 9,
-					"x_step" : 32,
-					"y_step" : 32,
-
-					"image" : "d:/ymir work/ui/public/Slot_Base.sub"
-				},
-
-				## Print
-				{
-					"name":"Money_Slot",
-					"type":"button",
-
-					"x":8,
-					"y":28,
-
-					"horizontal_align":"center",
-					"vertical_align":"bottom",
-
-					"default_image" : "d:/ymir work/ui/public/parameter_slot_05.sub",
-					"over_image" : "d:/ymir work/ui/public/parameter_slot_05.sub",
-					"down_image" : "d:/ymir work/ui/public/parameter_slot_05.sub",
-
-					"children" :
-					(
-						{
-							"name":"Money_Icon",
-							"type":"image",
-
-							"x":-18,
-							"y":20,
-
-							"image":"d:/ymir work/ui/game/windows/money_icon.sub",
-						},
-
-						{
-							"name" : "Money",
-							"type" : "text",
-
-							"x" : 3,
-							"y" : 3,
-
-							"horizontal_align" : "right",
-							"text_horizontal_align" : "right",
-
-							"text" : "123456789",
-						},
-					),
-				},
-
-			),
-		},
-	),
-}
+import uiScriptLocale
+
+EQUIPMENT_START_INDEX = False
+
+window = {
+	"name" : "InventoryWindow",
+
+	## 600 - (width +    24 px)
+	"x" : SCREEN_WIDTH - 176 - 200,
+	"y" : SCREEN_HEIGHT - 37 - 565,
+
+	"style" : ("movable", "float",),
+
+	"width" : 176,
+	"height" : 565,
+
+	"children" :
+	(
+		{
+			"name" : "board",
+			"type" : "board",
+			"style" : ("attach",),
+
+			"x" : 0,
+			"y" : 0,
+
+			"width" : 176,
+			"height" : 565,
+
+			"children" :
+			(
+				## Title
+				{
+					"name" : "TitleBar",
+					"type" : "titlebar",
+					"style" : ("attach",),
+
+					"x" : 8,
+					"y" : 7,
+
+					"width" : 161,
+					"color" : "yellow",
+
+					"children" :
+					(
+						{ "name":"TitleName", "type":"text", "x":77, "y":3, "text":uiScriptLocale.INVENTORY_PAGE_BUTTON_TOOLTIP_2, "text_horizontal_align":"center" },
+					),
+				},
+
+				## Equipment Slot
+				{
+					"name" : "Equipment_Base",
+					"type" : "image",
+
+					"x" : 10,
+					"y" : 33,
+
+					"image" : "d:/ymir work/ui/game/windows/equipment_base.sub",
+
+					"children" :
+					(
+
+						{
+							"name" : "EquipmentSlot",
+							"type" : "slot",
+
+							"x" : 3,
+							"y" : 3,
+
+							"width" : 150,
+							"height" : 182,
+
+							"slot" : (
+										{"index":EQUIPMENT_START_INDEX+0, "x":39, "y":37, "width":32, "height":64},
+										{"index":EQUIPMENT_START_INDEX+1, "x":39, "y":2, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+2, "x":39, "y":145, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+3, "x":75, "y":67, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+4, "x":3, "y":3, "width":32, "height":96},
+										{"index":EQUIPMENT_START_INDEX+5, "x":114, "y":84, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+6, "x":114, "y":52, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+7, "x":2, "y":113, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+8, "x":75, "y":113, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+9, "x":114, "y":1, "width":32, "height":32},
+										{"index":EQUIPMENT_START_INDEX+10, "x":75, "y":35, "width":32, "height":32},
+									),
+						},
+
+						{
+							"name" : "Equipment_Tab_01",
+							"type" : "radio_button",
+
+							"x" : 86,
+							"y" : 161,
+
+							"default_image" : "d:/ymir work/ui/game/windows/tab_button_small_01.sub",
+							"over_image" : "d:/ymir work/ui/game/windows/tab_button_small_02.sub",
+							"down_image" : "d:/ymir work/ui/game/windows/tab_button_small_03.sub",
+
+							"children" :
+							(
+								{
+									"name" : "Equipment_Tab_01_Print",
+									"type" : "text",
+
+									"x" : 0,
+									"y" : 0,
+
+									"all_align" : "center",
+
+									"text" : "I",
+								},
+							),
+						},
+						{
+							"name" : "Equipment_Tab_02",
+							"type" : "radio_button",
+
+							"x" : 86 + 32,
+							"y" : 161,
+
+							"default_image" : "d:/ymir work/ui/game/windows/tab_button_small_01.sub",
+							"over_image" : "d:/ymir work/ui/game/windows/tab_button_small_02.sub",
+							"down_image" : "d:/ymir work/ui/game/windows/tab_button_small_03.sub",
+
+							"children" :
+							(
+								{
+									"name" : "Equipment_Tab_02_Print",
+									"type" : "text",
+
+									"x" : 0,
+									"y" : 0,
+
+									"all_align" : "center",
+
+									"text" : "II",
+								},
+							),
+						},
+
+					),
+				},
+
+				{
+					"name" : "Inventory_Tab_01",
+					"type" : "radio_button",
+
+					"x" : 10,
+					"y" : 33 + 191,
+
+					"default_image" : "d:/ymir work/ui/game/windows/tab_button_large_01.sub",
+					"over_image" : "d:/ymir work/ui/game/windows/tab_button_large_02.sub",
+					"down_image" : "d:/ymir work/ui/game/windows/tab_button_large_03.sub",
+					"tooltip_text" : uiScriptLocale.INVENTORY_PAGE_BUTTON_TOOLTIP_1,
+
+					"children" :
+					(
+						{
+							"name" : "Inventory_Tab_01_Print",
+							"type" : "text",
+
+							"x" : 0,
+							"y" : 0,
+
+							"all_align" : "center",
+
+							"text" : "I",
+						},
+					),
+				},
+				{
+					"name" : "Inventory_Tab_02",
+					"type" : "radio_button",
+
+					"x" : 10 + 78,
+					"y" : 33 + 191,
+
+					"default_image" : "d:/ymir work/ui/game/windows/tab_button_large_01.sub",
+					"over_image" : "d:/ymir work/ui/game/windows/tab_button_large_02.sub",
+					"down_image" : "d:/ymir work/ui/game/windows/tab_button_large_03.sub",
+					"tooltip_text" : uiScriptLocale.INVENTORY_PAGE_BUTTON_TOOLTIP_2,
+
+					"children" :
+					(
+						{
+							"name" : "Inventory_Tab_02_Print",
+							"type" : "text",
+
+							"x" : 0,
+							"y" : 0,
+
+							"all_align" : "center",
+
+							"text" : "II",
+						},
+					),
+				},
+
+				## Item Slot
+				{
+					"name" : "ItemSlot",
+					"type" : "grid_table",
+
+					"x" : 8,
+					"y" : 246,
+
+					"start_index" : 0,
+					"x_count" : 5,
+					"y_count" : 9,
+					"x_step" : 32,
+					"y_step" : 32,
+
+					"image" : "d:/ymir work/ui/public/Slot_Base.sub"
+				},
+
+				## Print
+				{
+					"name":"Money_Slot",
+					"type":"button",
+
+					"x":8,
+					"y":28,
+
+					"horizontal_align":"center",
+					"vertical_align":"bottom",
+
+					"default_image" : "d:/ymir work/ui/public/parameter_slot_05.sub",
+					"over_image" : "d:/ymir work/ui/public/parameter_slot_05.sub",
+					"down_image" : "d:/ymir work/ui/public/parameter_slot_05.sub",
+
+					"children" :
+					(
+						{
+							"name":"Money_Icon",
+							"type":"image",
+
+							"x":-18,
+							"y":20,
+
+							"image":"d:/ymir work/ui/game/windows/money_icon.sub",
+						},
+
+						{
+							"name" : "Money",
+							"type" : "text",
+
+							"x" : 3,
+							"y" : 3,
+
+							"horizontal_align" : "right",
+							"text_horizontal_align" : "right",
+
+							"text" : "123456789",
+						},
+					),
+				},
+
+			),
+		},
+	),
+}
diff --git a/client/pack/root/uiweb.py b/client/pack/root/uiweb.py
index 594c3c1..2e25e12 100644
--- a/client/pack/root/uiweb.py
+++ b/client/pack/root/uiweb.py
@@ -1,141 +1,153 @@
-import ui
-import uiScriptLocale
-import net
-import snd
-import app
-import mouseModule
-import constInfo
-
-class WebWindow(ui.ScriptWindow):
-	def __init__(self):
-		ui.ScriptWindow.__init__(self, "TOP_MOST")
-
-		self.oldPos = None
-		self.IsShowWindowValue = False
-
-	def __del__(self):
-		ui.ScriptWindow.__del__(self)
-
-	def LoadWindow(self):
-		try:
-			pyScrLoader = ui.PythonScriptLoader()
-			if constInfo.IN_GAME_SHOP_ENABLE:
-				pyScrLoader.LoadScriptFile(self, uiScriptLocale.LOCALE_COMMON_UISCRIPT_PATH + "WebWindow.py")
-			else:
-				pyScrLoader.LoadScriptFile(self, "UIScript/WebWindow.py")
-		except:
-			import exception
-			exception.Abort("WebWindow.LoadDialog.LoadScript")
-
-		try:
-			GetObject=self.GetChild
-			self.titleBar = GetObject("TitleBar")
-		except:
-			import exception
-			exception.Abort("WebWindow.LoadDialog.BindObject")
-
-		self.titleBar.SetCloseEvent(ui.__mem_func__(self.__OnCloseButtonClick))
-
-	def Destroy(self):
-		app.HideWebPage(app.BROWSER_TYPE_ITEM_MALL)
-		self.ClearDictionary()
-		self.titleBar = None
-
-	def Open(self, url):
-		self.Refresh()
-		self.Show()
-		self.SetCenterPosition()
-
-		x, y = self.GetGlobalPosition()
-		sx, sy = x + 10, y + 30
-		ex, ey = sx + self.GetWidth() - 20, sy + self.GetHeight() - 40
-
-		app.ShowWebPage(app.BROWSER_TYPE_ITEM_MALL, url, (sx, sy, ex, ey))
-		self.IsShowWindowValue = True
-
-	def Close(self):
-		app.HideWebPage(app.BROWSER_TYPE_ITEM_MALL)
-		self.Hide()
-		self.IsShowWindowValue = False
-
-	def CloseWhenOpenQuest(self):
-		app.HideWebPage(app.BROWSER_TYPE_ITEM_MALL)
-		self.Hide()
-
-	def OpenWhenOpenQuest(self):
-		if self.IsShowWindowValue:
-			net.SendCommandPacket("/in_game_mall")
-
-	def Clear(self):
-		self.Refresh()
-
-	def SetTitle(self, title):
-		self.TitleName.SetText(title)
-
-	def Refresh(self):
-		pass
-
-	def __OnCloseButtonClick(self):
-		print "close_web:click_close_button"
-		self.Close()
-
-	def OnPressEscapeKey(self):
-		print "close_web:esc_key"
-		self.Close()
-		return True
-
-	def OnUpdate(self):
-		newPos = self.GetGlobalPosition()
-		if newPos == self.oldPos:
-			return
-
-		self.oldPos = newPos
-
-		x, y = newPos
-		sx, sy = x + 10, y + 30
-		ex, ey = sx + self.GetWidth() - 20, sy + self.GetHeight() - 40
-		app.MoveWebPage(app.BROWSER_TYPE_ITEM_MALL, (sx, sy, ex, ey))
-
-if __name__ == "__main__":
-	import app
-	import wndMgr
-	import systemSetting
-	import mouseModule
-	import grp
-	import ui
-	import uiToolTip
-	import localeInfo
-
-	app.SetMouseHandler(mouseModule.mouseController)
-	app.SetHairColorEnable(True)
-	wndMgr.SetMouseHandler(mouseModule.mouseController)
-	wndMgr.SetScreenSize(systemSetting.GetWidth(), systemSetting.GetHeight())
-	app.Create("METIN2", systemSetting.GetWidth(), systemSetting.GetHeight(), 1)
-	mouseModule.mouseController.Create()
-
-	class TestGame(ui.Window):
-		def __init__(self):
-			ui.Window.__init__(self)
-
-			localeInfo.LoadLocaleData()
-
-			self.mallWindow = WebWindow()
-			self.mallWindow.LoadWindow()
-			self.mallWindow.Open()
-
-		def __del__(self):
-			ui.Window.__del__(self)
-
-		def OnUpdate(self):
-			app.UpdateGame()
-
-		def OnRender(self):
-			app.RenderGame()
-			grp.PopState()
-			grp.SetInterfaceRenderState()
-
-	game = TestGame()
-	game.SetSize(systemSetting.GetWidth(), systemSetting.GetHeight())
-	game.Show()
-
-	app.Loop()
+import ui
+import uiScriptLocale
+import net
+import snd
+import app
+import mouseModule
+import constInfo
+
+def _IsSafeWebURL(url):
+	if not isinstance(url, str):
+		return False
+	u = url.strip()
+	if not u or len(u) > 2048:
+		return False
+	lu = u.lower()
+	return lu.startswith("http://") or lu.startswith("https://")
+
+class WebWindow(ui.ScriptWindow):
+	def __init__(self):
+		ui.ScriptWindow.__init__(self, "TOP_MOST")
+
+		self.oldPos = None
+		self.IsShowWindowValue = False
+
+	def __del__(self):
+		ui.ScriptWindow.__del__(self)
+
+	def LoadWindow(self):
+		try:
+			pyScrLoader = ui.PythonScriptLoader()
+			if constInfo.IN_GAME_SHOP_ENABLE:
+				pyScrLoader.LoadScriptFile(self, uiScriptLocale.LOCALE_COMMON_UISCRIPT_PATH + "WebWindow.py")
+			else:
+				pyScrLoader.LoadScriptFile(self, "UIScript/WebWindow.py")
+		except:
+			import exception
+			exception.Abort("WebWindow.LoadDialog.LoadScript")
+
+		try:
+			GetObject=self.GetChild
+			self.titleBar = GetObject("TitleBar")
+		except:
+			import exception
+			exception.Abort("WebWindow.LoadDialog.BindObject")
+
+		self.titleBar.SetCloseEvent(ui.__mem_func__(self.__OnCloseButtonClick))
+
+	def Destroy(self):
+		app.HideWebPage(app.BROWSER_TYPE_ITEM_MALL)
+		self.ClearDictionary()
+		self.titleBar = None
+
+	def Open(self, url):
+		if not _IsSafeWebURL(url):
+			return
+
+		self.Refresh()
+		self.Show()
+		self.SetCenterPosition()
+
+		x, y = self.GetGlobalPosition()
+		sx, sy = x + 10, y + 30
+		ex, ey = sx + self.GetWidth() - 20, sy + self.GetHeight() - 40
+
+		app.ShowWebPage(app.BROWSER_TYPE_ITEM_MALL, url, (sx, sy, ex, ey))
+		self.IsShowWindowValue = True
+
+	def Close(self):
+		app.HideWebPage(app.BROWSER_TYPE_ITEM_MALL)
+		self.Hide()
+		self.IsShowWindowValue = False
+
+	def CloseWhenOpenQuest(self):
+		app.HideWebPage(app.BROWSER_TYPE_ITEM_MALL)
+		self.Hide()
+
+	def OpenWhenOpenQuest(self):
+		if self.IsShowWindowValue:
+			net.SendCommandPacket("/in_game_mall")
+
+	def Clear(self):
+		self.Refresh()
+
+	def SetTitle(self, title):
+		self.TitleName.SetText(title)
+
+	def Refresh(self):
+		pass
+
+	def __OnCloseButtonClick(self):
+		print "close_web:click_close_button"
+		self.Close()
+
+	def OnPressEscapeKey(self):
+		print "close_web:esc_key"
+		self.Close()
+		return True
+
+	def OnUpdate(self):
+		newPos = self.GetGlobalPosition()
+		if newPos == self.oldPos:
+			return
+
+		self.oldPos = newPos
+
+		x, y = newPos
+		sx, sy = x + 10, y + 30
+		ex, ey = sx + self.GetWidth() - 20, sy + self.GetHeight() - 40
+		app.MoveWebPage(app.BROWSER_TYPE_ITEM_MALL, (sx, sy, ex, ey))
+
+if __name__ == "__main__":
+	import app
+	import wndMgr
+	import systemSetting
+	import mouseModule
+	import grp
+	import ui
+	import uiToolTip
+	import localeInfo
+
+	app.SetMouseHandler(mouseModule.mouseController)
+	app.SetHairColorEnable(True)
+	wndMgr.SetMouseHandler(mouseModule.mouseController)
+	wndMgr.SetScreenSize(systemSetting.GetWidth(), systemSetting.GetHeight())
+	app.Create("METIN2", systemSetting.GetWidth(), systemSetting.GetHeight(), 1)
+	mouseModule.mouseController.Create()
+
+	class TestGame(ui.Window):
+		def __init__(self):
+			ui.Window.__init__(self)
+
+			localeInfo.LoadLocaleData()
+
+			self.mallWindow = WebWindow()
+			self.mallWindow.LoadWindow()
+			self.mallWindow.Open()
+
+		def __del__(self):
+			ui.Window.__del__(self)
+
+		def OnUpdate(self):
+			app.UpdateGame()
+
+		def OnRender(self):
+			app.RenderGame()
+			grp.PopState()
+			grp.SetInterfaceRenderState()
+
+	game = TestGame()
+	game.SetSize(systemSetting.GetWidth(), systemSetting.GetHeight())
+	game.Show()
+
+	app.Loop()
