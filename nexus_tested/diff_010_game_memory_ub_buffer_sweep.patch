*** PATCH_BUNDLE_09_memory_ub_buffer_sweep.patch
*** Goal: fix remaining high-signal UB/overflow/leaks without overlapping your active bundles.
*** Apply after bundles 01..08 (your chosen stack).

--- a/server/metin2/Source/Server/game/src/log.cpp
+++ b/server/metin2/Source/Server/game/src/log.cpp
@@
+#include <cstdarg>
+
+// Safe formatting helper to avoid sprintf overflow in log formatting.
+static void SafeVsnprintf(char* out, size_t cap, const char* fmt, va_list ap)
+{
+	if (!out || cap == 0) return;
+	int n = vsnprintf(out, cap, fmt, ap);
+	if (n < 0)
+		out[0] = '\0';
+	else
+		out[cap - 1] = '\0';
+}
+
+static void SafeSnprintf(char* out, size_t cap, const char* fmt, ...)
+{
+	va_list ap;
+	va_start(ap, fmt);
+	SafeVsnprintf(out, cap, fmt, ap);
+	va_end(ap);
+}
@@
-	char szText[1024];
-	sprintf(szText, "%s", pszText);
+	char szText[1024];
+	SafeSnprintf(szText, sizeof(szText), "%s", pszText ? pszText : "");
 	sys_log(0, "%s", szText);

--- a/server/metin2/Source/Server/game/src/monarch.cpp
+++ b/server/metin2/Source/Server/game/src/monarch.cpp
@@
-	char query[256];
-	sprintf(query, "UPDATE monarch SET gold = gold + %d WHERE empire=%d", amount, empire);
+	char query[256];
+	snprintf(query, sizeof(query), "UPDATE monarch SET gold = gold + %d WHERE empire=%d", amount, empire);
 	DBManager::instance().DirectQuery(query);
@@
-	char query2[256];
-	sprintf(query2, "SELECT gold FROM monarch WHERE empire=%d", empire);
+	char query2[256];
+	snprintf(query2, sizeof(query2), "SELECT gold FROM monarch WHERE empire=%d", empire);
 	std::unique_ptr<SQLMsg> pmsg(DBManager::instance().DirectQuery(query2));

--- a/server/metin2/Source/Server/game/src/oxevent.cpp
+++ b/server/metin2/Source/Server/game/src/oxevent.cpp
@@
-	char szBuf[512];
-	sprintf(szBuf, "OXEVENT: %s", szText);
+	char szBuf[512];
+	snprintf(szBuf, sizeof(szBuf), "OXEVENT: %s", szText ? szText : "");
 	sys_log(0, "%s", szBuf);

--- a/server/metin2/Source/Server/db/src/ClientManagerLogin.cpp
+++ b/server/metin2/Source/Server/db/src/ClientManagerLogin.cpp
@@
-	char szQuery[256];
-	sprintf(szQuery, "UPDATE account.account SET last_play=NOW() WHERE id=%u", dwID);
+	char szQuery[256];
+	snprintf(szQuery, sizeof(szQuery), "UPDATE account.account SET last_play=NOW() WHERE id=%u", dwID);
 	DBManager::instance().DirectQuery(szQuery);

--- a/server/metin2/Source/Server/db/src/ClientManagerGuild.cpp
+++ b/server/metin2/Source/Server/db/src/ClientManagerGuild.cpp
@@
-	char query[512];
-	sprintf(query, "DELETE FROM guild%s WHERE id=%u", get_table_postfix(), dwGuildID);
+	char query[512];
+	snprintf(query, sizeof(query), "DELETE FROM guild%s WHERE id=%u", get_table_postfix(), dwGuildID);
 	DBManager::instance().DirectQuery(query);

--- a/server/metin2/Source/Server/db/src/ClientManagerParty.cpp
+++ b/server/metin2/Source/Server/db/src/ClientManagerParty.cpp
@@
-	char query[512];
-	sprintf(query, "DELETE FROM party%s WHERE leader_id=%u", get_table_postfix(), dwLeaderID);
+	char query[512];
+	snprintf(query, sizeof(query), "DELETE FROM party%s WHERE leader_id=%u", get_table_postfix(), dwLeaderID);
 	DBManager::instance().DirectQuery(query);

--- a/server/metin2/Source/Server/game/src/char_affect.cpp
+++ b/server/metin2/Source/Server/game/src/char_affect.cpp
@@
-	char buf[256];
-	sprintf(buf, "affect_remove %u", dwType);
+	char buf[256];
+	snprintf(buf, sizeof(buf), "affect_remove %u", dwType);
 	LogManager::instance().CharLog(this, 0, "AFFECT_REMOVE", buf);

--- a/server/metin2/Source/Server/game/src/char_battle.cpp
+++ b/server/metin2/Source/Server/game/src/char_battle.cpp
@@
-	char buf[256];
-	sprintf(buf, "damage %d", iDam);
+	char buf[256];
+	snprintf(buf, sizeof(buf), "damage %d", iDam);
 	LogManager::instance().CharLog(this, 0, "DAMAGE", buf);

--- a/server/metin2/Source/Server/game/src/questlua_global.cpp
+++ b/server/metin2/Source/Server/game/src/questlua_global.cpp
@@
-	char szBuf[1024];
-	sprintf(szBuf, "%s", lua_tostring(L, 1));
+	char szBuf[1024];
+	snprintf(szBuf, sizeof(szBuf), "%s", lua_tostring(L, 1) ? lua_tostring(L, 1) : "");
 	sys_log(0, "LUA_GLOBAL_LOG: %s", szBuf);

