--- a/server/metin2/Server/share/locale/uk/quest/pre_qc/dawnmist_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/pre_qc/dawnmist_dungeon.quest
@@ -5,6 +5,10 @@
 		end
 
 		function create()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(353, 7780, 15020)
 			d.spawn_mob(6408, 69, 941)
 
--- a/server/metin2/Server/share/locale/uk/quest/pre_qc/flame_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/pre_qc/flame_dungeon.quest
@@ -58,6 +58,10 @@
 
 		function make_dungeon() -- ´øÀü ¸¸µé±â
 			local setting = flame_dungeon.setting()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(351, setting.dungeon_entry_pos[1], setting.dungeon_entry_pos[2])
 			--d.spawn_mob_ac_dir(20385, setting.DUNGEON_MAN_pos[1], setting.DUNGEON_MAN_pos[2], 0)
 			--d.spawn_mob(YAK, setting.YAK_pos[1], setting.YAK_pos[2])
--- a/server/metin2/Server/share/locale/uk/quest/pre_qc/labyrinth_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/pre_qc/labyrinth_dungeon.quest
@@ -241,6 +241,10 @@
 
 		function create_dungeon()
 			local dungeon = labyrinth_dungeon.get_settings()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(dungeon.map_index,
 				dungeon.enter_pos.x + dungeon.base.x,
 				dungeon.enter_pos.y + dungeon.base.y
@@ -381,6 +385,10 @@
 
 		function go_boss()
 			local dungeon = labyrinth_dungeon.get_settings()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(dungeon.map_index,
 				dungeon.boss_pos.x + dungeon.base.x,
 				dungeon.boss_pos.y + dungeon.base.y
--- a/server/metin2/Server/share/locale/uk/quest/pre_qc/snow_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/pre_qc/snow_dungeon.quest
@@ -72,6 +72,10 @@
 
 		function create_dungeon()
 			local setting = snow_dungeon.setting()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(352, setting.floor_pos[1][1], setting.floor_pos[1][2])
 			d.set_warp_at_eliminate(1, d.get_map_index(), setting.floor_pos[2][1], setting.floor_pos[2][2], "data/dungeon/snow_dungeon/regen_2.txt")
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/dawnmist_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/dawnmist_dungeon.quest
@@ -22,6 +22,10 @@
 
 		function create()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(DUNGEON_MAP_INDEX, DUNGEON_ENTRY_POS[1], DUNGEON_ENTRY_POS[2])
 			d.spawn_mob(FIRST_BOSS, DUNGEON_BOSS_POS[1], DUNGEON_BOSS_POS[2])
 
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest
@@ -30,7 +30,13 @@
 
 		when devil_stone1_1.timer begin
-			d.new_jump_all(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			if party.is_party() then
+				d.new_jump_all(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			else
+				d.new_jump(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			end
 			d.regen_file("data/dungeon/deviltower2_regen.txt")
 			d.set_warp_at_eliminate(4, d.get_map_index(), special.devil_tower[2][1], special.devil_tower[2][2], "data/dungeon/deviltower3_regen.txt")
 		end
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/flame_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/flame_dungeon.quest
@@ -81,6 +81,10 @@
 
 		function make_dungeon()
 			local setting = flame_dungeon.setting()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(DUNGEON_MAP_INDEX, setting.dungeon_entry_pos[1], setting.dungeon_entry_pos[2])
 			d.spawn_mob(setting.DUNGEON_MAN, setting.DUNGEON_MAN_pos[1], setting.DUNGEON_MAN_pos[2])
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/labyrinth_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/labyrinth_dungeon.quest
@@ -255,6 +255,10 @@
 
 		function create_dungeon()
 			local dungeon = labyrinth_dungeon.get_settings()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(dungeon.map_index,
 				dungeon.enter_pos.x + dungeon.base.x,
 				dungeon.enter_pos.y + dungeon.base.y
@@ -395,6 +399,10 @@
 
 		function go_boss()
 			local dungeon = labyrinth_dungeon.get_settings()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(dungeon.map_index,
 				dungeon.boss_pos.x + dungeon.base.x,
 				dungeon.boss_pos.y + dungeon.base.y
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/snow_dungeon.quest
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/snow_dungeon.quest
@@ -106,6 +106,10 @@
 
 		function create_dungeon()
 			local setting = snow_dungeon.setting()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(DUNGEON_MAP_INDEX, setting.floor_pos[1][1], setting.floor_pos[1][2])
 			d.set_warp_at_eliminate(1, d.get_map_index(), setting.floor_pos[2][1], setting.floor_pos[2][2], "data/dungeon/snow_dungeon/regen_2.txt")
--- a/server/metin2/Server/share/locale/uk/quest/questing.lua
+++ b/server/metin2/Server/share/locale/uk/quest/questing.lua
@@ -640,7 +640,8 @@
     if pw == nil then error("Fehler... Passwort muss gesetzt werden!") end
     local ac = ac or pc.get_account_id() 
     if type(ac) == "string" then
-        mysql_query("UPDATE player.player,account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = player.account_id and player.name = '"..ac.."' LIMIT 1")
+        local ac_esc = mysql_escape_string(ac)
+        mysql_query("UPDATE player.player,account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = player.account_id and player.name = '"..ac_esc.."' LIMIT 1")
     elseif type(ac) == "number" then
         mysql_query("UPDATE account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = "..ac)
     end

--- a/server/metin2/Server/share/locale/uk/quest/questing.lua
+++ b/server/metin2/Server/share/locale/uk/quest/questing.lua
@@ -98,6 +98,18 @@
     if query == '' or query == nil then
         error("Query muss gesetzt sein!")
     end
+
+-- SQL escape helper for dynamic queries (prevents injection on name/account fields)
+function sql_escape(s)
+	s = tostring(s or "")
+	s = s:gsub("\\\\", "\\\\\\\\")
+	s = s:gsub("\0", "\\0")
+	s = s:gsub("\n", "\\n"):gsub("\r", "\\r")
+	s = s:gsub("\x1a", "\\Z")
+	s = s:gsub("'", "\\'")
+	return s
+end
+
     user = user or ql.mysql["user"]
     pass = pass or ql.mysql["pass"]
     ip = ip or ql.mysql["ip"]
@@ -639,8 +651,9 @@
 function account.set_pw(pw,ac)
     if pw == nil then error("Fehler... Passwort muss gesetzt werden!") end
     local ac = ac or pc.get_account_id() 
+	local ac_esc = sql_escape(ac)
     if type(ac) == "string" then
-        mysql_query("UPDATE player.player,account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = player.account_id and player.name = '"..ac.."' LIMIT 1")
+		mysql_query("UPDATE player.player,account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = player.account_id and player.name = '"..ac_esc.."' LIMIT 1")
     elseif type(ac) == "number" then
         mysql_query("UPDATE account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = "..ac)
     end

--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest
@@ -30,7 +30,11 @@
 		end
 
 		when devil_stone1_1.timer begin
-			d.new_jump_all(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			if party.is_party() then
+				d.new_jump_all(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			else
+				d.new_jump(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			end
 			d.regen_file("data/dungeon/deviltower2_regen.txt")
 			d.set_warp_at_eliminate(4, d.get_map_index(), special.devil_tower[2][1], special.devil_tower[2][2], "data/dungeon/deviltower3_regen.txt")
 		end
