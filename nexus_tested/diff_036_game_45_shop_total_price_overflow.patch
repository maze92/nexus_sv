--- /tmp/shop.h.orig	2026-02-17 03:11:08.054318855 +0000
+++ server/metin2/Source/Server/game/src/shop.h	2026-02-17 03:16:26.100195163 +0000
@@ -21,9 +21,9 @@
 	typedef struct shop_item
 	{
 		DWORD vnum; // ������ ��ȣ
-		long price; // ����
+		long long price; // ����
 #if defined(__CHEQUE_SYSTEM__)
-		long cheque;
+		long long cheque;
 #endif
 		DWORD count; // ������ ����
 

--- /tmp/shop.cpp.orig	2026-02-17 03:11:08.047505909 +0000
+++ server/metin2/Source/Server/game/src/shop.cpp	2026-02-17 03:21:42.454186310 +0000
@@ -216,8 +216,8 @@
 		if (item.pkItem)
 		{
 			item.vnum = pkItem->GetVnum();
-			item.count = pkItem->GetCount(); // PC ���� ��� ������ ������ ��¥ �������� �������� �Ѵ�.
-			item.price = pTable->price; // ���ݵ� ����ڰ� ���Ѵ��..
+			item.count = pkItem->GetCount(); // PC     ¥   Ѵ.
+			item.price = pTable->price; // ݵ ڰ Ѵ..
 #if defined(__CHEQUE_SYSTEM__)
 			item.cheque = pTable->cheque;
 #endif
@@ -236,16 +236,16 @@
 					item.price = item.count / item_table->dwShopBuyPrice;
 			}
 			else
-				item.price = item_table->dwShopBuyPrice * item.count;
+				item.price = static_cast<long long>(item_table->dwShopBuyPrice) * item.count;
 		}
 
 		char name[36];
 		snprintf(name, sizeof(name), "%-20s(#%-5d) (x %d)", item_table->szName, (int)item.vnum, item.count);
 
 #if defined(__CHEQUE_SYSTEM__)
-		sys_log(0, "SHOP_ITEM: %-36s PRICE %-5d CHEQUE %-5d", name, item.price, item.cheque);
+		sys_log(0, "SHOP_ITEM: %-36s PRICE %-5lld CHEQUE %-5lld", name, item.price, item.cheque);
 #else
-		sys_log(0, "SHOP_ITEM: %-36s PRICE %-5d", name, item.price);
+		sys_log(0, "SHOP_ITEM: %-36s PRICE %-5lld", name, item.price);
 #endif
 		++pTable;
 	}
@@ -304,32 +304,31 @@
 			return SHOP_SUBHEADER_GC_SOLD_OUT;
 		}
 	}
-
-	DWORD dwPrice = r_item.price;
+	long long llPrice = r_item.price;
 #if defined(__CHEQUE_SYSTEM__)
-	DWORD dwCheque = r_item.cheque;
+	long long llCheque = r_item.cheque;
 #endif
 
 	if (it->second) // if other empire, price is triple
-		dwPrice *= 3;
+		llPrice *= 3;
 
-	if (ch->GetGold() < dwPrice)
+	if (ch->GetGold() < llPrice)
 	{
-		sys_log(1, "Shop::Buy : Not enough money : %s has %lld, price %u", ch->GetName(), ch->GetGold(), dwPrice);
+		sys_log(1, "Shop::Buy : Not enough money : %s has %lld, price %lld", ch->GetName(), ch->GetGold(), llPrice);
 		return SHOP_SUBHEADER_GC_NOT_ENOUGH_MONEY;
 	}
 
 #if defined(__CHEQUE_SYSTEM__)
-	if (ch->GetCheque() < dwCheque)
+	if (ch->GetCheque() < llCheque)
 	{
-		sys_log(1, "Shop::Buy : Not enough cheque : %s has %d, cheque %u", ch->GetName(), ch->GetCheque(), dwCheque);
+		sys_log(1, "Shop::Buy : Not enough cheque : %s has %d, cheque %lld", ch->GetName(), ch->GetCheque(), llCheque);
 		return SHOP_SUBHEADER_GC_NOT_ENOUGH_MONEY;
 	}
 #endif
 
 	LPITEM item;
 
-	if (m_pkPC) // �Ǿ��� ��ϴ� ���� �Ǿ��� ���� �������� �������־�� �Ѵ�.
+	if (m_pkPC) // Ǿ ϴ  Ǿ   ־ Ѵ.
 		item = r_item.pkItem;
 	else
 		item = ITEM_MANAGER::instance().CreateItem(r_item.vnum, r_item.count);
@@ -341,7 +340,7 @@
 	{
 		if (quest::CQuestManager::instance().GetEventFlag("hivalue_item_sell") == 0)
 		{
-			// �ູ�� ���� && ������ö �̺�Ʈ 
+			// ູ  && ö ̺Ʈ 
 			if (item->GetVnum() == 70024 || item->GetVnum() == 70035)
 			{
 				return SHOP_SUBHEADER_GC_END;
@@ -376,16 +375,19 @@
 		}
 	}
 
-	if (dwPrice)
-		ch->PointChange(POINT_GOLD, -dwPrice, false);
+	long long llTotalPrice = llPrice;
+	long long llNetPrice = llTotalPrice;
+
+	if (llTotalPrice)
+		ch->PointChange(POINT_GOLD, -llTotalPrice, false);
 
 #if defined(__CHEQUE_SYSTEM__)
-	if (dwCheque)
-		ch->PointChange(POINT_CHEQUE, -dwCheque, false);
+	if (llCheque)
+		ch->PointChange(POINT_CHEQUE, -llCheque, false);
 #endif
 
-	// ���� ���
 	DWORD dwTax = 0;
+	long long llTax = 0;
 	int iVal = 0;
 
 	if (LC_IsYMIR() || LC_IsKorea())
@@ -395,14 +397,12 @@
 			if (iVal > 100)
 				iVal = 100;
 
-			dwTax = dwPrice * iVal / 100;
-			dwPrice = dwPrice - dwTax;
+			llTax = llTotalPrice * iVal / 100;
 		}
 		else
 		{
 			iVal = 3;
-			dwTax = dwPrice * iVal / 100;
-			dwPrice = dwPrice - dwTax;
+			llTax = llTotalPrice * iVal / 100;
 		}
 	}
 	else
@@ -414,23 +414,30 @@
 			if (iVal > 100)
 				iVal = 100;
 
-			dwTax = dwPrice * iVal / 100;
-			dwPrice = dwPrice - dwTax;
+			llTax = llTotalPrice * iVal / 100;
 		}
 		else
 		{
 			iVal = 0;
-			dwTax = 0;
+			llTax = 0;
 		}
 	}
 
-	// �������� �싚 ���� 5%
+	if (llTax < 0)
+		llTax = 0;
+	if (llTax > llTotalPrice)
+		llTax = llTotalPrice;
+
+	llNetPrice = llTotalPrice - llTax;
+	dwTax = (DWORD)llTax;
+
+	//  싚  5%
 	if (!m_pkPC)
 	{
 		CMonarch::instance().SendtoDBAddMoney(dwTax, ch->GetEmpire(), ch);
 	}
 
-	// ���� �ý��� : ���� ¡��
+	//  ý :  ¡
 	if (m_pkPC)
 	{
 		m_pkPC->SyncQuickslot(SLOT_TYPE_INVENTORY, item->GetCell(), WORD_MAX);
@@ -440,7 +447,7 @@
 
 			if (item->GetVnum() >= 80003 && item->GetVnum() <= 80007)
 			{
-				snprintf(buf, sizeof(buf), "%s FROM: %u TO: %u PRICE: %u", item->GetName(), ch->GetPlayerID(), m_pkPC->GetPlayerID(), dwPrice);
+				snprintf(buf, sizeof(buf), "%s FROM: %u TO: %u PRICE: %lld", item->GetName(), ch->GetPlayerID(), m_pkPC->GetPlayerID(), llNetPrice);
 				LogManager::instance().GoldBarLog(ch->GetPlayerID(), item->GetID(), SHOP_BUY, buf);
 				LogManager::instance().GoldBarLog(m_pkPC->GetPlayerID(), item->GetID(), SHOP_SELL, buf);
 			}
@@ -454,23 +461,23 @@
 				item->AddToCharacter(ch, TItemPos(INVENTORY, iEmptyPos));
 			ITEM_MANAGER::instance().FlushDelayedSave(item);
 
-			snprintf(buf, sizeof(buf), "%s %u(%s) %u %u", item->GetName(), m_pkPC->GetPlayerID(), m_pkPC->GetName(), dwPrice, item->GetCount());
+			snprintf(buf, sizeof(buf), "%s %u(%s) %lld %u", item->GetName(), m_pkPC->GetPlayerID(), m_pkPC->GetName(), llNetPrice, item->GetCount());
 			LogManager::instance().ItemLog(ch, item, "SHOP_BUY", buf);
 
-			snprintf(buf, sizeof(buf), "%s %u(%s) %u %u", item->GetName(), ch->GetPlayerID(), ch->GetName(), dwPrice, item->GetCount());
+			snprintf(buf, sizeof(buf), "%s %u(%s) %lld %u", item->GetName(), ch->GetPlayerID(), ch->GetName(), llNetPrice, item->GetCount());
 			LogManager::instance().ItemLog(m_pkPC, item, "SHOP_SELL", buf);
 		}
 
 		r_item.pkItem = NULL;
 		BroadcastUpdateItem(pos);
 
-		m_pkPC->PointChange(POINT_GOLD, dwPrice, false);
+		m_pkPC->PointChange(POINT_GOLD, llNetPrice, false);
 #if defined(__CHEQUE_SYSTEM__)
-		m_pkPC->PointChange(POINT_CHEQUE, dwCheque, false);
+		m_pkPC->PointChange(POINT_CHEQUE, llCheque, false);
 #endif
 
 		if (iVal > 0)
-			m_pkPC->ChatPacket(CHAT_TYPE_INFO, LC_STRING("�Ǹűݾ��� %d %% �� �������� �����Ե˴ϴ�", iVal));
+			m_pkPC->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ǹűݾ %d %%   Ե˴ϴ", iVal));
 
 		CMonarch::instance().SendtoDBAddMoney(dwTax, m_pkPC->GetEmpire(), m_pkPC);
 	}
@@ -490,11 +497,12 @@
 			LogManager::instance().GoldBarLog(ch->GetPlayerID(), item->GetID(), PERSONAL_SHOP_BUY, "");
 		}
 
-		DBManager::instance().SendMoneyLog(MONEY_LOG_SHOP, item->GetVnum(), -dwPrice);
+		int iGoldLog = (llTotalPrice > INT_MAX) ? INT_MAX : (int)llTotalPrice;
+		DBManager::instance().SendMoneyLog(MONEY_LOG_SHOP, item->GetVnum(), -iGoldLog);
 	}
 
 	if (item)
-		sys_log(0, "SHOP: BUY: name %s %s(x %d):%u price %u", ch->GetName(), item->GetName(), item->GetCount(), item->GetID(), dwPrice);
+		sys_log(0, "SHOP: BUY: name %s %s(x %d):%u price %lld", ch->GetName(), item->GetName(), item->GetCount(), item->GetID(), llTotalPrice);
 
 	ch->Save();
 
@@ -548,7 +556,7 @@
 		// HIVALUE_ITEM_EVENT
 		if (quest::CQuestManager::instance().GetEventFlag("hivalue_item_sell") == 0)
 		{
-			// �ູ�� ���� && ������ö �̺�Ʈ 
+			// ູ  && ö ̺Ʈ 
 			if (item.vnum == 70024 || item.vnum == 70035)
 			{
 				continue;
@@ -560,10 +568,14 @@
 
 		pack2.items[i].dwVnum = item.vnum;
 		pack2.items[i].dwCount = item.count;
+		long long llSendPrice = item.price;
 		if (bOtherEmpire) // no empire price penalty for pc shop
-			pack2.items[i].dwPrice = item.price * 3;
-		else
-			pack2.items[i].dwPrice = item.price;
+			llSendPrice *= 3;
+		if (llSendPrice < 0)
+			llSendPrice = 0;
+		if (llSendPrice > 0xFFFFFFFFLL)
+			llSendPrice = 0xFFFFFFFFLL;
+		pack2.items[i].dwPrice = (DWORD)llSendPrice;
 #if defined(__CHEQUE_SYSTEM__)
 		pack2.items[i].dwCheque = item.cheque;
 #endif
@@ -689,7 +701,14 @@
 		}
 	}
 
-	pack2.item.dwPrice = m_itemVector[pos].price;
+	{
+		long long llSendPrice = m_itemVector[pos].price;
+		if (llSendPrice < 0)
+			llSendPrice = 0;
+		if (llSendPrice > 0xFFFFFFFFLL)
+			llSendPrice = 0xFFFFFFFFLL;
+		pack2.item.dwPrice = (DWORD)llSendPrice;
+	}
 #if defined(__CHEQUE_SYSTEM__)
 	pack2.item.dwCheque = m_itemVector[pos].cheque;
 #endif
