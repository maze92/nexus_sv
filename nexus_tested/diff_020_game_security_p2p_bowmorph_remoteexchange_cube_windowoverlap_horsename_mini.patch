--- a/server/metin2/Source/Server/game/src/desc_p2p.cpp
+++ b/server/metin2/Source/Server/game/src/desc_p2p.cpp
@@ -1,4 +1,5 @@
 #include "stdafx.h"
+#include <arpa/inet.h>
 #include "desc_p2p.h"
 #include "protocol.h"
 #include "p2p.h"
@@ -47,11 +48,34 @@
 	m_iMinInputBufferLen = 1024 * 1024;
 
 #if !defined(__ALLOW_EXTERNAL_PEER__)
-	if (strcmp(host, g_szPublicIP))
+	// Hardening: do not rely on firewall. Only allow loopback or RFC1918 peers.
+	// If you run multi-host cores over public WAN, define __ALLOW_EXTERNAL_PEER__ and protect via firewall/VPN.
 	{
-		sys_log(0, "SYSTEM: new p2p connection from [%s] to [%s] fd: %d BLOCKED", host, g_szPublicIP, m_sock);
-		SetPhase(PHASE_CLOSE);
-		return true;
+		const in_addr_t dwAddr = inet_addr(host);
+		bool bAllowed = false;
+		if (dwAddr != INADDR_NONE)
+		{
+			const uint32_t ip = ntohl(dwAddr);
+			// 127.0.0.0/8
+			if ((ip >> 24) == 127)
+				bAllowed = true;
+			// 10.0.0.0/8
+			else if ((ip >> 24) == 10)
+				bAllowed = true;
+			// 172.16.0.0/12
+			else if ((ip >> 20) == 0xAC1)
+				bAllowed = true;
+			// 192.168.0.0/16
+			else if ((ip >> 16) == 0xC0A8)
+				bAllowed = true;
+		}
+
+		if (!bAllowed)
+		{
+			sys_log(0, "SYSTEM: new p2p connection from [%s] fd: %d BLOCKED (non-local peer)", host, m_sock);
+			SetPhase(PHASE_CLOSE);
+			return true;
+		}
 	}
 #endif
 
--- a/server/metin2/Source/Server/game/src/battle.cpp
+++ b/server/metin2/Source/Server/game/src/battle.cpp
@@ -91,6 +91,10 @@
 
 bool battle_is_attackable(LPCHARACTER ch, LPCHARACTER victim)
 {
+	// [Security Fix] Ghost attack: observer/spectator cannot attack or be attacked.
+	if (!ch || ch->IsDead() || ch->IsObserverMode())
+		return false;
+
 	// ������ �׾����� �ߴ��Ѵ�.
 	if (victim->IsDead() || victim->IsObserverMode())
 		return false;
@@ -771,6 +775,14 @@
 
 	// Ÿ��ġ ����
 	int iDist = (int)(DISTANCE_SQRT(pkAttacker->GetX() - pkVictim->GetX(), pkAttacker->GetY() - pkVictim->GetY()));
+
+	// [Security Fix] Bow-Morph ghost range: when polymorphed, do not allow weapon range to override mob range.
+	if (pkAttacker->IsPolymorphed())
+	{
+		const int iMaxPolyRange = (int)(pkAttacker->GetMobAttackRange() * 1.15f);
+		if (iDist > iMaxPolyRange)
+			return 0;
+	}
 	//int iGap = (iDist / 100) - 5 - pkBow->GetValue(5) - pkAttacker->GetPoint(POINT_BOW_DISTANCE);
 	int iGap = (iDist / 100) - 5 - pkAttacker->GetPoint(POINT_BOW_DISTANCE);
 	int iPercent = 100 - (iGap * 5);
--- a/server/metin2/Source/Server/game/src/exchange.cpp
+++ b/server/metin2/Source/Server/game/src/exchange.cpp
@@ -104,6 +104,10 @@
 	if (victim->IsNPC())
 		return false;
 
+	// [Security Fix] Remote Exchange (inter-map) is not allowed.
+	if (GetMapIndex() != victim->GetMapIndex())
+		return false;
+
 #ifdef __GROWTH_PET_SYSTEM__
 	if (GetPetWindowType() == PET_WINDOW_ATTR_CHANGE || GetPetWindowType() == PET_WINDOW_PRIMIUM_FEEDSTUFF)
 	{
--- a/server/metin2/Source/Server/game/src/cube.cpp
+++ b/server/metin2/Source/Server/game/src/cube.cpp
@@ -281,10 +281,21 @@
 	if (pChar->IsCubeOpen() == false)
 		return;
 
-	const LPCHARACTER pNPC = pChar->GetQuestNPC();
+	const LPCHARACTER pNPC = pChar->GetCubeNpc();
 	if (pNPC == nullptr)
 		return;
 
+	// [Security Fix] Crafting remote: re-validate NPC proximity and map on every craft request.
+	if (pChar->PreventTradeWindow(WND_CUBE, true/*except*/))
+		return;
+
+	if (pNPC->GetMapIndex() != pChar->GetMapIndex())
+		return;
+
+	const int iDistance = DISTANCE_APPROX(pChar->GetX() - pNPC->GetX(), pChar->GetY() - pNPC->GetY());
+	if (iDistance >= CUBE_MAX_DISTANCE)
+		return;
+
 	try
 	{
 		const SCubeData& pkCube = GetCubeData(pNPC->GetRaceNum(), iCubeIndex);
--- a/server/metin2/Source/Server/game/src/input_main.cpp
+++ b/server/metin2/Source/Server/game/src/input_main.cpp
@@ -2003,6 +2003,10 @@
 	if (NULL == ch)
 		return;
 
+	// [Security Fix] Ghost attack: spectator/observer must not be able to attack.
+	if (ch->IsObserverMode() || ch->IsDead())
+		return;
+
 	struct type_identifier
 	{
 		BYTE header;
@@ -2421,6 +2425,10 @@
 	if (!ch->CanHandleItem())
 		return;
 
+	// [Security Fix] Window overlap: block safebox operations while other trade windows are open.
+	if (ch->PreventTradeWindow(WND_SAFEBOX, true/*except*/))
+		return;
+
 	CSafebox* pkSafebox = ch->GetSafebox();
 	LPITEM pkItem = ch->GetItem(p->ItemPos);
 
@@ -2513,6 +2521,10 @@
 	if (!ch->CanHandleItem())
 		return;
 
+	// [Security Fix] Window overlap: block safebox operations while other trade windows are open.
+	if (ch->PreventTradeWindow(WND_SAFEBOX, true/*except*/))
+		return;
+
 	CSafebox* pkSafebox;
 
 	if (bMall)
@@ -2684,6 +2696,10 @@
 	if (!ch->CanHandleItem())
 		return;
 
+	// [Security Fix] Window overlap: block safebox operations while other trade windows are open.
+	if (ch->PreventTradeWindow(WND_SAFEBOX, true/*except*/))
+		return;
+
 	if (!ch->GetSafebox())
 		return;
 
--- a/server/metin2/Source/Server/game/src/horsename_manager.cpp
+++ b/server/metin2/Source/Server/game/src/horsename_manager.cpp
@@ -35,6 +35,14 @@
 		szHorseName = "";
 	}
 
+	// [Security Fix] Format-string hardening: block '%' in stored horse names.
+	// Names are normally validated earlier, but this also protects DB/packet edge-cases.
+	if (strchr(szHorseName, '%') != NULL)
+	{
+		sys_err("HORSENAME: invalid character in name (%%) player %u", dwPlayerID);
+		szHorseName = "";
+	}
+
 	sys_log(0, "HORSENAME: update %u %s", dwPlayerID, szHorseName);
 
 	m_mapHorseNames[dwPlayerID] = szHorseName;
--- a/server/metin2/Source/Server/game/src/char.h
+++ b/server/metin2/Source/Server/game/src/char.h
@@ -2590,6 +2590,7 @@
 #endif
 	bool IsCubeOpen() const { return (m_pointsInstant.pCubeNpc ? true : false); }
 	void SetCubeNpc(LPCHARACTER npc) { m_pointsInstant.pCubeNpc = npc; }
+	LPCHARACTER GetCubeNpc() const { return m_pointsInstant.pCubeNpc; }
 	bool CanDoCube() const;
 
 public:
