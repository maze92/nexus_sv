--- /tmp/mining.cpp.orig	2026-02-17 03:11:07.962182980 +0000
+++ server/metin2/Source/Server/game/src/mining.cpp	2026-02-17 03:22:02.033382186 +0000
@@ -174,9 +174,12 @@
 		DWORD pid;
 		DWORD vid_load;
 
+
+		DWORD pick_item_id;
 		mining_event_info()
 			: pid(0)
 			, vid_load(0)
+			, pick_item_id(0)
 		{
 		}
 	};
@@ -387,6 +390,14 @@
 		}
 		// END_OF_REFINE_PICK
 
+		// Anti-exploit: cancel mining if the equipped pickaxe changed during the progress bar.
+		// This prevents NULL deref crashes and last-second swap exploits.
+		if (info->pick_item_id && pick->GetID() != info->pick_item_id)
+		{
+			ch->ChatPacket(CHAT_TYPE_INFO, "Mining cancelled.");
+			return 0;
+		}
+
 		if (!load)
 		{
 			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("���̻� ĳ�� �� �����ϴ�."));
@@ -416,6 +427,10 @@
 		info->pid = ch->GetPlayerID();
 		info->vid_load = load->GetVID();
 
+
+
+		LPITEM pick = ch->GetWear(WEAR_WEAPON);
+		info->pick_item_id = (pick && pick->GetType() == ITEM_PICK) ? pick->GetID() : 0;
 		return event_create(mining_event, info, PASSES_PER_SEC(2 * count));
 	}
 
