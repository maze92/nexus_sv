--- a/server/metin2/Source/Server/game/src/DragonSoul.cpp
+++ b/server/metin2/Source/Server/game/src/DragonSoul.cpp
@@ -40,7 +40,7 @@
 	return -1;

 }

 

-// °¡ÁßÄ¡ Å×ÀÌºí(prob_lst)À» ¹Þ¾Æ random_set.size()°³ÀÇ index¸¦ ¼±ÅÃÇÏ¿© random_setÀ» return

+// ġ ̺(prob_lst) ޾ random_set.size() index Ͽ random_set return

 bool MakeDistinctRandomNumberSet(std::list <float> prob_lst, OUT std::vector<int>& random_set)

 {

 	int size = prob_lst.size();

@@ -76,11 +76,11 @@
 	return true;

 }

 

-/* ¿ëÈ¥¼® Vnum¿¡ ´ëÇÑ comment

- * ITEM VNUMÀ» 10¸¸ ÀÚ¸®ºÎÅÍ, FEDCBA¶ó°í ÇÑ´Ù¸é

- * FE : ¿ëÈ¥¼® Á¾·ù.	D : µî±Þ

- * C : ´Ü°è			B : °­È­

- * A : ¿©¹úÀÇ ¹øÈ£µé...

+/* ȥ Vnum  comment

+ * ITEM VNUM 10 ڸ, FEDCBA Ѵٸ

+ * FE : ȥ .	D : 

+ * C : ܰ			B : ȭ

+ * A :  ȣ...

  */

 

 BYTE GetType(DWORD dwVnum)

@@ -210,7 +210,7 @@
 		return false;

 	}

 

-	// add_min°ú add_max´Â ´õ¹Ì·Î ÀÐÀ½.

+	// add_min add_max ̷ .

 	int basic_apply_num, add_min, add_max;

 	if (!m_pTable->GetApplyNumSettings(ds_type, grade_idx, basic_apply_num, add_min, add_max))

 	{

@@ -355,7 +355,7 @@
 	return pItem->GetDuration();

 }

 

-// ¿ëÈ¥¼®À» ¹Þ¾Æ¼­ ¿ë½ÉÀ» ÃßÃâÇÏ´Â ÇÔ¼ö

+// ȥ ޾Ƽ  ϴ Լ

 bool DSManager::ExtractDragonHeart(LPCHARACTER ch, LPITEM pItem, LPITEM pExtractor)

 {

 	if (NULL == ch || NULL == pItem)

@@ -363,7 +363,7 @@
 

 	if (pItem->IsEquipped())

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Âø¿ë ÁßÀÎ ¿ëÈ¥¼®Àº ÃßÃâÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ȥ   ϴ."));

 		return false;

 	}

 

@@ -407,7 +407,7 @@
 		}

 		LogManager::instance().ItemLog(ch, pItem, "DS_HEART_EXTRACT_FAIL", "");

 

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ë½É ÃßÃâ¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ⿡ Ͽϴ."));

 		return false;

 	}

 	else

@@ -433,12 +433,12 @@
 		std::string s = std::to_string(iCharge);

 		s += "%s";

 		LogManager::instance().ItemLog(ch, pItem, "DS_HEART_EXTRACT_SUCCESS", s.c_str());

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ë½É ÃßÃâ¿¡ ¼º°øÇÏ¿´½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ⿡ Ͽϴ."));

 		return true;

 	}

 }

 

-// Æ¯Á¤ ¿ëÈ¥¼®À» ÀåºñÃ¢¿¡¼­ Á¦°ÅÇÒ ¶§¿¡ ¼º°ø ¿©ºÎ¸¦ °áÁ¤ÇÏ°í, ½ÇÆÐ½Ã ºÎ»ê¹°À» ÁÖ´Â ÇÔ¼ö.

+// Ư ȥ â    θ ϰ, н λ깰 ִ Լ.

 bool DSManager::PullOut(LPCHARACTER ch, TItemPos DestCell, LPITEM& pItem, LPITEM pExtractor)

 {

 	if (NULL == ch || NULL == pItem)

@@ -447,13 +447,13 @@
 		return false;

 	}

 

-	// ¸ñÇ¥ À§Ä¡°¡ validÇÑÁö °Ë»ç ÈÄ, validÇÏÁö ¾Ê´Ù¸é ÀÓÀÇÀÇ ºó °ø°£À» Ã£´Â´Ù.

+	// ǥ ġ valid ˻ , valid ʴٸ    ã´.

 	if (!IsValidCellForThisItem(pItem, DestCell) || ch->GetItem(DestCell))

 	{

 		int iEmptyCell = ch->GetEmptyDragonSoulInventory(pItem);

 		if (iEmptyCell < 0)

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 			return false;

 		}

 		else

@@ -477,14 +477,14 @@
 	float fProb;

 	float fDice;

 

-	// ¿ëÈ¥¼® ÃßÃâ ¼º°ø ¿©ºÎ °áÁ¤.

+	// ȥ    .

 	{

 		// DWORD dwVnum = pItem->GetVnum();

 

 		BYTE ds_type, grade_idx, step_idx, strength_idx;

 		GetDragonSoulInfo(pItem->GetVnum(), ds_type, grade_idx, step_idx, strength_idx);

 

-		// ÃßÃâ Á¤º¸°¡ ¾ø´Ù¸é ÀÏ´Ü ¹«Á¶°Ç ¼º°øÇÏ´Â °ÍÀÌ¶ó »ý°¢ÇÏÀÚ.

+		//   ٸ ϴ  ϴ ̶ .

 		if (!m_pTable->GetDragonSoulExtValues(ds_type, grade_idx, fProb, dwByProduct))

 		{

 			pItem->AddToCharacter(ch, DestCell);

@@ -501,19 +501,19 @@
 		bSuccess = fDice <= (fProb * (100 + iBonus) / 100.f);

 	}

 

-	// Ä³¸¯ÅÍÀÇ ¿ëÈ¥¼® ÃßÃâ ¹× Ãß°¡ È¤Àº Á¦°Å. ºÎ»ê¹° Á¦°ø.

+	// ĳ ȥ   ߰ Ȥ . λ깰 .

 	{

 		char buf[128];

 		if (bSuccess)

 		{

 			if (pExtractor)

-				sprintf(buf, "dice(%d) prob(%d + %d) EXTR(VN:%d)", (int)fDice, (int)fProb, iBonus, pExtractor->GetVnum());

+				snprintf(buf, sizeof(buf), "dice(%d) prob(%d + %d) EXTR(VN:%d)", (int)fDice, (int)fProb, iBonus, pExtractor->GetVnum());

 			else

-				sprintf(buf, "dice(%d) prob(%d)", (int)fDice, (int)fProb);

+				snprintf(buf, sizeof(buf), "dice(%d) prob(%d)", (int)fDice, (int)fProb);

 

 			LogManager::instance().ItemLog(ch, pItem, "DS_PULL_OUT_SUCCESS", buf);

 

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ëÈ¥¼® ÃßÃâ¿¡ ¼º°øÇÏ¿´½À´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȥ ⿡ Ͽϴ."));

 			pItem->AddToCharacter(ch, DestCell);

 

 			return true;

@@ -521,9 +521,9 @@
 		else

 		{

 			if (pExtractor)

-				sprintf(buf, "dice(%d) prob(%d + %d) EXTR(VN:%d) ByProd(VN:%d)", (int)fDice, (int)fProb, iBonus, pExtractor->GetVnum(), dwByProduct);

+				snprintf(buf, sizeof(buf), "dice(%d) prob(%d + %d) EXTR(VN:%d) ByProd(VN:%d)", (int)fDice, (int)fProb, iBonus, pExtractor->GetVnum(), dwByProduct);

 			else

-				sprintf(buf, "dice(%d) prob(%d) ByProd(VNUM:%d)", (int)fDice, (int)fProb, dwByProduct);

+				snprintf(buf, sizeof(buf), "dice(%d) prob(%d) ByProd(VNUM:%d)", (int)fDice, (int)fProb, dwByProduct);

 

 			LogManager::instance().ItemLog(ch, pItem, "DS_PULL_OUT_FAILED", buf);

 

@@ -534,12 +534,12 @@
 			{

 				LPITEM pByProduct = ch->AutoGiveItem(dwByProduct, true);

 				if (pByProduct)

-					ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ëÈ¥¼® ÃßÃâ¿¡ ½ÇÆÐÇÏ¿© %s¸¦ ¾ò¾ú½À´Ï´Ù.", LC_ITEM(pByProduct->GetVnum())));

+					ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȥ ⿡ Ͽ %s ϴ.", LC_ITEM(pByProduct->GetVnum())));

 				else

-					ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ëÈ¥¼® ÃßÃâ¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+					ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȥ ⿡ Ͽϴ."));

 			}

 			else

-				ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ëÈ¥¼® ÃßÃâ¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+				ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȥ ⿡ Ͽϴ."));

 		}

 	}

 

@@ -561,8 +561,8 @@
 		return false;

 	}

 

-	// È¤½Ã³ª ¸ð¸¦ Áßº¹µÇ´Â item pointer ¾ø¾Ö±â À§ÇØ¼­ set »ç¿ë

-	// ÀÌ»óÇÑ ÆÐÅ¶À» º¸³¾ °æ¿ì, Áßº¹µÈ TItemPos°¡ ÀÖÀ» ¼öµµ ÀÖ°í, Àß¸øµÈ TItemPos°¡ ÀÖÀ» ¼öµµ ÀÖ´Ù.

+	// Ȥó  ߺǴ item pointer ֱ ؼ set 

+	// ̻ Ŷ  , ߺ TItemPos   ְ, ߸ TItemPos   ִ.

 	std::set <LPITEM> set_items;

 	for (int i = 0; i < DRAGON_SOUL_REFINE_GRID_SIZE; i++)

 	{

@@ -572,10 +572,10 @@
 		LPITEM pItem = ch->GetItem(aItemPoses[i]);

 		if (NULL != pItem)

 		{

-			// ¿ëÈ¥¼®ÀÌ ¾Æ´Ñ ¾ÆÀÌÅÛÀÌ °³·®Ã¢¿¡ ÀÖÀ» ¼ö ¾ø´Ù.

+			// ȥ ƴ  â   .

 			if (!pItem->IsDragonSoul())

 			{

-				ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µî±Þ °³·®¿¡ ÇÊ¿äÇÑ Àç·á°¡ ¾Æ´Õ´Ï´Ù."));

+				ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ʿ ᰡ ƴմϴ."));

 				SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pItem->GetWindow(), pItem->GetCell()));

 

 				return false;

@@ -600,7 +600,7 @@
 	BYTE ds_type, grade_idx, step_idx, strength_idx;

 	int result_grade;

 

-	// °¡Àå Ã³À½ °ÍÀ» °­È­ÀÇ ±âÁØÀ¸·Î »ï´Â´Ù.

+	//  ó  ȭ  ´.

 	std::set <LPITEM>::iterator it = set_items.begin();

 	{

 		LPITEM pItem = *it;

@@ -609,7 +609,7 @@
 

 		if (!m_pTable->GetRefineGradeValues(ds_type, grade_idx, need_count, fee, vec_probs))

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µî±Þ °³·®ÇÒ ¼ö ¾ø´Â ¿ëÈ¥¼®ÀÔ´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ȥԴϴ."));

 			SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pItem->GetWindow(), pItem->GetCell()));

 

 			return false;

@@ -619,8 +619,8 @@
 	{

 		LPITEM pItem = *it;

 

-		// Å¬¶ó ui¿¡¼­ ÀåÂøÇÑ ¾ÆÀÌÅÛÀº °³·®Ã¢¿¡ ¿Ã¸± ¼ö ¾øµµ·Ï ¸·¾Ò±â ¶§¹®¿¡,

-		// º°µµÀÇ ¾Ë¸² Ã³¸®´Â ¾ÈÇÔ.

+		// Ŭ ui   â ø   ұ ,

+		//  ˸ ó .

 		if (pItem->IsEquipped())

 		{

 			return false;

@@ -628,14 +628,14 @@
 

 		if (ds_type != GetType(pItem->GetVnum()) || grade_idx != GetGradeIdx(pItem->GetVnum()))

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µî±Þ °³·®¿¡ ÇÊ¿äÇÑ Àç·á°¡ ¾Æ´Õ´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ʿ ᰡ ƴմϴ."));

 			SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pItem->GetWindow(), pItem->GetCell()));

 

 			return false;

 		}

 	}

 

-	// Å¬¶ó¿¡¼­ ÇÑ¹ø °¹¼ö Ã¼Å©¸¦ ÇÏ±â ¶§¹®¿¡ count != need_count¶ó¸é invalid Å¬¶óÀÏ °¡´É¼ºÀÌ Å©´Ù.

+	// Ŭ󿡼 ѹ  üũ ϱ  count != need_count invalid Ŭ ɼ ũ.

 	if (count != need_count)

 	{

 		sys_err("Possiblity of invalid client. Name %s", ch->GetName());

@@ -646,7 +646,7 @@
 

 	if (ch->GetGold() < fee)

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ µ·ÀÌ ºÎÁ·ÇÕ´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ   մϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_NOT_ENOUGH_MONEY, NPOS);

 		return false;

 	}

@@ -689,18 +689,18 @@
 	if (result_grade > grade_idx)

 	{

 		char buf[128];

-		sprintf(buf, "GRADE : %d -> %d", grade_idx, result_grade);

+		snprintf(buf, sizeof(buf), "GRADE : %d -> %d", grade_idx, result_grade);

 		LogManager::instance().ItemLog(ch, pResultItem, "DS_GRADE_REFINE_SUCCESS", buf);

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µî±Þ °³·®¿¡ ¼º°øÇß½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ߽ϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_SUCCEED, TItemPos(pResultItem->GetWindow(), pResultItem->GetCell()));

 		return true;

 	}

 	else

 	{

 		char buf[128];

-		sprintf(buf, "GRADE : %d -> %d", grade_idx, result_grade);

+		snprintf(buf, sizeof(buf), "GRADE : %d -> %d", grade_idx, result_grade);

 		LogManager::instance().ItemLog(ch, pResultItem, "DS_GRADE_REFINE_FAIL", buf);

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µî±Þ °³·®¿¡ ½ÇÆÐÇß½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ߽ϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL, TItemPos(pResultItem->GetWindow(), pResultItem->GetCell()));

 		return false;

 	}

@@ -722,18 +722,18 @@
 		return false;

 	}

 

-	// È¤½Ã³ª ¸ð¸¦ Áßº¹µÇ´Â item pointer ¾ø¾Ö±â À§ÇØ¼­ set »ç¿ë

-	// ÀÌ»óÇÑ ÆÐÅ¶À» º¸³¾ °æ¿ì, Áßº¹µÈ TItemPos°¡ ÀÖÀ» ¼öµµ ÀÖ°í, Àß¸øµÈ TItemPos°¡ ÀÖÀ» ¼öµµ ÀÖ´Ù.

+	// Ȥó  ߺǴ item pointer ֱ ؼ set 

+	// ̻ Ŷ  , ߺ TItemPos   ְ, ߸ TItemPos   ִ.

 	std::set <LPITEM> set_items;

 	for (int i = 0; i < DRAGON_SOUL_REFINE_GRID_SIZE; i++)

 	{

 		LPITEM pItem = ch->GetItem(aItemPoses[i]);

 		if (NULL != pItem)

 		{

-			// ¿ëÈ¥¼®ÀÌ ¾Æ´Ñ ¾ÆÀÌÅÛÀÌ °³·®Ã¢¿¡ ÀÖÀ» ¼ö ¾ø´Ù.

+			// ȥ ƴ  â   .

 			if (!pItem->IsDragonSoul())

 			{

-				ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ü°è °³·®¿¡ ÇÊ¿äÇÑ Àç·á°¡ ¾Æ´Õ´Ï´Ù."));

+				ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ܰ  ʿ ᰡ ƴմϴ."));

 				SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pItem->GetWindow(), pItem->GetCell()));

 				return false;

 			}

@@ -756,7 +756,7 @@
 	BYTE ds_type, grade_idx, step_idx, strength_idx;

 	int result_step;

 

-	// °¡Àå Ã³À½ °ÍÀ» °­È­ÀÇ ±âÁØÀ¸·Î »ï´Â´Ù.

+	//  ó  ȭ  ´.

 	std::set <LPITEM>::iterator it = set_items.begin();

 	{

 		LPITEM pItem = *it;

@@ -764,7 +764,7 @@
 

 		if (!m_pTable->GetRefineStepValues(ds_type, step_idx, need_count, fee, vec_probs))

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ü°è °³·®ÇÒ ¼ö ¾ø´Â ¿ëÈ¥¼®ÀÔ´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ܰ    ȥԴϴ."));

 			SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pItem->GetWindow(), pItem->GetCell()));

 			return false;

 		}

@@ -773,21 +773,21 @@
 	while (++it != set_items.end())

 	{

 		LPITEM pItem = *it;

-		// Å¬¶ó ui¿¡¼­ ÀåÂøÇÑ ¾ÆÀÌÅÛÀº °³·®Ã¢¿¡ ¿Ã¸± ¼ö ¾øµµ·Ï ¸·¾Ò±â ¶§¹®¿¡,

-		// º°µµÀÇ ¾Ë¸² Ã³¸®´Â ¾ÈÇÔ.

+		// Ŭ ui   â ø   ұ ,

+		//  ˸ ó .

 		if (pItem->IsEquipped())

 		{

 			return false;

 		}

 		if (ds_type != GetType(pItem->GetVnum()) || grade_idx != GetGradeIdx(pItem->GetVnum()) || step_idx != GetStepIdx(pItem->GetVnum()))

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ü°è °³·®¿¡ ÇÊ¿äÇÑ Àç·á°¡ ¾Æ´Õ´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ܰ  ʿ ᰡ ƴմϴ."));

 			SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pItem->GetWindow(), pItem->GetCell()));

 			return false;

 		}

 	}

 

-	// Å¬¶ó¿¡¼­ ÇÑ¹ø °¹¼ö Ã¼Å©¸¦ ÇÏ±â ¶§¹®¿¡ count != need_count¶ó¸é invalid Å¬¶óÀÏ °¡´É¼ºÀÌ Å©´Ù.

+	// Ŭ󿡼 ѹ  üũ ϱ  count != need_count invalid Ŭ ɼ ũ.

 	if (count != need_count)

 	{

 		sys_err("Possiblity of invalid client. Name %s", ch->GetName());

@@ -798,7 +798,7 @@
 

 	if (ch->GetGold() < fee)

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ µ·ÀÌ ºÎÁ·ÇÕ´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ   մϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_NOT_ENOUGH_MONEY, NPOS);

 		return false;

 	}

@@ -841,18 +841,18 @@
 	if (result_step > step_idx)

 	{

 		char buf[128];

-		sprintf(buf, "STEP : %d -> %d", step_idx, result_step);

+		snprintf(buf, sizeof(buf), "STEP : %d -> %d", step_idx, result_step);

 		LogManager::instance().ItemLog(ch, pResultItem, "DS_STEP_REFINE_SUCCESS", buf);

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ü°è °³·®¿¡ ¼º°øÇß½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ܰ  ߽ϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_SUCCEED, TItemPos(pResultItem->GetWindow(), pResultItem->GetCell()));

 		return true;

 	}

 	else

 	{

 		char buf[128];

-		sprintf(buf, "STEP : %d -> %d", step_idx, result_step);

+		snprintf(buf, sizeof(buf), "STEP : %d -> %d", step_idx, result_step);

 		LogManager::instance().ItemLog(ch, pResultItem, "DS_STEP_REFINE_FAIL", buf);

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ü°è °³·®¿¡ ½ÇÆÐÇß½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ܰ  ߽ϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL, TItemPos(pResultItem->GetWindow(), pResultItem->GetCell()));

 		return false;

 	}

@@ -887,8 +887,8 @@
 		return false;

 	}

 

-	// È¤½Ã³ª ¸ð¸¦ Áßº¹µÇ´Â item pointer ¾ø¾Ö±â À§ÇØ¼­ set »ç¿ë

-	// ÀÌ»óÇÑ ÆÐÅ¶À» º¸³¾ °æ¿ì, Áßº¹µÈ TItemPos°¡ ÀÖÀ» ¼öµµ ÀÖ°í, Àß¸øµÈ TItemPos°¡ ÀÖÀ» ¼öµµ ÀÖ´Ù.

+	// Ȥó  ߺǴ item pointer ֱ ؼ set 

+	// ̻ Ŷ  , ߺ TItemPos   ְ, ߸ TItemPos   ִ.

 	std::set<LPITEM> set_items;

 	for (int i = 0; i < DRAGON_SOUL_REFINE_GRID_SIZE; i++)

 	{

@@ -907,13 +907,13 @@
 	for (std::set<LPITEM>::iterator it = set_items.begin(); it != set_items.end(); ++it)

 	{

 		LPITEM pItem = *it;

-		// Å¬¶ó ui¿¡¼­ ÀåÂøÇÑ ¾ÆÀÌÅÛÀº °³·®Ã¢¿¡ ¿Ã¸± ¼ö ¾øµµ·Ï ¸·¾Ò±â ¶§¹®¿¡,

-		// º°µµÀÇ ¾Ë¸² Ã³¸®´Â ¾ÈÇÔ.

+		// Ŭ ui   â ø   ұ ,

+		//  ˸ ó .

 		if (pItem->IsEquipped())

 			return false;

 

-		// ¿ëÈ¥¼®°ú °­È­¼®¸¸ÀÌ °³·®Ã¢¿¡ ÀÖÀ» ¼ö ÀÖ´Ù.

-		// ±×¸®°í ÇÏ³ª¾¿¸¸ ÀÖ¾î¾ßÇÑ´Ù.

+		// ȥ ȭ â   ִ.

+		// ׸ ϳ ־Ѵ.

 		if (pItem->IsDragonSoul())

 		{

 			if (pDragonSoul != NULL)

@@ -934,7 +934,7 @@
 		}

 		else

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­¿¡ ÇÊ¿äÇÑ Àç·á°¡ ¾Æ´Õ´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ ʿ ᰡ ƴմϴ."));

 			SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pItem->GetWindow(), pItem->GetCell()));

 			return false;

 		}

@@ -952,17 +952,17 @@
 		GetDragonSoulInfo(pDragonSoul->GetVnum(), bType, bGrade, bStep, bStrength);

 

 		float fWeight = 0.f;

-		// °¡ÁßÄ¡ °ªÀÌ ¾ø´Ù¸é °­È­ÇÒ ¼ö ¾ø´Â ¿ëÈ¥¼®

+		// ġ  ٸ ȭ   ȥ

 		if (!m_pTable->GetWeight(bType, bGrade, bStep, bStrength + 1, fWeight))

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­ÇÒ ¼ö ¾ø´Â ¿ëÈ¥¼®ÀÔ´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ   ȥԴϴ."));

 			SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_MAX_REFINE, TItemPos(pDragonSoul->GetWindow(), pDragonSoul->GetCell()));

 			return false;

 		}

-		// °­È­ÇßÀ» ¶§ °¡ÁßÄ¡°¡ 0ÀÌ¶ó¸é ´õ ÀÌ»ó °­È­µÇ¼­´Â ¾ÈµÈ´Ù.

+		// ȭ  ġ 0̶  ̻ ȭǼ ȵȴ.

 		if (fWeight < FLT_EPSILON)

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­ÇÒ ¼ö ¾ø´Â ¿ëÈ¥¼®ÀÔ´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ   ȥԴϴ."));

 			SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_MAX_REFINE, TItemPos(pDragonSoul->GetWindow(), pDragonSoul->GetCell()));

 			return false;

 		}

@@ -971,14 +971,14 @@
 	float fProb;

 	if (!m_pTable->GetRefineStrengthValues(bType, pRefineStone->GetSubType(), bStrength, fee, fProb))

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­ÇÒ ¼ö ¾ø´Â ¿ëÈ¥¼®ÀÔ´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ   ȥԴϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(pDragonSoul->GetWindow(), pDragonSoul->GetCell()));

 		return false;

 	}

 

 	if (ch->GetGold() < fee)

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ µ·ÀÌ ºÎÁ·ÇÕ´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ   մϴ."));

 		SendRefineResultPacket(ch, DS_SUB_HEADER_REFINE_FAIL_NOT_ENOUGH_MONEY, NPOS);

 		return false;

 	}

@@ -998,7 +998,7 @@
 		}

 

 		char buf[128];

-		sprintf(buf, "STRENGTH : %d -> %d", bStrength, bStrength + 1);

+		snprintf(buf, sizeof(buf), "STRENGTH : %d -> %d", bStrength, bStrength + 1);

 		LogManager::instance().ItemLog(ch, pDragonSoul, "DS_STRENGTH_REFINE_SUCCESS", buf);

 

 		pDragonSoul->CopyAttributeTo(pResult);

@@ -1007,7 +1007,7 @@
 		ITEM_MANAGER::instance().RemoveItem(pDragonSoul, "REMOVE (DS_STRENGTH_REFINE_SUCCESS)");

 		pRefineStone->SetCount(pRefineStone->GetCount() - 1);

 

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­¿¡ ¼º°øÇß½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ ߽ϴ."));

 		ch->AutoGiveItem(pResult, true);

 

 		bSubHeader = DS_SUB_HEADER_REFINE_SUCCEED;

@@ -1028,14 +1028,14 @@
 		bSubHeader = DS_SUB_HEADER_REFINE_FAIL;

 

 		char buf[128];

-		sprintf(buf, "STRENGTH : %d -> %d", bStrength, bStrength - 1);

-		// strength°­È­´Â ½ÇÆÐ½Ã ±úÁú ¼öµµ ÀÖ¾î, ¿øº» ¾ÆÀÌÅÛÀ» ¹ÙÅÁÀ¸·Î ·Î±×¸¦ ³²±è.

+		snprintf(buf, sizeof(buf), "STRENGTH : %d -> %d", bStrength, bStrength - 1);

+		// strengthȭ н   ־,    α׸ .

 		LogManager::instance().ItemLog(ch, pDragonSoul, "DS_STRENGTH_REFINE_FAIL", buf);

 

 		ITEM_MANAGER::instance().RemoveItem(pDragonSoul, "REMOVE (DS_STRENGTH_REFINE_FAIL)");

 		pRefineStone->SetCount(pRefineStone->GetCount() - 1);

 

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­¿¡ ½ÇÆÐÇß½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ ߽ϴ."));

 

 		if (NULL != pResult)

 			ch->AutoGiveItem(pResult, true);

@@ -1107,7 +1107,7 @@
 		}

 		else

 		{

-			lpCh->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­¿¡ ÇÊ¿äÇÑ Àç·á°¡ ¾Æ´Õ´Ï´Ù."));

+			lpCh->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ ʿ ᰡ ƴմϴ."));

 			SendRefineResultPacket(lpCh, DS_SUB_HEADER_REFINE_FAIL_INVALID_MATERIAL, TItemPos(lpItem->GetWindow(), lpItem->GetCell()));

 			return false;

 		}

@@ -1125,7 +1125,7 @@
 		GetDragonSoulInfo(lpDragonSoul->GetVnum(), bType, bGrade, bStep, bStrength);

 		if (bGrade < DRAGON_SOUL_GRADE_MYTH)

 		{

-			lpCh->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­ÇÒ ¼ö ¾ø´Â ¿ëÈ¥¼®ÀÔ´Ï´Ù."));

+			lpCh->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ   ȥԴϴ."));

 			SendRefineResultPacket(lpCh, DS_SUB_HEADER_REFINE_FAIL_MAX_REFINE, TItemPos(lpDragonSoul->GetWindow(), lpDragonSoul->GetCell()));

 			return false;

 		}

@@ -1134,7 +1134,7 @@
 	int64_t iFee = lpRefineMaterial->GetValue(0);

 	if (lpCh->GetGold() < iFee)

 	{

-		lpCh->ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ µ·ÀÌ ºÎÁ·ÇÕ´Ï´Ù."));

+		lpCh->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ   մϴ."));

 		SendRefineResultPacket(lpCh, DS_SUB_HEADER_REFINE_FAIL_NOT_ENOUGH_MONEY, NPOS);

 		return false;

 	}

@@ -1202,12 +1202,12 @@
 	if (pItem == NULL)

 		return false;

 

-	// ÀÏ´ÜÀº timer based on wearÀÎ ¿ëÈ¥¼®¸¸ ½Ã°£ ´Ù µÇ¾îµµ ¾È ¾ø¾îÁø´Ù.

+	// ϴ timer based on wear ȥ ð  Ǿ  .

 	if (pItem->GetProto()->cLimitTimerBasedOnWearIndex >= 0)

 	{

 		return pItem->GetSocket(ITEM_SOCKET_REMAIN_SEC);

 	}

-	// ´Ù¸¥ limit typeÀÎ ¿ëÈ¥¼®µéÀº ½Ã°£ µÇ¸é ¸ðµÎ »ç¶óÁö±â ¶§¹®¿¡ ¿©±â µé¾î¿Â ¾ÆÀÌÅÛÀº ÀÏ´Ü ½Ã°£ÀÌ ³²¾Ò´Ù°í ÆÇ´Ü.

+	// ٸ limit type ȥ ð Ǹ       ϴ ð Ҵٰ Ǵ.

 	else

 	{

 		return INT_MAX;

@@ -1219,12 +1219,12 @@
 	if (pItem == NULL)

 		return false;

 

-	// ÀÏ´ÜÀº timer based on wearÀÎ ¿ëÈ¥¼®¸¸ ½Ã°£ ´Ù µÇ¾îµµ ¾È ¾ø¾îÁø´Ù.

+	// ϴ timer based on wear ȥ ð  Ǿ  .

 	if (pItem->GetProto()->cLimitTimerBasedOnWearIndex >= 0)

 	{

 		return pItem->GetSocket(ITEM_SOCKET_REMAIN_SEC) > 0;

 	}

-	// ´Ù¸¥ limit typeÀÎ ¿ëÈ¥¼®µéÀº ½Ã°£ µÇ¸é ¸ðµÎ »ç¶óÁö±â ¶§¹®¿¡ ¿©±â µé¾î¿Â ¾ÆÀÌÅÛÀº ÀÏ´Ü ½Ã°£ÀÌ ³²¾Ò´Ù°í ÆÇ´Ü.

+	// ٸ limit type ȥ ð Ǹ       ϴ ð Ҵٰ Ǵ.

 	else

 	{

 		return true;

@@ -1256,7 +1256,7 @@
 		if (IsTimeLeftDragonSoul(pItem) && !IsActiveDragonSoul(pItem))

 		{

 			char buf[128];

-			sprintf(buf, "LEFT TIME(%d)", LeftTime(pItem));

+			snprintf(buf, sizeof(buf), "LEFT TIME(%d)", LeftTime(pItem));

 			LogManager::instance().ItemLog(pOwner, pItem, "DS_ACTIVATE", buf);

 			pItem->ModifyPoints(true);

 			pItem->SetSocket(ITEM_SOCKET_DRAGON_SOUL_ACTIVE_IDX, 1);

@@ -1286,7 +1286,7 @@
 	pItem->SetSocket(ITEM_SOCKET_DRAGON_SOUL_ACTIVE_IDX, 0);

 	pItem->ModifyPoints(false);

 

-	sprintf(buf, "LEFT TIME(%d)", LeftTime(pItem));

+	snprintf(buf, sizeof(buf), "LEFT TIME(%d)", LeftTime(pItem));

 	LogManager::instance().ItemLog(pOwner, pItem, "DS_DEACTIVATE", buf);

 

 	if (false == bSkipRefreshOwnerActiveState)


--- a/server/metin2/Source/Server/game/src/battlepass_manager.cpp
+++ b/server/metin2/Source/Server/game/src/battlepass_manager.cpp
@@ -1298,7 +1298,7 @@
 				TPacketGCExtBattlePassGeneralInfo packet;

 				packet.bHeader = HEADER_GC_EXT_BATTLE_PASS_GENERAL_INFO;

 				packet.bBattlePassType = 1;

-				strcpy(packet.szSeasonName, season_name);

+				strlcpy(packet.szSeasonName, season_name, sizeof(packet.szSeasonName));

 				packet.dwBattlePassID = timeInfo[0].bBattlePassId;

 				packet.dwBattlePassStartTime = timeInfo[0].dwStartTime;

 				packet.dwBattlePassEndTime = timeInfo[0].dwEndTime;

@@ -1325,7 +1325,7 @@
 				TPacketGCExtBattlePassGeneralInfo packet;

 				packet.bHeader = HEADER_GC_EXT_BATTLE_PASS_GENERAL_INFO;

 				packet.bBattlePassType = 2;

-				strcpy(packet.szSeasonName, season_name);

+				strlcpy(packet.szSeasonName, season_name, sizeof(packet.szSeasonName));

 				packet.dwBattlePassID = timeInfo[0].bBattlePassId;

 				packet.dwBattlePassStartTime = timeInfo[0].dwStartTime;

 				packet.dwBattlePassEndTime = timeInfo[0].dwEndTime;

@@ -1352,7 +1352,7 @@
 				TPacketGCExtBattlePassGeneralInfo packet;

 				packet.bHeader = HEADER_GC_EXT_BATTLE_PASS_GENERAL_INFO;

 				packet.bBattlePassType = 3;

-				strcpy(packet.szSeasonName, season_name);

+				strlcpy(packet.szSeasonName, season_name, sizeof(packet.szSeasonName));

 				packet.dwBattlePassID = timeInfo[0].bBattlePassId;

 				packet.dwBattlePassStartTime = timeInfo[0].dwStartTime;

 				packet.dwBattlePassEndTime = timeInfo[0].dwEndTime;

@@ -1782,4 +1782,4 @@
 		return false;

 	}

 }

-#endif
+#endif


--- a/server/metin2/Source/Server/game/src/char.cpp
+++ b/server/metin2/Source/Server/game/src/char.cpp
@@ -564,6 +564,8 @@
 	m_iSyncHackCount = 0;

 

 #ifdef ENABLE_EXTENDED_BATTLE_PASS

+	for (TPlayerExtBattlePassMission* pMission : m_listExtBattlePass)

+		delete pMission;

 	m_listExtBattlePass.clear();

 	m_bIsLoadedExtBattlePass = false;

 	m_dwLastReciveExtBattlePassInfoTime = 0;

@@ -634,6 +636,12 @@
 void CHARACTER::Destroy()

 {

 	CloseMyShop();

+#ifdef ENABLE_EXTENDED_BATTLE_PASS

+	for (TPlayerExtBattlePassMission* pMission : m_listExtBattlePass)

+		delete pMission;

+	m_listExtBattlePass.clear();

+	m_bIsLoadedExtBattlePass = false;

+#endif

 #ifdef __OFFLINE_SHOP__

 	RemoveFromViewingOfflineShops();

 #endif

@@ -770,7 +778,7 @@
 				party->Quit(GetVID());

 		}

 

-		SetParty(NULL); // ¾ÈÇØµµ µÇÁö¸¸ ¾ÈÀüÇÏ°Ô.

+		SetParty(NULL); // ص  ϰ.

 	}

 

 	if (m_pkMobInst)

@@ -885,7 +893,7 @@
 {

 	if (!CanHandleItem())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ù¸¥ °Å·¡Áß(Ã¢°í,±³È¯,»óÁ¡)¿¡´Â °³ÀÎ»óÁ¡À» »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٸ ŷ(â,ȯ,) λ   ϴ."));

 		return;

 	}

 

@@ -905,20 +913,20 @@
 

 	if (GetPart(PART_MAIN) > 2)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("°©¿ÊÀ» ¹þ¾î¾ß °³ÀÎ »óÁ¡À» ¿­ ¼ö ÀÖ½À´Ï´Ù."));

-		return;

-	}

-

-	if (GetMyShop()) // ÀÌ¹Ì ¼¥ÀÌ ¿­·Á ÀÖÀ¸¸é ´Ý´Â´Ù.

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("      ֽϴ."));

+		return;

+	}

+

+	if (GetMyShop()) // ̹    ݴ´.

 	{

 		CloseMyShop();

 		return;

 	}

 

-	// ÁøÇàÁßÀÎ Äù½ºÆ®°¡ ÀÖÀ¸¸é »óÁ¡À» ¿­ ¼ö ¾ø´Ù.

+	//  Ʈ     .

 	quest::PC* pPC = quest::CQuestManager::instance().GetPCForce(GetPlayerID());

 

-	// GetPCForce´Â NULLÀÏ ¼ö ¾øÀ¸¹Ç·Î µû·Î È®ÀÎÇÏÁö ¾ÊÀ½

+	// GetPCForce NULL  Ƿ  Ȯ 

 	if (pPC->IsRunning())

 		return;

 

@@ -946,7 +954,7 @@
 	if (GOLD_MAX <= nTotalMoney)

 	{

 		sys_err("[OVERFLOW_GOLD] Overflow (GOLD_MAX) id %u name %s", GetPlayerID(), GetName());

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("20¾ï ³ÉÀ» ÃÊ°úÇÏ¿© »óÁ¡À» ¿­¼ö°¡ ¾ø½À´Ï´Ù"));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("20  ʰϿ   ϴ"));

 		return;

 	}

 

@@ -969,7 +977,7 @@
 

 	if (CBanwordManager::instance().CheckString(m_stShopSign.c_str(), m_stShopSign.length()))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ºñ¼Ó¾î³ª Àº¾î°¡ Æ÷ÇÔµÈ »óÁ¡ ÀÌ¸§À¸·Î »óÁ¡À» ¿­ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӿ  Ե  ̸    ϴ."));

 		return;

 	}

 

@@ -977,7 +985,7 @@
 #if defined(__CHEQUE_SYSTEM__)

 	std::map<DWORD, TItemPriceInfo> itemkind;

 #else

-	std::map<DWORD, DWORD> itemkind; // ¾ÆÀÌÅÛ Á¾·ùº° °¡°Ý, first: vnum, second: ´ÜÀÏ ¼ö·® °¡°Ý

+	std::map<DWORD, DWORD> itemkind; //   , first: vnum, second:   

 #endif

 	// END_OF_MYSHOP_PRICE_LIST

 

@@ -999,19 +1007,19 @@
 

 			if (item_table && (IS_SET(item_table->ullAntiFlags, ITEM_ANTIFLAG_GIVE | ITEM_ANTIFLAG_MYSHOP)))

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("À¯·áÈ­ ¾ÆÀÌÅÛÀº °³ÀÎ»óÁ¡¿¡¼­ ÆÇ¸ÅÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭ  λ Ǹ  ϴ."));

 				return;

 			}

 

 			if (pkItem->IsEquipped() == true)

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀåºñÁßÀÎ ¾ÆÀÌÅÛÀº °³ÀÎ»óÁ¡¿¡¼­ ÆÇ¸ÅÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  λ Ǹ  ϴ."));

 				return;

 			}

 

 			if (true == pkItem->isLocked())

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ç¿ëÁßÀÎ ¾ÆÀÌÅÛÀº °³ÀÎ»óÁ¡¿¡¼­ ÆÇ¸ÅÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  λ Ǹ  ϴ."));

 				return;

 			}

 

@@ -1040,11 +1048,11 @@
 	}

 

 	// MYSHOP_PRICE_LIST

-	// º¸µû¸® °³¼ö¸¦ °¨¼Ò½ÃÅ²´Ù.

-	if (CountSpecifyItem(71049)) // ºñ´Ü º¸µû¸®´Â ¾ø¾ÖÁö ¾Ê°í °¡°ÝÁ¤º¸¸¦ ÀúÀåÇÑ´Ù.

+	//   ҽŲ.

+	if (CountSpecifyItem(71049)) //    ʰ  Ѵ.

 	{

 		//

-		// ¾ÆÀÌÅÛ °¡°ÝÁ¤º¸¸¦ ÀúÀåÇÏ±â À§ÇØ ¾ÆÀÌÅÛ °¡°ÝÁ¤º¸ ÆÐÅ¶À» ¸¸µé¾î DB Ä³½Ã¿¡ º¸³½´Ù.

+		//   ϱ    Ŷ  DB ĳÿ .

 		//

 		TItemPriceListTable header;

 		memset(&header, 0, sizeof(TItemPriceListTable));

@@ -1067,18 +1075,22 @@
 			idx++;

 		}

 

-		db_clientdesc->DBPacket(HEADER_GD_MYSHOP_PRICELIST_UPDATE, GetDesc()->GetHandle(), &header, sizeof(TItemPriceListTable));

+		LPDESC d = GetDesc();

+		if (!d)

+			return;

+

+		db_clientdesc->DBPacket(HEADER_GD_MYSHOP_PRICELIST_UPDATE, d->GetHandle(), &header, sizeof(TItemPriceListTable));

 	}

 	// END_OF_MYSHOP_PRICE_LIST

 	else if (CountSpecifyItem(50200))

 		RemoveSpecifyItem(50200, 1);

 	else

-		return; // º¸µû¸®°¡ ¾øÀ¸¸é Áß´Ü.

+		return; //   ߴ.

 

 	if (m_pkExchange)

 		m_pkExchange->Cancel();

 

-	TPacketGCShopSign p;

+	TPacketGCShopSign p{};

 

 	p.bHeader = HEADER_GC_SHOP_SIGN;

 	p.dwVID = GetVID();

@@ -1100,8 +1112,8 @@
 	{

 		HorseSummon(false, true);

 	}

-	// new mount ÀÌ¿ë Áß¿¡, °³ÀÎ »óÁ¡ ¿­¸é ÀÚµ¿ unmount

-	// StopRidingÀ¸·Î ´º¸¶¿îÆ®±îÁö Ã³¸®ÇÏ¸é ÁÁÀºµ¥ ¿Ö ±×·¸°Ô ¾ÈÇØ³ù´ÂÁö ¾Ë ¼ö ¾ø´Ù.

+	// new mount ̿ ߿,    ڵ unmount

+	// StopRiding Ʈ óϸ   ׷ س   .

 	else if (GetMountVnum())

 	{

 		RemoveAffect(AFFECT_MOUNT);

@@ -1125,7 +1137,7 @@
 		SetMyPrivShopTabCount(1);

 #endif

 

-		TPacketGCShopSign p;

+		TPacketGCShopSign p{};

 

 		p.bHeader = HEADER_GC_SHOP_SIGN;

 		p.dwVID = GetVID();

@@ -1173,41 +1185,41 @@
 		{

 			if (IsHack())

 			{

-				// ¼ºÁö ¸ÊÀÏ°æ¿ì¿¡´Â Ã¼Å© ÇÏÁö ¾Ê´Â´Ù.

+				//  ϰ쿡 üũ  ʴ´.

 				if (false == CThreeWayWar::instance().IsSungZiMapIndex(GetMapIndex()))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ Àç½ÃÀÛ ÇÒ ¼ö ¾ø½À´Ï´Ù. (%dÃÊ ³²À½)", iTimeToDead - (180 - g_nPortalLimitTime)));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ. (%d )", iTimeToDead - (180 - g_nPortalLimitTime)));

 					return;

 				}

 			}

 

 			if (iTimeToDead > 170)

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ Àç½ÃÀÛ ÇÒ ¼ö ¾ø½À´Ï´Ù. (%dÃÊ ³²À½)", iTimeToDead - 170));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ. (%d )", iTimeToDead - 170));

 				return;

 			}

 		}

 	}

 

 	// PREVENT_HACK

-	// DESC : Ã¢°í, ±³È¯ Ã¢ ÈÄ Æ÷Å»À» »ç¿ëÇÏ´Â ¹ö±×¿¡ ÀÌ¿ëµÉ¼ö ÀÖ¾î¼­

-	// ÄðÅ¸ÀÓÀ» Ãß°¡

+	// DESC : â, ȯ â  Ż ϴ ׿ ̿ɼ ־

+	// Ÿ ߰

 	if (bSubCMD == SCMD_RESTART_TOWN)

 	{

 		if (IsHack())

 		{

-			// ±æµå¸Ê, ¼ºÁö¸Ê¿¡¼­´Â Ã¼Å© ÇÏÁö ¾Ê´Â´Ù.

+			// , ʿ üũ  ʴ´.

 			if ((!GetWarMap() || GetWarMap()->GetType() == GUILD_WAR_TYPE_FLAG) ||

 				false == CThreeWayWar::instance().IsSungZiMapIndex(GetMapIndex()))

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ Àç½ÃÀÛ ÇÒ ¼ö ¾ø½À´Ï´Ù. (%dÃÊ ³²À½)", iTimeToDead - (180 - g_nPortalLimitTime)));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ. (%d )", iTimeToDead - (180 - g_nPortalLimitTime)));

 				return;

 			}

 		}

 

 		if (iTimeToDead > 173)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ ¸¶À»¿¡¼­ Àç½ÃÀÛ ÇÒ ¼ö ¾ø½À´Ï´Ù. (%d ÃÊ ³²À½)", iTimeToDead - 173));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("     ϴ. (%d  )", iTimeToDead - 173));

 			return;

 		}

 	}

@@ -1220,7 +1232,7 @@
 	StartRecoveryEvent();

 

 	// FORKED_LOAD

-	// DESC: »ï°Å¸® ÀüÅõ½Ã ºÎÈ°À» ÇÒ°æ¿ì ¸ÊÀÇ ÀÔ±¸°¡ ¾Æ´Ñ »ï°Å¸® ÀüÅõÀÇ ½ÃÀÛÁöÁ¡À¸·Î ÀÌµ¿ÇÏ°Ô µÈ´Ù.

+	// DESC: Ÿ  Ȱ Ұ  Ա ƴ Ÿ   ̵ϰ ȴ.

 	if (1 == quest::CQuestManager::instance().GetEventFlag("threeway_war"))

 	{

 		if (bSubCMD == SCMD_RESTART_TOWN || bSubCMD == SCMD_RESTART_HERE)

@@ -1239,12 +1251,12 @@
 				return;

 			}

 

-			// ¼ºÁö

+			// 

 			if (true == CThreeWayWar::instance().IsSungZiMapIndex(GetMapIndex()))

 			{

 				if (CThreeWayWar::instance().GetReviveTokenForPlayer(GetPlayerID()) <= 0)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ºÁö¿¡¼­ ºÎÈ° ±âÈ¸¸¦ ¸ðµÎ ÀÒ¾ú½À´Ï´Ù! ¸¶À»·Î ÀÌµ¿ÇÕ´Ï´Ù!"));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ȱ ȸ  Ҿϴ!  ̵մϴ!"));

 					WarpSet(EMPIRE_START_X(GetEmpire()), EMPIRE_START_Y(GetEmpire()));

 				}

 				else

@@ -1451,7 +1463,7 @@
 	}

 }

 

-// Entity¿¡ ³»°¡ ³ªÅ¸³µ´Ù°í ÆÐÅ¶À» º¸³½´Ù.

+// Entity  Ÿٰ Ŷ .

 void CHARACTER::EncodeInsertPacket(LPENTITY entity)

 {

 	LPDESC d;

@@ -1459,7 +1471,7 @@
 	if (!(d = entity->GetDesc()))

 		return;

 

-	// ±æµåÀÌ¸§ ¹ö±× ¼öÁ¤ ÄÚµå

+	// ̸   ڵ

 	LPCHARACTER ch = (LPCHARACTER)entity;

 #ifdef __OFFLINE_SHOP__

 	if (IsNPC() && GetRaceNum() == COfflineShop::CLOSED_RACE) {

@@ -1474,7 +1486,7 @@
 	}

 #endif

 	ch->SendGuildName(GetGuild());

-	// ±æµåÀÌ¸§ ¹ö±× ¼öÁ¤ ÄÚµå

+	// ̸   ڵ

 

 	TPacketGCCharacterAdd pack;

 

@@ -1656,7 +1668,7 @@
 

 	if (GetMyShop())

 	{

-		TPacketGCShopSign p;

+		TPacketGCShopSign p{};

 		p.bHeader = HEADER_GC_SHOP_SIGN;

 		p.dwVID = GetVID();

 		strlcpy(p.szSign, m_stShopSign.c_str(), sizeof(p.szSign));

@@ -1889,14 +1901,14 @@
 		{

 			case POS_FIGHTING:

 				if (!IsState(m_stateBattle))

-					MonsterLog("[BATTLE] ½Î¿ì´Â »óÅÂ");

+					MonsterLog("[BATTLE] ο ");

 

 				GotoState(m_stateBattle);

 				break;

 

 			default:

 				if (!IsState(m_stateIdle))

-					MonsterLog("[IDLE] ½¬´Â »óÅÂ");

+					MonsterLog("[IDLE]  ");

 

 				GotoState(m_stateIdle);

 				break;

@@ -2083,7 +2095,7 @@
 {

 	int i = 0;

 

-	// ÀúÀå ¾ÈµÈ ¼ÒÁöÇ°À» ÀüºÎ ÀúÀå½ÃÅ²´Ù.

+	//  ȵ ǰ  Ų.

 	LPITEM item = nullptr;

 

 	for (int i = 0; i < INVENTORY_MAX_NUM; ++i)

@@ -2118,6 +2130,11 @@
 	assert(GetDesc() != NULL);

 

 	sys_log(0, "DISCONNECT: %s (%s)", GetName(), c_pszReason ? c_pszReason : "unset");

+

+	// Definitive PC-shop teardown on owner disconnect.

+	// CloseMyShop() will call CShopManager::DestroyPCShop(this) and null m_pkMyShop.

+	if (GetMyShop())

+		CloseMyShop();

 

 	if (GetShop())

 	{

@@ -2177,7 +2194,19 @@
 	}

 

 	if (GetGuild())

-		GetGuild()->LogoutMember(this);

+		GetGuild()->LogoutMember(this);	// Dungeon re-entry hardening: record disconnect inside dungeons and validate on login.

+	if (CDungeonManager::instance().FindByMapIndex(GetMapIndex()))

+	{

+		SetQuestFlag("dungeon_reentry.logout_time", get_global_time());

+		SetQuestFlag("dungeon_reentry.logout_map", GetMapIndex());

+	}

+	else

+	{

+		SetQuestFlag("dungeon_reentry.logout_time", 0);

+		SetQuestFlag("dungeon_reentry.logout_map", 0);

+	}

+

+

 

 	quest::CQuestManager::instance().LogoutPC(this);

 

@@ -2198,7 +2227,7 @@
 	if (GetParty())

 		GetParty()->Unlink(this);

 

-	// Á×¾úÀ» ¶§ Á¢¼Ó²÷À¸¸é °æÇèÄ¡ ÁÙ°Ô ÇÏ±â

+	// ׾  Ӳ ġ ٰ ϱ

 	if (IsStun() || IsDead())

 	{

 		DeathPenalty(0);

@@ -2215,7 +2244,7 @@
 	SaveAffect();

 	m_bIsLoadedAffect = false;

 

-	m_bSkipSave = true; // ÀÌ ÀÌÈÄ¿¡´Â ´õÀÌ»ó ÀúÀåÇÏ¸é ¾ÈµÈ´Ù.

+	m_bSkipSave = true; //  Ŀ ̻ ϸ ȵȴ.

 

 	quest::CQuestManager::instance().DisconnectPC(this);

 

@@ -2759,7 +2788,7 @@
 	SetSP(t->sp);

 	SetStamina(t->stamina);

 

-	// GMÀÏ¶§ º¸È£¸ðµå

+	// GM϶ ȣ

 	if (GetGMLevel() > GM_LOW_WIZARD)

 		m_afAffectFlag.Set(AFF_YMIR);

 

@@ -2785,7 +2814,7 @@
 	}

 

 #if defined(__PET_SYSTEM__)

-	// NOTE: ÀÏ´Ü Ä³¸¯ÅÍ°¡ PCÀÎ °æ¿ì¿¡¸¸ PetSystemÀ» °®µµ·Ï ÇÔ. À¯·´ ¸Ó½Å´ç ¸Þ¸ð¸® »ç¿ë·ü¶§¹®¿¡ NPC±îÁö ÇÏ±ä Á»..

+	// NOTE: ϴ ĳͰ PC 쿡 PetSystem  .  ӽŴ ޸  NPC ϱ ..

 	if (m_petSystem)

 	{

 		m_petSystem->Destroy();

@@ -2881,9 +2910,9 @@
 		else

 			SetPoint(POINT_DEF_GRADE_BONUS, 15);

 

-		// »êÅ¸¿ë

+		// Ÿ

 		//m_dwPlayStartTime = get_dword_time() + 10 * 60 * 1000;

-		// ½Å¼±ÀÚ ³ëÇØ

+		// ż 

 		m_dwPlayStartTime = get_dword_time() + 30 * 1000;

 		if (test_server)

 			m_dwPlayStartTime = get_dword_time() + 30 * 1000;

@@ -2942,7 +2971,7 @@
 BYTE CHARACTER::GetMobRank() const

 {

 	if (!m_pkMobData)

-		return MOB_RANK_KNIGHT; // PCÀÏ °æ¿ì KNIGHT±Þ

+		return MOB_RANK_KNIGHT; // PC  KNIGHT

 

 	return m_pkMobData->m_table.bRank;

 }

@@ -3018,7 +3047,7 @@
 	float fDamMultiply = GetMobTable().fDamMultiply;

 

 	if (IsBerserk())

-		fDamMultiply = fDamMultiply * 2.0f; // BALANCE: ±¤ÆøÈ­ ½Ã µÎ¹è

+		fDamMultiply = fDamMultiply * 2.0f; // BALANCE: ȭ  ι

 

 	return fDamMultiply;

 }

@@ -3112,7 +3141,7 @@
 		SetPoint(POINT_MAGIC_DEF_GRADE, GetPoint(POINT_DEF_GRADE));

 

 		//

-		// ±âº» ATK = 2lev + 2str, Á÷¾÷¿¡ ¸¶´Ù 2strÀº ¹Ù²ð ¼ö ÀÖÀ½

+		// ⺻ ATK = 2lev + 2str,   2str ٲ  

 		//

 		int iAtk = GetLevel() * 2;

 		int iStatAtk = 0;

@@ -3142,14 +3171,14 @@
 				break;

 		}

 

-		// ¸»À» Å¸°í ÀÖ°í, ½ºÅÈÀ¸·Î ÀÎÇÑ °ø°Ý·ÂÀÌ ST*2 º¸´Ù ³·À¸¸é ST*2·Î ÇÑ´Ù.

-		// ½ºÅÈÀ» Àß¸ø ÂïÀº »ç¶÷ °ø°Ý·ÂÀÌ ´õ ³·Áö ¾Ê°Ô ÇÏ±â À§ÇØ¼­´Ù.

+		//  Ÿ ְ,   ݷ ST*2   ST*2 Ѵ.

+		//  ߸   ݷ   ʰ ϱ ؼ.

 		if (GetMountVnum() && iStatAtk < 2 * GetPoint(POINT_ST))

 			iStatAtk = (2 * GetPoint(POINT_ST));

 

 		iAtk += iStatAtk;

 

-		// ½Â¸¶(¸») : °Ë¼ö¶ó µ¥¹ÌÁö °¨¼Ò

+		// ¸() : ˼  

 		if (GetMountVnum())

 		{

 			if (GetJob() == JOB_SURA && GetSkillGroup() == 1)

@@ -3170,7 +3199,7 @@
 		PointChange(POINT_ATT_GRADE, iAtk);

 

 		// DEF = LEV + CON + ARMOR

-		int iShowDef = GetLevel() + GetPoint(POINT_HT); // For Ymir(Ãµ¸¶)

+		int iShowDef = GetLevel() + GetPoint(POINT_HT); // For Ymir(õ)

 		int iDef = GetLevel() + static_cast<int>((GetPoint(POINT_HT) / 1.25)); // For Other

 		int iArmor = 0;

 

@@ -3250,7 +3279,7 @@
 #endif

 		}

 

-		// ¸» Å¸°í ÀÖÀ» ¶§ ¹æ¾î·ÂÀÌ ¸»ÀÇ ±âÁØ ¹æ¾î·Âº¸´Ù ³·À¸¸é ±âÁØ ¹æ¾î·ÂÀ¸·Î ¼³Á¤

+		//  Ÿ      º    

 		if (IsHorseRiding())

 		{

 			if (iArmor < GetHorseArmor())

@@ -3371,7 +3400,7 @@
 

 	if (IsPC())

 	{

-		// ÃÖ´ë »ý¸í·Â/Á¤½Å·Â

+		// ִ /ŷ

 		iMaxHP = JobInitialPoints[GetJob()].max_hp + m_points.iRandomHP + GetPoint(POINT_HT) * JobInitialPoints[GetJob()].hp_per_ht;

 		iMaxSP = JobInitialPoints[GetJob()].max_sp + m_points.iRandomSP + GetPoint(POINT_IQ) * JobInitialPoints[GetJob()].sp_per_iq;

 		iMaxStamina = JobInitialPoints[GetJob()].max_stamina + GetPoint(POINT_HT) * JobInitialPoints[GetJob()].stamina_per_con;

@@ -3383,7 +3412,7 @@
 			iMaxHP += static_cast<int>(pkSk->kPointPoly.Eval());

 		}

 

-		// ±âº» °ªµé

+		// ⺻ 

 		SetPoint(POINT_MOV_SPEED, 100);

 		SetPoint(POINT_ATT_SPEED, 100);

 		PointChange(POINT_ATT_SPEED, GetPoint(POINT_PARTY_HASTE_BONUS));

@@ -3402,9 +3431,9 @@
 

 	if (IsPC())

 	{

-		// ¸» Å¸°í ÀÖÀ» ¶§´Â ±âº» ½ºÅÈÀÌ ¸»ÀÇ ±âÁØ ½ºÅÈº¸´Ù ³·À¸¸é ³ô°Ô ¸¸µç´Ù.

-		// µû¶ó¼­ ¸»ÀÇ ±âÁØ ½ºÅÈÀÌ ¹«»ç ±âÁØÀÌ¹Ç·Î, ¼ö¶ó/¹«´çÀº ÀüÃ¼ ½ºÅÈ ÇÕÀÌ

-		// ´ëÃ¤ÀûÀ¸·Î ´õ ¿Ã¶ó°¡°Ô µÉ °ÍÀÌ´Ù.

+		//  Ÿ   ⺻    Ⱥ   .

+		//      ̹Ƿ, / ü  

+		// ä  ö󰡰  ̴.

 		if (GetMountVnum())

 		{

 			if (GetHorseST() > GetPoint(POINT_ST))

@@ -3423,13 +3452,13 @@
 

 	ComputeBattlePoints();

 

-	// ±âº» HP/SP ¼³Á¤

+	// ⺻ HP/SP 

 	if (iMaxHP != GetMaxHP())

-		SetRealPoint(POINT_MAX_HP, iMaxHP); // ±âº»HP¸¦ RealPoint¿¡ ÀúÀåÇØ ³õ´Â´Ù.

+		SetRealPoint(POINT_MAX_HP, iMaxHP); // ⺻HP RealPoint  ´.

 	PointChange(POINT_MAX_HP, 0);

 

 	if (iMaxSP != GetMaxSP())

-		SetRealPoint(POINT_MAX_SP, iMaxSP); // ±âº»SP¸¦ RealPoint¿¡ ÀúÀåÇØ ³õ´Â´Ù.

+		SetRealPoint(POINT_MAX_SP, iMaxSP); // ⺻SP RealPoint  ´.

 	PointChange(POINT_MAX_SP, 0);

 

 	SetMaxStamina(iMaxStamina);

@@ -3446,10 +3475,10 @@
 		}

 	}

 

-	// ¿ëÈ¥¼® ½Ã½ºÅÛ

-	// ComputePoints¿¡¼­´Â ÄÉ¸¯ÅÍÀÇ ¸ðµç ¼Ó¼º°ªÀ» ÃÊ±âÈ­ÇÏ°í,

-	// ¾ÆÀÌÅÛ, ¹öÇÁ µî¿¡ °ü·ÃµÈ ¸ðµç ¼Ó¼º°ªÀ» Àç°è»êÇÏ±â ¶§¹®¿¡,

-	// ¿ëÈ¥¼® ½Ã½ºÅÛµµ ActiveDeck¿¡ ÀÖ´Â ¸ðµç ¿ëÈ¥¼®ÀÇ ¼Ó¼º°ªÀ» ´Ù½Ã Àû¿ë½ÃÄÑ¾ß ÇÑ´Ù.

+	// ȥ ý

+	// ComputePoints ɸ  Ӽ ʱȭϰ,

+	// ,   õ  Ӽ ϱ ,

+	// ȥ ý۵ ActiveDeck ִ  ȥ Ӽ ٽ Ѿ Ѵ.

 #if defined(__DRAGON_SOUL_SYSTEM__)

 	if (DragonSoul_IsDeckActivated())

 	{

@@ -3505,9 +3534,9 @@
 	UpdatePacket();

 }

 

-// m_dwPlayStartTimeÀÇ ´ÜÀ§´Â milisecond´Ù. µ¥ÀÌÅÍº£ÀÌ½º¿¡´Â ºÐ´ÜÀ§·Î ±â·ÏÇÏ±â

-// ¶§¹®¿¡ ÇÃ·¹ÀÌ½Ã°£À» °è»êÇÒ ¶§ / 60000 À¸·Î ³ª´²¼­ ÇÏ´Âµ¥, ±× ³ª¸ÓÁö °ªÀÌ ³²¾Ò

-// À» ¶§ ¿©±â¿¡ dwTimeRemainÀ¸·Î ³Ö¾î¼­ Á¦´ë·Î °è»êµÇµµ·Ï ÇØÁÖ¾î¾ß ÇÑ´Ù.

+// m_dwPlayStartTime  milisecond. ͺ̽ д ϱ

+//  ÷̽ð   / 60000   ϴµ,    

+//   ⿡ dwTimeRemain ־  ǵ ־ Ѵ.

 void CHARACTER::ResetPlayTime(DWORD dwTimeRemain)

 {

 	m_dwPlayStartTime = get_dword_time() - dwTimeRemain;

@@ -3532,7 +3561,7 @@
 	if (!ch->IsPC())

 	{

 		//

-		// ¸ó½ºÅÍ È¸º¹

+		//  ȸ

 		//

 		if (ch->IsAffectFlag(AFF_POISON))

 			return PASSES_PER_SEC(MAX(1, ch->GetMobTable().bRegenCycle));

@@ -3613,16 +3642,16 @@
 	else

 	{

 		//

-		// PC È¸º¹

+		// PC ȸ

 		//

 		ch->CheckTarget();

-		//ch->UpdateSectree(); // ¿©±â¼­ ÀÌ°É ¿ÖÇÏÁö?

+		//ch->UpdateSectree(); // ⼭ ̰ ?

 		ch->UpdateKillerMode();

 

 		if (ch->IsAffectFlag(AFF_POISON) == true)

 		{

-			// Áßµ¶ÀÎ °æ¿ì ÀÚµ¿È¸º¹ ±ÝÁö

-			// ÆÄ¹ý¼úÀÎ °æ¿ì ÀÚµ¿È¸º¹ ±ÝÁö

+			// ߵ  ڵȸ 

+			// Ĺ  ڵȸ 

 			return 3;

 		}

 

@@ -3631,8 +3660,8 @@
 

 		int iSec = (get_dword_time() - ch->GetLastMoveTime()) / 3000;

 

-		// SP È¸º¹ ·çÆ¾.

-		// ¿Ö ÀÌ°É·Î ÇØ¼­ ÇÔ¼ö·Î »©³ù´Â°¡ ?!

+		// SP ȸ ƾ.

+		//  ̰ɷ ؼ Լ ° ?!

 		ch->DistributeSP(ch);

 

 		if (ch->GetMaxHP() <= ch->GetHP())

@@ -3663,7 +3692,7 @@
 	if (IsDead() || IsStun())

 		return;

 

-	if (IsNPC() && GetHP() >= GetMaxHP()) // ¸ó½ºÅÍ´Â Ã¼·ÂÀÌ ´Ù Â÷ÀÖÀ¸¸é ½ÃÀÛ ¾ÈÇÑ´Ù.

+	if (IsNPC() && GetHP() >= GetMaxHP()) // ʹ ü    Ѵ.

 		return;

 

 	if (IS_SET(m_pointsInstant.dwAIFlag, AIFLAG_NORECOVERY))

@@ -3715,7 +3744,7 @@
 	m_pointsInstant.fRot = fRot;

 }

 

-// x, y ¹æÇâÀ¸·Î º¸°í ¼±´Ù.

+// x, y   .

 void CHARACTER::SetRotationToXY(long x, long y)

 {

 	SetRotation(GetDegreeFromPositionXY(GetX(), GetY(), x, y));

@@ -3731,17 +3760,17 @@
 	if (CannotMoveByAffect())

 		return false;

 

-	if (GetMyShop()) // »óÁ¡ ¿¬ »óÅÂ¿¡¼­´Â ¿òÁ÷ÀÏ ¼ö ¾øÀ½

+	if (GetMyShop()) //   ¿   

 		return false;

 

-	// 0.2ÃÊ ÀüÀÌ¶ó¸é ¿òÁ÷ÀÏ ¼ö ¾ø´Ù.

+	// 0.2 ̶   .

 	//if (get_float_time() - m_fSyncTime < 0.2f)

 	//	return false;

 

 	return true;

 }

 

-// ¹«Á¶°Ç x, y À§Ä¡·Î ÀÌµ¿ ½ÃÅ²´Ù.

+//  x, y ġ ̵ Ų.

 bool CHARACTER::Sync(long x, long y)

 {

 	if (!GetSectree())

@@ -3772,7 +3801,7 @@
 

 	if (GetDungeon())

 	{

-		// ´øÁ¯¿ë ÀÌº¥Æ® ¼Ó¼º º¯È­

+		//  ̺Ʈ Ӽ ȭ

 		int iLastEventAttr = m_iEventAttr;

 		m_iEventAttr = new_tree->GetEventAttribute(x, y);

 

@@ -3823,7 +3852,7 @@
 void CHARACTER::Stop()

 {

 	if (!IsState(m_stateIdle))

-		MonsterLog("[IDLE] Á¤Áö");

+		MonsterLog("[IDLE] ");

 

 	GotoState(m_stateIdle);

 

@@ -3833,8 +3862,8 @@
 

 bool CHARACTER::Goto(long x, long y)

 {

-	// TODO °Å¸®Ã¼Å© ÇÊ¿ä

-	// °°Àº À§Ä¡¸é ÀÌµ¿ÇÒ ÇÊ¿ä ¾øÀ½ (ÀÚµ¿ ¼º°ø)

+	// TODO Ÿüũ ʿ

+	//  ġ ̵ ʿ  (ڵ )

 	if (GetX() == x && GetY() == y)

 		return false;

 

@@ -3967,17 +3996,17 @@
 	m_dwMoveStartTime = get_dword_time();

 }

 

-// x y À§Ä¡·Î ÀÌµ¿ ÇÑ´Ù. (ÀÌµ¿ÇÒ ¼ö ÀÖ´Â °¡ ¾ø´Â °¡¸¦ È®ÀÎ ÇÏ°í Sync ¸Þ¼Òµå·Î ½ÇÁ¦ ÀÌµ¿ ÇÑ´Ù)

-// ¼­¹ö´Â charÀÇ x, y °ªÀ» ¹Ù·Î ¹Ù²ÙÁö¸¸,

-// Å¬¶ó¿¡¼­´Â ÀÌÀü À§Ä¡¿¡¼­ ¹Ù²Û x, y±îÁö interpolationÇÑ´Ù.

-// °È°Å³ª ¶Ù´Â °ÍÀº charÀÇ m_bNowWalking¿¡ ´Þ·ÁÀÖ´Ù.

-// Warp¸¦ ÀÇµµÇÑ °ÍÀÌ¶ó¸é Show¸¦ »ç¿ëÇÒ °Í.

+// x y ġ ̵ Ѵ. (̵  ִ    Ȯ ϰ Sync ޼ҵ  ̵ Ѵ)

+//  char x, y  ٷ ٲ,

+// Ŭ󿡼  ġ ٲ x, y interpolationѴ.

+// Ȱų ٴ  char m_bNowWalking ޷ִ.

+// Warp ǵ ̶ Show  .

 bool CHARACTER::Move(long x, long y)

 {

 	if (IsPC() && IsDead())

 		return false;

 

-	// °°Àº À§Ä¡¸é ÀÌµ¿ÇÒ ÇÊ¿ä ¾øÀ½ (ÀÚµ¿ ¼º°ø)

+	//  ġ ̵ ʿ  (ڵ )

 	if (GetX() == x && GetY() == y)

 		return true;

 

@@ -4171,7 +4200,7 @@
 

 	m_pointsInstant.points[wPointType] = lPointValue;

 

-	// ¾ÆÁ÷ ÀÌµ¿ÀÌ ´Ù ¾È³¡³µ´Ù¸é ÀÌµ¿ ½Ã°£ °è»êÀ» ´Ù½Ã ÇØ¾ß ÇÑ´Ù.

+	//  ̵  ȳٸ ̵ ð  ٽ ؾ Ѵ.

 	if (wPointType == POINT_MOV_SPEED && get_dword_time() < m_dwMoveStartTime + m_dwMoveDuration)

 	{

 		CalculateMoveDuration();

@@ -4218,7 +4247,7 @@
 

 			sys_log(0, "LEVELUP: %s %d NEXT EXP %d", GetName(), GetLevel(), GetNextExp());

 

-			// WOLFMAN ¼öÀÎÁ· Æ¯¼öÃ³¸® (¼öÀÎÁ·Àº Á÷±ºÀÌ ÇÏ³ªÀÌ¹Ç·Î, 5·¹º§ÀÌ µÇ¸é ¹«Á¶°Ç 1¹ø Á÷±ºÀ¸·Î ¼³Á¤ÇÔ. ÇÏµåÄÚµù ¤¸¤µ)

+			// WOLFMAN  Ưó (  ϳ̹Ƿ, 5 Ǹ  1  . ϵڵ )

 			if (GetJob() == JOB_WOLFMAN)

 			{

 				if ((5 <= val) && (GetSkillGroup() != 1))

@@ -4257,7 +4286,7 @@
 		case POINT_NEXT_EXP:

 		{

 			val = GetNextExp();

-			bAmount = false; // ¹«Á¶°Ç bAmount´Â false ¿©¾ß ÇÑ´Ù.

+			bAmount = false; //  bAmount false  Ѵ.

 		} break;

 

 		case POINT_EXP:

@@ -4265,7 +4294,7 @@
 			DWORD exp = GetExp();

 			DWORD next_exp = GetNextExp();

 

-			// exp°¡ 0 ÀÌÇÏ·Î °¡Áö ¾Êµµ·Ï ÇÑ´Ù

+			// exp 0 Ϸ  ʵ Ѵ

 			if (amount < 0 && exp <= -amount)

 			{

 				sys_log(0, "%s - Reduce EXP by %d, CUR EXP: %d (setting to zero)", GetName(), -amount, exp);

@@ -4286,14 +4315,14 @@
 #endif

 

 #if defined(__CHATTING_WINDOW_RENEWAL__)

-				ChatPacket(CHAT_TYPE_EXP_INFO, LC_STRING("%dÀÇ °æÇèÄ¡¸¦ È¹µæÇß½À´Ï´Ù.", amount));

+				ChatPacket(CHAT_TYPE_EXP_INFO, LC_STRING("%d ġ ȹ߽ϴ.", amount));

 #else

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("%dÀÇ °æÇèÄ¡¸¦ È¹µæÇß½À´Ï´Ù.", amount));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("%d ġ ȹ߽ϴ.", amount));

 #endif

 

 				DWORD iExpBalance = 0;

 

-				// ·¹º§ ¾÷!

+				//  !

 				if (exp + amount >= next_exp)

 				{

 					iExpBalance = (exp + amount) - next_exp;

@@ -4326,7 +4355,7 @@
 				DWORD q = DWORD(next_exp / 4.0f);

 				int iLevStep = GetRealPoint(POINT_LEVEL_STEP);

 

-				// iLevStepÀÌ 4 ÀÌ»óÀÌ¸é ·¹º§ÀÌ ¿Ã¶ú¾î¾ß ÇÏ¹Ç·Î ¿©±â¿¡ ¿Ã ¼ö ¾ø´Â °ªÀÌ´Ù.

+				// iLevStep 4 ̸̻  ö ϹǷ ⿡    ̴.

 				if (iLevStep >= 4)

 				{

 					sys_err("%s LEVEL_STEP bigger than 4! (%d)", GetName(), iLevStep);

@@ -4429,14 +4458,36 @@
 

 		case POINT_HP:

 		{

-			if (IsDead() || IsStun())

+			if (IsDead())

+				return;

+

+			// Allow damage while stunned; only block healing to avoid odd client states.

+			if (amount > 0 && IsStun())

 				return;

 

 			int prev_hp = GetHP();

 

 			amount = MIN(GetMaxHP() - GetHP(), amount);

 			SetHP(GetHP() + amount);

+

+			// [Fix] If HP reaches 0 or below, force death immediately (prevents 0 HP immortality under lag)

+			if (GetHP() <= 0)

+			{

+				SetHP(0);

+				val = 0;

+				Dead();

+				return;

+			}

+			SetHP(GetHP() + amount);

 			val = GetHP();

+

+			// [Fix] 0 HP glitch: force death immediately when HP drops to 0 or below.

+			if (val <= 0)

+			{

+				SetHP(0);

+				Dead();

+				return;

+			}

 

 			BroadcastTargetPacket();

 

@@ -4468,16 +4519,16 @@
 

 			if (val == 0)

 			{

-				// Stamina°¡ ¾øÀ¸´Ï °ÈÀÚ!

+				// Stamina  !

 				SetNowWalking(true);

 			}

 			else if (prev_val == 0)

 			{

-				// ¾ø´ø ½ºÅ×¹Ì³ª°¡ »ý°åÀ¸´Ï ÀÌÀü ¸ðµå º¹±Í

+				//  ׹̳    

 				ResetWalking();

 			}

 

-			if (amount < 0 && val != 0) // °¨¼Ò´Â º¸³»Áö¾Ê´Â´Ù.

+			if (amount < 0 && val != 0) // Ҵ ʴ´.

 				return;

 		}

 		break;

@@ -4487,7 +4538,7 @@
 			SetPoint(type, GetPoint(type) + amount);

 

 			//SetMaxHP(GetMaxHP() + amount);

-			// ÃÖ´ë »ý¸í·Â = (±âº» ÃÖ´ë »ý¸í·Â + Ãß°¡) * ÃÖ´ë»ý¸í·Â%

+			// ִ  = (⺻ ִ  + ߰) * ִ%

 			int curMaxHP = GetMaxHP();

 			int hp = GetRealPoint(POINT_MAX_HP);

 			int add_hp = MIN(3500, hp * GetPoint(POINT_MAX_HP_PCT) / 100);

@@ -4517,7 +4568,7 @@
 			SetPoint(type, GetPoint(type) + amount);

 

 			//SetMaxSP(GetMaxSP() + amount);

-			// ÃÖ´ë Á¤½Å·Â = (±âº» ÃÖ´ë Á¤½Å·Â + Ãß°¡) * ÃÖ´ëÁ¤½Å·Â%

+			// ִ ŷ = (⺻ ִ ŷ + ߰) * ִŷ%

 			int curMaxSP = GetMaxSP();

 			int sp = GetRealPoint(POINT_MAX_SP);

 			int add_sp = MIN(800, sp * GetPoint(POINT_MAX_SP_PCT) / 100);

@@ -4620,12 +4671,12 @@
 		case POINT_HP_RECOVERY:

 		case POINT_SP_RECOVERY:

 

-		case POINT_ATTBONUS_HUMAN: // 42 ÀÎ°£¿¡°Ô °­ÇÔ

-		case POINT_ATTBONUS_ANIMAL: // 43 µ¿¹°¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-		case POINT_ATTBONUS_ORC: // 44 ¿õ±Í¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-		case POINT_ATTBONUS_MILGYO: // 45 ¹Ð±³¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-		case POINT_ATTBONUS_UNDEAD: // 46 ½ÃÃ¼¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-		case POINT_ATTBONUS_DEVIL: // 47 ¸¶±Í(¾Ç¸¶)¿¡°Ô µ¥¹ÌÁö % Áõ°¡

+		case POINT_ATTBONUS_HUMAN: // 42 ΰ 

+		case POINT_ATTBONUS_ANIMAL: // 43   % 

+		case POINT_ATTBONUS_ORC: // 44 Ϳ  % 

+		case POINT_ATTBONUS_MILGYO: // 45 б  % 

+		case POINT_ATTBONUS_UNDEAD: // 46 ü  % 

+		case POINT_ATTBONUS_DEVIL: // 47 (Ǹ)  % 

 		case POINT_ATTBONUS_INSECT:

 		case POINT_ATTBONUS_DESERT:

 

@@ -4651,11 +4702,11 @@
 		case POINT_RESIST_PENETRATE:

 		case POINT_CURSE_PCT:

 

-		case POINT_STEAL_HP: // 48 »ý¸í·Â Èí¼ö

-		case POINT_STEAL_SP: // 49 Á¤½Å·Â Èí¼ö

-

-		case POINT_MANA_BURN_PCT: // 50 ¸¶³ª ¹ø

-		case POINT_DAMAGE_SP_RECOVER: // 51 °ø°Ý´çÇÒ ½Ã Á¤½Å·Â È¸º¹ È®·ü

+		case POINT_STEAL_HP: // 48  

+		case POINT_STEAL_SP: // 49 ŷ 

+

+		case POINT_MANA_BURN_PCT: // 50  

+		case POINT_DAMAGE_SP_RECOVER: // 51 ݴ  ŷ ȸ Ȯ

 		case POINT_RESIST_NORMAL_DAMAGE:

 		case POINT_RESIST_SWORD:

 		case POINT_RESIST_TWOHAND:

@@ -4675,12 +4726,12 @@
 		case POINT_RESIST_ICE:

 		case POINT_RESIST_EARTH:

 		case POINT_RESIST_DARK:

-		case POINT_REFLECT_MELEE: // 67 °ø°Ý ¹Ý»ç

-		case POINT_REFLECT_CURSE: // 68 ÀúÁÖ ¹Ý»ç

-		case POINT_POISON_REDUCE: // 69 µ¶µ¥¹ÌÁö °¨¼Ò

+		case POINT_REFLECT_MELEE: // 67  ݻ

+		case POINT_REFLECT_CURSE: // 68  ݻ

+		case POINT_POISON_REDUCE: // 69  

 		case POINT_BLEEDING_REDUCE:

 

-		case POINT_KILL_SP_RECOVER: // 70 Àû ¼Ò¸ê½Ã MP È¸º¹

+		case POINT_KILL_SP_RECOVER: // 70  Ҹ MP ȸ

 		case POINT_KILL_HP_RECOVERY: // 75

 		case POINT_HIT_HP_RECOVERY:

 		case POINT_HIT_SP_RECOVERY:

@@ -5181,7 +5232,7 @@
 

 				DWORD iExpBalance = 0;

 

-				// ·¹º§ ¾÷!

+				//  !

 				if (exp + amount >= next_exp)

 				{

 					iExpBalance = (exp + amount) - next_exp;

@@ -5307,6 +5358,31 @@
 			sys_err("CHARACTER::PointChange: %s: unknown point change type %d", GetName(), type);

 			return;

 	}

+	// [Security] If base stats drop, force-unequip items that no longer meet requirements.

+	if ((type == POINT_ST || type == POINT_HT || type == POINT_DX || type == POINT_IQ) && amount < 0)

+	{

+		for (int i = 0; i < WEAR_MAX_NUM; ++i)

+		{

+			LPITEM pWear = GetWear(i);

+			if (!pWear)

+				continue;

+

+			if (!CanEquipNow(pWear))

+			{

+				if (!UnequipItem(pWear))

+				{

+					PIXEL_POSITION pos = GetXYZ();

+					pWear->RemoveFromCharacter();

+

+					if (pWear->AddToGround(GetMapIndex(), pos))

+						pWear->SetOwnership(this, 60);

+					else

+						ITEM_MANAGER::instance().RemoveItem(pWear, "FORCE_UNEQUIP_STAT_DROP");

+				}

+			}

+		}

+	}

+

 

 	switch (type)

 	{

@@ -5344,11 +5420,11 @@
 		case APPLY_NONE:						// 0

 			break;

 

-			// NOTE: ¾ÆÀÌÅÛ¿¡ ÀÇÇÑ ÃÖ´ëHP º¸³Ê½º³ª Äù½ºÆ® º¸»ó º¸³Ê½º°¡ ¶È°°Àº ¹æ½ÄÀ» »ç¿ëÇÏ¹Ç·Î

-			// ±×³É MAX_HP¸¸ °è»êÇÏ¸é Äù½ºÆ® º¸»óÀÇ °æ¿ì ¹®Á¦°¡ »ý±è. »ç½Ç ¿ø·¡ ÀÌÂÊÀÌ ÇÕ¸®ÀûÀÌ±âµµ ÇÏ°í..

-			// ¹Ù²Û °ø½ÄÀº ÇöÀç ÃÖ´ë hp¿Í º¸À¯ hpÀÇ ºñÀ²À» ±¸ÇÑ µÚ ¹Ù²ð ÃÖ´ë hp¸¦ ±âÁØÀ¸·Î hp¸¦ º¸Á¤ÇÑ´Ù.

-			// ¿ø·¡ PointChange¿¡¼­ ÇÏ´Â°Ô ÁÁÀ»°Í °°Àºµ¥ ¼³°è ¹®Á¦·Î ¾î·Á¿ö¼­ skip..

-			// SPµµ ¶È°°ÀÌ °è»êÇÑ´Ù.

+			// NOTE: ۿ  ִHP ʽ Ʈ  ʽ Ȱ  ϹǷ

+			// ׳ MAX_HP ϸ Ʈ    .    ո̱⵵ ϰ..

+			// ٲ   ִ hp  hp    ٲ ִ hp  hp Ѵ.

+			//  PointChange ϴ°      skip..

+			// SP Ȱ Ѵ.

 			// Mantis : 101460 ~ ity ~

 		case APPLY_MAX_HP:						// 1

 		{

@@ -5431,7 +5507,7 @@
 		case APPLY_SKILL:						// 51

 			// SKILL_DAMAGE_BONUS

 		{

-			// ÃÖ»óÀ§ ºñÆ® ±âÁØÀ¸·Î 8ºñÆ® vnum, 9ºñÆ® add, 15ºñÆ® change

+			// ֻ Ʈ  8Ʈ vnum, 9Ʈ add, 15Ʈ change

 			// 00000000 00000000 00000000 00000000

 			// ^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^^^^^

 			// vnum		^ add		change

@@ -5499,25 +5575,25 @@
 		case APPLY_PC_BANG_EXP_BONUS:			// 75

 		case APPLY_PC_BANG_DROP_BONUS:			// 76

 

-			//case APPLY_EXTRACT_HP_PCT:			// 77 »ç¿ë½Ã HP ¼Ò¸ð

+			//case APPLY_EXTRACT_HP_PCT:			// 77  HP Ҹ

 

 		case APPLY_RESIST_WARRIOR:				// 78

 		case APPLY_RESIST_ASSASSIN:				// 79

 		case APPLY_RESIST_SURA:					// 80

 		case APPLY_RESIST_SHAMAN:				// 81

 

-		case APPLY_ENERGY:						// 82 ±â·Â

-		case APPLY_DEF_GRADE:					// 83 ¹æ¾î·Â. DEF_GRADE_BONUS´Â Å¬¶ó¿¡¼­ µÎ¹è·Î º¸¿©Áö´Â ÀÇµµµÈ ¹ö±×(...)°¡ ÀÖ´Ù.

-		case APPLY_COSTUME_ATTR_BONUS:			// 84 ÄÚ½ºÆ¬ ¾ÆÀÌÅÛ¿¡ ºÙÀº ¼Ó¼ºÄ¡ º¸³Ê½º

-		case APPLY_MAGIC_ATTBONUS_PER:			// 85 ¸¶¹ý °ø°Ý·Â +x%

-		case APPLY_MELEE_MAGIC_ATTBONUS_PER:	// 86 ¸¶¹ý + ¹Ð¸® °ø°Ý·Â +x%

-

-		case APPLY_RESIST_ICE:					// 87 ³Ã±â ÀúÇ×

-		case APPLY_RESIST_EARTH:				// 88 ´ëÁö ÀúÇ×

-		case APPLY_RESIST_DARK:					// 89 ¾îµÒ ÀúÇ×

-

-		case APPLY_ANTI_CRITICAL_PCT:			// 90 Å©¸®Æ¼ÄÃ ÀúÇ×

-		case APPLY_ANTI_PENETRATE_PCT:			// 91 °üÅëÅ¸°Ý ÀúÇ×

+		case APPLY_ENERGY:						// 82 

+		case APPLY_DEF_GRADE:					// 83 . DEF_GRADE_BONUS Ŭ󿡼 ι  ǵ (...) ִ.

+		case APPLY_COSTUME_ATTR_BONUS:			// 84 ڽƬ ۿ  Ӽġ ʽ

+		case APPLY_MAGIC_ATTBONUS_PER:			// 85  ݷ +x%

+		case APPLY_MELEE_MAGIC_ATTBONUS_PER:	// 86  + и ݷ +x%

+

+		case APPLY_RESIST_ICE:					// 87 ñ 

+		case APPLY_RESIST_EARTH:				// 88  

+		case APPLY_RESIST_DARK:					// 89  

+

+		case APPLY_ANTI_CRITICAL_PCT:			// 90 ũƼ 

+		case APPLY_ANTI_PENETRATE_PCT:			// 91 Ÿ 

 

 		case APPLY_BLEEDING_REDUCE:				// 92

 		case APPLY_BLEEDING_PCT:				// 93

@@ -5844,7 +5920,7 @@
 	else

 		len += len2;

 

-	// \0 ¹®ÀÚ Æ÷ÇÔ

+	// \0  

 	++len;

 

 	va_end(args);

@@ -5936,7 +6012,7 @@
 	{

 		sys_log(0, "XXX MINING CANCEL");

 		event_cancel(&m_pkMiningEvent);

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ã¤±¤À» Áß´ÜÇÏ¿´½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ä ߴϿϴ."));

 	}

 }

 

@@ -5964,13 +6040,13 @@
 

 	if (!pick || pick->GetType() != ITEM_PICK)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("°î±ªÀÌ¸¦ ÀåÂøÇÏ¼¼¿ä."));

-		return;

-	}

-

-	int count = number(5, 15); // µ¿ÀÛ È½¼ö, ÇÑ µ¿ÀÛ´ç 2ÃÊ

-

-	// Ã¤±¤ µ¿ÀÛÀ» º¸¿©ÁÜ

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("̸ ϼ."));

+		return;

+	}

+

+	int count = number(5, 15); //  Ƚ,  ۴ 2

+

+	// ä  

 	TPacketGCDigMotion p;

 	p.header = HEADER_GC_DIG_MOTION;

 	p.vid = GetVID();

@@ -5997,7 +6073,7 @@
 		return;

 	}

 

-	// ¸ø°¨ ¼Ó¼º¿¡¼­ ³¬½Ã¸¦ ½ÃµµÇÑ´Ù?

+	//  Ӽ ø õѴ?

 	{

 		LPSECTREE_MAP pkSectreeMap = SECTREE_MANAGER::instance().GetMap(GetMapIndex());

 

@@ -6009,7 +6085,7 @@
 

 		if (IS_SET(dwAttr, ATTR_BLOCK))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("³¬½Ã¸¦ ÇÒ ¼ö ÀÖ´Â °÷ÀÌ ¾Æ´Õ´Ï´Ù"));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ø   ִ  ƴմϴ"));

 			return;

 		}

 	}

@@ -6038,16 +6114,16 @@
 

 	LPITEM rod = GetWear(WEAR_WEAPON);

 

-	// ³¬½Ã´ë ÀåÂø

+	// ô 

 	if (!rod || rod->GetType() != ITEM_ROD)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("³¬½Ã´ë¸¦ ÀåÂø ÇÏ¼¼¿ä."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ô븦  ϼ."));

 		return;

 	}

 

 	if (0 == rod->GetSocket(2))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹Ì³¢¸¦ ³¢°í ´øÁ® ÁÖ¼¼¿ä."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("̳   ּ."));

 		return;

 	}

 

@@ -6083,7 +6159,7 @@
 	}

 	else

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("³¬½Ã´ë°¡ ¾Æ´Ñ ¹°°ÇÀ¸·Î ³¬½Ã¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù!"));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ô밡 ƴ  ø   ϴ!"));

 	}

 

 	event_cancel(&m_pkFishingEvent);

@@ -6123,10 +6199,10 @@
 	m_dwNextStatePulse = iNextPulse;

 

 	if (iNextPulse < 10)

-		MonsterLog("´ÙÀ½»óÅÂ·Î¾î¼­°¡ÀÚ");

-}

-

-// Ä³¸¯ÅÍ ÀÎ½ºÅÏ½º ¾÷µ¥ÀÌÆ® ÇÔ¼ö.

+		MonsterLog("·ξ");

+}

+

+// ĳ νϽ Ʈ Լ.

 void CHARACTER::UpdateCharacter(DWORD dwPulse)

 {

 	CFSM::Update();

@@ -6194,7 +6270,7 @@
 	switch (bPartPos)

 	{

 		case PART_MAIN:

-			if (!IsPC()) // PC°¡ ¾Æ´Ñ °æ¿ì ÇöÀç ÆÄÆ®¸¦ ±×´ë·Î ¸®ÅÏ

+			if (!IsPC()) // PC ƴ   Ʈ ״ 

 				return GetPart(PART_MAIN);

 			else

 				return m_pointsInstant.bBasePart;

@@ -6257,7 +6333,7 @@
 		if (m_pkChrSyncOwner)

 			sys_log(1, "SyncRelease %s %p from %s", GetName(), this, m_pkChrSyncOwner->GetName());

 

-		// ¸®½ºÆ®¿¡¼­ Á¦°ÅÇÏÁö ¾Ê´õ¶óµµ Æ÷ÀÎÅÍ´Â NULL·Î ¼ÂÆÃµÇ¾î¾ß ÇÑ´Ù.

+		// Ʈ  ʴ ʹ NULL õǾ Ѵ.

 		m_pkChrSyncOwner = NULL;

 	}

 	else

@@ -6265,12 +6341,12 @@
 		if (!IsSyncOwner(ch))

 			return false;

 

-		// °Å¸®°¡ 200 ÀÌ»óÀÌ¸é SyncOwner°¡ µÉ ¼ö ¾ø´Ù.

+		// Ÿ 200 ̸̻ SyncOwner   .

 		if (DISTANCE_APPROX(GetX() - ch->GetX(), GetY() - ch->GetY()) > 250)

 		{

 			sys_log(1, "SetSyncOwner distance over than 250 %s %s", GetName(), ch->GetName());

 

-			// SyncOwnerÀÏ °æ¿ì Owner·Î Ç¥½ÃÇÑ´Ù.

+			// SyncOwner  Owner ǥѴ.

 			if (m_pkChrSyncOwner == ch)

 				return true;

 

@@ -6288,7 +6364,7 @@
 			m_pkChrSyncOwner = ch;

 			m_pkChrSyncOwner->m_kLst_pkChrSyncOwned.push_back(this);

 

-			// SyncOwner°¡ ¹Ù²î¸é LastSyncTimeÀ» ÃÊ±âÈ­ÇÑ´Ù.

+			// SyncOwner ٲ LastSyncTime ʱȭѴ.

 			static const timeval zero_tv = { 0, 0 };

 			SetLastSyncTime(zero_tv);

 

@@ -6298,9 +6374,9 @@
 		m_fSyncTime = get_float_time();

 	}

 

-	// TODO: Sync Owner°¡ °°´õ¶óµµ °è¼Ó ÆÐÅ¶À» º¸³»°í ÀÖÀ¸¹Ç·Î,

-	// µ¿±âÈ­ µÈ ½Ã°£ÀÌ 3ÃÊ ÀÌ»ó Áö³µÀ» ¶§ Ç®¾îÁÖ´Â ÆÐÅ¶À»

-	// º¸³»´Â ¹æ½ÄÀ¸·Î ÇÏ¸é ÆÐÅ¶À» ÁÙÀÏ ¼ö ÀÖ´Ù.

+	// TODO: Sync Owner   Ŷ  Ƿ,

+	// ȭ  ð 3 ̻   Ǯִ Ŷ

+	//   ϸ Ŷ   ִ.

 	TPacketGCOwnership pack;

 

 	pack.bHeader = HEADER_GC_OWNERSHIP;

@@ -6316,7 +6392,7 @@
 	void operator () (LPCHARACTER ch)

 	{

 		assert(ch != NULL);

-		ch->SetSyncOwner(NULL, false); // false ÇÃ·¡±×·Î ÇØ¾ß for_each °¡ Á¦´ë·Î µ·´Ù.

+		ch->SetSyncOwner(NULL, false); // false ÷׷ ؾ for_each   .

 	}

 };

 

@@ -6324,7 +6400,7 @@
 {

 	SetSyncOwner(NULL);

 

-	// ¾Æ·¡ for_each¿¡¼­ ³ª¸¦ m_pkChrSyncOwner·Î °¡Áø ÀÚµéÀÇ Æ÷ÀÎÅÍ¸¦ NULL·Î ÇÑ´Ù.

+	// Ʒ for_each  m_pkChrSyncOwner  ڵ ͸ NULL Ѵ.

 	std::for_each(m_kLst_pkChrSyncOwned.begin(), m_kLst_pkChrSyncOwned.end(), FuncClearSync());

 	m_kLst_pkChrSyncOwned.clear();

 }

@@ -6334,8 +6410,8 @@
 	if (m_pkChrSyncOwner == ch)

 		return true;

 

-	// ¸¶Áö¸·À¸·Î µ¿±âÈ­ µÈ ½Ã°£ÀÌ 3ÃÊ ÀÌ»ó Áö³µ´Ù¸é ¼ÒÀ¯±ÇÀÌ ¾Æ¹«¿¡°Ôµµ

-	// ¾ø´Ù. µû¶ó¼­ ¾Æ¹«³ª SyncOwnerÀÌ¹Ç·Î true ¸®ÅÏ

+	//  ȭ  ð 3 ̻ ٸ  ƹԵ

+	// .  ƹ SyncOwner̹Ƿ true 

 	if (get_float_time() - m_fSyncTime >= 3.0f)

 		return true;

 

@@ -6369,11 +6445,11 @@
 }

 

 // PARTY_JOIN_BUG_FIX

-/// ÆÄÆ¼ °¡ÀÔ event Á¤º¸

+/// Ƽ  event 

 EVENTINFO(TPartyJoinEventInfo)

 {

-	DWORD dwGuestPID; ///< ÆÄÆ¼¿¡ Âü¿©ÇÒ Ä³¸¯ÅÍÀÇ PID

-	DWORD dwLeaderPID; ///< ÆÄÆ¼ ¸®´õÀÇ PID

+	DWORD dwGuestPID; ///< Ƽ  ĳ PID

+	DWORD dwLeaderPID; ///< Ƽ  PID

 

 	TPartyJoinEventInfo()

 		: dwGuestPID(0)

@@ -6411,7 +6487,7 @@
 

 	if (!leader)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÆÄÆ¼ÀåÀÌ Á¢¼Ó »óÅÂ°¡ ¾Æ´Ï¶ó¼­ ¿äÃ»À» ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ƽ  ° ƴ϶ û   ϴ."));

 		return false;

 	}

 

@@ -6432,38 +6508,38 @@
 			break;

 

 		case PERR_SERVER:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ¼­¹ö ¹®Á¦·Î ÆÄÆ¼ °ü·Ã Ã³¸®¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>   Ƽ  ó   ϴ."));

 			return false;

 

 		case PERR_DIFFEMPIRE:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´Ù¸¥ Á¦±¹°ú ÆÄÆ¼¸¦ ÀÌ·ê ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> ٸ  Ƽ ̷  ϴ."));

 			return false;

 

 		case PERR_DUNGEON:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´øÀü ¾È¿¡¼­´Â ÆÄÆ¼ ÃÊ´ë¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ȿ Ƽ ʴ븦   ϴ."));

 			return false;

 

 		case PERR_OBSERVER:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> °üÀü ¸ðµå¿¡¼± ÆÄÆ¼ ÃÊ´ë¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  忡 Ƽ ʴ븦   ϴ."));

 			return false;

 

 		case PERR_LVBOUNDARY:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> -30 ~ +30 ·¹º§ ÀÌ³»ÀÇ »ó´ë¹æ¸¸ ÃÊ´ëÇÒ ¼ö ÀÖ½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> -30 ~ +30  ̳ 游 ʴ  ֽϴ."));

 			return false;

 

 		case PERR_LOWLEVEL:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖ°í ·¹º§ º¸´Ù 30·¹º§ÀÌ ³·¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ְ   30  ʴ  ϴ."));

 			return false;

 

 		case PERR_HILEVEL:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖÀú ·¹º§ º¸´Ù 30·¹º§ÀÌ ³ô¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ    30  ʴ  ϴ."));

 			return false;

 

 		case PERR_ALREADYJOIN:

 			return false;

 

 		case PERR_PARTYISFULL:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´õ ÀÌ»ó ÆÄÆ¼¿øÀ» ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ̻ Ƽ ʴ  ϴ."));

 			return false;

 

 		default:

@@ -6483,7 +6559,7 @@
 #else

 	leader->ChatPacket(CHAT_TYPE_COMMAND, "PartyRequest %u", (DWORD)GetVID());

 #endif

-	ChatPacket(CHAT_TYPE_INFO, LC_STRING("%s ´Ô¿¡°Ô ÆÄÆ¼°¡ÀÔ ½ÅÃ»À» Çß½À´Ï´Ù.", leader->GetName()));

+	ChatPacket(CHAT_TYPE_INFO, LC_STRING("%s Կ Ƽ û ߽ϴ.", leader->GetName()));

 	return true;

 }

 

@@ -6537,7 +6613,7 @@
 	event_cancel(&member->m_pkPartyRequestEvent);

 

 	if (!GetParty())

-		member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ÆÄÆ¼¿¡ ¼ÓÇØÀÖÁö ¾Ê½À´Ï´Ù."));

+		member->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ƽ  ʽϴ."));

 	else

 	{

 		if (GetPlayerID() != GetParty()->GetLeaderPID())

@@ -6547,16 +6623,16 @@
 		switch (errcode)

 		{

 			case PERR_NONE: member->PartyJoin(this); return;

-			case PERR_SERVER: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ¼­¹ö ¹®Á¦·Î ÆÄÆ¼ °ü·Ã Ã³¸®¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù.")); break;

-			case PERR_DUNGEON: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´øÀü ¾È¿¡¼­´Â ÆÄÆ¼ ÃÊ´ë¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù.")); break;

-			case PERR_OBSERVER: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> °üÀü ¸ðµå¿¡¼± ÆÄÆ¼ ÃÊ´ë¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù.")); break;

-			case PERR_LVBOUNDARY: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> -30 ~ +30 ·¹º§ ÀÌ³»ÀÇ »ó´ë¹æ¸¸ ÃÊ´ëÇÒ ¼ö ÀÖ½À´Ï´Ù.")); break;

-			case PERR_LOWLEVEL: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖ°í ·¹º§ º¸´Ù 30·¹º§ÀÌ ³·¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù.")); break;

-			case PERR_HILEVEL: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖÀú ·¹º§ º¸´Ù 30·¹º§ÀÌ ³ô¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù.")); break;

+			case PERR_SERVER: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>   Ƽ  ó   ϴ.")); break;

+			case PERR_DUNGEON: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ȿ Ƽ ʴ븦   ϴ.")); break;

+			case PERR_OBSERVER: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  忡 Ƽ ʴ븦   ϴ.")); break;

+			case PERR_LVBOUNDARY: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> -30 ~ +30  ̳ 游 ʴ  ֽϴ.")); break;

+			case PERR_LOWLEVEL: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ְ   30  ʴ  ϴ.")); break;

+			case PERR_HILEVEL: member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ    30  ʴ  ϴ.")); break;

 			case PERR_ALREADYJOIN: break;

 			case PERR_PARTYISFULL: {

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´õ ÀÌ»ó ÆÄÆ¼¿øÀ» ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

-				member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼ÀÇ ÀÎ¿øÁ¦ÇÑÀÌ ÃÊ°úÇÏ¿© ÆÄÆ¼¿¡ Âü°¡ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ̻ Ƽ ʴ  ϴ."));

+				member->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ο ʰϿ Ƽ   ϴ."));

 				break;

 			}

 			default: sys_err("Do not process party join error(%d)", errcode);

@@ -6567,8 +6643,8 @@
 }

 

 /**

-* ÆÄÆ¼ ÃÊ´ë event callback ÇÔ¼ö.

-* event °¡ ¹ßµ¿ÇÏ¸é ÃÊ´ë °ÅÀý·Î Ã³¸®ÇÑ´Ù.

+* Ƽ ʴ event callback Լ.

+* event  ߵϸ ʴ  óѴ.

 **/

 EVENTFUNC(party_invite_event)

 {

@@ -6595,12 +6671,12 @@
 {

 	if (GetParty() && GetParty()->GetLeaderPID() != GetPlayerID())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼¿øÀ» ÃÊ´ëÇÒ ¼ö ÀÖ´Â ±ÇÇÑÀÌ ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ʴ  ִ  ϴ."));

 		return;

 	}

 	else if (pchInvitee->IsBlockMode(BLOCK_PARTY_INVITE))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> %s ´ÔÀÌ ÆÄÆ¼ °ÅºÎ »óÅÂÀÔ´Ï´Ù.", pchInvitee->GetName()));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> %s  Ƽ ź Դϴ.", pchInvitee->GetName()));

 		return;

 	}

 

@@ -6612,39 +6688,39 @@
 			break;

 

 		case PERR_SERVER:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ¼­¹ö ¹®Á¦·Î ÆÄÆ¼ °ü·Ã Ã³¸®¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>   Ƽ  ó   ϴ."));

 			return;

 

 		case PERR_DIFFEMPIRE:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´Ù¸¥ Á¦±¹°ú ÆÄÆ¼¸¦ ÀÌ·ê ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> ٸ  Ƽ ̷  ϴ."));

 			return;

 

 		case PERR_DUNGEON:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´øÀü ¾È¿¡¼­´Â ÆÄÆ¼ ÃÊ´ë¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ȿ Ƽ ʴ븦   ϴ."));

 			return;

 

 		case PERR_OBSERVER:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> °üÀü ¸ðµå¿¡¼± ÆÄÆ¼ ÃÊ´ë¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  忡 Ƽ ʴ븦   ϴ."));

 			return;

 

 		case PERR_LVBOUNDARY:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> -30 ~ +30 ·¹º§ ÀÌ³»ÀÇ »ó´ë¹æ¸¸ ÃÊ´ëÇÒ ¼ö ÀÖ½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> -30 ~ +30  ̳ 游 ʴ  ֽϴ."));

 			return;

 

 		case PERR_LOWLEVEL:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖ°í ·¹º§ º¸´Ù 30·¹º§ÀÌ ³·¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ְ   30  ʴ  ϴ."));

 			return;

 

 		case PERR_HILEVEL:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖÀú ·¹º§ º¸´Ù 30·¹º§ÀÌ ³ô¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ    30  ʴ  ϴ."));

 			return;

 

 		case PERR_ALREADYJOIN:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÀÌ¹Ì %s´ÔÀº ÆÄÆ¼¿¡ ¼ÓÇØ ÀÖ½À´Ï´Ù.", pchInvitee->GetName()));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> ̹ %s Ƽ  ֽϴ.", pchInvitee->GetName()));

 			return;

 

 		case PERR_PARTYISFULL:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´õ ÀÌ»ó ÆÄÆ¼¿øÀ» ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ̻ Ƽ ʴ  ϴ."));

 			return;

 

 		default:

@@ -6656,7 +6732,7 @@
 		return;

 

 	//

-	// EventMap ¿¡ ÀÌº¥Æ® Ãß°¡

+	// EventMap  ̺Ʈ ߰

 	//

 	TPartyJoinEventInfo* info = AllocEventInfo<TPartyJoinEventInfo>();

 

@@ -6666,7 +6742,7 @@
 	m_PartyInviteEventMap.insert(EventMap::value_type(pchInvitee->GetPlayerID(), event_create(party_invite_event, info, PASSES_PER_SEC(10))));

 

 	//

-	// ÃÊ´ë ¹Þ´Â character ¿¡°Ô ÃÊ´ë ÆÐÅ¶ Àü¼Û

+	// ʴ ޴ character  ʴ Ŷ 

 	//

 

 	TPacketGCPartyInvite p;

@@ -6690,7 +6766,7 @@
 

 	if (GetParty() && GetParty()->GetLeaderPID() != GetPlayerID())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼¿øÀ» ÃÊ´ëÇÒ ¼ö ÀÖ´Â ±ÇÇÑÀÌ ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ʴ  ִ  ϴ."));

 		return;

 	}

 

@@ -6702,36 +6778,36 @@
 			break;

 

 		case PERR_SERVER:

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ¼­¹ö ¹®Á¦·Î ÆÄÆ¼ °ü·Ã Ã³¸®¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>   Ƽ  ó   ϴ."));

 			return;

 

 		case PERR_DUNGEON:

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´øÀü ¾È¿¡¼­´Â ÆÄÆ¼ ÃÊ´ë¿¡ ÀÀÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ȿ Ƽ ʴ뿡   ϴ."));

 			return;

 

 		case PERR_OBSERVER:

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> °üÀü ¸ðµå¿¡¼± ÆÄÆ¼ ÃÊ´ë¸¦ ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  忡 Ƽ ʴ븦   ϴ."));

 			return;

 

 		case PERR_LVBOUNDARY:

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> -30 ~ +30 ·¹º§ ÀÌ³»ÀÇ »ó´ë¹æ¸¸ ÃÊ´ëÇÒ ¼ö ÀÖ½À´Ï´Ù."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> -30 ~ +30  ̳ 游 ʴ  ֽϴ."));

 			return;

 

 		case PERR_LOWLEVEL:

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖ°í ·¹º§ º¸´Ù 30·¹º§ÀÌ ³·¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ְ   30  ʴ  ϴ."));

 			return;

 

 		case PERR_HILEVEL:

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼³» ÃÖÀú ·¹º§ º¸´Ù 30·¹º§ÀÌ ³ô¾Æ ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ    30  ʴ  ϴ."));

 			return;

 

 		case PERR_ALREADYJOIN:

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼ ÃÊ´ë¿¡ ÀÀÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ʴ뿡   ϴ."));

 			return;

 

 		case PERR_PARTYISFULL:

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ´õ ÀÌ»ó ÆÄÆ¼¿øÀ» ÃÊ´ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

-			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> ÆÄÆ¼ÀÇ ÀÎ¿øÁ¦ÇÑÀÌ ÃÊ°úÇÏ¿© ÆÄÆ¼¿¡ Âü°¡ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ>  ̻ Ƽ ʴ  ϴ."));

+			pchInvitee->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> Ƽ ο ʰϿ Ƽ   ϴ."));

 			return;

 

 		default:

@@ -6740,7 +6816,7 @@
 	}

 

 	//

-	// ÆÄÆ¼ °¡ÀÔ Ã³¸®

+	// Ƽ  ó

 	//

 

 	if (GetParty())

@@ -6770,13 +6846,13 @@
 

 	LPCHARACTER pchInvitee = CHARACTER_MANAGER::instance().FindByPID(dwPID);

 	if (pchInvitee)

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> %s´ÔÀÌ ÆÄÆ¼ ÃÊ´ë¸¦ °ÅÀýÇÏ¼Ì½À´Ï´Ù.", pchInvitee->GetName()));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> %s Ƽ ʴ븦 ϼ̽ϴ.", pchInvitee->GetName()));

 }

 

 void CHARACTER::PartyJoin(LPCHARACTER pLeader)

 {

-	pLeader->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> %s´ÔÀÌ ÆÄÆ¼¿¡ Âü°¡ÇÏ¼Ì½À´Ï´Ù.", GetName()));

-	ChatPacket(CHAT_TYPE_INFO, LC_STRING("<ÆÄÆ¼> %s´ÔÀÇ ÆÄÆ¼¿¡ Âü°¡ÇÏ¼Ì½À´Ï´Ù.", pLeader->GetName()));

+	pLeader->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> %s Ƽ ϼ̽ϴ.", GetName()));

+	ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ƽ> %s Ƽ ϼ̽ϴ.", pLeader->GetName()));

 

 	pLeader->GetParty()->Join(GetPlayerID());

 	pLeader->GetParty()->Link(this);

@@ -6989,7 +7065,7 @@
 		return;

 	}

 

-	// ±³È¯ÁßÀÏ¶§ Äù½ºÆ®¸¦ ÁøÇàÇÒ ¼ö ¾ø´Ù.

+	// ȯ϶ Ʈ   .

 	{

 		if (pkChrCauser->GetExchange())

 		{

@@ -6999,9 +7075,9 @@
 		}

 	}

 

-	// »óÁ¡À» ¿¬»óÅÂ·Î Äù½ºÆ®¸¦ ÁøÇàÇÒ ¼ö ¾ø´Ù.

-	{

-		// ´Ü, ÀÚ½ÅÀº ÀÚ½ÅÀÇ »óÁ¡À» Å¬¸¯ÇÒ ¼ö ÀÖ´Ù.

+	//  · Ʈ   .

+	{

+		// , ڽ ڽ  Ŭ  ִ.

 		if (pkChrCauser->GetMyShop() && pkChrCauser != this)

 		{

 			if (test_server)

@@ -7012,10 +7088,10 @@
 

 	if (IsPC())

 	{

-		// Å¸°ÙÀ¸·Î ¼³Á¤µÈ °æ¿ì´Â PC¿¡ ÀÇÇÑ Å¬¸¯µµ Äù½ºÆ®·Î Ã³¸®ÇÏµµ·Ï ÇÕ´Ï´Ù.

+		// Ÿ   PC  Ŭ Ʈ óϵ մϴ.

 		if (!CTargetManager::instance().GetTargetInfo(pkChrCauser->GetPlayerID(), TARGET_TYPE_VID, GetVID()))

 		{

-			// 20050317.myevan.Å¸°ÙÀÌ ¾Æ´Ñ °æ¿ì´Â °³ÀÎ »óÁ¡ Ã³¸® ±â´ÉÀ» ÀÛµ¿½ÃÅ²´Ù.

+			// 20050317.myevan.Ÿ ƴ    ó  ۵Ų.

 			if (GetMyShop())

 			{

 				if (pkChrCauser->IsDead() == true) return;

@@ -7029,28 +7105,28 @@
 #endif

 

 				// PREVENT_TRADE_WINDOW

-				if (pkChrCauser == this) // ÀÚ±â´Â °¡´É

+				if (pkChrCauser == this) // ڱ 

 				{

 					if (PreventTradeWindow(WND_MYSHOP, true/*except*/))

 					{

-						pkChrCauser->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ù¸¥ °Å·¡Áß(Ã¢°í,±³È¯,»óÁ¡)¿¡´Â °³ÀÎ»óÁ¡À» »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+						pkChrCauser->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٸ ŷ(â,ȯ,) λ   ϴ."));

 						return;

 					}

 				}

-				else // ´Ù¸¥ »ç¶÷ÀÌ Å¬¸¯ÇßÀ»¶§

+				else // ٸ  Ŭ

 				{

-					// Å¬¸¯ÇÑ »ç¶÷ÀÌ ±³È¯/Ã¢°í/°³ÀÎ»óÁ¡/»óÁ¡ÀÌ¿ëÁßÀÌ¶ó¸é ºÒ°¡

+					// Ŭ  ȯ/â/λ/̶̿ Ұ

 					if (pkChrCauser->PreventTradeWindow(WND_ALL))

 					{

-						pkChrCauser->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ù¸¥ °Å·¡Áß(Ã¢°í,±³È¯,»óÁ¡)¿¡´Â °³ÀÎ»óÁ¡À» »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+						pkChrCauser->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٸ ŷ(â,ȯ,) λ   ϴ."));

 						return;

 					}

 

-					// Å¬¸¯ÇÑ ´ë»óÀÌ ±³È¯/Ã¢°í/»óÁ¡ÀÌ¿ëÁßÀÌ¶ó¸é ºÒ°¡

+					// Ŭ  ȯ/â/̶̿ Ұ

 					//if ((GetExchange() || IsOpenSafebox() || GetShopOwner()))

 					if (PreventTradeWindow(WND_MYSHOP | WND_SHOPOWNER, true/*except*/))

 					{

-						pkChrCauser->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ´Ù¸¥ °Å·¡¸¦ ÇÏ°í ÀÖ´Â ÁßÀÔ´Ï´Ù."));

+						pkChrCauser->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ٸ ŷ ϰ ִ Դϴ."));

 						return;

 					}

 				}

@@ -7101,12 +7177,12 @@
 			return;

 	}

 

-	// NPC Àü¿ë ±â´É ¼öÇà : »óÁ¡ ¿­±â µî

+	// NPC    :   

 	if (!IsPC())

 	{

 		if (!m_triggerOnClick.pFunc)

 		{

-			// NPC Æ®¸®°Å ½Ã½ºÅÛ ·Î±× º¸±â

+			// NPC Ʈ ý α 

 			/*

 			sys_err("%s.OnClickFailure(%s) : triggerOnClick.pFunc is EMPTY(pid=%d)",

 				pkChrCauser->GetName(),

@@ -7175,7 +7251,7 @@
 {

 	if (!m_set_pkChrSpawnedBy.empty())

 	{

-		// ³»°¡ ½ºÆù½ÃÅ² ¸ó½ºÅÍµéÀ» ¸ðµÎ Á×ÀÎ´Ù.

+		//  Ų ͵  δ.

 		FuncDeadSpawnedByStone f;

 		std::for_each(m_set_pkChrSpawnedBy.begin(), m_set_pkChrSpawnedBy.end(), f);

 		m_set_pkChrSpawnedBy.clear();

@@ -7510,9 +7586,9 @@
 }

 

 // fixme

-// Áö±Ý±îÁø privateMapIndex °¡ ÇöÀç ¸Ê ÀÎµ¦½º¿Í °°ÀºÁö Ã¼Å© ÇÏ´Â °ÍÀ» ¿ÜºÎ¿¡¼­ ÇÏ°í,

-// ´Ù¸£¸é warpsetÀ» ºÒ·¶´Âµ¥

-// ÀÌ¸¦ warpset ¾ÈÀ¸·Î ³ÖÀÚ.

+// ݱ privateMapIndex    ε  üũ ϴ  ܺο ϰ,

+// ٸ warpset ҷµ

+// ̸ warpset  .

 bool CHARACTER::WarpSet(long x, long y, long lPrivateMapIndex)

 {

 	if (!IsPC())

@@ -7610,7 +7686,7 @@
 

 	if (!map_allow_find(index))

 	{

-		// ÀÌ °÷À¸·Î ¿öÇÁÇÒ ¼ö ¾øÀ¸¹Ç·Î ¿öÇÁÇÏ±â Àü ÁÂÇ¥·Î µÇµ¹¸®ÀÚ.

+		//     Ƿ ϱ  ǥ ǵ.

 		sys_err("location %d %d not allowed to login this server", m_posWarp.x, m_posWarp.y);

 		if (g_bIgnoreDisallowedMap) // 20200807.Owsap : Go home if map index isn't allowed.

 			GoHome();

@@ -7669,7 +7745,7 @@
 	SendMovePacket(FUNC_WAIT, 0, 0, 0, 0);

 

 	if (test_server)

-		sys_log(0, "%s %p Æ÷±âÇÏ°í µ¹¾Æ°¡ÀÚ! %d %d", GetName(), this, x, y);

+		sys_log(0, "%s %p ϰ ư! %d %d", GetName(), this, x, y);

 

 	if (GetParty())

 		GetParty()->SendMessage(this, PM_RETURN, x, y);

@@ -7688,14 +7764,14 @@
 	// TRENT_MONSTER

 	if (IsNoMove())

 	{

-		if (pkChr->IsPC()) // ÂÑ¾Æ°¡´Â »ó´ë°¡ PCÀÏ ¶§

+		if (pkChr->IsPC()) // Ѿư 밡 PC 

 		{

 			// If i'm in a party. I must obey party leader's AI.

 			if (!GetParty() || !GetParty()->GetLeader() || GetParty()->GetLeader() == this)

 			{

-				if (get_dword_time() - m_pkMobInst->m_dwLastAttackedTime >= 15000) // ¸¶Áö¸·À¸·Î °ø°Ý¹ÞÀºÁö 15ÃÊ°¡ Áö³µ°í

+				if (get_dword_time() - m_pkMobInst->m_dwLastAttackedTime >= 15000) //  ݹ 15ʰ 

 				{

-					// ¸¶Áö¸· ¸ÂÀº °÷À¸·Î ºÎÅÍ 50¹ÌÅÍ ÀÌ»ó Â÷ÀÌ³ª¸é Æ÷±âÇÏ°í µ¹¾Æ°£´Ù.

+					//     50 ̻ ̳ ϰ ư.

 					if (m_pkMobData->m_table.wAttackRange < DISTANCE_APPROX(pkChr->GetX() - GetX(), pkChr->GetY() - GetY()))

 						if (Return())

 							return true;

@@ -7709,14 +7785,14 @@
 	long x = pkChr->GetX();

 	long y = pkChr->GetY();

 

-	if (pkChr->IsPC()) // ÂÑ¾Æ°¡´Â »ó´ë°¡ PCÀÏ ¶§

+	if (pkChr->IsPC()) // Ѿư 밡 PC 

 	{

 		// If i'm in a party. I must obey party leader's AI.

 		if (!GetParty() || !GetParty()->GetLeader() || GetParty()->GetLeader() == this)

 		{

-			if (get_dword_time() - m_pkMobInst->m_dwLastAttackedTime >= 15000) // ¸¶Áö¸·À¸·Î °ø°Ý¹ÞÀºÁö 15ÃÊ°¡ Áö³µ°í

+			if (get_dword_time() - m_pkMobInst->m_dwLastAttackedTime >= 15000) //  ݹ 15ʰ 

 			{

-				// ¸¶Áö¸· ¸ÂÀº °÷À¸·Î ºÎÅÍ 50¹ÌÅÍ ÀÌ»ó Â÷ÀÌ³ª¸é Æ÷±âÇÏ°í µ¹¾Æ°£´Ù.

+				//     50 ̻ ̳ ϰ ư.

 				if (5000 < DISTANCE_APPROX(m_pkMobInst->m_posLastAttacked.x - GetX(), m_pkMobInst->m_posLastAttacked.y - GetY()))

 					if (Return())

 						return true;

@@ -7744,9 +7820,9 @@
 #endif

 		)

 	{

-		// ´ë»óÀÌ ÀÌµ¿ÁßÀÌ¸é ¿¹Ãø ÀÌµ¿À» ÇÑ´Ù

-		// ³ª¿Í »ó´ë¹æÀÇ ¼ÓµµÂ÷¿Í °Å¸®·ÎºÎÅÍ ¸¸³¯ ½Ã°£À» ¿¹»óÇÑ ÈÄ

-		// »ó´ë¹æÀÌ ±× ½Ã°£±îÁö Á÷¼±À¸·Î ÀÌµ¿ÇÑ´Ù°í °¡Á¤ÇÏ¿© °Å±â·Î ÀÌµ¿ÇÑ´Ù.

+		//  ̵̸  ̵ Ѵ

+		//   ӵ Ÿκ  ð  

+		//   ð  ̵Ѵٰ Ͽ ű ̵Ѵ.

 		float rot = pkChr->GetRotation();

 		float rot_delta = GetDegreeDelta(rot, GetDegreeFromPositionXY(GetX(), GetY(), pkChr->GetX(), pkChr->GetY()));

 

@@ -7778,7 +7854,7 @@
 		}

 	}

 

-	// °¡·Á´Â À§Ä¡¸¦ ¹Ù¶óºÁ¾ß ÇÑ´Ù.

+	//  ġ ٶ Ѵ.

 	SetRotationToXY(x, y);

 

 	float fDist = DISTANCE_SQRT(x - GetX(), y - GetY());

@@ -7790,7 +7866,7 @@
 

 	if (IsChangeAttackPosition(pkChr) && GetMobRank() < MOB_RANK_BOSS)

 	{

-		// »ó´ë¹æ ÁÖº¯ ·£´ýÇÑ °÷À¸·Î ÀÌµ¿

+		//  ֺ   ̵

 		SetChangeAttackPositionTime();

 

 		int retry = 16;

@@ -7815,23 +7891,23 @@
 				break;

 		}

 

-		//sys_log(0, "±ÙÃ³ ¾îµò°¡·Î ÀÌµ¿ %s retry %d", GetName(), retry);

+		//sys_log(0, "ó 򰡷 ̵ %s retry %d", GetName(), retry);

 		if (!Goto(dx, dy))

 			return false;

 	}

 	else

 	{

-		// Á÷¼± µû¶ó°¡±â

+		//  󰡱

 		float fDistToGo = fDist - fMinDistance;

 		GetDeltaByDegree(GetRotation(), fDistToGo, &fx, &fy);

 

-		//sys_log(0, "Á÷¼±À¸·Î ÀÌµ¿ %s", GetName());

+		//sys_log(0, " ̵ %s", GetName());

 		if (!Goto(GetX() + (int)fx, GetY() + (int)fy))

 			return false;

 	}

 

 	SendMovePacket(FUNC_WAIT, 0, 0, 0, 0);

-	//MonsterLog("ÂÑ¾Æ°¡±â; %s", pkChr->GetName());

+	//MonsterLog("Ѿư; %s", pkChr->GetName());

 	return true;

 }

 

@@ -7861,24 +7937,24 @@
 #endif

 	if (!*pszPassword || strlen(pszPassword) > SAFEBOX_PASSWORD_MAX_LEN)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ã¢°í> Àß¸øµÈ ¾ÏÈ£¸¦ ÀÔ·ÂÇÏ¼Ì½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<â> ߸ ȣ Էϼ̽ϴ."));

 		return;

 	}

 	else if (m_pkSafebox)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ã¢°í> Ã¢°í°¡ ÀÌ¹Ì ¿­·ÁÀÖ½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<â> â ̹ ֽϴ."));

 		return;

 	}

 

 	int iPulse = thecore_pulse();

 	if (iPulse - GetSafeboxLoadTime() < PASSES_PER_SEC(10))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ã¢°í> Ã¢°í¸¦ ´ÝÀºÁö 10ÃÊ ¾È¿¡´Â ¿­ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<â> â  10 ȿ   ϴ."));

 		return;

 	}

 	else if (GetDistanceFromSafeboxOpen() > 1000)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<Ã¢°í> °Å¸®°¡ ¸Ö¾î¼­ Ã¢°í¸¦ ¿­ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("<â> Ÿ ־ â   ϴ."));

 		return;

 	}

 	else if (m_bOpeningSafebox)

@@ -8282,9 +8358,9 @@
 		if (IsNPC())

 		{

 			if (m_bNowWalking)

-				MonsterLog("°È´Â´Ù");

+				MonsterLog("ȴ´");

 			else

-				MonsterLog("¶Ú´Ù");

+				MonsterLog("ڴ");

 		}

 

 		//sys_log(0, "%s is now %s", GetName(), m_bNowWalking ? "walking." : "running.");

@@ -8359,8 +8435,30 @@
 	PointChange(POINT_STAT, (MINMAX(1, iLv, gPlayerMaxLevelStats) * 3) + GetPoint(POINT_LEVEL_STEP) - GetPoint(POINT_STAT));

 

 	ComputePoints();

-

-	// È¸º¹

+	// [Security] After stat reset, force-unequip items that no longer meet requirements.

+	for (int i = 0; i < WEAR_MAX_NUM; ++i)

+	{

+		LPITEM pWear = GetWear(i);

+		if (!pWear)

+			continue;

+

+		if (!CanEquipNow(pWear))

+		{

+			// Try normal unequip (to inventory). If inventory is full, drop to ground to prevent abuse.

+			if (!UnequipItem(pWear))

+			{

+				PIXEL_POSITION pos = GetXYZ();

+				pWear->RemoveFromCharacter();

+

+				if (pWear->AddToGround(GetMapIndex(), pos))

+					pWear->SetOwnership(this, 60);

+				else

+					ITEM_MANAGER::instance().RemoveItem(pWear, "FORCE_UNEQUIP_STAT_RESET");

+			}

+		}

+	}

+

+	// ȸ

 	PointChange(POINT_HP, GetMaxHP() - GetHP());

 	PointChange(POINT_SP, GetMaxSP() - GetSP());

 

@@ -8743,11 +8841,11 @@
 		PointChange(POINT_HT, 0);

 	}

 

-	// Æú¸®¸ðÇÁ »óÅÂ¿¡¼­ Á×´Â °æ¿ì, Æú¸®¸ðÇÁ°¡ Ç®¸®°Ô µÇ´Âµ¥

-	// Æú¸® ¸ðÇÁ ÀüÈÄ·Î valid combo intervalÀÌ ´Ù¸£±â ¶§¹®¿¡

-	// Combo ÇÙ ¶Ç´Â Hacker·Î ÀÎ½ÄÇÏ´Â °æ¿ì°¡ ÀÖ´Ù.

-	// µû¶ó¼­ Æú¸®¸ðÇÁ¸¦ Ç®°Å³ª Æú¸®¸ðÇÁ ÇÏ°Ô µÇ¸é,

-	// valid combo intervalÀ» resetÇÑ´Ù.

+	//  ¿ ״ ,  Ǯ Ǵµ

+	//   ķ valid combo interval ٸ 

+	// Combo  Ǵ Hacker νϴ 찡 ִ.

+	//   Ǯų  ϰ Ǹ,

+	// valid combo interval resetѴ.

 	SetValidComboInterval(0);

 	SetComboSequence(0);

 

@@ -8848,7 +8946,7 @@
 				else

 				{

 					iGradePct -= iLevelGradePortion;

-					m_dwDropMetinStone += 100; // µ¹ +a -> +(a+1)ÀÌ µÉ¶§¸¶´Ù 100¾¿ Áõ°¡

+					m_dwDropMetinStone += 100; //  +a -> +(a+1) ɶ 100 

 				}

 			}

 		}

@@ -8948,9 +9046,9 @@
 	m_posDest.x = m_posStart.x = GetX();

 	m_posDest.y = m_posStart.y = GetY();

 

-	// NOTE : MountÇÑ´Ù°í ÇØ¼­ Client SideÀÇ °´Ã¼¸¦ »èÁ¦ÇÏÁø ¾Ê´Â´Ù.

-	// ±×¸®°í ¼­¹öSide¿¡¼­ ÅÀÀ»¶§ À§Ä¡ ÀÌµ¿Àº ÇÏÁö ¾Ê´Â´Ù. ¿Ö³ÄÇÏ¸é Client Side¿¡¼­ Coliision Adjust¸¦ ÇÒ¼ö ÀÖ´Âµ¥

-	// °´Ã¼¸¦ ¼Ò¸ê½ÃÄ×´Ù°¡ ¼­¹öÀ§Ä¡·Î ÀÌµ¿½ÃÅ°¸é ÀÌ¶§ collision check¸¦ ÇÏÁö´Â ¾ÊÀ¸¹Ç·Î ¹è°æ¿¡ ³¢°Å³ª ¶Õ°í ³ª°¡´Â ¹®Á¦°¡ Á¸ÀçÇÑ´Ù.

+	// NOTE : MountѴٰ ؼ Client Side ü  ʴ´.

+	// ׸ Side  ġ ̵  ʴ´. ֳϸ Client Side Coliision Adjust Ҽ ִµ

+	// ü Ҹ״ٰ ġ ̵Ű ̶ collision check  Ƿ 濡 ų հ   Ѵ.

 	m_posDest.x = m_posStart.x = GetX();

 	m_posDest.y = m_posStart.y = GetY();

 #if defined(__MOUNT_ENTITY_REFRESH__)

@@ -8964,7 +9062,7 @@
 	{

 		LPENTITY entity = (it++)->first;

 

-		// MountÇÑ´Ù°í ÇØ¼­ Client SideÀÇ °´Ã¼¸¦ »èÁ¦ÇÏÁø ¾Ê´Â´Ù.

+		// MountѴٰ ؼ Client Side ü  ʴ´.

 #if defined(__MOUNT_ENTITY_REFRESH__)

 		EncodeRemovePacket(entity);

 		if (!m_bIsObserver)

@@ -9208,45 +9306,45 @@
 			}

 			else

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ÀÖ´Â °÷À¸·Î ¿öÇÁÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ִ    ϴ."));

 				return false;

 			}

 		}

 		else

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ÀÖ´Â °÷À¸·Î ¿öÇÁÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ִ    ϴ."));

 			return false;

 		}

 	}

 	else

 	{

-		// ´Ù¸¥ ¼­¹ö¿¡ ·Î±×ÀÎµÈ »ç¶÷ÀÌ ÀÖÀ½ -> ¸Þ½ÃÁö º¸³» ÁÂÇ¥¸¦ ¹Þ¾Æ¿ÀÀÚ

-		// 1. A.pid, B.pid ¸¦ »Ñ¸²

-		// 2. B.pid¸¦ °¡Áø ¼­¹ö°¡ »Ñ¸°¼­¹ö¿¡°Ô A.pid, ÁÂÇ¥ ¸¦ º¸³¿

-		// 3. ¿öÇÁ

+		// ٸ  αε   -> ޽  ǥ ޾ƿ

+		// 1. A.pid, B.pid  Ѹ

+		// 2. B.pid   Ѹ A.pid, ǥ  

+		// 3. 

 		CCI* pcci = P2P_MANAGER::instance().FindByPID(dwPID);

 

 		if (!pcci)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ¿Â¶óÀÎ »óÅÂ°¡ ¾Æ´Õ´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ¶ ° ƴմϴ."));

 			return false;

 		}

 

 		if ((pcci->bChannel != g_bChannel) && !bWarpForce)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ %d Ã¤³Î¿¡ ÀÖ½À´Ï´Ù. (ÇöÀç Ã¤³Î %d)", pcci->bChannel, g_bChannel));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" %d äο ֽϴ. ( ä %d)", pcci->bChannel, g_bChannel));

 			return false;

 		}

 		else if (false == IS_SUMMONABLE_ZONE(pcci->lMapIndex))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ÀÖ´Â °÷À¸·Î ¿öÇÁÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ִ    ϴ."));

 			return false;

 		}

 		else

 		{

 			if (!CAN_ENTER_ZONE(this, pcci->lMapIndex))

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ÀÖ´Â °÷À¸·Î ¿öÇÁÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ִ    ϴ."));

 				return false;

 			}

 

@@ -9284,7 +9382,7 @@
 		if (pGuild == GetGuild())

 			return iCost * iMultiply * 9 / 10;

 

-		// ´Ù¸¥ Á¦±¹ »ç¶÷ÀÌ ½ÃµµÇÏ´Â °æ¿ì Ãß°¡·Î 3¹è ´õ

+		// ٸ   õϴ  ߰ 3 

 		LPCHARACTER chRefineNPC = CHARACTER_MANAGER::instance().Find(m_dwRefineNPCVID);

 		if (chRefineNPC && chRefineNPC->GetEmpire() != GetEmpire())

 			return iCost * iMultiply * 3;

@@ -9304,7 +9402,7 @@
 

 	if (pGuild)

 	{

-		// ÀÚ±â ±æµåÀÌ¸é iTotalMoney¿¡ ÀÌ¹Ì 10%°¡ Á¦¿ÜµÇ¾îÀÖ´Ù

+		// ڱ ̸ iTotalMoney ̹ 10% ܵǾִ

 		if (pGuild != GetGuild())

 		{

 			pGuild->RequestDepositMoney(this, iFee);

@@ -9421,7 +9519,7 @@
 }

 // END_PREVENT_TRADE_WINDOW

 

-// Hack ¹æÁö¸¦ À§ÇÑ Ã¼Å©.

+// Hack   üũ.

 bool CHARACTER::IsHack(bool bSendMsg, bool bCheckShopOwner, int limittime)

 {

 	const int iPulse = thecore_pulse();

@@ -9429,24 +9527,24 @@
 	if (test_server)

 		bSendMsg = true;

 

-	// Ã¢°í ¿¬ÈÄ Ã¼Å©

+	// â  üũ

 	if (iPulse - GetSafeboxLoadTime() < PASSES_PER_SEC(limittime))

 	{

 		if (bSendMsg)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ã¢°í¸¦ ¿¬ÈÄ %dÃÊ ÀÌ³»¿¡´Â ´Ù¸¥°÷À¸·Î ÀÌµ¿ÇÒ¼ö ¾ø½À´Ï´Ù.", limittime));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("â  %d ̳ ٸ ̵Ҽ ϴ.", limittime));

 

 		if (test_server)

 			ChatPacket(CHAT_TYPE_INFO, "[TestOnly]Pulse %d LoadTime %d PASS %d", iPulse, GetSafeboxLoadTime(), PASSES_PER_SEC(limittime));

 		return true;

 	}

 

-	// °Å·¡°ü·Ã Ã¢ Ã¼Å©

+	// ŷ â üũ

 	if (bCheckShopOwner)

 	{

 		if (PreventTradeWindow(WND_ALL))

 		{

 			if (bSendMsg)

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("°Å·¡Ã¢,Ã¢°í µîÀ» ¿¬ »óÅÂ¿¡¼­´Â ´Ù¸¥°÷À¸·Î ÀÌµ¿,Á¾·á ÇÒ¼ö ¾ø½À´Ï´Ù"));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ŷâ,â   ¿ ٸ ̵, Ҽ ϴ"));

 

 			return true;

 		}

@@ -9456,18 +9554,18 @@
 		if (PreventTradeWindow(WND_SHOPOWNER, true/*except*/))

 		{

 			if (bSendMsg)

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("°Å·¡Ã¢,Ã¢°í µîÀ» ¿¬ »óÅÂ¿¡¼­´Â ´Ù¸¥°÷À¸·Î ÀÌµ¿,Á¾·á ÇÒ¼ö ¾ø½À´Ï´Ù"));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ŷâ,â   ¿ ٸ ̵, Ҽ ϴ"));

 

 			return true;

 		}

 	}

 

 	// PREVENT_PORTAL_AFTER_EXCHANGE

-	// ±³È¯ ÈÄ ½Ã°£Ã¼Å©

+	// ȯ  ðüũ

 	if (iPulse - GetExchangeTime() < PASSES_PER_SEC(limittime))

 	{

 		if (bSendMsg)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°Å·¡ ÈÄ %dÃÊ ÀÌ³»¿¡´Â ´Ù¸¥Áö¿ªÀ¸·Î ÀÌµ¿ ÇÒ ¼ö ¾ø½À´Ï´Ù.", limittime));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ŷ  %d ̳ ٸ ̵   ϴ.", limittime));

 		return true;

 	}

 	// END_PREVENT_PORTAL_AFTER_EXCHANGE

@@ -9476,14 +9574,14 @@
 	if (iPulse - GetMyShopTime() < PASSES_PER_SEC(limittime))

 	{

 		if (bSendMsg)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°Å·¡ ÈÄ %dÃÊ ÀÌ³»¿¡´Â ´Ù¸¥Áö¿ªÀ¸·Î ÀÌµ¿ ÇÒ ¼ö ¾ø½À´Ï´Ù.", limittime));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ŷ  %d ̳ ٸ ̵   ϴ.", limittime));

 		return true;

 	}

 

 	if (iPulse - GetRefineTime() < PASSES_PER_SEC(limittime))

 	{

 		if (bSendMsg)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ °³·®ÈÄ %dÃÊ ÀÌ³»¿¡´Â ±ÍÈ¯ºÎ,±ÍÈ¯±â¾ïºÎ¸¦ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù.", limittime));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("  %d ̳ ȯ,ȯθ   ϴ.", limittime));

 		return true;

 	}

 

@@ -9605,7 +9703,7 @@
 //------------------------------------------------

 void CHARACTER::UpdateDepositPulse()

 {

-	m_deposit_pulse = thecore_pulse() + PASSES_PER_SEC(60 * 5); // 5ºÐ

+	m_deposit_pulse = thecore_pulse() + PASSES_PER_SEC(60 * 5); // 5

 }

 

 bool CHARACTER::CanDeposit() const

@@ -9811,7 +9909,7 @@
 

 	info->ch = this;

 

-	m_pkCheckSpeedHackEvent = event_create(check_speedhack_event, info, PASSES_PER_SEC(60)); // 1ºÐ

+	m_pkCheckSpeedHackEvent = event_create(check_speedhack_event, info, PASSES_PER_SEC(60)); // 1

 }

 

 void CHARACTER::GoHome()

@@ -9948,7 +10046,7 @@
 	return m_dwSkipComboAttackByTime;

 }

 

-// ¸»ÀÌ³ª ´Ù¸¥°ÍÀ» Å¸°í ÀÖ³ª?

+// ̳ ٸ Ÿ ֳ?

 bool CHARACTER::IsRiding() const

 {

 	return IsHorseRiding() || GetMountVnum();

@@ -11705,7 +11803,11 @@
 				if (!foundMission)

 				{

 					if (!IsExtBattlePassRegistered(bBattlePassType, bBattlePassID))

-						DBManager::instance().DirectQuery("INSERT INTO player.battlepass_playerindex SET player_id=%d, player_name='%s', battlepass_type=%d, battlepass_id=%d, start_time=NOW()", GetPlayerID(), GetName(), bBattlePassType, bBattlePassID);

+						{

+							char szNameEsc[(CHARACTER_NAME_MAX_LEN + 1) * 2 + 1];

+							DBManager::instance().EscapeString(szNameEsc, sizeof(szNameEsc), GetName(), strlen(GetName()));

+							DBManager::instance().DirectQuery("INSERT INTO player.battlepass_playerindex SET player_id=%d, player_name='%s', battlepass_type=%d, battlepass_id=%d, start_time=NOW()", GetPlayerID(), szNameEsc, bBattlePassType, bBattlePassID);

+						}

 					

 					TPlayerExtBattlePassMission* newMission = new TPlayerExtBattlePassMission;

 					newMission->dwPlayerId = GetPlayerID();

@@ -11847,7 +11949,11 @@
 		if (!foundMission)

 		{

 			if (!IsExtBattlePassRegistered(bBattlePassType, bBattlePassID))

-				DBManager::instance().DirectQuery("INSERT INTO player.battlepass_playerindex SET player_id=%d, player_name='%s', battlepass_type=%d, battlepass_id=%d, start_time=NOW()", GetPlayerID(), GetName(), bBattlePassType, bBattlePassID);

+				{

+					char szNameEsc[(CHARACTER_NAME_MAX_LEN + 1) * 2 + 1];

+					DBManager::instance().EscapeString(szNameEsc, sizeof(szNameEsc), GetName(), strlen(GetName()));

+					DBManager::instance().DirectQuery("INSERT INTO player.battlepass_playerindex SET player_id=%d, player_name='%s', battlepass_type=%d, battlepass_id=%d, start_time=NOW()", GetPlayerID(), szNameEsc, bBattlePassType, bBattlePassID);

+				}

 

 			TPlayerExtBattlePassMission* newMission = new TPlayerExtBattlePassMission;

 			newMission->dwPlayerId = GetPlayerID();


--- a/server/metin2/Source/Server/game/src/char.h
+++ b/server/metin2/Source/Server/game/src/char.h
@@ -158,7 +158,7 @@
 	DAMAGE_TYPE_NONE,

 	DAMAGE_TYPE_NORMAL,

 	DAMAGE_TYPE_NORMAL_RANGE,

-	// ½ºÅ³

+	// ų

 	DAMAGE_TYPE_MELEE,

 	DAMAGE_TYPE_RANGE,

 	DAMAGE_TYPE_FIRE,

@@ -260,103 +260,103 @@
 	POINT_MAX_HP,							// 6

 	POINT_SP,								// 7

 	POINT_MAX_SP,							// 8

-	POINT_STAMINA,							// 9 ½ºÅ×¹Ì³Ê

-	POINT_MAX_STAMINA,						// 10 ÃÖ´ë ½ºÅ×¹Ì³Ê

+	POINT_STAMINA,							// 9 ׹̳

+	POINT_MAX_STAMINA,						// 10 ִ ׹̳

 

 	POINT_GOLD,								// 11

-	POINT_ST,								// 12 ±Ù·Â

-	POINT_HT,								// 13 Ã¼·Â

-	POINT_DX,								// 14 ¹ÎÃ¸¼º

-	POINT_IQ,								// 15 Á¤½Å·Â

+	POINT_ST,								// 12 ٷ

+	POINT_HT,								// 13 ü

+	POINT_DX,								// 14 ø

+	POINT_IQ,								// 15 ŷ

 	POINT_DEF_GRADE,						// 16 ...

-	POINT_ATT_SPEED,						// 17 °ø°Ý¼Óµµ

-	POINT_ATT_GRADE,						// 18 °ø°Ý·Â MAX

-	POINT_MOV_SPEED,						// 19 ÀÌµ¿¼Óµµ

-	POINT_CLIENT_DEF_GRADE,					// 20 ¹æ¾îµî±Þ

-	POINT_CASTING_SPEED,					// 21 ÁÖ¹®¼Óµµ (Äð´Ù¿îÅ¸ÀÓ*100) / (100 + ÀÌ°ª) = ÃÖÁ¾ Äð´Ù¿î Å¸ÀÓ

-	POINT_MAGIC_ATT_GRADE,					// 22 ¸¶¹ý°ø°Ý·Â

-	POINT_MAGIC_DEF_GRADE,					// 23 ¸¶¹ý¹æ¾î·Â

-	POINT_EMPIRE_POINT,						// 24 Á¦±¹Á¡¼ö

-	POINT_LEVEL_STEP,						// 25 ÇÑ ·¹º§¿¡¼­ÀÇ ´Ü°è.. (1 2 3 µÉ ¶§ º¸»ó, 4 µÇ¸é ·¹º§ ¾÷)

-	POINT_STAT,								// 26 ´É·ÂÄ¡ ¿Ã¸± ¼ö ÀÖ´Â °³¼ö

-	POINT_SUB_SKILL,						// 27 º¸Á¶ ½ºÅ³ Æ÷ÀÎÆ®

-	POINT_SKILL,							// 28 ¾×Æ¼ºê ½ºÅ³ Æ÷ÀÎÆ®

-	POINT_WEAPON_MIN,						// 29 ¹«±â ÃÖ¼Ò µ¥¹ÌÁö

-	POINT_WEAPON_MAX,						// 30 ¹«±â ÃÖ´ë µ¥¹ÌÁö

-	POINT_PLAYTIME,							// 31 ÇÃ·¹ÀÌ½Ã°£

-	POINT_HP_REGEN,							// 32 HP È¸º¹·ü

-	POINT_SP_REGEN,							// 33 SP È¸º¹·ü

-

-	POINT_BOW_DISTANCE,						// 34 È° »çÁ¤°Å¸® Áõ°¡Ä¡ (meter)

-

-	POINT_HP_RECOVERY,						// 35 Ã¼·Â È¸º¹ Áõ°¡·®

-	POINT_SP_RECOVERY,						// 36 Á¤½Å·Â È¸º¹ Áõ°¡·®

-

-	POINT_POISON_PCT,						// 37 µ¶ È®·ü

-	POINT_STUN_PCT,							// 38 ±âÀý È®·ü

-	POINT_SLOW_PCT,							// 39 ½½·Î¿ì È®·ü

-	POINT_CRITICAL_PCT,						// 40 Å©¸®Æ¼ÄÃ È®·ü

-	POINT_PENETRATE_PCT,					// 41 °üÅëÅ¸°Ý È®·ü

-	POINT_CURSE_PCT,						// 42 ÀúÁÖ È®·ü

-

-	POINT_ATTBONUS_HUMAN,					// 43 ÀÎ°£¿¡°Ô °­ÇÔ

-	POINT_ATTBONUS_ANIMAL,					// 44 µ¿¹°¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-	POINT_ATTBONUS_ORC,						// 45 ¿õ±Í¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-	POINT_ATTBONUS_MILGYO,					// 46 ¹Ð±³¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-	POINT_ATTBONUS_UNDEAD,					// 47 ½ÃÃ¼¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-	POINT_ATTBONUS_DEVIL,					// 48 ¸¶±Í(¾Ç¸¶)¿¡°Ô µ¥¹ÌÁö % Áõ°¡

-	POINT_ATTBONUS_INSECT,					// 49 ¹ú·¹Á·

-	POINT_ATTBONUS_FIRE,					// 50 È­¿°Á·

-	POINT_ATTBONUS_ICE,						// 51 ºù¼³Á·

-	POINT_ATTBONUS_DESERT,					// 52 »ç¸·Á·

-	POINT_ATTBONUS_MONSTER,					// 53 ¸ðµç ¸ó½ºÅÍ¿¡°Ô °­ÇÔ

-	POINT_ATTBONUS_WARRIOR,					// 54 ¹«»ç¿¡°Ô °­ÇÔ

-	POINT_ATTBONUS_ASSASSIN,				// 55 ÀÚ°´¿¡°Ô °­ÇÔ

-	POINT_ATTBONUS_SURA,					// 56 ¼ö¶ó¿¡°Ô °­ÇÔ

-	POINT_ATTBONUS_SHAMAN,					// 57 ¹«´ç¿¡°Ô °­ÇÔ

-	POINT_ATTBONUS_TREE,					// 58 ³ª¹«¿¡°Ô °­ÇÔ 20050729.myevan UNUSED5

-

-	POINT_RESIST_WARRIOR,					// 59 ¹«»ç¿¡°Ô ÀúÇ×

-	POINT_RESIST_ASSASSIN,					// 60 ÀÚ°´¿¡°Ô ÀúÇ×

-	POINT_RESIST_SURA,						// 61 ¼ö¶ó¿¡°Ô ÀúÇ×

-	POINT_RESIST_SHAMAN,					// 62 ¹«´ç¿¡°Ô ÀúÇ×

-

-	POINT_STEAL_HP,							// 63 »ý¸í·Â Èí¼ö

-	POINT_STEAL_SP,							// 64 Á¤½Å·Â Èí¼ö

-

-	POINT_MANA_BURN_PCT,					// 65 ¸¶³ª ¹ø

-

-	/// ÇÇÇØ½Ã º¸³Ê½º ///

-

-	POINT_DAMAGE_SP_RECOVER,				// 66 °ø°Ý´çÇÒ ½Ã Á¤½Å·Â È¸º¹ È®·ü

-

-	POINT_BLOCK,							// 67 ºí·°À²

-	POINT_DODGE,							// 68 È¸ÇÇÀ²

+	POINT_ATT_SPEED,						// 17 ݼӵ

+	POINT_ATT_GRADE,						// 18 ݷ MAX

+	POINT_MOV_SPEED,						// 19 ̵ӵ

+	POINT_CLIENT_DEF_GRADE,					// 20 

+	POINT_CASTING_SPEED,					// 21 ֹӵ (ٿŸ*100) / (100 + ̰) =  ٿ Ÿ

+	POINT_MAGIC_ATT_GRADE,					// 22 ݷ

+	POINT_MAGIC_DEF_GRADE,					// 23 

+	POINT_EMPIRE_POINT,						// 24 

+	POINT_LEVEL_STEP,						// 25   ܰ.. (1 2 3   , 4 Ǹ  )

+	POINT_STAT,								// 26 ɷġ ø  ִ 

+	POINT_SUB_SKILL,						// 27  ų Ʈ

+	POINT_SKILL,							// 28 Ƽ ų Ʈ

+	POINT_WEAPON_MIN,						// 29  ּ 

+	POINT_WEAPON_MAX,						// 30  ִ 

+	POINT_PLAYTIME,							// 31 ÷̽ð

+	POINT_HP_REGEN,							// 32 HP ȸ

+	POINT_SP_REGEN,							// 33 SP ȸ

+

+	POINT_BOW_DISTANCE,						// 34 Ȱ Ÿ ġ (meter)

+

+	POINT_HP_RECOVERY,						// 35 ü ȸ 

+	POINT_SP_RECOVERY,						// 36 ŷ ȸ 

+

+	POINT_POISON_PCT,						// 37  Ȯ

+	POINT_STUN_PCT,							// 38  Ȯ

+	POINT_SLOW_PCT,							// 39 ο Ȯ

+	POINT_CRITICAL_PCT,						// 40 ũƼ Ȯ

+	POINT_PENETRATE_PCT,					// 41 Ÿ Ȯ

+	POINT_CURSE_PCT,						// 42  Ȯ

+

+	POINT_ATTBONUS_HUMAN,					// 43 ΰ 

+	POINT_ATTBONUS_ANIMAL,					// 44   % 

+	POINT_ATTBONUS_ORC,						// 45 Ϳ  % 

+	POINT_ATTBONUS_MILGYO,					// 46 б  % 

+	POINT_ATTBONUS_UNDEAD,					// 47 ü  % 

+	POINT_ATTBONUS_DEVIL,					// 48 (Ǹ)  % 

+	POINT_ATTBONUS_INSECT,					// 49 

+	POINT_ATTBONUS_FIRE,					// 50 ȭ

+	POINT_ATTBONUS_ICE,						// 51 

+	POINT_ATTBONUS_DESERT,					// 52 縷

+	POINT_ATTBONUS_MONSTER,					// 53  Ϳ 

+	POINT_ATTBONUS_WARRIOR,					// 54 翡 

+	POINT_ATTBONUS_ASSASSIN,				// 55 ڰ 

+	POINT_ATTBONUS_SURA,					// 56 󿡰 

+	POINT_ATTBONUS_SHAMAN,					// 57 翡 

+	POINT_ATTBONUS_TREE,					// 58   20050729.myevan UNUSED5

+

+	POINT_RESIST_WARRIOR,					// 59 翡 

+	POINT_RESIST_ASSASSIN,					// 60 ڰ 

+	POINT_RESIST_SURA,						// 61 󿡰 

+	POINT_RESIST_SHAMAN,					// 62 翡 

+

+	POINT_STEAL_HP,							// 63  

+	POINT_STEAL_SP,							// 64 ŷ 

+

+	POINT_MANA_BURN_PCT,					// 65  

+

+	/// ؽ ʽ ///

+

+	POINT_DAMAGE_SP_RECOVER,				// 66 ݴ  ŷ ȸ Ȯ

+

+	POINT_BLOCK,							// 67 

+	POINT_DODGE,							// 68 ȸ

 

 	POINT_RESIST_SWORD,						// 69

 	POINT_RESIST_TWOHAND,					// 70

 	POINT_RESIST_DAGGER,					// 71

 	POINT_RESIST_BELL,						// 72

 	POINT_RESIST_FAN,						// 73

-	POINT_RESIST_BOW,						// 74 È­»ì ÀúÇ× : ´ë¹ÌÁö °¨¼Ò

-	POINT_RESIST_FIRE,						// 75 È­¿° ÀúÇ× : È­¿°°ø°Ý¿¡ ´ëÇÑ ´ë¹ÌÁö °¨¼Ò

-	POINT_RESIST_ELEC,						// 76 Àü±â ÀúÇ× : Àü±â°ø°Ý¿¡ ´ëÇÑ ´ë¹ÌÁö °¨¼Ò

-	POINT_RESIST_MAGIC,						// 77 ¼ú¹ý ÀúÇ× : ¸ðµç¼ú¹ý¿¡ ´ëÇÑ ´ë¹ÌÁö °¨¼Ò

-	POINT_RESIST_WIND,						// 78 ¹Ù¶÷ ÀúÇ× : ¹Ù¶÷°ø°Ý¿¡ ´ëÇÑ ´ë¹ÌÁö °¨¼Ò

-

-	POINT_REFLECT_MELEE,					// 79 °ø°Ý ¹Ý»ç

-

-	/// Æ¯¼ö ÇÇÇØ½Ã ///

-	POINT_REFLECT_CURSE,					// 80 ÀúÁÖ ¹Ý»ç

-	POINT_POISON_REDUCE,					// 81 µ¶µ¥¹ÌÁö °¨¼Ò

-

-	/// Àû ¼Ò¸ê½Ã ///

-	POINT_KILL_SP_RECOVER,					// 82 Àû ¼Ò¸ê½Ã MP È¸º¹

+	POINT_RESIST_BOW,						// 74 ȭ  :  

+	POINT_RESIST_FIRE,						// 75 ȭ  : ȭݿ   

+	POINT_RESIST_ELEC,						// 76   : ݿ   

+	POINT_RESIST_MAGIC,						// 77   :    

+	POINT_RESIST_WIND,						// 78 ٶ  : ٶݿ   

+

+	POINT_REFLECT_MELEE,					// 79  ݻ

+

+	/// Ư ؽ ///

+	POINT_REFLECT_CURSE,					// 80  ݻ

+	POINT_POISON_REDUCE,					// 81  

+

+	///  Ҹ ///

+	POINT_KILL_SP_RECOVER,					// 82  Ҹ MP ȸ

 	POINT_EXP_DOUBLE_BONUS,					// 83

 	POINT_GOLD_DOUBLE_BONUS,				// 84

 	POINT_ITEM_DROP_BONUS,					// 85

 

-	/// È¸º¹ °ü·Ã ///

+	/// ȸ  ///

 	POINT_POTION_BONUS,						// 86

 	POINT_KILL_HP_RECOVERY,					// 87

 

@@ -380,7 +380,7 @@
 

 	POINT_HIT_HP_RECOVERY,					// 100

 	POINT_HIT_SP_RECOVERY,					// 101

-	POINT_MANASHIELD,						// 102 Èæ½Å¼öÈ£ ½ºÅ³¿¡ ÀÇÇÑ ¸¶³ª½¯µå È¿°ú Á¤µµ

+	POINT_MANASHIELD,						// 102 żȣ ų   ȿ 

 

 	POINT_PARTY_BUFFER_BONUS,				// 103

 	POINT_PARTY_SKILL_MASTER_BONUS,			// 104

@@ -389,56 +389,56 @@
 	POINT_SP_RECOVER_CONTINUE,				// 106

 

 	POINT_STEAL_GOLD,						// 107

-	POINT_POLYMORPH,						// 108 º¯½ÅÇÑ ¸ó½ºÅÍ ¹øÈ£

-	POINT_MOUNT,							// 109 Å¸°íÀÖ´Â ¸ó½ºÅÍ ¹øÈ£

+	POINT_POLYMORPH,						// 108   ȣ

+	POINT_MOUNT,							// 109 Ÿִ  ȣ

 

 	POINT_PARTY_HASTE_BONUS,				// 110

 	POINT_PARTY_DEFENDER_BONUS,				// 111

-	POINT_STAT_RESET_COUNT,					// 112 ÇÇÀÇ ´Ü¾à »ç¿ëÀ» ÅëÇÑ ½ºÅÝ ¸®¼Â Æ÷ÀÎÆ® (1´ç 1Æ÷ÀÎÆ® ¸®¼Â°¡´É)

+	POINT_STAT_RESET_COUNT,					// 112  ܾ     Ʈ (1 1Ʈ °)

 

 	POINT_HORSE_SKILL,						// 113

 

-	POINT_MALL_ATTBONUS,					// 114 °ø°Ý·Â +x%

-	POINT_MALL_DEFBONUS,					// 115 ¹æ¾î·Â +x%

-	POINT_MALL_EXPBONUS,					// 116 °æÇèÄ¡ +x%

-	POINT_MALL_ITEMBONUS,					// 117 ¾ÆÀÌÅÛ µå·ÓÀ² x/10¹è

-	POINT_MALL_GOLDBONUS,					// 118 µ· µå·ÓÀ² x/10¹è

-

-	POINT_MAX_HP_PCT,						// 119 ÃÖ´ë»ý¸í·Â +x%

-	POINT_MAX_SP_PCT,						// 120 ÃÖ´ëÁ¤½Å·Â +x%

-

-	POINT_SKILL_DAMAGE_BONUS,				// 121 ½ºÅ³ µ¥¹ÌÁö *(100+x)%

-	POINT_NORMAL_HIT_DAMAGE_BONUS,			// 122 ÆòÅ¸ µ¥¹ÌÁö *(100+x)%

+	POINT_MALL_ATTBONUS,					// 114 ݷ +x%

+	POINT_MALL_DEFBONUS,					// 115  +x%

+	POINT_MALL_EXPBONUS,					// 116 ġ +x%

+	POINT_MALL_ITEMBONUS,					// 117   x/10

+	POINT_MALL_GOLDBONUS,					// 118   x/10

+

+	POINT_MAX_HP_PCT,						// 119 ִ +x%

+	POINT_MAX_SP_PCT,						// 120 ִŷ +x%

+

+	POINT_SKILL_DAMAGE_BONUS,				// 121 ų  *(100+x)%

+	POINT_NORMAL_HIT_DAMAGE_BONUS,			// 122 Ÿ  *(100+x)%

 

 	// DEFEND_BONUS_ATTRIBUTES

-	POINT_SKILL_DEFEND_BONUS,				// 123 ½ºÅ³ ¹æ¾î µ¥¹ÌÁö

-	POINT_NORMAL_HIT_DEFEND_BONUS,			// 124 ÆòÅ¸ ¹æ¾î µ¥¹ÌÁö

+	POINT_SKILL_DEFEND_BONUS,				// 123 ų  

+	POINT_NORMAL_HIT_DEFEND_BONUS,			// 124 Ÿ  

 	// END_OF_DEFEND_BONUS_ATTRIBUTES

 

 	// PC_BANG_ITEM_ADD 

-	POINT_PC_BANG_EXP_BONUS,				// 125 PC¹æ Àü¿ë °æÇèÄ¡ º¸³Ê½º

-	POINT_PC_BANG_DROP_BONUS,				// 126 PC¹æ Àü¿ë µå·Ó·ü º¸³Ê½º

+	POINT_PC_BANG_EXP_BONUS,				// 125 PC  ġ ʽ

+	POINT_PC_BANG_DROP_BONUS,				// 126 PC  ӷ ʽ

 	// END_PC_BANG_ITEM_ADD

-	POINT_RAMADAN_CANDY_BONUS_EXP,			// 127 ¶ó¸¶´Ü »çÅÁ °æÇèÄ¡ Áõ°¡¿ë

-

-	POINT_ENERGY = 128,						// 128 ±â·Â

-

-	// ±â·Â ui ¿ë.

-	// ¼­¹ö¿¡¼­ ¾²Áö ¾Ê±â¸¸, Å¬¶óÀÌ¾ðÆ®¿¡¼­ ±â·ÂÀÇ ³¡ ½Ã°£À» POINT·Î °ü¸®ÇÏ±â ¶§¹®¿¡ ÀÌ·¸°Ô ÇÑ´Ù.

-	// ¾Æ ºÎ²ô·´´Ù

-	POINT_ENERGY_END_TIME = 129,			// 129 ±â·Â Á¾·á ½Ã°£

+	POINT_RAMADAN_CANDY_BONUS_EXP,			// 127 󸶴  ġ 

+

+	POINT_ENERGY = 128,						// 128 

+

+	//  ui .

+	//   ʱ⸸, Ŭ̾Ʈ   ð POINT ϱ  ̷ Ѵ.

+	//  β

+	POINT_ENERGY_END_TIME = 129,			// 129   ð

 

 	POINT_COSTUME_ATTR_BONUS = 130,			// 130

 	POINT_MAGIC_ATT_BONUS_PER = 131,		// 131

 	POINT_MELEE_MAGIC_ATT_BONUS_PER = 132,	// 132

 

-	// Ãß°¡ ¼Ó¼º ÀúÇ×

-	POINT_RESIST_ICE = 133,					// 133 ³Ã±â ÀúÇ× : ¾óÀ½°ø°Ý¿¡ ´ëÇÑ ´ë¹ÌÁö °¨¼Ò

-	POINT_RESIST_EARTH = 134,				// 134 ´ëÁö ÀúÇ× : ¾óÀ½°ø°Ý¿¡ ´ëÇÑ ´ë¹ÌÁö °¨¼Ò

-	POINT_RESIST_DARK = 135,				// 135 ¾îµÒ ÀúÇ× : ¾óÀ½°ø°Ý¿¡ ´ëÇÑ ´ë¹ÌÁö °¨¼Ò

-

-	POINT_RESIST_CRITICAL = 136,			// 136 Å©¸®Æ¼ÄÃ ÀúÇ× : »ó´ëÀÇ Å©¸®Æ¼ÄÃ È®·üÀ» °¨¼Ò

-	POINT_RESIST_PENETRATE = 137,			// 137 °üÅëÅ¸°Ý ÀúÇ× : »ó´ëÀÇ °üÅëÅ¸°Ý È®·üÀ» °¨¼Ò

+	// ߰ Ӽ 

+	POINT_RESIST_ICE = 133,					// 133 ñ  : ݿ   

+	POINT_RESIST_EARTH = 134,				// 134   : ݿ   

+	POINT_RESIST_DARK = 135,				// 135   : ݿ   

+

+	POINT_RESIST_CRITICAL = 136,			// 136 ũƼ  :  ũƼ Ȯ 

+	POINT_RESIST_PENETRATE = 137,			// 137 Ÿ  :  Ÿ Ȯ 

 

 	POINT_BLEEDING_REDUCE = 138,			// 138

 	POINT_BLEEDING_PCT = 139,				// 139

@@ -661,7 +661,7 @@
 	POINT_IMMUNE_BLEEDING100,

 	POINT_MONSTER_DEFEND_BONUS,

 

-	// Å¬¶óÀÌ¾ðÆ® Æ÷ÀÎÆ®

+	// Ŭ̾Ʈ Ʈ

 	POINT_MIN_WEP,

 	POINT_MAX_WEP,

 	POINT_MIN_MAGIC_WEP,

@@ -708,7 +708,7 @@
 	uint32_t id;

 };

 

-/* ÀúÀåÇÏ´Â µ¥ÀÌÅÍ */

+/* ϴ  */

 typedef struct character_point

 {

 	POINT_VALUE lPoints[POINT_MAX_NUM];

@@ -742,7 +742,7 @@
 #endif

 } CHARACTER_POINT;

 

-/* ÀúÀåµÇÁö ¾Ê´Â Ä³¸¯ÅÍ µ¥ÀÌÅÍ */

+/*  ʴ ĳ  */

 typedef struct character_point_instant

 {

 	POINT_VALUE points[POINT_MAX_NUM];

@@ -768,7 +768,7 @@
 	BYTE bEquipmentItemGrid[EQUIPMENT_MAX_NUM];

 

 #if defined(__DRAGON_SOUL_SYSTEM__)

-	// ¿ëÈ¥¼® ÀÎº¥Åä¸®.

+	// ȥ κ丮.

 	LPITEM pDragonSoulInventoryItems[DRAGON_SOUL_INVENTORY_MAX_NUM];

 	WORD wDragonSoulInventoryItemGrid[DRAGON_SOUL_INVENTORY_MAX_NUM];

 #endif

@@ -793,7 +793,7 @@
 

 	BYTE gm_level;

 

-	BYTE bBasePart; // Æò»óº¹ ¹øÈ£

+	BYTE bBasePart; //  ȣ

 

 	int iMaxStamina;

 

@@ -907,7 +907,7 @@
 {

 protected:

 	//////////////////////////////////////////////////////////////////////////////////

-	// Entity °ü·Ã

+	// Entity 

 	virtual void EncodeInsertPacket(LPENTITY entity);

 	virtual void EncodeRemovePacket(LPENTITY entity);

 	//////////////////////////////////////////////////////////////////////////////////

@@ -917,7 +917,7 @@
 	void UpdatePacket();

 

 	//////////////////////////////////////////////////////////////////////////////////

-	// FSM (Finite State Machine) °ü·Ã

+	// FSM (Finite State Machine) 

 protected:

 	CStateTemplate<CHARACTER> m_stateMove;

 	CStateTemplate<CHARACTER> m_stateBattle;

@@ -992,13 +992,13 @@
 	DWORD GetPlayerID() const { return m_dwPlayerID; }

 

 	void SetPlayerProto(const TPlayerTable* table);

-	void CreatePlayerProto(TPlayerTable& tab); // ÀúÀå ½Ã »ç¿ë

+	void CreatePlayerProto(TPlayerTable& tab); //   

 

 	void SetProto(const CMob* c_pkMob);

 	WORD GetRaceNum() const;

 

 	void Save(); // DelayedSave

-	void SaveReal(); // ½ÇÁ¦ ÀúÀå

+	void SaveReal(); //  

 	void FlushDelayedSaveItem();

 

 	const char* GetName() const;

@@ -1057,7 +1057,7 @@
 	DWORD GetNextConquerorExp() const;

 #endif

 

-	LPCHARACTER DistributeExp(); // Á¦ÀÏ ¸¹ÀÌ ¶§¸° »ç¶÷À» ¸®ÅÏÇÑ´Ù.

+	LPCHARACTER DistributeExp(); //     Ѵ.

 

 	void DistributeHP(LPCHARACTER pkKiller);

 	void DistributeSP(LPCHARACTER pkKiller, int iMethod = 0);

@@ -1156,7 +1156,7 @@
 	DWORD GetPolymorphItemVnum() const;

 	DWORD GetMonsterDrainSPPoint() const;

 

-	void MainCharacterPacket(); // ³»°¡ ¸ÞÀÎÄ³¸¯ÅÍ¶ó°í º¸³»ÁØ´Ù.

+	void MainCharacterPacket(); //  ĳͶ ش.

 

 	void ComputePoints();

 	void ComputeBattlePoints();

@@ -1166,7 +1166,7 @@
 	void UpdatePointsPacket(POINT_TYPE wPointType, POINT_VALUE lPointValue, POINT_VALUE lPointAmount = 0, bool bAmount = false, bool bBroadcast = false);

 

 	void ApplyPoint(POINT_TYPE wApplyType, POINT_VALUE lApplyValue);

-	void CheckMaximumPoints(); // HP, SP µîÀÇ ÇöÀç °ªÀÌ ÃÖ´ë°ª º¸´Ù ³ôÀºÁö °Ë»çÇÏ°í ³ô´Ù¸é ³·Ãá´Ù.

+	void CheckMaximumPoints(); // HP, SP    ִ밪   ˻ϰ ٸ .

 

 

 	bool Show(long lMapIndex, long x, long y, long z = LONG_MAX, bool bShowSpawnMotion = false

@@ -1211,7 +1211,7 @@
 	bool IsUnlockedShopBanner(BYTE bFlag) const { return (m_pointsInstant.bUnlockedShopBanner & bFlag) ? true : false; }

 #endif

 	bool IsPolymorphed() const { return m_dwPolymorphRace > 0; }

-	bool IsPolyMaintainStat() const { return m_bPolyMaintainStat; } // ÀÌÀü ½ºÅÝÀ» À¯ÁöÇÏ´Â Æú¸®¸ðÇÁ.

+	bool IsPolyMaintainStat() const { return m_bPolyMaintainStat; } //   ϴ .

 	void SetPolymorph(DWORD dwRaceNum, bool bMaintainStat = false);

 	DWORD GetPolymorphVnum() const { return m_dwPolymorphRace; }

 	int GetPolymorphPower() const;

@@ -1273,15 +1273,15 @@
 	void SetNowWalking(bool bWalkFlag);

 	void ResetWalking() { SetNowWalking(m_bWalking); }

 

-	bool Goto(long x, long y); // ¹Ù·Î ÀÌµ¿ ½ÃÅ°Áö ¾Ê°í ¸ñÇ¥ À§Ä¡·Î BLENDING ½ÃÅ²´Ù.

+	bool Goto(long x, long y); // ٷ ̵ Ű ʰ ǥ ġ BLENDING Ų.

 	void Stop();

 

-	bool CanMove() const; // ÀÌµ¿ÇÒ ¼ö ÀÖ´Â°¡?

+	bool CanMove() const; // ̵  ִ°?

 

 	void SyncPacket();

-	bool Sync(long x, long y); // ½ÇÁ¦ ÀÌ ¸Þ¼Òµå·Î ÀÌµ¿ ÇÑ´Ù (°¢ Á¾ Á¶°Ç¿¡ ÀÇÇÑ ÀÌµ¿ ºÒ°¡°¡ ¾øÀ½)

-	bool Move(long x, long y); // Á¶°ÇÀ» °Ë»çÇÏ°í Sync ¸Þ¼Òµå¸¦ ÅëÇØ ÀÌµ¿ ÇÑ´Ù.

-	void OnMove(bool bIsAttack = false); // ¿òÁ÷ÀÏ¶§ ºÒ¸°´Ù. Move() ¸Þ¼Òµå ÀÌ¿Ü¿¡¼­µµ ºÒ¸± ¼ö ÀÖ´Ù.

+	bool Sync(long x, long y); //   ޼ҵ ̵ Ѵ (  ǿ  ̵ Ұ )

+	bool Move(long x, long y); //  ˻ϰ Sync ޼ҵ带  ̵ Ѵ.

+	void OnMove(bool bIsAttack = false); // ϶ Ҹ. Move() ޼ҵ ̿ܿ Ҹ  ִ.

 	DWORD GetMotionMode() const;

 	float GetMoveMotionSpeed() const;

 	float GetMoveSpeed() const;

@@ -1293,7 +1293,7 @@
 	DWORD GetLastMoveTime() const { return m_dwLastMoveTime; }

 	DWORD GetLastAttackTime() const { return m_dwLastAttackTime; }

 

-	void SetLastAttacked(DWORD time); // ¸¶Áö¸·À¸·Î °ø°Ý¹ÞÀº ½Ã°£ ¹× À§Ä¡¸¦ ÀúÀåÇÔ

+	void SetLastAttacked(DWORD time); //  ݹ ð  ġ 

 

 	bool SetSyncOwner(LPCHARACTER ch, bool bRemoveFromList = true);

 	bool IsSyncOwner(LPCHARACTER ch) const;

@@ -1325,7 +1325,7 @@
 

 	float m_fSyncTime;

 	LPCHARACTER m_pkChrSyncOwner;

-	CHARACTER_LIST m_kLst_pkChrSyncOwned; // ³»°¡ SyncOwnerÀÎ ÀÚµé

+	CHARACTER_LIST m_kLst_pkChrSyncOwned; //  SyncOwner ڵ

 

 	PIXEL_POSITION m_posDest;

 	PIXEL_POSITION m_posStart;

@@ -1349,7 +1349,7 @@
 

 	// End

 

-	// Quickslot °ü·Ã

+	// Quickslot 

 public:

 	void SyncQuickslot(BYTE bType, WORD wOldPos, WORD wNewPos);

 	bool GetQuickslot(BYTE pos, TQuickslot** ppSlot);

@@ -1418,7 +1418,7 @@
 	void SaveAffect();

 

 public:

-	// Affect loadingÀÌ ³¡³­ »óÅÂÀÎ°¡?

+	// Affect loading  ΰ?

 	bool IsLoadedAffect() const { return m_bIsLoadedAffect; }

 

 	bool IsGoodAffect(BYTE bAffectType) const;

@@ -1450,25 +1450,25 @@
 	void DenyToParty(LPCHARACTER member);

 	void AcceptToParty(LPCHARACTER member);

 

-	/// ÀÚ½ÅÀÇ ÆÄÆ¼¿¡ ´Ù¸¥ character ¸¦ ÃÊ´ëÇÑ´Ù.

+	/// ڽ Ƽ ٸ character  ʴѴ.

 	/**

-	* @param pchInvitee ÃÊ´ëÇÒ ´ë»ó character. ÆÄÆ¼¿¡ Âü¿© °¡´ÉÇÑ »óÅÂÀÌ¾î¾ß ÇÑ´Ù.

+	* @param pchInvitee ʴ  character. Ƽ   ̾ Ѵ.

 	*

-	* ¾çÃø character ÀÇ »óÅÂ°¡ ÆÄÆ¼¿¡ ÃÊ´ëÇÏ°í ÃÊ´ë¹ÞÀ» ¼ö ÀÖ´Â »óÅÂ°¡ ¾Æ´Ï¶ó¸é ÃÊ´ëÇÏ´Â Ä³¸¯ÅÍ¿¡°Ô ÇØ´çÇÏ´Â Ã¤ÆÃ ¸Þ¼¼Áö¸¦ Àü¼ÛÇÑ´Ù.

+	*  character  ° Ƽ ʴϰ ʴ  ִ ° ƴ϶ ʴϴ ĳͿ شϴ ä ޼ Ѵ.

 	**/

 	void PartyInvite(LPCHARACTER pchInvitee);

 

-	/// ÃÊ´ëÇß´ø character ÀÇ ¼ö¶ôÀ» Ã³¸®ÇÑ´Ù.

+	/// ʴߴ character   óѴ.

 	/**

-	* @param pchInvitee ÆÄÆ¼¿¡ Âü¿©ÇÒ character. ÆÄÆ¼¿¡ Âü¿©°¡´ÉÇÑ »óÅÂÀÌ¾î¾ß ÇÑ´Ù.

+	* @param pchInvitee Ƽ  character. Ƽ  ̾ Ѵ.

 	*

-	* pchInvitee °¡ ÆÄÆ¼¿¡ °¡ÀÔÇÒ ¼ö ÀÖ´Â »óÈ²ÀÌ ¾Æ´Ï¶ó¸é ÇØ´çÇÏ´Â Ã¤ÆÃ ¸Þ¼¼Áö¸¦ Àü¼ÛÇÑ´Ù.

+	* pchInvitee  Ƽ   ִ Ȳ ƴ϶ شϴ ä ޼ Ѵ.

 	**/

 	void PartyInviteAccept(LPCHARACTER pchInvitee);

 

-	/// ÃÊ´ëÇß´ø character ÀÇ ÃÊ´ë °ÅºÎ¸¦ Ã³¸®ÇÑ´Ù.

+	/// ʴߴ character  ʴ źθ óѴ.

 	/**

-	* @param [in] dwPID ÃÊ´ë Çß´ø character ÀÇ PID

+	* @param [in] dwPID ʴ ߴ character  PID

 	**/

 	void PartyInviteDeny(DWORD dwPID);

 

@@ -1487,46 +1487,46 @@
 

 protected:

 

-	/// ÆÄÆ¼¿¡ °¡ÀÔÇÑ´Ù.

+	/// Ƽ Ѵ.

 	/**

-	* @param pkLeader °¡ÀÔÇÒ ÆÄÆ¼ÀÇ ¸®´õ

+	* @param pkLeader  Ƽ 

 	**/

 	void PartyJoin(LPCHARACTER pkLeader);

 

 	/**

-	* ÆÄÆ¼ °¡ÀÔÀ» ÇÒ ¼ö ¾øÀ» °æ¿ìÀÇ ¿¡·¯ÄÚµå.

-	* Error code ´Â ½Ã°£¿¡ ÀÇÁ¸ÀûÀÎ°¡¿¡ µû¶ó º¯°æ°¡´ÉÇÑ(mutable) type °ú Á¤Àû(static) type À¸·Î ³ª´¶´Ù.

-	* Error code ÀÇ °ªÀÌ PERR_SEPARATOR º¸´Ù ³·À¸¸é º¯°æ°¡´ÉÇÑ type ÀÌ°í ³ôÀ¸¸é Á¤Àû type ÀÌ´Ù.

+	* Ƽ      ڵ.

+	* Error code  ð ΰ  氡(mutable) type  (static) type  .

+	* Error code   PERR_SEPARATOR   氡 type ̰   type ̴.

 	**/

 	enum PartyJoinErrCode

 	{

-		PERR_NONE = 0, ///< Ã³¸®¼º°ø

-		PERR_SERVER, ///< ¼­¹ö¹®Á¦·Î ÆÄÆ¼°ü·Ã Ã³¸® ºÒ°¡

-		PERR_DUNGEON, ///< Ä³¸¯ÅÍ°¡ ´øÀü¿¡ ÀÖÀ½

-		PERR_OBSERVER, ///< °üÀü¸ðµåÀÓ

-		PERR_LVBOUNDARY, ///< »ó´ë Ä³¸¯ÅÍ¿Í ·¹º§Â÷ÀÌ°¡ ³²

-		PERR_LOWLEVEL, ///< »ó´ëÆÄÆ¼ÀÇ ÃÖ°í·¹º§º¸´Ù 30·¹º§ ³·À½

-		PERR_HILEVEL, ///< »ó´ëÆÄÆ¼ÀÇ ÃÖÀú·¹º§º¸´Ù 30·¹º§ ³ôÀ½

-		PERR_ALREADYJOIN, ///< ÆÄÆ¼°¡ÀÔ ´ë»ó Ä³¸¯ÅÍ°¡ ÀÌ¹Ì ÆÄÆ¼Áß

-		PERR_PARTYISFULL, ///< ÆÄÆ¼ÀÎ¿ø Á¦ÇÑ ÃÊ°ú

+		PERR_NONE = 0, ///< ó

+		PERR_SERVER, ///<  Ƽ ó Ұ

+		PERR_DUNGEON, ///< ĳͰ  

+		PERR_OBSERVER, ///< 

+		PERR_LVBOUNDARY, ///<  ĳͿ ̰ 

+		PERR_LOWLEVEL, ///< Ƽ ְ 30 

+		PERR_HILEVEL, ///< Ƽ  30 

+		PERR_ALREADYJOIN, ///< Ƽ  ĳͰ ̹ Ƽ

+		PERR_PARTYISFULL, ///< Ƽο  ʰ

 		PERR_SEPARATOR, ///< Error type separator.

-		PERR_DIFFEMPIRE, ///< »ó´ë Ä³¸¯ÅÍ¿Í ´Ù¸¥ Á¦±¹ÀÓ

-		PERR_MAX ///< Error code ÃÖ°íÄ¡. ÀÌ ¾Õ¿¡ Error code ¸¦ Ãß°¡ÇÑ´Ù.

+		PERR_DIFFEMPIRE, ///<  ĳͿ ٸ 

+		PERR_MAX ///< Error code ְġ.  տ Error code  ߰Ѵ.

 	};

 

-	/// ÆÄÆ¼ °¡ÀÔÀÌ³ª °á¼º °¡´ÉÇÑ Á¶°ÇÀ» °Ë»çÇÑ´Ù.

+	/// Ƽ ̳ Ἲ   ˻Ѵ.

 	/**

-	* @param pchLeader ÆÄÆ¼ÀÇ leader ÀÌ°Å³ª ÃÊ´ëÇÑ character

-	* @param pchGuest ÃÊ´ë¹Þ´Â character

-	* @return ¸ðµç PartyJoinErrCode °¡ ¹ÝÈ¯µÉ ¼ö ÀÖ´Ù.

+	* @param pchLeader Ƽ leader ̰ų ʴ character

+	* @param pchGuest ʴ޴ character

+	* @return  PartyJoinErrCode  ȯ  ִ.

 	**/

 	static PartyJoinErrCode IsPartyJoinableCondition(const LPCHARACTER pchLeader, const LPCHARACTER pchGuest);

 

-	/// ÆÄÆ¼ °¡ÀÔÀÌ³ª °á¼º °¡´ÉÇÑ µ¿ÀûÀÎ Á¶°ÇÀ» °Ë»çÇÑ´Ù.

+	/// Ƽ ̳ Ἲ    ˻Ѵ.

 	/**

-	* @param pchLeader ÆÄÆ¼ÀÇ leader ÀÌ°Å³ª ÃÊ´ëÇÑ character

-	* @param pchGuest ÃÊ´ë¹Þ´Â character

-	* @return mutable type ÀÇ code ¸¸ ¹ÝÈ¯ÇÑ´Ù.

+	* @param pchLeader Ƽ leader ̰ų ʴ character

+	* @param pchGuest ʴ޴ character

+	* @return mutable type  code  ȯѴ.

 	**/

 	static PartyJoinErrCode IsPartyJoinableMutableCondition(const LPCHARACTER pchLeader, const LPCHARACTER pchGuest);

 

@@ -1535,11 +1535,11 @@
 	LPEVENT m_pkPartyRequestEvent;

 

 	/**

-	* ÆÄÆ¼ÃÊÃ» Event map.

-	* key: ÃÊ´ë¹ÞÀº Ä³¸¯ÅÍÀÇ PID

-	* value: eventÀÇ pointer

+	* Ƽû Event map.

+	* key: ʴ ĳ PID

+	* value: event pointer

 	*

-	* ÃÊ´ëÇÑ Ä³¸¯ÅÍµé¿¡ ´ëÇÑ event map.

+	* ʴ ĳ͵鿡  event map.

 	**/

 	typedef std::map<DWORD, LPEVENT> EventMap;

 	EventMap m_PartyInviteEventMap;

@@ -1573,7 +1573,7 @@
 	////////////////////////////////////////////////////////////////////////////////////////

 	// Item related

 public:

-	bool CanHandleItem(bool bSkipRefineCheck = false, bool bSkipObserver = false); // ¾ÆÀÌÅÛ °ü·Ã ÇàÀ§¸¦ ÇÒ ¼ö ÀÖ´Â°¡?

+	bool CanHandleItem(bool bSkipRefineCheck = false, bool bSkipObserver = false); //      ִ°?

 

 	bool IsItemLoaded() const { return m_bItemLoaded; }

 	void SetItemLoaded() { m_bItemLoaded = true; }

@@ -1599,14 +1599,14 @@
 	LPITEM GetWear(WORD wCell) const;

 

 	// MYSHOP_PRICE_LIST

-	void UseSilkBotary(void); /// ºñ´Ü º¸µû¸® ¾ÆÀÌÅÛÀÇ »ç¿ë

-

-	/// DB Ä³½Ã·Î ºÎÅÍ ¹Þ¾Æ¿Â °¡°ÝÁ¤º¸ ¸®½ºÆ®¸¦ À¯Àú¿¡°Ô Àü¼ÛÇÏ°í º¸µû¸® ¾ÆÀÌÅÛ »ç¿ëÀ» Ã³¸®ÇÑ´Ù.

+	void UseSilkBotary(void); ///    

+

+	/// DB ĳ÷  ޾ƿ  Ʈ  ϰ    óѴ.

 	/**

-	* @param [in] p °¡°ÝÁ¤º¸ ¸®½ºÆ® ÆÐÅ¶

+	* @param [in] p  Ʈ Ŷ

 	*

-	* Á¢¼ÓÇÑ ÈÄ Ã³À½ ºñ´Ü º¸µû¸® ¾ÆÀÌÅÛ »ç¿ë ½Ã UseSilkBotary ¿¡¼­ DB Ä³½Ã·Î °¡°ÝÁ¤º¸ ¸®½ºÆ®¸¦ ¿äÃ»ÇÏ°í

-	* ÀÀ´ä¹ÞÀº ½ÃÁ¡¿¡ ÀÌ ÇÔ¼ö¿¡¼­ ½ÇÁ¦ ºñ´Üº¸µû¸® »ç¿ëÀ» Ã³¸®ÇÑ´Ù.

+	*   ó      UseSilkBotary  DB ĳ÷  Ʈ ûϰ

+	*    Լ  ܺ  óѴ.

 	**/

 	void UseSilkBotaryReal(const TPacketMyshopPricelistHeader* p);

 	// END_OF_MYSHOP_PRICE_LIST

@@ -1667,9 +1667,9 @@
 	bool EquipItem(LPITEM item, int iCandidateCell = -1);

 	bool UnequipItem(LPITEM item);

 

-	// ÇöÀç itemÀ» Âø¿ëÇÒ ¼ö ÀÖ´Â Áö È®ÀÎÇÏ°í, ºÒ°¡´É ÇÏ´Ù¸é Ä³¸¯ÅÍ¿¡°Ô ÀÌÀ¯¸¦ ¾Ë·ÁÁÖ´Â ÇÔ¼ö

+	//  item   ִ  Ȯϰ, Ұ ϴٸ ĳͿ  ˷ִ Լ

 	bool CanEquipNow(const LPITEM item, const TItemPos& srcCell = NPOS, const TItemPos& destCell = NPOS);

-	// Âø¿ëÁßÀÎ itemÀ» ¹þÀ» ¼ö ÀÖ´Â Áö È®ÀÎÇÏ°í, ºÒ°¡´É ÇÏ´Ù¸é Ä³¸¯ÅÍ¿¡°Ô ÀÌÀ¯¸¦ ¾Ë·ÁÁÖ´Â ÇÔ¼ö

+	//  item   ִ  Ȯϰ, Ұ ϴٸ ĳͿ  ˷ִ Լ

 	bool CanUnequipNow(const LPITEM item, const TItemPos& srcCell = NPOS, const TItemPos& destCell = NPOS);

 

 	bool SwapItem(WORD wCell, WORD wDestCell);

@@ -1739,10 +1739,10 @@
 	// End of Item

 

 protected:

-	/// ÇÑ ¾ÆÀÌÅÛ¿¡ ´ëÇÑ °¡°ÝÁ¤º¸¸¦ Àü¼ÛÇÑ´Ù.

+	///  ۿ   Ѵ.

 	/**

-	* @param [in] dwItemVnum ¾ÆÀÌÅÛ vnum

-	* @param [in] dwItemPrice ¾ÆÀÌÅÛ °¡°Ý

+	* @param [in] dwItemVnum  vnum

+	* @param [in] dwItemPrice  

 	**/

 	void SendMyShopPriceListCmd(DWORD dwItemVnum, DWORD dwItemPrice

 #if defined(__CHEQUE_SYSTEM__)

@@ -1750,7 +1750,7 @@
 #endif

 	);

 

-	bool m_bNoOpenedShop; ///< ÀÌ¹ø Á¢¼Ó ÈÄ °³ÀÎ»óÁ¡À» ¿¬ ÀûÀÌ ÀÖ´ÂÁöÀÇ ¿©ºÎ(¿­¾ú´ø ÀûÀÌ ¾ø´Ù¸é true)

+	bool m_bNoOpenedShop; ///< ̹   λ   ִ (  ٸ true)

 

 	bool m_bItemLoaded;

 	int m_iRefineAdditionalCell;

@@ -1767,7 +1767,7 @@
 	void SetGold(int iValue) { m_points.iGold = iValue; }

 

 	bool DropGold(int iAmount);

-	void GiveGold(int iAmount); // ÆÄÆ¼°¡ ÀÖÀ¸¸é ÆÄÆ¼ ºÐ¹è, ·Î±× µîÀÇ Ã³¸®

+	void GiveGold(int iAmount); // Ƽ  Ƽ й, α  ó

 

 	int GetAllowedGold() const;

 

@@ -1859,9 +1859,9 @@
 	bool CanFight() const;

 

 	bool CanBeginFight() const;

-	void BeginFight(LPCHARACTER pkVictim); // pkVictimr°ú ½Î¿ì±â ½ÃÀÛÇÑ´Ù. (°­Á¦ÀûÀÓ, ½ÃÀÛÇÒ ¼ö ÀÖ³ª Ã¼Å©ÇÏ·Á¸é CanBeginFightÀ» »ç¿ë)

-

-	bool CounterAttack(LPCHARACTER pkChr); // ¹Ý°ÝÇÏ±â (¸ó½ºÅÍ¸¸ »ç¿ë)

+	void BeginFight(LPCHARACTER pkVictim); // pkVictimr ο Ѵ. (,   ֳ üũϷ CanBeginFight )

+

+	bool CounterAttack(LPCHARACTER pkChr); // ݰϱ (͸ )

 

 	bool IsStun() const;

 	void Stun(bool bImmediate = false);

@@ -1894,7 +1894,7 @@
 	void UpdateAlignment(int iAmount);

 	int GetAlignment() const;

 

-	// ¼±¾ÇÄ¡ ¾ò±â 

+	// ġ  

 	int GetRealAlignment() const;

 	void ShowAlignment(bool bShow);

 

@@ -1944,7 +1944,7 @@
 

 	DWORD m_dwFlyTargetID;

 	std::vector<DWORD> m_vec_dwFlyTargets;

-	TDamageMap m_map_kDamage; // ¾î¶² Ä³¸¯ÅÍ°¡ ³ª¿¡°Ô ¾ó¸¶¸¸Å­ÀÇ µ¥¹ÌÁö¸¦ ÁÖ¾ú´Â°¡?

+	TDamageMap m_map_kDamage; //  ĳͰ  󸶸ŭ  ־°?

 	//AttackLog m_kAttackLog;

 	DWORD m_dwKillerPID;

 

@@ -1967,8 +1967,8 @@
 	BYTE GetDropMetinStonePct() const { return m_bDropMetinStonePct; }

 

 protected:

-	LPCHARACTER m_pkChrStone; // ³ª¸¦ ½ºÆùÇÑ µ¹

-	CHARACTER_SET m_set_pkChrSpawnedBy; // ³»°¡ ½ºÆùÇÑ ³ðµé

+	LPCHARACTER m_pkChrStone; //   

+	CHARACTER_SET m_set_pkChrSpawnedBy; //   

 	DWORD m_dwDropMetinStone;

 	BYTE m_bDropMetinStonePct;

 	// End of Stone

@@ -2041,7 +2041,7 @@
 

 private:

 	bool m_bDisableCooltime;

-	DWORD m_dwLastSkillTime; ///< ¸¶Áö¸·À¸·Î skill À» ¾´ ½Ã°£(millisecond).

+	DWORD m_dwLastSkillTime; ///<  skill   ð(millisecond).

 	// End of Skill

 

 	// MOB_SKILL

@@ -2117,10 +2117,10 @@
 	// AI related

 public:

 	void AssignTriggers(const TMobTable* table);

-	LPCHARACTER GetVictim() const; // °ø°ÝÇÒ ´ë»ó ¸®ÅÏ

+	LPCHARACTER GetVictim() const; //   

 	void SetVictim(LPCHARACTER pkVictim);

 	LPCHARACTER GetNearestVictim(LPCHARACTER pkChr);

-	LPCHARACTER GetProtege() const; // º¸È£ÇØ¾ß ÇÒ ´ë»ó ¸®ÅÏ

+	LPCHARACTER GetProtege() const; // ȣؾ   

 

 	bool Follow(LPCHARACTER pkChr, float fMinimumDistance = 150.0f);

 	bool Return();

@@ -2144,8 +2144,8 @@
 	////////////////////////////////////////////////////////////////////////////////////////

 	// Target

 protected:

-	LPCHARACTER m_pkChrTarget; // ³» Å¸°Ù

-	CHARACTER_SET m_set_pkChrTargetedBy; // ³ª¸¦ Å¸°ÙÀ¸·Î °¡Áö°í ÀÖ´Â »ç¶÷µé

+	LPCHARACTER m_pkChrTarget; //  Ÿ

+	CHARACTER_SET m_set_pkChrTargetedBy; //  Ÿ  ִ 

 

 public:

 	void SetTarget(LPCHARACTER pkChrTarget);

@@ -2166,19 +2166,19 @@
 	void ChangeSafeboxSize(BYTE bSize);

 	void CloseSafebox();

 

-	/// Ã¢°í ¿­±â ¿äÃ»

+	/// â  û

 	/**

-	* @param [in] pszPassword 1ÀÚ ÀÌ»ó 6ÀÚ ÀÌÇÏÀÇ Ã¢°í ºñ¹Ð¹øÈ£

+	* @param [in] pszPassword 1 ̻ 6  â йȣ

 	*

-	* DB ¿¡ Ã¢°í¿­±â¸¦ ¿äÃ»ÇÑ´Ù.

-	* Ã¢°í´Â Áßº¹À¸·Î ¿­Áö ¸øÇÏ¸ç, ÃÖ±Ù Ã¢°í¸¦ ´ÝÀº ½Ã°£À¸·Î ºÎÅÍ 10ÃÊ ÀÌ³»¿¡´Â ¿­ Áö ¸øÇÑ´Ù.

+	* DB  â⸦ ûѴ.

+	* â ߺ  ϸ, ֱ â  ð  10 ̳   Ѵ.

 	**/

 	void ReqSafeboxLoad(const char* pszPassword);

 

-	/// Ã¢°í ¿­±â ¿äÃ»ÀÇ Ãë¼Ò

+	/// â  û 

 	/**

-	* ReqSafeboxLoad ¸¦ È£ÃâÇÏ°í CloseSafebox ÇÏÁö ¾Ê¾ÒÀ» ¶§ ÀÌ ÇÔ¼ö¸¦ È£ÃâÇÏ¸é Ã¢°í¸¦ ¿­ ¼ö ÀÖ´Ù.

-	* Ã¢°í¿­±âÀÇ ¿äÃ»ÀÌ DB ¼­¹ö¿¡¼­ ½ÇÆÐÀÀ´äÀ» ¹Þ¾ÒÀ» °æ¿ì ÀÌ ÇÔ¼ö¸¦ »ç¿ëÇØ¼­ ¿äÃ»À» ÇÒ ¼ö ÀÖ°Ô ÇØÁØ´Ù.

+	* ReqSafeboxLoad  ȣϰ CloseSafebox  ʾ   Լ ȣϸ â   ִ.

+	* â û DB   ޾   Լ ؼ û   ְ ش.

 	**/

 	void CancelSafeboxLoad(void) { m_bOpeningSafebox = false; }

 

@@ -2199,7 +2199,7 @@
 	CSafebox* m_pkSafebox;

 	int m_iSafeboxSize;

 	int m_iSafeboxLoadTime;

-	bool m_bOpeningSafebox; ///< Ã¢°í°¡ ¿­±â ¿äÃ» ÁßÀÌ°Å³ª ¿­·ÁÀÖ´Â°¡ ¿©ºÎ, true ÀÏ °æ¿ì ¿­±â¿äÃ»ÀÌ°Å³ª ¿­·ÁÀÖÀ½.

+	bool m_bOpeningSafebox; ///< â  û ̰ų ִ° , true   ṵ̂ų .

 

 	CSafebox* m_pkMall;

 	int m_iMallLoadTime;

@@ -2234,7 +2234,7 @@
 

 	void HorseSummon(bool bSummon, bool bFromFar = false, DWORD dwVnum = 0, const char* pHorseName = 0);

 

-	LPCHARACTER GetHorse() const { return m_chHorse; } // ÇöÀç ¼ÒÈ¯ÁßÀÎ ¸»

+	LPCHARACTER GetHorse() const { return m_chHorse; } //  ȯ 

 	LPCHARACTER GetRider() const; // rider on horse

 	void SetRider(LPCHARACTER ch);

 

@@ -2339,7 +2339,7 @@
 	////////////////////////////////////////////////////////////////////////////////////////

 	// Resists & Proofs

 public:

-	bool CannotMoveByAffect() const; // Æ¯Á¤ È¿°ú¿¡ ÀÇÇØ ¿òÁ÷ÀÏ ¼ö ¾ø´Â »óÅÂÀÎ°¡?

+	bool CannotMoveByAffect() const; // Ư ȿ     ΰ?

 	bool IsImmune(DWORD dwImmuneFlag);

 	void SetImmuneFlag(DWORD dw) { m_pointsInstant.dwImmuneFlag = dw; }

 

@@ -2379,7 +2379,7 @@
 	void UpdateStateMachine(DWORD dwPulse);

 	void SetNextStatePulse(int iPulseNext);

 

-	// Ä³¸¯ÅÍ ÀÎ½ºÅÏ½º ¾÷µ¥ÀÌÆ® ÇÔ¼ö. ±âÁ¸¿£ ÀÌ»óÇÑ »ó¼Ó±¸Á¶·Î CFSM::Update ÇÔ¼ö¸¦ È£ÃâÇÏ°Å³ª UpdateStateMachine ÇÔ¼ö¸¦ »ç¿ëÇß´Âµ¥, º°°³ÀÇ ¾÷µ¥ÀÌÆ® ÇÔ¼ö Ãß°¡ÇÔ.

+	// ĳ νϽ Ʈ Լ.  ̻ ӱ CFSM::Update Լ ȣϰų UpdateStateMachine Լ ߴµ,  Ʈ Լ ߰.

 	void UpdateCharacter(DWORD dwPulse);

 

 protected:

@@ -2456,9 +2456,9 @@
 	int m_aiPremiumTimes[PREMIUM_MAX_NUM];

 

 	// CHANGE_ITEM_ATTRIBUTES

-	static const DWORD msc_dwDefaultChangeItemAttrCycle; ///< µðÆúÆ® ¾ÆÀÌÅÛ ¼Ó¼ºº¯°æ °¡´É ÁÖ±â

-	static const char msc_szLastChangeItemAttrFlag[]; ///< ÃÖ±Ù ¾ÆÀÌÅÛ ¼Ó¼ºÀ» º¯°æÇÑ ½Ã°£ÀÇ Quest Flag ÀÌ¸§

-	static const char msc_szChangeItemAttrCycleFlag[]; ///< ¾ÆÀÌÅÛ ¼Ó¼ºº´°æ °¡´É ÁÖ±âÀÇ Quest Flag ÀÌ¸§

+	static const DWORD msc_dwDefaultChangeItemAttrCycle; ///< Ʈ  Ӽ  ֱ

+	static const char msc_szLastChangeItemAttrFlag[]; ///< ֱ  Ӽ  ð Quest Flag ̸

+	static const char msc_szChangeItemAttrCycleFlag[]; ///<  Ӽ  ֱ Quest Flag ̸

 	// END_OF_CHANGE_ITEM_ATTRIBUTES

 

 	// PC_BANG_ITEM_ADD

@@ -2544,7 +2544,7 @@
 	bool PreventTradeWindow(int flags, bool except = false) const;

 	// END_PREVENT_TRADE_WINDOW

 

-	// Hack ¹æÁö¸¦ À§ÇÑ Ã¼Å©.

+	// Hack   üũ.

 	bool IsHack(bool bSendMsg = true, bool bCheckShopOwner = true, int limittime = g_nPortalLimitTime);

 

 	// MONARCH

@@ -2588,17 +2588,19 @@
 	// by mhh

 	LPITEM* GetCubeItem() { return m_pointsInstant.pCubeItems; }

 #endif

+#endif

 	bool IsCubeOpen() const { return (m_pointsInstant.pCubeNpc ? true : false); }

 	void SetCubeNpc(LPCHARACTER npc) { m_pointsInstant.pCubeNpc = npc; }

+	LPCHARACTER GetCubeNpc() const { return m_pointsInstant.pCubeNpc; }

 	bool CanDoCube() const;

 

 public:

 	bool IsSiegeNPC() const;

 

 private:

-	// Áß±¹ Àü¿ë

-	// 18¼¼ ¹Ì¸¸ Àü¿ë

-	// 3½Ã°£ : 50 % 5 ½Ã°£ 0%

+	// ߱ 

+	// 18 ̸ 

+	// 3ð : 50 % 5 ð 0%

 	e_overtime m_eOverTime;

 

 public:

@@ -2681,7 +2683,7 @@
 

 	typedef std::map<DWORD, CBuffOnAttributes*> TMapBuffOnAttrs;

 	TMapBuffOnAttrs m_map_buff_on_attrs;

-	// ¹«Àû : ¿øÈ°ÇÑ Å×½ºÆ®¸¦ À§ÇÏ¿©.

+	//  : Ȱ ׽Ʈ Ͽ.

 

 public:

 	void SetArmada() { cannot_dead = true; }

@@ -2699,7 +2701,7 @@
 	bool IsPet() { return m_bIsPet; }

 #endif

 

-	// ÃÖÁ¾ µ¥¹ÌÁö º¸Á¤.

+	//   .

 private:

 	float m_fAttMul;

 	float m_fDamMul;

@@ -2713,7 +2715,7 @@
 private:

 	bool IsValidItemPosition(TItemPos Pos) const;

 

-	// µ¶ÀÏ ¼±¹° ±â´É ÆÐÅ¶ ÀÓ½Ã ÀúÀå

+	//    Ŷ ӽ 

 private:

 	unsigned int itemAward_vnum;

 	char itemAward_cmd[20];

@@ -2723,7 +2725,7 @@
 	char* GetItemAward_cmd() { return itemAward_cmd; }

 	//bool GetItemAward_flag() { return itemAward_flag; }

 	void SetItemAward_vnum(unsigned int vnum) { itemAward_vnum = vnum; }

-	void SetItemAward_cmd(char* cmd) { strcpy(itemAward_cmd, cmd); }

+	void SetItemAward_cmd(char* cmd) { strlcpy(itemAward_cmd, cmd ? cmd : "", sizeof(itemAward_cmd)); }

 	//void SetItemAward_flag(bool flag) { itemAward_flag = flag; }

 

 #if defined(__MOVE_COSTUME_ATTR__)

@@ -2780,10 +2782,10 @@
 

 #if defined(__DRAGON_SOUL_SYSTEM__)

 public:

-	// ¿ëÈ¥¼®

-

-	// Ä³¸¯ÅÍÀÇ affect, quest°¡ load µÇ±â Àü¿¡ DragonSoul_Initialize¸¦ È£ÃâÇÏ¸é ¾ÈµÈ´Ù.

-	// affect°¡ °¡Àå ¸¶Áö¸·¿¡ ·ÎµåµÇ¾î LoadAffect¿¡¼­ È£ÃâÇÔ.

+	// ȥ

+

+	// ĳ affect, quest load Ǳ  DragonSoul_Initialize ȣϸ ȵȴ.

+	// affect   εǾ LoadAffect ȣ.

 	void DragonSoul_Initialize();

 

 	bool DragonSoul_IsQualified() const;

@@ -2794,15 +2796,15 @@
 	bool DragonSoul_ActivateDeck(int iDeckIdx);

 

 	void DragonSoul_DeactivateAll();

-	// ¹Ýµå½Ã ClearItem Àü¿¡ ºÒ·¯¾ß ÇÑ´Ù.

-	// ¿Ö³ÄÇÏ¸é....

-	// ¿ëÈ¥¼® ÇÏ³ª ÇÏ³ª¸¦ deactivateÇÒ ¶§¸¶´Ù µ¦¿¡ activeÀÎ ¿ëÈ¥¼®ÀÌ ÀÖ´ÂÁö È®ÀÎÇÏ°í,

-	// activeÀÎ ¿ëÈ¥¼®ÀÌ ÇÏ³ªµµ ¾ø´Ù¸é, Ä³¸¯ÅÍÀÇ ¿ëÈ¥¼® affect¿Í, È°¼º »óÅÂ¸¦ Á¦°ÅÇÑ´Ù.

+	// ݵ ClearItem  ҷ Ѵ.

+	// ֳϸ....

+	// ȥ ϳ ϳ deactivate   active ȥ ִ Ȯϰ,

+	// active ȥ ϳ ٸ, ĳ ȥ affect, Ȱ ¸ Ѵ.

 	// 

-	// ÇÏÁö¸¸ ClearItem ½Ã, Ä³¸¯ÅÍ°¡ Âø¿ëÇÏ°í ÀÖ´Â ¸ðµç ¾ÆÀÌÅÛÀ» unequipÇÏ´Â ¹Ù¶÷¿¡,

-	// ¿ëÈ¥¼® Affect°¡ Á¦°ÅµÇ°í, °á±¹ ·Î±×ÀÎ ½Ã, ¿ëÈ¥¼®ÀÌ È°¼ºÈ­µÇÁö ¾Ê´Â´Ù.

-	// (UnequipÇÒ ¶§¿¡´Â ·Î±×¾Æ¿ô »óÅÂÀÎÁö, ¾Æ´ÑÁö ¾Ë ¼ö ¾ø´Ù.)

-	// ¿ëÈ¥¼®¸¸ deactivate½ÃÅ°°í Ä³¸¯ÅÍÀÇ ¿ëÈ¥¼® µ¦ È°¼º »óÅÂ´Â °Çµå¸®Áö ¾Ê´Â´Ù.

+	//  ClearItem , ĳͰ ϰ ִ   unequipϴ ٶ,

+	// ȥ Affect ŵǰ, ᱹ α , ȥ Ȱȭ ʴ´.

+	// (Unequip  α׾ƿ , ƴ   .)

+	// ȥ deactivateŰ ĳ ȥ  Ȱ ´ ǵ帮 ʴ´.

 	void DragonSoul_CleanUp();

 

 #if defined(__DS_SET__)

@@ -2812,7 +2814,7 @@
 	void DragonSoul_ActivateAll();

 #endif

 

-	// ¿ëÈ¥¼® °­È­Ã¢

+	// ȥ ȭâ

 public:

 	bool DragonSoul_RefineWindow_Open(LPENTITY pEntity);

 #if defined(__DS_CHANGE_ATTR__)

@@ -2824,10 +2826,17 @@
 #endif

 

 private:

-	// SyncPositionÀ» ¾Ç¿ëÇÏ¿© Å¸À¯Àú¸¦ ÀÌ»óÇÑ °÷À¸·Î º¸³»´Â ÇÙ ¹æ¾îÇÏ±â À§ÇÏ¿©,

-	// SyncPositionÀÌ ÀÏ¾î³¯ ¶§¸¦ ±â·Ï.

+	// SyncPosition ǿϿ Ÿ ̻    ϱ Ͽ,

+	// SyncPosition Ͼ  .

 	timeval m_tvLastSyncTime;

 	int m_iSyncHackCount;

+

+	// [Anti-Abuse] SyncPosition packet spam tracking (CPU burner mitigation)

+	DWORD m_dwSyncPosWindowStart;

+	int m_iSyncPosPacketCount;

+	int m_iSyncPosSpamStrikes;

+	long m_lSyncPosLastX;

+	long m_lSyncPosLastY;

 public:

 	void SetLastSyncTime(const timeval& tv) { memcpy(&m_tvLastSyncTime, &tv, sizeof(timeval)); }

 	const timeval& GetLastSyncTime() { return m_tvLastSyncTime; }


--- a/server/metin2/Source/Server/game/src/char_change_empire.cpp
+++ b/server/metin2/Source/Server/game/src/char_change_empire.cpp
@@ -7,20 +7,38 @@
 #include "marriage.h"

 #include "../../common/service.h"

 

+namespace

+{

+	static bool IsEngagedOrMarriedInDB(DWORD pid)

+	{

+		char szQuery[256];

+		snprintf(szQuery, sizeof(szQuery),

+			"SELECT 1 FROM marriage%s WHERE pid1=%u OR pid2=%u LIMIT 1",

+			get_table_postfix(), pid, pid);

+		std::unique_ptr<SQLMsg> pMsg(DBManager::instance().DirectQuery(szQuery));

+		return (pMsg && pMsg->Get()->uiNumRows > 0);

+	}

+}

+

+

 /*

 Return Value

-	0 : ¾Ë ¼ö ¾ø´Â ¿¡·¯ or Äõ¸® ¿¡·¯

-	1 : µ¿ÀÏÇÑ Á¦±¹À¸·Î ¹Ù²Ù·Á°íÇÔ

-	2 : ±æµå °¡ÀÔÇÑ Ä³¸¯ÅÍ°¡ ÀÖÀ½

-	3 : °áÈ¥ÇÑ Ä³¸¯ÅÍ°¡ ÀÖÀ½

-

-	999 : Á¦±¹ ÀÌµ¿ ¼º°ø

+	0 :     or  

+	1 :   ٲٷ

+	2 :   ĳͰ 

+	3 : ȥ ĳͰ 

+

+	999 :  ̵ 

 */

 

 int CHARACTER::ChangeEmpire(BYTE empire)

 {

 	if (GetEmpire() == empire)

 		return 1;

+

+	// [Security] Block empire change while in a guild (prevents guild/war table corruption).

+	if (GetGuild())

+		return 2;

 

 	char szQuery[1024 + 1];

 	DWORD dwAID;

@@ -28,7 +46,7 @@
 	memset(dwPID, 0, sizeof(dwPID));

 

 	{

-		// 1. ³» °èÁ¤ÀÇ ¸ðµç pid¸¦ ¾ò¾î ¿Â´Ù

+		// 1.    pid  ´

 		snprintf(szQuery, sizeof(szQuery), "SELECT "

 			"id, "

 			"pid1, "

@@ -76,8 +94,8 @@
 	const int loop = 4;

 

 	{

-		// 2. °¢ Ä³¸¯ÅÍÀÇ ±æµå Á¤º¸¸¦ ¾ò¾î¿Â´Ù.

-		// ÇÑ Ä³¸¯ÅÍ¶óµµ ±æµå¿¡ °¡ÀÔ µÇ¾î ÀÖ´Ù¸é, Á¦±¹ ÀÌµ¿À» ÇÒ ¼ö ¾ø´Ù.

+		// 2.  ĳ   ´.

+		//  ĳͶ 忡  Ǿ ִٸ,  ̵   .

 		DWORD dwGuildID[4];

 		CGuild* pGuild[4];

 

@@ -106,17 +124,17 @@
 	}

 

 	{

-		// 3. °¢ Ä³¸¯ÅÍÀÇ °áÈ¥ Á¤º¸¸¦ ¾ò¾î¿Â´Ù.

-		// ÇÑ Ä³¸¯ÅÍ¶óµµ °áÈ¥ »óÅÂ¶ó¸é Á¦±¹ ÀÌµ¿À» ÇÒ ¼ö ¾ø´Ù.

+		// 3.  ĳ ȥ  ´.

+		//  ĳͶ ȥ ¶  ̵   .

 		for (int i = 0; i < loop; ++i)

 		{

-			if (marriage::CManager::instance().IsEngagedOrMarried(dwPID[i]) == true)

+			if (IsEngagedOrMarriedInDB(dwPID[i]))

 				return 3;

 		}

 	}

 

 	{

-		// 4. dbÀÇ Á¦±¹ Á¤º¸¸¦ ¾÷µ¥ÀÌÆ® ÇÑ´Ù.

+		// 4. db   Ʈ Ѵ.

 		snprintf(szQuery, sizeof(szQuery), "UPDATE player_index%s SET empire=%u WHERE "

 			"pid1=%u OR "

 			"pid2=%u OR "

@@ -141,7 +159,7 @@
 

 		if (pMsg->Get()->uiAffectedRows > 0)

 		{

-			// 5. Á¦±¹ º¯°æ ÀÌ·ÂÀ» Ãß°¡ÇÑ´Ù.

+			// 5.   ̷ ߰Ѵ.

 			SetChangeEmpireCount();

 

 			return 999;


--- a/server/metin2/Source/Server/game/src/char_horse.cpp
+++ b/server/metin2/Source/Server/game/src/char_horse.cpp
@@ -18,13 +18,13 @@
 {

 	if (IsDead() == true)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾²·¯Áø »óÅÂ¿¡¼­´Â ¸»¿¡ Å» ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ¿  Ż  ϴ."));

 		return false;

 	}

 

 	if (IsPolymorphed())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½Å »óÅÂ¿¡¼­´Â ¸»¿¡ Å» ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ¿  Ż  ϴ."));

 		return false;

 	}

 

@@ -36,7 +36,7 @@
 

 	if (IsRiding())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì Å»°ÍÀ» ÀÌ¿ëÁßÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ Ż ̿Դϴ."));

 		return false;

 	}

 

@@ -51,12 +51,12 @@
 	}

 #endif

 

-	// ÅÎ½Ãµµ ÀÔÀº »óÅÂÀÇ ¸» Å¸±â ±ÝÁö

+	// νõ    Ÿ 

 	LPITEM armor = GetWear(WEAR_BODY);

 

 	if (armor && (armor->GetVnum() >= 11901 && armor->GetVnum() <= 11904))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿¹º¹À» ÀÔÀº »óÅÂ¿¡¼­ ¸»À» Å» ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ¿  Ż  ϴ."));

 		return false;

 	}

 

@@ -68,16 +68,16 @@
 	if (false == CHorseRider::StartRiding())

 	{

 		if (GetHorseLevel() <= 0)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸»À» ¼ÒÀ¯ÇÏ°í ÀÖÁö ¾Ê½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϰ  ʽϴ."));

 		else if (GetHorseHealth() <= 0)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸»ÀÌ Á×¾îÀÖ´Â »óÅÂ ÀÔ´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ׾ִ  Դϴ."));

 		else if (GetHorseStamina() <= 0)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸»ÀÇ ½ºÅ×¹Ì³Ê°¡ ºÎÁ·ÇÏ¿© ¸»À» Å» ¼ö ¾ø½À´Ï´Ù."));

-

-		return false;

-	}

-

-	// ¼ÒÈ¯ÇÑ ¸» ¾ø¾Ö°í

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ׹̳ʰ Ͽ  Ż  ϴ."));

+

+		return false;

+	}

+

+	// ȯ  ְ

 	HorseSummon(false);

 

 	MountVnum(dwMountVnum);

@@ -99,7 +99,7 @@
 			DWORD dwOldVnum = GetMountVnum();

 			MountVnum(0);

 

-			// [NOTE] ¸»¿¡¼­ ³»¸± ¶© ÀÚ±â°¡ ÅÀ´ø°É ¼ÒÈ¯ÇÏµµ·Ï ¼öÁ¤

+			// [NOTE]    ڱⰡ  ȯϵ 

 			HorseSummon(true, false, dwOldVnum);

 		}

 		else

@@ -160,14 +160,14 @@
 {

 	if (bSummon)

 	{

-		// NOTE : summonÇß´Âµ¥ ÀÌ¹Ì horse°¡ ÀÖÀ¸¸é ¾Æ¹«°Íµµ ¾ÈÇÑ´Ù.

+		// NOTE : summonߴµ ̹ horse  ƹ͵ Ѵ.

 		if (m_chHorse != NULL)

 			return;

 

 		if (GetHorseLevel() <= 0)

 			return;

 

-		// ¹«¾ð°¡¸¦ Å¸°í ÀÖ´Ù¸é ½ÇÆÐ

+		// 𰡸 Ÿ ִٸ 

 		if (IsRiding())

 			return;

 

@@ -198,16 +198,16 @@
 

 		if (!m_chHorse)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸» ¼ÒÈ¯¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȯ Ͽϴ."));

 			return;

 		}

 

 		if (GetHorseHealth() <= 0)

 		{

-			// Á×Àº°ÅÃ³·³ ÀÖ°Ô ÇÏ´Â Ã³¸®

+			// ó ְ ϴ ó

 			m_chHorse->SetPosition(POS_DEAD);

 

-			// ÀÏÁ¤½Ã°£ÀÖ´Ù »ç¶óÁö°Ô ÇÏÀÚ.

+			// ðִ  .

 			char_event_info* info = AllocEventInfo<char_event_info>();

 			info->ch = this;

 			m_chHorse->m_pkDeadEvent = event_create(horse_dead_event, info, PASSES_PER_SEC(60));

@@ -224,7 +224,7 @@
 		else

 		{

 			m_chHorse->m_stName = GetName();

-			m_chHorse->m_stName += LC_STRING("´ÔÀÇ ¸»");

+			m_chHorse->m_stName += LC_STRING(" ");

 		}

 

 		if (!m_chHorse->Show(GetMapIndex(), x, y, GetZ()))

@@ -260,7 +260,7 @@
 		}

 		else

 		{

-			// ¸Ö¾îÁö¸é¼­ »ç¶óÁö´Â Ã³¸® ÇÏ±â

+			// ־鼭  ó ϱ

 			chHorse->SetNowWalking(false);

 			float fx, fy;

 			chHorse->SetRotation(GetDegreeFromPositionXY(chHorse->GetX(), chHorse->GetY(), GetX(), GetY()) + 180);

@@ -331,7 +331,7 @@
 			3 : 70% < ~ <= 100%

 			2 : 30% < ~ <= 70%

 			1 : 0% < ~ <= 30%

-			0 : »ç¸Á

+			0 : 

 

 			STM

 			3 : 71% < ~ <= 100%

@@ -363,8 +363,8 @@
 		{

 			ChatPacket(CHAT_TYPE_COMMAND, "horse_state %d %d %d", GetHorseLevel(), iHealthGrade, iStaminaGrade);

 

-			// FIX : Å¬¶óÀÌ¾ðÆ®¿¡ "¸» »óÅÂ ¹öÇÁ" ¾ÆÀÌÄÜÀ» Ç¥½ÃÇÏÁö ¾ÊÀ» ¸ñÀûÀ¸·Î ÇÔ¼ö ÃÊÀÔ¿¡ returnÇÔÀ¸·Î½á ¾Æ·¡ ÄÚµå¸¦ ¹«½ÃÇÑ´Ù¸é

-			// ¸»À» ¹«ÇÑ´ë·Î ¼ÒÈ¯ÇÏ´Â ¹«½Ã¹«½ÃÇÑ ¹ö±×°¡ »ý±è.. Á¤È®ÇÑ ¿øÀÎÀº ÆÄ¾Ç ¾ÈÇØºÁ¼­ ¸ð¸§.

+			// FIX : Ŭ̾Ʈ "  "  ǥ   Լ Կ returnν Ʒ ڵ带 Ѵٸ

+			//  Ѵ ȯϴ ù װ .. Ȯ  ľ غ .

 			m_bSendHorseLevel = GetHorseLevel();

 			m_bSendHorseHealthGrade = iHealthGrade;

 			m_bSendHorseStaminaGrade = iStaminaGrade;

@@ -374,28 +374,27 @@
 

 bool CHARACTER::CanUseHorseSkill()

 {

-	if (IsRiding())

-	{

-		if (GetHorseGrade() == 3)

+	if (!IsRiding())

+		return false;

+

+	// Default: only allow horse skills on advanced horses

+	if (GetHorseGrade() == 3)

+		return true;

+

+	// Allow specific mounts that are designed to use horse skills

+	if (GetMountVnum())

+	{

+		if (GetMountVnum() >= 20209 && GetMountVnum() <= 20212)

 			return true;

-		else

-			return false;

-

-		if (GetMountVnum())

-		{

-			if (GetMountVnum() >= 20209 && GetMountVnum() <= 20212)

-				return true;

-

-			// ¶ó¸¶´Ü Èæ¸¶

-			if (CMobVnumHelper::IsRamadanBlackHorse(GetMountVnum()))

-				return true;

-		}

-		else

-			return false;

+

+		// Ramadan mount

+		if (CMobVnumHelper::IsRamadanBlackHorse(GetMountVnum()))

+			return true;

 	}

 

 	return false;

 }

+

 

 void CHARACTER::SetHorseLevel(int iLevel)

 {


--- a/server/metin2/Source/Server/game/src/growth_pet.cpp
+++ b/server/metin2/Source/Server/game/src/growth_pet.cpp
@@ -2613,15 +2613,7 @@
 			continue;

 		}

 

-		if (!pProto->kActivatePctPoly.Analyze(pTab->szActivatePctPoly))

-		{

-			sys_err("syntax error skill: %s szActivatePctPoly: %s", pTab->szName, pTab->szActivatePctPoly);

-			bError = true;

-			M2_DELETE(pProto);

-			continue;

-		}

-

-		if (!pProto->kDurationPoly.Analyze(pTab->szDurationPoly))

+				if (!pProto->kDurationPoly.Analyze(pTab->szDurationPoly))

 		{

 			sys_err("syntax error skill: %s szDurationPoly: %s", pTab->szName, pTab->szDurationPoly);

 			bError = true;

@@ -2648,9 +2640,14 @@
 		// Insert loaded skills

 		for (const auto& pSkill : skillVec)

 			m_growthPetSkillMap[pSkill->dwPetVnum][pSkill->dwSkillVnum] = pSkill;

-	}

-

-	return !bError;

+

+		return true;

+	}

+

+	// On error, prevent leaking partially built protos.

+	for (auto* p : skillVec)

+		M2_DELETE(p);

+	return false;

 }

 

 CPetSkillProto* CGrowthPetManager::GetGrowthPetSkill(DWORD dwPetVnum, DWORD dwSkillVnum)

@@ -2665,4 +2662,4 @@
 		return nullptr;

 

 	return skillIterator->second;

-}
+}


--- a/server/metin2/Source/Server/game/src/horsename_manager.cpp
+++ b/server/metin2/Source/Server/game/src/horsename_manager.cpp
@@ -32,6 +32,14 @@
 	if (szHorseName == NULL)

 	{

 		sys_err("HORSE_NAME: NULL NAME (%u)", dwPlayerID);

+		szHorseName = "";

+	}

+

+	// [Security Fix] Format-string hardening: block '%' in stored horse names.

+	// Names are normally validated earlier, but this also protects DB/packet edge-cases.

+	if (strchr(szHorseName, '%') != NULL)

+	{

+		sys_err("HORSENAME: invalid character in name (%%) player %u", dwPlayerID);

 		szHorseName = "";

 	}

 


--- a/server/metin2/Source/Server/game/src/log.cpp
+++ b/server/metin2/Source/Server/game/src/log.cpp
@@ -1,3 +1,23 @@
+#include <cstdarg>

+

+// Safe formatting helper to avoid sprintf overflow in log formatting.

+static void SafeVsnprintf(char* out, size_t cap, const char* fmt, va_list ap)

+{

+	if (!out || cap == 0) return;

+	int n = vsnprintf(out, cap, fmt, ap);

+	if (n < 0)

+		out[0] = '\0';

+	else

+		out[cap - 1] = '\0';

+}

+

+static void SafeSnprintf(char* out, size_t cap, const char* fmt, ...)

+{

+	va_list ap;

+	va_start(ap, fmt);

+	SafeVsnprintf(out, cap, fmt, ap);

+	va_end(ap);

+}

 #include "stdafx.h"

 #include "constants.h"

 #include "config.h"


--- a/server/metin2/Source/Server/game/src/messenger_manager.cpp
+++ b/server/metin2/Source/Server/game/src/messenger_manager.cpp
@@ -162,7 +162,7 @@
 

 	if (quest::CQuestManager::instance().GetPCForce(c_lpChar->GetPlayerID())->IsRunning() == true)

 	{

-		c_lpChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ Ä£±¸ Ãß°¡¸¦ ¹ÞÀ» ¼ö ¾ø´Â »óÅÂÀÔ´Ï´Ù."));

+		c_lpChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ģ ߰    Դϴ."));

 		return;

 	}

 

@@ -215,7 +215,7 @@
 	const LPCHARACTER pkChar = CHARACTER_MANAGER::instance().FindPC(c_strAccount.c_str());

 	const LPDESC pkDesc = pkChar ? pkChar->GetDesc() : nullptr;

 	if (pkChar && pkDesc)

-		pkChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<¸Þ½ÅÁ®> %s ´ÔÀ» Ä£±¸·Î Ãß°¡ÇÏ¿´½À´Ï´Ù.", c_strCompanion.c_str()));

+		pkChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<޽> %s  ģ ߰Ͽϴ.", c_strCompanion.c_str()));

 

 	const LPCHARACTER pkCharCompanion = CHARACTER_MANAGER::instance().FindPC(c_strCompanion.c_str());

 

@@ -289,7 +289,7 @@
 	const LPCHARACTER c_lpChar= CHARACTER_MANAGER::instance().FindPC(c_strAccount.c_str());

 	const LPDESC c_lpDesc = c_lpChar ? c_lpChar->GetDesc() : nullptr;

 	if (c_lpDesc)

-		c_lpChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<¸Þ½ÅÁ®> %s ´ÔÀ» ¸Þ½ÅÀú¿¡¼­ »èÁ¦ÇÏ¿´½À´Ï´Ù.", c_strCompanion.c_str()));

+		c_lpChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("<޽> %s  ޽ Ͽϴ.", c_strCompanion.c_str()));

 }

 

 void CMessengerManager::RemoveFromList(const std::string& c_strAccount, const std::string& c_strCompanion)

@@ -297,20 +297,14 @@
 	if (c_strCompanion.empty())

 		return;

 

-	if (!IsInList(c_strAccount, c_strCompanion))

-	{

-		const LPCHARACTER c_lpChar = CHARACTER_MANAGER::instance().FindPC(c_strAccount.c_str());

-		const LPDESC c_lpDesc = c_lpChar ? c_lpChar->GetDesc() : nullptr;

-		if (c_lpDesc)

-			c_lpChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("%s ´ÔÀº Á¢¼ÓµÇ ÀÖÁö ¾Ê½À´Ï´Ù.", c_strCompanion.c_str()));

-

-		return;

-	}

-

+	// Make removal idempotent: even if the friend entry is already gone from DB or in-memory maps,

+	// do a best-effort cleanup and broadcast, instead of treating it as an error.

+	char szAccount[CHARACTER_NAME_MAX_LEN + 1] = {};

 	char szCompanion[CHARACTER_NAME_MAX_LEN + 1] = {};

+	DBManager::instance().EscapeString(szAccount, sizeof(szAccount), c_strAccount.c_str(), c_strAccount.length());

 	DBManager::instance().EscapeString(szCompanion, sizeof(szCompanion), c_strCompanion.c_str(), c_strCompanion.length());

 	DBManager::instance().Query("DELETE FROM messenger_list%s WHERE `account` = '%s' AND `companion` = '%s'",

-		get_table_postfix(), c_strAccount.c_str(), szCompanion);

+		get_table_postfix(), szAccount, szCompanion);

 

 	__RemoveFromList(c_strAccount, c_strCompanion);

 

@@ -325,11 +319,11 @@
 

 void CMessengerManager::RemoveAllList(const std::string& c_strAccount)

 {

-	/* SQL Data »èÁ¦ */

+	/* SQL Data  */

 	DBManager::instance().Query("DELETE FROM messenger_list%s WHERE account = '%s' OR companion = '%s'",

 		get_table_postfix(), c_strAccount.c_str(), c_strAccount.c_str());

 

-	/* ³»°¡ °¡Áö°íÀÖ´Â ¸®½ºÆ® »èÁ¦ */

+	/*  ִ Ʈ  */

 #if defined(__MESSENGER_DETAILS__)

 	for (const RelationData& it : m_map_strRelation[c_strAccount])

 		RemoveFromList(c_strAccount, it.first);

@@ -338,7 +332,7 @@
 		RemoveFromList(c_strAccount, it);

 #endif

 

-	/* º¹»çÇÑ µ¥ÀÌÅ¸ »èÁ¦ */

+	/*  Ÿ  */

 	m_map_strRelation[c_strAccount].clear();

 }

 

@@ -450,15 +444,15 @@
 

 void CMessengerManager::RemoveAllBlockList(const std::string& c_strAccount)

 {

-	/* SQL Data »èÁ¦ */

+	/* SQL Data  */

 	DBManager::instance().Query("DELETE FROM messenger_list%s WHERE account = '%s' OR companion = '%s'",

 		get_table_postfix(), c_strAccount.c_str(), c_strAccount.c_str());

 

-	/* ³»°¡ °¡Áö°íÀÖ´Â ¸®½ºÆ® »èÁ¦ */

+	/*  ִ Ʈ  */

 	for (const std::string& it : m_map_strBlockRelation[c_strAccount])

 		RemoveFromBlockList(c_strAccount, it);

 

-	/* º¹»çÇÑ µ¥ÀÌÅ¸ »èÁ¦ */

+	/*  Ÿ  */

 	m_map_strBlockRelation[c_strAccount].clear();

 }

 


--- a/server/metin2/Source/Server/game/src/perftest/alloc_perf_test.cpp
+++ b/server/metin2/Source/Server/game/src/perftest/alloc_perf_test.cpp
@@ -32,7 +32,7 @@
 		return "invalid";

 

 	char buf[256];

-	sprintf(buf, "%d.%06d", tv.tv_sec, tv.tv_usec);

+	snprintf(buf, sizeof(buf), "%d.%06d", tv.tv_sec, tv.tv_usec);

 	return buf;

 }

 


--- a/server/metin2/Source/Server/game/src/threeway_war.cpp
+++ b/server/metin2/Source/Server/game/src/threeway_war.cpp
@@ -47,10 +47,10 @@
 

 	int choice = quest::CQuestManager::instance().GetEventFlag("threeway_war_choice");

 	if (0 == choice)

-		sprintf(filename, "%sregen00.txt", GetSungziMapPath());

+		snprintf(filename, sizeof(filename), "%sregen00.txt", GetSungziMapPath());

 	else

 	{

-		sprintf(filename, "%sregen00_%d.txt", GetSungziMapPath(), choice);

+		snprintf(filename, sizeof(filename), "%sregen00_%d.txt", GetSungziMapPath(), choice);

 	}

 

 	LPSECTREE_MAP pkMap = SECTREE_MANAGER::instance().GetMap(iMapIndex);

@@ -60,7 +60,7 @@
 		if (0 != choice)

 			if (regen_load_in_file(filename, iMapIndex, pkMap->m_setting.iBaseX, pkMap->m_setting.iBaseY))

 			{

-				sprintf(filename, "%sregen00.txt", GetSungziMapPath());

+				snprintf(filename, sizeof(filename), "%sregen00.txt", GetSungziMapPath());

 				regen_load_in_file(filename, iMapIndex, pkMap->m_setting.iBaseX, pkMap->m_setting.iBaseY);

 			}

 	}

@@ -311,13 +311,13 @@
 	if (NULL == pkKiller || true != pkKiller->IsPC())

 		return;

 

-	// °°Àº Á¦±¹Àº °è»êÇÏÁö ¾ÊÀ½

+	//    

 	if (pChar->GetEmpire() == pkKiller->GetEmpire())

 		return;

 

 	int nKillScore = GetKillScore(pkKiller->GetEmpire());

 

-	// Á¦±¹ Å³ ½ºÄÚ¾î°¡ -1ÀÏ°æ¿ì´Â Å»¶ô±¹°¡ÀÌ±â¶§¹®¿¡ Á¡¼ö Ã¼Å©¸¦ ÇÏ¸é ¾ÈµÈ´Ù.

+	//  ų ھ -1ϰ Ẕ̇⶧  üũ ϸ ȵȴ.

 	if (nKillScore >= 0)

 	{

 		nKillScore += GetKillValue(pChar->GetLevel());

@@ -327,7 +327,7 @@
 	if (nKillScore != 0 && (test_server || (nKillScore % 5) == 0))

 	{

 		char szBuf[64 + 1];

-		snprintf(szBuf, sizeof(szBuf), LC_STRING("ÇöÀç ½ºÄÚ¾î ½Å¼ö±¹:%d ÃµÁ¶±¹:%d Áø³ë±¹:%d",

+		snprintf(szBuf, sizeof(szBuf), LC_STRING(" ھ ż:%d õ:%d 뱹:%d",

 			GetKillScore(1), GetKillScore(2), GetKillScore(3)));

 

 		SendNoticeMap(szBuf, GetSungziMapIndex(), false);

@@ -353,7 +353,7 @@
 			return;

 

 		// ---------------------------------------------------

-		// Ä«¿îÆ® ÃÊ±âÈ­

+		// īƮ ʱȭ

 		// ---------------------------------------------------

 		SetKillScore(1, 0);

 		SetKillScore(2, 0);

@@ -363,7 +363,7 @@
 		quest::warp_all_to_map_my_empire_event_info* info;

 

 		// ---------------------------------------------------

-		// Å»¶ô±¹°¡ ÅðÀå ½ÃÅ°±â : ¼ºÁö¿¡¼­

+		// Ż  Ű : 

 		// ---------------------------------------------------

 		info = AllocEventInfo<quest::warp_all_to_map_my_empire_event_info>();

 

@@ -376,7 +376,7 @@
 		event_create(quest::warp_all_to_map_my_empire_event, info, PASSES_PER_SEC(10));

 

 		// ---------------------------------------------------

-		//Å»¶ô±¹°¡ ÅðÀå ½ÃÅ°±â : Åë·Î¿¡¼­

+		//Ż  Ű : ο

 		// ---------------------------------------------------

 		info = AllocEventInfo<quest::warp_all_to_map_my_empire_event_info>();

 

@@ -389,30 +389,30 @@
 		event_create(quest::warp_all_to_map_my_empire_event, info, PASSES_PER_SEC(10));

 

 		// ---------------------------------------------------

-		//¼ºÁö¿¡ ÆÃ±â´Â ±¹°¡¿¡ ´ëÇÑ ÀÌ¾ß±â¸¦ ¸¶¿ÕÀÌ ÇÔ!

+		// ñ   ̾߱⸦  !

 		// ---------------------------------------------------

 		const std::string Nation(EMPIRE_NAME(bLoseEmpire));

 		const std::string Script(

-			LC_STRING("¼ºÁöÀÇ ¸¶¿Õ: ³ÊÈñ ") +

+			LC_STRING(" :  ") +

 			Nation +

-			LC_STRING("³à¼®µéÀº ÀÌ°÷ ¼ºÁö¿¡ ÀÖÀ» ÀÚ°ÝÀ» ÀÒ¾ú´Ù. ¸ðµÎ ¼ºÁö¿¡¼­ ¹°·¯³ª°Å¶ó~~[ENTER][ENTER] 10ÃÊ ÈÄ¿¡ ¸ðµÎ ¸¶À»·Î ÀÌµ¿ÇÏ°Ô µË´Ï´Ù. ") +

+			LC_STRING("༮ ̰   ڰ Ҿ.   Ŷ~~[ENTER][ENTER] 10 Ŀ   ̵ϰ ˴ϴ. ") +

 			"[ENTER][DONE]"

 		);

 

 		CHARACTER_MANAGER::instance().SendScriptToMap(pChar->GetMapIndex(), Script);

 

 		// ---------------------------------------------------

-		// °øÁö ÇÑ¹æ ³¯·ÁÁÜ.

+		//  ѹ .

 		// ---------------------------------------------------

 		char szNotice[512 + 1];

-		snprintf(szNotice, sizeof(szNotice), LC_STRING("»ï°Å¸® ÀüÅõ¿¡¼­ %s ±¹°¡°¡ °¡Àå¸ÕÀú Å»¶ôÀ» ÇÏ¿´½À´Ï´Ù", Nation.c_str()));

+		snprintf(szNotice, sizeof(szNotice), LC_STRING("Ÿ  %s   Ż Ͽϴ", Nation.c_str()));

 		BroadcastNotice(szNotice);

 

 		snprintf(szNotice, sizeof(szNotice), "First Step: %s exclusion", Nation.c_str());

 		LogManager::instance().CharLog(0, 0, 0, 0, "THREEWAY", szNotice, NULL);

 

 		// ---------------------------------------------------

-		// ¸÷À» ¸®Á¨ÇÑ´Ù.

+		//  Ѵ.

 		// ---------------------------------------------------

 		regen_mob_event_info* regen_info = AllocEventInfo<regen_mob_event_info>();

 

@@ -451,7 +451,7 @@
 				quest::warp_all_to_map_my_empire_event_info* info;

 

 				// ---------------------------------------------------

-				// Å»¶ô±¹°¡ ÅðÀå ½ÃÅ°±â : ¼ºÁö¿¡¼­

+				// Ż  Ű : 

 				// ---------------------------------------------------

 				info = AllocEventInfo<quest::warp_all_to_map_my_empire_event_info>();

 

@@ -464,7 +464,7 @@
 				event_create(quest::warp_all_to_map_my_empire_event, info, PASSES_PER_SEC(5));

 

 				// ---------------------------------------------------

-				//Å»¶ô±¹°¡ ÅðÀå ½ÃÅ°±â : Åë·Î¿¡¼­

+				//Ż  Ű : ο

 				// ---------------------------------------------------

 				info = AllocEventInfo<quest::warp_all_to_map_my_empire_event_info>();

 

@@ -479,17 +479,17 @@
 		}

 

 		// ---------------------------------------------------

-		// ÃÖÁ¾ ½ºÄÚ¾î Ç¥½Ã 

+		//  ھ ǥ 

 		// ---------------------------------------------------

 		{

 			char szBuf[64 + 1];

-			snprintf(szBuf, sizeof(szBuf), LC_STRING("ÇöÀç ½ºÄÚ¾î ½Å¼ö±¹:%d ÃµÁ¶±¹:%d Áø³ë±¹:%d",

+			snprintf(szBuf, sizeof(szBuf), LC_STRING(" ھ ż:%d õ:%d 뱹:%d",

 				GetKillScore(1), GetKillScore(2), GetKillScore(3)));

 

 			SendNoticeMap(szBuf, GetSungziMapIndex(), false);

 		}

 

-		// ¸Þ¼¼Áö¸¦ ¶ç¿öÁØ´Ù.

+		// ޼ ش.

 		LPSECTREE_MAP pSecMap = SECTREE_MANAGER::instance().GetMap(pChar->GetMapIndex());

 

 		if (NULL != pSecMap)

@@ -497,7 +497,7 @@
 			const std::string EmpireName(EMPIRE_NAME(nVictoryEmpireIndex));

 			const std::string Script(

 				EmpireName +

-				LC_STRING(". ³ÊÈñ°¡ ¼ºÁöÀÇ ¼öÈ£ÀÚ¸¦ Àâ°Ô µÈ´Ù¸é ³ÊÈñ´Â ¼ºÁöÀÇ ÁÖÀÎÀÌ µÈ´Ù.[ENTER][ENTER] ") +

+				LC_STRING(".   ȣڸ  ȴٸ    ȴ.[ENTER][ENTER] ") +

 				"[ENTER][DONE]");

 

 			struct packet_script pack_script;

@@ -521,7 +521,7 @@
 		}

 

 		// ---------------------------------------------------

-		// ¸¶Áö¸· º¸»ó : Áø±¸¹ÌÈ£ ¼ÒÈ¯

+		//   : ȣ ȯ

 		// ---------------------------------------------------

 		for (int n = 0; n < quest::CQuestManager::instance().GetEventFlag("threeway_war_boss_count");)

 		{


