diff --git a/client/pack/root/serverinfo.py b/client/pack/root/serverinfo.py
index 305438e..4426b03 100644
--- a/client/pack/root/serverinfo.py	
+++ b/client/pack/root/serverinfo.py	
@@ -1,51 +1,51 @@
-import app
-import localeInfo
-
-CLIENT_VERSION = "1"
-app.ServerName = None
-SERVER_1 = "|cffffd500|h Alena2"
-SRV1 = {
-	"name":"|cffffd500|h Alena2",
-	"host":"192.168.1.50",
-	"auth1":11150,
-	"ch1":12101,
-	"ch2":12101,
-	"ch3":12101,
-	"ch4":12101,
-	"ch5":12101,
-	"ch6":12101,
-		}
-
-STATE_NONE = '|cffff0000OFF'
-
-STATE_DICT = {
-	0 : "|cffff0000Off",
-	1 : "|cff00ff00NORMAL",
-	2 : "|cffffff00BUSY",
-	3 : "|cffff6060FULL"
-	}
-
-SERVER1_CHANNEL_DICT = {
-	1:{"key":11,"name":"CH1","ip":SRV1["host"],"tcp_port":SRV1["ch1"],"udp_port":SRV1["ch1"],"state":STATE_NONE,},
-	2:{"key":12,"name":"CH2","ip":SRV1["host"],"tcp_port":SRV1["ch2"],"udp_port":SRV1["ch2"],"state":STATE_NONE,},
-	3:{"key":13,"name":"CH3","ip":SRV1["host"],"tcp_port":SRV1["ch3"],"udp_port":SRV1["ch3"],"state":STATE_NONE,},
-	4:{"key":14,"name":"CH4","ip":SRV1["host"],"tcp_port":SRV1["ch4"],"udp_port":SRV1["ch4"],"state":STATE_NONE,},
-	5:{"key":15,"name":"CH5","ip":SRV1["host"],"tcp_port":SRV1["ch5"],"udp_port":SRV1["ch5"],"state":STATE_NONE,},
-	6:{"key":16,"name":"CH6","ip":SRV1["host"],"tcp_port":SRV1["ch6"],"udp_port":SRV1["ch6"],"state":STATE_NONE,},
-}
-
-REGION_AUTH_SERVER_DICT = {
-	0 : {
-		1 : { "ip":SRV1["host"], "port":SRV1["auth1"], },
-	}
-}
-
-REGION_DICT = {
-	0 : {
-		1 : { "name" :SRV1["name"], "channel" : SERVER1_CHANNEL_DICT, },
-	},
-}
-
-MARKADDR_DICT = {
-	10 : { "ip" : SRV1["host"], "tcp_port" : SRV1["ch1"], "mark" : "10.tga", "symbol_path" : "10", },
-}
+import app
+import localeInfo
+
+CLIENT_VERSION = "1"
+app.ServerName = None
+SERVER_1 = "|cffffd500|h Alena2"
+SRV1 = {
+	"name":"|cffffd500|h Alena2",
+	"host":"192.168.1.50",
+	"auth1":11150,
+	"ch1":12101,
+	"ch2":12102,
+	"ch3":12103,
+	"ch4":12104,
+	"ch5":12105,
+	"ch6":12106,
+		}
+
+STATE_NONE = '|cffff0000OFF'
+
+STATE_DICT = {
+	0 : "|cffff0000Off",
+	1 : "|cff00ff00NORMAL",
+	2 : "|cffffff00BUSY",
+	3 : "|cffff6060FULL"
+	}
+
+SERVER1_CHANNEL_DICT = {
+	1:{"key":11,"name":"CH1","ip":SRV1["host"],"tcp_port":SRV1["ch1"],"udp_port":SRV1["ch1"],"state":STATE_NONE,},
+	2:{"key":12,"name":"CH2","ip":SRV1["host"],"tcp_port":SRV1["ch2"],"udp_port":SRV1["ch2"],"state":STATE_NONE,},
+	3:{"key":13,"name":"CH3","ip":SRV1["host"],"tcp_port":SRV1["ch3"],"udp_port":SRV1["ch3"],"state":STATE_NONE,},
+	4:{"key":14,"name":"CH4","ip":SRV1["host"],"tcp_port":SRV1["ch4"],"udp_port":SRV1["ch4"],"state":STATE_NONE,},
+	5:{"key":15,"name":"CH5","ip":SRV1["host"],"tcp_port":SRV1["ch5"],"udp_port":SRV1["ch5"],"state":STATE_NONE,},
+	6:{"key":16,"name":"CH6","ip":SRV1["host"],"tcp_port":SRV1["ch6"],"udp_port":SRV1["ch6"],"state":STATE_NONE,},
+}
+
+REGION_AUTH_SERVER_DICT = {
+	0 : {
+		1 : { "ip":SRV1["host"], "port":SRV1["auth1"], },
+	}
+}
+
+REGION_DICT = {
+	0 : {
+		1 : { "name" :SRV1["name"], "channel" : SERVER1_CHANNEL_DICT, },
+	},
+}
+
+MARKADDR_DICT = {
+	10 : { "ip" : SRV1["host"], "tcp_port" : SRV1["ch1"], "mark" : "10.tga", "symbol_path" : "10", },
+}
diff --git a/server/metin2/Server/auth/config.txt b/server/metin2/Server/auth/config.txt
index 010b6fd..0aece43 100644
--- a/server/metin2/Server/auth/config.txt	
+++ b/server/metin2/Server/auth/config.txt	
@@ -1,16 +1,18 @@
-HOSTNAME: auth
-CHANNEL: 1
-PORT: 11150
-P2P_PORT: 11250
-DB_PORT: 11000
-DB_ADDR: localhost
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 000000001 000000002
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-AUTH_SERVER: master
-PLAYER_SQL: localhost mt2 mt2!@# account
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
+HOSTNAME: auth
+CHANNEL: 1
+PORT: 11150
+P2P_PORT: 11250
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 000000001 000000002
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+AUTH_SERVER: master
+PLAYER_SQL: localhost mt2 mt2!@# account
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+log_keep_days: 7
diff --git a/server/metin2/Server/db/config.txt b/server/metin2/Server/db/config.txt
index a9135ff..c814e21 100644
--- a/server/metin2/Server/db/config.txt	
+++ b/server/metin2/Server/db/config.txt	
@@ -1,29 +1,31 @@
-WELCOME_MSG = "DB Cache Server has been started"
-
-SQL_ACCOUNT = "localhost account mt2 mt2!@# 0"
-SQL_PLAYER = "localhost player mt2 mt2!@# 0"
-SQL_COMMON = "localhost common mt2 mt2!@# 0"
-SQL_HOTBACKUP = "localhost hotbackup mt2 mt2!@# 0"
-
-TABLE_POSTFIX = ""
-
-BIND_PORT = 11000
-DB_SLEEP_MSEC = 10
-CLIENT_HEART_FPS = 10
-HASH_PLAYER_LIFE_SEC = 600
-BACKUP_LIMIT_SEC = 3600
-PLAYER_ID_START = 100
-PLAYER_DELETE_LEVEL_LIMIT = 90
-WOLFMAN_CHARACTER = 1
-EMOTE_DUMP_DELAY = 900
-MAILBOX_BACKUP_SEC = 3600
-GEM_SHOP_FLUSH_DELAY = 3600
-
-ITEM_ID_RANGE = 2000000000 2100000000
-
-MIN_LENGTH_OF_SOCIAL_ID = 6
-
-#NAME_COLUMN = "locale_name"
-#LOCALE = "europe"
-SIMPLE_SOCIALID = 1
-Block "Y/QSB7omi36awq4ctpUxuiwRARM="
+WELCOME_MSG = "DB Cache Server has been started"
+
+SQL_ACCOUNT = "localhost account mt2 mt2!@# 0"
+SQL_PLAYER = "localhost player mt2 mt2!@# 0"
+SQL_COMMON = "localhost common mt2 mt2!@# 0"
+SQL_HOTBACKUP = "localhost hotbackup mt2 mt2!@# 0"
+
+TABLE_POSTFIX = ""
+
+BIND_PORT = 11000
+BIND_IP = "127.0.0.1"
+LOG_KEEP_DAYS = 7
+DB_SLEEP_MSEC = 10
+CLIENT_HEART_FPS = 10
+HASH_PLAYER_LIFE_SEC = 600
+BACKUP_LIMIT_SEC = 3600
+PLAYER_ID_START = 100
+PLAYER_DELETE_LEVEL_LIMIT = 90
+WOLFMAN_CHARACTER = 1
+EMOTE_DUMP_DELAY = 900
+MAILBOX_BACKUP_SEC = 3600
+GEM_SHOP_FLUSH_DELAY = 3600
+
+ITEM_ID_RANGE = 2000000000 2100000000
+
+MIN_LENGTH_OF_SOCIAL_ID = 6
+
+#NAME_COLUMN = "locale_name"
+#LOCALE = "europe"
+SIMPLE_SOCIALID = 1
+Block "Y/QSB7omi36awq4ctpUxuiwRARM="
diff --git a/server/metin2/Server/game/channel1/core1/config.txt b/server/metin2/Server/game/channel1/core1/config.txt
index ddc2c1a..0f75889 100644
--- a/server/metin2/Server/game/channel1/core1/config.txt	
+++ b/server/metin2/Server/game/channel1/core1/config.txt	
@@ -1,46 +1,48 @@
-HOSTNAME: ch1_game1
-CHANNEL: 1
-PORT: 12101
-P2P_PORT: 12110
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 1 3 4 5 6 21 23 24 25 26 41 43 44 45 46 91 92 93 107 112 201
-#	1		metin2_map_a1
-#	3		metin2_map_a3
-#	4		metin2_map_guild_01
-#	5		metin2_map_monkey_dungeon_11
-#	6		metin2_guild_village_01
-#	21		metin2_map_b1
-#	23		metin2_map_b3
-#	24		metin2_map_guild_02
-#	25		metin2_map_monkey_dungeon_12
-#	26		metin2_guild_village_02
-#	41		metin2_map_c1
-#	43		metin2_map_c3
-#	44		metin2_map_guild_03
-#	45		metin2_map_monkey_dungeon_13
-#	46		metin2_guild_village_03
-#	91		metin2_map_e1_01
-#	92		metin2_map_e1_02
-#	93		metin2_map_e1_03
-#	107		metin2_map_monkey_dungeon
-#	112		metin2_map_duel
-#	201		metin2_map_pvp_arena
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 100000001 200000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-POPUP_NOTICE_URL: http://darkmmo.tr
+HOSTNAME: ch1_game1
+CHANNEL: 1
+PORT: 12101
+P2P_PORT: 12110
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 1 3 4 5 6 21 23 24 25 26 41 43 44 45 46 91 92 93 107 112 201
+#	1		metin2_map_a1
+#	3		metin2_map_a3
+#	4		metin2_map_guild_01
+#	5		metin2_map_monkey_dungeon_11
+#	6		metin2_guild_village_01
+#	21		metin2_map_b1
+#	23		metin2_map_b3
+#	24		metin2_map_guild_02
+#	25		metin2_map_monkey_dungeon_12
+#	26		metin2_guild_village_02
+#	41		metin2_map_c1
+#	43		metin2_map_c3
+#	44		metin2_map_guild_03
+#	45		metin2_map_monkey_dungeon_13
+#	46		metin2_guild_village_03
+#	91		metin2_map_e1_01
+#	92		metin2_map_e1_02
+#	93		metin2_map_e1_03
+#	107		metin2_map_monkey_dungeon
+#	112		metin2_map_duel
+#	201		metin2_map_pvp_arena
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 100000001 200000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
diff --git a/server/metin2/Server/game/channel1/core2/config.txt b/server/metin2/Server/game/channel1/core2/config.txt
index 1358e65..022321f 100644
--- a/server/metin2/Server/game/channel1/core2/config.txt	
+++ b/server/metin2/Server/game/channel1/core2/config.txt	
@@ -1,36 +1,38 @@
-HOSTNAME: ch1_game2
-CHANNEL: 1
-PORT: 12102
-P2P_PORT: 12120
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 61 62 67 68 72 73 208 351 352 356
-
-#	61	map_n_snowm_01
-#	62	metin2_map_n_flame_01
-#	67	metin2_map_trent
-#	68	metin2_map_trent02
-#	72	metin2_map_skipia_dungeon_01
-#	73	metin2_map_skipia_dungeon_02
-#	208	metin2_map_skipia_dungeon_boss
-#	351	metin2_map_n_flame_dungeon_01
-#	352	metin2_map_n_snow_dungeon_01
-#	356	metin2_map_n_flame_dragon
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 200000001 300000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-POPUP_NOTICE_URL: http://darkmmo.tr
+HOSTNAME: ch1_game2
+CHANNEL: 1
+PORT: 12102
+P2P_PORT: 12120
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 61 62 67 68 72 73 208 351 352 356
+
+#	61	map_n_snowm_01
+#	62	metin2_map_n_flame_01
+#	67	metin2_map_trent
+#	68	metin2_map_trent02
+#	72	metin2_map_skipia_dungeon_01
+#	73	metin2_map_skipia_dungeon_02
+#	208	metin2_map_skipia_dungeon_boss
+#	351	metin2_map_n_flame_dungeon_01
+#	352	metin2_map_n_snow_dungeon_01
+#	356	metin2_map_n_flame_dragon
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 200000001 300000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
diff --git a/server/metin2/Server/game/channel1/core3/config.txt b/server/metin2/Server/game/channel1/core3/config.txt
index 447aa66..588f5f3 100644
--- a/server/metin2/Server/game/channel1/core3/config.txt	
+++ b/server/metin2/Server/game/channel1/core3/config.txt	
@@ -1,38 +1,40 @@
-HOSTNAME: ch1_game3
-CHANNEL: 1
-PORT: 12103
-P2P_PORT: 12130
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 63 64 65 66 69 70 71 104 108 109 216 217
-
-#	63	metin2_map_n_desert_01
-#	64	map_n_threeway
-#	65	metin2_map_milgyo
-#	66	metin2_map_deviltower1
-#	69	metin2_map_wl_01
-#	70	metin2_map_nusluck01
-#	71	metin2_map_spiderdungeon_02
-#	104	metin2_map_spiderdungeon
-#	108	metin2_map_monkey_dungeon2
-#	109	metin2_map_monkey_dungeon3
-#	216	metin2_map_devilscatacomb
-#	217	metin2_map_spiderdungeon_03
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 300000001 400000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-POPUP_NOTICE_URL: http://darkmmo.tr
+HOSTNAME: ch1_game3
+CHANNEL: 1
+PORT: 12103
+P2P_PORT: 12130
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 63 64 65 66 69 70 71 104 108 109 216 217
+
+#	63	metin2_map_n_desert_01
+#	64	map_n_threeway
+#	65	metin2_map_milgyo
+#	66	metin2_map_deviltower1
+#	69	metin2_map_wl_01
+#	70	metin2_map_nusluck01
+#	71	metin2_map_spiderdungeon_02
+#	104	metin2_map_spiderdungeon
+#	108	metin2_map_monkey_dungeon2
+#	109	metin2_map_monkey_dungeon3
+#	216	metin2_map_devilscatacomb
+#	217	metin2_map_spiderdungeon_03
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 300000001 400000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
diff --git a/server/metin2/Server/game/channel1/core4/config.txt b/server/metin2/Server/game/channel1/core4/config.txt
index 7653daf..4d6de24 100644
--- a/server/metin2/Server/game/channel1/core4/config.txt	
+++ b/server/metin2/Server/game/channel1/core4/config.txt	
@@ -1,38 +1,40 @@
-HOSTNAME: ch1_game4
-CHANNEL: 1
-PORT: 12104
-P2P_PORT: 12140
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 301 302 303 304 353 354 358 359 378 379 380 381
-
-#	301	metin2_map_capedragonhead
-#	302	metin2_map_dawnmistwood
-#	303	metin2_map_bayblacksand
-#	304	metin2_map_mt_thunder
-#	353	metin2_map_dawnmist_dungeon_01
-#	354	metin2_map_mt_th_dungeon_01
-#	358	metin2_map_defensewave
-#	359	metin2_map_defensewave_port
-#	378	metin2_map_elemental_01
-#	379	metin2_map_elemental_02
-#	380	metin2_map_elemental_03
-#	381	metin2_map_elemental_04
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 400000001 500000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-POPUP_NOTICE_URL: http://darkmmo.tr
+HOSTNAME: ch1_game4
+CHANNEL: 1
+PORT: 12104
+P2P_PORT: 12140
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 301 302 303 304 353 354 358 359 378 379 380 381
+
+#	301	metin2_map_capedragonhead
+#	302	metin2_map_dawnmistwood
+#	303	metin2_map_bayblacksand
+#	304	metin2_map_mt_thunder
+#	353	metin2_map_dawnmist_dungeon_01
+#	354	metin2_map_mt_th_dungeon_01
+#	358	metin2_map_defensewave
+#	359	metin2_map_defensewave_port
+#	378	metin2_map_elemental_01
+#	379	metin2_map_elemental_02
+#	380	metin2_map_elemental_03
+#	381	metin2_map_elemental_04
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 400000001 500000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
diff --git a/server/metin2/Server/game/channel1/core5/config.txt b/server/metin2/Server/game/channel1/core5/config.txt
index 3922d01..225b309 100644
--- a/server/metin2/Server/game/channel1/core5/config.txt	
+++ b/server/metin2/Server/game/channel1/core5/config.txt	
@@ -1,45 +1,47 @@
-HOSTNAME: ch1_game5
-CHANNEL: 1
-PORT: 12105
-P2P_PORT: 12150
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 373 374 376 377 382 383 384 385 386 387 388 389 390 391 393 394 395
-
-#	373	metin2_map_eastplain_01
-#	374	metin2_map_empirecastle
-#	376	metin2_map_eastplain_02
-#	377	metin2_map_eastplain_03
-#	382	metin2_map_maze_dungeon1
-#	383	metin2_map_maze_dungeon2
-#	384	metin2_map_maze_dungeon3
-#	385	metin2_map_snakevalley
-#	386	metin2_map_smhdungeon_01
-#	387	metin2_map_smhdungeon_02
-#	388	metin2_map_icecrystalcave
-#	389	metin2_map_whitdragonvalley
-#	390	metin2_map_snake_temple_01
-#	391	metin2_map_snake_temple_02
-#	393	metin2_map_whitedragoncave_01
-#	394	metin2_map_whitedragoncave_02
-#	395	metin2_map_whitedragoncave_boss
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 500000001 600000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-POPUP_NOTICE_URL: http://darkmmo.tr
-
-
+HOSTNAME: ch1_game5
+CHANNEL: 1
+PORT: 12105
+P2P_PORT: 12150
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 373 374 376 377 382 383 384 385 386 387 388 389 390 391 393 394 395
+
+#	373	metin2_map_eastplain_01
+#	374	metin2_map_empirecastle
+#	376	metin2_map_eastplain_02
+#	377	metin2_map_eastplain_03
+#	382	metin2_map_maze_dungeon1
+#	383	metin2_map_maze_dungeon2
+#	384	metin2_map_maze_dungeon3
+#	385	metin2_map_snakevalley
+#	386	metin2_map_smhdungeon_01
+#	387	metin2_map_smhdungeon_02
+#	388	metin2_map_icecrystalcave
+#	389	metin2_map_whitdragonvalley
+#	390	metin2_map_snake_temple_01
+#	391	metin2_map_snake_temple_02
+#	393	metin2_map_whitedragoncave_01
+#	394	metin2_map_whitedragoncave_02
+#	395	metin2_map_whitedragoncave_boss
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 500000001 600000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
+
+
diff --git a/server/metin2/Server/game/channel1/core6/config.txt b/server/metin2/Server/game/channel1/core6/config.txt
index d293d60..9a2e8d0 100644
--- a/server/metin2/Server/game/channel1/core6/config.txt	
+++ b/server/metin2/Server/game/channel1/core6/config.txt	
@@ -1,35 +1,37 @@
-HOSTNAME: ch1_game6
-CHANNEL: 1
-PORT: 12106
-P2P_PORT: 12160
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 355 357 360 361 362 372 375 396 399
-
-#	355	metin2_12zi_stage
-#	357	metin2_map_battlefied
-#	360	metin2_map_mists_of_island
-#	361	metin2_map_miniboss_01
-#	362	metin2_map_miniboss_02
-#	372	metin2_guild_pve
-#	375	metin2_map_battleroyale
-#	396	metin2_map_anglar_dungeon_01
-#	399	metin2_map_secretdungeon_01
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 600000001 700000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-POPUP_NOTICE_URL: http://darkmmo.tr
+HOSTNAME: ch1_game6
+CHANNEL: 1
+PORT: 12106
+P2P_PORT: 12160
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 355 357 360 361 362 372 375 396 399
+
+#	355	metin2_12zi_stage
+#	357	metin2_map_battlefied
+#	360	metin2_map_mists_of_island
+#	361	metin2_map_miniboss_01
+#	362	metin2_map_miniboss_02
+#	372	metin2_guild_pve
+#	375	metin2_map_battleroyale
+#	396	metin2_map_anglar_dungeon_01
+#	399	metin2_map_secretdungeon_01
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 600000001 700000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
diff --git a/server/metin2/Server/game/channel99/core1/config.txt b/server/metin2/Server/game/channel99/core1/config.txt
index b6dedce..4a4d9ee 100644
--- a/server/metin2/Server/game/channel99/core1/config.txt	
+++ b/server/metin2/Server/game/channel99/core1/config.txt	
@@ -1,53 +1,55 @@
-HOSTNAME: ch99_game1
-CHANNEL: 99
-PORT: 19900
-P2P_PORT: 19910
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 81 103 105 110 111 113 114 118 119 120 121 122 123 124 125 126 127 128 130 131 132 133 181 182 183 200 392
-
-#	81	metin2_map_wedding_01
-#	103	metin2_map_t1
-#	105	metin2_map_t2
-#	110	metin2_map_t3
-#	111	metin2_map_t4
-#	113	metin2_map_oxevent
-#	114	metin2_map_sungzi
-#	118	metin2_map_sungzi_flame_hill_01
-#	119	metin2_map_sungzi_flame_hill_02
-#	120	metin2_map_sungzi_flame_hill_03
-#	121	metin2_map_sungzi_snow
-#	122	metin2_map_sungzi_snow_pass01
-#	123	metin2_map_sungzi_snow_pass02
-#	124	metin2_map_sungzi_snow_pass03
-#	125	metin2_map_sungzi_desert_01
-#	126	metin2_map_sungzi_desert_hill_01
-#	127	metin2_map_sungzi_desert_hill_02
-#	128	metin2_map_sungzi_desert_hill_03
-#	130	metin2_guild_war1
-#	131	metin2_guild_war2
-#	132	metin2_guild_war3
-#	133	metin2_guild_war4
-#	181	metin2_map_empirewar01
-#	182	metin2_map_empirewar02
-#	183	metin2_map_empirewar03
-#	200	gm_guild_build
-#	392	metin2_map_privatesh
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 900000001 1000000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-POPUP_NOTICE_URL: http://darkmmo.tr
+HOSTNAME: ch99_game1
+CHANNEL: 99
+PORT: 19900
+P2P_PORT: 19910
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 81 103 105 110 111 113 114 118 119 120 121 122 123 124 125 126 127 128 130 131 132 133 181 182 183 200 392
+
+#	81	metin2_map_wedding_01
+#	103	metin2_map_t1
+#	105	metin2_map_t2
+#	110	metin2_map_t3
+#	111	metin2_map_t4
+#	113	metin2_map_oxevent
+#	114	metin2_map_sungzi
+#	118	metin2_map_sungzi_flame_hill_01
+#	119	metin2_map_sungzi_flame_hill_02
+#	120	metin2_map_sungzi_flame_hill_03
+#	121	metin2_map_sungzi_snow
+#	122	metin2_map_sungzi_snow_pass01
+#	123	metin2_map_sungzi_snow_pass02
+#	124	metin2_map_sungzi_snow_pass03
+#	125	metin2_map_sungzi_desert_01
+#	126	metin2_map_sungzi_desert_hill_01
+#	127	metin2_map_sungzi_desert_hill_02
+#	128	metin2_map_sungzi_desert_hill_03
+#	130	metin2_guild_war1
+#	131	metin2_guild_war2
+#	132	metin2_guild_war3
+#	133	metin2_guild_war4
+#	181	metin2_map_empirewar01
+#	182	metin2_map_empirewar02
+#	183	metin2_map_empirewar03
+#	200	gm_guild_build
+#	392	metin2_map_privatesh
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 900000001 1000000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
diff --git a/server/metin2/Server/game/channel99/core2/config.txt b/server/metin2/Server/game/channel99/core2/config.txt
index 7d17319..b8c910b 100644
--- a/server/metin2/Server/game/channel99/core2/config.txt	
+++ b/server/metin2/Server/game/channel99/core2/config.txt	
@@ -1,40 +1,42 @@
-HOSTNAME: ch99_game2
-CHANNEL: 99
-PORT: 19901
-P2P_PORT: 19920
-DB_PORT: 11000
-DB_ADDR: localhost
-
-MAP_ALLOW: 363 364 365 366 367 368 369 370 371 400 401 402 403
-
-#	363	metin2_map_labyrinth
-#	364	metin2_map_boss_crack_skipia
-#	365	metin2_map_boss_crack_flame
-#	366	metin2_map_boss_crack_snow
-#	367	metin2_map_boss_crack_dawnmist
-#	368	metin2_map_boss_awaken_skipia
-#	369	metin2_map_boss_awaken_flame
-#	370	metin2_map_boss_awaken_snow
-#	371	metin2_map_boss_awaken_dawnmist
-#	400	metin2_map_otherworld_01
-#	401	metin2_map_otherworld_02
-#	402	metin2_map_otherworld_03
-#	403	metin2_map_otherworld_04
-
-TABLE_POSTFIX:
-ITEM_ID_RANGE: 1000000001 2000000000
-PASSES_PER_SEC: 25
-SAVE_EVENT_SECOND_CYCLE: 180
-PING_EVENT_SECOND_CYCLE: 180
-PLAYER_SQL: localhost mt2 mt2!@# player
-COMMON_SQL: localhost mt2 mt2!@# common
-LOG_SQL: localhost mt2 mt2!@# log
-LOCALE_SERVICE: uk
-TEST_SERVER: 1
-VIEW_RANGE: 8000
-MAX_LEVEL: 120
-offline_shop_map_allow: 1, 21, 41
-offline_shop_max_per_player: 1
-offline_shop_max_distance: 8000
-
-POPUP_NOTICE_URL: http://darkmmo.tr
+HOSTNAME: ch99_game2
+CHANNEL: 99
+PORT: 19901
+P2P_PORT: 19920
+DB_PORT: 11000
+DB_ADDR: localhost
+# bind_ip: 203.0.113.10  # set to your public IPv4 (recommended)
+
+MAP_ALLOW: 363 364 365 366 367 368 369 370 371 400 401 402 403
+
+#	363	metin2_map_labyrinth
+#	364	metin2_map_boss_crack_skipia
+#	365	metin2_map_boss_crack_flame
+#	366	metin2_map_boss_crack_snow
+#	367	metin2_map_boss_crack_dawnmist
+#	368	metin2_map_boss_awaken_skipia
+#	369	metin2_map_boss_awaken_flame
+#	370	metin2_map_boss_awaken_snow
+#	371	metin2_map_boss_awaken_dawnmist
+#	400	metin2_map_otherworld_01
+#	401	metin2_map_otherworld_02
+#	402	metin2_map_otherworld_03
+#	403	metin2_map_otherworld_04
+
+TABLE_POSTFIX:
+ITEM_ID_RANGE: 1000000001 2000000000
+PASSES_PER_SEC: 25
+SAVE_EVENT_SECOND_CYCLE: 180
+PING_EVENT_SECOND_CYCLE: 180
+PLAYER_SQL: localhost mt2 mt2!@# player
+COMMON_SQL: localhost mt2 mt2!@# common
+LOG_SQL: localhost mt2 mt2!@# log
+LOCALE_SERVICE: uk
+test_server: 0
+VIEW_RANGE: 8000
+log_keep_days: 7
+MAX_LEVEL: 120
+offline_shop_map_allow: 1, 21, 41
+offline_shop_max_per_player: 1
+offline_shop_max_distance: 8000
+# popup_notice_url: https://your-domain.example/notice  # optional (disabled by default)
+POPUP_NOTICE_URL: http://darkmmo.tr
diff --git a/server/metin2/Server/share/locale/uk/quest/pre_qc/dawnmist_dungeon.quest b/server/metin2/Server/share/locale/uk/quest/pre_qc/dawnmist_dungeon.quest
index d592078..372404e 100644
--- a/server/metin2/Server/share/locale/uk/quest/pre_qc/dawnmist_dungeon.quest	
+++ b/server/metin2/Server/share/locale/uk/quest/pre_qc/dawnmist_dungeon.quest	
@@ -5,6 +5,10 @@ quest dawnmist_dungeon begin
 		end
 
 		function create()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(353, 7780, 15020)
 			d.spawn_mob(6408, 69, 941)
 
diff --git a/server/metin2/Server/share/locale/uk/quest/pre_qc/flame_dungeon.quest b/server/metin2/Server/share/locale/uk/quest/pre_qc/flame_dungeon.quest
index 7b793b7..145bffe 100644
--- a/server/metin2/Server/share/locale/uk/quest/pre_qc/flame_dungeon.quest	
+++ b/server/metin2/Server/share/locale/uk/quest/pre_qc/flame_dungeon.quest	
@@ -58,6 +58,10 @@ quest flame_dungeon begin
 
 		function make_dungeon() -- Â´Ã¸Ã€Ã¼ Â¸Â¸ÂµÃ©Â±Ã¢
 			local setting = flame_dungeon.setting()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
 			d.new_jump_party(351, setting.dungeon_entry_pos[1], setting.dungeon_entry_pos[2])
 			--d.spawn_mob_ac_dir(20385, setting.DUNGEON_MAN_pos[1], setting.DUNGEON_MAN_pos[2], 0)
 			--d.spawn_mob(YAK, setting.YAK_pos[1], setting.YAK_pos[2])
diff --git a/server/metin2/Server/share/locale/uk/quest/questing.lua b/server/metin2/Server/share/locale/uk/quest/questing.lua
index a4b91e3..4ae3f6e 100644
--- a/server/metin2/Server/share/locale/uk/quest/questing.lua	
+++ b/server/metin2/Server/share/locale/uk/quest/questing.lua	
@@ -1,1217 +1,1231 @@
---[[
-    Questliberweiterung generiert by Mijago
-    Link: http://questwriting.mijago.org/questlib/index.php?exec=1&updater=0&b1=1&b2=1&b10=1&b12=1&b23=1&b41=1&b42=1&b43=1&b44=1&b45=1&b46=1&b47=1&b48=1&b49=1&b60=1&b61=1&b101=1&b102=1&b103=1&b104=1&b106=1&b201=1&b301=1&b801=1&b802=1&b803=1&b804=1&b805=1&b806=1&b901=1&b902=1&b903=1&b904=1&b905=1&b1000=1&b1001=1&b1002=1&b1003=1&b1004=1&b2002=1
-    Funktionen: 
-        split, mysql_query, mysql_query_old, define, duration, is_number,
-        is_string, is_table, in_table, numlen, string.reverse, num_format,
-        numtomoney, math.minmax, n_input, long_input, select2, select3,
-        note (Notice Mod), Zeitrechnungen, Autoumbruch in Say, mysql_escape, account.set_pw, pc.check_inventory_place,
-        do_for_other, local_pc_setqf, pc.trans, pc.warp_to, local_warp_pc, download,
-        dot, dostr, wartungsmodus, create_folder, INI-Parser, Ini-Parser (alt),
-        csay, Farbcodes, Apache-Funktionen, TS3-Funktionen
---]]
-
-
---[[
-    @name   split
-    @author Internet (http://lua-users.org/wiki/SplitJoin)
-    @descr
-Splittet einen String in eine Tabelle.
---]]
-function split(str, delim, maxNb)
-    if str == nil then return str end
-    if string.find(str, delim) == nil then return { str } end
-    if maxNb == nil or maxNb < 1 then maxNb = 0 end
-    local result = {}
-    local pat = "(.-)" .. delim .. "()"
-    local nb = 0
-    local lastPos
-    for part, pos in string.gfind(str, pat) do
-        nb = nb + 1
-        result[nb] = part
-        lastPos = pos
-        if nb == maxNb then break end
-    end
-    if nb ~= maxNb then result[nb + 1] = string.sub(str, lastPos) end
-    return result
-end
-
-
---[[
-    @name   mysql_query
-    @author Mijago
-    @needs  split
-    @descr
-Mysql-Funktion der neuesten Generation.
---]]
-mysql_query = function(query)
-    if not pre then
-        local rt = io.open('CONFIG','r'):read('*all')
-        pre,_= string.gsub(rt,'.+PLAYER_SQL:%s(%S+)%s(%S+)%s(%S+)%s(%S+).+','-h%1 -u%2 -p%3 -D%4')
-    end
-    math.randomseed(os.time())
-    local fi,t,out = 'mysql_data_'..math.random(10^9)+math.random(2^4,2^10),{},{}
-    -- os.execute('mysql '..pre..' --e='..string.format('%q',query)..' > '..fi) -- für MySQL51
-    os.execute('mysql '..pre..' -e'..string.format('%q',query)..' > '..fi) -- für MySQL55
-    for av in io.open(fi,'r'):lines() do table.insert(t,split(av,'\t')) end; os.remove(fi);
-    for i = 2, table.getn(t) do table.foreach(t[i],function(a,b)
-        out[i-1]               = out[i-1] or {}
-        out[i-1][a]            = tonumber(b) or b or 'NULL'
-        out[t[1][a]]           = out[t[1][a]] or {}
-        out[t[1][a]][i-1]      = tonumber(b) or b or 'NULL'
-    end) end
-    return out
-end
-
--- mysql_query = function(query)
-    -- math.randomseed(os.time())
-    -- local fi,t,out = 'mysql_data_'..math.random(10^9)+math.random(2^4,2^10),{},{}
-    -- os.execute('mysql --login-path=local -e'..string.format('%q',query)..' > '..fi)
-    -- for av in io.open(fi,'r'):lines() do table.insert(t,split(av,'\t')) end; os.remove(fi);
-    -- for i = 2, table.getn(t) do 
-        -- table.foreach(t,function(a,b)
-        -- out[i-1]               = out[i-1] or {}
-        -- out[i-1][a]            = tonumber(b) or b or 'NULL'
-        -- out[t[1][a]]           = out[t[1][a]] or {}
-        -- out[t[1][a]][i-1]      = tonumber(b) or b or 'NULL'
-        -- end)
-    -- end
-    -- out.__lines = t[1]
-    -- return out
--- end
-
---[[
-    @name   mysql_query_old
-    @author Mijago
-    @needs  split
-    @descr
-Die Alte Version der MySQL-Query-Funktion.
---]]
-local ql = {
-    ["user"] = "root",
-    ["pass"] = "",
-    ["ip"] = "localhost",
-    ["db"]    = "player"
-}
-function mysql_query_old(query,user,pass,db,ip)
-    local pre = ''
-    if query == '' or query == nil then
-        error("Query muss gesetzt sein!")
-    end
-    user = user or ql.mysql["user"]
-    pass = pass or ql.mysql["pass"]
-    ip = ip or ql.mysql["ip"]
-    if user ~= '' and user ~= nil then pre = pre..' -u'..user end
-    if pass ~= '' and pass ~= nil then pre = pre..' -p'..pass end
-    if db ~= '' and db ~= nil then pre = pre..' -D'..db end
-    if ip ~= '' and ip ~= nil then pre = pre..' -h'..ip end
-    math.randomseed(os.time()); local rand = math.random(0,10^7) -- Erstellen der Pfadvariable
-    local path = 'data/mysql_output_'..os.time()..'_'..rand..'_'..pc.get_vid()
-    os.execute ("mysql "..pre.." --e=\""..query.."\" > "..path) -- Laden und Auflisten der Dateiinhalte
-    local fi,q = io.open(path,"r"),{["l"] = {},["out"]={}}
-    if fi == nil then
-        return "ERROR"
-    end
-    for line in fi:lines() do table.insert(q.l,(split(line,"\t"))) end
-    os.remove(path)
-    if type(q.l[1]) ~= "table" then 
-        return "ERROR"
-        --error("Fehler bei der MySQL Verbindung oder bei der Rückgabe! Abbruch!")
-    end
-    local ix = 0
-    table.foreachi(q.l,function(i,l)
-        if i > 1 then table.foreach(l,function(i2,l2)
-            if q.out[q.l[1][i2]] == nil then q.out[q.l[1][i2]] = {} end
-            local c =  tonumber(l2)
-            if type(c) == "number" and l2 == tostring(c) then
-                q.out[q.l[1][i2]][i-1] = c
-            else
-                q.out[q.l[1][i2]][i-1] = l2
-            end
-        end) end
-    end)
-    -- ENDE der eigentlichen MySQL-Funktion
-    -- START Zusatz: Hanashi-Kompatibilität & Fehlerbehandlung
-    q.out.__data = q.l[1]
-    setmetatable(q.out, { __index = function(a,b) 
-        if type(b) == "number" then
-            return (a[a.__data[b]] or {"ERROR"})
-        end
-        return "ERROR"
-        --error("Fehler bei Indexierung: Index "..b.." ist nicht vorhanden!")
-    end})
-    return q.out
-end
-
-
---[[
-    @name   define
-    @author Mijago
-    @descr
-Gibt die Möglichkeit, globale Variablen zu definieren. Es können auch Funktionen genutzt werden! Diese werden dann AUSGEFÜHRT zurückgegeben!
---]]
-_G.__data = {}
-local meta = getmetatable(_G) or {}
-meta.__index = function(me,index) 
-    local data = _G.__data[index]
-    if type(data) == "function" then
-        return data()
-    else -- auch bei nil!
-        return data
-    end
-end    
-setmetatable(_G,meta)
-
-function define(name,func)  -- func is a function or some value
-    _G.__data[name] = func
-end
-
-
---[[
-    @name   duration
-    @author Mijago
-    @descr
-Gibt die verbleibende Zeit als String zurück.
---]]
-function duration(ipe) 
-    local ipe,dat= ipe or 0,''
-	local s,m,h,d,mo,y = tonumber(os.date('%S',ipe)),
-					  tonumber(os.date('%M',ipe)),
-					  tonumber(os.date('%H',ipe)),
-					  tonumber(os.date('%d',ipe))-1,
-					  tonumber(os.date('%m',ipe))-1,
-					  tonumber(os.date('%Y',ipe))-1970
-	for x,c in {{s,"Sek."},{m,"Min."},{h,"Std."},{d,"Tage","Tag"},{mo,"Monate","Monat"},{y,"Jahre","Jahr"}} do
-		if (c[1] or 0) > 0 then
-			if x > 1 then dat = ' '..dat end
-            if c[1] > 1 then
-                dat = c[1]..' '..c[2]..dat
-            else 
-                dat = c[1]..' '..(c[3] or c[2])..dat
-            end
-		end
-	end	
-    return dat
-end 
-
-
---[[
-    @name   is_number
-    @author Mijago
-    @descr
-Prüft, ob eine Variable eine Zahl ist.
---]]
-function is_number(var)
-    return (type(var) == "number")
-end	
-
-
---[[
-    @name   is_string
-    @author Mijago
-    @descr
-Prüft, ob eine Variable ein String ist.
---]]
-function is_string(var)
-    return (type(var) == "string")
-end
-
-
---[[
-    @name   is_table
-    @author Mijago
-    @descr
-Prüft, ob eine Variable eine Tabelle ist.
---]]
-function is_table(var)
-    return (type(var) == "table")
-end
-
-
---[[
-    @name   in_table
-    @author Mijago
-    @descr
-Prüft, ob eine Variablei in einer Tabelle ist.
-Aufruf: in_table(var,table)
---]]
-function in_table ( e, t )
-    for _,v in pairs(t) do
-        if (v==e) then 
-            return true 
-        end
-    end
-    return false
-end
-
-
---[[
-    @name   numlen
-    @author Mijago
-    @descr
-Gibt die Anzahl der Ziffern einer Zahl wieder.
---]]
-function numlen(i)
-    local i,x = i or 0,0
-    while i > 10^x do x=x+1 end
-    return x
-end
-
-
---[[
-    @name   string.reverse
-    @author Mijago
-    @descr
-Kehrt einen String um.
---]]
-function string.reverse(str)
-    local se = ''
-    for i=1,string.len(str) do
-        se = string.sub(str,i,i)..se
-    end
-    return se
-end
-
-
---[[
-    @name   num_format
-    @author Mijago; Idee von Benhero
-    @needs  string.reverse
-    @descr
-Formatiert lange Zahlen mit Punkten.
-
---]]
-function num_format(num)
-    if type(num) == "number" then num = tostring(num) end
-    if string.len(num) <= 3 then return num end
-    return string.reverse(string.gsub(string.reverse(num),'(%d%d%d)','%1.'))
-end
-
-
---[[
-    @name   numtomoney
-    @author Mijago
-    @descr
-Formatiert zB 1234567 in 1.234.567.
---]]
-function numtomoney(num)
-    local num,out,x = tostring(num),'',0
-    while string.len(num)-3 > 0 do
-        out = string.gsub(num,'.-(%d%d%d)$','.%1')..out
-        num = string.sub(num,0,string.len(num)-3)
-    end
-    return num..out
-end
-
-
---[[
-    @name   math.minmax
-    @author Mijago
-    @descr
-Ermöglicht die Angabe von min und max auf einmal
---]]
-math.minmax = function(min,num,max)
-    return math.min(math.max(num,min),max)
-    -- oder:  return num > max and max or num < min and min or num
-end
-
-
---[[
-    @name   n_input
-    @author Mijago
-    @descr
-Für Inputs nur für Zahlen.
-Die Zahl ist IMMER positiv. Wenn sie nicht gültig ist, ist sie 0.
---]]
-function n_input()
-    return math.abs(tonumber(input()) or 0)
-end
-
-
---[[
-    @name   long_input
-    @author Mijago
-    @descr
-Ermöglicht es, längere Inputs zu nutzen.
---]]
-function long_input()
-    local str,t = "",input()
-    while t ~= "" do
-        str = str..t
-        t = input()
-    end
-    return str, str ~= ""
-end
-
-
---[[
-    @name   select2
-    @author Mijago
-    @needs  split
-    @descr
-Wie Select:
-Eine Tabelle oder eine  Stringliste wird auf Seiten aufgeteilt.
-Weiter und Abbrechen Buttons.
---]]
-function select2(tab,...)
-    arg.n = nil
-    if type(tab) ~= "table" and type(tab) == 'number' then
-        table.insert(arg,1,tab)
-        tab = arg
-    elseif type(tab) ~= "table" and type(tab) == 'string' then
-        table.insert(arg,1,tab)
-        table.insert(arg,1,8)
-        tab = arg
-    elseif type(tab) == "table" and type(tab[1]) == 'string' then
-        table.insert(tab,1,8)
-    end
-    local max = tab[1]; table.remove(tab,1)
-    local tablen,outputstr,outputcount,nextc,incit = table.getn(tab),"",0,0,0
-    table.foreach(tab,
-        function(i,l)
-            outputcount = outputcount + 1
-            if outputcount == 1 then
-                outputstr=outputstr..'sel = select("'..l..'"'
-            elseif outputcount == max and tablen > outputcount+incit  then
-                if tablen ~= outputcount+incit+1 then
-                    outputstr=outputstr..',"'..l..'","Nächste Seite") + '..incit..' '
-                    if nextc > 0 then
-                        outputstr = outputstr..'end '
-                    end
-                    outputstr=outputstr..'; if sel == '..(incit+max+1)..' then '        -- Anfangen der neuen Abfrage
-                    nextc, outputcount, incit= nextc+1,0,incit+max
-                else
-                    outputstr=outputstr..',"'..l..'"'
-                end
-            else
-                outputstr=outputstr..',"'..l..'"'
-            end
-        end
-    )
-    outputstr = outputstr..') + '..incit
-    if nextc > 0 then
-        outputstr = outputstr..' end'
-    end
-    outputstr= outputstr.. '; return sel'
-    print(outputstr)
-    local sel = assert(loadstring(outputstr))()
-    tablen,outputstr,outputcount,nextc,incit = nil,nil,nil,nil,nil -- Speicher freimachen
-    return sel
-end
-
-
-
---[[
-    @name   select3
-    @author Mijago
-    @needs  split
-    @descr
-Wie Select2:
-Eine Tabelle oder eine  Stringliste wird auf Seiten aufgeteilt.
-Weiter, Zurück und Abbrechen (-1) Buttons.
---]]
-function select3(...)
-    arg.n = nil
-    local tp,max = arg,5
-    if type(tp[1]) == 'number' then
-        max = tp[1]
-        if type(tp[2]) == 'table' then
-            tp = tp[2]
-        else
-            table.remove(tp,1)
-        end
-    elseif type(tp[1]) == 'table' then
-        if type(tp[1][1]) == 'number' then
-            max = tp[1][1]
-            table.remove(tp[1],1)
-            tp = tp[1]
-        end
-        tp = tp[1]
-    end
-    local str = '{'
-    local tablen,act,incit = table.getn(tp),0,0
-    table.foreach(tp,function(i,l)
-        act = act + 1
-        if act == 1 then
-            str = str .. '{'..string.format('%q',l)
-        elseif act == max+1 and tablen > act+incit then
-            if tablen ~= act+incit+1 then
-                str = str..'},{'..string.format('%q',l)
-            else
-                str=str..','..string.format('%q',l)
-            end
-            incit = incit + max
-            act = 1
-        else
-            str=str..','..string.format('%q',l)
-        end
-    end)
-    local px = loadstring('return '..str ..'}}')()
-    local function copy_tab(t) local p= {} for i = 1,table.getn(t) do p[i] = t[i] end return p end
-    local pe = {}
-    for i = 1,table.getn(px) do pe [i] = copy_tab(px[i]) end
-    local function init(i,ip)
-        pe[i] = copy_tab(px[i])
-        local next,back,exit = 0,0,0
-        if i < table.getn(pe) and table.getn(pe) ~=1 then  table.insert(pe[i],table.getn(pe[i])+1,'Weiter zu Seite '..(i+1)); next = table.getn(pe[i]) end
-        if i > 1 then table.insert(pe[i],table.getn(pe[i])+1,'Zurück zu Seite '..(i-1)); back = table.getn(pe[i]) end
-        table.insert(pe[i],table.getn(pe[i])+1,'Abbruch'); exit = table.getn(pe[i])
-        if table.getn(pe) > 1 then
-            say('Seite '..i..' von '..table.getn(pe))
-        end
-        local e = select_table(pe[i])
-        if e == next then return init(i+1,ip+max)
-        elseif e == back then return init(i-1,ip-max)
-        elseif e == exit then return -1
-        else return e+ip,pe[i][e] end
-    end
-    return init(1,0) or -1
-end
-
-
---[[
-    @name   note (Notice Mod)
-    @author Mijago
-    @descr
-Wie Notice, nur mit Spielername davor.
---]]
-function note(text)
-    notice_all(pc.get_name()..': '..text)
-end
-
-
---[[
-    @name   Zeitrechnungen
-    @author Mijago
-    @descr
-Funktionen zum Umrechenen von Zeit.
---]]
-zt = zt or {}
-zt.d_j = 	function(d)
-                return d/365
-            end
-zt.d_mo = 	function(d)
-                return d/12
-            end
-zt.d_h = 	function(d)
-                return d*24
-            end
-zt.d_m = 	function(d)
-                return d*24*60
-            end
-zt.d_s = 	function(d)
-                return d*24*60*60
-            end
-zt.d_hs = 	function(d)
-                return d*24*60*60*100
-            end
-zt.d_ms = 	function(d)
-                return d*24*60*60*1000
-            end
---- Stunden
-zt.h_j = 	function(h)
-                return h/24/365
-            end
-zt.h_mo = 	function(h)
-                return h/24/12
-            end
-zt.h_d = 	function(h)
-                return h/24
-            end
-zt.h_m = 	function(h)
-                return h*60
-            end
-zt.h_s = 	function(h)
-                return h*60*60
-            end
-zt.h_hs = 	function(h)
-                return h*60*60*100
-            end
-zt.h_ms = 	function(h)
-                return h*60*60*1000
-            end
---- Minuten
-zt.m_j = 	function(m)
-                return m/60/24/365
-            end
-zt.m_mo = 	function(m)
-                return m/60/24/12
-            end
-zt.m_d = 	function(m)
-                return m/60/24
-            end
-zt.m_h = 	function(m)
-                return m/60
-            end
-zt.m_s = 	function(m)
-                return m*60
-            end
-zt.m_hs = 	function(m)
-                return m*60*100
-            end
-zt.m_ms = 	function(m)
-                return m*60*1000
-            end
---- Sekunden
-zt.s_j = 	function(s)
-                return s/60/60/24/365
-            end
-zt.s_mo = 	function(s)
-                return s/60/60/24/12
-            end
-zt.s_d = 	function(s)
-                return s/60/60/24
-            end
-zt.s_h = 	function(s)
-                return s/60/60
-            end
-zt.s_m = 	function(s)
-                return s/60
-            end
-zt.s_hs = 	function(s)
-                return s*100
-            end
-zt.s_ms = 	function(s)
-                return s*1000
-            end	
-
-
---[[
-    @name   Autoumbruch in Say
-    @author Mijago
-    @descr
-Fügt die Funktion say2 an. 
-Mit ihr werden Texte automatisch umgebrochen.
---]]
-function say2(str,dx) 
-    local maxl,actl,pat = dx or 50,0,'(.-)(%[.-%])()' 
-    local result,nb,lastPos,outp = {},0,0,'' 
-    local function bere(stx) 
-        for le in string.gfind(stx,'((%S+)%s*)') do  
-            if actl + string.len(le) > maxl then  
-                outp = outp..'[ENTER]'  
-                actl = 0  
-            end  
-            outp = outp..le  
-            actl = actl + string.len(le)  
-        end  
-    end 
-    for part, dos,pos in string.gfind(str, pat) do  
-        if part ~= '' then  
-            bere(part) 
-        end 
-        outp = outp..dos  
-        lastPos = pos  
-    end  
-    bere(string.sub(str,lastPos)) 
-    say(outp) 
-end 
-
-
---[[
-    @name   mysql_escape
-    @author Mijago
-    @descr
-Wie mysql_real_escape_string in PHP;
-Hilft, SQLi vorzubeugen.
---]]
-function mysql_escape(str)
-    str = string.gsub(str,"%\\", "\\\\")
---    str = string.gsub(str,"%\0", "\\0") Gibt einen fehler aus :o | Wer rausfindet, warum.. Bitte mir Schreiben (Mijago)
-    str = string.gsub(str,"%\n", "\\n")
-    str = string.gsub(str,"%\r", "\\r")
-    str = string.gsub(str,"%\x1a", "\Z")
-    str = string.gsub(str,"%\'", "\\'")
-    str = string.gsub(str,'%\"', '\\"')
-    return str
-end
-
-
---[[
-    @name   account.set_pw
-    @author Mijago; Idee von Benhero
-    @needs  mysql_query
-    @descr
-Funktion zum Ändern des Nutzerpasswortes.
-Angabe des Accounts kann weggelassen werden, als Accountname oder als Account ID angegeben werden.
---]]
-account = account or {}
-function account.set_pw(pw,ac)
-    if pw == nil then error("Fehler... Passwort muss gesetzt werden!") end
-    local ac = ac or pc.get_account_id() 
-    if type(ac) == "string" then
-        mysql_query("UPDATE player.player,account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = player.account_id and player.name = '"..ac.."' LIMIT 1")
-    elseif type(ac) == "number" then
-        mysql_query("UPDATE account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = "..ac)
-    end
-end 
-
-
---[[
-    @name   pc.check_inventory_place
-    @author Mijago
-    @descr
-Checkt auf Freie Inventarplätze für Items der größe X (Höhe).
---]]
-function pc.check_inventory_place(size)
-    if size <= 0 or size > 3 then
-        return -1
-    end
-    function check(c)
-        for i = 0,size-1 do
-            item.select_cell(e[c+(5*i)])
-            if item.get_id() ~= 0 then
-                return false
-            end
-        end
-        return true
-    end
-    for i = 0,89 do 
-        if check(i) then 
-            return i 
-        end
-    end
-    return -1
-end
-
-
---[[
-    @name   do_for_other
-    @author Mijago
-    @descr
-Führt einen String als Luabefehle bei einem anderem User aus.
---]]
-function do_for_other(name,ding)
-    local t = pc.select(find_pc_by_name(name))
-    assert(loadstring(ding))()
-    pc.select(t)
-end
-
-
---[[
-    @name   local_pc_setqf
-    @author Mijago
-    @descr
-Setzt die Questflag eines anderen Spielers.
---]]
-function local_pc_setqf(name, qf,wert) -- Für die aktuelle Quest
-    local target = find_pc_by_name(name)
-    local t = pc.select(target)
-    pc.setqf(qf,wert)
-    pc.select(t)
-end
-
-
---[[
-    @name   pc.trans
-    @author Mijago
-    @descr
-Warpt Spieler B zu Spieler A.
-Spieler a = pc.
---]]
-function pc.trans(vid)
-    if vid == nil then
-        error"VID muss gesetzt sein! (pc.warp_to)"
-    elseif type(vid) == "string" then
-        vid = find_pc_by_name(vid)
-        if vid == 0 then
-            error"Spieler nicht gefunden"
-        end
-    end
-    local x,y = pc.get_x()*100,pc.get_y()*100
-    local me = pc.select(vid)
-    pc.warp(x,y)
-    pc.select(me)
-end
-
-
---[[
-    @name   pc.warp_to
-    @author Mijago
-    @descr
-Warpt Spieler A zu Spieler B.
-Spieler a = pc.
---]]
-function pc.warp_to(vid)
-    if vid == nil then
-        error"VID muss gesetzt sein! (pc.warp_to)"
-    elseif type(vid) == "string" then
-        vid = find_pc_by_name(vid)
-        if vid == 0 then
-            error"Spieler nicht gefunden"
-        end
-    end
-    local me = pc.select(vid)
-    local x,y = pc.get_x()*100,pc.get_y()*100
-    pc.select(me)
-    pc.warp(x,y)
-end
-
-
---[[
-    @name   local_warp_pc
-    @author Mijago
-    @descr
-Warpt einen anderen Spieler lokal.
---]]
-function local_pc_warp(name, x, y,mid)
-    local target = find_pc_by_name(name)
-    local t = pc.select(target)
-    if mid == nil then
-        mid = pc.get_map_index()
-    end
-    pc.warp_local(mid, x*100, y*100)
-    pc.select(t)
-end
-
-
---[[
-    @name   download
-    @author Mijago
-    @descr
-Lädt eine Datei in den Data-Ordner.
---]]
-function download(url) os.execute("cd data && fetch "..url.." && cd ..") end
-
-
---[[
-    @name   dot
-    @author Mijago
-    @descr
-Führt alles Zwischen $ und $ im String aus.
---]]
-function dot(x)
-    return string.gsub(x, "%$(.-)%$", function (s) return loadstring(s)() end) 
-end
-
-
---[[
-    @name   dostr
-    @author Mijago
-    @descr
-Führt einen String als Lua-Befehl aus.
---]]
-function dostr(str)
-    assert(loadstring(str))()
-end
-
-
---[[
-    @name   wartungsmodus
-    @author Mijago
-    @needs  mysql_query
-    @descr
-Versetzt alle Accounts (außer GM-Accounts) in einen "Wartungsmodus" und wieder zurück.
---]]
-function wartungsmodus(v)
-    if v == 1 or v == true then
-        mysql_query("UPDATE account.account SET account.status = 'SHUTDOWN' WHERE status = 'OK' and account.login NOT IN (SELECT mAccount FROM common.gmlist);")
-    else
-        mysql_query("UPDATE account.account SET account.status = 'OK' WHERE status = 'SHUTDOWN' and account.login NOT IN (SELECT mAccount FROM common.gmlist);")
-    end
-end
-
-
---[[
-    @name   create_folder
-    @author Mijago 
-    @descr
-Erstellt Ordner, auch mit Unterordnern
---]]
-create_folder = function(path)
-    local pp = ''
-    for i in string.gfind(path,'([%w_\-]*/)') do
-        pp = pp..i
-        os.execute('if [ ! -d '..pp..' ]; then mkdir '..pp..'; fi')
-    end
-end
-
-
---[[
-    @name   INI-Parser
-    @author Mijago
-    @descr
-Ein NEUER Parser für INI-Dateien.
---]]
-ini = {
-    open = function(path)
-        return setmetatable({
-            path = path or "",
-        }, { __index = ini})
-    end,
-    write = function(self,section,key,value)
-        if not section or not key then return false end
-        local r,y = self:__get_text()
-        if not y then return false end
-        if string.find(r,"%["..section.."%]") then
-            if string.find(r,"%["..section.."%][^%[]*"..key.."=") then
-                r = string.gsub(r,"(%["..section.."%][^%[]*"..key.." *=)( *[^\n]+)",function(x)
-                    return x..value
-                end)
-            else
-                r = string.gsub(r,"(%["..section.."%][^%[]*)",function(x)
-                    return x.."\n"..key.."="..value.."\n"
-                end)
-            end
-        else
-            r = r.."\n["..section.."]\n"..key.."="..value
-        end
-        -- überflüssige leerzeichen löschen
-        r=string.gsub(string.gsub(string.gsub(r,"^(\n)",""),"(\n)$",""),"\n\n","\n")
-        local d = io.open(self.path,"w")
-        d:write(r)
-        d:close()
-    end,
-    read = function(self,section,key,default_value)
-        local t,y = self:__get_text()
-        if not y then return false end
-        local _,_,data = string.find(t,"%["..section.."%][^%[]*"..key.." *= *([^\n]+)")
-        local output = (data or default_value)
-        return tonumber(output) or output,true
-    end,
-    remove_key = function(self,section,key)
-        local t,y = self:__get_text()
-        if not y then return false end
-        if string.find(t,"%["..section.."%][^%[]*"..key.." *=[^\n]+") then
-            local t2=string.gsub(t,"(%["..section.."%][^%[]*)"..key.." *=[^\n]+",function(x)
-                return x
-            end)
-            if t2 ~= t then
-                local d= io.open(self.path,"w")
-                d:write(t2)
-                d:close()
-            end
-        end
-        return true
-    end,
-    remove_section = function(self,section)
-        local t,y = self:__get_text()
-        if not y then return false end
-        if string.find(t,"%["..section.."%][^%[]*") then
-            t = string.gsub(t,"%["..section.."%][^%[]*","")
-            local d = io.open(self.path,"w")
-            d:write(t)
-            d:close()
-        end
-        return true
-    end,
-    __get_text = function(self)
-        local d = io.open(self.path,"r")
-        if not d then return "",false end
-        local t = d:read"*all"
-        d:close()
-        return t,true
-    end,
-}
-
-
---[[
-    @name   Ini-Parser (alt)
-    @author Mijago
-    @needs  split
-    @descr
--- OUTDATED --
-Ein Parser für Ini-Dateien.
-Besitzt eine Eigene Beschreibung der einzelnen Funktionen im Code.
---]]
-do
-    -- Funktionen:
-    -- var = ini.new() 
-    -- var = ini.open(path)
-    -- var:write_str(sub,name,wert)
-    -- var:write_int(sub,name,wert)
-    -- var:write_bool(sub,name,boolean)
-    -- var:clear()
-    -- var:read_str(sub,name,norm)   -- Gibt einen String zurück. -|
-    -- var:read_int(sub,name,norm)   -- Gibt eine Zahl zurück      -|  norm wird zurückgegeben, wenn sub[name] nicht existiert.
-    -- var:read_bool(sub,name,norm)  -- Gibt true / False zurück  -|
-    -- var:delete_key(sub,nm)
-    -- var:delete_section(sub)
-    local ini_f = {}
-    ini = {}
-    function ini_f:append(sub,nm,wert)
-        if nm == '' or nm == nil then
-            return
-        end
-        self:parse()
-        if self.sub[sub] == nil then self.sub[sub] = {} end
-        self.sub[sub][nm] = wert
-        self:writeit()
-    end
-    function ini_f:write_str(sub,nm,wert)
-        self:append(sub,nm,wert)
-    end
-    function ini_f:write_int(sub,nm,wert)
-        self:append(sub,nm,wert)
-    end
-    function ini_f:write_bool(sub,nm,bool)
-        if not type(bool) == "boolean" then
-            return
-        end
-        local bin = 0
-        if bool == true then bin = 1 end
-        self:append(sub,nm,bin)
-        return bin
-    end
-    function ini_f:clear()
-        self.sub = {}
-        self.path = ''
-    end
-    function ini_f:writeit()
-        local out = ''
-        table.foreach(self.sub,
-            function(i,l)
-                out = out..'['..i..']\n'
-                table.foreach(l,
-                    function(i2,l2)
-                        out=out..i2..'='..l2..'\n'
-                    end
-                )
-            end
-        )
-        local d = io.open(self.path,'w')
-        d:write(out)
-        d:close()
-    end
-    function ini_f:delete_key(sub,nm)
-        if sub == '' or nm == '' or sub == nil or nm == nil then return end
-        self:parse()
-        self.sub[sub][nm] = nil
-        self:writeit()
-    end
-    function ini_f:delete_section(sub)
-        if sub == '' or sub == nil then return end
-        self:parse()
-        self.sub[sub]= nil
-        self:writeit()
-    end
-    function ini_f:parse()
-        self.sub = {}
-        if self.path == '' or self.path == nil then return end
-        local d,i = io.open(self.path,"r"),'non'
-        if d == nil then d = io.open(self.path,"w") end
-        for line in d:lines() do
-            if string.sub(line,1,1) == "[" then
-                i = string.sub(line,2,string.len(line)-1)
-                self.sub[i] = {}
-            else
-                local inp = split(line,'=')
-                self.sub[i][inp[1]] = inp[2]
-            end
-        end
-        d:close()
-    end
-    function ini_f:read_str(sub,nm,norm)
-        if sub == '' or nm == '' or sub == nil or nm == nil then return end
-        self:parse()
-        if self.sub[sub] == nil then return norm end
-        if self.sub[sub][nm] == nil then return norm else return self.sub[sub][nm] end
-    end
-    function ini_f:read_int(sub,nm,norm)
-        if sub == '' or nm == '' or sub == nil or nm == nil then return end
-        self:parse()
-        if self.sub[sub] == nil then return norm end
-        if self.sub[sub][nm] == nil then return norm else return tonumber(self.sub[sub][nm]) end
-    end
-    function ini_f:read_bool(sub,nm,norm)   -- Norm wird zurückgegeben, wenn der Key nm nicht existiert
-        if sub == '' or nm == '' or sub == nil or nm == nil then return end
-        self:parse()
-        if self.sub[sub] == nil then return norm end
-        if self.sub[sub][nm] == nil then return norm end
-        if self.sub[sub][nm] == "1" then return true else return false end
-    end
-    function ini_f:open(path)
-        self.path = path
-        self:parse()
-    end
-    function ini.new()
-        local out = {}
-        out.path = ''
-        out.sub = {}
-        setmetatable(out, { __index = ini_f })
-        return out
-    end
-    function ini.open(path)
-        local dat = ini.new()
-        dat:clear()
-        dat.path=path
-        dat:open(path)
-        return dat
-    end
-end
-
-
---[[
-    @name   csay
-    @author Mijago
-    @descr
-Wie die alten col-Befehle, sendet aber selbst.
-Also kein say(col.red('bla'))
-sondern
-csay.red('bla') reicht völlig aus.
---]]
-csay = setmetatable({__d = {
-        ["aliceblue"] = {240, 248, 255},     ["antiquewhite"] = {250, 235, 215},    ["aqua"] = {0, 255, 255},                   ["aquamarine"] = {127, 255, 212},
-        ["azure"] = {240, 255, 255},         ["beige"] = {245, 245, 220},           ["bisque"] = {255, 228, 196},               ["black"] = {0, 0, 0},
-        ["blanchedalmond"] = {255, 235, 205},["blue"] = {0, 0, 255},                ["blueviolet"] = {138, 43, 226},            ["brown"] = {165, 42, 42},
-        ["burlywood"] = {222, 184, 135},     ["cadetblue"] = {95, 158, 160},        ["chartreuse"] = {127, 255, 0},             ["chocolate"] = {210, 105, 30},
-        ["coral"] = {255, 127, 80},          ["cornflowerblue"] = {100, 149, 237},  ["cornsilk"] = {255, 248, 220},             ["crimson"] = {220, 20, 60},
-        ["cyan"] = {0, 255, 255},            ["darkblue"] = {0, 0, 139},            ["darkcyan"] = {0, 139, 139},               ["darkgoldenrod"] = {184, 134, 11},
-        ["darkgray"] = {169, 169, 169},      ["darkgreen"] = {0, 100, 0},           ["darkkhaki"] = {189, 183, 107},            ["darkmagenta"] = {139, 0, 139},
-        ["darkolivegreen"] = {85, 107, 47},  ["darkorange"] = {255, 140, 0},        ["darkorchid"] = {153, 50, 204},            ["darkred"] = {139, 0, 0},
-        ["darksalmon"] = {233, 150, 122},    ["darkseagreen"] = {143, 188, 139},    ["darkslateblue"] = {72, 61, 139},          ["darkslategray"] = {47, 79, 79},
-        ["darkturquoise"] = {0, 206, 209},   ["darkviolet"] = {148, 0, 211},        ["deeppink"] = {255, 20, 147},              ["deepskyblue"] = {0, 191, 255},
-        ["dimgray"] = {105, 105, 105},       ["dodgerblue"] = {30, 144, 255},       ["firebrick"] = {178, 34, 34},              ["floralwhite"] = {255, 250, 240},
-        ["forestgreen"] = {34, 139, 34},     ["fuchsia"] = {255, 0, 255},           ["gainsboro"] = {220, 220, 220},            ["ghostwhite"] = {248, 248, 255},
-        ["gold"] = {255, 215, 0},            ["goldenrod"] = {218, 165, 32},        ["gray"] = {128, 128, 128},                 ["green"] = {0, 128, 0},
-        ["greenyellow"] = {173, 255, 47},    ["honeydew"] = {240, 255, 240},        ["hotpink"] = {255, 105, 180},              ["indianred"] = {205, 92, 92},
-        ["indigo"] = {75, 0, 130},           ["ivory"] = {255, 255, 240},           ["khaki"] = {240, 230, 140},                ["lavender"] = {230, 230, 250},
-        ["lavenderblush"] = {255, 240, 245}, ["lawngreen"] = {124, 252, 0},         ["lemonchiffon"] = {255, 250, 205},         ["lightblue"] = {173, 216, 230},
-        ["lightcoral"] = {240, 128, 128},    ["lightcyan"] = {224, 255, 255},       ["lightgoldenrodyellow"] = {250, 250, 210}, ["lightgray"] = {211, 211, 211},
-        ["lightgreen"] = {144, 238, 144},    ["lightpink"] = {255, 182, 193},       ["lightsalmon"] = {255, 160, 122},          ["lightseagreen"] = {32, 178, 170},
-        ["lightskyblue"] = {135, 206, 250},  ["lightslategray"] = {119, 136, 153},  ["lightsteelblue"] = {176, 196, 222},       ["lightyellow"] = {255, 255, 224},
-        ["lime"] = {0, 255, 0},              ["limegreen"] = {50, 205, 50},         ["linen"] = {250, 240, 230},                ["magenta"] = {255, 0, 255},
-        ["maroon"] = {128, 0, 0},            ["mediumaquamarine"] = {102, 205, 170},["mediumblue"] = {0, 0, 205},               ["mediumorchid"] = {186, 85, 211},
-        ["mediumpurple"] = {147, 112, 219},  ["mediumseagreen"] = {60, 179, 113},   ["mediumslateblue"] = {123, 104, 238},      ["mediumspringgreen"] = {0, 250, 154},
-        ["mediumturquoise"] = {72, 209, 204},["mediumvioletred"] = {199, 21, 133},  ["midnightblue"] = {25, 25, 112},           ["mintcream"] = {245, 255, 250},
-        ["mistyrose"] = {255, 228, 225},     ["moccasin"] = {255, 228, 181},        ["navajowhite"] = {255, 222, 173},          ["navy"] = {0, 0, 128},
-        ["oldlace"] = {253, 245, 230},       ["olive"] = {128, 128, 0},             ["olivedrab"] = {107, 142, 35},             ["orange"] = {255, 165, 0},
-        ["orangered"] = {255, 69, 0},        ["orchid"] = {218, 112, 214},          ["palegoldenrod"] = {238, 232, 170},        ["palegreen"] = {152, 251, 152},
-        ["paleturquoise"] = {175, 238, 238}, ["palevioletred"] = {219, 112, 147},   ["papayawhip"] = {255, 239, 213},           ["peachpuff"] = {255, 218, 185},
-        ["peru"] = {205, 133, 63},           ["pink"] = {255, 192, 203},            ["plum"] = {221, 160, 221},                 ["powderblue"] = {176, 224, 230},
-        ["purple"] = {128, 0, 128},          ["red"] = {255, 0, 0},                 ["rosybrown"] = {188, 143, 143},            ["royalblue"] = {65, 105, 225},
-        ["saddlebrown"] = {139, 69, 19},     ["salmon"] = {250, 128, 114},          ["sandybrown"] = {244, 164, 96},            ["seagreen"] = {46, 139, 87},
-        ["seashell"] = {255, 245, 238},      ["sienna"] = {160, 82, 45},            ["silver"] = {192, 192, 192},               ["skyblue"] = {135, 206, 235},
-        ["slateblue"] = {106, 90, 205},      ["slategray"] = {112, 128, 144},       ["snow"] = {255, 250, 250},                 ["springgreen"] = {0, 255, 127},
-        ["steelblue"] = {70, 130, 180},      ["tan"] = {210, 180, 140},             ["teal"] = {0, 128, 128},                   ["thistle"] = {216, 191, 216},
-        ["tomato"] = {255, 99, 71},          ["turquoise"] = {64, 224, 208},        ["violet"] = {238, 130, 238},               ["wheat"] = {245, 222, 179},
-        ["white"] = {255, 255, 255},         ["whitesmoke"] = {245, 245, 245},      ["yellow"] = {255, 255, 0},                 ["yellowgreen"] = {154, 205, 50}
-    }},{
-        __index = function(tab,idx)
-            local color = tab.__d[idx] or {0,0,0}
-            return function(x) say('[COLOR r;'..(color[1]/255)..'|g;'..(color[2]/255)..'|b;'..(color[3]/255)..']'..x..'[/COLOR]') end
-        end
-})
-
-
---[[
-    @name   Farbcodes
-    @author Mijago
-    @descr
-Farbcodes für Say
---]]
-col = col or {}
-col.list= {
-{ 'lightcoral', 240,128,128 },{ 'rosybrown', 188,143,143 },
-{ 'indianred', 205,92,92 },{ 'red', 255,0,0 },{ 'firebrick', 178,34,34 },{ 'brown', 165,42,42 },
-{ 'darkred', 139,0,0 },{ 'maroon', 128,0,0 },{ 'mistyrose', 255,228,225 },{ 'salmon', 250,128,114 },
-{ 'tomato', 255,99,71 },{ 'darksalmon', 233,150,122 },{ 'coral', 255,127,80 },{ 'orangered', 255,69,0 },
-{ 'lightsalmon', 255,160,122 },{ 'sienna', 160,82,45 },{ 'seashell', 255,245,238 },{ 'chocolate', 210,105,30 },
-{ 'saddlebrown', 139,69,19 },{ 'sandybrown', 244,164,96 },{ 'peachpuff', 255,218,185 },{ 'peru', 205,133,63 },
-{ 'linen', 250,240,230 },{ 'bisque', 255,228,196 },{ 'darkorange', 255,140,0 },{ 'burlywood', 222,184,135 },
-{ 'antiquewhite', 250,235,215 },{ 'tan', 210,180,140 },{ 'navajowhite', 255,222,173 },{ 'blanchedalmond', 255,235,205 },
-{ 'papayawhip', 255,239,213 },{ 'moccasin', 255,228,181 },{ 'orange', 255,165,0 },{ 'wheat', 245,222,179 },
-{ 'oldlace', 253,245,230 },{ 'floralwhite', 255,250,240 },{ 'darkgoldenrod', 184,134,11 },{ 'goldenrod', 218,165,32 },
-{ 'cornsilk', 255,248,220 },{ 'gold', 255,215,0 },{ 'lemonchiffon', 255,250,205 },{ 'khaki', 240,230,140 },
-{ 'palegoldenrod', 238,232,170 },{ 'darkkhaki', 189,183,107 },{ 'ivory', 255,255,240 },{ 'lightyellow', 255,255,224 },
-{ 'beige', 245,245,220 },{ 'lightgoldenrodyellow', 250,250,210 },{ 'yellow', 255,255,0 },{ 'olive', 128,128,0 },
-{ 'olivedrab', 107,142,35 },{ 'yellowgreen', 154,205,50 },{ 'darkolivegreen', 85,107,47 },{ 'greenyellow', 173,255,47 },
-{ 'chartreuse', 127,255,0 },{ 'lawngreen', 124,252,0 },{ 'darkseagreen', 143,188,139 },{ 'honeydew', 240,255,240 },
-{ 'palegreen', 152,251,152 },{ 'lightgreen', 144,238,144 },{ 'lime', 0,255,0 },{ 'limegreen', 50,205,50 },
-{ 'forestgreen', 34,139,34 },{ 'green', 0,128,0 },{ 'darkgreen', 0,100,0 },{ 'seagreen', 46,139,87 },
-{ 'mediumseagreen', 60,179,113 },{ 'springgreen', 0,255,127 },{ 'mintcream', 245,255,250 },{ 'mediumspringgreen', 0,250,154 },
-{ 'mediumaquamarine', 102,205,170 },{ 'aquamarine', 127,255,212 },{ 'turquoise', 64,224,208 },{ 'lightseagreen', 32,178,170 },
-{ 'mediumturquoise', 72,209,204 },{ 'azure', 240,255,255 },{ 'lightcyan', 224,255,255 },{ 'paleturquoise', 175,238,238 },
-{ 'aqua', 0,255,255 },{ 'cyan', 0,255,255 },{ 'darkcyan', 0,139,139 },{ 'teal', 0,128,128 },
-{ 'darkslategray', 47,79,79 },{ 'darkturquoise', 0,206,209 },{ 'cadetblue', 95,158,160 },{ 'powderblue', 176,224,230 },
-{ 'lightblue', 173,216,230 },{ 'deepskyblue', 0,191,255 },{ 'skyblue', 135,206,235 },{ 'lightskyblue', 135,206,250 },
-{ 'steelblue', 70,130,180 },{ 'aliceblue', 240,248,255 },{ 'dodgerblue', 30,144,255 },{ 'lightslategray', 119,136,153 },
-{ 'slategray', 112,128,144 },{ 'lightsteelblue', 176,196,222 },{ 'cornflowerblue', 100,149,237 },{ 'royalblue', 65,105,225 },
-{ 'ghostwhite', 248,248,255 },{ 'lavender', 230,230,250 },{ 'blue', 0,0,255 },{ 'mediumblue', 0,0,205 },
-{ 'darkblue', 0,0,139 },{ 'midnightblue', 25,25,112 },{ 'navy', 0,0,128 },{ 'slateblue', 106,90,205 },
-{ 'darkslateblue', 72,61,139 },{ 'mediumslateblue', 123,104,238 },{ 'mediumpurple', 147,112,219 },{ 'blueviolet', 138,43,226 },
-{ 'indigo', 75,0,130 },{ 'darkorchid', 153,50,204 },{ 'darkviolet', 148,0,211 },{ 'mediumorchid', 186,85,211 },
-{ 'thistle', 216,191,216 },{ 'plum', 221,160,221 },{ 'violet', 238,130,238 },{ 'fuchsia', 255,0,255 },
-{ 'magenta', 255,0,255 },{ 'darkmagenta', 139,0,139 },{ 'purple', 128,0,128 },{ 'orchid', 218,112,214 },
-{ 'mediumvioletred', 199,21,133 },{ 'deeppink', 255,20,147 },{ 'hotpink', 255,105,180 },{ 'lavenderblush', 255,240,245 },
-{ 'palevioletred', 219,112,147 },{ 'crimson', 220,20,60 },{ 'pink', 255,192,203 },{ 'lightpink', 255,182,193 },
-{ 'white', 255,255,255 },{ 'snow', 255,250,250 },{ 'whitesmoke', 245,245,245 },{ 'gainsboro', 220,220,220 },
-{ 'lightgray', 211,211,211 },{ 'silver', 192,192,192 },{ 'darkgray', 169,169,169 },{ 'gray', 128,128,128 },
-{ 'dimgray', 105,105,105 },{ 'black', 0,0,0 },{ 'aliceblue', 240,248,255 },{ 'antiquewhite', 250,235,215 },
-{ 'aqua', 0,255,255 },{ 'aquamarine', 127,255,212 },{ 'azure', 240,255,255 },{ 'beige', 245,245,220 },
-{ 'bisque', 255,228,196 },{ 'black', 0,0,0 },{ 'blanchedalmond', 255,235,205 },{ 'blue', 0,0,255 },
-{ 'blueviolet', 138,43,226 },{ 'brown', 165,42,42 },{ 'burlywood', 222,184,135 },{ 'cadetblue', 95,158,160 },
-{ 'chartreuse', 127,255,0 },{ 'chocolate', 210,105,30 },{ 'coral', 255,127,80 },{ 'cornflowerblue', 100,149,237 },
-{ 'cornsilk', 255,248,220 },{ 'crimson', 220,20,60 },{ 'cyan', 0,255,255 },{ 'darkblue', 0,0,139 },
-{ 'darkcyan', 0,139,139 },{ 'darkgoldenrod', 184,134,11 },{ 'darkgray', 169,169,169 },{ 'darkgreen', 0,100,0 },
-{ 'darkkhaki', 189,183,107 },{ 'darkmagenta', 139,0,139 },{ 'darkolivegreen', 85,107,47 },{ 'darkorange', 255,140,0 },
-{ 'darkorchid', 153,50,204 },{ 'darkred', 139,0,0 },{ 'darksalmon', 233,150,122 },{ 'darkseagreen', 143,188,139 },
-{ 'darkslateblue', 72,61,139 },{ 'darkslategray', 47,79,79 },{ 'darkturquoise', 0,206,209 },{ 'darkviolet', 148,0,211 },
-{ 'deeppink', 255,20,147 },{ 'deepskyblue', 0,191,255 },{ 'dimgray', 105,105,105 },{ 'dodgerblue', 30,144,255 },
-{ 'firebrick', 178,34,34 },{ 'floralwhite', 255,250,240 },{ 'forestgreen', 34,139,34 },{ 'fuchsia', 255,0,255 },
-{ 'gainsboro', 220,220,220 },{ 'ghostwhite', 248,248,255 },{ 'gold', 255,215,0 },{ 'goldenrod', 218,165,32 },
-{ 'gray', 128,128,128 },{ 'green', 0,128,0 },{ 'greenyellow', 173,255,47 },{ 'honeydew', 240,255,240 },
-{ 'hotpink', 255,105,180 },{ 'indianred', 205,92,92 },{ 'indigo', 75,0,130 },{ 'ivory', 255,255,240 },
-{ 'khaki', 240,230,140 },{ 'lavender', 230,230,250 },{ 'lavenderblush', 255,240,245 },{ 'lawngreen', 124,252,0 },
-{ 'lemonchiffon', 255,250,205 },{ 'lightblue', 173,216,230 },{ 'lightcoral', 240,128,128 },{ 'lightcyan', 224,255,255 },
-{ 'lightgoldenrodyellow', 250,250,210 },{ 'lightgray', 211,211,211 },{ 'lightgreen', 144,238,144 },{ 'lightpink', 255,182,193 },
-{ 'lightsalmon', 255,160,122 },{ 'lightseagreen', 32,178,170 },{ 'lightskyblue', 135,206,250 },{ 'lightslategray', 119,136,153 },
-{ 'lightsteelblue', 176,196,222 },{ 'lightyellow', 255,255,224 },{ 'lime', 0,255,0 },{ 'limegreen', 50,205,50 },
-{ 'linen', 250,240,230 },{ 'magenta', 255,0,255 },{ 'maroon', 128,0,0 },{ 'mediumaquamarine', 102,205,170 },
-{ 'mediumblue', 0,0,205 },{ 'mediumorchid', 186,85,211 },{ 'mediumpurple', 147,112,219 },{ 'mediumseagreen', 60,179,113 },
-{ 'mediumslateblue', 123,104,238 },{ 'mediumspringgreen', 0,250,154 },{ 'mediumturquoise', 72,209,204 },{ 'mediumvioletred', 199,21,133 },
-{ 'midnightblue', 25,25,112 },{ 'mintcream', 245,255,250 },{ 'mistyrose', 255,228,225 },{ 'moccasin', 255,228,181 },
-{ 'navajowhite', 255,222,173 },{ 'navy', 0,0,128 },{ 'oldlace', 253,245,230 },{ 'olive', 128,128,0 },
-{ 'olivedrab', 107,142,35 },{ 'orange', 255,165,0 },{ 'orangered', 255,69,0 },{ 'orchid', 218,112,214 },
-{ 'palegoldenrod', 238,232,170 },{ 'palegreen', 152,251,152 },{ 'paleturquoise', 175,238,238 },{ 'palevioletred', 219,112,147 },
-{ 'papayawhip', 255,239,213 },{ 'peachpuff', 255,218,185 },{ 'peru', 205,133,63 },{ 'pink', 255,192,203 },
-{ 'plum', 221,160,221 },{ 'powderblue', 176,224,230 },{ 'purple', 128,0,128 },{ 'red', 255,0,0 },
-{ 'rosybrown', 188,143,143 },{ 'royalblue', 65,105,225 },{ 'saddlebrown', 139,69,19 },{ 'salmon', 250,128,114 },
-{ 'sandybrown', 244,164,96 },{ 'seagreen', 46,139,87 },{ 'seashell', 255,245,238 },{ 'sienna', 160,82,45 },
-{ 'silver', 192,192,192 },{ 'skyblue', 135,206,235 },{ 'slateblue', 106,90,205 },{ 'slategray', 112,128,144 },
-{ 'snow', 255,250,250 },{ 'springgreen', 0,255,127 },{ 'steelblue', 70,130,180 },{ 'tan', 210,180,140 },
-{ 'teal', 0,128,128 },{ 'thistle', 216,191,216 },{ 'tomato', 255,99,71 },{ 'turquoise', 64,224,208 },
-{ 'violet', 238,130,238 },{ 'wheat', 245,222,179 },{ 'white', 255,255,255 },{ 'whitesmoke', 245,245,245 },
-{ 'yellow', 255,255,0 },{ 'yellowgreen', 154,205,50 }}
-table.foreachi(col.list,function(a,b)
-    col[b[1]] = 	function(text) return "[COLOR r;"..(b[2]/255.0).."|g;"..(b[3]/255.0).."|b;"..(b[4]/255.0).."]"..text..'[/COLOR]' end
-end)
-
-
---[[
-    @name   Apache-Funktionen
-    @author Mijago
-    @descr
-Funktionen, um Apache neu zu starten.
---]]
-proc=proc or {}
-proc.apache_start = function()
-                os.execute('apachectl start')
-            end
-proc.apache_stop = function()
-                os.execute('apachectl stop')
-            end
-proc.apache_restart = function()
-                os.execute('apachectl restart')
-            end
-proc.apache_graceful = function()
-                os.execute('apachectl graceful')
-            end
-
-
---[[
-    @name   TS3-Funktionen
-    @author Mijago
-    @descr
-Funktionen zum Starten, Stoppen und Neustarten eines TS3 Servers.
---]]
-proc=proc or {}
-proc.ts3_start = function(path)
-                os.execute('cd '..path..' && sh ts3server_startscript.sh start')
-                end
-proc.ts3_stop = function(path)
-                os.execute('cd '..path..' && sh ts3server_startscript.sh stop')
-                end
-proc.ts3_restart = function(path)
-                os.execute('cd '..path..' && sh ts3server_startscript.sh restart')
-                end
+--[[
+    Questliberweiterung generiert by Mijago
+    Link: http://questwriting.mijago.org/questlib/index.php?exec=1&updater=0&b1=1&b2=1&b10=1&b12=1&b23=1&b41=1&b42=1&b43=1&b44=1&b45=1&b46=1&b47=1&b48=1&b49=1&b60=1&b61=1&b101=1&b102=1&b103=1&b104=1&b106=1&b201=1&b301=1&b801=1&b802=1&b803=1&b804=1&b805=1&b806=1&b901=1&b902=1&b903=1&b904=1&b905=1&b1000=1&b1001=1&b1002=1&b1003=1&b1004=1&b2002=1
+    Funktionen: 
+        split, mysql_query, mysql_query_old, define, duration, is_number,
+        is_string, is_table, in_table, numlen, string.reverse, num_format,
+        numtomoney, math.minmax, n_input, long_input, select2, select3,
+        note (Notice Mod), Zeitrechnungen, Autoumbruch in Say, mysql_escape, account.set_pw, pc.check_inventory_place,
+        do_for_other, local_pc_setqf, pc.trans, pc.warp_to, local_warp_pc, download,
+        dot, dostr, wartungsmodus, create_folder, INI-Parser, Ini-Parser (alt),
+        csay, Farbcodes, Apache-Funktionen, TS3-Funktionen
+--]]
+
+
+--[[
+    @name   split
+    @author Internet (http://lua-users.org/wiki/SplitJoin)
+    @descr
+Splittet einen String in eine Tabelle.
+--]]
+function split(str, delim, maxNb)
+    if str == nil then return str end
+    if string.find(str, delim) == nil then return { str } end
+    if maxNb == nil or maxNb < 1 then maxNb = 0 end
+    local result = {}
+    local pat = "(.-)" .. delim .. "()"
+    local nb = 0
+    local lastPos
+    for part, pos in string.gfind(str, pat) do
+        nb = nb + 1
+        result[nb] = part
+        lastPos = pos
+        if nb == maxNb then break end
+    end
+    if nb ~= maxNb then result[nb + 1] = string.sub(str, lastPos) end
+    return result
+end
+
+
+--[[
+    @name   mysql_query
+    @author Mijago
+    @needs  split
+    @descr
+Mysql-Funktion der neuesten Generation.
+--]]
+mysql_query = function(query)
+    if not pre then
+        local rt = io.open('CONFIG','r'):read('*all')
+        pre,_= string.gsub(rt,'.+PLAYER_SQL:%s(%S+)%s(%S+)%s(%S+)%s(%S+).+','-h%1 -u%2 -p%3 -D%4')
+    end
+    math.randomseed(os.time())
+    local fi,t,out = 'mysql_data_'..math.random(10^9)+math.random(2^4,2^10),{},{}
+    -- os.execute('mysql '..pre..' --e='..string.format('%q',query)..' > '..fi) -- fr MySQL51
+    os.execute('mysql '..pre..' -e'..string.format('%q',query)..' > '..fi) -- fr MySQL55
+    for av in io.open(fi,'r'):lines() do table.insert(t,split(av,'\t')) end; os.remove(fi);
+    for i = 2, table.getn(t) do table.foreach(t[i],function(a,b)
+        out[i-1]               = out[i-1] or {}
+        out[i-1][a]            = tonumber(b) or b or 'NULL'
+        out[t[1][a]]           = out[t[1][a]] or {}
+        out[t[1][a]][i-1]      = tonumber(b) or b or 'NULL'
+    end) end
+    return out
+end
+
+-- mysql_query = function(query)
+    -- math.randomseed(os.time())
+    -- local fi,t,out = 'mysql_data_'..math.random(10^9)+math.random(2^4,2^10),{},{}
+    -- os.execute('mysql --login-path=local -e'..string.format('%q',query)..' > '..fi)
+    -- for av in io.open(fi,'r'):lines() do table.insert(t,split(av,'\t')) end; os.remove(fi);
+    -- for i = 2, table.getn(t) do 
+        -- table.foreach(t,function(a,b)
+        -- out[i-1]               = out[i-1] or {}
+        -- out[i-1][a]            = tonumber(b) or b or 'NULL'
+        -- out[t[1][a]]           = out[t[1][a]] or {}
+        -- out[t[1][a]][i-1]      = tonumber(b) or b or 'NULL'
+        -- end)
+    -- end
+    -- out.__lines = t[1]
+    -- return out
+-- end
+
+--[[
+    @name   mysql_query_old
+    @author Mijago
+    @needs  split
+    @descr
+Die Alte Version der MySQL-Query-Funktion.
+--]]
+local ql = {
+    ["user"] = "root",
+    ["pass"] = "",
+    ["ip"] = "localhost",
+    ["db"]    = "player"
+}
+function mysql_query_old(query,user,pass,db,ip)
+    local pre = ''
+    if query == '' or query == nil then
+        error("Query muss gesetzt sein!")
+    end
+
+-- SQL escape helper for dynamic queries (prevents injection on name/account fields)
+function sql_escape(s)
+	s = tostring(s or "")
+	s = s:gsub("\\\\", "\\\\\\\\")
+	s = s:gsub("\0", "\\0")
+	s = s:gsub("\n", "\\n"):gsub("\r", "\\r")
+	s = s:gsub("\x1a", "\\Z")
+	s = s:gsub("'", "\\'")
+	return s
+end
+
+    user = user or ql.mysql["user"]
+    pass = pass or ql.mysql["pass"]
+    ip = ip or ql.mysql["ip"]
+    if user ~= '' and user ~= nil then pre = pre..' -u'..user end
+    if pass ~= '' and pass ~= nil then pre = pre..' -p'..pass end
+    if db ~= '' and db ~= nil then pre = pre..' -D'..db end
+    if ip ~= '' and ip ~= nil then pre = pre..' -h'..ip end
+    math.randomseed(os.time()); local rand = math.random(0,10^7) -- Erstellen der Pfadvariable
+    local path = 'data/mysql_output_'..os.time()..'_'..rand..'_'..pc.get_vid()
+    os.execute ("mysql "..pre.." --e=\""..query.."\" > "..path) -- Laden und Auflisten der Dateiinhalte
+    local fi,q = io.open(path,"r"),{["l"] = {},["out"]={}}
+    if fi == nil then
+        return "ERROR"
+    end
+    for line in fi:lines() do table.insert(q.l,(split(line,"\t"))) end
+    os.remove(path)
+    if type(q.l[1]) ~= "table" then 
+        return "ERROR"
+        --error("Fehler bei der MySQL Verbindung oder bei der Rckgabe! Abbruch!")
+    end
+    local ix = 0
+    table.foreachi(q.l,function(i,l)
+        if i > 1 then table.foreach(l,function(i2,l2)
+            if q.out[q.l[1][i2]] == nil then q.out[q.l[1][i2]] = {} end
+            local c =  tonumber(l2)
+            if type(c) == "number" and l2 == tostring(c) then
+                q.out[q.l[1][i2]][i-1] = c
+            else
+                q.out[q.l[1][i2]][i-1] = l2
+            end
+        end) end
+    end)
+    -- ENDE der eigentlichen MySQL-Funktion
+    -- START Zusatz: Hanashi-Kompatibilitt & Fehlerbehandlung
+    q.out.__data = q.l[1]
+    setmetatable(q.out, { __index = function(a,b) 
+        if type(b) == "number" then
+            return (a[a.__data[b]] or {"ERROR"})
+        end
+        return "ERROR"
+        --error("Fehler bei Indexierung: Index "..b.." ist nicht vorhanden!")
+    end})
+    return q.out
+end
+
+
+--[[
+    @name   define
+    @author Mijago
+    @descr
+Gibt die Mglichkeit, globale Variablen zu definieren. Es knnen auch Funktionen genutzt werden! Diese werden dann AUSGEFHRT zurckgegeben!
+--]]
+_G.__data = {}
+local meta = getmetatable(_G) or {}
+meta.__index = function(me,index) 
+    local data = _G.__data[index]
+    if type(data) == "function" then
+        return data()
+    else -- auch bei nil!
+        return data
+    end
+end    
+setmetatable(_G,meta)
+
+function define(name,func)  -- func is a function or some value
+    _G.__data[name] = func
+end
+
+
+--[[
+    @name   duration
+    @author Mijago
+    @descr
+Gibt die verbleibende Zeit als String zurck.
+--]]
+function duration(ipe) 
+    local ipe,dat= ipe or 0,''
+	local s,m,h,d,mo,y = tonumber(os.date('%S',ipe)),
+					  tonumber(os.date('%M',ipe)),
+					  tonumber(os.date('%H',ipe)),
+					  tonumber(os.date('%d',ipe))-1,
+					  tonumber(os.date('%m',ipe))-1,
+					  tonumber(os.date('%Y',ipe))-1970
+	for x,c in {{s,"Sek."},{m,"Min."},{h,"Std."},{d,"Tage","Tag"},{mo,"Monate","Monat"},{y,"Jahre","Jahr"}} do
+		if (c[1] or 0) > 0 then
+			if x > 1 then dat = ' '..dat end
+            if c[1] > 1 then
+                dat = c[1]..' '..c[2]..dat
+            else 
+                dat = c[1]..' '..(c[3] or c[2])..dat
+            end
+		end
+	end	
+    return dat
+end 
+
+
+--[[
+    @name   is_number
+    @author Mijago
+    @descr
+Prft, ob eine Variable eine Zahl ist.
+--]]
+function is_number(var)
+    return (type(var) == "number")
+end	
+
+
+--[[
+    @name   is_string
+    @author Mijago
+    @descr
+Prft, ob eine Variable ein String ist.
+--]]
+function is_string(var)
+    return (type(var) == "string")
+end
+
+
+--[[
+    @name   is_table
+    @author Mijago
+    @descr
+Prft, ob eine Variable eine Tabelle ist.
+--]]
+function is_table(var)
+    return (type(var) == "table")
+end
+
+
+--[[
+    @name   in_table
+    @author Mijago
+    @descr
+Prft, ob eine Variablei in einer Tabelle ist.
+Aufruf: in_table(var,table)
+--]]
+function in_table ( e, t )
+    for _,v in pairs(t) do
+        if (v==e) then 
+            return true 
+        end
+    end
+    return false
+end
+
+
+--[[
+    @name   numlen
+    @author Mijago
+    @descr
+Gibt die Anzahl der Ziffern einer Zahl wieder.
+--]]
+function numlen(i)
+    local i,x = i or 0,0
+    while i > 10^x do x=x+1 end
+    return x
+end
+
+
+--[[
+    @name   string.reverse
+    @author Mijago
+    @descr
+Kehrt einen String um.
+--]]
+function string.reverse(str)
+    local se = ''
+    for i=1,string.len(str) do
+        se = string.sub(str,i,i)..se
+    end
+    return se
+end
+
+
+--[[
+    @name   num_format
+    @author Mijago; Idee von Benhero
+    @needs  string.reverse
+    @descr
+Formatiert lange Zahlen mit Punkten.
+
+--]]
+function num_format(num)
+    if type(num) == "number" then num = tostring(num) end
+    if string.len(num) <= 3 then return num end
+    return string.reverse(string.gsub(string.reverse(num),'(%d%d%d)','%1.'))
+end
+
+
+--[[
+    @name   numtomoney
+    @author Mijago
+    @descr
+Formatiert zB 1234567 in 1.234.567.
+--]]
+function numtomoney(num)
+    local num,out,x = tostring(num),'',0
+    while string.len(num)-3 > 0 do
+        out = string.gsub(num,'.-(%d%d%d)$','.%1')..out
+        num = string.sub(num,0,string.len(num)-3)
+    end
+    return num..out
+end
+
+
+--[[
+    @name   math.minmax
+    @author Mijago
+    @descr
+Ermglicht die Angabe von min und max auf einmal
+--]]
+math.minmax = function(min,num,max)
+    return math.min(math.max(num,min),max)
+    -- oder:  return num > max and max or num < min and min or num
+end
+
+
+--[[
+    @name   n_input
+    @author Mijago
+    @descr
+Fr Inputs nur fr Zahlen.
+Die Zahl ist IMMER positiv. Wenn sie nicht gltig ist, ist sie 0.
+--]]
+function n_input()
+    return math.abs(tonumber(input()) or 0)
+end
+
+
+--[[
+    @name   long_input
+    @author Mijago
+    @descr
+Ermglicht es, lngere Inputs zu nutzen.
+--]]
+function long_input()
+    local str,t = "",input()
+    while t ~= "" do
+        str = str..t
+        t = input()
+    end
+    return str, str ~= ""
+end
+
+
+--[[
+    @name   select2
+    @author Mijago
+    @needs  split
+    @descr
+Wie Select:
+Eine Tabelle oder eine  Stringliste wird auf Seiten aufgeteilt.
+Weiter und Abbrechen Buttons.
+--]]
+function select2(tab,...)
+    arg.n = nil
+    if type(tab) ~= "table" and type(tab) == 'number' then
+        table.insert(arg,1,tab)
+        tab = arg
+    elseif type(tab) ~= "table" and type(tab) == 'string' then
+        table.insert(arg,1,tab)
+        table.insert(arg,1,8)
+        tab = arg
+    elseif type(tab) == "table" and type(tab[1]) == 'string' then
+        table.insert(tab,1,8)
+    end
+    local max = tab[1]; table.remove(tab,1)
+    local tablen,outputstr,outputcount,nextc,incit = table.getn(tab),"",0,0,0
+    table.foreach(tab,
+        function(i,l)
+            outputcount = outputcount + 1
+            if outputcount == 1 then
+                outputstr=outputstr..'sel = select("'..l..'"'
+            elseif outputcount == max and tablen > outputcount+incit  then
+                if tablen ~= outputcount+incit+1 then
+                    outputstr=outputstr..',"'..l..'","Nchste Seite") + '..incit..' '
+                    if nextc > 0 then
+                        outputstr = outputstr..'end '
+                    end
+                    outputstr=outputstr..'; if sel == '..(incit+max+1)..' then '        -- Anfangen der neuen Abfrage
+                    nextc, outputcount, incit= nextc+1,0,incit+max
+                else
+                    outputstr=outputstr..',"'..l..'"'
+                end
+            else
+                outputstr=outputstr..',"'..l..'"'
+            end
+        end
+    )
+    outputstr = outputstr..') + '..incit
+    if nextc > 0 then
+        outputstr = outputstr..' end'
+    end
+    outputstr= outputstr.. '; return sel'
+    print(outputstr)
+    local sel = assert(loadstring(outputstr))()
+    tablen,outputstr,outputcount,nextc,incit = nil,nil,nil,nil,nil -- Speicher freimachen
+    return sel
+end
+
+
+
+--[[
+    @name   select3
+    @author Mijago
+    @needs  split
+    @descr
+Wie Select2:
+Eine Tabelle oder eine  Stringliste wird auf Seiten aufgeteilt.
+Weiter, Zurck und Abbrechen (-1) Buttons.
+--]]
+function select3(...)
+    arg.n = nil
+    local tp,max = arg,5
+    if type(tp[1]) == 'number' then
+        max = tp[1]
+        if type(tp[2]) == 'table' then
+            tp = tp[2]
+        else
+            table.remove(tp,1)
+        end
+    elseif type(tp[1]) == 'table' then
+        if type(tp[1][1]) == 'number' then
+            max = tp[1][1]
+            table.remove(tp[1],1)
+            tp = tp[1]
+        end
+        tp = tp[1]
+    end
+    local str = '{'
+    local tablen,act,incit = table.getn(tp),0,0
+    table.foreach(tp,function(i,l)
+        act = act + 1
+        if act == 1 then
+            str = str .. '{'..string.format('%q',l)
+        elseif act == max+1 and tablen > act+incit then
+            if tablen ~= act+incit+1 then
+                str = str..'},{'..string.format('%q',l)
+            else
+                str=str..','..string.format('%q',l)
+            end
+            incit = incit + max
+            act = 1
+        else
+            str=str..','..string.format('%q',l)
+        end
+    end)
+    local px = loadstring('return '..str ..'}}')()
+    local function copy_tab(t) local p= {} for i = 1,table.getn(t) do p[i] = t[i] end return p end
+    local pe = {}
+    for i = 1,table.getn(px) do pe [i] = copy_tab(px[i]) end
+    local function init(i,ip)
+        pe[i] = copy_tab(px[i])
+        local next,back,exit = 0,0,0
+        if i < table.getn(pe) and table.getn(pe) ~=1 then  table.insert(pe[i],table.getn(pe[i])+1,'Weiter zu Seite '..(i+1)); next = table.getn(pe[i]) end
+        if i > 1 then table.insert(pe[i],table.getn(pe[i])+1,'Zurck zu Seite '..(i-1)); back = table.getn(pe[i]) end
+        table.insert(pe[i],table.getn(pe[i])+1,'Abbruch'); exit = table.getn(pe[i])
+        if table.getn(pe) > 1 then
+            say('Seite '..i..' von '..table.getn(pe))
+        end
+        local e = select_table(pe[i])
+        if e == next then return init(i+1,ip+max)
+        elseif e == back then return init(i-1,ip-max)
+        elseif e == exit then return -1
+        else return e+ip,pe[i][e] end
+    end
+    return init(1,0) or -1
+end
+
+
+--[[
+    @name   note (Notice Mod)
+    @author Mijago
+    @descr
+Wie Notice, nur mit Spielername davor.
+--]]
+function note(text)
+    notice_all(pc.get_name()..': '..text)
+end
+
+
+--[[
+    @name   Zeitrechnungen
+    @author Mijago
+    @descr
+Funktionen zum Umrechenen von Zeit.
+--]]
+zt = zt or {}
+zt.d_j = 	function(d)
+                return d/365
+            end
+zt.d_mo = 	function(d)
+                return d/12
+            end
+zt.d_h = 	function(d)
+                return d*24
+            end
+zt.d_m = 	function(d)
+                return d*24*60
+            end
+zt.d_s = 	function(d)
+                return d*24*60*60
+            end
+zt.d_hs = 	function(d)
+                return d*24*60*60*100
+            end
+zt.d_ms = 	function(d)
+                return d*24*60*60*1000
+            end
+--- Stunden
+zt.h_j = 	function(h)
+                return h/24/365
+            end
+zt.h_mo = 	function(h)
+                return h/24/12
+            end
+zt.h_d = 	function(h)
+                return h/24
+            end
+zt.h_m = 	function(h)
+                return h*60
+            end
+zt.h_s = 	function(h)
+                return h*60*60
+            end
+zt.h_hs = 	function(h)
+                return h*60*60*100
+            end
+zt.h_ms = 	function(h)
+                return h*60*60*1000
+            end
+--- Minuten
+zt.m_j = 	function(m)
+                return m/60/24/365
+            end
+zt.m_mo = 	function(m)
+                return m/60/24/12
+            end
+zt.m_d = 	function(m)
+                return m/60/24
+            end
+zt.m_h = 	function(m)
+                return m/60
+            end
+zt.m_s = 	function(m)
+                return m*60
+            end
+zt.m_hs = 	function(m)
+                return m*60*100
+            end
+zt.m_ms = 	function(m)
+                return m*60*1000
+            end
+--- Sekunden
+zt.s_j = 	function(s)
+                return s/60/60/24/365
+            end
+zt.s_mo = 	function(s)
+                return s/60/60/24/12
+            end
+zt.s_d = 	function(s)
+                return s/60/60/24
+            end
+zt.s_h = 	function(s)
+                return s/60/60
+            end
+zt.s_m = 	function(s)
+                return s/60
+            end
+zt.s_hs = 	function(s)
+                return s*100
+            end
+zt.s_ms = 	function(s)
+                return s*1000
+            end	
+
+
+--[[
+    @name   Autoumbruch in Say
+    @author Mijago
+    @descr
+Fgt die Funktion say2 an. 
+Mit ihr werden Texte automatisch umgebrochen.
+--]]
+function say2(str,dx) 
+    local maxl,actl,pat = dx or 50,0,'(.-)(%[.-%])()' 
+    local result,nb,lastPos,outp = {},0,0,'' 
+    local function bere(stx) 
+        for le in string.gfind(stx,'((%S+)%s*)') do  
+            if actl + string.len(le) > maxl then  
+                outp = outp..'[ENTER]'  
+                actl = 0  
+            end  
+            outp = outp..le  
+            actl = actl + string.len(le)  
+        end  
+    end 
+    for part, dos,pos in string.gfind(str, pat) do  
+        if part ~= '' then  
+            bere(part) 
+        end 
+        outp = outp..dos  
+        lastPos = pos  
+    end  
+    bere(string.sub(str,lastPos)) 
+    say(outp) 
+end 
+
+
+--[[
+    @name   mysql_escape
+    @author Mijago
+    @descr
+Wie mysql_real_escape_string in PHP;
+Hilft, SQLi vorzubeugen.
+--]]
+function mysql_escape(str)
+    str = string.gsub(str,"%\\", "\\\\")
+--    str = string.gsub(str,"%\0", "\\0") Gibt einen fehler aus :o | Wer rausfindet, warum.. Bitte mir Schreiben (Mijago)
+    str = string.gsub(str,"%\n", "\\n")
+    str = string.gsub(str,"%\r", "\\r")
+    str = string.gsub(str,"%\x1a", "\Z")
+    str = string.gsub(str,"%\'", "\\'")
+    str = string.gsub(str,'%\"', '\\"')
+    return str
+end
+
+
+--[[
+    @name   account.set_pw
+    @author Mijago; Idee von Benhero
+    @needs  mysql_query
+    @descr
+Funktion zum ndern des Nutzerpasswortes.
+Angabe des Accounts kann weggelassen werden, als Accountname oder als Account ID angegeben werden.
+--]]
+account = account or {}
+function account.set_pw(pw,ac)
+    if pw == nil then error("Fehler... Passwort muss gesetzt werden!") end
+    local ac = ac or pc.get_account_id() 
+	local ac_esc = sql_escape(ac)
+    if type(ac) == "string" then
+		mysql_query("UPDATE player.player,account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = player.account_id and player.name = '"..ac_esc.."' LIMIT 1")
+    elseif type(ac) == "number" then
+        mysql_query("UPDATE account.account SET account.password = password("..string.format('%q',pw)..") WHERE account.id = "..ac)
+    end
+    end
+end 
+
+
+--[[
+    @name   pc.check_inventory_place
+    @author Mijago
+    @descr
+Checkt auf Freie Inventarpltze fr Items der gre X (Hhe).
+--]]
+function pc.check_inventory_place(size)
+    if size <= 0 or size > 3 then
+        return -1
+    end
+    function check(c)
+        for i = 0,size-1 do
+            item.select_cell(e[c+(5*i)])
+            if item.get_id() ~= 0 then
+                return false
+            end
+        end
+        return true
+    end
+    for i = 0,89 do 
+        if check(i) then 
+            return i 
+        end
+    end
+    return -1
+end
+
+
+--[[
+    @name   do_for_other
+    @author Mijago
+    @descr
+Fhrt einen String als Luabefehle bei einem anderem User aus.
+--]]
+function do_for_other(name,ding)
+    local t = pc.select(find_pc_by_name(name))
+    assert(loadstring(ding))()
+    pc.select(t)
+end
+
+
+--[[
+    @name   local_pc_setqf
+    @author Mijago
+    @descr
+Setzt die Questflag eines anderen Spielers.
+--]]
+function local_pc_setqf(name, qf,wert) -- Fr die aktuelle Quest
+    local target = find_pc_by_name(name)
+    local t = pc.select(target)
+    pc.setqf(qf,wert)
+    pc.select(t)
+end
+
+
+--[[
+    @name   pc.trans
+    @author Mijago
+    @descr
+Warpt Spieler B zu Spieler A.
+Spieler a = pc.
+--]]
+function pc.trans(vid)
+    if vid == nil then
+        error"VID muss gesetzt sein! (pc.warp_to)"
+    elseif type(vid) == "string" then
+        vid = find_pc_by_name(vid)
+        if vid == 0 then
+            error"Spieler nicht gefunden"
+        end
+    end
+    local x,y = pc.get_x()*100,pc.get_y()*100
+    local me = pc.select(vid)
+    pc.warp(x,y)
+    pc.select(me)
+end
+
+
+--[[
+    @name   pc.warp_to
+    @author Mijago
+    @descr
+Warpt Spieler A zu Spieler B.
+Spieler a = pc.
+--]]
+function pc.warp_to(vid)
+    if vid == nil then
+        error"VID muss gesetzt sein! (pc.warp_to)"
+    elseif type(vid) == "string" then
+        vid = find_pc_by_name(vid)
+        if vid == 0 then
+            error"Spieler nicht gefunden"
+        end
+    end
+    local me = pc.select(vid)
+    local x,y = pc.get_x()*100,pc.get_y()*100
+    pc.select(me)
+    pc.warp(x,y)
+end
+
+
+--[[
+    @name   local_warp_pc
+    @author Mijago
+    @descr
+Warpt einen anderen Spieler lokal.
+--]]
+function local_pc_warp(name, x, y,mid)
+    local target = find_pc_by_name(name)
+    local t = pc.select(target)
+    if mid == nil then
+        mid = pc.get_map_index()
+    end
+    pc.warp_local(mid, x*100, y*100)
+    pc.select(t)
+end
+
+
+--[[
+    @name   download
+    @author Mijago
+    @descr
+Ldt eine Datei in den Data-Ordner.
+--]]
+function download(url) os.execute("cd data && fetch "..url.." && cd ..") end
+
+
+--[[
+    @name   dot
+    @author Mijago
+    @descr
+Fhrt alles Zwischen $ und $ im String aus.
+--]]
+function dot(x)
+    return string.gsub(x, "%$(.-)%$", function (s) return loadstring(s)() end) 
+end
+
+
+--[[
+    @name   dostr
+    @author Mijago
+    @descr
+Fhrt einen String als Lua-Befehl aus.
+--]]
+function dostr(str)
+    assert(loadstring(str))()
+end
+
+
+--[[
+    @name   wartungsmodus
+    @author Mijago
+    @needs  mysql_query
+    @descr
+Versetzt alle Accounts (auer GM-Accounts) in einen "Wartungsmodus" und wieder zurck.
+--]]
+function wartungsmodus(v)
+    if v == 1 or v == true then
+        mysql_query("UPDATE account.account SET account.status = 'SHUTDOWN' WHERE status = 'OK' and account.login NOT IN (SELECT mAccount FROM common.gmlist);")
+    else
+        mysql_query("UPDATE account.account SET account.status = 'OK' WHERE status = 'SHUTDOWN' and account.login NOT IN (SELECT mAccount FROM common.gmlist);")
+    end
+end
+
+
+--[[
+    @name   create_folder
+    @author Mijago 
+    @descr
+Erstellt Ordner, auch mit Unterordnern
+--]]
+create_folder = function(path)
+    local pp = ''
+    for i in string.gfind(path,'([%w_\-]*/)') do
+        pp = pp..i
+        os.execute('if [ ! -d '..pp..' ]; then mkdir '..pp..'; fi')
+    end
+end
+
+
+--[[
+    @name   INI-Parser
+    @author Mijago
+    @descr
+Ein NEUER Parser fr INI-Dateien.
+--]]
+ini = {
+    open = function(path)
+        return setmetatable({
+            path = path or "",
+        }, { __index = ini})
+    end,
+    write = function(self,section,key,value)
+        if not section or not key then return false end
+        local r,y = self:__get_text()
+        if not y then return false end
+        if string.find(r,"%["..section.."%]") then
+            if string.find(r,"%["..section.."%][^%[]*"..key.."=") then
+                r = string.gsub(r,"(%["..section.."%][^%[]*"..key.." *=)( *[^\n]+)",function(x)
+                    return x..value
+                end)
+            else
+                r = string.gsub(r,"(%["..section.."%][^%[]*)",function(x)
+                    return x.."\n"..key.."="..value.."\n"
+                end)
+            end
+        else
+            r = r.."\n["..section.."]\n"..key.."="..value
+        end
+        -- berflssige leerzeichen lschen
+        r=string.gsub(string.gsub(string.gsub(r,"^(\n)",""),"(\n)$",""),"\n\n","\n")
+        local d = io.open(self.path,"w")
+        d:write(r)
+        d:close()
+    end,
+    read = function(self,section,key,default_value)
+        local t,y = self:__get_text()
+        if not y then return false end
+        local _,_,data = string.find(t,"%["..section.."%][^%[]*"..key.." *= *([^\n]+)")
+        local output = (data or default_value)
+        return tonumber(output) or output,true
+    end,
+    remove_key = function(self,section,key)
+        local t,y = self:__get_text()
+        if not y then return false end
+        if string.find(t,"%["..section.."%][^%[]*"..key.." *=[^\n]+") then
+            local t2=string.gsub(t,"(%["..section.."%][^%[]*)"..key.." *=[^\n]+",function(x)
+                return x
+            end)
+            if t2 ~= t then
+                local d= io.open(self.path,"w")
+                d:write(t2)
+                d:close()
+            end
+        end
+        return true
+    end,
+    remove_section = function(self,section)
+        local t,y = self:__get_text()
+        if not y then return false end
+        if string.find(t,"%["..section.."%][^%[]*") then
+            t = string.gsub(t,"%["..section.."%][^%[]*","")
+            local d = io.open(self.path,"w")
+            d:write(t)
+            d:close()
+        end
+        return true
+    end,
+    __get_text = function(self)
+        local d = io.open(self.path,"r")
+        if not d then return "",false end
+        local t = d:read"*all"
+        d:close()
+        return t,true
+    end,
+}
+
+
+--[[
+    @name   Ini-Parser (alt)
+    @author Mijago
+    @needs  split
+    @descr
+-- OUTDATED --
+Ein Parser fr Ini-Dateien.
+Besitzt eine Eigene Beschreibung der einzelnen Funktionen im Code.
+--]]
+do
+    -- Funktionen:
+    -- var = ini.new() 
+    -- var = ini.open(path)
+    -- var:write_str(sub,name,wert)
+    -- var:write_int(sub,name,wert)
+    -- var:write_bool(sub,name,boolean)
+    -- var:clear()
+    -- var:read_str(sub,name,norm)   -- Gibt einen String zurck. -|
+    -- var:read_int(sub,name,norm)   -- Gibt eine Zahl zurck      -|  norm wird zurckgegeben, wenn sub[name] nicht existiert.
+    -- var:read_bool(sub,name,norm)  -- Gibt true / False zurck  -|
+    -- var:delete_key(sub,nm)
+    -- var:delete_section(sub)
+    local ini_f = {}
+    ini = {}
+    function ini_f:append(sub,nm,wert)
+        if nm == '' or nm == nil then
+            return
+        end
+        self:parse()
+        if self.sub[sub] == nil then self.sub[sub] = {} end
+        self.sub[sub][nm] = wert
+        self:writeit()
+    end
+    function ini_f:write_str(sub,nm,wert)
+        self:append(sub,nm,wert)
+    end
+    function ini_f:write_int(sub,nm,wert)
+        self:append(sub,nm,wert)
+    end
+    function ini_f:write_bool(sub,nm,bool)
+        if not type(bool) == "boolean" then
+            return
+        end
+        local bin = 0
+        if bool == true then bin = 1 end
+        self:append(sub,nm,bin)
+        return bin
+    end
+    function ini_f:clear()
+        self.sub = {}
+        self.path = ''
+    end
+    function ini_f:writeit()
+        local out = ''
+        table.foreach(self.sub,
+            function(i,l)
+                out = out..'['..i..']\n'
+                table.foreach(l,
+                    function(i2,l2)
+                        out=out..i2..'='..l2..'\n'
+                    end
+                )
+            end
+        )
+        local d = io.open(self.path,'w')
+        d:write(out)
+        d:close()
+    end
+    function ini_f:delete_key(sub,nm)
+        if sub == '' or nm == '' or sub == nil or nm == nil then return end
+        self:parse()
+        self.sub[sub][nm] = nil
+        self:writeit()
+    end
+    function ini_f:delete_section(sub)
+        if sub == '' or sub == nil then return end
+        self:parse()
+        self.sub[sub]= nil
+        self:writeit()
+    end
+    function ini_f:parse()
+        self.sub = {}
+        if self.path == '' or self.path == nil then return end
+        local d,i = io.open(self.path,"r"),'non'
+        if d == nil then d = io.open(self.path,"w") end
+        for line in d:lines() do
+            if string.sub(line,1,1) == "[" then
+                i = string.sub(line,2,string.len(line)-1)
+                self.sub[i] = {}
+            else
+                local inp = split(line,'=')
+                self.sub[i][inp[1]] = inp[2]
+            end
+        end
+        d:close()
+    end
+    function ini_f:read_str(sub,nm,norm)
+        if sub == '' or nm == '' or sub == nil or nm == nil then return end
+        self:parse()
+        if self.sub[sub] == nil then return norm end
+        if self.sub[sub][nm] == nil then return norm else return self.sub[sub][nm] end
+    end
+    function ini_f:read_int(sub,nm,norm)
+        if sub == '' or nm == '' or sub == nil or nm == nil then return end
+        self:parse()
+        if self.sub[sub] == nil then return norm end
+        if self.sub[sub][nm] == nil then return norm else return tonumber(self.sub[sub][nm]) end
+    end
+    function ini_f:read_bool(sub,nm,norm)   -- Norm wird zurckgegeben, wenn der Key nm nicht existiert
+        if sub == '' or nm == '' or sub == nil or nm == nil then return end
+        self:parse()
+        if self.sub[sub] == nil then return norm end
+        if self.sub[sub][nm] == nil then return norm end
+        if self.sub[sub][nm] == "1" then return true else return false end
+    end
+    function ini_f:open(path)
+        self.path = path
+        self:parse()
+    end
+    function ini.new()
+        local out = {}
+        out.path = ''
+        out.sub = {}
+        setmetatable(out, { __index = ini_f })
+        return out
+    end
+    function ini.open(path)
+        local dat = ini.new()
+        dat:clear()
+        dat.path=path
+        dat:open(path)
+        return dat
+    end
+end
+
+
+--[[
+    @name   csay
+    @author Mijago
+    @descr
+Wie die alten col-Befehle, sendet aber selbst.
+Also kein say(col.red('bla'))
+sondern
+csay.red('bla') reicht vllig aus.
+--]]
+csay = setmetatable({__d = {
+        ["aliceblue"] = {240, 248, 255},     ["antiquewhite"] = {250, 235, 215},    ["aqua"] = {0, 255, 255},                   ["aquamarine"] = {127, 255, 212},
+        ["azure"] = {240, 255, 255},         ["beige"] = {245, 245, 220},           ["bisque"] = {255, 228, 196},               ["black"] = {0, 0, 0},
+        ["blanchedalmond"] = {255, 235, 205},["blue"] = {0, 0, 255},                ["blueviolet"] = {138, 43, 226},            ["brown"] = {165, 42, 42},
+        ["burlywood"] = {222, 184, 135},     ["cadetblue"] = {95, 158, 160},        ["chartreuse"] = {127, 255, 0},             ["chocolate"] = {210, 105, 30},
+        ["coral"] = {255, 127, 80},          ["cornflowerblue"] = {100, 149, 237},  ["cornsilk"] = {255, 248, 220},             ["crimson"] = {220, 20, 60},
+        ["cyan"] = {0, 255, 255},            ["darkblue"] = {0, 0, 139},            ["darkcyan"] = {0, 139, 139},               ["darkgoldenrod"] = {184, 134, 11},
+        ["darkgray"] = {169, 169, 169},      ["darkgreen"] = {0, 100, 0},           ["darkkhaki"] = {189, 183, 107},            ["darkmagenta"] = {139, 0, 139},
+        ["darkolivegreen"] = {85, 107, 47},  ["darkorange"] = {255, 140, 0},        ["darkorchid"] = {153, 50, 204},            ["darkred"] = {139, 0, 0},
+        ["darksalmon"] = {233, 150, 122},    ["darkseagreen"] = {143, 188, 139},    ["darkslateblue"] = {72, 61, 139},          ["darkslategray"] = {47, 79, 79},
+        ["darkturquoise"] = {0, 206, 209},   ["darkviolet"] = {148, 0, 211},        ["deeppink"] = {255, 20, 147},              ["deepskyblue"] = {0, 191, 255},
+        ["dimgray"] = {105, 105, 105},       ["dodgerblue"] = {30, 144, 255},       ["firebrick"] = {178, 34, 34},              ["floralwhite"] = {255, 250, 240},
+        ["forestgreen"] = {34, 139, 34},     ["fuchsia"] = {255, 0, 255},           ["gainsboro"] = {220, 220, 220},            ["ghostwhite"] = {248, 248, 255},
+        ["gold"] = {255, 215, 0},            ["goldenrod"] = {218, 165, 32},        ["gray"] = {128, 128, 128},                 ["green"] = {0, 128, 0},
+        ["greenyellow"] = {173, 255, 47},    ["honeydew"] = {240, 255, 240},        ["hotpink"] = {255, 105, 180},              ["indianred"] = {205, 92, 92},
+        ["indigo"] = {75, 0, 130},           ["ivory"] = {255, 255, 240},           ["khaki"] = {240, 230, 140},                ["lavender"] = {230, 230, 250},
+        ["lavenderblush"] = {255, 240, 245}, ["lawngreen"] = {124, 252, 0},         ["lemonchiffon"] = {255, 250, 205},         ["lightblue"] = {173, 216, 230},
+        ["lightcoral"] = {240, 128, 128},    ["lightcyan"] = {224, 255, 255},       ["lightgoldenrodyellow"] = {250, 250, 210}, ["lightgray"] = {211, 211, 211},
+        ["lightgreen"] = {144, 238, 144},    ["lightpink"] = {255, 182, 193},       ["lightsalmon"] = {255, 160, 122},          ["lightseagreen"] = {32, 178, 170},
+        ["lightskyblue"] = {135, 206, 250},  ["lightslategray"] = {119, 136, 153},  ["lightsteelblue"] = {176, 196, 222},       ["lightyellow"] = {255, 255, 224},
+        ["lime"] = {0, 255, 0},              ["limegreen"] = {50, 205, 50},         ["linen"] = {250, 240, 230},                ["magenta"] = {255, 0, 255},
+        ["maroon"] = {128, 0, 0},            ["mediumaquamarine"] = {102, 205, 170},["mediumblue"] = {0, 0, 205},               ["mediumorchid"] = {186, 85, 211},
+        ["mediumpurple"] = {147, 112, 219},  ["mediumseagreen"] = {60, 179, 113},   ["mediumslateblue"] = {123, 104, 238},      ["mediumspringgreen"] = {0, 250, 154},
+        ["mediumturquoise"] = {72, 209, 204},["mediumvioletred"] = {199, 21, 133},  ["midnightblue"] = {25, 25, 112},           ["mintcream"] = {245, 255, 250},
+        ["mistyrose"] = {255, 228, 225},     ["moccasin"] = {255, 228, 181},        ["navajowhite"] = {255, 222, 173},          ["navy"] = {0, 0, 128},
+        ["oldlace"] = {253, 245, 230},       ["olive"] = {128, 128, 0},             ["olivedrab"] = {107, 142, 35},             ["orange"] = {255, 165, 0},
+        ["orangered"] = {255, 69, 0},        ["orchid"] = {218, 112, 214},          ["palegoldenrod"] = {238, 232, 170},        ["palegreen"] = {152, 251, 152},
+        ["paleturquoise"] = {175, 238, 238}, ["palevioletred"] = {219, 112, 147},   ["papayawhip"] = {255, 239, 213},           ["peachpuff"] = {255, 218, 185},
+        ["peru"] = {205, 133, 63},           ["pink"] = {255, 192, 203},            ["plum"] = {221, 160, 221},                 ["powderblue"] = {176, 224, 230},
+        ["purple"] = {128, 0, 128},          ["red"] = {255, 0, 0},                 ["rosybrown"] = {188, 143, 143},            ["royalblue"] = {65, 105, 225},
+        ["saddlebrown"] = {139, 69, 19},     ["salmon"] = {250, 128, 114},          ["sandybrown"] = {244, 164, 96},            ["seagreen"] = {46, 139, 87},
+        ["seashell"] = {255, 245, 238},      ["sienna"] = {160, 82, 45},            ["silver"] = {192, 192, 192},               ["skyblue"] = {135, 206, 235},
+        ["slateblue"] = {106, 90, 205},      ["slategray"] = {112, 128, 144},       ["snow"] = {255, 250, 250},                 ["springgreen"] = {0, 255, 127},
+        ["steelblue"] = {70, 130, 180},      ["tan"] = {210, 180, 140},             ["teal"] = {0, 128, 128},                   ["thistle"] = {216, 191, 216},
+        ["tomato"] = {255, 99, 71},          ["turquoise"] = {64, 224, 208},        ["violet"] = {238, 130, 238},               ["wheat"] = {245, 222, 179},
+        ["white"] = {255, 255, 255},         ["whitesmoke"] = {245, 245, 245},      ["yellow"] = {255, 255, 0},                 ["yellowgreen"] = {154, 205, 50}
+    }},{
+        __index = function(tab,idx)
+            local color = tab.__d[idx] or {0,0,0}
+            return function(x) say('[COLOR r;'..(color[1]/255)..'|g;'..(color[2]/255)..'|b;'..(color[3]/255)..']'..x..'[/COLOR]') end
+        end
+})
+
+
+--[[
+    @name   Farbcodes
+    @author Mijago
+    @descr
+Farbcodes fr Say
+--]]
+col = col or {}
+col.list= {
+{ 'lightcoral', 240,128,128 },{ 'rosybrown', 188,143,143 },
+{ 'indianred', 205,92,92 },{ 'red', 255,0,0 },{ 'firebrick', 178,34,34 },{ 'brown', 165,42,42 },
+{ 'darkred', 139,0,0 },{ 'maroon', 128,0,0 },{ 'mistyrose', 255,228,225 },{ 'salmon', 250,128,114 },
+{ 'tomato', 255,99,71 },{ 'darksalmon', 233,150,122 },{ 'coral', 255,127,80 },{ 'orangered', 255,69,0 },
+{ 'lightsalmon', 255,160,122 },{ 'sienna', 160,82,45 },{ 'seashell', 255,245,238 },{ 'chocolate', 210,105,30 },
+{ 'saddlebrown', 139,69,19 },{ 'sandybrown', 244,164,96 },{ 'peachpuff', 255,218,185 },{ 'peru', 205,133,63 },
+{ 'linen', 250,240,230 },{ 'bisque', 255,228,196 },{ 'darkorange', 255,140,0 },{ 'burlywood', 222,184,135 },
+{ 'antiquewhite', 250,235,215 },{ 'tan', 210,180,140 },{ 'navajowhite', 255,222,173 },{ 'blanchedalmond', 255,235,205 },
+{ 'papayawhip', 255,239,213 },{ 'moccasin', 255,228,181 },{ 'orange', 255,165,0 },{ 'wheat', 245,222,179 },
+{ 'oldlace', 253,245,230 },{ 'floralwhite', 255,250,240 },{ 'darkgoldenrod', 184,134,11 },{ 'goldenrod', 218,165,32 },
+{ 'cornsilk', 255,248,220 },{ 'gold', 255,215,0 },{ 'lemonchiffon', 255,250,205 },{ 'khaki', 240,230,140 },
+{ 'palegoldenrod', 238,232,170 },{ 'darkkhaki', 189,183,107 },{ 'ivory', 255,255,240 },{ 'lightyellow', 255,255,224 },
+{ 'beige', 245,245,220 },{ 'lightgoldenrodyellow', 250,250,210 },{ 'yellow', 255,255,0 },{ 'olive', 128,128,0 },
+{ 'olivedrab', 107,142,35 },{ 'yellowgreen', 154,205,50 },{ 'darkolivegreen', 85,107,47 },{ 'greenyellow', 173,255,47 },
+{ 'chartreuse', 127,255,0 },{ 'lawngreen', 124,252,0 },{ 'darkseagreen', 143,188,139 },{ 'honeydew', 240,255,240 },
+{ 'palegreen', 152,251,152 },{ 'lightgreen', 144,238,144 },{ 'lime', 0,255,0 },{ 'limegreen', 50,205,50 },
+{ 'forestgreen', 34,139,34 },{ 'green', 0,128,0 },{ 'darkgreen', 0,100,0 },{ 'seagreen', 46,139,87 },
+{ 'mediumseagreen', 60,179,113 },{ 'springgreen', 0,255,127 },{ 'mintcream', 245,255,250 },{ 'mediumspringgreen', 0,250,154 },
+{ 'mediumaquamarine', 102,205,170 },{ 'aquamarine', 127,255,212 },{ 'turquoise', 64,224,208 },{ 'lightseagreen', 32,178,170 },
+{ 'mediumturquoise', 72,209,204 },{ 'azure', 240,255,255 },{ 'lightcyan', 224,255,255 },{ 'paleturquoise', 175,238,238 },
+{ 'aqua', 0,255,255 },{ 'cyan', 0,255,255 },{ 'darkcyan', 0,139,139 },{ 'teal', 0,128,128 },
+{ 'darkslategray', 47,79,79 },{ 'darkturquoise', 0,206,209 },{ 'cadetblue', 95,158,160 },{ 'powderblue', 176,224,230 },
+{ 'lightblue', 173,216,230 },{ 'deepskyblue', 0,191,255 },{ 'skyblue', 135,206,235 },{ 'lightskyblue', 135,206,250 },
+{ 'steelblue', 70,130,180 },{ 'aliceblue', 240,248,255 },{ 'dodgerblue', 30,144,255 },{ 'lightslategray', 119,136,153 },
+{ 'slategray', 112,128,144 },{ 'lightsteelblue', 176,196,222 },{ 'cornflowerblue', 100,149,237 },{ 'royalblue', 65,105,225 },
+{ 'ghostwhite', 248,248,255 },{ 'lavender', 230,230,250 },{ 'blue', 0,0,255 },{ 'mediumblue', 0,0,205 },
+{ 'darkblue', 0,0,139 },{ 'midnightblue', 25,25,112 },{ 'navy', 0,0,128 },{ 'slateblue', 106,90,205 },
+{ 'darkslateblue', 72,61,139 },{ 'mediumslateblue', 123,104,238 },{ 'mediumpurple', 147,112,219 },{ 'blueviolet', 138,43,226 },
+{ 'indigo', 75,0,130 },{ 'darkorchid', 153,50,204 },{ 'darkviolet', 148,0,211 },{ 'mediumorchid', 186,85,211 },
+{ 'thistle', 216,191,216 },{ 'plum', 221,160,221 },{ 'violet', 238,130,238 },{ 'fuchsia', 255,0,255 },
+{ 'magenta', 255,0,255 },{ 'darkmagenta', 139,0,139 },{ 'purple', 128,0,128 },{ 'orchid', 218,112,214 },
+{ 'mediumvioletred', 199,21,133 },{ 'deeppink', 255,20,147 },{ 'hotpink', 255,105,180 },{ 'lavenderblush', 255,240,245 },
+{ 'palevioletred', 219,112,147 },{ 'crimson', 220,20,60 },{ 'pink', 255,192,203 },{ 'lightpink', 255,182,193 },
+{ 'white', 255,255,255 },{ 'snow', 255,250,250 },{ 'whitesmoke', 245,245,245 },{ 'gainsboro', 220,220,220 },
+{ 'lightgray', 211,211,211 },{ 'silver', 192,192,192 },{ 'darkgray', 169,169,169 },{ 'gray', 128,128,128 },
+{ 'dimgray', 105,105,105 },{ 'black', 0,0,0 },{ 'aliceblue', 240,248,255 },{ 'antiquewhite', 250,235,215 },
+{ 'aqua', 0,255,255 },{ 'aquamarine', 127,255,212 },{ 'azure', 240,255,255 },{ 'beige', 245,245,220 },
+{ 'bisque', 255,228,196 },{ 'black', 0,0,0 },{ 'blanchedalmond', 255,235,205 },{ 'blue', 0,0,255 },
+{ 'blueviolet', 138,43,226 },{ 'brown', 165,42,42 },{ 'burlywood', 222,184,135 },{ 'cadetblue', 95,158,160 },
+{ 'chartreuse', 127,255,0 },{ 'chocolate', 210,105,30 },{ 'coral', 255,127,80 },{ 'cornflowerblue', 100,149,237 },
+{ 'cornsilk', 255,248,220 },{ 'crimson', 220,20,60 },{ 'cyan', 0,255,255 },{ 'darkblue', 0,0,139 },
+{ 'darkcyan', 0,139,139 },{ 'darkgoldenrod', 184,134,11 },{ 'darkgray', 169,169,169 },{ 'darkgreen', 0,100,0 },
+{ 'darkkhaki', 189,183,107 },{ 'darkmagenta', 139,0,139 },{ 'darkolivegreen', 85,107,47 },{ 'darkorange', 255,140,0 },
+{ 'darkorchid', 153,50,204 },{ 'darkred', 139,0,0 },{ 'darksalmon', 233,150,122 },{ 'darkseagreen', 143,188,139 },
+{ 'darkslateblue', 72,61,139 },{ 'darkslategray', 47,79,79 },{ 'darkturquoise', 0,206,209 },{ 'darkviolet', 148,0,211 },
+{ 'deeppink', 255,20,147 },{ 'deepskyblue', 0,191,255 },{ 'dimgray', 105,105,105 },{ 'dodgerblue', 30,144,255 },
+{ 'firebrick', 178,34,34 },{ 'floralwhite', 255,250,240 },{ 'forestgreen', 34,139,34 },{ 'fuchsia', 255,0,255 },
+{ 'gainsboro', 220,220,220 },{ 'ghostwhite', 248,248,255 },{ 'gold', 255,215,0 },{ 'goldenrod', 218,165,32 },
+{ 'gray', 128,128,128 },{ 'green', 0,128,0 },{ 'greenyellow', 173,255,47 },{ 'honeydew', 240,255,240 },
+{ 'hotpink', 255,105,180 },{ 'indianred', 205,92,92 },{ 'indigo', 75,0,130 },{ 'ivory', 255,255,240 },
+{ 'khaki', 240,230,140 },{ 'lavender', 230,230,250 },{ 'lavenderblush', 255,240,245 },{ 'lawngreen', 124,252,0 },
+{ 'lemonchiffon', 255,250,205 },{ 'lightblue', 173,216,230 },{ 'lightcoral', 240,128,128 },{ 'lightcyan', 224,255,255 },
+{ 'lightgoldenrodyellow', 250,250,210 },{ 'lightgray', 211,211,211 },{ 'lightgreen', 144,238,144 },{ 'lightpink', 255,182,193 },
+{ 'lightsalmon', 255,160,122 },{ 'lightseagreen', 32,178,170 },{ 'lightskyblue', 135,206,250 },{ 'lightslategray', 119,136,153 },
+{ 'lightsteelblue', 176,196,222 },{ 'lightyellow', 255,255,224 },{ 'lime', 0,255,0 },{ 'limegreen', 50,205,50 },
+{ 'linen', 250,240,230 },{ 'magenta', 255,0,255 },{ 'maroon', 128,0,0 },{ 'mediumaquamarine', 102,205,170 },
+{ 'mediumblue', 0,0,205 },{ 'mediumorchid', 186,85,211 },{ 'mediumpurple', 147,112,219 },{ 'mediumseagreen', 60,179,113 },
+{ 'mediumslateblue', 123,104,238 },{ 'mediumspringgreen', 0,250,154 },{ 'mediumturquoise', 72,209,204 },{ 'mediumvioletred', 199,21,133 },
+{ 'midnightblue', 25,25,112 },{ 'mintcream', 245,255,250 },{ 'mistyrose', 255,228,225 },{ 'moccasin', 255,228,181 },
+{ 'navajowhite', 255,222,173 },{ 'navy', 0,0,128 },{ 'oldlace', 253,245,230 },{ 'olive', 128,128,0 },
+{ 'olivedrab', 107,142,35 },{ 'orange', 255,165,0 },{ 'orangered', 255,69,0 },{ 'orchid', 218,112,214 },
+{ 'palegoldenrod', 238,232,170 },{ 'palegreen', 152,251,152 },{ 'paleturquoise', 175,238,238 },{ 'palevioletred', 219,112,147 },
+{ 'papayawhip', 255,239,213 },{ 'peachpuff', 255,218,185 },{ 'peru', 205,133,63 },{ 'pink', 255,192,203 },
+{ 'plum', 221,160,221 },{ 'powderblue', 176,224,230 },{ 'purple', 128,0,128 },{ 'red', 255,0,0 },
+{ 'rosybrown', 188,143,143 },{ 'royalblue', 65,105,225 },{ 'saddlebrown', 139,69,19 },{ 'salmon', 250,128,114 },
+{ 'sandybrown', 244,164,96 },{ 'seagreen', 46,139,87 },{ 'seashell', 255,245,238 },{ 'sienna', 160,82,45 },
+{ 'silver', 192,192,192 },{ 'skyblue', 135,206,235 },{ 'slateblue', 106,90,205 },{ 'slategray', 112,128,144 },
+{ 'snow', 255,250,250 },{ 'springgreen', 0,255,127 },{ 'steelblue', 70,130,180 },{ 'tan', 210,180,140 },
+{ 'teal', 0,128,128 },{ 'thistle', 216,191,216 },{ 'tomato', 255,99,71 },{ 'turquoise', 64,224,208 },
+{ 'violet', 238,130,238 },{ 'wheat', 245,222,179 },{ 'white', 255,255,255 },{ 'whitesmoke', 245,245,245 },
+{ 'yellow', 255,255,0 },{ 'yellowgreen', 154,205,50 }}
+table.foreachi(col.list,function(a,b)
+    col[b[1]] = 	function(text) return "[COLOR r;"..(b[2]/255.0).."|g;"..(b[3]/255.0).."|b;"..(b[4]/255.0).."]"..text..'[/COLOR]' end
+end)
+
+
+--[[
+    @name   Apache-Funktionen
+    @author Mijago
+    @descr
+Funktionen, um Apache neu zu starten.
+--]]
+proc=proc or {}
+proc.apache_start = function()
+                os.execute('apachectl start')
+            end
+proc.apache_stop = function()
+                os.execute('apachectl stop')
+            end
+proc.apache_restart = function()
+                os.execute('apachectl restart')
+            end
+proc.apache_graceful = function()
+                os.execute('apachectl graceful')
+            end
+
+
+--[[
+    @name   TS3-Funktionen
+    @author Mijago
+    @descr
+Funktionen zum Starten, Stoppen und Neustarten eines TS3 Servers.
+--]]
+proc=proc or {}
+proc.ts3_start = function(path)
+                os.execute('cd '..path..' && sh ts3server_startscript.sh start')
+                end
+proc.ts3_stop = function(path)
+                os.execute('cd '..path..' && sh ts3server_startscript.sh stop')
+                end
+proc.ts3_restart = function(path)
+                os.execute('cd '..path..' && sh ts3server_startscript.sh restart')
+                end
diff --git a/server/metin2/Server/share/locale/uk/quest/source/dungeon/dawnmist_dungeon.quest b/server/metin2/Server/share/locale/uk/quest/source/dungeon/dawnmist_dungeon.quest
index 969f9ff..ec88a83 100644
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/dawnmist_dungeon.quest	
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/dawnmist_dungeon.quest	
@@ -1,269 +1,273 @@
-define ENTRY_MAP_INDEX 353 -- metin2_map_dawnmist_dungeon_01
-define group ENTRY_MAP_POS [ 8158, 15050 ]
-define ENTRY_MAN 20412 -- Forest Guardian Leader
-define ENTER_LIMIT_TIME 7200 -- 2h
-define DUNGEON_MAP_INDEX 353 -- metin2_map_dawnmist_dungeon_01
-define group DUNGEON_ENTRY_POS [ 7780, 15020 ]
-define group DUNGEON_BOSS_POS [ 69, 941 ]
-define EXIT_MAP_INDEX 302 -- mt_th_dungeon outside
-define group EXIT_ENTRY_POS [ 12779, 17345 ]
-define DUNGEON_LEVEL 95
-define DUNGEON_TICKET 30613 -- Stone of the Dryads
-define DUNGEON_TICKET_COUNT 1
-define FIRST_BOSS 6408 -- Bagjanamu
-define FINAL_BOSS 6192 -- Jotun Thrym
-define FINAL_BOSS_SPAWN_TIME 60
-define PARTY_MEMBER_LIMIT 2 -- 5
-
-quest dawnmist_dungeon begin
-	state start begin
-		function in_dungeon(idx)
-			return idx >= DUNGEON_MAP_INDEX * 10000 and idx < (DUNGEON_MAP_INDEX + 1) * 10000
-		end
-
-		function create()
-			d.new_jump_party(DUNGEON_MAP_INDEX, DUNGEON_ENTRY_POS[1], DUNGEON_ENTRY_POS[2])
-			d.spawn_mob(FIRST_BOSS, DUNGEON_BOSS_POS[1], DUNGEON_BOSS_POS[2])
-
-			d.setf("created", 1)
-			d.setf("finished", 0)
-			d.setf("party_leader_pid", party.get_leader_pid())
-
-			server_timer("dawnmist_dungeon_15m_left_timer", 60 * 15, d.get_map_index())
-		end
-
-		function clear_server_timers(idx)
-			clear_server_timer("dawnmist_dungeon_15m_left_timer", idx)
-			clear_server_timer("dawnmist_dungeon_5m_left_timer", idx)
-			clear_server_timer("dawnmist_dungeon_1m_left_timer", idx)
-			clear_server_timer("dawnmist_dungeon_0m_left_timer", idx)
-			clear_server_timer("dawnmist_dungeon_end_timer", idx)
-			clear_server_timer("dawnmist_dungeon_quit_timer", idx)
-			clear_server_timer("dawnmist_dungeon_spawn_timer", idx)
-		end
-
-		function clear(purge)
-			if purge then
-				d.purge()
-			else
-				d.kill_all()
-			end
-		end
-
-		function clear_and_exit()
-			dawnmist_dungeon.clear(true)
-			d.set_warp_location(EXIT_MAP_INDEX, EXIT_ENTRY_POS[1], EXIT_ENTRY_POS[2])
-			d.exit_all()
-		end
-
-		function warp_out()
-			pc.warp(ENTRY_MAP_POS[1] * 100, ENTRY_MAP_POS[2] * 100, ENTRY_MAP_INDEX)
-		end
-
-		when login begin
-			local idx = pc.get_map_index()
-			if idx == DUNGEON_MAP_INDEX and pc.get_x() < 7880 and pc.get_y() > 14880 then
-				dawnmist_dungeon.warp_out()
-			elseif dawnmist_dungeon.in_dungeon(idx) then
-				if not party.is_party() then
-					dawnmist_dungeon.warp_out()
-				elseif d.getf("finished") == 1 then
-					dawnmist_dungeon.warp_out()
-				else
-					if pc.getqf("dawnmist_dungeon", "ticket_delete") == 0 then
-						if pc.count_item(DUNGEON_TICKET) >= DUNGEON_TICKET_COUNT then
-							pc.remove_item(DUNGEON_TICKET, DUNGEON_TICKET_COUNT)
-							pc.setf("dawnmist_dungeon", "ticket_delete", 1)
-						else
-							dawnmist_dungeon.warp_out()
-						end
-					end
-
-					if pc.get_player_id() == d.getf("party_leader_pid") then
-						clear_server_timer("dawnmist_dungeon_quit_timer", idx)
-					end
-				end
-
-				pc.unmount()
-			else
-				pc.setf("dawnmist_dungeon", "ticket_delete", 0)
-			end
-		end
-
-		when logout with dawnmist_dungeon.in_dungeon(pc.get_map_index()) begin
-			if d.getf("created") == 1 then
-				pc.setf("dawnmist_dungeon", "exit_time", get_global_time())
-				if pc.get_player_id() == d.getf("party_leader_pid") then
-					server_timer("dawnmist_dungeon_quit_timer", 60, d.get_map_index())
-				end
-			end
-		end
-
-		-- "Enter Erebus"
-		when ENTRY_MAN.chat.c_locale(799) with pc.get_map_index() == ENTRY_MAP_INDEX begin
-
-			-- "You can only enter if you are in a group."
-			if not party.is_party() then
-				say(c_locale(790))
-				return
-			end
-
-			-- "The group leader must enter first."
-			if not party.is_leader() then
-				say(c_locale(792))
-				return
-			end
-
-			-- "The group must consist of more than 4 members."
-			-- "Be sure to stick together!"
-			if party.get_near_count() < PARTY_MEMBER_LIMIT then
-				say(c_locale(793, PARTY_MEMBER_LIMIT - 1))
-				return
-			end
-
-			-- "Are you ready to enter?"
-			say(c_locale(794))
-
-			-- Yes / No
-			if select(c_locale(4473), c_locale(3418)) == 1 then
-
-				local pids = { party.get_member_pids() }
-
-				local no_ticket_members = {}
-				local ticket_check = true
-
-				local no_level_members = {}
-				local level_check = true
-
-				local mounted_members = {}
-				local mount_check = true
-
-				for i, pid in next, pids, nil do
-					q.begin_other_pc_block(pid)
-
-					if pc.count_item(DUNGEON_TICKET) < DUNGEON_TICKET_COUNT then
-						table.insert(no_ticket_members, pc.get_name())
-						ticket_check = false
-					end
-
-					if pc.get_level() < DUNGEON_LEVEL then
-						table.insert(no_level_members, pc.get_name())
-						level_check = false
-					end
-
-					if pc.is_riding() then
-						table.insert(mounted_members, pc.get_name())
-						mount_check = false
-					end
-
-					q.end_other_pc_block()
-				end
-
-				if not level_check then
-					-- "One of your number is not permitted to enter the dungeon."
-					-- "Their level is too low."
-					say(c_locale(797))
-					for i, name in next, no_level_members, nil do
-						say(color(1, 1, 0), c_locale(796) .. "    " .. name)
-					end
-					return
-				end
-
-				if not ticket_check then
-					-- "It would seem that the Stone of the Dryads isn't in your possession."
-					say(c_locale(795))
-					say_item_vnum(DUNGEON_TICKET)
-
-					for i, name in next, no_ticket_members, nil do
-						say(color(1, 1, 0), c_locale(796) .. "    " .. name)
-					end
-					return
-				end
-
-				if not mount_check then
-					-- "The following group members are currently mounted."
-					-- "They must dismount if you want to enter Erebus."
-					say(c_locale(791))
-					for i, name in next, mounted_members, nil do
-						say(color(1, 1, 0), c_locale(796) .. "    " .. name)
-					end
-					return
-				end
-
-				if party.is_map_member_flag_lt("exit_time", get_global_time() - ENTER_LIMIT_TIME) then
-					dawnmist_dungeon.create()
-				else
-					-- "You must wait two hours before you may enter again."
-					-- "At least one of you has not yet waited two hours."
-					say(c_locale(798))
-				end
-			end
-		end
-
-		when FIRST_BOSS.kill with dawnmist_dungeon.in_dungeon(pc.get_map_index()) begin
-			server_timer("dawnmist_dungeon_spawn_timer", FINAL_BOSS_SPAWN_TIME, d.get_map_index())
-		end
-
-		when FINAL_BOSS.kill with dawnmist_dungeon.in_dungeon(d.get_map_index()) begin
-			d.setf("finished", 1)
-			d.setqf2_all_near("dawnmist_dungeon", "thunder_boss", 1, 800)
-
-			dawnmist_dungeon.clear_server_timers(d.get_map_index())
-			dawnmist_dungeon.clear(false)
-
-			server_timer("dawnmist_dungeon_end_timer", 180, d.get_map_index())
-		end
-
-		when dawnmist_dungeon_spawn_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.spawn_mob(FINAL_BOSS, DUNGEON_BOSS_POS[1], DUNGEON_BOSS_POS[2])
-			end
-		end
-
-		when dawnmist_dungeon_15m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(11310, 15)) -- "Time remaining: 15 min."
-				d.notice(c_locale(11311)) -- "The group will be teleported out once the time runs out."
-				server_timer("dawnmist_dungeon_5m_left_timer", 60 * 10, get_server_timer_arg())
-			end
-		end
-
-		when dawnmist_dungeon_5m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(11310, 5)) -- "Time remaining: 5 min."
-				d.notice(c_locale(11311)) -- "The group will be teleported out once the time runs out."
-				server_timer("dawnmist_dungeon_1m_left_timer", 60 * 4, get_server_timer_arg())
-			end
-		end
-
-		when dawnmist_dungeon_1m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(11310, 1)) -- "Time remaining: 1 min."
-				d.notice(c_locale(11311)) -- "The group will be teleported out once the time runs out."
-				server_timer("dawnmist_dungeon_0m_left_timer", 60, get_server_timer_arg())
-			end
-		end
-
-		when dawnmist_dungeon_0m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(11312)) -- "Your time is up."
-				d.notice(c_locale(11313)) -- "You will be teleported out in ten seconds."
-				server_timer("dawnmist_dungeon_end_timer", 10, get_server_timer_arg())
-			end
-		end
-
-		when dawnmist_dungeon_end_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				dawnmist_dungeon.clear_server_timers(get_server_timer_arg())
-				dawnmist_dungeon.clear_and_exit()
-			end
-		end
-
-		when dawnmist_dungeon_quit_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				dawnmist_dungeon.clear_server_timers(get_server_timer_arg())
-				dawnmist_dungeon.clear_and_exit()
-			end
-		end
-	end
-end
+define ENTRY_MAP_INDEX 353 -- metin2_map_dawnmist_dungeon_01
+define group ENTRY_MAP_POS [ 8158, 15050 ]
+define ENTRY_MAN 20412 -- Forest Guardian Leader
+define ENTER_LIMIT_TIME 7200 -- 2h
+define DUNGEON_MAP_INDEX 353 -- metin2_map_dawnmist_dungeon_01
+define group DUNGEON_ENTRY_POS [ 7780, 15020 ]
+define group DUNGEON_BOSS_POS [ 69, 941 ]
+define EXIT_MAP_INDEX 302 -- mt_th_dungeon outside
+define group EXIT_ENTRY_POS [ 12779, 17345 ]
+define DUNGEON_LEVEL 95
+define DUNGEON_TICKET 30613 -- Stone of the Dryads
+define DUNGEON_TICKET_COUNT 1
+define FIRST_BOSS 6408 -- Bagjanamu
+define FINAL_BOSS 6192 -- Jotun Thrym
+define FINAL_BOSS_SPAWN_TIME 60
+define PARTY_MEMBER_LIMIT 2 -- 5
+
+quest dawnmist_dungeon begin
+	state start begin
+		function in_dungeon(idx)
+			return idx >= DUNGEON_MAP_INDEX * 10000 and idx < (DUNGEON_MAP_INDEX + 1) * 10000
+		end
+
+		function create()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
+			d.new_jump_party(DUNGEON_MAP_INDEX, DUNGEON_ENTRY_POS[1], DUNGEON_ENTRY_POS[2])
+			d.spawn_mob(FIRST_BOSS, DUNGEON_BOSS_POS[1], DUNGEON_BOSS_POS[2])
+
+			d.setf("created", 1)
+			d.setf("finished", 0)
+			d.setf("party_leader_pid", party.get_leader_pid())
+
+			server_timer("dawnmist_dungeon_15m_left_timer", 60 * 15, d.get_map_index())
+		end
+
+		function clear_server_timers(idx)
+			clear_server_timer("dawnmist_dungeon_15m_left_timer", idx)
+			clear_server_timer("dawnmist_dungeon_5m_left_timer", idx)
+			clear_server_timer("dawnmist_dungeon_1m_left_timer", idx)
+			clear_server_timer("dawnmist_dungeon_0m_left_timer", idx)
+			clear_server_timer("dawnmist_dungeon_end_timer", idx)
+			clear_server_timer("dawnmist_dungeon_quit_timer", idx)
+			clear_server_timer("dawnmist_dungeon_spawn_timer", idx)
+		end
+
+		function clear(purge)
+			if purge then
+				d.purge()
+			else
+				d.kill_all()
+			end
+		end
+
+		function clear_and_exit()
+			dawnmist_dungeon.clear(true)
+			d.set_warp_location(EXIT_MAP_INDEX, EXIT_ENTRY_POS[1], EXIT_ENTRY_POS[2])
+			d.exit_all()
+		end
+
+		function warp_out()
+			pc.warp(ENTRY_MAP_POS[1] * 100, ENTRY_MAP_POS[2] * 100, ENTRY_MAP_INDEX)
+		end
+
+		when login begin
+			local idx = pc.get_map_index()
+			if idx == DUNGEON_MAP_INDEX and pc.get_x() < 7880 and pc.get_y() > 14880 then
+				dawnmist_dungeon.warp_out()
+			elseif dawnmist_dungeon.in_dungeon(idx) then
+				if not party.is_party() then
+					dawnmist_dungeon.warp_out()
+				elseif d.getf("finished") == 1 then
+					dawnmist_dungeon.warp_out()
+				else
+					if pc.getqf("dawnmist_dungeon", "ticket_delete") == 0 then
+						if pc.count_item(DUNGEON_TICKET) >= DUNGEON_TICKET_COUNT then
+							pc.remove_item(DUNGEON_TICKET, DUNGEON_TICKET_COUNT)
+							pc.setf("dawnmist_dungeon", "ticket_delete", 1)
+						else
+							dawnmist_dungeon.warp_out()
+						end
+					end
+
+					if pc.get_player_id() == d.getf("party_leader_pid") then
+						clear_server_timer("dawnmist_dungeon_quit_timer", idx)
+					end
+				end
+
+				pc.unmount()
+			else
+				pc.setf("dawnmist_dungeon", "ticket_delete", 0)
+			end
+		end
+
+		when logout with dawnmist_dungeon.in_dungeon(pc.get_map_index()) begin
+			if d.getf("created") == 1 then
+				pc.setf("dawnmist_dungeon", "exit_time", get_global_time())
+				if pc.get_player_id() == d.getf("party_leader_pid") then
+					server_timer("dawnmist_dungeon_quit_timer", 60, d.get_map_index())
+				end
+			end
+		end
+
+		-- "Enter Erebus"
+		when ENTRY_MAN.chat.c_locale(799) with pc.get_map_index() == ENTRY_MAP_INDEX begin
+
+			-- "You can only enter if you are in a group."
+			if not party.is_party() then
+				say(c_locale(790))
+				return
+			end
+
+			-- "The group leader must enter first."
+			if not party.is_leader() then
+				say(c_locale(792))
+				return
+			end
+
+			-- "The group must consist of more than 4 members."
+			-- "Be sure to stick together!"
+			if party.get_near_count() < PARTY_MEMBER_LIMIT then
+				say(c_locale(793, PARTY_MEMBER_LIMIT - 1))
+				return
+			end
+
+			-- "Are you ready to enter?"
+			say(c_locale(794))
+
+			-- Yes / No
+			if select(c_locale(4473), c_locale(3418)) == 1 then
+
+				local pids = { party.get_member_pids() }
+
+				local no_ticket_members = {}
+				local ticket_check = true
+
+				local no_level_members = {}
+				local level_check = true
+
+				local mounted_members = {}
+				local mount_check = true
+
+				for i, pid in next, pids, nil do
+					q.begin_other_pc_block(pid)
+
+					if pc.count_item(DUNGEON_TICKET) < DUNGEON_TICKET_COUNT then
+						table.insert(no_ticket_members, pc.get_name())
+						ticket_check = false
+					end
+
+					if pc.get_level() < DUNGEON_LEVEL then
+						table.insert(no_level_members, pc.get_name())
+						level_check = false
+					end
+
+					if pc.is_riding() then
+						table.insert(mounted_members, pc.get_name())
+						mount_check = false
+					end
+
+					q.end_other_pc_block()
+				end
+
+				if not level_check then
+					-- "One of your number is not permitted to enter the dungeon."
+					-- "Their level is too low."
+					say(c_locale(797))
+					for i, name in next, no_level_members, nil do
+						say(color(1, 1, 0), c_locale(796) .. "    " .. name)
+					end
+					return
+				end
+
+				if not ticket_check then
+					-- "It would seem that the Stone of the Dryads isn't in your possession."
+					say(c_locale(795))
+					say_item_vnum(DUNGEON_TICKET)
+
+					for i, name in next, no_ticket_members, nil do
+						say(color(1, 1, 0), c_locale(796) .. "    " .. name)
+					end
+					return
+				end
+
+				if not mount_check then
+					-- "The following group members are currently mounted."
+					-- "They must dismount if you want to enter Erebus."
+					say(c_locale(791))
+					for i, name in next, mounted_members, nil do
+						say(color(1, 1, 0), c_locale(796) .. "    " .. name)
+					end
+					return
+				end
+
+				if party.is_map_member_flag_lt("exit_time", get_global_time() - ENTER_LIMIT_TIME) then
+					dawnmist_dungeon.create()
+				else
+					-- "You must wait two hours before you may enter again."
+					-- "At least one of you has not yet waited two hours."
+					say(c_locale(798))
+				end
+			end
+		end
+
+		when FIRST_BOSS.kill with dawnmist_dungeon.in_dungeon(pc.get_map_index()) begin
+			server_timer("dawnmist_dungeon_spawn_timer", FINAL_BOSS_SPAWN_TIME, d.get_map_index())
+		end
+
+		when FINAL_BOSS.kill with dawnmist_dungeon.in_dungeon(d.get_map_index()) begin
+			d.setf("finished", 1)
+			d.setqf2_all_near("dawnmist_dungeon", "thunder_boss", 1, 800)
+
+			dawnmist_dungeon.clear_server_timers(d.get_map_index())
+			dawnmist_dungeon.clear(false)
+
+			server_timer("dawnmist_dungeon_end_timer", 180, d.get_map_index())
+		end
+
+		when dawnmist_dungeon_spawn_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.spawn_mob(FINAL_BOSS, DUNGEON_BOSS_POS[1], DUNGEON_BOSS_POS[2])
+			end
+		end
+
+		when dawnmist_dungeon_15m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(11310, 15)) -- "Time remaining: 15 min."
+				d.notice(c_locale(11311)) -- "The group will be teleported out once the time runs out."
+				server_timer("dawnmist_dungeon_5m_left_timer", 60 * 10, get_server_timer_arg())
+			end
+		end
+
+		when dawnmist_dungeon_5m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(11310, 5)) -- "Time remaining: 5 min."
+				d.notice(c_locale(11311)) -- "The group will be teleported out once the time runs out."
+				server_timer("dawnmist_dungeon_1m_left_timer", 60 * 4, get_server_timer_arg())
+			end
+		end
+
+		when dawnmist_dungeon_1m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(11310, 1)) -- "Time remaining: 1 min."
+				d.notice(c_locale(11311)) -- "The group will be teleported out once the time runs out."
+				server_timer("dawnmist_dungeon_0m_left_timer", 60, get_server_timer_arg())
+			end
+		end
+
+		when dawnmist_dungeon_0m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(11312)) -- "Your time is up."
+				d.notice(c_locale(11313)) -- "You will be teleported out in ten seconds."
+				server_timer("dawnmist_dungeon_end_timer", 10, get_server_timer_arg())
+			end
+		end
+
+		when dawnmist_dungeon_end_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				dawnmist_dungeon.clear_server_timers(get_server_timer_arg())
+				dawnmist_dungeon.clear_and_exit()
+			end
+		end
+
+		when dawnmist_dungeon_quit_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				dawnmist_dungeon.clear_server_timers(get_server_timer_arg())
+				dawnmist_dungeon.clear_and_exit()
+			end
+		end
+	end
+end
diff --git a/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest b/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest
index 4647b6b..5c44f5b 100644
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest	
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/deviltower_zone.quest	
@@ -1,404 +1,412 @@
-quest deviltower_zone begin
-	state start begin
-		when login begin
-			if pc.get_map_index() == 66 then
-				if (pc.get_x() < 1280 + 88 or pc.get_y() < 7936 + 577) or (pc.get_x() > 1280 + 236 or pc.get_y() > 7936 + 737) then
-					pc.warp((5376 + 532) * 100, (512 + 600) * 100, 65)
-				end
-				pc.set_warp_location(65, (5376 + 532), (512 + 600))
-			elseif pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 then
-				pc.set_warp_location(65, (5376 + 532), (512 + 600))
-			end
-		end
-
-		when 20348.chat.c_locale(839) begin
-			if pc.get_level() < 40 then
-				say_title(c_locale(849))
-				say(c_locale(860))
-			else
-				say_title(c_locale(849))
-				say(c_locale(861))
-				local s = select(c_locale(2699), c_locale(2702))
-				if s == 1 then
-					pc.warp(140300, 854400)
-				end
-			end
-		end
-
-		when 8015.kill begin
-			timer("devil_stone1_1", 6)
-		end
-
-		when devil_stone1_1.timer begin
-			d.new_jump_all(66, special.devil_tower[1][1], special.devil_tower[1][2])
-			d.regen_file("data/dungeon/deviltower2_regen.txt")
-			d.set_warp_at_eliminate(4, d.get_map_index(), special.devil_tower[2][1], special.devil_tower[2][2], "data/dungeon/deviltower3_regen.txt")
-		end
-
-		when 1091.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
-			d.set_warp_at_eliminate(4, d.get_map_index(), special.devil_tower[3][1], special.devil_tower[3][2], "data/dungeon/deviltower4_regen.txt")
-			d.check_eliminated()
-		end
-
-		function get_4floor_stone_pos()
-			local positions = {
-				{ 368, 629 }, { 419, 630 }, { 428, 653 }, { 422, 679 },
-				{ 395, 689 }, { 369, 679 }, { 361, 658 },
-			}
-			for i = 1, 6 do
-				local j = number(i, 7)
-				if i != j then
-					local t = positions[i]
-					positions[i] = positions[j]
-					positions[j] = t
-				end
-			end
-
-			return positions
-		end
-
-		when 8016.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
-			d.setf("level", 4)
-			local positions = deviltower_zone.get_4floor_stone_pos()
-
-			for i = 1, 6 do
-				test_chat(positions[i][1], positions[i][2])
-				d.set_unique("fake" .. i, d.spawn_mob(8017, positions[i][1], positions[i][2]))
-			end
-
-			test_chat(positions[7][1], positions[7][2])
-
-			local vid = d.spawn_mob(8017, positions[7][1], positions[7][2])
-			test_chat(vid)
-			d.set_unique("real", vid)
-			server_loop_timer("devil_stone4_update", 10, pc.get_map_index())
-			server_timer("devil_stone4_fail1", (5 * 60), pc.get_map_index())
-
-			d.notice(c_locale(841))
-		end
-
-		when devil_stone4_fail1.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(863))
-				server_timer("devil_stone4_fail2", (5 * 60), get_server_timer_arg())
-			end
-		end
-
-		when devil_stone4_fail2.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(864))
-				server_timer("devil_stone4_fail", (5 * 60), get_server_timer_arg())
-			end
-		end
-
-		when devil_stone4_fail.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(865))
-				d.clear_regen()
-				d.exit_all()
-				clear_server_timer("devil_stone4_update", get_server_timer_arg())
-			end
-		end
-
-		when devil_stone4_update.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				if not d.is_unique_dead("real") then
-					for i = 1, 6 do
-						if d.getf("fakedead" .. i) == 0 then
-							if d.unique_get_hp_perc("fake" .. i) < 50 then
-								d.purge_unique("fake" .. i)
-								d.setf("fakedead" .. i, 1)
-								d.notice(c_locale(866))
-							end
-						end
-					end
-				else
-					server_timer("devil_stone4_end", 5, get_server_timer_arg())
-					--d.kill_all()
-					d.purge()
-					d.notice(c_locale(840))
-					clear_server_timer("devil_stone4_fail1", get_server_timer_arg())
-					clear_server_timer("devil_stone4_fail2", get_server_timer_arg())
-					clear_server_timer("devil_stone4_fail", get_server_timer_arg())
-				end
-			else
-				server_timer("devil_stone4_stop_timer", 1, get_server_timer_arg())
-			end
-		end
-
-		when devil_stone4_stop_timer.server_timer begin
-			clear_server_timer("devil_stone4_update", get_server_timer_arg())
-		end
-
-		when devil_stone4_end.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				clear_server_timer("devil_stone4_update", get_server_timer_arg())
-				clear_server_timer("devil_stone4_fail1", get_server_timer_arg())
-				clear_server_timer("devil_stone4_fail2", get_server_timer_arg())
-				clear_server_timer("devil_stone4_fail", get_server_timer_arg())
-
-				-- clear regen from memory when exit
-				d.clear_regen()
-
-				d.setf("level", 5)
-				d.setf("stone_count", 5)
-				d.notice(c_locale(862))
-				d.jump_all(special.devil_tower[4][1], special.devil_tower[4][2])
-				server_timer("devil_stone5_fail1", (5 * 60), get_server_timer_arg())
-				clear_server_timer("devil_stone4_update", get_server_timer_arg())
-
-				d.set_regen_file("data/dungeon/deviltower5_regen.txt")
-
-				d.spawn_mob(20073, 421, 452)
-				d.spawn_mob(20073, 380, 460)
-				d.spawn_mob(20073, 428, 414)
-				d.spawn_mob(20073, 398, 392)
-				d.spawn_mob(20073, 359, 426)
-			end
-		end
-
-		when devil_stone5_fail1.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(842))
-				server_timer("devil_stone5_fail2", (5 * 60), get_server_timer_arg())
-			end
-		end
-
-		when devil_stone5_fail2.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(863))
-				server_timer("devil_stone5_fail3", (5 * 60), get_server_timer_arg())
-			end
-		end
-
-		when devil_stone5_fail3.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(864))
-				server_timer("devil_stone5_fail", (5 * 60), get_server_timer_arg())
-			end
-		end
-
-		when devil_stone5_fail.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(865))
-				d.exit_all()
-			end
-		end
-
-		when kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and d.getf("level") == 5 begin
-			if not npc.is_pc() then
-				local KILL_COUNT_FOR_DROP_KEY = 300
-				if is_test_server() then
-					KILL_COUNT_FOR_DROP_KEY = 150
-				end
-				local n = d.getf("count") + 1
-				d.setf("count", n)
-				if n == KILL_COUNT_FOR_DROP_KEY then
-					game.drop_item_with_ownership(50084, 1)
-					d.setf("count", 0)
-				end
-			end
-		end
-
-		when 20073.take with item.get_vnum() == 50084 begin
-			npc.purge()
-			item.remove()
-			d.setf("stone_count", d.getf("stone_count") - 1)
-			if d.getf("stone_count") <= 0 then
-				d.setf("level", 6)
-				d.clear_regen()
-				d.regen_file("data/dungeon/deviltower6_regen.txt")
-
-				d.notice(c_locale(843))
-				d.jump_all(special.devil_tower[5][1], special.devil_tower[5][2])
-				local server_arg = d.get_map_index()
-				clear_server_timer("devil_stone5_fail1", server_arg)
-				clear_server_timer("devil_stone5_fail2", server_arg)
-				clear_server_timer("devil_stone5_fail3", server_arg)
-				clear_server_timer("devil_stone5_fail", server_arg)
-			else
-				d.notice(c_locale(844, d.getf("stone_count")))
-			end
-		end
-
-		when 1092.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and d.getf("level") == 6 begin
-			d.kill_all()
-			d.notice(c_locale(845))
-			d.check_eliminated()
-			d.notice(c_locale(846))
-			local reward_alchemist = { 20074, 20075, 20076 }
-			d.spawn_mob(reward_alchemist[number(1, 3)], 425, 216)
-			d.setqf2("deviltower_zone", "can_refine", 1)
-		end
-
-		when 20074.chat.c_locale(847) with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and npc.lock() begin
-			say_title(c_mob_name(20074))
-			say(c_locale(848))
-			wait()
-			if pc.get_level() >= 75 then
-				say_title(c_mob_name(20074))
-				say(c_locale(850))
-				local s = select(c_locale(851), c_locale(2426), c_locale(852))
-				if s == 3 then
-					pc.warp(590500, 110900)
-					return
-				end
-				if s == 2 then
-					return
-				end
-
-				timer("devil_jump_7", 6)
-				npc.unlock()
-				d.purge()
-				return
-			end
-
-			say_title(c_mob_name(20074))
-			say(c_locale(852))
-			wait()
-			pc.warp(590500, 110500)
-			return
-		end
-
-		when 20075.chat.c_locale(847) with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and npc.lock() begin
-			say_title(c_mob_name(20075))
-			say(c_locale(848))
-			wait()
-			if pc.get_level() >= 75 then
-				say_title(c_mob_name(20075))
-				say(c_locale(850))
-				local s = select(c_locale(851), c_locale(2426), c_locale(852))
-				if s == 3 then
-					pc.warp(590500, 110900)
-					return
-				end
-				if s == 2 then
-					return
-				end
-
-				timer("devil_jump_7", 6)
-				npc.unlock()
-				d.purge()
-				return
-			end
-
-			say_title(c_mob_name(20075))
-			say(c_locale(852))
-			wait()
-			pc.warp(590500, 110500)
-			return
-		end
-
-		when 20076.chat.c_locale(847) with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and npc.lock() begin
-			say_title(c_mob_name(20076))
-			say(c_locale(848))
-			wait()
-			if pc.get_level() >= 75 then
-				say_title(c_mob_name(20076))
-				say(c_locale(850))
-				local s = select(c_locale(851), c_locale(2426), c_locale(852))
-				if s == 3 then
-					pc.warp(590500, 110900)
-					return
-				end
-				if s == 2 then
-					return
-				end
-
-				timer("devil_jump_7", 6)
-				npc.unlock()
-				d.purge()
-				return
-			end
-
-			say_title(c_mob_name(20076))
-			say(c_locale(852))
-			wait()
-			pc.warp(590500, 110500)
-			return
-		end
-
-		when devil_jump_7.timer begin
-			d.clear_regen()
-
-			d.spawn_mob(8018, 639, 658)
-			d.spawn_mob(8018, 611, 637)
-			d.spawn_mob(8018, 596, 674)
-			d.spawn_mob(8018, 629, 670)
-
-			d.setf("level", 7)
-
-			d.notice(c_locale(854))
-			d.jump_all(special.devil_tower[6][1], special.devil_tower[6][2])
-		end
-
-		when 8018.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
-			local cont = d.getf("7_stone_kill") + 1
-			d.setf("7_stone_kill", cont)
-
-			if cont >= 4 then
-				d.setf("7_stone_kill", 0)
-				d.set_regen_file("data/dungeon/deviltower7_regen.txt")
-			end
-		end
-
-		when 8019.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
-			local pct = number(1, 10)
-			if pct == 1 then
-				timer("devil_jump_8", 6)
-				d.clear_regen()
-			end
-		end
-
-		when devil_jump_8.timer begin
-			d.setf("level", 8)
-
-			d.notice(c_locale(856))
-			d.jump_all(special.devil_tower[7][1], special.devil_tower[7][2])
-			d.set_regen_file("data/dungeon/deviltower8_regen.txt")
-			d.spawn_mob(20366, 640, 460)
-		end
-
-		when 1040.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
-			local pct1 = number(1, 5)
-			if pct1 == 1 then
-				local pct2 = number(1, 10)
-				if pct2 == 1 then
-					game.drop_item_with_ownership(30304, 1)
-				else
-					game.drop_item_with_ownership(30303, 1)
-				end
-			else
-				return
-			end
-		end
-
-		when 20366.take with item.get_vnum() == 30304 begin
-			npc.purge()
-			item.remove()
-			timer("devil_jump_9", 6)
-		end
-
-		when devil_jump_9.timer begin
-			d.setf("level", 9)
-			d.notice(c_locale(857))
-			d.jump_all(special.devil_tower[8][1], special.devil_tower[8][2])
-			d.regen_file("data/dungeon/deviltower9_regen.txt")
-		end
-
-		when 1093.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
-			d.kill_all()
-			d.setqf2("deviltower_zone", "9_done", 1)
-			d.notice(c_locale(858))
-			d.notice(c_locale(859))
-			server_timer("devil_end_jump", 60, d.get_map_index())
-		end
-
-		when devil_end_jump.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.clear_regen()
-				d.exit_all()
-			end
-		end
-	end
-end
+quest deviltower_zone begin
+	state start begin
+		when login begin
+			if pc.get_map_index() == 66 then
+				if (pc.get_x() < 1280 + 88 or pc.get_y() < 7936 + 577) or (pc.get_x() > 1280 + 236 or pc.get_y() > 7936 + 737) then
+					pc.warp((5376 + 532) * 100, (512 + 600) * 100, 65)
+				end
+				pc.set_warp_location(65, (5376 + 532), (512 + 600))
+			elseif pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 then
+				pc.set_warp_location(65, (5376 + 532), (512 + 600))
+			end
+		end
+
+		when 20348.chat.c_locale(839) begin
+			if pc.get_level() < 40 then
+				say_title(c_locale(849))
+				say(c_locale(860))
+			else
+				say_title(c_locale(849))
+				say(c_locale(861))
+				local s = select(c_locale(2699), c_locale(2702))
+				if s == 1 then
+					pc.warp(140300, 854400)
+				end
+			end
+		end
+
+		when 8015.kill begin
+			timer("devil_stone1_1", 6)
+		end
+
+		when devil_stone1_1.timer begin
+			if party.is_party() then
+		end
+
+		when devil_stone1_1.timer begin
+			if party.is_party() then
+				d.new_jump_all(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			else
+				d.new_jump(66, special.devil_tower[1][1], special.devil_tower[1][2])
+			end
+			d.regen_file("data/dungeon/deviltower2_regen.txt")
+			d.set_warp_at_eliminate(4, d.get_map_index(), special.devil_tower[2][1], special.devil_tower[2][2], "data/dungeon/deviltower3_regen.txt")
+		end
+
+		when 1091.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
+			d.set_warp_at_eliminate(4, d.get_map_index(), special.devil_tower[3][1], special.devil_tower[3][2], "data/dungeon/deviltower4_regen.txt")
+			d.check_eliminated()
+		end
+
+		function get_4floor_stone_pos()
+			local positions = {
+				{ 368, 629 }, { 419, 630 }, { 428, 653 }, { 422, 679 },
+				{ 395, 689 }, { 369, 679 }, { 361, 658 },
+			}
+			for i = 1, 6 do
+				local j = number(i, 7)
+				if i != j then
+					local t = positions[i]
+					positions[i] = positions[j]
+					positions[j] = t
+				end
+			end
+
+			return positions
+		end
+
+		when 8016.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
+			d.setf("level", 4)
+			local positions = deviltower_zone.get_4floor_stone_pos()
+
+			for i = 1, 6 do
+				test_chat(positions[i][1], positions[i][2])
+				d.set_unique("fake" .. i, d.spawn_mob(8017, positions[i][1], positions[i][2]))
+			end
+
+			test_chat(positions[7][1], positions[7][2])
+
+			local vid = d.spawn_mob(8017, positions[7][1], positions[7][2])
+			test_chat(vid)
+			d.set_unique("real", vid)
+			server_loop_timer("devil_stone4_update", 10, pc.get_map_index())
+			server_timer("devil_stone4_fail1", (5 * 60), pc.get_map_index())
+
+			d.notice(c_locale(841))
+		end
+
+		when devil_stone4_fail1.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(863))
+				server_timer("devil_stone4_fail2", (5 * 60), get_server_timer_arg())
+			end
+		end
+
+		when devil_stone4_fail2.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(864))
+				server_timer("devil_stone4_fail", (5 * 60), get_server_timer_arg())
+			end
+		end
+
+		when devil_stone4_fail.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(865))
+				d.clear_regen()
+				d.exit_all()
+				clear_server_timer("devil_stone4_update", get_server_timer_arg())
+			end
+		end
+
+		when devil_stone4_update.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				if not d.is_unique_dead("real") then
+					for i = 1, 6 do
+						if d.getf("fakedead" .. i) == 0 then
+							if d.unique_get_hp_perc("fake" .. i) < 50 then
+								d.purge_unique("fake" .. i)
+								d.setf("fakedead" .. i, 1)
+								d.notice(c_locale(866))
+							end
+						end
+					end
+				else
+					server_timer("devil_stone4_end", 5, get_server_timer_arg())
+					--d.kill_all()
+					d.purge()
+					d.notice(c_locale(840))
+					clear_server_timer("devil_stone4_fail1", get_server_timer_arg())
+					clear_server_timer("devil_stone4_fail2", get_server_timer_arg())
+					clear_server_timer("devil_stone4_fail", get_server_timer_arg())
+				end
+			else
+				server_timer("devil_stone4_stop_timer", 1, get_server_timer_arg())
+			end
+		end
+
+		when devil_stone4_stop_timer.server_timer begin
+			clear_server_timer("devil_stone4_update", get_server_timer_arg())
+		end
+
+		when devil_stone4_end.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				clear_server_timer("devil_stone4_update", get_server_timer_arg())
+				clear_server_timer("devil_stone4_fail1", get_server_timer_arg())
+				clear_server_timer("devil_stone4_fail2", get_server_timer_arg())
+				clear_server_timer("devil_stone4_fail", get_server_timer_arg())
+
+				-- clear regen from memory when exit
+				d.clear_regen()
+
+				d.setf("level", 5)
+				d.setf("stone_count", 5)
+				d.notice(c_locale(862))
+				d.jump_all(special.devil_tower[4][1], special.devil_tower[4][2])
+				server_timer("devil_stone5_fail1", (5 * 60), get_server_timer_arg())
+				clear_server_timer("devil_stone4_update", get_server_timer_arg())
+
+				d.set_regen_file("data/dungeon/deviltower5_regen.txt")
+
+				d.spawn_mob(20073, 421, 452)
+				d.spawn_mob(20073, 380, 460)
+				d.spawn_mob(20073, 428, 414)
+				d.spawn_mob(20073, 398, 392)
+				d.spawn_mob(20073, 359, 426)
+			end
+		end
+
+		when devil_stone5_fail1.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(842))
+				server_timer("devil_stone5_fail2", (5 * 60), get_server_timer_arg())
+			end
+		end
+
+		when devil_stone5_fail2.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(863))
+				server_timer("devil_stone5_fail3", (5 * 60), get_server_timer_arg())
+			end
+		end
+
+		when devil_stone5_fail3.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(864))
+				server_timer("devil_stone5_fail", (5 * 60), get_server_timer_arg())
+			end
+		end
+
+		when devil_stone5_fail.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(865))
+				d.exit_all()
+			end
+		end
+
+		when kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and d.getf("level") == 5 begin
+			if not npc.is_pc() then
+				local KILL_COUNT_FOR_DROP_KEY = 300
+				if is_test_server() then
+					KILL_COUNT_FOR_DROP_KEY = 150
+				end
+				local n = d.getf("count") + 1
+				d.setf("count", n)
+				if n == KILL_COUNT_FOR_DROP_KEY then
+					game.drop_item_with_ownership(50084, 1)
+					d.setf("count", 0)
+				end
+			end
+		end
+
+		when 20073.take with item.get_vnum() == 50084 begin
+			npc.purge()
+			item.remove()
+			d.setf("stone_count", d.getf("stone_count") - 1)
+			if d.getf("stone_count") <= 0 then
+				d.setf("level", 6)
+				d.clear_regen()
+				d.regen_file("data/dungeon/deviltower6_regen.txt")
+
+				d.notice(c_locale(843))
+				d.jump_all(special.devil_tower[5][1], special.devil_tower[5][2])
+				local server_arg = d.get_map_index()
+				clear_server_timer("devil_stone5_fail1", server_arg)
+				clear_server_timer("devil_stone5_fail2", server_arg)
+				clear_server_timer("devil_stone5_fail3", server_arg)
+				clear_server_timer("devil_stone5_fail", server_arg)
+			else
+				d.notice(c_locale(844, d.getf("stone_count")))
+			end
+		end
+
+		when 1092.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and d.getf("level") == 6 begin
+			d.kill_all()
+			d.notice(c_locale(845))
+			d.check_eliminated()
+			d.notice(c_locale(846))
+			local reward_alchemist = { 20074, 20075, 20076 }
+			d.spawn_mob(reward_alchemist[number(1, 3)], 425, 216)
+			d.setqf2("deviltower_zone", "can_refine", 1)
+		end
+
+		when 20074.chat.c_locale(847) with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and npc.lock() begin
+			say_title(c_mob_name(20074))
+			say(c_locale(848))
+			wait()
+			if pc.get_level() >= 75 then
+				say_title(c_mob_name(20074))
+				say(c_locale(850))
+				local s = select(c_locale(851), c_locale(2426), c_locale(852))
+				if s == 3 then
+					pc.warp(590500, 110900)
+					return
+				end
+				if s == 2 then
+					return
+				end
+
+				timer("devil_jump_7", 6)
+				npc.unlock()
+				d.purge()
+				return
+			end
+
+			say_title(c_mob_name(20074))
+			say(c_locale(852))
+			wait()
+			pc.warp(590500, 110500)
+			return
+		end
+
+		when 20075.chat.c_locale(847) with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and npc.lock() begin
+			say_title(c_mob_name(20075))
+			say(c_locale(848))
+			wait()
+			if pc.get_level() >= 75 then
+				say_title(c_mob_name(20075))
+				say(c_locale(850))
+				local s = select(c_locale(851), c_locale(2426), c_locale(852))
+				if s == 3 then
+					pc.warp(590500, 110900)
+					return
+				end
+				if s == 2 then
+					return
+				end
+
+				timer("devil_jump_7", 6)
+				npc.unlock()
+				d.purge()
+				return
+			end
+
+			say_title(c_mob_name(20075))
+			say(c_locale(852))
+			wait()
+			pc.warp(590500, 110500)
+			return
+		end
+
+		when 20076.chat.c_locale(847) with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 and npc.lock() begin
+			say_title(c_mob_name(20076))
+			say(c_locale(848))
+			wait()
+			if pc.get_level() >= 75 then
+				say_title(c_mob_name(20076))
+				say(c_locale(850))
+				local s = select(c_locale(851), c_locale(2426), c_locale(852))
+				if s == 3 then
+					pc.warp(590500, 110900)
+					return
+				end
+				if s == 2 then
+					return
+				end
+
+				timer("devil_jump_7", 6)
+				npc.unlock()
+				d.purge()
+				return
+			end
+
+			say_title(c_mob_name(20076))
+			say(c_locale(852))
+			wait()
+			pc.warp(590500, 110500)
+			return
+		end
+
+		when devil_jump_7.timer begin
+			d.clear_regen()
+
+			d.spawn_mob(8018, 639, 658)
+			d.spawn_mob(8018, 611, 637)
+			d.spawn_mob(8018, 596, 674)
+			d.spawn_mob(8018, 629, 670)
+
+			d.setf("level", 7)
+
+			d.notice(c_locale(854))
+			d.jump_all(special.devil_tower[6][1], special.devil_tower[6][2])
+		end
+
+		when 8018.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
+			local cont = d.getf("7_stone_kill") + 1
+			d.setf("7_stone_kill", cont)
+
+			if cont >= 4 then
+				d.setf("7_stone_kill", 0)
+				d.set_regen_file("data/dungeon/deviltower7_regen.txt")
+			end
+		end
+
+		when 8019.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
+			local pct = number(1, 10)
+			if pct == 1 then
+				timer("devil_jump_8", 6)
+				d.clear_regen()
+			end
+		end
+
+		when devil_jump_8.timer begin
+			d.setf("level", 8)
+
+			d.notice(c_locale(856))
+			d.jump_all(special.devil_tower[7][1], special.devil_tower[7][2])
+			d.set_regen_file("data/dungeon/deviltower8_regen.txt")
+			d.spawn_mob(20366, 640, 460)
+		end
+
+		when 1040.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
+			local pct1 = number(1, 5)
+			if pct1 == 1 then
+				local pct2 = number(1, 10)
+				if pct2 == 1 then
+					game.drop_item_with_ownership(30304, 1)
+				else
+					game.drop_item_with_ownership(30303, 1)
+				end
+			else
+				return
+			end
+		end
+
+		when 20366.take with item.get_vnum() == 30304 begin
+			npc.purge()
+			item.remove()
+			timer("devil_jump_9", 6)
+		end
+
+		when devil_jump_9.timer begin
+			d.setf("level", 9)
+			d.notice(c_locale(857))
+			d.jump_all(special.devil_tower[8][1], special.devil_tower[8][2])
+			d.regen_file("data/dungeon/deviltower9_regen.txt")
+		end
+
+		when 1093.kill with pc.in_dungeon() and pc.get_map_index() >= 660000 and pc.get_map_index() < 670000 begin
+			d.kill_all()
+			d.setqf2("deviltower_zone", "9_done", 1)
+			d.notice(c_locale(858))
+			d.notice(c_locale(859))
+			server_timer("devil_end_jump", 60, d.get_map_index())
+		end
+
+		when devil_end_jump.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.clear_regen()
+				d.exit_all()
+			end
+		end
+	end
+end
diff --git a/server/metin2/Server/share/locale/uk/quest/source/dungeon/flame_dungeon.quest b/server/metin2/Server/share/locale/uk/quest/source/dungeon/flame_dungeon.quest
index cd303ce..4f8a142 100644
--- a/server/metin2/Server/share/locale/uk/quest/source/dungeon/flame_dungeon.quest	
+++ b/server/metin2/Server/share/locale/uk/quest/source/dungeon/flame_dungeon.quest	
@@ -1,788 +1,792 @@
-define BLOCK_DOOR 20387
-define DUNGEON_MAN 20385
-define DUNGEON_MAN_DIR 0
-define DUNGEON_MAP_INDEX 351
-define ENTER_LIMIT_TIME 30
-define ENTRY_MAN 20394
-define ENTRY_MAP_INDEX 62
-define FINAL_BOSS 6091
-define LEVEL2_KEY 30329
-define LEVEL2_STONE 20386
-define LEVEL4_TARGET 6051
-define LEVEL5_REALKEY 30330
-define LEVEL5_STONE 20386
-define LEVEL5_GEN_LIMIT 100
-define LEVEL6_TARGET 8057
-define LEVEL_CUT 100
-define MOB_REGEN_FILE_PATH = "data/dungeon/flame_dungeon/"
-define IN_DOOR 20388
-define NPC_REGEN_FILE_PATH = "data/dungeon/flame_dungeon/npc.txt"
-define TICKET_GROUP 10034
-define LIMITED_TICKET_GROUP 10033
-define NEED_MAIN_QUEST_FLAME_LV103 0
-
-quest flame_dungeon begin
-	--[[
-	state start begin
-		when ENTRY_MAN.click with pc.get_level() >= 90 begin
-			pc.give_item2(LIMITED_PASS_TICKET, 1)
-			set_state(run)
-		end
-	end
-	]]
-
-	-- state run begin
-	state start begin
-		function setting()
-			return {
-				["bossroom_entry_pos"] = { 8109, 6867 }, -- 685, 723
-				["boss_pos"] = { 686, 637 },
-				["doors_pos"] = {
-					{ 320, 394 },
-					{ 293, 359 },
-					{ 333, 321 },
-					{ 378, 320 },
-					{ 400, 355 },
-					{ 394, 401 }
-				},
-				["idoors_pos"] = {
-					{ 268, 447 },
-					{ 234, 359 },
-					{ 300, 264 },
-					{ 454, 217 },
-					{ 470, 355 },
-					{ 467, 469 }
-				},
-				["doors_dir"] = { 135, 90, 210, 152, 90, 223 },
-				["idoors_dir"] = { 135, 90, 210, 135, 90, 239 },
-				["dungeon_entry_pos"] = { 7762, 6739 }, -- ´øÀü¿¡ Ã³À½ µé¾î¿À´Â °÷
-				["DUNGEON_MAN_bpos"] = { 690, 722 },
-				["DUNGEON_MAN_pos"] = { 354, 362 },
-				["LEVEL2_STONE_pos"] = { 195, 352 },
-				["LEVEL4_TARGET_pos"] = { 470, 175 },
-				["LEVEL5_STONE_pos"] = {
-					{ 486, 345 },
-					{ 511, 336 },
-					{ 525, 349 },
-					{ 521, 365 },
-					{ 503, 372 },
-					{ 486, 365 },
-					{ 500, 354 }
-				},
-				["LEVEL6_TARGET_pos"] = { 511, 480 },
-				["outside_entry_pos"] = { 6142, 7068 }, -- ÀÔÀå½ÃÄÑÁÖ´Â¾Ö ¼­ÀÖ´Â °÷
-				["YAK_pos"] = { 376, 397 } -- ¾àÈ¯ ºÎÇÏ
-			}
-		end
-
-		function is_flamed(idx) -- Àû·æ¼º¿¡ ÀÖ´ÂÁö È®ÀÎ
-			return idx >= DUNGEON_MAP_INDEX * 10000 and idx < (DUNGEON_MAP_INDEX + 1) * 10000
-		end
-
-		function make_dungeon() -- ´øÀü ¸¸µé±â
-			local setting = flame_dungeon.setting()
-			d.new_jump_party(DUNGEON_MAP_INDEX, setting.dungeon_entry_pos[1], setting.dungeon_entry_pos[2])
-			--d.spawn_mob_ac_dir(DUNGEON_MAN, setting.DUNGEON_MAN_pos[1], setting.DUNGEON_MAN_pos[2], DUNGEON_MAN_DIR)
-			--d.spawn_mob(YAK, setting.YAK_pos[1], setting.YAK_pos[2])
-			d.regen_file(NPC_REGEN_FILE_PATH)
-			d.setf("level", 0)
-			for i = 1, 6 do
-				d.set_unique("door" .. i, d.spawn_mob_ac_dir(BLOCK_DOOR, setting.doors_pos[i][1], setting.doors_pos[i][2], setting.doors_dir[i]))
-			end
-			for i = 1, 6 do
-				d.set_unique("idoor" .. i, d.spawn_mob_ac_dir(IN_DOOR, setting.idoors_pos[i][1], setting.idoors_pos[i][2], setting.idoors_dir[i]))
-			end
-			d.setf("clear_count", 0)
-			d.setf("started", 0)
-			d.setf("dungeon_enter", 0) -- Á¤»óÀûÀ¸·Î ÀÔÀåÇß´ÂÁö? // ºñÁ¤»ó : 0 Á¤»ó : 1 // Æ¨±â¸é ÀÔÀåÁ¦ÇÑ½Ã°£À» ±â·Ï ¾ÈÇÔ
-		end
-
-		function main_quest_complete() -- ¼±ÇàÄù½ºÆ® È®ÀÎ
-			if NEED_MAIN_QUEST_FLAME_LV103 > 0 then
-				local main_quest = pc.getf("main_quest_flame_lv103", "__status")
-				if main_quest != nil and main_quest == main_quest_flame_lv103.__COMPLETE__ then
-					return true
-				end
-
-				return false
-			end
-
-			return true
-		end
-
-		function go_boss() -- º¸½º·ë °¡±â
-			local setting = flame_dungeon.setting()
-			if pc.get_level() < 104 then -- ·¹º§È®ÀÎ
-				--syschat(c_locale(1374))
-				say(c_locale(1374))
-				return
-			else
-				if flame_dungeon.main_quest_complete() then
-					--say_title(c_locale(1317))
-					say(c_locale(1317))
-					local warp = select(c_locale(1318), c_locale(1319))
-					if warp == 1 then
-						d.setf("level", 17)
-						d.jump_all(setting.bossroom_entry_pos[1], setting.bossroom_entry_pos[2])
-						d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_fild_boss.txt")
-						--d.spawn_mob(DUNGEON_MAN, setting.DUNGEON_MAN_bpos[1], setting.DUNGEON_MAN_bpos[2])
-						d.spawn_mob(FINAL_BOSS, setting.boss_pos[1], setting.boss_pos[2])
-					end
-				else
-					--syschat(c_locale(1320))
-					say(c_locale(1320))
-					return
-				end
-			end
-		end
-
-		function level_clear() -- ·¹º§ ²£À»¶§, ¸®Á¨Å¬¸®¾î, Áö¿ªÅ¬¸®¾î
-			d.setf("level", 0)
-			d.clear_regen()
-			d.purge_area(750000, 620000, 817400, 689400) -- ¸ÊÀüÃ¼ -- d.purge() »ç¿ë°í·Á
-		end
-
-		function clear_timer(inx) -- Å¸ÀÌ¸Ó ´ÙÁö¿ì±â
-			clear_server_timer("flame_dungeon_0m_left_timer", inx)
-			clear_server_timer("flame_dungeon_1m_left_timer", inx)
-			clear_server_timer("flame_dungeon_5m_left_timer", inx)
-			clear_server_timer("flame_dungeon_10m_left_timer", inx)
-			clear_server_timer("flame_dungeon_15m_left_timer", inx)
-			clear_server_timer("flame_dungeon_30m_left_timer", inx)
-			clear_server_timer("flame_dungeon_45m_left_timer", inx)
-			clear_server_timer("killed_A_1", inx)
-			clear_server_timer("killed_A_2", inx)
-			clear_server_timer("flame_dungeon_ticket_remove", inx)
-		end
-
-		when login begin
-			local idx = pc.get_map_index()
-			local setting = flame_dungeon.setting()
-			if idx == DUNGEON_MAP_INDEX then
-				pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
-			elseif flame_dungeon.is_flamed(idx) then -- ´øÀü ÀÔÀå, º¸½º·ë ÀÔÀå ¿¹¿Ü
-				------------------------------------------------------------------------------------------------------------------------------------------------------
-				-- ¾Æ·¡ÀÇ µÎÁÙÁß À§¿¡ÁÙÀ» »ç¿ëÇÏ¸é ´øÀü¿¡¼­ Á¾·áÇßÀ»°æ¿ì ´Ù½Ã ¿ø·¡ À§Ä¡·Î µ¹¾Æ¿Â´Ù. ¾Æ·¡ÁÙÀ» È°¼ºÈ­ ÇÏ¸é ´øÀü¿¡¼­ Á¾·áÇßÀ» °æ¿ì ´øÀü ¹ÛÀ¸·Î ³ª°¡°Ô µÈ´Ù.
-				-- ´øÀü¿¡¼­ Á¾·áÇßÀ» °æ¿ì ´Ù½Ã ¿ø·¡ À§Ä¡·Î µ¹¾Æ¿Ã °æ¿ì, ´øÀü¿¡¼­ ³ª°¡´Â ¹æ¹ýÀ» ¸¸µé¾îÁà¾ß ÇÏ±â ¶§¹®¿¡ Àû·æ¼ººñÀÇ ³ª°¡±â¶õ ¿É¼ÇÀ» È°¼ºÈ­ ÇØÁà¾ß ÇÑ´Ù.
-				------------------------------------------------------------------------------------------------------------------------------------------------------
-				--pc.set_warp_location(0, 0 , 0) -- Æ¨°åÀ»¶§ ´Ù½Ã µ¹¾Æ¿À°Ô ¸¸µé¾î ÁÖ´Â ºÎºÐ
-				pc.set_warp_location(ENTRY_MAP_INDEX, setting.outside_entry_pos[1], setting.outside_entry_pos[2]) -- ´øÀü ³ª°¬À» ¶§ ¹ÛÀ¸·Î Æ¨±â°ÔÇÔ
-				local ticketGroup = { get_special_item_group(TICKET_GROUP) }
-				if d.getf("dungeon_enter") == 0 then -- ÁøÇàÁßÀÌ ¾Æ´Ï¸é
-					local canPass = false
-					for i = 1, table.getn(ticketGroup), 2 do
-						if pc.count_item(ticketGroup[i]) >= ticketGroup[i + 1] then
-							canPass = true
-							break
-						end
-					end
-
-					if get_global_time() - pc.getf("flame_dungeon", "exit_time") < ENTER_LIMIT_TIME * 60 then -- ÀÔÀåÁ¦ÇÑ½Ã°£ÀÌ °É·ÈÀ¸¸é
-						d.notice(c_locale(1321))
-						say(c_locale(1322))
-						timer("flame_dungeon_warp_timer", 5)
-					elseif not canPass then
-						d.notice(c_locale(1323))
-						say(c_locale(1324))
-						timer("flame_dungeon_warp_timer", 5)
-					elseif pc.get_level() < 100 then
-						d.notice(c_locale(1325))
-						say(c_locale(1326))
-						timer("flame_dungeon_warp_timer", 5)
-					end
-				elseif pc.getf("flame_dungeon", "ticket_delete") == 0 then -- ÁøÇàÁßÀÎµ¥ Æ¼ÄÏÀÌ ¾ÈÁö¿öÁ³À»°æ¿ì
-					for i = 1, table.getn(ticketGroup), 2 do
-						if pc.count_item(ticketGroup[i]) >= ticketGroup[i + 1] then
-							pc.remove_item(ticketGroup[i], ticketGroup[i + 1])
-							break
-						end
-					end
-					pc.setf("flame_dungeon", "ticket_delete", 1)
-				end
-			else
-				pc.setf("flame_dungeon", "ticket_delete", 0)
-			end
-		end
-
-		when flame_dungeon_warp_timer.timer begin
-			local setting = flame_dungeon.setting()
-			pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
-		end
-
-		when logout begin
-			local idx = pc.get_map_index()
-			if flame_dungeon.is_flamed(idx) then
-				if d.getf("dungeon_enter") == 1 then -- Á¤»óÀûÀÎ ´øÀü ÀÔÀå ÈÄ ·Î±×¾Æ¿ô
-					pc.setf("flame_dungeon", "exit_time", get_global_time()) -- ÀÎ½ºÅÏ½º ¾È¿¡¼­ÀÇ ¸¶Áö¸· ½Ã°£À» ±â·Ï, ±Ùµ¥ ½Ã°£Á¦ÇÑ ¶§¹®¿¡ or ±×³É Æ¨±ä°Å¸é ¾È±â·Ï
-				end
-			end
-		end
-
-		when ENTRY_MAN.chat.c_locale(1327) begin
-			local setting = flame_dungeon.setting()
-			if party.is_party() then
-				-- ´øÀü µµÁß ³ª°¥ °æ¿ì ÀçÀÔÀå °¡´ÉÇÏµµ·Ï
-				local party_check = 0
-				if d.find(party.getf("dungeon_index")) then
-					party_check = (d.getf_from_map_index("party_leader_pid", party.getf("dungeon_index")) == party.get_leader_pid())
-				end
-
-				if d.find(party.getf("dungeon_index")) and party_check then
-					if get_global_time() - pc.getf("flame_dungeon", "exit_time") < 5 * 60 then -- Á¢Á¾ ÀÌÈÄ 5ºÐ ³»?
-						local dungeon_level = d.getf_from_map_index("level", party.getf("dungeon_index"))
-						if dungeon_level == 17 then -- º¸½º
-							pc.warp(setting.bossroom_entry_pos[1] * 100, setting.bossroom_entry_pos[2] * 100, party.getf("dungeon_index"))
-						else
-							pc.warp(setting.dungeon_entry_pos[1] * 100, setting.dungeon_entry_pos[2] * 100, party.getf("dungeon_index"))
-						end
-					else -- 5ºÐ ÃÊ°úÇÏ¿© Àç ÀÔÀå ºÒ°¡
-						say_title(c_mob_name(ENTRY_MAN))
-						say(c_locale(1375))
-					end
-				else
-					local pids = { party.get_member_pids() }
-					local noTicketMembers = {}
-					local notEnoughLevelMembers = {}
-					local ticketCheck = true
-					local levelCheck = true
-					local ticketGroup = { get_special_item_group(TICKET_GROUP) }
-					for i, pid in next, pids, nil do
-						q.begin_other_pc_block(pid)
-						local canPass = false
-						for idx = 1, table.getn(ticketGroup), 2 do
-							if pc.count_item(ticketGroup[idx]) >= ticketGroup[idx + 1] then
-								canPass = true
-								break
-							end
-						end
-
-						if not canPass then
-							table.insert(noTicketMembers, pc.get_name())
-							ticketCheck = false
-						end
-
-						if pc.get_level() < LEVEL_CUT then
-							table.insert(notEnoughLevelMembers, pc.get_name())
-							levelCheck = false
-						end
-
-						q.end_other_pc_block()
-					end
-
-					if not ticketCheck then
-						say_title(c_mob_name(ENTRY_MAN))
-						say(c_locale(1377))
-						for i, name in next, noTicketMembers, nil do
-							say(color(1, 1, 0), " " .. name)
-						end
-						if levelCheck then
-							return
-						else
-							wait()
-						end
-					end
-
-					if not levelCheck then
-						say_title(c_mob_name(ENTRY_MAN))
-						say(c_locale(1379))
-						for i, name in next, notEnoughLevelMembers, nil do
-							say(color(1, 1, 0), " " .. name)
-						end
-						return
-					end
-
-					if party.is_leader() then
-						say(c_locale(1328))
-						local warp = select(c_locale(1329), c_locale(1330))
-						if warp == 1 then
-							if party.is_map_member_flag_lt("exit_time", get_global_time() - ENTER_LIMIT_TIME * 60) then
-								flame_dungeon.make_dungeon()
-							else
-								--say("test : ÆÄÆ¼¿øÀÇ ÀÔÀå Á¦ÇÑ½Ã°£ÀÌ ³¡³ªÁö ¾Ê¾Ò½À´Ï´Ù.")
-								say(c_locale(1376))
-							end
-						end
-						party.setf("flame_dungeon_boss_kill_count", 0)
-					else
-						say(c_locale(1331))
-					end
-				end
-			else
-				say(c_locale(1332))
-			end
-		end
-
-		--[[
-		when ENTRY_MAN.chat."Test : ¸®¼Ò½ºÈ®ÀÎ" with is_test_server() begin -- Å×½ºÆ®¿ë
-			local setting = flame_dungeon.setting()
-			pc.setf("flame_dungeon", "fdRtest", 1)
-			pc.warp(setting.dungeon_entry_pos[1] * 100, setting.dungeon_entry_pos[2] * 100, DUNGEON_MAP_INDEX)
-		end
-		]]
-
-		when ENTRY_MAN.chat."TEST : Init time limit init" with is_test_server() begin -- Å×½ºÆ®¿ë
-			pc.setf("flame_dungeon", "exit_time", get_global_time() - 1800)
-			say("Done")
-		end
-
-		--[[
-		when DUNGEON_MAN.chat."Test : ÇöÀç »óÅÂ" with is_test_server() begin -- Å×½ºÆ®¿ë
-			say("³²Àº ¸ó½ºÅÍ : " .. d.count_monster())
-			say("level : " .. d.getf("level"))
-			say("Dmap index : " .. d.get_map_index())
-			say("Pmap index : " .. pc.get_map_index())
-			say("access limit : " .. pc.getf("flame_dungeon", "exit_time"))
-			say("global time : " .. get_global_time())
-			if flame_dungeon.is_flamed(d.get_map_index()) then
-				say("in dungeon") -- is_flamed ÇÔ¼ö Ã¼Å©
-			end
-			if d.is_unique_dead("stone1") then
-				say("stone1 is dead")
-			else
-				say("stone1 is not dead")
-			end
-		end
-		]]
-
-		--[[
-		when DUNGEON_MAN.chat."Ã³À½À¸·Î" begin -- Å×½ºÆ®¿ë
-			say("ÃÊ±âÈ­ ÇÕ´Ï´Ù")
-			flame_dungeon.clear_timer(d.get_map_index())
-			flame_dungeon.make_dungeon()
-		end
-		]]
-
-		when DUNGEON_MAN.chat."Test : Boss Room" with is_test_server() begin -- Å×½ºÆ®¿ë
-			flame_dungeon.go_boss()
-		end
-
-		-- < ½Ã°£ °æ°ú Å¸ÀÌ¸Ó>
-		--[[
-		when DUNGEON_MAN.chat."³ª°¡±â" begin -- ´øÀü¿¡¼­ Æ¨±âÁö ¾Ê°Ô ÇÒ °æ¿ì È°¼ºÈ­
-			local setting = flame_dungeon.setting()
-			say("¹ÛÀ¸·Î ³ª°¡½Ã°Ú½À´Ï±î?")
-			local warp = select("È®ÀÎ", "Ãë¼Ò")
-			if warp == 1 then
-				pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
-			end
-		end
-		]]
-
-		when flame_dungeon_45m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(1334, 45))
-				d.notice(c_locale(1333))
-				server_timer("flame_dungeon_30m_left_timer", 15 * 60, get_server_timer_arg())
-			end
-		end
-
-		when flame_dungeon_30m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(1334, 30))
-				d.notice(c_locale(1333))
-				server_timer("flame_dungeon_15m_left_timer", 15 * 60, get_server_timer_arg())
-			end
-		end
-
-		when flame_dungeon_15m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(1334, 15))
-				d.notice(c_locale(1333))
-				server_timer("flame_dungeon_5m_left_timer", 10 * 60, get_server_timer_arg())
-			end
-		end
-
-		when flame_dungeon_5m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(1334, 5))
-				d.notice(c_locale(1333))
-				server_timer("flame_dungeon_1m_left_timer", 4 * 60, get_server_timer_arg())
-			end
-		end
-
-		when flame_dungeon_1m_left_timer.server_timer begin
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(1334, 1))
-				d.notice(c_locale(1333))
-				server_timer("flame_dungeon_0m_left_timer", 60, get_server_timer_arg())
-			end
-		end
-
-		when flame_dungeon_0m_left_timer.server_timer begin
-			local setting = flame_dungeon.setting()
-			if d.select(get_server_timer_arg()) then
-				d.notice(c_locale(1335))
-				d.notice(c_locale(1336))
-				server_timer("dungeon_end_timer", 10, d.get_map_index())
-			end
-		end
-
-		-- <<<< ´øÀü ÁøÇà>>>> --
-		when DUNGEON_MAN.chat.c_locale(1337) with npc.lock() begin -- '0x'´Â x¹øÂ° ·¹º§ Äù½ºÆ® ¹ÞÀ» ¼ö ÀÖ´Â »óÅÂ , '1x'´Â x¹øÂ° ·¹º§ Äù½ºÆ® ÁøÇàÁß
-			local setting = flame_dungeon.setting()
-			if d.getf("started") == 0 then
-				say(c_locale(1339))
-				say(c_locale(1340))
-				wait()
-				d.setf("started", 1)
-				-- ÆÄÆ¼¿øÀÌ Æ¨°Ü¹ö·È´Âµ¥ ÀÚ±â¸¸ ³²¾Æ¼­ exit timer°¡ ¸®¼ÂµÇ¸é ¾ÈµÇ´Ï±ñ ´ÙÀ½·¹º§À» ´­·¶À»¶§¸¦ ½ÃÀÛÇÒ¶§·Î º½
-				server_timer("flame_dungeon_45m_left_timer", 15 * 60, d.get_map_index())
-				d.notice(c_locale(1341))
-				d.notice(c_locale(1333))
-
-				-- ÅëÇàÁõ °ü·ÃµÈ Ã³¸®
-				-- ÀÔÀå ÈÄ¿¡ Æ¼ÄÏÀ» ¾ø¾Ø »ç¶÷À» Æ¨°Ü³»±â À§ÇØ¼­ Å¸ÀÌ¸Ó¸¦ ÀÌ¿ëÇØ Æ¼ÄÏÀ» Á¦°ÅÇÑ´Ù.
-				local pids = { party.get_member_pids() }
-				local ticketGroup = { get_special_item_group(TICKET_GROUP) }
-				for i, pid in next, pids, nil do
-					q.begin_other_pc_block(pid)
-					local canPass = false
-					for idx = 1, table.getn(ticketGroup), 2 do
-						if pc.count_item(ticketGroup[idx]) >= ticketGroup[idx + 1] then
-							canPass = true
-							pc.remove_item(ticketGroup[idx], ticketGroup[idx + 1])
-							break
-						end
-					end
-
-					if not canPass then
-						pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
-					end
-
-					q.end_other_pc_block()
-				end
-
-				d.setqf2("flame_dungeon", "ticket_delete", 1)
-				d.setf("dungeon_enter", 1)
-
-				-- ´øÀü°ú ÆÄÆ¼¿¡ ¼­·Î¿¡ ´ëÇÑ Á¤º¸¸¦ ÀúÀåÇÑ´Ù.
-				party.setf("dungeon_index", d.get_map_index())
-				d.setf("party_leader_pid", party.get_leader_pid())
-			end
-
-			if d.getf("level") < 7 then -- ÁøÇàÁßÀÌ ¾Æ´Ï¸é
-				if d.getf("clear_count") == 6 then -- ¹æ ¿©¼¸°³ ÇßÀ¸¸é º¸½º¹æ
-					d.setf("level", 7)
-				else
-					local rand = number(1, 6) --·£´ý¿¡¼­ ¹æ¹®Ã¼Å©´Â µû·Î ¹è¿­¾øÀÌ ¹æÀÇ ¹®ÀÇ ¿­·ÁÀÖ´ÂÁö·Î Ã¼Å©ÇÔ
-					local setlev = 0
-					d.setf("level", 7) -- È¤½Ã ¸ð¸¦ ¹®Á¦°¡ »ý°Ü ·¹º§ÀÌ ¾ÈÀâÈú°æ¿ì¸¦ ´ëºñÇØ º¸½º·ëÀ¸·Î ¼ÂÆÃÇØµÒ
-					for i = 1, 50 do
-						setlev = setlev + 1
-						if setlev > 6 then
-							setlev = 1
-						end
-						if not d.is_unique_dead("door" .. setlev) then
-							rand = rand - 1
-							if rand == 0 then
-								d.setf("level", setlev)
-								d.setf("clear_count", d.getf("clear_count") + 1)
-								break
-							end
-						end
-					end
-				end
-			end
-
-			if d.getf("level") == 1 then
-				say(c_locale(1342))
-				d.notice(c_locale(1342))
-				d.kill_unique("door1")
-				d.kill_unique("idoor1")
-				d.setf("level", 11)
-				d.regen_file(MOB_REGEN_FILE_PATH .. "fd_a.txt")
-				server_timer("killed_A_1", 12, d.get_map_index())
-			elseif d.getf("level") == 11 then
-				say(c_locale(1343))
-				say_title(c_locale(1344) .. d.count_monster())
-			elseif d.getf("level") == 2 then
-				say(c_locale(1345))
-				d.notice(c_locale(1345))
-				d.spawn_mob(LEVEL2_STONE, setting.LEVEL2_STONE_pos[1], setting.LEVEL2_STONE_pos[2]) -- ºÀÀÎ¼® ¼ÒÈ¯
-				d.kill_unique("door2")
-				d.kill_unique("idoor2")
-				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_b.txt")
-				d.setf("level", 12)
-			elseif d.getf("level") == 12 then
-				say(c_locale(1347))
-			elseif d.getf("level") == 3 then
-				say(c_locale(1342))
-				d.notice(c_locale(1342))
-				d.kill_unique("door3")
-				d.kill_unique("idoor3")
-				d.setf("level", 13)
-				d.regen_file(MOB_REGEN_FILE_PATH .. "fd_c.txt")
-				server_timer("killed_A_1", 12, d.get_map_index())
-			elseif d.getf("level") == 13 then
-				say(c_locale(1343))
-				say_title(c_locale(1344) .. d.count_monster())
-			elseif d.getf("level") == 4 then -- 474 178
-				say(c_locale(1348))
-				d.notice(c_locale(1348))
-				d.setf("level", 14)
-				d.kill_unique("door4")
-				d.kill_unique("idoor4")
-				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_d.txt")
-				d.spawn_mob(LEVEL4_TARGET, setting.LEVEL4_TARGET_pos[1], setting.LEVEL4_TARGET_pos[2]) -- Å¸°Ù¸ó½ºÅÍ ¼ÒÇÑ
-			elseif d.getf("level") == 14 then
-				say(c_locale(1349))
-				say(c_locale(1350))
-			elseif d.getf("level") == 5 then -- 510 355
-				say(c_locale(1351))
-				say(c_locale(1352))
-				d.notice(c_locale(1351))
-				d.notice(c_locale(1352))
-				d.kill_unique("door5")
-				d.kill_unique("idoor5")
-				d.setf("level", 15)
-				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
-				local vis = { 0, 0, 0, 0, 0, 0, 0 }
-				for i = 1, 7 do
-					vis[i] = 0
-				end
-				for i = 1, 7 do -- ·£´ýÇÏ°Ô µ¹¼ÒÈ¯
-					local ran = number(1, 7)
-					local st = 0
-					for j = 1, 50 do
-						st = st + 1
-						if st > 7 then
-							st = 1
-						end
-						if vis[st] == 0 then
-							ran = ran - 1
-							if ran == 0 then
-								vis[st] = 1
-								d.set_unique("stone5_" .. st, d.spawn_mob(LEVEL5_STONE, setting.LEVEL5_STONE_pos[i][1], setting.LEVEL5_STONE_pos[i][2]))
-								break
-							end
-						end
-					end
-				end
-			elseif d.getf("level") == 15 then
-				say(c_locale(1353))
-			elseif d.getf("level") == 6 then -- 507 490
-				say(c_locale(1354))
-				d.notice(c_locale(1354))
-				d.setf("level", 16)
-				d.kill_unique("door6")
-				d.kill_unique("idoor6")
-				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_f.txt")
-				d.spawn_mob(LEVEL6_TARGET, setting.LEVEL6_TARGET_pos[1], setting.LEVEL6_TARGET_pos[2]) -- Å¸°Ù¿ÀºêÁ§Æ® ¼ÒÈ¯
-			elseif d.getf("level") == 16 then
-				say(c_locale(1356))
-			elseif d.getf("level") == 7 then
-				--setskin(NOWINDOW)
-				flame_dungeon.go_boss()
-			else
-				say(c_locale(1357))
-			end
-			npc.unlock()
-		end
-
-		when dungeon_end_timer.server_timer begin -- Á¾·á Å¸ÀÌ¸Ó (³¡³ª°í ³ª°¡´Â°Å)
-			local setting = flame_dungeon.setting()
-			if d.select(get_server_timer_arg()) then
-				flame_dungeon.clear_timer(d.get_map_index())
-				d.set_warp_location(ENTRY_MAP_INDEX, setting.outside_entry_pos[1], setting.outside_entry_pos[2])
-				d.exit_all()
-				d.setf("party_leader_pid", 0)
-			end
-		end
-
-		when killed_A_1.server_timer begin -- Å¸ÀÌ¸Ó µ¹¸®±â1 (level1, level3)
-			if d.select(get_server_timer_arg()) then
-				if d.count_monster() <= 0 then -- 1·¹º§ ¸ó½ºÅÍ Àü¸ê½Ã
-					if d.getf("level") == 11 then
-						d.notice(c_locale(1358))
-						d.notice(c_locale(1359))
-					else
-						d.notice(c_locale(1358))
-						d.notice(c_locale(1359))
-					end
-					d.setf("level",0)
-				else
-					server_timer("killed_A_2", 6, get_server_timer_arg())
-				end
-			end
-		end
-
-		when killed_A_2.server_timer begin -- Å¸ÀÌ¸Ó µ¹¸®±â2 (1°ú 2 ¹ø°¥¾Æ°¡¸é¼­ µ¹¾Æ°¨)
-			if d.select(get_server_timer_arg()) then
-				if d.count_monster() <= 0 then -- 1·¹º§ ¸ó½ºÅÍ Àü¸ê½Ã
-					if d.getf("level") == 11 then
-						d.notice(c_locale(1358))
-						d.notice(c_locale(1359))
-					else
-						d.notice(c_locale(1358))
-						d.notice(c_locale(1359))
-					end
-					d.setf("level", 0)
-				else
-					server_timer("killed_A_1", 6, get_server_timer_arg())
-				end
-			end
-		end
-
-		when kill with flame_dungeon.is_flamed(pc.get_map_index()) and d.getf("level") == 12 begin -- 2·¹º§ ºÀÀÎ¼® ¿­¼è µå¶ø
-			local i = number(1, 100) -- 100ºÐÀÇ 1 È®·ü·Î ¿­¼èµå¶ø
-			if i == 1 then
-				game.drop_item(LEVEL2_KEY, 1)
-			end
-		end
-
-		when LEVEL2_STONE.take with flame_dungeon.is_flamed(pc.get_map_index()) and item.get_vnum() == LEVEL2_KEY and d.getf("level") == 12 begin -- 2·¹º§ ¿­¼è ¸Ô¾úÀ»¶§
-			local i = number(1, 5) -- 5ºÐÀÇ 1 È®·ü·Î ÁøÂ¥ ¿­¼è
-			if i == 1 then
-				npc.purge()
-				item.remove()
-				d.notice(c_locale(1360))
-				d.notice(c_locale(1359))
-				flame_dungeon.level_clear()
-			else
-				item.remove()
-				say(c_locale(1361))
-			end
-		end
-
-		when LEVEL4_TARGET.kill with flame_dungeon.is_flamed(pc.get_map_index()) and d.getf("level") == 14 begin
-			d.notice(c_locale(1362))
-			d.notice(c_locale(1359))
-			flame_dungeon.level_clear()
-		end
-
-		when kill with flame_dungeon.is_flamed(pc.get_map_index()) and d.getf("level") == 15 begin -- 5·¹º§ ºÀÀÎ¼® ¿­¼è µå¶ø
-			local i = number(1, 30) -- 30ºÐÀÇ 1 È®·ü·Î ¿­¼èµå¶ø
-			if i == 1 then
-				game.drop_item(LEVEL5_REALKEY, 1)
-			end
-		end
-
-		when LEVEL5_STONE.take with flame_dungeon.is_flamed(d.get_map_index()) and item.get_vnum() == LEVEL5_REALKEY and d.getf("level") == 15 begin -- 5·¹º§ ÁøÂ¥¿­¼è ¸Ô¾úÀ»¶§
-			local setting = flame_dungeon.setting()
-			if npc.get_vid() == d.get_unique_vid("stone5_1") then -- Ã¹¹øÂ° ²¨´Â ¼±ÇàµÇ¾î¾ß ÇÒ ÀÏÀÌ ÇÊ¿ä¾øÀ¸´Ï Ã£ÀÚ¸¶ÀÚ Á¦°ÅÇØÁÜ
-				npc.purge()
-				item.remove()
-				say(c_locale(1363))
-				d.setf("stonekill", 2) -- 2¹ø µ¹À» Á×¿©¶ó
-				if d.count_monster() < LEVEL5_GEN_LIMIT then
-					d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
-				end
-			elseif npc.get_vid() == d.get_unique_vid("stone5_2") then
-				if d.getf("stonekill") == 2 then -- 2¹øµ¹À» Á×ÀÏ Â÷·Ëµ¥ 2¹øµ¹¿¡°Ô ¿­¼è¸¦ ¸Ô¿´À» ¶§
-					npc.purge()
-					item.remove()
-					say(c_locale(1364))
-					d.setf("stonekill", 3)
-					if d.count_monster() < LEVEL5_GEN_LIMIT then
-						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
-					end
-				else
-					item.remove()
-					say(c_locale(1365))
-					if is_test_server() then
-						say("2th")
-					end
-				end
-			elseif npc.get_vid() == d.get_unique_vid("stone5_3") then
-				if d.getf("stonekill") == 3 then
-					npc.purge()
-					item.remove()
-					say(c_locale(1366))
-					d.setf("stonekill", 4)
-					if d.count_monster() < LEVEL5_GEN_LIMIT then
-						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
-					end
-				else
-					item.remove()
-					say(c_locale(1365))
-					if is_test_server() then
-						say("3th")
-					end
-				end
-			elseif npc.get_vid() == d.get_unique_vid("stone5_4") then
-				if d.getf("stonekill") == 4 then
-					npc.purge()
-					item.remove()
-					say(c_locale(1367))
-					d.setf("stonekill", 5)
-					if d.count_monster() < LEVEL5_GEN_LIMIT then
-						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
-					end
-				else
-					item.remove()
-					say(c_locale(1365))
-					if is_test_server() then
-						say("4th")
-					end
-				end
-			elseif npc.get_vid() == d.get_unique_vid("stone5_5") then
-				if d.getf("stonekill") == 5 then
-					npc.purge()
-					item.remove()
-					say(c_locale(1368))
-					d.setf("stonekill", 6)
-					if d.count_monster() < LEVEL5_GEN_LIMIT then
-						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
-					end
-				else
-					item.remove()
-					say(c_locale(1365))
-					if is_test_server() then
-						say("5th")
-					end
-				end
-			elseif npc.get_vid() == d.get_unique_vid("stone5_6") then
-				if d.getf("stonekill") == 6 then
-					npc.purge()
-					item.remove()
-					say(c_locale(1369))
-					d.setf("stonekill", 7)
-					if d.count_monster() < LEVEL5_GEN_LIMIT then
-						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
-					end
-				else
-					item.remove()
-					say(c_locale(1365))
-					if is_test_server() then
-						say("6th")
-					end
-				end
-			else
-				if d.getf("stonekill") == 7 then
-					npc.purge()
-					item.remove()
-					d.notice(c_locale(1360))
-					d.notice(c_locale(1359))
-					flame_dungeon.level_clear()
-				else
-					item.remove()
-					say(c_locale(1365))
-					if is_test_server() then
-						say("7th")
-					end
-				end
-			end
-		end
-
-		when LEVEL6_TARGET.kill with flame_dungeon.is_flamed(d.get_map_index()) and d.getf("level") == 16 begin -- ¸Á¸¶¼® ÆÄ±«ÇßÀ» ¶§
-			d.notice(c_locale(1370))
-			d.notice(c_locale(1359))
-			flame_dungeon.level_clear()
-		end
-
-		when FINAL_BOSS.kill with flame_dungeon.is_flamed(d.get_map_index()) and d.getf("level") == 17 begin -- º¸½º Á×¿´À»¶§
-			d.setqf2_all_near("flame_dungeon", "yamachun_boss", 1, 800)
-
-			d.notice(c_locale(1371))
-			d.notice(c_locale(1372))
-
-			server_timer("dungeon_end_timer", 60, d.get_map_index())
-			flame_dungeon.level_clear()
-
-			-- ÆÄÆ¼¿ø Áß, ¾ß¸¶Ãµ Àâ´Â Äù½ºÆ®(104·¾, 105·¾ Äù½ºÆ®) ÁøÇàÁßÀÎ »ç¶÷ÀÌ ÀÖÀ¸¸é Äù½ºÆ® Å¬¸®¾î µÇµµ·Ï.
-			if party.is_party() then
-				party.setf("flame_dungeon_boss_kill_count", 1)
-			end
-		end
-	end
-end
+define BLOCK_DOOR 20387
+define DUNGEON_MAN 20385
+define DUNGEON_MAN_DIR 0
+define DUNGEON_MAP_INDEX 351
+define ENTER_LIMIT_TIME 30
+define ENTRY_MAN 20394
+define ENTRY_MAP_INDEX 62
+define FINAL_BOSS 6091
+define LEVEL2_KEY 30329
+define LEVEL2_STONE 20386
+define LEVEL4_TARGET 6051
+define LEVEL5_REALKEY 30330
+define LEVEL5_STONE 20386
+define LEVEL5_GEN_LIMIT 100
+define LEVEL6_TARGET 8057
+define LEVEL_CUT 100
+define MOB_REGEN_FILE_PATH = "data/dungeon/flame_dungeon/"
+define IN_DOOR 20388
+define NPC_REGEN_FILE_PATH = "data/dungeon/flame_dungeon/npc.txt"
+define TICKET_GROUP 10034
+define LIMITED_TICKET_GROUP 10033
+define NEED_MAIN_QUEST_FLAME_LV103 0
+
+quest flame_dungeon begin
+	--[[
+	state start begin
+		when ENTRY_MAN.click with pc.get_level() >= 90 begin
+			pc.give_item2(LIMITED_PASS_TICKET, 1)
+			set_state(run)
+		end
+	end
+	]]
+
+	-- state run begin
+	state start begin
+		function setting()
+			return {
+				["bossroom_entry_pos"] = { 8109, 6867 }, -- 685, 723
+				["boss_pos"] = { 686, 637 },
+				["doors_pos"] = {
+					{ 320, 394 },
+					{ 293, 359 },
+					{ 333, 321 },
+					{ 378, 320 },
+					{ 400, 355 },
+					{ 394, 401 }
+				},
+				["idoors_pos"] = {
+					{ 268, 447 },
+					{ 234, 359 },
+					{ 300, 264 },
+					{ 454, 217 },
+					{ 470, 355 },
+					{ 467, 469 }
+				},
+				["doors_dir"] = { 135, 90, 210, 152, 90, 223 },
+				["idoors_dir"] = { 135, 90, 210, 135, 90, 239 },
+				["dungeon_entry_pos"] = { 7762, 6739 }, --  Ã³  
+				["DUNGEON_MAN_bpos"] = { 690, 722 },
+				["DUNGEON_MAN_pos"] = { 354, 362 },
+				["LEVEL2_STONE_pos"] = { 195, 352 },
+				["LEVEL4_TARGET_pos"] = { 470, 175 },
+				["LEVEL5_STONE_pos"] = {
+					{ 486, 345 },
+					{ 511, 336 },
+					{ 525, 349 },
+					{ 521, 365 },
+					{ 503, 372 },
+					{ 486, 365 },
+					{ 500, 354 }
+				},
+				["LEVEL6_TARGET_pos"] = { 511, 480 },
+				["outside_entry_pos"] = { 6142, 7068 }, -- Ö´Â¾ Ö´ 
+				["YAK_pos"] = { 376, 397 } -- È¯ 
+			}
+		end
+
+		function is_flamed(idx) -- æ¼º Ö´ È®
+			return idx >= DUNGEON_MAP_INDEX * 10000 and idx < (DUNGEON_MAP_INDEX + 1) * 10000
+		end
+
+		function make_dungeon()
+			local setting = flame_dungeon.setting()
+			if not party.is_party() then
+				say("You must be in a party to enter this dungeon.")
+				return
+			end
+			d.new_jump_party(DUNGEON_MAP_INDEX, setting.dungeon_entry_pos[1], setting.dungeon_entry_pos[2])
+			d.spawn_mob(setting.DUNGEON_MAN, setting.DUNGEON_MAN_pos[1], setting.DUNGEON_MAN_pos[2])
+			--d.spawn_mob(YAK, setting.YAK_pos[1], setting.YAK_pos[2])
+			d.regen_file(NPC_REGEN_FILE_PATH)
+			d.setf("level", 0)
+			for i = 1, 6 do
+				d.set_unique("door" .. i, d.spawn_mob_ac_dir(BLOCK_DOOR, setting.doors_pos[i][1], setting.doors_pos[i][2], setting.doors_dir[i]))
+			end
+			for i = 1, 6 do
+				d.set_unique("idoor" .. i, d.spawn_mob_ac_dir(IN_DOOR, setting.idoors_pos[i][1], setting.idoors_pos[i][2], setting.idoors_dir[i]))
+			end
+			d.setf("clear_count", 0)
+			d.setf("started", 0)
+			d.setf("dungeon_enter", 0) --  ß´? //  : 0  : 1 // Æ¨ Ñ½Ã°  
+		end
+
+		function main_quest_complete() -- Æ® È®
+			if NEED_MAIN_QUEST_FLAME_LV103 > 0 then
+				local main_quest = pc.getf("main_quest_flame_lv103", "__status")
+				if main_quest != nil and main_quest == main_quest_flame_lv103.__COMPLETE__ then
+					return true
+				end
+
+				return false
+			end
+
+			return true
+		end
+
+		function go_boss() --  
+			local setting = flame_dungeon.setting()
+			if pc.get_level() < 104 then -- È®
+				--syschat(c_locale(1374))
+				say(c_locale(1374))
+				return
+			else
+				if flame_dungeon.main_quest_complete() then
+					--say_title(c_locale(1317))
+					say(c_locale(1317))
+					local warp = select(c_locale(1318), c_locale(1319))
+					if warp == 1 then
+						d.setf("level", 17)
+						d.jump_all(setting.bossroom_entry_pos[1], setting.bossroom_entry_pos[2])
+						d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_fild_boss.txt")
+						--d.spawn_mob(DUNGEON_MAN, setting.DUNGEON_MAN_bpos[1], setting.DUNGEON_MAN_bpos[2])
+						d.spawn_mob(FINAL_BOSS, setting.boss_pos[1], setting.boss_pos[2])
+					end
+				else
+					--syschat(c_locale(1320))
+					say(c_locale(1320))
+					return
+				end
+			end
+		end
+
+		function level_clear() --  , Å¬, Å¬
+			d.setf("level", 0)
+			d.clear_regen()
+			d.purge_area(750000, 620000, 817400, 689400) -- Ã¼ -- d.purge() 
+		end
+
+		function clear_timer(inx) -- Å¸Ì¸ 
+			clear_server_timer("flame_dungeon_0m_left_timer", inx)
+			clear_server_timer("flame_dungeon_1m_left_timer", inx)
+			clear_server_timer("flame_dungeon_5m_left_timer", inx)
+			clear_server_timer("flame_dungeon_10m_left_timer", inx)
+			clear_server_timer("flame_dungeon_15m_left_timer", inx)
+			clear_server_timer("flame_dungeon_30m_left_timer", inx)
+			clear_server_timer("flame_dungeon_45m_left_timer", inx)
+			clear_server_timer("killed_A_1", inx)
+			clear_server_timer("killed_A_2", inx)
+			clear_server_timer("flame_dungeon_ticket_remove", inx)
+		end
+
+		when login begin
+			local idx = pc.get_map_index()
+			local setting = flame_dungeon.setting()
+			if idx == DUNGEON_MAP_INDEX then
+				pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
+			elseif flame_dungeon.is_flamed(idx) then --  ,   
+				------------------------------------------------------------------------------------------------------------------------------------------------------
+				-- Æ·   Ï¸   Ù½  Ä¡ Æ¿Â´. Æ· È°È­ Ï¸       È´.
+				--    Ù½  Ä¡ Æ¿ ,     Ï±  æ¼º  É¼ È°È­  Ñ´.
+				------------------------------------------------------------------------------------------------------------------------------------------------------
+				--pc.set_warp_location(0, 0 , 0) -- Æ¨ Ù½ Æ¿  Ö´ Îº
+				pc.set_warp_location(ENTRY_MAP_INDEX, setting.outside_entry_pos[1], setting.outside_entry_pos[2]) --     Æ¨
+				local ticketGroup = { get_special_item_group(TICKET_GROUP) }
+				if d.getf("dungeon_enter") == 0 then --  Æ´Ï¸
+					local canPass = false
+					for i = 1, table.getn(ticketGroup), 2 do
+						if pc.count_item(ticketGroup[i]) >= ticketGroup[i + 1] then
+							canPass = true
+							break
+						end
+					end
+
+					if get_global_time() - pc.getf("flame_dungeon", "exit_time") < ENTER_LIMIT_TIME * 60 then -- Ñ½Ã° É·
+						d.notice(c_locale(1321))
+						say(c_locale(1322))
+						timer("flame_dungeon_warp_timer", 5)
+					elseif not canPass then
+						d.notice(c_locale(1323))
+						say(c_locale(1324))
+						timer("flame_dungeon_warp_timer", 5)
+					elseif pc.get_level() < 100 then
+						d.notice(c_locale(1325))
+						say(c_locale(1326))
+						timer("flame_dungeon_warp_timer", 5)
+					end
+				elseif pc.getf("flame_dungeon", "ticket_delete") == 0 then -- Îµ Æ¼ 
+					for i = 1, table.getn(ticketGroup), 2 do
+						if pc.count_item(ticketGroup[i]) >= ticketGroup[i + 1] then
+							pc.remove_item(ticketGroup[i], ticketGroup[i + 1])
+							break
+						end
+					end
+					pc.setf("flame_dungeon", "ticket_delete", 1)
+				end
+			else
+				pc.setf("flame_dungeon", "ticket_delete", 0)
+			end
+		end
+
+		when flame_dungeon_warp_timer.timer begin
+			local setting = flame_dungeon.setting()
+			pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
+		end
+
+		when logout begin
+			local idx = pc.get_map_index()
+			if flame_dungeon.is_flamed(idx) then
+				if d.getf("dungeon_enter") == 1 then --     Î±×¾Æ¿
+					pc.setf("flame_dungeon", "exit_time", get_global_time()) -- Î½Ï½ È¿  Ã° , Ùµ Ã°  or ×³ Æ¨Å¸ È±
+				end
+			end
+		end
+
+		when ENTRY_MAN.chat.c_locale(1327) begin
+			local setting = flame_dungeon.setting()
+			if party.is_party() then
+				--      Ïµ
+				local party_check = 0
+				if d.find(party.getf("dungeon_index")) then
+					party_check = (d.getf_from_map_index("party_leader_pid", party.getf("dungeon_index")) == party.get_leader_pid())
+				end
+
+				if d.find(party.getf("dungeon_index")) and party_check then
+					if get_global_time() - pc.getf("flame_dungeon", "exit_time") < 5 * 60 then --   5 ?
+						local dungeon_level = d.getf_from_map_index("level", party.getf("dungeon_index"))
+						if dungeon_level == 17 then -- 
+							pc.warp(setting.bossroom_entry_pos[1] * 100, setting.bossroom_entry_pos[2] * 100, party.getf("dungeon_index"))
+						else
+							pc.warp(setting.dungeon_entry_pos[1] * 100, setting.dungeon_entry_pos[2] * 100, party.getf("dungeon_index"))
+						end
+					else -- 5 Ê°Ï¿   Ò°
+						say_title(c_mob_name(ENTRY_MAN))
+						say(c_locale(1375))
+					end
+				else
+					local pids = { party.get_member_pids() }
+					local noTicketMembers = {}
+					local notEnoughLevelMembers = {}
+					local ticketCheck = true
+					local levelCheck = true
+					local ticketGroup = { get_special_item_group(TICKET_GROUP) }
+					for i, pid in next, pids, nil do
+						q.begin_other_pc_block(pid)
+						local canPass = false
+						for idx = 1, table.getn(ticketGroup), 2 do
+							if pc.count_item(ticketGroup[idx]) >= ticketGroup[idx + 1] then
+								canPass = true
+								break
+							end
+						end
+
+						if not canPass then
+							table.insert(noTicketMembers, pc.get_name())
+							ticketCheck = false
+						end
+
+						if pc.get_level() < LEVEL_CUT then
+							table.insert(notEnoughLevelMembers, pc.get_name())
+							levelCheck = false
+						end
+
+						q.end_other_pc_block()
+					end
+
+					if not ticketCheck then
+						say_title(c_mob_name(ENTRY_MAN))
+						say(c_locale(1377))
+						for i, name in next, noTicketMembers, nil do
+							say(color(1, 1, 0), " " .. name)
+						end
+						if levelCheck then
+							return
+						else
+							wait()
+						end
+					end
+
+					if not levelCheck then
+						say_title(c_mob_name(ENTRY_MAN))
+						say(c_locale(1379))
+						for i, name in next, notEnoughLevelMembers, nil do
+							say(color(1, 1, 0), " " .. name)
+						end
+						return
+					end
+
+					if party.is_leader() then
+						say(c_locale(1328))
+						local warp = select(c_locale(1329), c_locale(1330))
+						if warp == 1 then
+							if party.is_map_member_flag_lt("exit_time", get_global_time() - ENTER_LIMIT_TIME * 60) then
+								flame_dungeon.make_dungeon()
+							else
+								--say("test : Æ¼  Ñ½Ã°  Ê¾Ò½Ï´.")
+								say(c_locale(1376))
+							end
+						end
+						party.setf("flame_dungeon_boss_kill_count", 0)
+					else
+						say(c_locale(1331))
+					end
+				end
+			else
+				say(c_locale(1332))
+			end
+		end
+
+		--[[
+		when ENTRY_MAN.chat."Test : Ò½È®" with is_test_server() begin -- ×½Æ®
+			local setting = flame_dungeon.setting()
+			pc.setf("flame_dungeon", "fdRtest", 1)
+			pc.warp(setting.dungeon_entry_pos[1] * 100, setting.dungeon_entry_pos[2] * 100, DUNGEON_MAP_INDEX)
+		end
+		]]
+
+		when ENTRY_MAN.chat."TEST : Init time limit init" with is_test_server() begin -- ×½Æ®
+			pc.setf("flame_dungeon", "exit_time", get_global_time() - 1800)
+			say("Done")
+		end
+
+		--[[
+		when DUNGEON_MAN.chat."Test :  " with is_test_server() begin -- ×½Æ®
+			say("  : " .. d.count_monster())
+			say("level : " .. d.getf("level"))
+			say("Dmap index : " .. d.get_map_index())
+			say("Pmap index : " .. pc.get_map_index())
+			say("access limit : " .. pc.getf("flame_dungeon", "exit_time"))
+			say("global time : " .. get_global_time())
+			if flame_dungeon.is_flamed(d.get_map_index()) then
+				say("in dungeon") -- is_flamed Ô¼ Ã¼Å©
+			end
+			if d.is_unique_dead("stone1") then
+				say("stone1 is dead")
+			else
+				say("stone1 is not dead")
+			end
+		end
+		]]
+
+		--[[
+		when DUNGEON_MAN.chat."Ã³" begin -- ×½Æ®
+			say("Ê±È­ Õ´Ï´")
+			flame_dungeon.clear_timer(d.get_map_index())
+			flame_dungeon.make_dungeon()
+		end
+		]]
+
+		when DUNGEON_MAN.chat."Test : Boss Room" with is_test_server() begin -- ×½Æ®
+			flame_dungeon.go_boss()
+		end
+
+		-- < Ã°  Å¸Ì¸>
+		--[[
+		when DUNGEON_MAN.chat."" begin --  Æ¨ Ê°   È°È­
+			local setting = flame_dungeon.setting()
+			say(" Ã°Ú½Ï±?")
+			local warp = select("È®", "")
+			if warp == 1 then
+				pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
+			end
+		end
+		]]
+
+		when flame_dungeon_45m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(1334, 45))
+				d.notice(c_locale(1333))
+				server_timer("flame_dungeon_30m_left_timer", 15 * 60, get_server_timer_arg())
+			end
+		end
+
+		when flame_dungeon_30m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(1334, 30))
+				d.notice(c_locale(1333))
+				server_timer("flame_dungeon_15m_left_timer", 15 * 60, get_server_timer_arg())
+			end
+		end
+
+		when flame_dungeon_15m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(1334, 15))
+				d.notice(c_locale(1333))
+				server_timer("flame_dungeon_5m_left_timer", 10 * 60, get_server_timer_arg())
+			end
+		end
+
+		when flame_dungeon_5m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(1334, 5))
+				d.notice(c_locale(1333))
+				server_timer("flame_dungeon_1m_left_timer", 4 * 60, get_server_timer_arg())
+			end
+		end
+
+		when flame_dungeon_1m_left_timer.server_timer begin
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(1334, 1))
+				d.notice(c_locale(1333))
+				server_timer("flame_dungeon_0m_left_timer", 60, get_server_timer_arg())
+			end
+		end
+
+		when flame_dungeon_0m_left_timer.server_timer begin
+			local setting = flame_dungeon.setting()
+			if d.select(get_server_timer_arg()) then
+				d.notice(c_locale(1335))
+				d.notice(c_locale(1336))
+				server_timer("dungeon_end_timer", 10, d.get_map_index())
+			end
+		end
+
+		-- <<<<  >>>> --
+		when DUNGEON_MAN.chat.c_locale(1337) with npc.lock() begin -- '0x' xÂ°  Æ®   Ö´  , '1x' xÂ°  Æ® 
+			local setting = flame_dungeon.setting()
+			if d.getf("started") == 0 then
+				say(c_locale(1339))
+				say(c_locale(1340))
+				wait()
+				d.setf("started", 1)
+				-- Æ¼ Æ¨Ü¹È´Âµ Ú±â¸¸ Æ¼ exit timer ÂµÇ¸ ÈµÇ´Ï±   Ò¶ 
+				server_timer("flame_dungeon_45m_left_timer", 15 * 60, d.get_map_index())
+				d.notice(c_locale(1341))
+				d.notice(c_locale(1333))
+
+				--  Ãµ Ã³
+				--  Ä¿ Æ¼   Æ¨Ü³ Ø¼ Å¸Ì¸Ó¸ Ì¿ Æ¼ Ñ´.
+				local pids = { party.get_member_pids() }
+				local ticketGroup = { get_special_item_group(TICKET_GROUP) }
+				for i, pid in next, pids, nil do
+					q.begin_other_pc_block(pid)
+					local canPass = false
+					for idx = 1, table.getn(ticketGroup), 2 do
+						if pc.count_item(ticketGroup[idx]) >= ticketGroup[idx + 1] then
+							canPass = true
+							pc.remove_item(ticketGroup[idx], ticketGroup[idx + 1])
+							break
+						end
+					end
+
+					if not canPass then
+						pc.warp(setting.outside_entry_pos[1] * 100, setting.outside_entry_pos[2] * 100, ENTRY_MAP_INDEX)
+					end
+
+					q.end_other_pc_block()
+				end
+
+				d.setqf2("flame_dungeon", "ticket_delete", 1)
+				d.setf("dungeon_enter", 1)
+
+				--  Æ¼ Î¿   Ñ´.
+				party.setf("dungeon_index", d.get_map_index())
+				d.setf("party_leader_pid", party.get_leader_pid())
+			end
+
+			if d.getf("level") < 7 then --  Æ´Ï¸
+				if d.getf("clear_count") == 6 then --    
+					d.setf("level", 7)
+				else
+					local rand = number(1, 6) -- æ¹®Ã¼Å©  è¿­   Ö´ Ã¼Å©
+					local setlev = 0
+					d.setf("level", 7) -- È¤     ì¸¦   Øµ
+					for i = 1, 50 do
+						setlev = setlev + 1
+						if setlev > 6 then
+							setlev = 1
+						end
+						if not d.is_unique_dead("door" .. setlev) then
+							rand = rand - 1
+							if rand == 0 then
+								d.setf("level", setlev)
+								d.setf("clear_count", d.getf("clear_count") + 1)
+								break
+							end
+						end
+					end
+				end
+			end
+
+			if d.getf("level") == 1 then
+				say(c_locale(1342))
+				d.notice(c_locale(1342))
+				d.kill_unique("door1")
+				d.kill_unique("idoor1")
+				d.setf("level", 11)
+				d.regen_file(MOB_REGEN_FILE_PATH .. "fd_a.txt")
+				server_timer("killed_A_1", 12, d.get_map_index())
+			elseif d.getf("level") == 11 then
+				say(c_locale(1343))
+				say_title(c_locale(1344) .. d.count_monster())
+			elseif d.getf("level") == 2 then
+				say(c_locale(1345))
+				d.notice(c_locale(1345))
+				d.spawn_mob(LEVEL2_STONE, setting.LEVEL2_STONE_pos[1], setting.LEVEL2_STONE_pos[2]) -- Î¼ È¯
+				d.kill_unique("door2")
+				d.kill_unique("idoor2")
+				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_b.txt")
+				d.setf("level", 12)
+			elseif d.getf("level") == 12 then
+				say(c_locale(1347))
+			elseif d.getf("level") == 3 then
+				say(c_locale(1342))
+				d.notice(c_locale(1342))
+				d.kill_unique("door3")
+				d.kill_unique("idoor3")
+				d.setf("level", 13)
+				d.regen_file(MOB_REGEN_FILE_PATH .. "fd_c.txt")
+				server_timer("killed_A_1", 12, d.get_map_index())
+			elseif d.getf("level") == 13 then
+				say(c_locale(1343))
+				say_title(c_locale(1344) .. d.count_monster())
+			elseif d.getf("level") == 4 then -- 474 178
+				say(c_locale(1348))
+				d.notice(c_locale(1348))
+				d.setf("level", 14)
+				d.kill_unique("door4")
+				d.kill_unique("idoor4")
+				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_d.txt")
+				d.spawn_mob(LEVEL4_TARGET, setting.LEVEL4_TARGET_pos[1], setting.LEVEL4_TARGET_pos[2]) -- Å¸Ù¸ 
+			elseif d.getf("level") == 14 then
+				say(c_locale(1349))
+				say(c_locale(1350))
+			elseif d.getf("level") == 5 then -- 510 355
+				say(c_locale(1351))
+				say(c_locale(1352))
+				d.notice(c_locale(1351))
+				d.notice(c_locale(1352))
+				d.kill_unique("door5")
+				d.kill_unique("idoor5")
+				d.setf("level", 15)
+				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
+				local vis = { 0, 0, 0, 0, 0, 0, 0 }
+				for i = 1, 7 do
+					vis[i] = 0
+				end
+				for i = 1, 7 do -- Ï° È¯
+					local ran = number(1, 7)
+					local st = 0
+					for j = 1, 50 do
+						st = st + 1
+						if st > 7 then
+							st = 1
+						end
+						if vis[st] == 0 then
+							ran = ran - 1
+							if ran == 0 then
+								vis[st] = 1
+								d.set_unique("stone5_" .. st, d.spawn_mob(LEVEL5_STONE, setting.LEVEL5_STONE_pos[i][1], setting.LEVEL5_STONE_pos[i][2]))
+								break
+							end
+						end
+					end
+				end
+			elseif d.getf("level") == 15 then
+				say(c_locale(1353))
+			elseif d.getf("level") == 6 then -- 507 490
+				say(c_locale(1354))
+				d.notice(c_locale(1354))
+				d.setf("level", 16)
+				d.kill_unique("door6")
+				d.kill_unique("idoor6")
+				d.set_regen_file(MOB_REGEN_FILE_PATH .. "fd_f.txt")
+				d.spawn_mob(LEVEL6_TARGET, setting.LEVEL6_TARGET_pos[1], setting.LEVEL6_TARGET_pos[2]) -- Å¸Ù¿Æ® È¯
+			elseif d.getf("level") == 16 then
+				say(c_locale(1356))
+			elseif d.getf("level") == 7 then
+				--setskin(NOWINDOW)
+				flame_dungeon.go_boss()
+			else
+				say(c_locale(1357))
+			end
+			npc.unlock()
+		end
+
+		when dungeon_end_timer.server_timer begin --  Å¸Ì¸ ( Â°)
+			local setting = flame_dungeon.setting()
+			if d.select(get_server_timer_arg()) then
+				flame_dungeon.clear_timer(d.get_map_index())
+				d.set_warp_location(ENTRY_MAP_INDEX, setting.outside_entry_pos[1], setting.outside_entry_pos[2])
+				d.exit_all()
+				d.setf("party_leader_pid", 0)
+			end
+		end
+
+		when killed_A_1.server_timer begin -- Å¸Ì¸ 1 (level1, level3)
+			if d.select(get_server_timer_arg()) then
+				if d.count_monster() <= 0 then -- 1  
+					if d.getf("level") == 11 then
+						d.notice(c_locale(1358))
+						d.notice(c_locale(1359))
+					else
+						d.notice(c_locale(1358))
+						d.notice(c_locale(1359))
+					end
+					d.setf("level",0)
+				else
+					server_timer("killed_A_2", 6, get_server_timer_arg())
+				end
+			end
+		end
+
+		when killed_A_2.server_timer begin -- Å¸Ì¸ 2 (1 2 Æ°é¼­ Æ°)
+			if d.select(get_server_timer_arg()) then
+				if d.count_monster() <= 0 then -- 1  
+					if d.getf("level") == 11 then
+						d.notice(c_locale(1358))
+						d.notice(c_locale(1359))
+					else
+						d.notice(c_locale(1358))
+						d.notice(c_locale(1359))
+					end
+					d.setf("level", 0)
+				else
+					server_timer("killed_A_1", 6, get_server_timer_arg())
+				end
+			end
+		end
+
+		when kill with flame_dungeon.is_flamed(pc.get_map_index()) and d.getf("level") == 12 begin -- 2 Î¼  
+			local i = number(1, 100) -- 100 1 È® 
+			if i == 1 then
+				game.drop_item(LEVEL2_KEY, 1)
+			end
+		end
+
+		when LEVEL2_STONE.take with flame_dungeon.is_flamed(pc.get_map_index()) and item.get_vnum() == LEVEL2_KEY and d.getf("level") == 12 begin -- 2  Ô¾
+			local i = number(1, 5) -- 5 1 È® Â¥ 
+			if i == 1 then
+				npc.purge()
+				item.remove()
+				d.notice(c_locale(1360))
+				d.notice(c_locale(1359))
+				flame_dungeon.level_clear()
+			else
+				item.remove()
+				say(c_locale(1361))
+			end
+		end
+
+		when LEVEL4_TARGET.kill with flame_dungeon.is_flamed(pc.get_map_index()) and d.getf("level") == 14 begin
+			d.notice(c_locale(1362))
+			d.notice(c_locale(1359))
+			flame_dungeon.level_clear()
+		end
+
+		when kill with flame_dungeon.is_flamed(pc.get_map_index()) and d.getf("level") == 15 begin -- 5 Î¼  
+			local i = number(1, 30) -- 30 1 È® 
+			if i == 1 then
+				game.drop_item(LEVEL5_REALKEY, 1)
+			end
+		end
+
+		when LEVEL5_STONE.take with flame_dungeon.is_flamed(d.get_map_index()) and item.get_vnum() == LEVEL5_REALKEY and d.getf("level") == 15 begin -- 5 Â¥ Ô¾
+			local setting = flame_dungeon.setting()
+			if npc.get_vid() == d.get_unique_vid("stone5_1") then -- Ã¹Â°  Ç¾   Ê¿ Ã£Ú¸ 
+				npc.purge()
+				item.remove()
+				say(c_locale(1363))
+				d.setf("stonekill", 2) -- 2  ×¿
+				if d.count_monster() < LEVEL5_GEN_LIMIT then
+					d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
+				end
+			elseif npc.get_vid() == d.get_unique_vid("stone5_2") then
+				if d.getf("stonekill") == 2 then -- 2  Ëµ 2 è¸¦ Ô¿ 
+					npc.purge()
+					item.remove()
+					say(c_locale(1364))
+					d.setf("stonekill", 3)
+					if d.count_monster() < LEVEL5_GEN_LIMIT then
+						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
+					end
+				else
+					item.remove()
+					say(c_locale(1365))
+					if is_test_server() then
+						say("2th")
+					end
+				end
+			elseif npc.get_vid() == d.get_unique_vid("stone5_3") then
+				if d.getf("stonekill") == 3 then
+					npc.purge()
+					item.remove()
+					say(c_locale(1366))
+					d.setf("stonekill", 4)
+					if d.count_monster() < LEVEL5_GEN_LIMIT then
+						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
+					end
+				else
+					item.remove()
+					say(c_locale(1365))
+					if is_test_server() then
+						say("3th")
+					end
+				end
+			elseif npc.get_vid() == d.get_unique_vid("stone5_4") then
+				if d.getf("stonekill") == 4 then
+					npc.purge()
+					item.remove()
+					say(c_locale(1367))
+					d.setf("stonekill", 5)
+					if d.count_monster() < LEVEL5_GEN_LIMIT then
+						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
+					end
+				else
+					item.remove()
+					say(c_locale(1365))
+					if is_test_server() then
+						say("4th")
+					end
+				end
+			elseif npc.get_vid() == d.get_unique_vid("stone5_5") then
+				if d.getf("stonekill") == 5 then
+					npc.purge()
+					item.remove()
+					say(c_locale(1368))
+					d.setf("stonekill", 6)
+					if d.count_monster() < LEVEL5_GEN_LIMIT then
+						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
+					end
+				else
+					item.remove()
+					say(c_locale(1365))
+					if is_test_server() then
+						say("5th")
+					end
+				end
+			elseif npc.get_vid() == d.get_unique_vid("stone5_6") then
+				if d.getf("stonekill") == 6 then
+					npc.purge()
+					item.remove()
+					say(c_locale(1369))
+					d.setf("stonekill", 7)
+					if d.count_monster() < LEVEL5_GEN_LIMIT then
+						d.regen_file(MOB_REGEN_FILE_PATH .. "fd_e.txt")
+					end
+				else
+					item.remove()
+					say(c_locale(1365))
+					if is_test_server() then
+						say("6th")
+					end
+				end
+			else
+				if d.getf("stonekill") == 7 then
+					npc.purge()
+					item.remove()
+					d.notice(c_locale(1360))
+					d.notice(c_locale(1359))
+					flame_dungeon.level_clear()
+				else
+					item.remove()
+					say(c_locale(1365))
+					if is_test_server() then
+						say("7th")
+					end
+				end
+			end
+		end
+
+		when LEVEL6_TARGET.kill with flame_dungeon.is_flamed(d.get_map_index()) and d.getf("level") == 16 begin --  Ä± 
+			d.notice(c_locale(1370))
+			d.notice(c_locale(1359))
+			flame_dungeon.level_clear()
+		end
+
+		when FINAL_BOSS.kill with flame_dungeon.is_flamed(d.get_map_index()) and d.getf("level") == 17 begin --  ×¿
+			d.setqf2_all_near("flame_dungeon", "yamachun_boss", 1, 800)
+
+			d.notice(c_locale(1371))
+			d.notice(c_locale(1372))
+
+			server_timer("dungeon_end_timer", 60, d.get_map_index())
+			flame_dungeon.level_clear()
+
+			-- Æ¼ , ß¸Ãµ  Æ®(104, 105 Æ®)    Æ® Å¬ Çµ.
+			if party.is_party() then
+				party.setf("flame_dungeon_boss_kill_count", 1)
+			end
+		end
+	end
+end
