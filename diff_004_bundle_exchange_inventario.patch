--- a/client/pack/root/constinfo.py
+++ b/client/pack/root/constinfo.py
@@ -8,7 +8,7 @@
 #PVPMODE_TEST_ENABLE = 0

 PVPMODE_ACCELKEY_ENABLE = 1

 PVPMODE_ACCELKEY_DELAY = 0.5

-PVPMODE_PROTECTED_LEVEL = 30

+PVPMODE_PROTECTED_LEVEL = 15

 

 FOG_LEVEL0 = 4800.0

 FOG_LEVEL1 = 9600.0

@@ -35,9 +35,9 @@
 ERROR_METIN_STONE = 28960

 SUB2_LOADING_ENABLE = 1

 EXPANDED_COMBO_ENABLE = 1

-CONVERT_EMPIRE_LANGUAGE_ENABLE = 1

+CONVERT_EMPIRE_LANGUAGE_ENABLE = 0

 USE_ITEM_WEAPON_TABLE_ATTACK_BONUS = 0

-ADD_DEF_BONUS_ENABLE = 1

+ADD_DEF_BONUS_ENABLE = 0

 LOGIN_COUNT_LIMIT_ENABLE = 0

 

 USE_SKILL_EFFECT_UPGRADE_ENABLE = 1

@@ -45,7 +45,7 @@
 VIEW_OTHER_EMPIRE_PLAYER_TARGET_BOARD = 1

 GUILD_MONEY_PER_GSP = 100

 GUILD_WAR_TYPE_SELECT_ENABLE = 1

-TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE = 0

+TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE = 10

 

 HAIR_COLOR_ENABLE = 1

 ARMOR_SPECULAR_ENABLE = 1

@@ -53,12 +53,6 @@
 SEQUENCE_PACKET_ENABLE = 1

 KEEP_ACCOUNT_CONNETION_ENABLE = 1

 MINIMAP_POSITIONINFO_ENABLE = 0

-CONVERT_EMPIRE_LANGUAGE_ENABLE = 0

-USE_ITEM_WEAPON_TABLE_ATTACK_BONUS = 0

-ADD_DEF_BONUS_ENABLE = 0

-LOGIN_COUNT_LIMIT_ENABLE = 0

-PVPMODE_PROTECTED_LEVEL = 15

-TWO_HANDED_WEAPON_ATT_SPEED_DECREASE_VALUE = 10

 

 isItemQuestionDialog = 0

 

@@ -78,7 +72,6 @@
 	global isItemQuestionDialog

 	isItemQuestionDialog = flag

 

-import app

 import net

 

 ########################

@@ -179,7 +172,7 @@
 		[ 50636, 14520, 16520, 17520 ],

 		[ 50637, 14540, 16540, 17540 ],

 		[ 50638, 14560, 16560, 17560 ],

-		[ 50639, 14570, 16570, 0 ], # ¿À±¤±Í°ÉÀÌ´Â ¾øÀ½(±Í°ÉÀÌ´Â ¼öÀÎ°ü·Ã)

+		[ 50639, 14570, 16570, 0 ], # Ͱ̴ (Ͱ̴ ΰ)

 	]

 

 if app.ENABLE_CONQUEROR_LEVEL:

@@ -228,36 +221,36 @@
 	return ACCESSORY_MATERIAL_LIST[type]

 

 ##################################################################

-## »õ·Î Ãß°¡µÈ 'º§Æ®' ¾ÆÀÌÅÛ Å¸ÀÔ°ú, º§Æ®ÀÇ ¼ÒÄÏ¿¡ ²ÈÀ» ¾ÆÀÌÅÛ °ü·Ã.. 

-## º§Æ®ÀÇ ¼ÒÄÏ½Ã½ºÅÛÀº ¾Ç¼¼¼­¸®¿Í µ¿ÀÏÇÏ±â ¶§¹®¿¡, À§ ¾Ç¼¼¼­¸® °ü·Ã ÇÏµåÄÚµùÃ³·³ ÀÌ·±½ÄÀ¸·Î ÇÒ ¼ö¹Û¿¡ ¾ø´Ù..

+##  ߰ 'Ʈ'  Ÿ԰, Ʈ Ͽ   .. 

+## Ʈ Ͻý Ǽ ϱ ,  Ǽ  ϵڵó ̷  ۿ ..

 

 def GET_BELT_MATERIAL_VNUM(vnum, subType = 0):

-	# ÇöÀç´Â ¸ðµç º§Æ®¿¡´Â ÇÏ³ªÀÇ ¾ÆÀÌÅÛ(#18900)¸¸ »ðÀÔ °¡´É

+	#   Ʈ ϳ (#18900)  

 	return 18900

 

 ##################################################################

-## ÀÚµ¿¹°¾à (HP: #72723 ~ #72726, SP: #72727 ~ #72730)

-

-# ÇØ´ç vnumÀÌ ÀÚµ¿¹°¾àÀÎ°¡?

+## ڵ (HP: #72723 ~ #72726, SP: #72727 ~ #72730)

+

+# ش vnum ڵΰ?

 def IS_AUTO_POTION(itemVnum):

 	return IS_AUTO_POTION_HP(itemVnum) or IS_AUTO_POTION_SP(itemVnum)

 

-# ÇØ´ç vnumÀÌ HP ÀÚµ¿¹°¾àÀÎ°¡?

+# ش vnum HP ڵΰ?

 def IS_AUTO_POTION_HP(itemVnum):

 	if 72723 <= itemVnum and 72726 >= itemVnum:

 		return 1

-	elif itemVnum >= 76021 and itemVnum <= 76022: ## »õ·Î µé¾î°£ ¼±¹°¿ë È­·æÀÇ Ãàº¹

+	elif itemVnum >= 76021 and itemVnum <= 76022: ##    ȭ ູ

 		return 1

 	elif itemVnum == 79012:

 		return 1

 

 	return 0

 

-# ÇØ´ç vnumÀÌ SP ÀÚµ¿¹°¾àÀÎ°¡?

+# ش vnum SP ڵΰ?

 def IS_AUTO_POTION_SP(itemVnum):

 	if 72727 <= itemVnum and 72730 >= itemVnum:

 		return 1

-	elif itemVnum >= 76004 and itemVnum <= 76005: ## »õ·Î µé¾î°£ ¼±¹°¿ë ¼ö·æÀÇ Ãàº¹

+	elif itemVnum >= 76004 and itemVnum <= 76005: ##     ູ

 		return 1

 	elif itemVnum == 79013:

 		return 1


--- a/client/pack/root/uiinventory.py
+++ b/client/pack/root/uiinventory.py
@@ -13,7 +13,7 @@
 import uiAttachMetin

 import uiPickMoney

 import uiCommon

-import uiPrivateShopBuilder # °³ÀÎ»óÁ¡ ¿­µ¿¾È ItemMove ¹æÁö

+import uiPrivateShopBuilder # λ  ItemMove 

 import localeInfo

 import constInfo

 import ime

@@ -510,7 +510,7 @@
 

 		self.AdjustPosition()

 

-	## ÇöÀç ÀÎº¥Åä¸® À§Ä¡¸¦ ±âÁØÀ¸·Î BASE À§Ä¡¸¦ °è»ê, ¸®ÅÏ.. ¼ýÀÚ ÇÏµåÄÚµùÇÏ±â Á¤¸» ½ÈÁö¸¸ ¹æ¹ýÀÌ ¾ø´Ù..

+	##  κ丮 ġ  BASE ġ , ..  ϵڵϱ    ..

 	def GetBasePosition(self):

 		if app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:

 			x, y = self.parent.GetGlobalPosition()

@@ -661,8 +661,8 @@
 	sellingSlotWindow = player.INVENTORY

 

 	if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:

-		isOpenedCostumeWindowWhenClosingInventory = 0 # ÀÎº¥Åä¸® ´ÝÀ» ¶§ ÄÚ½ºÃõÀÌ ¿­·ÁÀÖ¾ú´ÂÁö ¿©ºÎ-_-; ³×ÀÌ¹Ö ¤¸¤µ

-		isOpenedBeltWindowWhenClosingInventory = 0 # ÀÎº¥Åä¸® ´ÝÀ» ¶§ º§Æ® ÀÎº¥Åä¸®°¡ ¿­·ÁÀÖ¾ú´ÂÁö ¿©ºÎ-_-; ³×ÀÌ¹Ö ¤¸¤µ

+		isOpenedCostumeWindowWhenClosingInventory = 0 # κ丮   ڽ ־ -_-; ̹ 

+		isOpenedBeltWindowWhenClosingInventory = 0 # κ丮   Ʈ κ丮 ־ -_-; ̹ 

 

 	if app.ENABLE_GROWTH_PET_SYSTEM:

 		petHatchingWindow	= None

@@ -683,7 +683,7 @@
 

 		ui.ScriptWindow.__init__(self)

 

-		self.isOpenedBeltWindowWhenClosingInventory = 0 # ÀÎº¥Åä¸® ´ÝÀ» ¶§ º§Æ® ÀÎº¥Åä¸®°¡ ¿­·ÁÀÖ¾ú´ÂÁö ¿©ºÎ-_-; ³×ÀÌ¹Ö ¤¸¤µ

+		self.isOpenedBeltWindowWhenClosingInventory = 0 # κ丮   Ʈ κ丮 ־ -_-; ̹ 

 

 		self.__LoadWindow()

 

@@ -710,11 +710,11 @@
 		self.RefreshStatus()

 

 		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:

-			# ÀÎº¥Åä¸®¸¦ ´ÝÀ» ¶§ ÄÚ½ºÃõÀÌ ¿­·ÁÀÖ¾ú´Ù¸é ÀÎº¥Åä¸®¸¦ ¿­ ¶§ ÄÚ½ºÃõµµ °°ÀÌ ¿­µµ·Ï ÇÔ.

+			# κ丮   ڽ ־ٸ κ丮   ڽ   .

 			if self.isOpenedCostumeWindowWhenClosingInventory and self.wndCostume:

 				self.wndCostume.Show()

 

-			# ÀÎº¥Åä¸®¸¦ ´ÝÀ» ¶§ º§Æ® ÀÎº¥Åä¸®°¡ ¿­·ÁÀÖ¾ú´Ù¸é °°ÀÌ ¿­µµ·Ï ÇÔ.

+			# κ丮   Ʈ κ丮 ־ٸ   .

 			if self.wndBelt:

 				self.wndBelt.Show(self.isOpenedBeltWindowWhenClosingInventory)

 

@@ -771,7 +771,7 @@
 					self.wndChequeIcon.Hide()

 					self.wndChequeSlot.Hide()

 

-					## ³ôÀÌ Á¶Àý

+					##  

 					height = self.GetHeight()

 					width = self.GetWidth()

 					self.SetSize(width, height - 22)

@@ -891,8 +891,13 @@
 		else:

 			self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog))

 

-		for inven_index in range(player.INVENTORY_PAGE_COUNT): ## 0, 1, 2, 3

+		# Bind all visible inventory tabs (UI has 4; some binaries expose only 2 via player.INVENTORY_PAGE_COUNT)

+		max_pages = self.__GetMaxInventoryPages()

+		for inven_index in range(min(max_pages, len(self.inventoryTab))):

 			self.inventoryTab[inven_index].SetEvent(lambda arg = inven_index : self.SetInventoryPage(arg))

+		for inven_index in range(min(max_pages, len(self.inventoryTab)), len(self.inventoryTab)):

+			# Hide unused tabs to avoid desync/ghost slot mapping

+			self.inventoryTab[inven_index].Hide()

 		self.inventoryTab[0].Down()

 

 		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:

@@ -1028,11 +1033,11 @@
 

 		if not app.ENABLE_ADDITIONAL_EQUIPMENT_PAGE:

 			if self.wndCostume:

-				self.isOpenedCostumeWindowWhenClosingInventory = self.wndCostume.IsShow() # ÀÎº¥Åä¸® Ã¢ÀÌ ´ÝÈú ¶§ ÄÚ½ºÃõÀÌ ¿­·Á ÀÖ¾ú´Â°¡?

+				self.isOpenedCostumeWindowWhenClosingInventory = self.wndCostume.IsShow() # κ丮 â   ڽ  ־°?

 				self.wndCostume.Close()

 

 			if self.wndBelt:

-				self.isOpenedBeltWindowWhenClosingInventory = self.wndBelt.IsOpeningInventory() # ÀÎº¥Åä¸® Ã¢ÀÌ ´ÝÈú ¶§ º§Æ® ÀÎº¥Åä¸®µµ ¿­·Á ÀÖ¾ú´Â°¡?

+				self.isOpenedBeltWindowWhenClosingInventory = self.wndBelt.IsOpeningInventory() # κ丮 â   Ʈ κ丮  ־°?

 				#print "Is Opening Belt Inven?? ", self.isOpenedBeltWindowWhenClosingInventory

 				self.wndBelt.Close()

 

@@ -1061,7 +1066,7 @@
 				self.wndMoney = self.wndExpandedMoneyBar.GetMoney()

 

 				if app.ENABLE_CHEQUE_SYSTEM:

-					## ¾ç °ü·Ã

+					##  

 					self.wndMoneyIcon = self.wndExpandedMoneyBar.GetMoneyIcon()

 					if self.wndMoneyIcon:

 						self.wndMoneyIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 0)

@@ -1069,7 +1074,7 @@
 					if self.wndMoneySlot:

 						self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 0)

 

-					## 2Â÷È­Æó °ü·Ã

+					## 2ȭ 

 					self.wndChequeIcon = self.wndExpandedMoneyBar.GetChequeIcon()

 					if self.wndChequeIcon:

 						self.wndChequeIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 1)

@@ -1079,7 +1084,7 @@
 						self.wndChequeSlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog), 1)

 					self.wndCheque = self.wndExpandedMoneyBar.GetCheque()

 

-					## º¸¼® °ü·Ã

+					##  

 					self.wndGemIcon = self.wndExpandedMoneyBar.GetGemIcon()

 					if self.wndGemIcon:

 						self.wndGemIcon.SetEvent(ui.__mem_func__(self.EventProgress), "mouse_over_in", 2)

@@ -1092,14 +1097,50 @@
 					if self.wndMoneySlot:

 						self.wndMoneySlot.SetEvent(ui.__mem_func__(self.OpenPickMoneyDialog))

 

+	def __GetMaxInventoryPages(self):

+		"""Best-effort max page count to keep UI tabs and slot mapping consistent.

+		Some clients expose only 2 pages via player.INVENTORY_PAGE_COUNT while the UI/script has 4.

+		"""

+		# Primary: derive from total slots / page size (stable even if INVENTORY_PAGE_COUNT is wrong)

+		try:

+			page_size = int(player.INVENTORY_PAGE_SIZE)

+			total_slots = int(player.INVENTORY_SLOT_COUNT)

+			calc = int(total_slots / page_size) if page_size > 0 else 0

+		except:

+			calc = 0

+

+		# Secondary: keep at least the engine-reported page count

+		try:

+			calc = max(calc, int(player.INVENTORY_PAGE_COUNT))

+		except:

+			pass

+

+		# UI cap

+		try:

+			calc = min(calc, len(self.inventoryTab))

+		except:

+			pass

+

+		return max(1, calc)

+

 	def SetInventoryPage(self, page):

+		max_pages = self.__GetMaxInventoryPages()

+		try:

+			page = int(page)

+		except:

+			page = 0

+		if page < 0:

+			page = 0

+		elif page >= max_pages:

+			page = max_pages - 1

+

 		self.inventoryPageIndex = page

 

 		for index in range(len(self.inventoryTab)):

 			if index == page:

-				continue

-

-			self.inventoryTab[index].SetUp()

+				self.inventoryTab[index].Down()

+			else:

+				self.inventoryTab[index].SetUp()

 

 		self.RefreshBagSlotWindow()

 

@@ -1138,14 +1179,14 @@
 				self.ExInvenButton[index].Hide()

 

 		def __ShowExtendInvenButton(self, cur_stage):

-			## self.inventoryPageIndex ´Â 0,1,2,3 ¶ó¼­ EX_INVENTORY_PAGE_START -1 À» »ç¿ëÇÑ´Ù.

+			## self.inventoryPageIndex  0,1,2,3  EX_INVENTORY_PAGE_START -1  Ѵ.

 			if self.inventoryPageIndex < player.EX_INVENTORY_PAGE_START - 1:

 				return

 

-			## ÇÑ ÆäÀÌÁö ´ç º¸¿©ÁÙ ´Ü°è¼ö

+			##     ܰ

 			count = player.EX_INVENTORY_STAGE_MAX / player.EX_INVENTORY_PAGE_COUNT

 

-			## ÃÖ¼Ò, ÃÖ´ë

+			## ּ, ִ

 			min_range = (self.inventoryPageIndex - player.EX_INVENTORY_PAGE_START + 1) * count

 			max_range = min_range + count

 

@@ -1162,15 +1203,15 @@
 					self.ExInvenButton[button_index].Show()

 

 		def ExInvenItemUseMsg(self, item_vnum, msg, enough_count):

-			## °³¼ö ºÎÁ·

+			##  

 			if player.EX_INVEN_FAIL_FALL_SHORT == msg:

 				self.__OpenExInvenFallShortCountMsgDlg(enough_count)

 

-			## °³¼ö°¡ ÃæºÐÇÔ

+			##  

 			elif player.EX_INVEN_SUCCESS == msg:

 				self.__OpenExInvenQuestionDlg(enough_count)

 

-			## 4¹øÆäÀÌÁö ¸¶Áö¸·ÀÓ

+			## 4 

 			elif player.EX_INVEN_FAIL_FOURTH_PAGE_STAGE_MAX == msg:

 				self.__OpenExInvenMsgDlg(localeInfo.EXINVEN_USE_ITEM_FAIL_FOURTH_PAGE_STAGE_MAX)

 				return

@@ -1274,7 +1315,7 @@
 			self.dlgPickMoney.SetTitleName(localeInfo.PICK_MONEY_TITLE)

 			self.dlgPickMoney.SetAcceptEvent(ui.__mem_func__(self.OnPickMoney))

 			self.dlgPickMoney.Open(curMoney, curCheque)

-			self.dlgPickMoney.SetMax(7) # ÀÎº¥Åä¸® 990000 Á¦ÇÑ ¹ö±× ¼öÁ¤

+			self.dlgPickMoney.SetMax(7) # κ丮 990000   

 			if app.ENABLE_CHEQUE_SYSTEM:

 				self.dlgPickMoney.SetFocus(focus_idx)

 

@@ -1311,7 +1352,7 @@
 		getItemCount = player.GetItemCount

 		setItemVNum = self.wndItem.SetItemSlot

 

-		## ¸®ÇÁ·¹½¬ ÇÏ±âÀü¿¡ ÇÏÀÌ¶óÀÌÆ® ¸ðµÎ ²ö´Ù.

+		##  ϱ ̶Ʈ  .

 		for i in xrange(self.wndItem.GetSlotCount()):

 			self.wndItem.DeactivateSlot(i)

 

@@ -1323,7 +1364,7 @@
 			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)

 

 			itemCount = getItemCount(slotNumber)

-			# itemCount == 0ÀÌ¸é ¼ÒÄÏÀ» ºñ¿î´Ù.

+			# itemCount == 0̸  .

 			if 0 == itemCount:

 				self.wndItem.ClearSlot(i)

 				continue

@@ -1333,9 +1374,9 @@
 			itemVnum = getItemVNum(slotNumber)

 			setItemVNum(i, itemVnum, itemCount)

 

-			## ÀÚµ¿¹°¾à (HP: #72723 ~ #72726, SP: #72727 ~ #72730) Æ¯¼öÃ³¸® - ¾ÆÀÌÅÛÀÎµ¥µµ ½½·Ô¿¡ È°¼ºÈ­/ºñÈ°¼ºÈ­ Ç¥½Ã¸¦ À§ÇÑ ÀÛ¾÷ÀÓ - [hyo]

+			## ڵ (HP: #72723 ~ #72726, SP: #72727 ~ #72730) Ưó - ε Կ Ȱȭ/Ȱȭ ǥø  ۾ - [hyo]

 			if constInfo.IS_AUTO_POTION(itemVnum):

-				# metinSocket - [0] : È°¼ºÈ­ ¿©ºÎ, [1] : »ç¿ëÇÑ ¾ç, [2] : ÃÖ´ë ¿ë·®

+				# metinSocket - [0] : Ȱȭ , [1] :  , [2] : ִ 뷮

 				metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]

 				tempSlotNum = slotNumber

 				if tempSlotNum >= player.INVENTORY_PAGE_SIZE:

@@ -1392,7 +1433,7 @@
 					else:

 						self.wndItem.DeactivateSlot(tempSlotNum)

 

-			## [MT-662] ÀÏ¹ÝÆê ¼ÒÈ¯Ç¥½Ã ¸¶Å©

+			## [MT-662] Ϲ ȯǥ ũ

 			if (item.ITEM_TYPE_QUEST == item.GetItemType() and item.QUEST_PET_PAY == item.GetItemSubType()) or\

 				(item.ITEM_TYPE_PET == item.GetItemType() and item.PET_PAY == item.GetItemSubType()):

 				metinSocket = [player.GetItemMetinSocket(slotNumber, j) for j in xrange(player.METIN_SOCKET_MAX_NUM)]

@@ -1485,7 +1526,7 @@
 	def SellItem(self):

 		if self.sellingSlotitemIndex == player.GetItemIndex(self.sellingSlotWindow, self.sellingSlotNumber):

 			if self.sellingSlotitemCount == player.GetItemCount(self.sellingSlotWindow, self.sellingSlotNumber):

-				## ¿ëÈ¥¼®µµ ÆÈ¸®°Ô ÇÏ´Â ±â´É Ãß°¡ÇÏ¸é¼­ ÀÎÀÚ type Ãß°¡

+				## ȥ ȸ ϴ  ߰ϸ鼭  type ߰

 				net.SendShopSellPacketNew(self.sellingSlotNumber, self.questionDialog.count, self.sellingSlotWindow)

 				snd.PlaySound("sound/ui/money.wav")

 		self.OnCloseQuestionDialog()

@@ -1510,8 +1551,8 @@
 		if constInfo.GET_ITEM_QUESTION_DIALOG_STATUS() == 1:

 			return

 

-		## ¾Ç¼¼¼­¸® Ã¢ÀÌ ¿­·ÁÀÖÀ¸¸é

-		## ¾ÆÀÌÅÛ ÀÌµ¿ ±ÝÁö.

+		## Ǽ â 

+		##  ̵ .

 		if app.ENABLE_ACCE_COSTUME_SYSTEM:

 			if player.GetAcceRefineWindowOpen():

 				return

@@ -1682,8 +1723,8 @@
 			if srcItemSlotPos == dstItemSlotPos:

 				return

 

-		## ¾Ç¼¼¼­¸® Ã¢ÀÌ ¿­·ÁÀÖÀ¸¸é

-		## ¾ÆÀÌÅÛ ÀÌµ¿ ±ÝÁö.

+		## Ǽ â 

+		##  ̵ .

 		if app.ENABLE_ACCE_COSTUME_SYSTEM:

 			if player.GetAcceRefineWindowOpen():

 				return

@@ -1787,9 +1828,9 @@
 						self.__UseGemConverter(srcItemSlotWindow, srcItemSlotPos, dstItemSlotWindow, dstItemSlotPos)

 						return

 

-			## ÀÌµ¿½ÃÅ² °÷ÀÌ ÀåÂø ½½·ÔÀÏ °æ¿ì ¾ÆÀÌÅÛÀ» »ç¿ëÇØ¼­ ÀåÂø ½ÃÅ²´Ù - [levites]

+			## ̵Ų      ؼ  Ų - [levites]

 			if player.IsEquipmentSlot(dstItemSlotWindow, dstItemSlotPos):

-				## µé°í ÀÖ´Â ¾ÆÀÌÅÛÀÌ ÀåºñÀÏ¶§¸¸

+				##  ִ  ϶

 				if item.IsEquipmentVID(srcItemVID):

 					self.__UseItem(srcItemSlotPos, srcItemSlotWindow)

 			else:

@@ -1875,7 +1916,7 @@
 			self.sellingSlotitemCount = itemCount

 

 			item.SelectItem(itemIndex)

-			## ¾ÈÆ¼ ÇÃ·¹±× °Ë»ç ºüÁ®¼­ Ãß°¡

+			## Ƽ ÷ ˻  ߰

 			## 20140220

 			if item.IsAntiFlag(item.ANTIFLAG_SELL):

 				popup = uiCommon.PopupDialog()

@@ -2044,7 +2085,7 @@
 		self.ShowToolTip(overInvenSlotPos, window_type)

 

 	def __IsUsableItemToItem(self, srcItemVNum, srcSlotPos):

-		"´Ù¸¥ ¾ÆÀÌÅÛ¿¡ »ç¿ëÇÒ ¼ö ÀÖ´Â ¾ÆÀÌÅÛÀÎ°¡?"

+		"ٸ ۿ   ִ ΰ?"

 

 		if item.IsRefineScroll(srcItemVNum):

 			return True

@@ -2091,12 +2132,12 @@
 		return False

 

 	def __CanUseSrcItemToDstItem(self, srcItemVNum, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):

-		## ´ë»ó ¾ÆÀÌÅÛ¿¡ »ç¿ëÇÒ ¼ö ÀÖ´Â°¡?

+		##  ۿ   ִ°?

 		if srcSlotWindow == dstSlotWindow:

 			if srcSlotPos == dstSlotPos:

 				return False

 

-		## [MT-462]: Stackable UseMode ÀÌ°í..

+		## [MT-462]: Stackable UseMode ̰..

 		#if srcItemVNum == player.GetItemIndex(dstSlotWindow, dstSlotPos) and \

 		#	(player.GetItemFlags(dstSlotWindow, dstSlotPos) & item.ITEM_FLAG_STACKABLE):

 		#	return True

@@ -2245,7 +2286,7 @@
 		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):

 			return False

 

-		# Àç°æºñ¼­

+		# 

 		if app.ENABLE_NEW_USER_CARE:

 			if item.IsAntiFlag(item.ITEM_ANTIFLAG_ENCHANT):

 				return False

@@ -2325,7 +2366,7 @@
 				if (item.GetItemType() == item.ITEM_TYPE_WEAPON and item.GetItemSubType() == item.WEAPON_ARROW):

 					return False

 

-			# Àç°æºñ¼­

+			# 

 			if app.ENABLE_NEW_USER_CARE:

 				if item.IsAntiFlag(item.ITEM_ANTIFLAG_ENCHANT):

 					return False

@@ -2355,7 +2396,7 @@
 		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):

 			return False

 

-		# Àç°¡ºñ¼­

+		# 簡

 		if app.ENABLE_NEW_USER_CARE:

 			if item.IsAntiFlag(item.ITEM_ANTIFLAG_REINFORCE):

 				return False

@@ -2385,7 +2426,7 @@
 		if not item.GetItemType() in (item.ITEM_TYPE_WEAPON, item.ITEM_TYPE_ARMOR):

 			return False

 

-		# Àç°¡ºñ¼­

+		# 簡

 		if app.ENABLE_NEW_USER_CARE:

 			if item.IsAntiFlag(item.ITEM_ANTIFLAG_REINFORCE):

 				return False

@@ -2512,8 +2553,8 @@
 		ItemVNum = player.GetItemIndex(slotWindow, slotIndex)

 		item.SelectItem(ItemVNum)

 

-		## ¾Ç¼¼¼­¸® Ã¢ÀÌ ¿­·ÁÀÖÀ¸¸é

-		## ¾Ç¼¼¼­¸® ¾ÆÀÌÅÛ, ¹«±â, °©¿Ê ¿Ü¿£ ¾Æ¹« »ç¿ë ¾ÈµÊ.

+		## Ǽ â 

+		## Ǽ , ,  ܿ ƹ  ȵ.

 		if app.ENABLE_ACCE_COSTUME_SYSTEM:

 			if player.GetAcceRefineWindowOpen():

 				self.__UseItemAcce(slotIndex, slotWindow)

@@ -2601,23 +2642,23 @@
 			UsingAcceSlot = player.FindActivatedAcceSlot(slotWindow, slotIndex)

 

 			if app.ENABLE_SOULBIND_SYSTEM:

-				## ºÀÀÎ¾ÆÀÌÅÛ °É·¯³¿

+				## ξ ɷ

 				if player.GetItemSealDate(player.INVENTORY, slotIndex) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:

 					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_NOT_SEALITEM)

 					return

 

-			## Á¶ÇÕÃ¢

+			## â

 			if player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_COMBINE:

 				if item.GetItemType() == item.ITEM_TYPE_COSTUME:

 					if item.GetItemSubType() == item.COSTUME_TYPE_ACCE:

 						if app.ENABLE_ACCE_SECOND_COSTUME_SYSTEM:

-							## Àü¼³µî±Þ ÃÖ°í Èí¼öÀ² 25%

+							##  ְ  25%

 							socketInDrainValue = player.GetItemMetinSocket(slotIndex, 1)

 							if socketInDrainValue >= player.ACCE_MAX_DRAINRATE:

 								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_MAX_DRAINRATE)

 								return

 						else:

-							if item.GetRefinedVnum() == 0: ## Àü¼±µî±Þ ¾ÆÀÌÅÛÀº °É·¯³¿.

+							if item.GetRefinedVnum() == 0: ##   ɷ.

 								chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_MAXGRADE)

 								return

 

@@ -2639,7 +2680,7 @@
 					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCE)

 					return

 

-			## Èí¼öÃ¢

+			## â

 			elif player.GetAcceRefineWindowType() == player.ACCE_SLOT_TYPE_ABSORB:

 				isAbsorbItem = False

 				if item.GetItemType() == item.ITEM_TYPE_COSTUME:

@@ -2649,7 +2690,7 @@
 							return

 

 						if UsingAcceSlot == player.ACCE_SLOT_MAX:

-							if not AcceSlot == player.ACCE_SLOT_LEFT: ## ¾Ç¼¼¼­¸®¾ÆÀÌÅÛÀº ¿ÞÂÊ ½½·Ô¿¡¸¸

+							if not AcceSlot == player.ACCE_SLOT_LEFT: ## Ǽ  Կ

 								return

 

 							player.SetAcceActivatedItemSlot(AcceSlot, slotIndex)

@@ -2658,10 +2699,10 @@
 						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_POSSIBLE_ACCEITEM)

 						return

 

-				elif item.GetItemType() == item.ITEM_TYPE_WEAPON: ## ¹«±â·ù.

+				elif item.GetItemType() == item.ITEM_TYPE_WEAPON: ## .

 					isAbsorbItem = True

 

-				elif item.GetItemType() == item.ITEM_TYPE_ARMOR: ## °©¿Ê·ù

+				elif item.GetItemType() == item.ITEM_TYPE_ARMOR: ## ʷ

 					if item.GetItemSubType() == item.ARMOR_BODY:

 						isAbsorbItem = True

 					else:

@@ -2672,8 +2713,8 @@
 					return

 

 				if localeInfo.IsBRAZIL():

-					## ºê¶óÁú¿¡¼­ ¾Æ·¡ ³ª¿­µÈ ¾ÆÀÌÅÛÀº ´É·ÂÄ¡°¡ »ó´çÈ÷ °­ÇØ¼­ Èí¼ö ¾ÈµÇ°Ô ÇØ´Þ¶ó°í Á¶¸§.

-					## ¾îÂ¿¼ö ¾øÀÌ ÇÏµåÄÚµùÇÔ. 

+					##  Ʒ   ɷġ  ؼ  ȵǰ ش޶ .

+					## ¿  ϵڵ. 

 					itemvnum = item.GetVnum()

 					if itemvnum == 11979 or itemvnum == 11980 or itemvnum == 11981 or itemvnum == 11982 or itemvnum == 11971 or itemvnum == 11972 or itemvnum == 11973 or itemvnum == 11974:

 						chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.ACCE_DONOT_ABSORDITEM)

@@ -2687,7 +2728,7 @@
 

 				if isAbsorbItem:

 					if UsingAcceSlot == player.ACCE_SLOT_MAX:

-						if not AcceSlot == player.ACCE_SLOT_RIGHT: ## Èí¼öµÉ ¾ÆÀÌÅÛÀº ¿À¸¥ÂÊ ½½·Ô¿¡¸¸

+						if not AcceSlot == player.ACCE_SLOT_RIGHT: ##    Կ

 							if player.FindUsingAcceSlot(player.ACCE_SLOT_RIGHT) == player.NPOS():

 								AcceSlot = player.ACCE_SLOT_RIGHT

 							else:

@@ -2700,7 +2741,7 @@
 						popup.Open()

 						self.pop = popup

 

-			## °æ°í ¸Þ½ÃÁö ¶ç¿ì±â.

+			##  ޽ .

 			if not player.FindUsingAcceSlot(player.ACCE_SLOT_RIGHT) == player.NPOS() and not player.FindUsingAcceSlot(player.ACCE_SLOT_LEFT) == player.NPOS():

 				if AcceSlot != player.ACCE_SLOT_MAX:

 					popup = uiCommon.PopupDialog()

@@ -2710,7 +2751,7 @@
 							socketInDrainValue = player.GetAcceItemMetinSocket(0, 1)

 							socketInDrainValue2 = player.GetAcceItemMetinSocket(1, 1)

 							socketInDrainValue3 = player.GetItemMetinSocket(slotIndex, 1)

-							## ¸ÞÀÎ ¼­¹ö Áß. µî·ÏµÈ ¾ÆÀÌÅÛÀÌ Àü¼³ÀÏ¶§ °æ°í ¸Þ½ÃÁö º¯°æ.

+							##   . ϵ  ϶  ޽ .

 							if socketInDrainValue > 0 or socketInDrainValue2 > 0 or socketInDrainValue3 > 0:

 								popup.SetText(localeInfo.ACCE_DEL_SERVEITEM2)

 							else:

@@ -2722,7 +2763,7 @@
 						popup.Open()

 						self.pop = popup

 

-		## ¾ÆÀÌÅÛ Èí¼ö½Ã Èí¼öµÉ ¾ÆÀÌÅÛ ÇÒÁö ¾ÈÇÒÁö ¼±ÅÃ ÆË¾÷

+		##        ˾

 		def OnAcceAcceptEvent(self, slotIndex, AcceSlot):

 			self.pop.Close()

 			self.pop = None

@@ -2748,7 +2789,7 @@
 				return

 

 			if app.ENABLE_SOULBIND_SYSTEM:

-				## ºÀÀÎ¾ÆÀÌÅÛ °É·¯³¿

+				## ξ ɷ

 				if player.GetItemSealDate(player.INVENTORY, slotIndex) != item.E_SEAL_DATE_DEFAULT_TIMESTAMP:

 					chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.AURA_IMPOSSIBLE_SEALITEM)

 					return

@@ -3042,7 +3083,7 @@
 		self.OnCloseQuestionDialog()

 

 	def __SendUseItemToItemPacket(self, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos):

-		# °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ »ç¿ë ¹æÁö

+		# λ  ִ    

 		if uiPrivateShopBuilder.IsBuildingPrivateShop():

 			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_ITEM_FAILURE_PRIVATE_SHOP)

 			return

@@ -3054,7 +3095,7 @@
 		net.SendItemUseToItemPacket(srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos)

 

 	def __SendUseItemPacket(self, slotPos, slotWindow = player.INVENTORY):

-		# °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ »ç¿ë ¹æÁö

+		# λ  ִ    

 		if uiPrivateShopBuilder.IsBuildingPrivateShop():

 			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.USE_ITEM_FAILURE_PRIVATE_SHOP)

 			return

@@ -3066,7 +3107,7 @@
 		net.SendItemUsePacket(slotWindow, slotPos)

 

 	def __SendMoveItemPacket(self, srcSlotWindow, srcSlotPos, dstSlotWindow, dstSlotPos, srcItemCount):

-		# °³ÀÎ»óÁ¡ ¿­°í ÀÖ´Â µ¿¾È ¾ÆÀÌÅÛ »ç¿ë ¹æÁö

+		# λ  ִ    

 		if uiPrivateShopBuilder.IsBuildingPrivateShop():

 			chat.AppendChat(chat.CHAT_TYPE_INFO, localeInfo.MOVE_ITEM_FAILURE_PRIVATE_SHOP)

 			return

@@ -3088,7 +3129,7 @@
 			if self.wndBelt:

 				self.wndBelt.AdjustPosition()

 

-	# ¾Ç¼¼¼­¸® ½½·Ô Å×µÎ¸® Ãß°¡, Á¦°Å.

+	# Ǽ  ׵θ ߰, .

 	## HilightSlot Change

 	def DeactivateSlot(self, slotindex, type):

 		if type == wndMgr.HILIGHTSLOT_MAX:

@@ -3135,12 +3176,12 @@
 				self.__AddHighlightSlotCube(slotindex)

 

 	if app.ENABLE_ACCE_COSTUME_SYSTEM:

-		## ¾Ç¼¼¼­¸® ¿ë ÇÏÀÌ¶óÀÌÆ® list Ãß°¡.

+		## Ǽ  ̶Ʈ list ߰.

 		def __AddHighlightSlotAcce(self, slotIndex):

 			if not slotIndex in self.listHighlightedAcceSlot:

 				self.listHighlightedAcceSlot.append(slotIndex)

 

-		## ¾Ç¼¼¼­¸® ¿ë ÇÏÀÌ¶óÀÌÆ® list »èÁ¦.

+		## Ǽ  ̶Ʈ list .

 		def __DelHighlightSlotAcce(self, slotIndex):

 			if slotIndex in self.listHighlightedAcceSlot:

 				if slotIndex >= player.INVENTORY_PAGE_SIZE:

@@ -3195,9 +3236,9 @@
 					self.wndItem.SetCanMouseEventSlot(slotIndex)

 				self.listHighlightedAuraSlot.remove(slotIndex)

 

-	## ÇÏÀÌ¶óÀÌÆ® ¸®ÇÁ·¹½¬.

+	## ̶Ʈ .

 	def __HighlightSlot_Refresh(self):

-		## ¾Ç¼¼¼­¸®.

+		## Ǽ.

 		for i in xrange(self.wndItem.GetSlotCount()):

 			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)

 

@@ -3230,9 +3271,9 @@
 					self.wndItem.ActivateSlot(i)

 					self.wndItem.SetSlotDiffuseColor(i, wndMgr.COLOR_TYPE_MAX)

 

-	## ¾Ç¼¼¼­¸® ¿ë ÇÏÀÌ¶óÀÌÆ® list Å¬¸®¾î.

+	## Ǽ  ̶Ʈ list Ŭ.

 	def __HighlightSlot_Clear(self):

-		## ¾Ç¼¼¼­¸®

+		## Ǽ

 		for i in xrange(self.wndItem.GetSlotCount()):

 			slotNumber = self.__InventoryLocalSlotPosToGlobalSlotPos(i)

 

@@ -3266,17 +3307,17 @@
 					self.listHighlightedSlot.remove(slotNumber)

 

 	if app.WJ_ENABLE_PICKUP_ITEM_EFFECT:

-		# ½½·Ô highlight °ü·Ã

-		## Ãß°¡

+		#  highlight 

+		## ߰

 		def HighlightSlot(self, slot):

-			#slot°ª¿¡ ´ëÇÑ ¿¹¿ÜÃ³¸®.

+			#slot  ó.

 			if slot > player.INVENTORY_PAGE_SIZE * player.INVENTORY_PAGE_COUNT:

 				return

 

 			if not slot in self.listHighlightedSlot:

 				self.listHighlightedSlot.append(slot)

 

-		## »èÁ¦

+		## 

 		def DelHighlightSlot(self, inventorylocalslot):

 			if inventorylocalslot in self.listHighlightedSlot:

 				if inventorylocalslot >= player.INVENTORY_PAGE_SIZE:

@@ -3286,9 +3327,9 @@
 

 				self.listHighlightedSlot.remove(inventorylocalslot)

 

-		# ½½·Ô highlight °ü·Ã ³¡

-

-	# wj.2014.12.2. ÀÎº¥Åä¸®¿Í DSÀÎº¥ °£ÀÇ »óÅÂ¸¦ È®ÀÎ ¹× ¼³Á¤ÇÏ±â À§ÇÑ ÇÔ¼ö.

+		#  highlight  

+

+	# wj.2014.12.2. κ丮 DSκ  ¸ Ȯ  ϱ  Լ.

 	def IsDlgQuestionShow(self):

 		if self.dlgQuestion.IsShow():

 			return True


--- a/client/pack/root/uiscript/inventorywindow.py
+++ b/client/pack/root/uiscript/inventorywindow.py
@@ -1,11 +1,11 @@
 import uiScriptLocale

 

-EQUIPMENT_START_INDEX = 90

+EQUIPMENT_START_INDEX = False

 

 window = {

 	"name" : "InventoryWindow",

 

-	## 600 - (width + ¿À¸¥ÂÊÀ¸·Î ºÎÅÍ ¶ç¿ì±â 24 px)

+	## 600 - (width +    24 px)

 	"x" : SCREEN_WIDTH - 176 - 200,

 	"y" : SCREEN_HEIGHT - 37 - 565,

 


--- a/server/metin2/Source/Server/game/src/ShopSearchManager.cpp
+++ b/server/metin2/Source/Server/game/src/ShopSearchManager.cpp
@@ -32,7 +32,7 @@
 

 void CShopSearchManager::OnBuyShopItem(DWORD itemVnum, DWORD itemCount, uint64_t price)

 {

-	TPacketGDShopSearchSoldItem pack;

+	TPacketGDShopSearchSoldItem pack{};

 	pack.itemVnum = itemVnum;

 	pack.itemCount = itemCount;

 	pack.price = price;

@@ -47,7 +47,10 @@
 

 void CShopSearchManager::PC_RequestSearch(LPCHARACTER ch, const std::string& itemName, WORD page, BYTE entryCountIdx, BYTE sortType)

 {

-	TPacketGDShopSearchByName pack;

+	if (!ch || !ch->GetDesc())

+		return;

+

+	TPacketGDShopSearchByName pack{};

 //	BYTE bLocale = ch->GetDesc() ? ch->GetDesc()->GetLanguage() : LOCALE_EN;

 //	pack.langID = bLocale; 

 	strlcpy(pack.itemName, itemName.c_str(), sizeof(pack.itemName));

@@ -60,7 +63,10 @@
 

 void CShopSearchManager::PC_RequestSearch(LPCHARACTER ch, const TShopSearchOptions* options, const TShopSearchItemType* itemTypeFlags, const DWORD* vnumList, WORD page, BYTE entryCountIdx, BYTE sortType)

 {

-	TPacketGDShopSearchByOptions pack;

+	if (!ch || !ch->GetDesc())

+		return;

+

+	TPacketGDShopSearchByOptions pack{};

 	pack.options = *options;

 	pack.page = page;

 	pack.entryCountIdx = entryCountIdx;

@@ -78,6 +84,9 @@
 

 void CShopSearchManager::PC_RequestBuy(LPCHARACTER ch, TOfflineItemID itemID, DWORD itemVnum, int64_t itemPrice)

 {

+	if (!ch || !ch->GetDesc())

+		return;

+

 	if (ch->GetGold() < itemPrice)

 		return;

 

@@ -86,7 +95,7 @@
 

 	ch->PointChange(POINT_GOLD, -itemPrice);

 

-	TPacketGDShopSearchRequestBuy pack;

+	TPacketGDShopSearchRequestBuy pack{};

 	pack.ownerID = ch->GetPlayerID();

 	pack.offlineID = itemID;

 	pack.itemVnum = itemVnum;

@@ -98,6 +107,9 @@
 

 void CShopSearchManager::PC_RequestSoldInfo(LPCHARACTER ch, DWORD itemVnum)

 {

+	if (!ch || !ch->GetDesc())

+		return;

+

 	db_clientdesc->DBPacket(HEADER_GD_SHOP_SEARCH_REQUEST_SOLD_INFO, ch->GetDesc()->GetHandle(), &itemVnum, sizeof(DWORD));

 }

 

@@ -107,14 +119,28 @@
 

 void CShopSearchManager::DB_ResultSearch(LPCHARACTER ch, WORD maxPageNum, const TShopSearchClientItem* items, WORD itemCount)

 {

-	TPacketGCShopSearchResult pack;

+	if (!ch || !ch->GetDesc())

+		return;

+

+	if (itemCount > 0 && items == NULL)

+		return;

+

+	const size_t maxCount = (0xFFFF - sizeof(TPacketGCShopSearchResult)) / sizeof(TShopSearchClientItem);

+	if (itemCount > maxCount)

+	{

+		sys_err("DB_ResultSearch: itemCount overflow (%u)", itemCount);

+		return;

+	}

+

+	TPacketGCShopSearchResult pack{};

 	pack.header = HEADER_GC_SHOP_SEARCH_RESULT;

 	pack.size = sizeof(pack) + sizeof(TShopSearchClientItem) * itemCount;

 	pack.itemCount = itemCount;

 	pack.maxPageNum = maxPageNum;

 

 	ch->GetDesc()->BufferedPacket(&pack, sizeof(pack));

-	ch->GetDesc()->Packet(items, sizeof(TShopSearchClientItem) * itemCount);

+	if (itemCount > 0)

+		ch->GetDesc()->Packet(items, sizeof(TShopSearchClientItem) * itemCount);

 }

 

 void CShopSearchManager::DB_BuyFromShop(const TPacketDGShopSearchBuyFromShop* data)

@@ -156,7 +182,7 @@
 #else

 		data->itemPrice, item->GetSockets(), item->GetAttributes(), item->GetTransmutationVnum());

 #endif

-	TPacketGDShopSearchBoughtFromShop pack;

+	TPacketGDShopSearchBoughtFromShop pack{};

 	pack.buyerDBHandle = data->buyerDBHandle;

 	ITEM_MANAGER::Instance().GetPlayerItem(item, &pack.item);

 	pack.item.dwOwner = data->buyerPID;

@@ -183,6 +209,11 @@
 		TPlayerItem* itemData = (TPlayerItem*) data;

 

 		LPITEM item = ITEM_MANAGER::instance().CreateItem(itemData->dwVnum, itemData->dwCount);

+		if (!item)

+		{

+			sys_err("DB_BuyResult: cannot create item");

+			return;

+		}

 		item->SetAttributes(itemData->aAttr);

 #if defined(__ITEM_APPLY_RANDOM__)

 		item->SetRandomApplies(itemData->aApplyRandom);

@@ -221,7 +252,7 @@
 

 	if (ch)

 	{

-		TPacketGCShopSearchBuyResult pack;

+		TPacketGCShopSearchBuyResult pack{};

 		pack.header = HEADER_GC_SHOP_SEARCH_BUY_RESULT;

 		pack.result = resultType;

 

@@ -231,7 +262,7 @@
 

 void CShopSearchManager::DB_SoldInfo(LPCHARACTER ch, bool hasResults, const TShopSearchSoldItemInfo* results)

 {

-	TPacketGCShopSearchSoldInfo pack;

+	TPacketGCShopSearchSoldInfo pack{};

 	pack.header = HEADER_GC_SHOP_SEARCH_SOLD_INFO;

 	pack.size = sizeof(pack);

 	pack.results = hasResults;


--- a/server/metin2/Source/Server/game/src/char_item.cpp
+++ b/server/metin2/Source/Server/game/src/char_item.cpp
@@ -121,7 +121,7 @@
 };

 #endif

 

-// ±ÍÈ¯ºÎ, ±ÍÈ¯±â¾ïºÎ, °áÈ¥¹ÝÁö

+// ȯ, ȯ, ȥ

 bool IS_SUMMON_ITEM(LPITEM item, int map_index)

 {

 	if (item->GetVnum() == ITEM_MARRIAGE_RING)

@@ -222,37 +222,37 @@
 

 bool IS_SUMMONABLE_ZONE(int map_index)

 {

-	// ¸ùÅ°´øÀü

+	// Ű

 	if (IS_MONKEY_DUNGEON(map_index))

 		return false;

 

 	if (IS_MAZE_DUNGEON(map_index))

 		return false;

 

-	// ¼º

+	// 

 	if (IS_CASTLE_MAP(map_index))

 		return false;

 

 	switch (map_index)

 	{

-		case MAP_DEVILTOWER1: // »ç±ÍÅ¸¿ö

-		case MAP_SPIDERDUNGEON_02: // °Å¹Ì ´øÀü 2Ãþ

-		case MAP_SKIPIA_DUNGEON_01: // ÃµÀÇ µ¿±¼

-		case MAP_SKIPIA_DUNGEON_02: // ÃµÀÇ µ¿±¼ 2Ãþ

+		case MAP_DEVILTOWER1: // Ÿ

+		case MAP_SPIDERDUNGEON_02: // Ź  2

+		case MAP_SKIPIA_DUNGEON_01: // õ 

+		case MAP_SKIPIA_DUNGEON_02: // õ  2

 #if 0

-		case 193: // °Å¹Ì ´øÀü 2-1Ãþ

-		case 184: // ÃµÀÇ µ¿±¼(½Å¼ö)

-		case 185: // ÃµÀÇ µ¿±¼ 2Ãþ(½Å¼ö)

-		case 186: // ÃµÀÇ µ¿±¼(ÃµÁ¶)

-		case 187: // ÃµÀÇ µ¿±¼ 2Ãþ(ÃµÁ¶)

-		case 188: // ÃµÀÇ µ¿±¼(Áø³ë)

-		case 189: // ÃµÀÇ µ¿±¼ 2Ãþ(Áø³ë)

-#endif

-			//case 206: // ¾Æ±Íµ¿±¼

-		case MAP_DEVILSCATACOMB: // ¾Æ±Íµ¿±¼

-		case MAP_SPIDERDUNGEON_03: // °Å¹Ì ´øÀü 3Ãþ

-		case MAP_SKIPIA_DUNGEON_BOSS: // ÃµÀÇ µ¿±¼ (¿ë¹æ)

-		case MAP_OXEVENT: // OX Event ¸Ê

+		case 193: // Ź  2-1

+		case 184: // õ (ż)

+		case 185: // õ  2(ż)

+		case 186: // õ (õ)

+		case 187: // õ  2(õ)

+		case 188: // õ ()

+		case 189: // õ  2()

+#endif

+			//case 206: // Ʊ͵

+		case MAP_DEVILSCATACOMB: // Ʊ͵

+		case MAP_SPIDERDUNGEON_03: // Ź  3

+		case MAP_SKIPIA_DUNGEON_BOSS: // õ  ()

+		case MAP_OXEVENT: // OX Event 

 		case MAP_12ZI_STAGE: // 12ZI

 		case MAP_BATTLEFIED: // Battlefield

 			return false;

@@ -261,7 +261,7 @@
 	if (CBattleArena::IsBattleArenaMap(map_index))

 		return false;

 

-	// ¸ðµç private ¸ÊÀ¸·Ð ¿öÇÁ ºÒ°¡´É

+	//  private   Ұ

 	if (map_index > 10000)

 		return false;

 

@@ -287,7 +287,7 @@
 	return false;

 }

 

-// item socket ÀÌ ÇÁ·ÎÅäÅ¸ÀÔ°ú °°ÀºÁö Ã¼Å© -- by mhh

+// item socket  Ÿ԰  üũ -- by mhh

 static bool FN_check_item_socket(LPITEM item)

 {

 	switch (item->GetVnum())

@@ -320,7 +320,7 @@
 	return true;

 }

 

-// item socket º¹»ç -- by mhh

+// item socket  -- by mhh

 static void FN_copy_item_socket(LPITEM dest, LPITEM src)

 {

 	for (int i = 0; i < ITEM_SOCKET_MAX_NUM; ++i)

@@ -331,14 +331,14 @@
 

 static bool FN_check_item_sex(LPCHARACTER ch, LPITEM item)

 {

-	// ³²ÀÚ ±ÝÁö

+	//  

 	if (IS_SET(item->GetAntiFlag(), ITEM_ANTIFLAG_MALE))

 	{

 		if (SEX_MALE == GET_SEX(ch))

 			return false;

 	}

 

-	// ¿©ÀÚ±ÝÁö

+	// ڱ

 	if (IS_SET(item->GetAntiFlag(), ITEM_ANTIFLAG_FEMALE))

 	{

 		if (SEX_FEMALE == GET_SEX(ch))

@@ -351,7 +351,7 @@
 #define VERIFY_POTION(affect, afftype) \

 	if (FindAffect(affect, afftype)) \

 	{ \

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù.")); \

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ.")); \

 		return false; \

 	}

 

@@ -554,7 +554,7 @@
 		return;

 	}

 

-	// ±âº» ÀÎº¥Åä¸®

+	// ⺻ κ丮

 	switch (bWindowType)

 	{

 		case INVENTORY:

@@ -606,8 +606,8 @@
 							continue;

 #endif

 

-						// wCell + 1 ·Î ÇÏ´Â °ÍÀº ºó°÷À» Ã¼Å©ÇÒ ¶§ °°Àº

-						// ¾ÆÀÌÅÛÀº ¿¹¿ÜÃ³¸®ÇÏ±â À§ÇÔ

+						// wCell + 1  ϴ   üũ  

+						//  óϱ 

 						m_pointsInstant.wInventoryItemGrid[wSlot] = wCell + 1;

 					}

 				}

@@ -791,7 +791,7 @@
 

 	if (GetDesc())

 	{

-		// È®Àå ¾ÆÀÌÅÛ: ¼­¹ö¿¡¼­ ¾ÆÀÌÅÛ ÇÃ·¡±× Á¤º¸¸¦ º¸³½´Ù

+		// Ȯ :   ÷  

 		if (pItem)

 		{

 			TPacketGCItemSet pack;

@@ -913,7 +913,7 @@
 

 	if (!item && wCell == WEAR_WEAPON)

 	{

-		// ±Í°Ë »ç¿ë ½Ã ¹þ´Â °ÍÀÌ¶ó¸é È¿°ú¸¦ ¾ø¾Ö¾ß ÇÑ´Ù.

+		// Ͱ    ̶ ȿ ־ Ѵ.

 		if (IsAffectFlag(AFF_GWIGUM))

 			RemoveAffect(SKILL_GWIGEOM);

 

@@ -1007,8 +1007,8 @@
 #endif

 				return false;

 

-			// bItemCellÀº 0ÀÌ falseÀÓÀ» ³ªÅ¸³»±â À§ÇØ + 1 ÇØ¼­ Ã³¸®ÇÑ´Ù.

-			// µû¶ó¼­ iExceptionCell¿¡ 1À» ´õÇØ ºñ±³ÇÑ´Ù.

+			// bItemCell 0 false Ÿ  + 1 ؼ óѴ.

+			//  iExceptionCell 1  Ѵ.

 			++iExceptionCell;

 

 			if (m_pointsInstant.wInventoryItemGrid[wCell])

@@ -1054,7 +1054,7 @@
 					return false;

 			}

 

-			// Å©±â°¡ 1ÀÌ¸é ÇÑÄ­À» Â÷ÁöÇÏ´Â °ÍÀÌ¹Ç·Î ±×³É ¸®ÅÏ

+			// ũⰡ 1̸ ĭ ϴ ̹Ƿ ׳ 

 			if (1 == bSize)

 				return true;

 			else

@@ -1230,8 +1230,8 @@
 

 int CHARACTER::GetEmptyInventory(BYTE size) const

 {

-	// NOTE : ÇöÀç ÀÌ ÇÔ¼ö´Â ¾ÆÀÌÅÛ Áö±Þ, È¹µæ µîÀÇ ÇàÀ§¸¦ ÇÒ ¶§ ÀÎº¥Åä¸®ÀÇ ºó Ä­À» Ã£±â À§ÇØ »ç¿ëµÇ°í ÀÖ´Âµ¥,

-	// º§Æ® ÀÎº¥Åä¸®´Â Æ¯¼ö ÀÎº¥Åä¸®ÀÌ¹Ç·Î °Ë»çÇÏÁö ¾Êµµ·Ï ÇÑ´Ù. (±âº» ÀÎº¥Åä¸®: INVENTORY_MAX_NUM ±îÁö¸¸ °Ë»ç)

+	// NOTE :   Լ  , ȹ     κ丮  ĭ ã  ǰ ִµ,

+	// Ʈ κ丮 Ư κ丮̹Ƿ ˻ ʵ Ѵ. (⺻ κ丮: INVENTORY_MAX_NUM  ˻)

 #if defined(__EXTEND_INVEN_SYSTEM__)

 	for (int i = 0; i < GetExtendInvenMax(); ++i)

 #else

@@ -1244,8 +1244,8 @@
 

 int CHARACTER::GetEmptyInventoryCount(BYTE size) const

 {

-	// NOTE : ÇöÀç ÀÌ ÇÔ¼ö´Â ¾ÆÀÌÅÛ Áö±Þ, È¹µæ µîÀÇ ÇàÀ§¸¦ ÇÒ ¶§ ÀÎº¥Åä¸®ÀÇ ºó Ä­À» Ã£±â À§ÇØ »ç¿ëµÇ°í ÀÖ´Âµ¥,

-	// º§Æ® ÀÎº¥Åä¸®´Â Æ¯¼ö ÀÎº¥Åä¸®ÀÌ¹Ç·Î °Ë»çÇÏÁö ¾Êµµ·Ï ÇÑ´Ù. (±âº» ÀÎº¥Åä¸®: INVENTORY_MAX_NUM ±îÁö¸¸ °Ë»ç)

+	// NOTE :   Լ  , ȹ     κ丮  ĭ ã  ǰ ִµ,

+	// Ʈ κ丮 Ư κ丮̹Ƿ ˻ ʵ Ѵ. (⺻ κ丮: INVENTORY_MAX_NUM  ˻)

 	int emptyCount = 0;

 #if defined(__EXTEND_INVEN_SYSTEM__)

 	for (int i = 0; i < GetExtendInvenMax(); ++i)

@@ -1384,7 +1384,7 @@
 	// END_OF_ACCESSORY_REFINE

 	else

 	{

-		// ¿©±â¼­ ±úÁø¼®ÀÌ ÀÚµ¿ÀûÀ¸·Î Ã»¼Ò µÊ

+		// ⼭  ڵ û 

 		for (int i = 0; i < METIN_SOCKET_MAX_NUM; ++i)

 		{

 			if (!pkOldItem->GetSocket(i))

@@ -1393,7 +1393,7 @@
 				pkNewItem->SetSocket(i, 1);

 		}

 

-		// ¼ÒÄÏ ¼³Á¤

+		//  

 		int slot = 0;

 

 		for (int i = 0; i < METIN_SOCKET_MAX_NUM; ++i)

@@ -1411,7 +1411,7 @@
 		pkNewItem->SetSocket(i, pkOldItem->GetSocket(i));

 #endif

 

-	// ¸ÅÁ÷ ¾ÆÀÌÅÛ ¼³Á¤

+	//   

 	pkOldItem->CopyAttributeTo(pkNewItem);

 }

 

@@ -1466,8 +1466,8 @@
 		return false;

 	}

 

-	//°³·® ½Ã°£Á¦ÇÑ : upgrade_refine_scroll.quest ¿¡¼­ °³·®ÈÄ 5ºÐÀÌ³»¿¡ ÀÏ¹Ý °³·®À»

-	//ÁøÇàÇÒ¼ö ¾øÀ½

+	// ð : upgrade_refine_scroll.quest   5̳ Ϲ 

+	//Ҽ 

 	if (quest::CQuestManager::instance().GetEventFlag("update_refine_time") != 0)

 	{

 		if (get_global_time() < quest::CQuestManager::instance().GetEventFlag("update_refine_time") + (60 * 5))

@@ -1492,7 +1492,7 @@
 	{

 		if (!item->CheckItemUseLevel(20) || item->GetType() != ITEM_WEAPON)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹«·á °³·® ±âÈ¸´Â 20 ÀÌÇÏÀÇ ¹«±â¸¸ °¡´ÉÇÕ´Ï´Ù"));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ȸ 20  ⸸ մϴ"));

 			return false;

 		}

 		cost = 0;

@@ -1502,7 +1502,7 @@
 

 	if (result_vnum == 0)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 		return false;

 	}

 

@@ -1514,7 +1514,7 @@
 	if (!pProto)

 	{

 		sys_err("DoRefine NOT GET ITEM PROTO %d", item->GetRefinedVnum());

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 		return false;

 	}

 

@@ -1531,7 +1531,7 @@
 				{

 					if (GetLevel() < limit)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®µÈ ÈÄ ¾ÆÀÌÅÛÀÇ ·¹º§ Á¦ÇÑº¸´Ù ·¹º§ÀÌ ³·½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("    Ѻ  ϴ."));

 						return false;

 					}

 				}

@@ -1542,7 +1542,7 @@
 				{

 					if (GetConquerorLevel() < limit)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®µÈ ÈÄ ¾ÆÀÌÅÛÀÇ ·¹º§ Á¦ÇÑº¸´Ù ·¹º§ÀÌ ³·½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("    Ѻ  ϴ."));

 						return false;

 					}

 				}

@@ -1555,7 +1555,7 @@
 	// REFINE_COST

 	if (GetGold() < (long long)cost)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ µ·ÀÌ ºÎÁ·ÇÕ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ   մϴ."));

 		return false;

 	}

 

@@ -1565,7 +1565,7 @@
 	{

 		if (-1 == iEmptyPos)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 			return false;

 		}

 	}

@@ -1582,7 +1582,7 @@
 					ChatPacket(CHAT_TYPE_INFO, "Find %d, count %d, require %d", prt->materials[i].vnum, CountSpecifyItem(prt->materials[i].vnum), prt->materials[i].count);

 				}

 

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ Àç·á°¡ ºÎÁ·ÇÕ´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ  ᰡ մϴ."));

 				return false;

 			}

 		}

@@ -1600,7 +1600,7 @@
 

 	if (prob <= prt->prob)

 	{

-		// ¼º°ø! ¸ðµç ¾ÆÀÌÅÛÀÌ »ç¶óÁö°í, °°Àº ¼Ó¼ºÀÇ ´Ù¸¥ ¾ÆÀÌÅÛ È¹µæ

+		// !   ,  Ӽ ٸ  ȹ

 		LPITEM pkNewItem = ITEM_MANAGER::instance().CreateItem(result_vnum, 1, 0, false);

 

 		if (pkNewItem)

@@ -1659,7 +1659,7 @@
 		else

 		{

 			// DETAIL_REFINE_LOG

-			// ¾ÆÀÌÅÛ »ý¼º¿¡ ½ÇÆÐ -> °³·® ½ÇÆÐ·Î °£ÁÖ

+			//    ->  з 

 			sys_err("cannot create item %u", result_vnum);

 #if defined(__REFINE_MSG_ADD__)

 			NotifyRefineFailType(this, item, REFINE_FAIL_KEEP_GRADE, IsRefineThroughGuild() ? "GUILD" : "POWER");

@@ -1671,7 +1671,7 @@
 	}

 	else

 	{

-		// ½ÇÆÐ! ¸ðµç ¾ÆÀÌÅÛÀÌ »ç¶óÁü.

+		// !   .

 		DBManager::instance().SendMoneyLog(MONEY_LOG_REFINE, item->GetVnum(), -cost);

 #if defined(__REFINE_MSG_ADD__)

 		NotifyRefineFailType(this, item, REFINE_FAIL_DEL_ITEM, IsRefineThroughGuild() ? "GUILD" : "POWER");

@@ -1752,7 +1752,7 @@
 	DWORD result_vnum = item->GetRefinedVnum();

 	if (result_vnum == 0)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 		return false;

 	}

 

@@ -1760,7 +1760,7 @@
 	if (!proto)

 	{

 		sys_err("DoRefineSoul NOT GET ITEM PROTO %d", item->GetRefinedVnum());

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 		return false;

 	}

 

@@ -1820,8 +1820,8 @@
 

 	ClearRefineMode();

 

-	// °³·® ½Ã°£Á¦ÇÑ : upgrade_refine_scroll.quest ¿¡¼­ °³·®ÈÄ 5ºÐÀÌ³»¿¡ ÀÏ¹Ý °³·®À»

-	// ÁøÇàÇÒ¼ö ¾øÀ½

+	//  ð : upgrade_refine_scroll.quest   5̳ Ϲ 

+	// Ҽ 

 	if (quest::CQuestManager::instance().GetEventFlag("update_refine_time") != 0)

 	{

 		if (get_global_time() < quest::CQuestManager::instance().GetEventFlag("update_refine_time") + (60 * 5))

@@ -1837,7 +1837,7 @@
 

 	LPITEM pkItemScroll;

 

-	// °³·®¼­ Ã¼Å©

+	//  üũ

 	if (m_iRefineAdditionalCell < 0)

 		return false;

 

@@ -1857,7 +1857,7 @@
 

 	if (result_vnum == 0)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 		return false;

 	}

 

@@ -1865,13 +1865,13 @@
 	if (!pProto)

 	{

 		sys_err("DoRefineWithScroll NOT GET ITEM PROTO %d", item->GetRefinedVnum());

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 		return false;

 	}

 

 	if (GetGold() < prt->cost)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ µ·ÀÌ ºÎÁ·ÇÕ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ   մϴ."));

 		return false;

 	}

 

@@ -1881,7 +1881,7 @@
 	{

 		if (-1 == iEmptyPos)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 			return false;

 		}

 	}

@@ -1896,7 +1896,7 @@
 				ChatPacket(CHAT_TYPE_INFO, "Find %d, count %d, require %d", prt->materials[i].vnum, CountSpecifyItem(prt->materials[i].vnum), prt->materials[i].count);

 			}

 

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³·®À» ÇÏ±â À§ÇÑ Àç·á°¡ ºÎÁ·ÇÕ´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϱ  ᰡ մϴ."));

 			return false;

 		}

 	}

@@ -1956,7 +1956,7 @@
 

 	if (prob <= kScroll.bSuccessProb)

 	{

-		// ¼º°ø! ¸ðµç ¾ÆÀÌÅÛÀÌ »ç¶óÁö°í, °°Àº ¼Ó¼ºÀÇ ´Ù¸¥ ¾ÆÀÌÅÛ È¹µæ

+		// !   ,  Ӽ ٸ  ȹ

 		LPITEM pkNewItem = ITEM_MANAGER::instance().CreateItem(result_vnum, 1, 0, false);

 

 		if (pkNewItem)

@@ -2009,7 +2009,7 @@
 		}

 		else

 		{

-			// ¾ÆÀÌÅÛ »ý¼º¿¡ ½ÇÆÐ -> °³·® ½ÇÆÐ·Î °£ÁÖ

+			//    ->  з 

 			sys_err("cannot create item %u", result_vnum);

 #if defined(__REFINE_MSG_ADD__)

 			NotifyRefineFailType(this, item, REFINE_FAIL_KEEP_GRADE, szRefineType);

@@ -2020,7 +2020,7 @@
 	}

 	else if (!kScroll.bKeepGrade && result_fail_vnum)

 	{

-		// ½ÇÆÐ! ¸ðµç ¾ÆÀÌÅÛÀÌ »ç¶óÁö°í, °°Àº ¼Ó¼ºÀÇ ³·Àº µî±ÞÀÇ ¾ÆÀÌÅÛ È¹µæ

+		// !   ,  Ӽ    ȹ

 		LPITEM pkNewItem = ITEM_MANAGER::instance().CreateItem(result_fail_vnum, 1, 0, false);

 

 		if (pkNewItem)

@@ -2078,7 +2078,7 @@
 		}

 		else

 		{

-			// ¾ÆÀÌÅÛ »ý¼º¿¡ ½ÇÆÐ -> °³·® ½ÇÆÐ·Î °£ÁÖ

+			//    ->  з 

 			sys_err("cannot create item %u", result_fail_vnum);

 #if defined(__REFINE_MSG_ADD__)

 			NotifyRefineFailType(this, item, REFINE_FAIL_KEEP_GRADE, szRefineType);

@@ -2092,7 +2092,7 @@
 #if defined(__REFINE_MSG_ADD__)

 		NotifyRefineFailType(this, item, REFINE_FAIL_KEEP_GRADE, szRefineType);

 #else

-		NotifyRefineFail(this, item, szRefineType); // °³·®½Ã ¾ÆÀÌÅÛ »ç¶óÁöÁö ¾ÊÀ½

+		NotifyRefineFail(this, item, szRefineType); //    

 #endif

 		PayRefineFee(prt->cost);

 	}

@@ -2106,7 +2106,7 @@
 	Scroll.bSuccessProb = bProb;

 	Scroll.bKeepGrade = false;

 

-	// ÇöÃ¶, ¿ë½ÅÀÇ Ãàº¹¼­, ¾ß°øÀÇ ºñÀü¼­ Ã³¸®

+	// ö,  ູ, ߰  ó

 	switch (bScrollType)

 	{

 		case CHUKBOK_SCROLL:

@@ -2121,7 +2121,7 @@
 			Scroll.bSuccessProb = MINMAX(1, bProb + 10, 100);

 			break;

 

-		case MUSIN_SCROLL: // ¹«½ÅÀÇ Ãàº¹¼­´Â 100% ¼º°ø (+4±îÁö¸¸)

+		case MUSIN_SCROLL: //  ູ 100%  (+4)

 			Scroll.bSuccessProb = 100;

 			break;

 

@@ -2165,7 +2165,7 @@
 	// REFINE_COST

 	if (bType == REFINE_TYPE_MONEY_ONLY && !GetQuestFlag("deviltower_zone.can_refine"))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ç±Í Å¸¿ö ¿Ï·á º¸»óÀº ÇÑ¹ø±îÁö »ç¿ë°¡´ÉÇÕ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ÿ Ϸ  ѹ 밡մϴ."));

 		return false;

 	}

 	// END_OF_REFINE_COST

@@ -2190,7 +2190,7 @@
 	if (p.result_vnum == 0)

 	{

 		sys_err("RefineInformation p.result_vnum == 0");

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 		return false;

 	}

 

@@ -2198,7 +2198,7 @@
 	{

 		if (bType == 0)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº ÀÌ ¹æ½ÄÀ¸·Î´Â °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("   δ   ϴ."));

 			return false;

 		}

 		else

@@ -2206,8 +2206,8 @@
 			const LPITEM& item_scroll = GetInventoryItem(iAdditionalCell);

 			if (!item_scroll || item->GetVnum() == item_scroll->GetVnum())

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("°°Àº °³·®¼­¸¦ ÇÕÄ¥ ¼ö´Â ¾ø½À´Ï´Ù."));

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ãàº¹ÀÇ ¼­¿Í ÇöÃ¶À» ÇÕÄ¥ ¼ö ÀÖ½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ĥ  ϴ."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ູ  ö ĥ  ֽϴ."));

 				return false;

 			}

 		}

@@ -2236,7 +2236,7 @@
 	if (!prt)

 	{

 		sys_err("RefineInformation NOT GET REFINE SET %d", item->GetRefineSet());

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 		return false;

 	}

 

@@ -2245,10 +2245,10 @@
 	// MAIN_QUEST_LV7

 	if (GetQuestFlag("main_quest_lv7.refine_chance") > 0)

 	{

-		// ÀÏº»Àº Á¦¿Ü

+		// Ϻ 

 		if (!item->CheckItemUseLevel(20) || item->GetType() != ITEM_WEAPON)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹«·á °³·® ±âÈ¸´Â 20 ÀÌÇÏÀÇ ¹«±â¸¸ °¡´ÉÇÕ´Ï´Ù"));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ȸ 20  ⸸ մϴ"));

 			return false;

 		}

 		p.cost = 0;

@@ -2299,8 +2299,8 @@
 

 	if (pkItem->GetSubType() == USE_TUNING)

 	{

-		// XXX ¼º´É, ¼ÒÄÏ °³·®¼­´Â »ç¶óÁ³½À´Ï´Ù...

-		// XXX ¼º´É°³·®¼­´Â Ãàº¹ÀÇ ¼­°¡ µÇ¾ú´Ù!

+		// XXX ,   ϴ...

+		// XXX ɰ ູ  Ǿ!

 

 		BYTE bRefineType = REFINE_TYPE_NORMAL;

 		switch (pkItem->GetValue(0))

@@ -2313,7 +2313,7 @@
 			{

 				if (pkTarget->GetRefineLevel() >= 4)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ °³·®¼­·Î ´õ ÀÌ»ó °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ̻   ϴ."));

 					return false;

 				}

 

@@ -2325,7 +2325,7 @@
 			{

 				if (pkTarget->GetRefineLevel() != pkItem->GetValue(1))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ °³·®¼­·Î °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 					return false;

 				}

 

@@ -2337,7 +2337,7 @@
 			{

 				if (pkTarget->GetType() != ITEM_METIN || pkTarget->GetRefineLevel() != 4)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀ¸·Î °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 					return false;

 				}

 

@@ -2387,17 +2387,17 @@
 				if (pkTarget->GetRefineSet() == 501)

 					return false;

 

-				if (pkTarget->GetVnum() >= 28330 && pkTarget->GetVnum() <= 28343) // ¿µ¼®+3

+				if (pkTarget->GetVnum() >= 28330 && pkTarget->GetVnum() <= 28343) // +3

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("+3 ¿µ¼®Àº ÀÌ ¾ÆÀÌÅÛÀ¸·Î °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù"));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("+3      ϴ"));

 					return false;

 				}

 

-				if (pkTarget->GetVnum() >= 28430 && pkTarget->GetVnum() <= 28443) // ¿µ¼®+4

+				if (pkTarget->GetVnum() >= 28430 && pkTarget->GetVnum() <= 28443) // +4

 				{

-					if (pkItem->GetVnum() != 71056) // Ã»·æÀÇ¼û°á

+					if (pkItem->GetVnum() != 71056) // ûǼ

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿µ¼®Àº ÀÌ ¾ÆÀÌÅÛÀ¸·Î °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù"));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("     ϴ"));

 						return false;

 					}

 				}

@@ -2449,7 +2449,7 @@
 					AutoGiveItem(socket);

 					//TItemTable* pTable = ITEM_MANAGER::instance().GetTable(pkTarget->GetSocket(i));

 					//pkTarget->SetSocket(i, pTable->alValues[2]);

-					// ±úÁøµ¹·Î ´ëÃ¼ÇØÁØ´Ù

+					//  üش

 					pkTarget->SetSocket(i, ITEM_BROKEN_METIN_VNUM);

 				}

 			}

@@ -2458,7 +2458,7 @@
 		}

 		else

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("»©³¾ ¼ö ÀÖ´Â ¸ÞÆ¾¼®ÀÌ ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ִ ƾ ϴ."));

 			return false;

 		}

 	}

@@ -2514,18 +2514,18 @@
 

 	if (iEmpireByMapIndex && GetEmpire() != iEmpireByMapIndex)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("±â¾ïÇØ µÑ ¼ö ¾ø´Â À§Ä¡ ÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ġ Դϴ."));

 		return false;

 	}

 

 	int pos;

 

-	if (item->GetCount() == 1) // ¾ÆÀÌÅÛÀÌ ÇÏ³ª¶ó¸é ±×³É ¼ÂÆÃ.

+	if (item->GetCount() == 1) //  ϳ ׳ .

 	{

 		item->SetSocket(0, GetX());

 		item->SetSocket(1, GetY());

 	}

-	else if ((pos = GetEmptyInventory(item->GetSize())) != -1) // ±×·¸Áö ¾Ê´Ù¸é ´Ù¸¥ ÀÎº¥Åä¸® ½½·ÔÀ» Ã£´Â´Ù.

+	else if ((pos = GetEmptyInventory(item->GetSize())) != -1) // ׷ ʴٸ ٸ κ丮  ã´.

 	{

 		LPITEM item2 = ITEM_MANAGER::instance().CreateItem(item->GetVnum(), 1);

 		if (item2 != nullptr)

@@ -2539,7 +2539,7 @@
 	}

 	else

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 		return false;

 	}

 

@@ -2570,14 +2570,14 @@
 		case 216:

 			iEmpireByMapIndex = -1;

 			break;

-			// ¾Ç·æ±ºµµ ÀÏ¶§

+			// Ƿ決 ϶

 		case 301:

 		case 302:

 		case 303:

 		case 304:

 			if (GetLevel() < 90)

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛÀÇ ·¹º§ Á¦ÇÑº¸´Ù ·¹º§ÀÌ ³·½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ѻ  ϴ."));

 				return;

 			}

 			else

@@ -2586,7 +2586,7 @@
 

 	if (iEmpireByMapIndex && GetEmpire() != iEmpireByMapIndex)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("±â¾ïµÈ À§Ä¡°¡ Å¸Á¦±¹¿¡ ¼ÓÇØ ÀÖ¾î¼­ ±ÍÈ¯ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ġ Ÿ  ־ ȯ  ϴ."));

 		item->SetSocket(0, 0);

 		item->SetSocket(1, 0);

 	}

@@ -2609,7 +2609,7 @@
 		ChatPacket(CHAT_TYPE_COMMAND, "OpenPrivateShop");

 		break;

 	default:

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("°©¿ÊÀ» ¹þ¾î¾ß °³ÀÎ »óÁ¡À» ¿­ ¼ö ÀÖ½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("      ֽϴ."));

 		break;

 	}

 }

@@ -2633,7 +2633,7 @@
 }

 

 //

-// DB Ä³½Ã·Î ºÎÅÍ ¹ÞÀº ¸®½ºÆ®¸¦ User ¿¡°Ô Àü¼ÛÇÏ°í »óÁ¡À» ¿­¶ó´Â Ä¿¸Çµå¸¦ º¸³½´Ù.

+// DB ĳ÷   Ʈ User  ϰ   Ŀǵ带 .

 //

 void CHARACTER::UseSilkBotaryReal(const TPacketMyshopPricelistHeader* p)

 {

@@ -2649,7 +2649,7 @@
 	}

 #else

 	if (!p->byCount)

-		// °¡°Ý ¸®½ºÆ®°¡ ¾ø´Ù. dummy µ¥ÀÌÅÍ¸¦ ³ÖÀº Ä¿¸Çµå¸¦ º¸³»ÁØ´Ù.

+		//  Ʈ . dummy ͸  Ŀǵ带 ش.

 		SendMyShopPriceListCmd(1, 0);

 	else {

 		for (int idx = 0; idx < p->byCount; idx++)

@@ -2661,8 +2661,8 @@
 }

 

 //

-// ÀÌ¹ø Á¢¼Ó ÈÄ Ã³À½ »óÁ¡À» Open ÇÏ´Â °æ¿ì ¸®½ºÆ®¸¦ Load ÇÏ±â À§ÇØ DB Ä³½Ã¿¡ °¡°ÝÁ¤º¸ ¸®½ºÆ® ¿äÃ» ÆÐÅ¶À» º¸³½´Ù.

-// ÀÌÈÄºÎÅÍ´Â ¹Ù·Î »óÁ¡À» ¿­¶ó´Â ÀÀ´äÀ» º¸³½´Ù.

+// ̹   ó  Open ϴ  Ʈ Load ϱ  DB ĳÿ  Ʈ û Ŷ .

+// ĺʹ ٷ    .

 //

 void CHARACTER::UseSilkBotary(void)

 {

@@ -2692,13 +2692,13 @@
 		const int needLife = ch->GetMaxHP() * needPercent / 100;

 		if (curLife < needLife)

 		{

-			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("³²Àº »ý¸í·Â ¾çÀÌ ¸ðÀÚ¶ó »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ڶ   ϴ."));

 			return -1;

 		}

 

 		consumeLife = needLife;

 

-		// CheckMinLifeForWarp: µ¶¿¡ ÀÇÇØ¼­ Á×À¸¸é ¾ÈµÇ¹Ç·Î »ý¸í·Â ÃÖ¼Ò·®´Â ³²°ÜÁØ´Ù

+		// CheckMinLifeForWarp:  ؼ  ȵǹǷ  ּҷ ش

 		const int minPercent = WARP_MIN_LIFE_PERCENT;

 		const int minLife = ch->GetMaxHP() * minPercent / 100;

 		if (curLife - needLife < minLife)

@@ -2720,7 +2720,7 @@
 

 	if (curSP < needSP)

 	{

-		lpChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("³²Àº Á¤½Å·Â ¾çÀÌ ¸ðÀÚ¶ó »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		lpChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ŷ  ڶ   ϴ."));

 		return -1;

 	}

 

@@ -2745,7 +2745,7 @@
 			{

 				if (GetLevel() < limitValue)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛÀÇ ·¹º§ Á¦ÇÑº¸´Ù ·¹º§ÀÌ ³·½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ѻ  ϴ."));

 					return false;

 				}

 			}

@@ -2756,7 +2756,7 @@
 			{

 				if (GetConquerorLevel() < limitValue)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛÀÇ ·¹º§ Á¦ÇÑº¸´Ù ·¹º§ÀÌ ³·½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ѻ  ϴ."));

 					return false;

 				}

 			}

@@ -2780,7 +2780,7 @@
 

 	if (CArenaManager::instance().IsLimitedItem(GetMapIndex(), item->GetVnum()))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 		return false;

 	}

 

@@ -2789,13 +2789,13 @@
 		iLimitRealtimeStartFirstUseFlagIndex = -1;

 #endif

 

-	// ¾ÆÀÌÅÛ ÃÖÃÊ »ç¿ë ÀÌÈÄºÎÅÍ´Â »ç¿ëÇÏÁö ¾Ê¾Æµµ ½Ã°£ÀÌ Â÷°¨µÇ´Â ¹æ½Ä Ã³¸®.

+	//    ĺʹ  ʾƵ ð Ǵ  ó.

 	if (-1 != iLimitRealtimeStartFirstUseFlagIndex)

 	{

-		// ÇÑ ¹øÀÌ¶óµµ »ç¿ëÇÑ ¾ÆÀÌÅÛÀÎÁö ¿©ºÎ´Â Socket1À» º¸°í ÆÇ´ÜÇÑ´Ù. (Socket1¿¡ »ç¿ëÈ½¼ö ±â·Ï)

+		//  ̶   δ Socket1  ǴѴ. (Socket1 Ƚ )

 		if (0 == item->GetSocket(1))

 		{

-			// »ç¿ë°¡´É½Ã°£Àº Default °ªÀ¸·Î Limit Value °ªÀ» »ç¿ëÇÏµÇ, Socket0¿¡ °ªÀÌ ÀÖÀ¸¸é ±× °ªÀ» »ç¿ëÇÏµµ·Ï ÇÑ´Ù. (´ÜÀ§´Â ÃÊ)

+			// 밡ɽð Default  Limit Value  ϵ, Socket0     ϵ Ѵ. ( )

 			long duration = (0 != item->GetSocket(0)) ? item->GetSocket(0) : item->GetProto()->aLimits[iLimitRealtimeStartFirstUseFlagIndex].lValue;

 

 			if (0 == duration)

@@ -2839,7 +2839,7 @@
 						{

 							if (item->GetVnum() == 50051 || item->GetVnum() == 50052 || item->GetVnum() == 50053)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 								return false;

 							}

 						}

@@ -3019,7 +3019,7 @@
 			{

 				if (item->GetVnum() == ITEM_VNUM_HORSE_PICTURE || item->GetVnum() == ITEM_VNUM_ARMED_HORSE_BOOK || item->GetVnum() == ITEM_VNUM_MILITARY_HORSE_BOOK)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 					return false;

 				}

 			}

@@ -3047,13 +3047,48 @@
 

 			if (!tree)

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ð´ÚºÒÀ» ÇÇ¿ï ¼ö ¾ø´Â ÁöÁ¡ÀÔ´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ں ǿ   Դϴ."));

 				return false;

 			}

 

 			if (tree->IsAttr((long)(GetX() + fx), (long)(GetY() + fy), ATTR_WATER))

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹° ¼Ó¿¡ ¸ð´ÚºÒÀ» ÇÇ¿ï ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ӿ ں ǿ  ϴ."));

+				return false;

+			}

+

+			// [Anti-Grief] Prevent stacking campfires to block NPCs/bridges (limit 1 campfire within ~5m)

+			struct FCampfireNear

+			{

+				long x, y;

+				bool found;

+				FCampfireNear(long _x, long _y) : x(_x), y(_y), found(false) {}

+				void operator()(LPENTITY ent)

+				{

+					if (found || !ent || !ent->IsType(ENTITY_CHARACTER))

+						return;

+

+					LPCHARACTER pkChr = (LPCHARACTER)ent;

+					if (!pkChr || !pkChr->IsNPC())

+						return;

+

+					if (pkChr->GetRaceNum() != fishing::CAMPFIRE_MOB)

+						return;

+

+					int dist = DISTANCE_APPROX(pkChr->GetX() - x, pkChr->GetY() - y);

+					if (dist < 500)

+						found = true;

+				}

+			};

+

+			const long lCampX = (long)(GetX() + fx);

+			const long lCampY = (long)(GetY() + fy);

+			FCampfireNear fCamp(lCampX, lCampY);

+			tree->ForEachAround(fCamp);

+

+			if (fCamp.found)

+			{

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("You cannot place another campfire so close to an existing one."));

 				return false;

 			}

 

@@ -3077,7 +3112,7 @@
 				{

 					if (FindAffect(AFFECT_BLEND, item->GetValue(0)))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 						return false;

 					}

 

@@ -3154,13 +3189,13 @@
 

 					if (GetWear(ARMOR_BODY))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("°©¿ÊÀ» ¹þ¾î¾ß °³ÀÎ »óÁ¡À» ¿­ ¼ö ÀÖ½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("      ֽϴ."));

 						return false;

 					}

 

 					switch (item->GetVnum())

 					{

-						case 71049: // ºñ´Üº¸µû¸®

+						case 71049: // ܺ

 						{

 							if (LC_IsYMIR() == true || LC_IsKorea() == true)

 							{

@@ -3170,7 +3205,7 @@
 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³ÀÎ »óÁ¡À» ¿­ ¼ö ¾ø´Â Áö¿ªÀÔ´Ï´Ù"));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("     Դϴ"));

 								}

 							}

 							else

@@ -3205,8 +3240,8 @@
 		case ITEM_WEAPON:

 		case ITEM_ARMOR:

 		case ITEM_ROD:

-		case ITEM_RING: // ½Å±Ô ¹ÝÁö ¾ÆÀÌÅÛ

-		case ITEM_BELT: // ½Å±Ô º§Æ® ¾ÆÀÌÅÛ

+		case ITEM_RING: // ű  

+		case ITEM_BELT: // ű Ʈ 

 		case ITEM_PICK: // MINING

 		{

 			if (!item->IsEquipped())

@@ -3216,10 +3251,10 @@
 		}

 		break;

 

-		// Âø¿ëÇÏÁö ¾ÊÀº ¿ëÈ¥¼®Àº »ç¿ëÇÒ ¼ö ¾ø´Ù.

-		// Á¤»óÀûÀÎ Å¬¶ó¶ó¸é, ¿ëÈ¥¼®¿¡ °üÇÏ¿© item use ÆÐÅ¶À» º¸³¾ ¼ö ¾ø´Ù.

-		// ¿ëÈ¥¼® Âø¿ëÀº item move ÆÐÅ¶À¸·Î ÇÑ´Ù.

-		// Âø¿ëÇÑ ¿ëÈ¥¼®Àº ÃßÃâÇÑ´Ù.

+		//   ȥ   .

+		//  Ŭ, ȥ Ͽ item use Ŷ   .

+		// ȥ  item move Ŷ Ѵ.

+		//  ȥ Ѵ.

 #if defined(__DRAGON_SOUL_SYSTEM__)

 		case ITEM_DS:

 		{

@@ -3243,7 +3278,7 @@
 		{

 			if (CArenaManager::instance().IsArenaMap(GetMapIndex()))

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 				return false;

 			}

 

@@ -3255,7 +3290,7 @@
 		case ITEM_TREASURE_BOX:

 		{

 			return false;

-			//ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¿­¼è·Î Àá°Ü ÀÖ¾î¼­ ¿­¸®Áö ¾Ê´Â°Í °°´Ù. ¿­¼è¸¦ ±¸ÇØº¸ÀÚ."));

+			//ChatPacket(CHAT_TYPE_TALKING, LC_STRING("  ־  ʴ° . 踦 غ."));

 		}

 		break;

 

@@ -3271,13 +3306,13 @@
 

 			if (item2->GetType() != ITEM_TREASURE_BOX)

 			{

-				ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¿­¼è·Î ¿©´Â ¹°°ÇÀÌ ¾Æ´Ñ°Í °°´Ù."));

+				ChatPacket(CHAT_TYPE_TALKING, LC_STRING("   ƴѰ ."));

 				return false;

 			}

 

 			if (item->GetValue(0) == item2->GetValue(0))

 			{

-				//ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¿­¼è´Â ¸ÂÀ¸³ª ¾ÆÀÌÅÛ ÁÖ´Â ºÎºÐ ±¸ÇöÀÌ ¾ÈµÇ¾ú½À´Ï´Ù."));

+				//ChatPacket(CHAT_TYPE_TALKING, LC_STRING("   ִ κ  ȵǾϴ."));

 

 				if (GiveItemFromSpecialItemGroup(item2->GetVnum()))

 				{

@@ -3286,13 +3321,13 @@
 				}

 				else

 				{

-					ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¿­¼è°¡ ¸ÂÁö ¾Ê´Â °Í °°´Ù."));

+					ChatPacket(CHAT_TYPE_TALKING, LC_STRING("谡  ʴ  ."));

 					return false;

 				}

 			}

 			else

 			{

-				ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¿­¼è°¡ ¸ÂÁö ¾Ê´Â °Í °°´Ù."));

+				ChatPacket(CHAT_TYPE_TALKING, LC_STRING("谡  ʴ  ."));

 				return false;

 			}

 		}

@@ -3302,21 +3337,21 @@
 		{

 			DWORD dwBoxVnum = item->GetVnum();

 

-			if (dwBoxVnum == 50033 && LC_IsYMIR()) // ¾Ë¼ö¾ø´Â »óÀÚ

+			if (dwBoxVnum == 50033 && LC_IsYMIR()) // ˼ 

 			{

 				if (GetLevel() < 15)

 				{

-					ChatPacket(CHAT_TYPE_INFO, "15·¹º§ ÀÌÇÏ¿¡¼­´Â »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù.");

+					ChatPacket(CHAT_TYPE_INFO, "15 Ͽ   ϴ.");

 					return false;

 				}

 			}

 

 #if defined(__DRAGON_SOUL_SYSTEM__)

-			if ((dwBoxVnum > 51500 && dwBoxVnum < 52000) || (dwBoxVnum >= 50255 && dwBoxVnum <= 50260)) // ¿ëÈ¥¿ø¼®µé

+			if ((dwBoxVnum > 51500 && dwBoxVnum < 52000) || (dwBoxVnum >= 50255 && dwBoxVnum <= 50260)) // ȥ

 			{

 				if (!(this->DragonSoul_IsQualified()))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ÕÀú ¿ëÈ¥¼® Äù½ºÆ®¸¦ ¿Ï·áÇÏ¼Å¾ß ÇÕ´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȥ Ʈ Ϸϼž մϴ."));

 					return false;

 				}

 			}

@@ -3324,7 +3359,7 @@
 

 			if (!GiveItemFromSpecialItemGroup(dwBoxVnum))

 			{

-				ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¾Æ¹«°Íµµ ¾òÀ» ¼ö ¾ø¾ú½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_TALKING, LC_STRING("ƹ͵   ϴ."));

 				return false;

 			}

 

@@ -3345,10 +3380,10 @@
 			if (SkillLevelDown(dwVnum))

 			{

 				ITEM_MANAGER::instance().RemoveItem(item);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("½ºÅ³ ·¹º§À» ³»¸®´Âµ¥ ¼º°øÇÏ¿´½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ų  µ Ͽϴ."));

 			}

 			else

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("½ºÅ³ ·¹º§À» ³»¸± ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ų    ϴ."));

 		}

 		break;

 

@@ -3356,7 +3391,7 @@
 		{

 			if (IsPolymorphed())

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½ÅÁß¿¡´Â Ã¥À» ÀÐÀ»¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("߿ å  ϴ."));

 				return false;

 			}

 

@@ -3368,7 +3403,7 @@
 			}

 			else

 			{

-				// »õ·Î¿î ¼ö·Ã¼­´Â value 0 ¿¡ ½ºÅ³ ¹øÈ£°¡ ÀÖÀ¸¹Ç·Î ±×°ÍÀ» »ç¿ë.

+				// ο ü value 0  ų ȣ Ƿ װ .

 				dwVnum = item->GetValue(0);

 			}

 

@@ -3387,7 +3422,7 @@
 				if (distribution_test_server)

 					iReadDelay /= 3;

 

-				// ÇÑ±¹ º»¼·ÀÇ °æ¿ì¿¡´Â ½Ã°£À» 24½Ã°£ °íÁ¤

+				// ѱ  쿡 ð 24ð 

 				if (LC_IsKorea())

 					iReadDelay = 86400;

 

@@ -3414,13 +3449,13 @@
 					{

 						if (FindAffect(affect_type, apply_type))

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 							return false;

 						}

 

 						if (FindAffect(AFFECT_BLEND, item->GetValue(0)))

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 							return false;

 						}

 

@@ -3475,7 +3510,7 @@
 					{

 						if (FindAffect(AFFECT_EXP_BONUS_EURO_FREE, aApplyInfo[item->GetValue(1)].wPointType))

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 						}

 						else

 						{

@@ -3491,7 +3526,7 @@
 						{

 							if (quest::CQuestManager::instance().GetEventFlag("arena_potion_limit") > 0)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·ÃÀå¿¡¼­ »ç¿ëÇÏ½Ç ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("忡 Ͻ  ϴ."));

 								return false;

 							}

 

@@ -3506,7 +3541,7 @@
 									{

 										if (m_nPotionLimit <= 0)

 										{

-											ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ç¿ë Á¦ÇÑ·®À» ÃÊ°úÇÏ¿´½À´Ï´Ù."));

+											ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ѷ ʰϿϴ."));

 											return false;

 										}

 									}

@@ -3515,7 +3550,7 @@
 

 								default:

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·ÃÀå¿¡¼­ »ç¿ëÇÏ½Ç ¼ö ¾ø½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("忡 Ͻ  ϴ."));

 									return false;

 								}

 							}

@@ -3523,7 +3558,7 @@
 

 						bool bUsed = false;

 

-						if (item->GetValue(0) != 0) // HP Àý´ë°ª È¸º¹

+						if (item->GetValue(0) != 0) // HP 밪 ȸ

 						{

 							if (GetHP() < GetMaxHP())

 							{

@@ -3533,7 +3568,7 @@
 							}

 						}

 

-						if (item->GetValue(1) != 0) // SP Àý´ë°ª È¸º¹

+						if (item->GetValue(1) != 0) // SP 밪 ȸ

 						{

 							if (GetSP() < GetMaxSP())

 							{

@@ -3543,7 +3578,7 @@
 							}

 						}

 

-						if (item->GetValue(3) != 0) // HP % È¸º¹

+						if (item->GetValue(3) != 0) // HP % ȸ

 						{

 							if (GetHP() < GetMaxHP())

 							{

@@ -3553,7 +3588,7 @@
 							}

 						}

 

-						if (item->GetValue(4) != 0) // SP % È¸º¹

+						if (item->GetValue(4) != 0) // SP % ȸ

 						{

 							if (GetSP() < GetMaxSP())

 							{

@@ -3568,7 +3603,7 @@
 							if (item->GetVnum() == 50085 || item->GetVnum() == 50086)

 							{

 								if (test_server)

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ùº´ ¶Ç´Â Á¾ÀÚ ¸¦ »ç¿ëÇÏ¿´½À´Ï´Ù"));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ǵ   Ͽϴ"));

 

 								SetUseSeedOrMoonBottleTime();

 							}

@@ -3596,7 +3631,7 @@
 			{

 				if (CArenaManager::instance().IsArenaMap(GetMapIndex()))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 					return false;

 				}

 			}

@@ -3632,7 +3667,7 @@
 					if (NULL == pDestItem)

 						return false;

 

-					// ¿ì¼± ¿ëÈ¥¼®¿¡ °üÇØ¼­¸¸ ÇÏµµ·Ï ÇÑ´Ù.

+					// 켱 ȥ ؼ ϵ Ѵ.

 					if (pDestItem->IsDragonSoul())

 					{

 						int ret;

@@ -3654,14 +3689,14 @@
 

 							if (item->GetVnum() == ITEM_DRAGON_HEART_VNUM)

 							{

-								sprintf(buf, "Inc %ds by item{VN:%d SOC%d:%d}", ret, item->GetVnum(), ITEM_SOCKET_CHARGING_AMOUNT_IDX, item->GetSocket(ITEM_SOCKET_CHARGING_AMOUNT_IDX));

+								snprintf(buf, sizeof(buf), "Inc %ds by item{VN:%d SOC%d:%d}", ret, item->GetVnum(), ITEM_SOCKET_CHARGING_AMOUNT_IDX, item->GetSocket(ITEM_SOCKET_CHARGING_AMOUNT_IDX));

 							}

 							else

 							{

-								sprintf(buf, "Inc %ds by item{VN:%d VAL%d:%d}", ret, item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

-							}

-

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("%dÃÊ ¸¸Å­ ÃæÀüµÇ¾ú½À´Ï´Ù.", ret));

+								snprintf(buf, sizeof(buf), "Inc %ds by item{VN:%d VAL%d:%d}", ret, item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

+							}

+

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("%d ŭ Ǿϴ.", ret));

 							item->SetCount(item->GetCount() - 1);

 							LogManager::instance().ItemLog(this, item, "DS_CHARGING_SUCCESS", buf);

 

@@ -3671,14 +3706,14 @@
 						{

 							if (item->GetVnum() == ITEM_DRAGON_HEART_VNUM)

 							{

-								sprintf(buf, "No change by item{VN:%d SOC%d:%d}", item->GetVnum(), ITEM_SOCKET_CHARGING_AMOUNT_IDX, item->GetSocket(ITEM_SOCKET_CHARGING_AMOUNT_IDX));

+								snprintf(buf, sizeof(buf), "No change by item{VN:%d SOC%d:%d}", item->GetVnum(), ITEM_SOCKET_CHARGING_AMOUNT_IDX, item->GetSocket(ITEM_SOCKET_CHARGING_AMOUNT_IDX));

 							}

 							else

 							{

-								sprintf(buf, "No change by item{VN:%d VAL%d:%d}", item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

-							}

-

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÃæÀüÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								snprintf(buf, sizeof(buf), "No change by item{VN:%d VAL%d:%d}", item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

+							}

+

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ϴ."));

 							LogManager::instance().ItemLog(this, item, "DS_CHARGING_FAILED", buf);

 							return false;

 						}

@@ -3694,7 +3729,7 @@
 					if (NULL == pDestItem)

 						return false;

 

-					// ¿ì¼± ¿ëÈ¥¼®¿¡ °üÇØ¼­¸¸ ÇÏµµ·Ï ÇÑ´Ù.

+					// 켱 ȥ ؼ ϵ Ѵ.

 					if (pDestItem->IsDragonSoul())

 					{

 						int ret = pDestItem->GiveMoreTime_Fix(item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

@@ -3705,9 +3740,9 @@
 							DragonSoul_SetBonus();

 #endif

 

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("%dÃÊ ¸¸Å­ ÃæÀüµÇ¾ú½À´Ï´Ù.", ret));

-

-							sprintf(buf, "Increase %ds by item{VN:%d VAL%d:%d}", ret, item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("%d ŭ Ǿϴ.", ret));

+

+							snprintf(buf, sizeof(buf), "Increase %ds by item{VN:%d VAL%d:%d}", ret, item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

 							LogManager::instance().ItemLog(this, item, "DS_CHARGING_SUCCESS", buf);

 							item->SetCount(item->GetCount() - 1);

 

@@ -3715,8 +3750,8 @@
 						}

 						else

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÃæÀüÇÒ ¼ö ¾ø½À´Ï´Ù."));

-							sprintf(buf, "No change by item{VN:%d VAL%d:%d}", item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ϴ."));

+							snprintf(buf, sizeof(buf), "No change by item{VN:%d VAL%d:%d}", item->GetVnum(), ITEM_VALUE_CHARGING_AMOUNT_IDX, item->GetValue(ITEM_VALUE_CHARGING_AMOUNT_IDX));

 							LogManager::instance().ItemLog(this, item, "DS_CHARGING_FAILED", buf);

 							return false;

 						}

@@ -3742,7 +3777,7 @@
 

 							if (FindAffect(AFFECT_RED_DRAGONLAIR_BUFF))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 								return false;

 							}

 							else

@@ -3936,7 +3971,7 @@
 									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Total %d: You can still unpack %d.", nMaxUse, (nMaxUse - 1) - nUseCount));

 								}

 								else

-									ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¾Æ¹«°Íµµ ¾òÀ» ¼ö ¾ø¾ú½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_TALKING, LC_STRING("ƹ͵   ϴ."));

 							}

 							else

 							{

@@ -4140,7 +4175,7 @@
 						{

 							if (FindAffect(AFFECT_RESEARCHER_ELIXIR))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 							}

 							else

 							{

@@ -4245,19 +4280,19 @@
 						break;

 #endif

 

-						// Å©¸®½º¸¶½º ¶õÁÖ

+						// ũ 

 						case ITEM_NOG_POCKET:

 						{

 							/*

-							¶õÁÖ´É·ÂÄ¡ : item_proto value ÀÇ¹Ì

-								ÀÌµ¿¼Óµµ value 1

-								°ø°Ý·Â value 2

-								°æÇèÄ¡ value 3

-								Áö¼Ó½Ã°£ value 0 (´ÜÀ§ ÃÊ)

+							ִɷġ : item_proto value ǹ

+								̵ӵ value 1

+								ݷ value 2

+								ġ value 3

+								ӽð value 0 ( )

 							*/

 							if (FindAffect(AFFECT_NOG_ABILITY))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 								return false;

 							}

 							long time = item->GetValue(0);

@@ -4271,19 +4306,19 @@
 						}

 						break;

 

-						// ¶ó¸¶´Ü¿ë »çÅÁ

+						// 󸶴ܿ 

 						case ITEM_RAMADAN_CANDY:

 						{

 							/*

-							»çÅÁ´É·ÂÄ¡ : item_proto value ÀÇ¹Ì

-								ÀÌµ¿¼Óµµ value 1

-								°ø°Ý·Â value 2

-								°æÇèÄ¡ value 3

-								Áö¼Ó½Ã°£ value 0 (´ÜÀ§ ÃÊ)

+							ɷġ : item_proto value ǹ

+								̵ӵ value 1

+								ݷ value 2

+								ġ value 3

+								ӽð value 0 ( )

 							*/

 							if (FindAffect(AFFECT_RAMADAN_ABILITY))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 								return false;

 							}

 

@@ -4307,7 +4342,7 @@
 								{

 									if (CArenaManager::instance().IsArenaMap(pMarriage->ch1->GetMapIndex()))

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 										break;

 									}

 								}

@@ -4316,11 +4351,47 @@
 								{

 									if (CArenaManager::instance().IsArenaMap(pMarriage->ch2->GetMapIndex()))

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 										break;

 									}

 								}

 

+								LPCHARACTER pkOther = NULL;

+								if (pMarriage->m_pid1 == GetPlayerID())

+									pkOther = pMarriage->ch2;

+								else if (pMarriage->m_pid2 == GetPlayerID())

+									pkOther = pMarriage->ch1;

+

+								if (pkOther)

+								{

+									const long lOtherMapIndex = pkOther->GetMapIndex();

+

+									// [Security] Prevent wedding-ring dungeon/war/event/GM-map taxi

+									if (pkOther->GetDungeon() != NULL)

+									{

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("You cannot teleport to your partner inside a dungeon."));

+										break;

+									}

+

+									if (CWarMapManager::instance().IsWarMap(lOtherMapIndex))

+									{

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("You cannot teleport to your partner on a war map."));

+										break;

+									}

+

+									if (!IS_SUMMONABLE_ZONE(lOtherMapIndex))

+									{

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("You cannot teleport to your partner in this area."));

+										break;

+									}

+

+									if (!IsGM() && pkOther->GetGMLevel() > GM_PLAYER)

+									{

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("You cannot teleport to your partner in this area."));

+										break;

+									}

+								}

+

 								int consumeSP = CalculateConsumeSP(this);

 

 								if (consumeSP < 0)

@@ -4331,7 +4402,7 @@
 								WarpToPID(pMarriage->GetOther(GetPlayerID()));

 							}

 							else

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("°áÈ¥ »óÅÂ°¡ ¾Æ´Ï¸é °áÈ¥¹ÝÁö¸¦ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȥ ° ƴϸ ȥ   ϴ."));

 						}

 						break;

 

@@ -4344,7 +4415,7 @@
 						case 30094:

 						case 30095:

 						case 30096:

-							// º¹ÁÖ¸Ó´Ï

+							// ָӴ

 						{

 							const int MAX_BAG_INFO = 26;

 							static struct LuckyBagInfo

@@ -4432,7 +4503,7 @@
 

 							if (bi[i].vnum == ITEM_SKILLBOOK_VNUM)

 							{

-								// ½ºÅ³¼ö·Ã¼­´Â Æ¯¼öÇÏ°Ô ÁØ´Ù.

+								// ųü Ưϰ ش.

 								GiveRandomSkillBook();

 							}

 							else if (bi[i].vnum == 1)

@@ -4447,7 +4518,7 @@
 						}

 						break;

 

-						case 50004: // ÀÌº¥Æ®¿ë °¨Áö±â

+						case 50004: // ̺Ʈ 

 						{

 							if (item->GetSocket(0))

 							{

@@ -4455,7 +4526,7 @@
 							}

 							else

 							{

-								// Ã³À½ »ç¿ë½Ã

+								// ó 

 								int iMapIndex = GetMapIndex();

 

 								PIXEL_POSITION pos;

@@ -4468,7 +4539,7 @@
 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ °÷¿¡¼± ÀÌº¥Æ®¿ë °¨Áö±â°¡ µ¿ÀÛÇÏÁö ¾Ê´Â°Í °°½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ̺Ʈ Ⱑ  ʴ° ϴ."));

 									return false;

 								}

 							}

@@ -4478,10 +4549,10 @@
 

 							if (distance < 1000.0f)

 							{

-								// ¹ß°ß!

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌº¥Æ®¿ë °¨Áö±â°¡ ½Åºñ·Î¿î ºûÀ» ³»¸ç »ç¶óÁý´Ï´Ù."));

-

-								// »ç¿ëÈ½¼ö¿¡ µû¶ó ÁÖ´Â ¾ÆÀÌÅÛÀ» ´Ù¸£°Ô ÇÑ´Ù.

+								// ߰!

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̺Ʈ Ⱑ źο   ϴ."));

+

+								// Ƚ  ִ  ٸ Ѵ.

 								struct TEventStoneInfo

 								{

 									DWORD dwVnum;

@@ -4580,7 +4651,7 @@
 												pdw[0] = info[i].dwVnum;

 												pdw[1] = info[i].count;

 

-												// ÃßÃ·¼­´Â ¼ÒÄÏÀ» ¼³Á¤ÇÑ´Ù

+												// ÷  Ѵ

 												DBManager::instance().ReturnQuery(QID_LOTTO, GetPlayerID(), pdw,

 													"INSERT INTO lotto_list VALUES(0, 'server%s', %u, NOW())",

 													get_table_postfix(), GetPlayerID());

@@ -4600,7 +4671,7 @@
 								if (len < 0 || len >= (int)sizeof(chatbuf))

 									len = sizeof(chatbuf) - 1;

 

-								++len; // \0 ¹®ÀÚ±îÁö º¸³»±â

+								++len; // \0 ڱ 

 

 								TPacketGCChat pack_chat;

 								pack_chat.header = HEADER_GC_CHAT;

@@ -4626,11 +4697,11 @@
 							else

 								dist = 3;

 

-							// ¸¹ÀÌ »ç¿ëÇßÀ¸¸é »ç¶óÁø´Ù.

+							//   .

 							const int STONE_DETECT_MAX_TRY = 10;

 							if (item->GetSocket(0) >= STONE_DETECT_MAX_TRY)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌº¥Æ®¿ë °¨Áö±â°¡ ÈçÀûµµ ¾øÀÌ »ç¶óÁý´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̺Ʈ Ⱑ   ϴ."));

 								ITEM_MANAGER::instance().RemoveItem(item, "REMOVE (DETECT_EVENT_STONE) 0");

 								AutoGiveItem(27002);

 								return true;

@@ -4646,7 +4717,7 @@
 								if (len < 0 || len >= (int)sizeof(chatbuf))

 									len = sizeof(chatbuf) - 1;

 

-								++len; // \0 ¹®ÀÚ±îÁö º¸³»±â

+								++len; // \0 ڱ 

 

 								TPacketGCChat pack_chat;

 								pack_chat.header = HEADER_GC_CHAT;

@@ -4665,8 +4736,8 @@
 						}

 						break;

 

-						case 27989: // ¿µ¼®°¨Áö±â

-						case 76006: // ¼±¹°¿ë ¿µ¼®°¨Áö±â

+						case 27989: // 

+						case 76006: //  

 						{

 							LPSECTREE_MAP pMap = SECTREE_MANAGER::instance().GetMap(GetMapIndex());

 

@@ -4710,12 +4781,12 @@
 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("°¨Áö±â¸¦ ÀÛ¿ëÇÏ¿´À¸³ª °¨ÁöµÇ´Â ¿µ¼®ÀÌ ¾ø½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("⸦ ۿϿ Ǵ  ϴ."));

 									}

 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("°¨Áö±â¸¦ ÀÛ¿ëÇÏ¿´À¸³ª °¨ÁöµÇ´Â ¿µ¼®ÀÌ ¾ø½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("⸦ ۿϿ Ǵ  ϴ."));

 								}

 

 								if (item->GetSocket(0) >= 6)

@@ -4779,12 +4850,12 @@
 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("The Compass was used, but the Guard wasn’t found."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("The Compass was used, but the Guard wasnt found."));

 									}

 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("The Compass was used, but the Guard wasn’t found."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("The Compass was used, but the Guard wasnt found."));

 								}

 

 								if (item->GetSocket(0) >= 6)

@@ -4797,14 +4868,14 @@
 						break;

 #endif

 

-						case 27996: // µ¶º´

+						case 27996: // 

 							item->SetCount(item->GetCount() - 1);

 							/*

 							if (GetSkillLevel(SKILL_CREATE_POISON))

 								AddAffect(AFFECT_ATT_GRADE, POINT_ATT_GRADE, 3, AFF_DRINK_POISON, 15 * 60, 0, true);

 							else

 							{

-								// µ¶´Ù·ç±â°¡ ¾øÀ¸¸é 50% Áï»ç 50% °ø°Ý·Â +2

+								// ٷⰡ  50%  50% ݷ +2

 								if (number(0, 1))

 								{

 									if (GetHP() > 100)

@@ -4818,12 +4889,12 @@
 							*/

 							break;

 

-						case fishing::SHELLFISH_VNUM: // Á¶°³

-							// 50 µ¹Á¶°¢ 47990

-							// 30 ²Î

-							// 10 ¹éÁøÁÖ 47992

-							// 7 Ã»ÁøÁÖ 47993

-							// 3 ÇÇÁøÁÖ 47994

+						case fishing::SHELLFISH_VNUM: // 

+							// 50  47990

+							// 30 

+							// 10  47992

+							// 7 û 47993

+							// 3  47994

 						{

 							item->SetCount(item->GetCount() - 1);

 

@@ -4831,7 +4902,7 @@
 

 							if (r <= 50)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¶°³¿¡¼­ µ¹Á¶°¢ÀÌ ³ª¿Ô½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Խϴ."));

 								AutoGiveItem(fishing::STONEPIECE_VNUM);

 							}

 							else

@@ -4850,33 +4921,33 @@
 

 								if (r <= prob_table[0])

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¶°³°¡ ÈçÀûµµ ¾øÀÌ »ç¶óÁý´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ϴ."));

 								}

 								else if (r <= prob_table[1])

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¶°³¿¡¼­ ¹éÁøÁÖ°¡ ³ª¿Ô½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ְ Խϴ."));

 									AutoGiveItem(fishing::WHITE_PEARL_VNUM);

 								}

 								else if (r <= prob_table[2])

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¶°³¿¡¼­ Ã»ÁøÁÖ°¡ ³ª¿Ô½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ûְ Խϴ."));

 									AutoGiveItem(fishing::BLUE_PEARL_VNUM);

 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¶°³¿¡¼­ ÇÇÁøÁÖ°¡ ³ª¿Ô½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ְ Խϴ."));

 									AutoGiveItem(fishing::RED_PEARL_VNUM);

 								}

 							}

 						}

 						break;

 

-						case 71013: // ÃàÁ¦¿ëÆøÁ×

+						case 71013: // 

 							CreateFly(number(FLY_FIREWORK1, FLY_FIREWORK6), this);

 							item->SetCount(item->GetCount() - 1);

 							break;

 

-						case 50100: // ÆøÁ×

+						case 50100: // 

 						case 50101:

 						case 50102:

 						case 50103:

@@ -4887,7 +4958,7 @@
 							item->SetCount(item->GetCount() - 1);

 							break;

 

-						case 50200: // º¸µû¸®

+						case 50200: // 

 						{

 							if (LC_IsYMIR() == true || LC_IsKorea() == true)

 							{

@@ -4897,7 +4968,7 @@
 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³ÀÎ »óÁ¡À» ¿­ ¼ö ¾ø´Â Áö¿ªÀÔ´Ï´Ù"));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("     Դϴ"));

 								}

 							}

 							else

@@ -4912,13 +4983,13 @@
 							item->SetCount(item->GetCount() - 1);

 							break;

 

-						case 50301: // Åë¼Ö·Â ¼ö·Ã¼­

+						case 50301: // ַ ü

 						case 50302:

 						case 50303:

 						{

 							if (IsPolymorphed() == true)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("µÐ°© Áß¿¡´Â ´É·ÂÀ» ¿Ã¸± ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("а ߿ ɷ ø  ϴ."));

 								return false;

 							}

 

@@ -4926,13 +4997,13 @@
 

 							if (lv < item->GetValue(0))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥Àº ³Ê¹« ¾î·Á¿ö ÀÌÇØÇÏ±â°¡ Èûµì´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" å ʹ  ϱⰡ ϴ."));

 								return false;

 							}

 

 							if (lv >= item->GetValue(1))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥Àº ¾Æ¹«¸® ºÁµµ µµ¿òÀÌ µÉ °Í °°Áö ¾Ê½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" å ƹ      ʽϴ."));

 								return false;

 							}

 

@@ -4948,31 +5019,31 @@
 						}

 						break;

 

-						case 50304: // ¿¬°è±â ¼ö·Ã¼­

+						case 50304: //  ü

 						case 50305:

 						case 50306:

 						{

 							if (IsPolymorphed())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½ÅÁß¿¡´Â Ã¥À» ÀÐÀ»¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("߿ å  ϴ."));

 								return false;

 							}

 

 							if (GetSkillLevel(SKILL_COMBO) == 0 && GetLevel() < 30)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("·¹º§ 30ÀÌ µÇ±â Àü¿¡´Â ½ÀµæÇÒ ¼ö ÀÖÀ» °Í °°Áö ¾Ê½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" 30 Ǳ       ʽϴ."));

 								return false;

 							}

 

 							if (GetSkillLevel(SKILL_COMBO) == 1 && GetLevel() < 50)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("·¹º§ 50ÀÌ µÇ±â Àü¿¡´Â ½ÀµæÇÒ ¼ö ÀÖÀ» °Í °°Áö ¾Ê½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" 50 Ǳ       ʽϴ."));

 								return false;

 							}

 

 							if (GetSkillLevel(SKILL_COMBO) >= 2)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿¬°è±â´Â ´õÀÌ»ó ¼ö·ÃÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 								return false;

 							}

 

@@ -4990,13 +5061,13 @@
 						}

 						break;

 

-						case 50311: // ¾ð¾î ¼ö·Ã¼­

+						case 50311: //  ü

 						case 50312:

 						case 50313:

 						{

 							if (IsPolymorphed())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½ÅÁß¿¡´Â Ã¥À» ÀÐÀ»¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("߿ å  ϴ."));

 								return false;

 							}

 

@@ -5004,7 +5075,7 @@
 							int iPct = MINMAX(0, item->GetValue(1), 100);

 							if (GetSkillLevel(dwSkillVnum) >= 20 || dwSkillVnum - SKILL_LANGUAGE1 + 1 == GetEmpire())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì ¿Ïº®ÇÏ°Ô ¾Ë¾ÆµéÀ» ¼ö ÀÖ´Â ¾ð¾îÀÌ´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ Ϻϰ ˾Ƶ  ִ ̴."));

 								return false;

 							}

 

@@ -5020,11 +5091,11 @@
 						}

 						break;

 

-						case 50061: // ÀÏº» ¸» ¼ÒÈ¯ ½ºÅ³ ¼ö·Ã¼­

+						case 50061: // Ϻ  ȯ ų ü

 						{

 							if (IsPolymorphed())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½ÅÁß¿¡´Â Ã¥À» ÀÐÀ»¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("߿ å  ϴ."));

 								return false;

 							}

 

@@ -5033,7 +5104,7 @@
 

 							if (GetSkillLevel(dwSkillVnum) >= 10)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó ¼ö·ÃÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 								return false;

 							}

 

@@ -5050,12 +5121,12 @@
 						break;

 

 						// LEARNABLE_SKILL_BOOKS_BY_LEVEL

-						case 50314: case 50315: case 50316: // º¯½Å ¼ö·Ã¼­

+						case 50314: case 50315: case 50316: //  ü

 						case 50325: // Book of Precision

 						{

 							if (IsPolymorphed() == true)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("µÐ°© Áß¿¡´Â ´É·ÂÀ» ¿Ã¸± ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("а ߿ ɷ ø  ϴ."));

 								return false;

 							}

 

@@ -5087,7 +5158,7 @@
 #if defined(__CONQUEROR_LEVEL__)

 							if (dwSkillVnum == SKILL_HIT && GetConquerorLevel() < iSkillLevelLowLimit)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥À» ÀÐÀ¸·Á¸é ·¹º§À» ´õ ¿Ã·Á¾ß ÇÕ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" å    ÷ մϴ."));

 								return false;

 							}

 							else

@@ -5095,14 +5166,14 @@
 							{

 								if (GetLevel() < iLevelLimit)

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥À» ÀÐÀ¸·Á¸é ·¹º§À» ´õ ¿Ã·Á¾ß ÇÕ´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING(" å    ÷ մϴ."));

 									return false;

 								}

 							}

 

 							if (GetSkillLevel(dwSkillVnum) >= 40)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó ¼ö·ÃÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 								return false;

 							}

 

@@ -5112,13 +5183,13 @@
 #endif

 								)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥Àº ³Ê¹« ¾î·Á¿ö ÀÌÇØÇÏ±â°¡ Èûµì´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" å ʹ  ϱⰡ ϴ."));

 								return false;

 							}

 

 							if (GetSkillLevel(dwSkillVnum) >= iSkillLevelHighLimit)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥À¸·Î´Â ´õ ÀÌ»ó ¼ö·ÃÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" åδ  ̻   ϴ."));

 								return false;

 							}

 

@@ -5149,7 +5220,7 @@
 						{

 							if (IsPolymorphed())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("µÐ°© Áß¿¡´Â ´É·ÂÀ» ¿Ã¸± ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("а ߿ ɷ ø  ϴ."));

 								return false;

 							}

 

@@ -5186,25 +5257,25 @@
 

 							if (GetExp() < static_cast<DWORD>(iNeedExp))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("°æÇèÄ¡°¡ ºÎÁ·ÇÏ¿© Ã¥À» ÀÐÀ» ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ġ Ͽ å   ϴ."));

 								return false;

 							}

 

 							if (GetSkillLevel(dwSkillVnum) >= 40)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ö·ÃÇÒ ¼ö ¾ø´Â ½ºÅ³ÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ųԴϴ."));

 								return false;

 							}

 

 							if (GetSkillLevel(dwSkillVnum) < iSkillLevelLowLimit)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥Àº ³Ê¹« ¾î·Á¿ö ÀÌÇØÇÏ±â°¡ Èûµì´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" å ʹ  ϱⰡ ϴ."));

 								return false;

 							}

 

 							if (GetSkillLevel(dwSkillVnum) >= iSkillLevelHighLimit)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ Ã¥À¸·Î´Â ´õ ÀÌ»ó ¼ö·ÃÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" åδ  ̻   ϴ."));

 								return false;

 							}

 

@@ -5231,7 +5302,7 @@
 						{

 							if (IsPolymorphed())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½ÅÁß¿¡´Â Ã¥À» ÀÐÀ»¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("߿ å  ϴ."));

 								return false;

 							}

 

@@ -5240,7 +5311,7 @@
 

 							if (GetSkillLevel(dwSkillVnum) >= 40)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó ¼ö·ÃÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 								return false;

 							}

 

@@ -5273,7 +5344,7 @@
 						{

 							if (IsPolymorphed())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½ÅÁß¿¡´Â Ã¥À» ÀÐÀ»¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("߿ å  ϴ."));

 								return false;

 							}

 

@@ -5282,7 +5353,7 @@
 

 							if (GetSkillLevel(dwSkillVnum) >= 40)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó ¼ö·ÃÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ϴ."));

 								return false;

 							}

 

@@ -5303,7 +5374,7 @@
 						{

 							if (IsPolymorphed())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½ÅÁß¿¡´Â Ã¥À» ÀÐÀ»¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("߿ å  ϴ."));

 								return false;

 							}

 

@@ -5312,7 +5383,7 @@
 

 							if (GetLevel() < 50)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ ½Â¸¶ ½ºÅ³À» ¼ö·ÃÇÒ ¼ö ÀÖ´Â ·¹º§ÀÌ ¾Æ´Õ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ¸ ų   ִ  ƴմϴ."));

 								return false;

 							}

 

@@ -5320,9 +5391,9 @@
 							{

 								if (FindAffect(AFFECT_SKILL_NO_BOOK_DELAY))

 								{

-									// ÁÖ¾È¼ú¼­ »ç¿ëÁß¿¡´Â ½Ã°£ Á¦ÇÑ ¹«½Ã

+									// ־ȼ ߿ ð  

 									RemoveAffect(AFFECT_SKILL_NO_BOOK_DELAY);

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÁÖ¾È¼ú¼­¸¦ ÅëÇØ ÁÖÈ­ÀÔ¸¶¿¡¼­ ºüÁ®³ª¿Ô½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("־ȼ  ȭԸ Խϴ."));

 								}

 								else

 								{

@@ -5335,14 +5406,14 @@
 								GetSkillLevel(SKILL_HORSE_WILDATTACK) + GetSkillLevel(SKILL_HORSE_CHARGE) + GetSkillLevel(SKILL_HORSE_ESCAPE) >= 60 ||

 								GetSkillLevel(SKILL_HORSE_WILDATTACK_RANGE) + GetSkillLevel(SKILL_HORSE_CHARGE) + GetSkillLevel(SKILL_HORSE_ESCAPE) >= 60)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó ½Â¸¶ ¼ö·Ã¼­¸¦ ÀÐÀ» ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻ ¸ ü   ϴ."));

 								return false;

 							}

 

 							if (number(1, 100) <= iPct)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("½Â¸¶ ¼ö·Ã¼­¸¦ ÀÐ¾î ½Â¸¶ ½ºÅ³ Æ÷ÀÎÆ®¸¦ ¾ò¾ú½À´Ï´Ù."));

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾òÀº Æ÷ÀÎÆ®·Î´Â ½Â¸¶ ½ºÅ³ÀÇ ·¹º§À» ¿Ã¸± ¼ö ÀÖ½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ ü о ¸ ų Ʈ ϴ."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ʈδ ¸ ų  ø  ֽϴ."));

 								PointChange(POINT_HORSE_SKILL, 1);

 

 								int iReadDelay = number(SKILLBOOK_DELAY_MIN, SKILLBOOK_DELAY_MAX);

@@ -5353,15 +5424,15 @@
 							}

 							else

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("½Â¸¶ ¼ö·Ã¼­ ÀÌÇØ¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ ü ؿ Ͽϴ."));

 							}

 

 							ITEM_MANAGER::instance().RemoveItem(item);

 						}

 						break;

 

-						case 70102: // ¼±µÎ

-						case 70103: // ¼±µÎ

+						case 70102: // 

+						case 70103: // 

 						{

 							if (GetAlignment() >= 0)

 								return false;

@@ -5375,13 +5446,13 @@
 

 							if (delta / 10 > 0)

 							{

-								ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¸¶À½ÀÌ ¸¼¾ÆÁö´Â±º. °¡½¿À» Áþ´©¸£´ø ¹«¾ð°¡°¡ Á» °¡º­¿öÁø ´À³¦ÀÌ¾ß."));

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼±¾ÇÄ¡°¡ %d Áõ°¡ÇÏ¿´½À´Ï´Ù.", delta / 10));

+								ChatPacket(CHAT_TYPE_TALKING, LC_STRING(" ±.   𰡰   ̾."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ġ %d Ͽϴ.", delta / 10));

 							}

 						}

 						break;

 

-						case 71107: // Ãµµµº¹¼þ¾Æ

+						case 71107: // õ

 						case 39032:

 						{

 							quest::CQuestManager& q = quest::CQuestManager::Instance();

@@ -5395,18 +5466,18 @@
 								{

 									if (test_server == false)

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ϴ."));

 										return false;

 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("Å×½ºÆ® ¼­¹ö ½Ã°£Á¦ÇÑ Åë°ú"));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("׽Ʈ  ð "));

 									}

 								}

 

 								if (GetAlignment() == 200000)

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼±¾ÇÄ¡¸¦ ´õ ÀÌ»ó ¿Ã¸± ¼ö ¾ø½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("ġ  ̻ ø  ϴ."));

 									return false;

 								}

 

@@ -5422,8 +5493,8 @@
 								item->SetCount(item->GetCount() - 1);

 								pPC->SetFlag("mythical_peach.last_use_time", get_global_time());

 

-								ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¸¶À½ÀÌ ¸¼¾ÆÁö´Â±º. °¡½¿À» Áþ´©¸£´ø ¹«¾ð°¡°¡ Á» °¡º­¿öÁø ´À³¦ÀÌ¾ß."));

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼±¾ÇÄ¡°¡ %d Áõ°¡ÇÏ¿´½À´Ï´Ù.", val));

+								ChatPacket(CHAT_TYPE_TALKING, LC_STRING(" ±.   𰡰   ̾."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ġ %d Ͽϴ.", val));

 

 								char buf[256 + 1];

 								snprintf(buf, sizeof(buf), "%d %d", old_alignment, GetAlignment() / 10);

@@ -5432,7 +5503,7 @@
 						}

 						break;

 

-						case 71109: // Å»¼®¼­

+						case 71109: // Ż

 						case 39033:

 						{

 							LPITEM item2;

@@ -5457,7 +5528,7 @@
 										case ARMOR_EAR:

 										case ARMOR_WRIST:

 										case ARMOR_NECK:

-											ChatPacket(CHAT_TYPE_INFO, LC_STRING("»©³¾ ¿µ¼®ÀÌ ¾ø½À´Ï´Ù"));

+											ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ϴ"));

 											return false;

 									}

 									break;

@@ -5503,7 +5574,7 @@
 

 							if (socket.size() == 0)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("»©³¾ ¿µ¼®ÀÌ ¾ø½À´Ï´Ù"));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ϴ"));

 								return false;

 							}

 

@@ -5522,17 +5593,17 @@
 						}

 						break;

 

-						case 70201: // Å»»öÁ¦

-						case 70202: // ¿°»ö¾à(Èò»ö)

-						case 70203: // ¿°»ö¾à(±Ý»ö)

-						case 70204: // ¿°»ö¾à(»¡°£»ö)

-						case 70205: // ¿°»ö¾à(°¥»ö)

-						case 70206: // ¿°»ö¾à(°ËÀº»ö)

+						case 70201: // Ż

+						case 70202: // ()

+						case 70203: // (ݻ)

+						case 70204: // ()

+						case 70205: // ()

+						case 70206: // ()

 						{

 							// NEW_HAIR_STYLE_ADD

 							if (GetPart(PART_HAIR) >= 1001)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÇöÀç Çì¾î½ºÅ¸ÀÏ¿¡¼­´Â ¿°»ö°ú Å»»öÀÌ ºÒ°¡´ÉÇÕ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ŸϿ  Ż Ұմϴ."));

 							}

 							// END_NEW_HAIR_STYLE_ADD

 							else

@@ -5559,7 +5630,7 @@
 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("%d ·¹º§ÀÌ µÇ¾î¾ß ´Ù½Ã ¿°»öÇÏ½Ç ¼ö ÀÖ½À´Ï´Ù.", last_dye_level + 3));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("%d  Ǿ ٽ Ͻ  ֽϴ.", last_dye_level + 3));

 									}

 								}

 							}

@@ -5579,8 +5650,8 @@
 							if (item->GetVnum() == ITEM_VALENTINE_ROSE && SEX_MALE == GET_SEX(this) ||

 								item->GetVnum() == ITEM_VALENTINE_CHOCOLATE && SEX_FEMALE == GET_SEX(this))

 							{

-								// ¼ºº°ÀÌ ¸ÂÁö¾Ê¾Æ ¾µ ¼ö ¾ø´Ù.

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ºº°ÀÌ ¸ÂÁö¾Ê¾Æ ÀÌ ¾ÆÀÌÅÛÀ» ¿­ ¼ö ¾ø½À´Ï´Ù."));

+								//  ʾ   .

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʾ     ϴ."));

 								return false;

 							}

 

@@ -5595,8 +5666,8 @@
 							if (item->GetVnum() == ITEM_WHITEDAY_CANDY && SEX_MALE == GET_SEX(this) ||

 								item->GetVnum() == ITEM_WHITEDAY_ROSE && SEX_FEMALE == GET_SEX(this))

 							{

-								// ¼ºº°ÀÌ ¸ÂÁö¾Ê¾Æ ¾µ ¼ö ¾ø´Ù.

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ºº°ÀÌ ¸ÂÁö¾Ê¾Æ ÀÌ ¾ÆÀÌÅÛÀ» ¿­ ¼ö ¾ø½À´Ï´Ù."));

+								//  ʾ   .

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʾ     ϴ."));

 								return false;

 							}

 

@@ -5605,11 +5676,11 @@
 						}

 						break;

 

-						case 50011: // ¿ù±¤º¸ÇÕ

+						case 50011: // 

 						{

 							if (!GiveItemFromSpecialItemGroup(50011))

 							{

-								ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¾Æ¹«°Íµµ ¾òÀ» ¼ö ¾ø¾ú½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_TALKING, LC_STRING("ƹ͵   ϴ."));

 								return false;

 							}

 

@@ -5629,12 +5700,12 @@
 						{

 							if (CArenaManager::instance().IsArenaMap(GetMapIndex()))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 								return false;

 							}

 

 							EffectPacket(SE_CHINA_FIREWORK);

-							// ½ºÅÏ °ø°ÝÀ» ¿Ã·ÁÁØ´Ù

+							//   ÷ش

 							AddAffect(AFFECT_CHINA_FIREWORK, POINT_STUN_PCT, 30, AFF_CHINA_FIREWORK, 5 * 60, 0, true);

 							item->SetCount(item->GetCount() - 1);

 						}

@@ -5644,12 +5715,12 @@
 						{

 							if (CArenaManager::instance().IsArenaMap(GetMapIndex()))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 								return false;

 							}

 

 							EffectPacket(SE_SPIN_TOP);

-							// ½ºÅÏ °ø°ÝÀ» ¿Ã·ÁÁØ´Ù

+							//   ÷ش

 							AddAffect(AFFECT_CHINA_FIREWORK, POINT_STUN_PCT, 30, AFF_CHINA_FIREWORK, 5 * 60, 0, true);

 							item->SetCount(item->GetCount() - 1);

 						}

@@ -5670,7 +5741,7 @@
 							item->SetCount(item->GetCount() - 1);

 							break;

 

-						case ITEM_ELK_VNUM: // µ·²Ù·¯¹Ì

+						case ITEM_ELK_VNUM: // ٷ

 						{

 							int iGold = item->GetSocket(0);

 							ITEM_MANAGER::instance().RemoveItem(item);

@@ -5678,7 +5749,7 @@
 						}

 						break;

 

-						// ±ºÁÖÀÇ ÁõÇ¥

+						//  ǥ

 						case 70021:

 						{

 							int HealPrice = quest::CQuestManager::instance().GetEventFlag("MonarchHealGold");

@@ -5688,10 +5759,10 @@
 							if (CMonarch::instance().HealMyEmpire(this, HealPrice))

 							{

 								char szNotice[256];

-								snprintf(szNotice, sizeof(szNotice), LC_STRING("±ºÁÖÀÇ Ãàº¹À¸·Î ÀÌÁö¿ª %s À¯Àú´Â HP,SP°¡ ¸ðµÎ Ã¤¿öÁý´Ï´Ù.", EMPIRE_NAME(GetEmpire())));

+								snprintf(szNotice, sizeof(szNotice), LC_STRING(" ູ  %s  HP,SP  äϴ.", EMPIRE_NAME(GetEmpire())));

 								SendNoticeMap(szNotice, GetMapIndex(), false);

 

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("±ºÁÖÀÇ Ãàº¹À» »ç¿ëÇÏ¿´½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ູ Ͽϴ."));

 							}

 						}

 						break;

@@ -5701,7 +5772,7 @@
 						}

 						break;

 

-						case 71092: // º¯½Å ÇØÃ¼ºÎ ÀÓ½Ã

+						case 71092: //  ü ӽ

 						{

 							if (m_pkChrTarget != NULL)

 							{

@@ -5722,7 +5793,7 @@
 						}

 						break;

 

-						case 71051: // ÁøÀç°¡

+						case 71051: // 簡

 						{

 							LPITEM item2;

 

@@ -5743,13 +5814,13 @@
 

 							if (item2->GetAttributeSetIndex() == -1)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 								return false;

 							}

 

 							if (item2->AddRareAttribute() == true)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼º Ãß°¡¿¡ ¼º°øÇÏ¿´½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ ߰ Ͽϴ."));

 

 								int iAddedIdx = item2->GetRareAttrCount() + 4;

 								char buf[21];

@@ -5770,12 +5841,12 @@
 							}

 							else

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼º Ãß°¡¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ ߰ Ͽϴ."));

 							}

 						}

 						break;

 

-						case 71052: // ÁøÀç°æ

+						case 71052: // 

 						{

 							LPITEM item2;

 

@@ -5793,7 +5864,7 @@
 

 							if (item2->GetAttributeSetIndex() == -1)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 								return false;

 							}

 

@@ -5808,7 +5879,7 @@
 							}

 							else

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÏ¿´½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ Ͽϴ."));

 							}

 						}

 						break;

@@ -5821,8 +5892,8 @@
 						case ITEM_AUTO_SP_RECOVERY_M:

 						case ITEM_AUTO_SP_RECOVERY_L:

 						case ITEM_AUTO_SP_RECOVERY_X:

-							// ¹«½Ã¹«½ÃÇÏÁö¸¸ ÀÌÀü¿¡ ÇÏ´ø °É °íÄ¡±â´Â ¹«¼·°í...

-							// ±×·¡¼­ ±×³É ÇÏµå ÄÚµù. ¼±¹° »óÀÚ¿ë ÀÚµ¿¹°¾à ¾ÆÀÌÅÛµé.

+							// ù  ϴ  ġ ...

+							// ׷ ׳ ϵ ڵ.  ڿ ڵ ۵.

 						case REWARD_BOX_ITEM_AUTO_SP_RECOVERY_XS:

 						case REWARD_BOX_ITEM_AUTO_SP_RECOVERY_S:

 						case REWARD_BOX_ITEM_AUTO_HP_RECOVERY_XS:

@@ -5830,7 +5901,7 @@
 						{

 							if (CArenaManager::instance().IsArenaMap(GetMapIndex()))

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·ÃÀå¿¡¼­ »ç¿ëÇÏ½Ç ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("忡 Ͻ  ϴ."));

 								return false;

 							}

 

@@ -5871,7 +5942,7 @@
 

 								if (-1 == pos)

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 									break;

 								}

 

@@ -5991,7 +6062,7 @@
 

 							if (get_global_time() - last_use_time < 10 * 60)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ϴ."));

 								return false;

 							}

 

@@ -6010,7 +6081,7 @@
 					{

 						if (quest::CQuestManager::instance().GetEventFlag("arena_potion_limit") > 0)

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·ÃÀå¿¡¼­ »ç¿ëÇÏ½Ç ¼ö ¾ø½À´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("忡 Ͻ  ϴ."));

 							return false;

 						}

 

@@ -6025,7 +6096,7 @@
 								{

 									if (m_nPotionLimit <= 0)

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ç¿ë Á¦ÇÑ·®À» ÃÊ°úÇÏ¿´½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ѷ ʰϿϴ."));

 										return false;

 									}

 								}

@@ -6033,14 +6104,14 @@
 							break;

 

 							default:

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·ÃÀå¿¡¼­ »ç¿ëÇÏ½Ç ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("忡 Ͻ  ϴ."));

 								return false;

 						}

 					}

 

 					bool bUsed = false;

 

-					if (item->GetValue(0) != 0) // HP Àý´ë°ª È¸º¹

+					if (item->GetValue(0) != 0) // HP 밪 ȸ

 					{

 						if (GetHP() < GetMaxHP())

 						{

@@ -6050,7 +6121,7 @@
 						}

 					}

 

-					if (item->GetValue(1) != 0) // SP Àý´ë°ª È¸º¹

+					if (item->GetValue(1) != 0) // SP 밪 ȸ

 					{

 						if (GetSP() < GetMaxSP())

 						{

@@ -6060,7 +6131,7 @@
 						}

 					}

 

-					if (item->GetValue(3) != 0) // HP % È¸º¹

+					if (item->GetValue(3) != 0) // HP % ȸ

 					{

 						if (GetHP() < GetMaxHP())

 						{

@@ -6070,7 +6141,7 @@
 						}

 					}

 

-					if (item->GetValue(4) != 0) // SP % È¸º¹

+					if (item->GetValue(4) != 0) // SP % ȸ

 					{

 						if (GetSP() < GetMaxSP())

 						{

@@ -6085,7 +6156,7 @@
 						if (item->GetVnum() == 50085 || item->GetVnum() == 50086)

 						{

 							if (test_server)

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ùº´ ¶Ç´Â Á¾ÀÚ ¸¦ »ç¿ëÇÏ¿´½À´Ï´Ù"));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ǵ   Ͽϴ"));

 

 							SetUseSeedOrMoonBottleTime();

 						}

@@ -6111,7 +6182,7 @@
 					{

 						if (quest::CQuestManager::instance().GetEventFlag("arena_potion_limit") > 0)

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·ÃÀå¿¡¼­ »ç¿ëÇÏ½Ç ¼ö ¾ø½À´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("忡 Ͻ  ϴ."));

 							return false;

 						}

 

@@ -6130,7 +6201,7 @@
 								{

 									if (m_nPotionLimit <= 0)

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ç¿ë Á¦ÇÑ·®À» ÃÊ°úÇÏ¿´½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ѷ ʰϿϴ."));

 										return false;

 									}

 								}

@@ -6138,7 +6209,7 @@
 							break;

 

 							default:

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·ÃÀå¿¡¼­ »ç¿ëÇÏ½Ç ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("忡 Ͻ  ϴ."));

 								return false;

 						}

 					}

@@ -6197,7 +6268,7 @@
 				{

 					if (FindAffect(AFFECT_BLEND, item->GetValue(0)))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 						return false;

 					}

 

@@ -6363,22 +6434,22 @@
 					const int TOWN_PORTAL = 1;

 					const int MEMORY_PORTAL = 2;

 

-					// gm_guild_build, oxevent ¸Ê¿¡¼­ ±ÍÈ¯ºÎ ±ÍÈ¯±â¾ïºÎ ¸¦ »ç¿ë¸øÇÏ°Ô ¸·À½

+					// gm_guild_build, oxevent ʿ ȯ ȯ  ϰ 

 					if (GetMapIndex() == 200 || GetMapIndex() == 113)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÇöÀç À§Ä¡¿¡¼­ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ġ   ϴ."));

 						return false;

 					}

 

 					if (CArenaManager::instance().IsArenaMap(GetMapIndex()))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ë·Ã Áß¿¡´Â ÀÌ¿ëÇÒ ¼ö ¾ø´Â ¹°Ç°ÀÔ´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̿   ǰԴϴ."));

 						return false;

 					}

 

 					if (m_pkWarpEvent)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌµ¿ÇÒ ÁØºñ°¡ µÇ¾îÀÖÀ½À¸·Î ±ÍÈ¯ºÎ¸¦ »ç¿ëÇÒ¼ö ¾ø½À´Ï´Ù"));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("̵ غ Ǿ ȯθ Ҽ ϴ"));

 						return false;

 					}

 

@@ -6389,7 +6460,7 @@
 						return false;

 					// END_OF_CONSUME_LIFE_WHEN_USE_WARP_ITEM

 

-					if (item->GetValue(0) == TOWN_PORTAL) // ±ÍÈ¯ºÎ

+					if (item->GetValue(0) == TOWN_PORTAL) // ȯ

 					{

 						if (item->GetSocket(0) == 0)

 						{

@@ -6415,19 +6486,19 @@
 						else

 						{

 							if (test_server)

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¿ø·¡ À§Ä¡·Î º¹±Í"));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ġ "));

 

 							ProcessRecallItem(item);

 						}

 					}

-					else if (item->GetValue(0) == MEMORY_PORTAL) // ±ÍÈ¯±â¾ïºÎ

+					else if (item->GetValue(0) == MEMORY_PORTAL) // ȯ

 					{

 						if (item->GetSocket(0) == 0)

 						{

 							if (GetDungeon())

 							{

-								const char* c_szConv = (g_iUseLocale ? "" : (under_han(item->GetName()) ? LC_STRING("À»") : LC_STRING("¸¦")));

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´øÀü ¾È¿¡¼­´Â %s%s »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù.", LC_ITEM(item->GetVnum()), c_szConv));

+								const char* c_szConv = (g_iUseLocale ? "" : (under_han(item->GetName()) ? LC_STRING("") : LC_STRING("")));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȿ %s%s   ϴ.", LC_ITEM(item->GetVnum()), c_szConv));

 								return false;

 							}

 

@@ -6470,7 +6541,7 @@
 

 					if (PreventTradeWindow(WND_ALL))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ã¢°í,°Å·¡Ã¢µîÀÌ ¿­¸° »óÅÂ¿¡¼­´Â °³·®À» ÇÒ¼ö°¡ ¾ø½À´Ï´Ù"));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("â,ŷâ  ¿  Ҽ ϴ"));

 						return false;

 					}

 

@@ -6502,14 +6573,10 @@
 					if (!IsValidItemPosition(DestCell) || !(item2 = GetItem(DestCell)))

 						return false;

 

-					if (item2->IsEquipped())

-					{

-						BuffOnAttr_RemoveBuffsFromItem(item2);

-					}

-

-					// [NOTE] ÄÚ½ºÆ¬ ¾ÆÀÌÅÛ¿¡´Â ¾ÆÀÌÅÛ ÃÖÃÊ »ý¼º½Ã ·£´ý ¼Ó¼ºÀ» ºÎ¿©ÇÏµÇ, Àç°æÀç°¡ µîµîÀº ¸·¾Æ´Þ¶ó´Â ¿äÃ»ÀÌ ÀÖ¾úÀ½.

-					// ¿ø·¡ ANTI_CHANGE_ATTRIBUTE °°Àº ¾ÆÀÌÅÛ Flag¸¦ Ãß°¡ÇÏ¿© ±âÈ¹ ·¹º§¿¡¼­ À¯¿¬ÇÏ°Ô ÄÁÆ®·Ñ ÇÒ ¼ö ÀÖµµ·Ï ÇÒ ¿¹Á¤ÀÌ¾úÀ¸³ª

-					// ±×µý°Å ÇÊ¿ä¾øÀ¸´Ï ´ÚÄ¡°í »¡¸® ÇØ´Þ·¡¼­ ±×³É ¿©±â¼­ ¸·À½... -_-

+

+					// [NOTE] ڽƬ ۿ     Ӽ οϵ, 簡  ƴ޶ û ־.

+					//  ANTI_CHANGE_ATTRIBUTE   Flag ߰Ͽ ȹ  ϰ Ʈ   ֵ  ̾

+					// ׵ ʿ ġ  ش޷ ׳ ⼭ ... -_-

 					/*

 					if (IS_SET(item2->GetAntiFlag(), ITEM_ANTIFLAG_CHANGE_ATTRIBUTE) && !item->IsSocketModifyingItem())

 					{

@@ -6527,7 +6594,7 @@
 #endif

 						)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 						return false;

 					}

 

@@ -6547,7 +6614,7 @@
 

 							if (i == METIN_SOCKET_MAX_NUM)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ã»¼ÒÇÒ ¼®ÀÌ ¹ÚÇôÀÖÁö ¾Ê½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("û   ʽϴ."));

 								return false;

 							}

 

@@ -6594,13 +6661,13 @@
 

 							if (item2->GetAttributeSetIndex() == -1)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 								return false;

 							}

 

 							if (item2->GetAttributeCount() == 0)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯°æÇÒ ¼Ó¼ºÀÌ ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ӽ ϴ."));

 								return false;

 							}

 

@@ -6609,8 +6676,8 @@
 								if (GM_PLAYER == GetGMLevel() && false == test_server)

 								{

 									//

-									// Event Flag ¸¦ ÅëÇØ ÀÌÀü¿¡ ¾ÆÀÌÅÛ ¼Ó¼º º¯°æÀ» ÇÑ ½Ã°£À¸·Î ºÎÅÍ ÃæºÐÇÑ ½Ã°£ÀÌ Èê·¶´ÂÁö °Ë»çÇÏ°í

-									// ½Ã°£ÀÌ ÃæºÐÈ÷ Èê·¶´Ù¸é ÇöÀç ¼Ó¼ºº¯°æ¿¡ ´ëÇÑ ½Ã°£À» ¼³Á¤ÇØ ÁØ´Ù.

+									// Event Flag     Ӽ   ð   ð 귶 ˻ϰ

+									// ð  귶ٸ  Ӽ濡  ð  ش.

 									//

 

 									DWORD dwChangeItemAttrCycle = quest::CQuestManager::instance().GetEventFlag(msc_szChangeItemAttrCycleFlag);

@@ -6627,7 +6694,7 @@
 

 										if (dwLastChangeItemAttrMin + dwChangeItemAttrCycle > dwNowMin)

 										{

-											ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» ¹Ù²ÛÁö %dºÐ ÀÌ³»¿¡´Â ´Ù½Ã º¯°æÇÒ ¼ö ¾ø½À´Ï´Ù.(%d ºÐ ³²À½)",

+											ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ ٲ %d ̳ ٽ   ϴ.(%d  )",

 												dwChangeItemAttrCycle, dwChangeItemAttrCycle - (dwNowMin - dwLastChangeItemAttrMin)));

 											return false;

 										}

@@ -6648,8 +6715,8 @@
 							}

 							else

 							{

-								// ¿¬Àç°æ Æ¯¼öÃ³¸®

-								// Àý´ë·Î ¿¬Àç°¡ Ãß°¡ ¾ÈµÉ°Å¶ó ÇÏ¿© ÇÏµå ÄÚµùÇÔ.

+								//  Ưó

+								//  簡 ߰ ȵɰŶ Ͽ ϵ ڵ.

 								if (item->GetVnum() == 71151 || item->GetVnum() == 76023)

 								{

 									if ((item2->GetType() == ITEM_WEAPON) || (item2->GetType() == ITEM_ARMOR && item2->GetSubType() == ARMOR_BODY))

@@ -6665,20 +6732,20 @@
 										}

 										if (false == bCanUse)

 										{

-											ChatPacket(CHAT_TYPE_INFO, LC_STRING("Àû¿ë ·¹º§º¸´Ù ³ô¾Æ »ç¿ëÀÌ ºÒ°¡´ÉÇÕ´Ï´Ù."));

+											ChatPacket(CHAT_TYPE_INFO, LC_STRING("    Ұմϴ."));

 											break;

 										}

 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹«±â¿Í °©¿Ê¿¡¸¸ »ç¿ë °¡´ÉÇÕ´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʿ  մϴ."));

 										break;

 									}

 								}

 								item2->ChangeAttribute();

 							}

 

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÏ¿´½À´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ Ͽϴ."));

 							{

 								char buf[21];

 								snprintf(buf, sizeof(buf), "%u", item2->GetID());

@@ -6700,14 +6767,14 @@
 

 							if (item2->GetAttributeSetIndex() == -1)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 								return false;

 							}

 

 							if (item2->GetAttributeCount() < 4)

 							{

-								// ¿¬Àç°¡ Æ¯¼öÃ³¸®

-								// Àý´ë·Î ¿¬Àç°¡ Ãß°¡ ¾ÈµÉ°Å¶ó ÇÏ¿© ÇÏµå ÄÚµùÇÔ.

+								// 簡 Ưó

+								//  簡 ߰ ȵɰŶ Ͽ ϵ ڵ.

 								if (item->GetVnum() == 71152 || item->GetVnum() == 76024)

 								{

 									if ((item2->GetType() == ITEM_WEAPON) || (item2->GetType() == ITEM_ARMOR && item2->GetSubType() == ARMOR_BODY))

@@ -6723,13 +6790,13 @@
 										}

 										if (false == bCanUse)

 										{

-											ChatPacket(CHAT_TYPE_INFO, LC_STRING("Àû¿ë ·¹º§º¸´Ù ³ô¾Æ »ç¿ëÀÌ ºÒ°¡´ÉÇÕ´Ï´Ù."));

+											ChatPacket(CHAT_TYPE_INFO, LC_STRING("    Ұմϴ."));

 											break;

 										}

 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹«±â¿Í °©¿Ê¿¡¸¸ »ç¿ë °¡´ÉÇÕ´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʿ  մϴ."));

 										break;

 									}

 								}

@@ -6740,7 +6807,7 @@
 								if (number(1, 100) <= aiItemAttributeAddPercent[item2->GetAttributeCount()] || g_bNeverFailAddAttributes == true)

 								{

 									item2->AddAttribute();

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼º Ãß°¡¿¡ ¼º°øÇÏ¿´½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ ߰ Ͽϴ."));

 

 									int iAddedIdx = item2->GetAttributeCount() - 1;

 									LogManager::instance().ItemLog(

@@ -6756,7 +6823,7 @@
 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼º Ãß°¡¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ ߰ Ͽϴ."));

 									LogManager::instance().ItemLog(this, item, "ADD_ATTRIBUTE_FAIL", buf);

 								}

 

@@ -6765,7 +6832,7 @@
 							}

 							else

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õÀÌ»ó ÀÌ ¾ÆÀÌÅÛÀ» ÀÌ¿ëÇÏ¿© ¼Ó¼ºÀ» Ãß°¡ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("̻   ̿Ͽ Ӽ ߰  ϴ."));

 							}

 						}

 						break;

@@ -6778,15 +6845,15 @@
 								return false;

 							}

 

-							// Ãàº¹ÀÇ ±¸½½

-							// Àç°¡ºñ¼­¸¦ ÅëÇØ ¼Ó¼ºÀ» 4°³ Ãß°¡ ½ÃÅ² ¾ÆÀÌÅÛ¿¡ ´ëÇØ¼­ ÇÏ³ªÀÇ ¼Ó¼ºÀ» ´õ ºÙ¿©ÁØ´Ù.

+							// ູ 

+							// 簡񼭸  Ӽ 4 ߰ Ų ۿ ؼ ϳ Ӽ  ٿش.

 							if (item2->GetAttributeSetIndex() == -1)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

-								return false;

-							}

-

-							// ¼Ó¼ºÀÌ ÀÌ¹Ì 4°³ Ãß°¡ µÇ¾úÀ» ¶§¸¸ ¼Ó¼ºÀ» Ãß°¡ °¡´ÉÇÏ´Ù.

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

+								return false;

+							}

+

+							// Ӽ ̹ 4 ߰ Ǿ  Ӽ ߰ ϴ.

 							if (item2->GetAttributeCount() == 4)

 							{

 								char buf[21];

@@ -6795,7 +6862,7 @@
 								if (number(1, 100) <= aiItemAttributeAddPercent[item2->GetAttributeCount()] || g_bNeverFailAddAttributes == true)

 								{

 									item2->AddAttribute();

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼º Ãß°¡¿¡ ¼º°øÇÏ¿´½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ ߰ Ͽϴ."));

 

 									int iAddedIdx = item2->GetAttributeCount() - 1;

 									LogManager::instance().ItemLog(

@@ -6811,7 +6878,7 @@
 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼º Ãß°¡¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ ߰ Ͽϴ."));

 									LogManager::instance().ItemLog(this, item, "ADD_ATTRIBUTE2_FAIL", buf);

 								}

 

@@ -6820,11 +6887,11 @@
 							}

 							else if (item2->GetAttributeCount() == 5)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("´õ ÀÌ»ó ÀÌ ¾ÆÀÌÅÛÀ» ÀÌ¿ëÇÏ¿© ¼Ó¼ºÀ» Ãß°¡ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̻   ̿Ͽ Ӽ ߰  ϴ."));

 							}

 							else if (item2->GetAttributeCount() < 4)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ÕÀú Àç°¡ºñ¼­¸¦ ÀÌ¿ëÇÏ¿© ¼Ó¼ºÀ» Ãß°¡½ÃÄÑ ÁÖ¼¼¿ä."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" 簡񼭸 ̿Ͽ Ӽ ߰ ּ."));

 							}

 							else

 							{

@@ -6853,13 +6920,13 @@
 

 							if (item2->GetAttributeSetIndex() == -1)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 								return false;

 							}

 

 							if (item2->GetRareAttrCount() == 0)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯°æÇÒ ¼Ó¼ºÀÌ ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ӽ ϴ."));

 								return false;

 							}

 

@@ -6867,7 +6934,7 @@
 							{

 								if (item2->ChangeRareAttribute())

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÏ¿´½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ Ͽϴ."));

 									{

 										char szBuff[21];

 										snprintf(szBuff, sizeof(szBuff), "%u", item2->GetID());

@@ -6897,12 +6964,12 @@
 									if (number(1, 100) <= 50 || g_bNeverFailAccessorySocket == true)

 									{

 										item2->SetAccessorySocketMaxGrade(item2->GetAccessorySocketMaxGrade() + 1);

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÄÏÀÌ ¼º°øÀûÀ¸·Î Ãß°¡µÇ¾ú½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ߰Ǿϴ."));

 										LogManager::instance().ItemLog(this, item, "ADD_SOCKET_SUCCESS", buf);

 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÄÏ Ãß°¡¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߰ Ͽϴ."));

 										LogManager::instance().ItemLog(this, item, "ADD_SOCKET_FAIL", buf);

 									}

 

@@ -6911,12 +6978,12 @@
 								}

 								else

 								{

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾×¼¼¼­¸®¿¡´Â ´õÀÌ»ó ¼ÒÄÏÀ» Ãß°¡ÇÒ °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ׼ ̻  ߰  ϴ."));

 								}

 							}

 							else

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀ¸·Î ¼ÒÄÏÀ» Ãß°¡ÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ߰   Դϴ."));

 							}

 						}

 						break;

@@ -6934,12 +7001,12 @@
 									if (number(1, 100) <= aiAccessorySocketPutPct[item2->GetAccessorySocketGrade()] || g_bNeverFailAccessory == true)

 									{

 										item2->SetAccessorySocketGrade(item2->GetAccessorySocketGrade() + 1);

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀåÂø¿¡ ¼º°øÇÏ¿´½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ͽϴ."));

 										LogManager::instance().ItemLog(this, item, "PUT_SOCKET_SUCCESS", buf);

 									}

 									else

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀåÂø¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ͽϴ."));

 										LogManager::instance().ItemLog(this, item, "PUT_SOCKET_FAIL", buf);

 									}

 

@@ -6949,19 +7016,19 @@
 								else

 								{

 									if (item2->GetAccessorySocketMaxGrade() == 0)

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ÕÀú ´ÙÀÌ¾Æ¸óµå·Î ¾Ç¼¼¼­¸®¿¡ ¼ÒÄÏÀ» Ãß°¡ÇØ¾ßÇÕ´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ̾Ƹ Ǽ  ߰ؾմϴ."));

 									else if (item2->GetAccessorySocketMaxGrade() < ITEM_ACCESSORY_SOCKET_MAX_NUM)

 									{

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾×¼¼¼­¸®¿¡´Â ´õÀÌ»ó ÀåÂøÇÒ ¼ÒÄÏÀÌ ¾ø½À´Ï´Ù."));

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("´ÙÀÌ¾Æ¸óµå·Î ¼ÒÄÏÀ» Ãß°¡ÇØ¾ßÇÕ´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ׼ ̻   ϴ."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING("̾Ƹ  ߰ؾմϴ."));

 									}

 									else

-										ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾×¼¼¼­¸®¿¡´Â ´õÀÌ»ó º¸¼®À» ÀåÂøÇÒ ¼ö ¾ø½À´Ï´Ù."));

+										ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ׼ ̻    ϴ."));

 								}

 							}

 							else

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀ» ÀåÂøÇÒ ¼ö ¾ø½À´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 							}

 						}

 						break;

@@ -6980,14 +7047,14 @@
 

 							if (!item2->CanChangeCostumeAttr())

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 								return false;

 							}

 

 							// NOTE: Prevent changing costumes without bonus.

 							if (item2->GetAttributeCount() == 0)

 							{

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 								return false;

 							}

 

@@ -7005,7 +7072,7 @@
 									if (!g_bUnlimitedResetCostumeAttributes)

 										item->SetCount(item->GetCount() - 1);

 

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÏ¿´½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ Ͽϴ."));

 								}

 								break;

 

@@ -7020,7 +7087,7 @@
 									if (!g_bUnlimitedChangeCostumeAttributes)

 										item->SetCount(item->GetCount() - 1);

 

-									ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÏ¿´½À´Ï´Ù."));

+									ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ Ͽϴ."));

 								}

 								break;

 							}

@@ -7062,7 +7129,7 @@
 				{

 					if (m_pkFishingEvent)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("³¬½Ã Áß¿¡ ¹Ì³¢¸¦ °¥¾Æ³¢¿ï ¼ö ¾ø½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ߿ ̳ Ƴ  ϴ."));

 						return false;

 					}

 

@@ -7073,11 +7140,11 @@
 

 					if (weapon->GetSocket(2))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì ²ÈÇôÀÖ´ø ¹Ì³¢¸¦ »©°í %s¸¦ ³¢¿ó´Ï´Ù.", LC_ITEM(item->GetVnum())));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ִ ̳  %s ϴ.", LC_ITEM(item->GetVnum())));

 					}

 					else

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("³¬½Ã´ë¿¡ %s¸¦ ¹Ì³¢·Î ³¢¿ó´Ï´Ù.", LC_ITEM(item->GetVnum())));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ô뿡 %s ̳ ϴ.", LC_ITEM(item->GetVnum())));

 					}

 

 					weapon->SetSocket(2, item->GetValue(0));

@@ -7169,7 +7236,7 @@
 

 					if (FindAffect(item->GetValue(0), aApplyInfo[item->GetValue(1)].wPointType))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 					}

 					else

 					{

@@ -7186,7 +7253,7 @@
 				}

 				break;

 

-				// ¹°¾à Á¦Á¶ ½ºÅ³¿ë ·¹½ÃÇÇ Ã³¸®

+				//   ų  ó

 				case USE_RECIPE:

 				{

 					LPITEM pSource1 = FindSpecifyItem(item->GetValue(1));

@@ -7199,7 +7266,7 @@
 					{

 						if (pSource1 == NULL)

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹°¾à Á¶ÇÕÀ» À§ÇÑ Àç·á°¡ ºÎÁ·ÇÕ´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ᰡ մϴ."));

 							return false;

 						}

 					}

@@ -7208,7 +7275,7 @@
 					{

 						if (pSource2 == NULL)

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹°¾à Á¶ÇÕÀ» À§ÇÑ Àç·á°¡ ºÎÁ·ÇÕ´Ï´Ù."));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ᰡ մϴ."));

 							return false;

 						}

 					}

@@ -7217,7 +7284,7 @@
 					{

 						if (pSource1->GetCount() < dwSourceCount1)

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("Àç·á(%s)°¡ ºÎÁ·ÇÕ´Ï´Ù.", LC_ITEM(pSource1->GetVnum())));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("(%s) մϴ.", LC_ITEM(pSource1->GetVnum())));

 							return false;

 						}

 

@@ -7228,7 +7295,7 @@
 					{

 						if (pSource2->GetCount() < dwSourceCount2)

 						{

-							ChatPacket(CHAT_TYPE_INFO, LC_STRING("Àç·á(%s)°¡ ºÎÁ·ÇÕ´Ï´Ù.", LC_ITEM(pSource2->GetVnum())));

+							ChatPacket(CHAT_TYPE_INFO, LC_STRING("(%s) մϴ.", LC_ITEM(pSource2->GetVnum())));

 							return false;

 						}

 

@@ -7239,7 +7306,7 @@
 

 					if (!pBottle || pBottle->GetCount() < 1)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ºó º´ÀÌ ¸ðÀÚ¸¨´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ڸϴ."));

 						return false;

 					}

 

@@ -7247,7 +7314,7 @@
 

 					if (number(1, 100) > item->GetValue(5))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹°¾à Á¦Á¶¿¡ ½ÇÆÐÇß½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ߽ϴ."));

 						return false;

 					}

 

@@ -7303,7 +7370,7 @@
 #endif

 					)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("°°Àº Á¾·ùÀÇ ¸ÞÆ¾¼®Àº ¿©·¯°³ ºÎÂøÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ƾ    ϴ."));

 					return false;

 				}

 			}

@@ -7312,7 +7379,7 @@
 			{

 				if (!IS_SET(item->GetWearFlag(), WEARABLE_BODY) || !IS_SET(item2->GetWearFlag(), WEARABLE_BODY))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¸ÞÆ¾¼®Àº Àåºñ¿¡ ºÎÂøÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ƾ    ϴ."));

 					return false;

 				}

 			}

@@ -7321,7 +7388,7 @@
 			{

 				if (!IS_SET(item->GetWearFlag(), WEARABLE_GLOVE) || !IS_SET(item2->GetWearFlag(), WEARABLE_GLOVE))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¸ÞÆ¾¼®Àº Àåºñ¿¡ ºÎÂøÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ƾ    ϴ."));

 					return false;

 				}

 			}

@@ -7330,13 +7397,13 @@
 			{

 				if (!IS_SET(item->GetWearFlag(), WEARABLE_WEAPON))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¸ÞÆ¾¼®Àº ¹«±â¿¡ ºÎÂøÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ƾ ⿡   ϴ."));

 					return false;

 				}

 			}

 			else

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ºÎÂøÇÒ ¼ö ÀÖ´Â ½½·ÔÀÌ ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ִ  ϴ."));

 				return false;

 			}

 

@@ -7344,10 +7411,10 @@
 			{

 				if (item2->GetSocket(i) >= 1 && item2->GetSocket(i) <= 2 && item2->GetSocket(i) >= item->GetValue(2))

 				{

-					// ¼® È®·ü

+					//  Ȯ

 					if (number(1, 100) <= 30 || g_bNeverFailMetin == true)

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ÞÆ¾¼® ºÎÂø¿¡ ¼º°øÇÏ¿´½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ƾ  Ͽϴ."));

 

 #if defined(__GLOVE_SYSTEM__)

 						DWORD dwValue = item->GetVnum();

@@ -7368,7 +7435,7 @@
 					}

 					else

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸ÞÆ¾¼® ºÎÂø¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ƾ  Ͽϴ."));

 						item2->SetSocket(i, ITEM_BROKEN_METIN_VNUM);

 					}

 

@@ -7379,7 +7446,7 @@
 			}

 

 			if (i == METIN_SOCKET_MAX_NUM)

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ºÎÂøÇÒ ¼ö ÀÖ´Â ½½·ÔÀÌ ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ִ  ϴ."));

 		}

 		break;

 

@@ -7399,7 +7466,7 @@
 

 		case ITEM_BLEND:

 		{

-			// »õ·Î¿î ¾àÃÊµé

+			// ο ʵ

 			sys_log(0, "ITEM_BLEND!!");

 

 			if (Blend_Item_find(item->GetVnum()))

@@ -7411,13 +7478,13 @@
 

 				if (FindAffect(affect_type, apply_type))

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 				}

 				else

 				{

 					if (FindAffect(AFFECT_EXP_BONUS_EURO_FREE, POINT_RESIST_MAGIC))

 					{

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì È¿°ú°¡ °É·Á ÀÖ½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ ȿ ɷ ֽϴ."));

 					}

 					else

 					{

@@ -7655,7 +7722,7 @@
 

 	if (!item->CanUsedBy(this))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("±ºÁ÷ÀÌ ¸ÂÁö¾Ê¾Æ ÀÌ ¾ÆÀÌÅÛÀ» »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʾ     ϴ."));

 		return false;

 	}

 

@@ -7664,7 +7731,7 @@
 

 	if (false == FN_check_item_sex(this, item))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ºº°ÀÌ ¸ÂÁö¾Ê¾Æ ÀÌ ¾ÆÀÌÅÛÀ» »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʾ     ϴ."));

 		return false;

 	}

 

@@ -7711,40 +7778,40 @@
 			return false;

 		}

 

-		// °æÈ¥¹ÝÁö »ç¿ëÁö »ó´ë¹æÀÌ SUMMONABLE_ZONE¿¡ ÀÖ´Â°¡´Â WarpToPC()¿¡¼­ Ã¼Å©

-

-		// »ï°Å¸® °ü·Á ¸Ê¿¡¼­´Â ±ÍÈ¯ºÎ¸¦ ¸·¾Æ¹ö¸°´Ù.

+		// ȥ   SUMMONABLE_ZONE ִ° WarpToPC() üũ

+

+		// Ÿ  ʿ ȯθ ƹ.

 		if (CThreeWayWar::instance().IsThreeWayWarMapIndex(GetMapIndex()))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ï°Å¸® ÀüÅõ Âü°¡Áß¿¡´Â ±ÍÈ¯ºÎ,±ÍÈ¯±â¾ïºÎ¸¦ »ç¿ëÇÒ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ÿ  ߿ ȯ,ȯθ Ҽ ϴ."));

 			return false;

 		}

 

 		int iPulse = thecore_pulse();

 

-		// Ã¢°í ¿¬ÈÄ Ã¼Å©

+		// â  üũ

 		if (iPulse - GetSafeboxLoadTime() < PASSES_PER_SEC(g_nPortalLimitTime))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ã¢°í¸¦ ¿¬ÈÄ %dÃÊ ÀÌ³»¿¡´Â ±ÍÈ¯ºÎ,±ÍÈ¯±â¾ïºÎ¸¦ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù.", g_nPortalLimitTime));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("â  %d ̳ ȯ,ȯθ   ϴ.", g_nPortalLimitTime));

 

 			if (test_server)

 				ChatPacket(CHAT_TYPE_INFO, "[TestOnly]Pulse %d LoadTime %d PASS %d", iPulse, GetSafeboxLoadTime(), PASSES_PER_SEC(g_nPortalLimitTime));

 			return false;

 		}

 

-		// °Å·¡°ü·Ã Ã¢ Ã¼Å©

+		// ŷ â üũ

 		if (PreventTradeWindow(WND_ALL))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°Å·¡Ã¢,Ã¢°í µîÀ» ¿¬ »óÅÂ¿¡¼­´Â ±ÍÈ¯ºÎ,±ÍÈ¯±â¾ïºÎ ¸¦ »ç¿ëÇÒ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ŷâ,â   ¿ ȯ,ȯ  Ҽ ϴ."));

 			return false;

 		}

 

 		// PREVENT_REFINE_HACK

-		// °³·®ÈÄ ½Ã°£Ã¼Å©

+		//  ðüũ

 		{

 			if (iPulse - GetRefineTime() < PASSES_PER_SEC(g_nPortalLimitTime))

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ °³·®ÈÄ %dÃÊ ÀÌ³»¿¡´Â ±ÍÈ¯ºÎ,±ÍÈ¯±â¾ïºÎ¸¦ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù.", g_nPortalLimitTime));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  %d ̳ ȯ,ȯθ   ϴ.", g_nPortalLimitTime));

 				return false;

 			}

 		}

@@ -7754,7 +7821,7 @@
 		{

 			if (iPulse - GetMyShopTime() < PASSES_PER_SEC(g_nPortalLimitTime))

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("°³ÀÎ»óÁ¡ »ç¿ëÈÄ %dÃÊ ÀÌ³»¿¡´Â ±ÍÈ¯ºÎ,±ÍÈ¯±â¾ïºÎ¸¦ »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù.", g_nPortalLimitTime));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("λ  %d ̳ ȯ,ȯθ   ϴ.", g_nPortalLimitTime));

 				return false;

 			}

 

@@ -7768,7 +7835,7 @@
 		}

 		// END_PREVENT_ITEM_COPY

 

-		// ±ÍÈ¯ºÎ °Å¸®Ã¼Å©

+		// ȯ Ÿüũ

 		if (item->GetType() == ITEM_USE && item->GetSubType() == USE_TALISMAN)

 		{

 			PIXEL_POSITION posWarp;

@@ -7779,13 +7846,13 @@
 			double nDist = 0;

 			const double nDistant = 5000.0;

 

-			// ±ÍÈ¯±â¾ïºÎ

+			// ȯ

 			if (item->GetVnum() == 22010)

 			{

 				x = item->GetSocket(0) - GetX();

 				y = item->GetSocket(1) - GetY();

 			}

-			// ±ÍÈ¯ºÎ

+			// ȯ

 			else if (item->GetVnum() == 22000)

 			{

 				SECTREE_MANAGER::instance().GetRecallPositionByEmpire(GetMapIndex(), GetEmpire(), posWarp);

@@ -7806,7 +7873,7 @@
 

 			if (nDistant > nDist)

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌµ¿ µÇ¾îÁú À§Ä¡¿Í ³Ê¹« °¡±î¿ö ±ÍÈ¯ºÎ¸¦ »ç¿ëÇÒ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("̵ Ǿ ġ ʹ  ȯθ Ҽ ϴ."));

 				if (test_server)

 					ChatPacket(CHAT_TYPE_INFO, "PossibleDistant %f nNowDist %f", nDistant, nDist);

 				return false;

@@ -7814,21 +7881,21 @@
 		}

 

 		// PREVENT_PORTAL_AFTER_EXCHANGE

-		// ±³È¯ ÈÄ ½Ã°£Ã¼Å©

+		// ȯ  ðüũ

 		if (iPulse - GetExchangeTime() < PASSES_PER_SEC(g_nPortalLimitTime))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°Å·¡ ÈÄ %dÃÊ ÀÌ³»¿¡´Â ±ÍÈ¯ºÎ,±ÍÈ¯±â¾ïºÎµîÀ» »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù.", g_nPortalLimitTime));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ŷ  %d ̳ ȯ,ȯε   ϴ.", g_nPortalLimitTime));

 			return false;

 		}

 		// END_PREVENT_PORTAL_AFTER_EXCHANGE

 	}

 

-	// º¸µû¸® ºñ´Ü »ç¿ë½Ã °Å·¡Ã¢ Á¦ÇÑ Ã¼Å©

+	//    ŷâ  üũ

 	if ((item->GetVnum() == 50200) || (item->GetVnum() == 71049))

 	{

 		if (PreventTradeWindow(WND_ALL))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°Å·¡Ã¢,Ã¢°í µîÀ» ¿¬ »óÅÂ¿¡¼­´Â º¸µû¸®,ºñ´Üº¸µû¸®¸¦ »ç¿ëÇÒ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ŷâ,â   ¿ ,ܺ Ҽ ϴ."));

 			return false;

 		}

 	}

@@ -7837,7 +7904,7 @@
 	if (IsRunningQuest())

 		return false;

 

-	if (IS_SET(item->GetFlag(), ITEM_FLAG_LOG)) // »ç¿ë ·Î±×¸¦ ³²±â´Â ¾ÆÀÌÅÛ Ã³¸®

+	if (IS_SET(item->GetFlag(), ITEM_FLAG_LOG)) //  α׸   ó

 	{

 		DWORD vid = item->GetVID();

 		DWORD oldCount = item->GetCount();

@@ -7856,7 +7923,7 @@
 			UpdateExtBattlePassMissionProgress(BP_ITEM_USE, 1, item->GetVnum());

 #endif

 

-		if (NULL == ITEM_MANAGER::instance().FindByVID(vid)) // UseItemEx¿¡¼­ ¾ÆÀÌÅÛÀÌ »èÁ¦ µÇ¾ú´Ù. »èÁ¦ ·Î±×¸¦ ³²±è

+		if (NULL == ITEM_MANAGER::instance().FindByVID(vid)) // UseItemEx   Ǿ.  α׸ 

 		{

 			LogManager::instance().ItemLog(this, vid, vnum, "REMOVE", hint);

 		}

@@ -7890,7 +7957,7 @@
 	{

 #if defined(__DRAGON_SOUL_SYSTEM__)

 		if (NULL != DragonSoul_RefineWindow_GetOpener())

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­Ã¢À» ¿¬ »óÅÂ¿¡¼­´Â ¾ÆÀÌÅÛÀ» ¿Å±æ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭâ  ¿  ű  ϴ."));

 #endif

 		return false;

 	}

@@ -7928,14 +7995,14 @@
 

 	if (IS_SET(item->GetAntiFlag(), ITEM_ANTIFLAG_DROP | ITEM_ANTIFLAG_GIVE))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹ö¸± ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("   Դϴ."));

 		return false;

 	}

 

 	if (wCount == 0 || wCount > item->GetCount())

 		wCount = item->GetCount();

 

-	// Quickslot ¿¡¼­ Áö¿ò

+	// Quickslot  

 	if (INVENTORY == Cell.window_type)

 		SyncQuickslot(SLOT_TYPE_INVENTORY, Cell.cell, WORD_MAX);

 	else if (BELT_INVENTORY == Cell.window_type)

@@ -7974,12 +8041,12 @@
 

 	if (pkItemToDrop->AddToGround(GetMapIndex(), pxPos))

 	{

-		// ÇÑ±¹¿¡´Â ¾ÆÀÌÅÛÀ» ¹ö¸®°í º¹±¸ÇØ´Þ¶ó´Â Áø»óÀ¯ÀúµéÀÌ ¸¹¾Æ¼­

-		// ¾ÆÀÌÅÛÀ» ¹Ù´Ú¿¡ ¹ö¸± ½Ã ¼Ó¼º·Î±×¸¦ ³²±ä´Ù.

+		// ѱ   ش޶  Ƽ

+		//  ٴڿ   Ӽα׸ .

 		if (LC_IsYMIR())

 			item->AttrLog();

 

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¶³¾îÁø ¾ÆÀÌÅÛÀº 3ºÐ ÈÄ »ç¶óÁý´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("  3  ϴ."));

 		pkItemToDrop->StartDestroyEvent();

 

 		ITEM_MANAGER::instance().FlushDelayedSave(pkItemToDrop);

@@ -8002,7 +8069,7 @@
 	{

 #if defined(__DRAGON_SOUL_SYSTEM__)

 		if (NULL != DragonSoul_RefineWindow_GetOpener())

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­Ã¢À» ¿¬ »óÅÂ¿¡¼­´Â ¾ÆÀÌÅÛÀ» ¿Å±æ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭâ  ¿  ű  ϴ."));

 #endif

 		return false;

 	}

@@ -8069,7 +8136,7 @@
 	{

 		if (get_dword_time() < m_dwLastGoldDropTime + g_GoldDropTimeLimitValue)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ °ñµå¸¦ ¹ö¸± ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" 带   ϴ."));

 			return false;

 		}

 	}

@@ -8087,11 +8154,11 @@
 			//Motion(MOTION_PICKUP);

 			PointChange(POINT_GOLD, -iAmount, true);

 

-			// ºê¶óÁú¿¡ µ·ÀÌ ¾ø¾îÁø´Ù´Â ¹ö±×°¡ ÀÖ´Âµ¥,

-			// °¡´ÉÇÑ ½Ã³ª¸®¿À Áß¿¡ ÇÏ³ª´Â,

-			// ¸ÞÅ©·Î³ª, ÇÙÀ» ½á¼­ 1000¿ø ÀÌÇÏÀÇ µ·À» °è¼Ó ¹ö·Á °ñµå¸¦ 0À¸·Î ¸¸µé°í,

-			// µ·ÀÌ ¾ø¾îÁ³´Ù°í º¹±¸ ½ÅÃ»ÇÏ´Â °ÍÀÏ ¼öµµ ÀÖ´Ù.

-			// µû¶ó¼­ ±×·± °æ¿ì¸¦ Àâ±â À§ÇØ ³·Àº ¼öÄ¡ÀÇ °ñµå¿¡ ´ëÇØ¼­µµ ·Î±×¸¦ ³²±è.

+			//   ٴ װ ִµ,

+			//  ó ߿ ϳ,

+			// ũγ,  Ἥ 1000     带 0 ,

+			//  ٰ  ûϴ   ִ.

+			//  ׷ 츦    ġ 忡 ؼ α׸ .

 			if (LC_IsBrazil() == true)

 			{

 				if (iAmount >= 213)

@@ -8099,19 +8166,19 @@
 			}

 			else

 			{

-				if (iAmount > 1000) // Ãµ¿ø ÀÌ»ó¸¸ ±â·ÏÇÑ´Ù.

+				if (iAmount > 1000) // õ ̻ Ѵ.

 					LogManager::instance().CharLog(this, iAmount, "DROP_GOLD", "");

 			}

 

 			if (false == LC_IsBrazil())

 			{

 				item->StartDestroyEvent(150);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¶³¾îÁø ¾ÆÀÌÅÛÀº %dºÐ ÈÄ »ç¶óÁý´Ï´Ù.", 150 / 60));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  %d  ϴ.", 150 / 60));

 			}

 			else

 			{

 				item->StartDestroyEvent(60);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¶³¾îÁø ¾ÆÀÌÅÛÀº %dºÐ ÈÄ »ç¶óÁý´Ï´Ù.", 1));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  %d  ϴ.", 1));

 			}

 		}

 

@@ -8135,7 +8202,7 @@
 	{

 		if (get_dword_time() < m_dwLastChequeDropTime + g_ChequeDropTimeLimitValue)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ °ñµå¸¦ ¹ö¸± ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" 带   ϴ."));

 			return false;

 		}

 	}

@@ -8158,12 +8225,12 @@
 			if (false == LC_IsBrazil())

 			{

 				item->StartDestroyEvent(150);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¶³¾îÁø ¾ÆÀÌÅÛÀº %dºÐ ÈÄ »ç¶óÁý´Ï´Ù.", 150 / 60));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  %d  ϴ.", 150 / 60));

 			}

 			else

 			{

 				item->StartDestroyEvent(60);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¶³¾îÁø ¾ÆÀÌÅÛÀº %dºÐ ÈÄ »ç¶óÁý´Ï´Ù.", 1));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("  %d  ϴ.", 1));

 			}

 		}

 

@@ -8208,11 +8275,20 @@
 	if (!IsValidItemPosition(DestCell))

 		return false;

 

+#if defined(__EXTEND_INVEN_SYSTEM__)

+	// Prevent moving items into locked extended inventory slots (client/UI desync or packet injection)

+	if (DestCell.window_type == INVENTORY && !DestCell.IsBeltInventoryPosition() && DestCell.cell >= GetExtendInvenMax())

+	{

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("You cannot move items to a locked inventory slot."));

+		return false;

+	}

+#endif

+

 	if (!CanHandleItem())

 	{

 #if defined(__DRAGON_SOUL_SYSTEM__)

 		if (DragonSoul_RefineWindow_GetOpener())

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°­È­Ã¢À» ¿¬ »óÅÂ¿¡¼­´Â ¾ÆÀÌÅÛÀ» ¿Å±æ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȭâ  ¿  ű  ϴ."));

 #endif

 		return false;

 	}

@@ -8230,12 +8306,12 @@
 		// At the request of the planner, only certain types of items can be placed in the belt inventory.

 		if (!CBeltInventoryHelper::CanMoveIntoBeltInventory(item))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº º§Æ® ÀÎº¥Åä¸®·Î ¿Å±æ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ʈ κ丮 ű  ϴ."));

 			return false;

 		}

 	}

 

-	// ÀÌ¹Ì Âø¿ëÁßÀÎ ¾ÆÀÌÅÛÀ» ´Ù¸¥ °÷À¸·Î ¿Å±â´Â °æ¿ì, 'ÀåÃ¥ ÇØÁ¦' °¡´ÉÇÑ Áö È®ÀÎÇÏ°í ¿Å±è

+	// ̹   ٸ  ű , 'å '   Ȯϰ ű

 	if (Cell.IsEquipPosition())

 	{

 		if (!CanUnequipNow(item))

@@ -8261,9 +8337,9 @@
 #if defined(__DRAGON_SOUL_SYSTEM__)

 			&& DestCell.IsDragonSoulEquipPosition()

 #endif

-			) // ÀåºñÀÏ °æ¿ì ÇÑ °÷¸¸ °Ë»çÇØµµ µÈ´Ù.

-		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì Àåºñ¸¦ Âø¿ëÇÏ°í ÀÖ½À´Ï´Ù."));

+			) //     ˻ص ȴ.

+		{

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹  ϰ ֽϴ."));

 			return false;

 		}

 

@@ -8289,7 +8365,7 @@
 					return false;

 			}

 		}

-		// ¿ëÈ¥¼®ÀÌ ¾Æ´Ñ ¾ÆÀÌÅÛÀº ¿ëÈ¥¼® ÀÎº¥¿¡ µé¾î°¥ ¼ö ¾ø´Ù.

+		// ȥ ƴ  ȥ κ   .

 		else if (DRAGON_SOUL_INVENTORY == DestCell.window_type)

 			return false;

 #endif

@@ -8298,7 +8374,7 @@
 

 		if ((item2 = GetItem(DestCell)) && item != item2 && item2->IsStackable() &&

 			!IS_SET(item2->GetAntiFlag(), ITEM_ANTIFLAG_STACK) &&

-			item2->GetVnum() == item->GetVnum() && !item2->IsExchanging()) // ÇÕÄ¥ ¼ö ÀÖ´Â ¾ÆÀÌÅÛÀÇ °æ¿ì

+			item2->GetVnum() == item->GetVnum() && !item2->IsExchanging()) // ĥ  ִ  

 		{

 			for (int i = 0; i < ITEM_SOCKET_MAX_NUM; ++i)

 				if (item2->GetSocket(i) != item->GetSocket(i))

@@ -8311,6 +8387,9 @@
 				DestCell.window_type, DestCell.cell, count);

 

 			count = MIN(ITEM_MAX_COUNT - item2->GetCount(), count);

+

+			if (count == 0)

+				return false;

 

 			item->SetCount(item->GetCount() - count);

 			item2->SetCount(item2->GetCount() + count);

@@ -8345,13 +8424,20 @@
 		{

 			sys_log(0, "%s: ITEM_SPLIT %s (window: %d, cell : %d) -> (window:%d, cell %d) count %d", GetName(), item->GetName(), Cell.window_type, Cell.cell, DestCell.window_type, DestCell.cell, count);

 

-			item->SetCount(item->GetCount() - count);

 			LPITEM item2 = ITEM_MANAGER::instance().CreateItem(item->GetVnum(), count);

+			if (!item2)

+				return false;

 

 			// Copy socket -- by mhh

 			FN_copy_item_socket(item2, item);

 

-			item2->AddToCharacter(this, DestCell);

+			if (!item2->AddToCharacter(this, DestCell))

+			{

+				M2_DESTROY_ITEM(item2);

+				return false;

+			}

+

+			item->SetCount(item->GetCount() - count);

 

 			char szBuf[51 + 1];

 			snprintf(szBuf, sizeof(szBuf), "%u %u %u %u ", item2->GetID(), item2->GetCount(), item->GetCount(), item->GetCount() + item2->GetCount());

@@ -8417,7 +8503,7 @@
 				{

 					ch->PointChange(POINT_GOLD, iMoney, true);

 

-					if (iMoney > 1000) // Ãµ¿ø ÀÌ»ó¸¸ ±â·ÏÇÑ´Ù.

+					if (iMoney > 1000) // õ ̻ Ѵ.

 						LogManager::instance().CharLog(ch, iMoney, "GET_GOLD", "");

 				}

 		}

@@ -8489,7 +8575,7 @@
 	{

 		LPPARTY pParty = GetParty();

 

-		// ÆÄÆ¼°¡ ÀÖ´Â °æ¿ì ³ª´©¾î °¡Áø´Ù.

+		// Ƽ ִ   .

 		DWORD dwTotal = iAmount;

 		DWORD dwMyAmount = dwTotal;

 

@@ -8511,7 +8597,7 @@
 		UpdateExtBattlePassMissionProgress(YANG_COLLECT, dwMyAmount, GetMapIndex());

 #endif

 

-		if (dwMyAmount > 1000) // Ãµ¿ø ÀÌ»ó¸¸ ±â·ÏÇÑ´Ù.

+		if (dwMyAmount > 1000) // õ ̻ Ѵ.

 			LogManager::instance().CharLog(this, dwMyAmount, "GET_GOLD", "");

 	}

 	else

@@ -8522,11 +8608,11 @@
 		UpdateExtBattlePassMissionProgress(YANG_COLLECT, iAmount, GetMapIndex());

 #endif

 

-		// ºê¶óÁú¿¡ µ·ÀÌ ¾ø¾îÁø´Ù´Â ¹ö±×°¡ ÀÖ´Âµ¥,

-		// °¡´ÉÇÑ ½Ã³ª¸®¿À Áß¿¡ ÇÏ³ª´Â,

-		// ¸ÞÅ©·Î³ª, ÇÙÀ» ½á¼­ 1000¿ø ÀÌÇÏÀÇ µ·À» °è¼Ó ¹ö·Á °ñµå¸¦ 0À¸·Î ¸¸µé°í,

-		// µ·ÀÌ ¾ø¾îÁ³´Ù°í º¹±¸ ½ÅÃ»ÇÏ´Â °ÍÀÏ ¼öµµ ÀÖ´Ù.

-		// µû¶ó¼­ ±×·± °æ¿ì¸¦ Àâ±â À§ÇØ ³·Àº ¼öÄ¡ÀÇ °ñµå¿¡ ´ëÇØ¼­µµ ·Î±×¸¦ ³²±è.

+		//   ٴ װ ִµ,

+		//  ó ߿ ϳ,

+		// ũγ,  Ἥ 1000     带 0 ,

+		//  ٰ  ûϴ   ִ.

+		//  ׷ 츦    ġ 忡 ؼ α׸ .

 		if (LC_IsBrazil() == true)

 		{

 			if (iAmount >= 213)

@@ -8534,7 +8620,7 @@
 		}

 		else

 		{

-			if (iAmount > 1000) // Ãµ¿ø ÀÌ»ó¸¸ ±â·ÏÇÑ´Ù.

+			if (iAmount > 1000) // õ ̻ Ѵ.

 				LogManager::instance().CharLog(this, iAmount, "GET_GOLD", "");

 		}

 	}

@@ -8694,7 +8780,7 @@
 			}

 #endif

 

-			// ¸¸¾à ÁÖÀ¸·Á ÇÏ´Â ¾ÆÀÌÅÛÀÌ ¿¤Å©¶ó¸é

+			//   ϴ  ũ

 			if (item->GetType() == ITEM_ELK)

 			{

 				GiveGold(item->GetCount());

@@ -8704,7 +8790,7 @@
 

 				Save();

 			}

-			// Æò¹üÇÑ ¾ÆÀÌÅÛÀÌ¶ó¸é

+			//  ̶

 			else

 			{

 				if (item->IsStackable() && !IS_SET(item->GetAntiFlag(), ITEM_ANTIFLAG_STACK))

@@ -8741,15 +8827,15 @@
 							{

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-								ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

+								ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

 #else

-								ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item2->GetVnum())));

+								ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item2->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

 #else

-								ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item2->GetVnum())));

+								ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item2->GetVnum())));

 #endif

 #endif

 								M2_DESTROY_ITEM(item);

@@ -8772,7 +8858,7 @@
 					if ((iEmptyCell = GetEmptyDragonSoulInventory(item)) == -1)

 					{

 						sys_log(0, "No empty ds inventory pid %u size %ud itemid %u", GetPlayerID(), item->GetSize(), item->GetID());

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇÏ°í ÀÖ´Â ¾ÆÀÌÅÛÀÌ ³Ê¹« ¸¹½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ϰ ִ  ʹ ϴ."));

 						return false;

 					}

 				}

@@ -8782,7 +8868,7 @@
 					if ((iEmptyCell = GetEmptyInventory(item->GetSize())) == -1)

 					{

 						sys_log(0, "No empty inventory pid %u size %ud itemid %u", GetPlayerID(), item->GetSize(), item->GetID());

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇÏ°í ÀÖ´Â ¾ÆÀÌÅÛÀÌ ³Ê¹« ¸¹½À´Ï´Ù."));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING("ϰ ִ  ʹ ϴ."));

 						return false;

 					}

 				}

@@ -8802,15 +8888,15 @@
 

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #endif

 

@@ -8826,7 +8912,7 @@
 		}

 		else if (!IS_SET(item->GetAntiFlag(), ITEM_ANTIFLAG_GIVE | ITEM_ANTIFLAG_DROP) && GetParty())

 		{

-			// ´Ù¸¥ ÆÄÆ¼¿ø ¼ÒÀ¯±Ç ¾ÆÀÌÅÛÀ» ÁÖÀ¸·Á°í ÇÑ´Ù¸é

+			// ٸ Ƽ    Ѵٸ

 			NPartyPickupDistribute::FFindOwnership funcFindOwnership(item);

 			GetParty()->ForEachOnMapMember(funcFindOwnership, GetMapIndex());

 

@@ -8844,7 +8930,7 @@
 

 					if ((iEmptyCell = GetEmptyDragonSoulInventory(item)) == -1)

 					{

-						owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇÏ°í ÀÖ´Â ¾ÆÀÌÅÛÀÌ ³Ê¹« ¸¹½À´Ï´Ù."));

+						owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ϰ ִ  ʹ ϴ."));

 						return false;

 					}

 				}

@@ -8858,7 +8944,7 @@
 

 					if ((iEmptyCell = GetEmptyInventory(item->GetSize())) == -1)

 					{

-						owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇÏ°í ÀÖ´Â ¾ÆÀÌÅÛÀÌ ³Ê¹« ¸¹½À´Ï´Ù."));

+						owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ϰ ִ  ʹ ϴ."));

 						return false;

 					}

 				}

@@ -8898,15 +8984,15 @@
 						{

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-							owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

+							owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

 #else

-							owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item2->GetVnum())));

+							owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item2->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-							owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

+							owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item2->GetItemSetValue(), item2->GetVnum())));

 #else

-							owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item2->GetVnum())));

+							owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item2->GetVnum())));

 #endif

 #endif

 							M2_DESTROY_ITEM(item);

@@ -8969,15 +9055,15 @@
 			{

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #endif

 			}

@@ -8985,19 +9071,19 @@
 			{

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-				owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s ´ÔÀ¸·ÎºÎÅÍ %s", GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

-				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ Àü´Þ: %s ´Ô¿¡°Ô %s", owner->GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s κ %s", GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" : %s Կ %s", owner->GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-				owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s ´ÔÀ¸·ÎºÎÅÍ %s", GetName(), LC_ITEM(item->GetVnum())));

-				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ Àü´Þ: %s ´Ô¿¡°Ô %s", owner->GetName(), LC_ITEM(item->GetVnum())));

+				owner->ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s κ %s", GetName(), LC_ITEM(item->GetVnum())));

+				ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" : %s Կ %s", owner->GetName(), LC_ITEM(item->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-				owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s ´ÔÀ¸·ÎºÎÅÍ %s", GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ Àü´Þ: %s ´Ô¿¡°Ô %s", owner->GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s κ %s", GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" : %s Կ %s", owner->GetName(), LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-				owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s ´ÔÀ¸·ÎºÎÅÍ %s", GetName(), LC_ITEM(item->GetVnum())));

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ Àü´Þ: %s ´Ô¿¡°Ô %s", owner->GetName(), LC_ITEM(item->GetVnum())));

+				owner->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s κ %s", GetName(), LC_ITEM(item->GetVnum())));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" : %s Կ %s", owner->GetName(), LC_ITEM(item->GetVnum())));

 #endif

 #endif

 			}

@@ -9015,7 +9101,7 @@
 	return false;

 }

 

-// ±ÍÂú¾Æ¼­ ¸¸µç ¸ÅÅ©·Î.. exp°¡ true¸é msg¸¦ Ãâ·ÂÇÏ°í return false ÇÏ´Â ¸ÅÅ©·Î (ÀÏ¹ÝÀûÀÎ verify ¿ëµµ¶ûÀº return ¶§¹®¿¡ ¾à°£ ¹Ý´ë¶ó ÀÌ¸§¶§¹®¿¡ Çò°¥¸± ¼öµµ ÀÖ°Ú´Ù..)

+// Ƽ  ũ.. exp true msg ϰ return false ϴ ũ (Ϲ verify 뵵 return  ణ ݴ ̸ 򰥸  ְڴ..)

 #define VERIFY_MSG(exp, msg) \

 	if (true == (exp)) \

 	{ \

@@ -9030,21 +9116,21 @@
 

 	const TItemPos srcCell(INVENTORY, wCell), destCell(EQUIPMENT, wDestCell);

 

-	// ¿Ã¹Ù¸¥ Cell ÀÎÁö °Ë»ç

-	// ¿ëÈ¥¼®Àº SwapÇÒ ¼ö ¾øÀ¸¹Ç·Î, ¿©±â¼­ °É¸².

+	// ùٸ Cell  ˻

+	// ȥ Swap  Ƿ, ⼭ ɸ.

 	//if (bCell >= INVENTORY_MAX_NUM + WEAR_MAX_NUM || bDestCell >= INVENTORY_MAX_NUM + WEAR_MAX_NUM)

 #if defined(__DRAGON_SOUL_SYSTEM__)

 	if (srcCell.IsDragonSoulEquipPosition() || destCell.IsDragonSoulEquipPosition())

 		return false;

 #endif

 

-	// µÑ ´Ù ÀåºñÃ¢ À§Ä¡¸é Swap ÇÒ ¼ö ¾ø´Ù.

+	//   â ġ Swap   .

 	if (srcCell.IsEquipPosition() && destCell.IsEquipPosition())

 		return false;

 

 	LPITEM item1 = nullptr, item2 = nullptr;

 

-	// item2°¡ ÀåºñÃ¢¿¡ ÀÖ´Â °ÍÀÌ µÇµµ·Ï.

+	// item2 â ִ  ǵ.

 	if (srcCell.IsEquipPosition())

 	{

 		item1 = GetEquipmentItem(wDestCell);

@@ -9065,11 +9151,11 @@
 		return false;

 	}

 

-	// item2°¡ bCellÀ§Ä¡¿¡ µé¾î°¥ ¼ö ÀÖ´ÂÁö È®ÀÎÇÑ´Ù.

+	// item2 bCellġ   ִ ȮѴ.

 	if (!IsEmptyItemGrid(TItemPos(INVENTORY, item1->GetCell()), item2->GetSize(), item1->GetCell()))

 		return false;

 

-	// ¹Ù²Ü ¾ÆÀÌÅÛÀÌ ÀåºñÃ¢¿¡ ÀÖÀ¸¸é

+	// ٲ  â 

 	if (TItemPos(EQUIPMENT, item2->GetCell()).IsEquipPosition())

 	{

 		const WORD wEquipCell = item2->GetCell();

@@ -9170,7 +9256,7 @@
 }

 

 //

-// @version 05/07/05 Bang2ni - Skill »ç¿ëÈÄ 1.5 ÃÊ ÀÌ³»¿¡ Àåºñ Âø¿ë ±ÝÁö

+// @version 05/07/05 Bang2ni - Skill  1.5  ̳   

 //

 bool CHARACTER::EquipItem(LPITEM item, int iCandidateCell)

 {

@@ -9188,22 +9274,22 @@
 	if (iWearCell < 0)

 		return false;

 

-	// ¹«¾ð°¡¸¦ Åº »óÅÂ¿¡¼­ ÅÎ½Ãµµ ÀÔ±â ±ÝÁö

+	// 𰡸 ź ¿ νõ Ա 

 	if (iWearCell == WEAR_BODY && IsRiding() && (item->GetVnum() >= 11901 && item->GetVnum() <= 11904))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸»À» Åº »óÅÂ¿¡¼­ ¿¹º¹À» ÀÔÀ» ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ź ¿    ϴ."));

 		return false;

 	}

 

 	if (iWearCell != WEAR_ARROW && IsPolymorphed())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("µÐ°© Áß¿¡´Â Âø¿ëÁßÀÎ Àåºñ¸¦ º¯°æÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("а ߿     ϴ."));

 		return false;

 	}

 

 	if (FN_check_item_sex(this, item) == false)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ºº°ÀÌ ¸ÂÁö¾Ê¾Æ ÀÌ ¾ÆÀÌÅÛÀ» »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʾ     ϴ."));

 		return false;

 	}

 

@@ -9233,18 +9319,18 @@
 #	endif

 #endif

 

-	// ½Å±Ô Å»°Í »ç¿ë½Ã ±âÁ¸ ¸» »ç¿ë¿©ºÎ Ã¼Å©

+	// ű Ż    뿩 üũ

 	if (item->IsRideItem())

 	{

 		if (IsRiding())

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì Å»°ÍÀ» ÀÌ¿ëÁßÀÔ´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ Ż ̿Դϴ."));

 			return false;

 		}

 

 		if (IsPolymorphed())

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("º¯½Å »óÅÂ¿¡¼­´Â ¸»¿¡ Å» ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ¿  Ż  ϴ."));

 			return false;

 		}

 

@@ -9258,7 +9344,7 @@
 #endif

 	}

 

-	// È­»ì ÀÌ¿Ü¿¡´Â ¸¶Áö¸· °ø°Ý ½Ã°£ ¶Ç´Â ½ºÅ³ »ç¿ë 1.5 ÈÄ¿¡ Àåºñ ±³Ã¼°¡ °¡´É

+	// ȭ ̿ܿ   ð Ǵ ų  1.5 Ŀ  ü 

 	DWORD dwCurTime = get_dword_time();

 

 #if defined(__MOUNT_COSTUME_SYSTEM__)

@@ -9269,7 +9355,7 @@
 		&& (dwCurTime - GetLastAttackTime() <= 1500 || dwCurTime - m_dwLastSkillTime <= 1500))

 #endif

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("°¡¸¸È÷ ÀÖÀ» ¶§¸¸ Âø¿ëÇÒ ¼ö ÀÖ½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("     ֽϴ."));

 		return false;

 	}

 

@@ -9315,14 +9401,14 @@
 #endif

 

 #if defined(__DRAGON_SOUL_SYSTEM__)

-	// ¿ëÈ¥¼® Æ¯¼ö Ã³¸®

+	// ȥ Ư ó

 	if (item->IsDragonSoul())

 	{

-		// °°Àº Å¸ÀÔÀÇ ¿ëÈ¥¼®ÀÌ ÀÌ¹Ì µé¾î°¡ ÀÖ´Ù¸é Âø¿ëÇÒ ¼ö ¾ø´Ù.

-		// ¿ëÈ¥¼®Àº swapÀ» Áö¿øÇÏ¸é ¾ÈµÊ.

+		//  Ÿ ȥ ̹  ִٸ   .

+		// ȥ swap ϸ ȵ.

 		if (GetEquipmentItem(iWearCell))

 		{

-			ChatPacket(CHAT_TYPE_INFO, "ÀÌ¹Ì °°Àº Á¾·ùÀÇ ¿ëÈ¥¼®À» Âø¿ëÇÏ°í ÀÖ½À´Ï´Ù.");

+			ChatPacket(CHAT_TYPE_INFO, "̹   ȥ ϰ ֽϴ.");

 			return false;

 		}

 

@@ -9331,14 +9417,14 @@
 			return false;

 		}

 	}

-	// ¿ëÈ¥¼®ÀÌ ¾Æ´Ô.

+	// ȥ ƴ.

 	else

 #endif

 	{

-		// Âø¿ëÇÒ °÷¿¡ ¾ÆÀÌÅÛÀÌ ÀÖ´Ù¸é,

+		//    ִٸ,

 		if (GetWear(iWearCell) && !IS_SET(GetWear(iWearCell)->GetFlag(), ITEM_FLAG_IRREMOVABLE))

 		{

-			// ÀÌ ¾ÆÀÌÅÛÀº ÇÑ¹ø ¹ÚÈ÷¸é º¯°æ ºÒ°¡. swap ¿ª½Ã ¿ÏÀü ºÒ°¡

+			//   ѹ   Ұ. swap   Ұ

 			//if (item->GetWearFlag() == WEARABLE_ABILITY)

 			//	return false;

 

@@ -9356,13 +9442,13 @@
 

 	if (true == item->IsEquipped())

 	{

-		// ¾ÆÀÌÅÛ ÃÖÃÊ »ç¿ë ÀÌÈÄºÎÅÍ´Â »ç¿ëÇÏÁö ¾Ê¾Æµµ ½Ã°£ÀÌ Â÷°¨µÇ´Â ¹æ½Ä Ã³¸®.

+		//    ĺʹ  ʾƵ ð Ǵ  ó.

 		if (-1 != item->GetProto()->cLimitRealTimeFirstUseIndex)

 		{

-			// ÇÑ ¹øÀÌ¶óµµ »ç¿ëÇÑ ¾ÆÀÌÅÛÀÎÁö ¿©ºÎ´Â Socket1À» º¸°í ÆÇ´ÜÇÑ´Ù. (Socket1¿¡ »ç¿ëÈ½¼ö ±â·Ï)

+			//  ̶   δ Socket1  ǴѴ. (Socket1 Ƚ )

 			if (0 == item->GetSocket(1))

 			{

-				// »ç¿ë°¡´É½Ã°£Àº Default °ªÀ¸·Î Limit Value °ªÀ» »ç¿ëÇÏµÇ, Socket0¿¡ °ªÀÌ ÀÖÀ¸¸é ±× °ªÀ» »ç¿ëÇÏµµ·Ï ÇÑ´Ù. (´ÜÀ§´Â ÃÊ)

+				// 밡ɽð Default  Limit Value  ϵ, Socket0     ϵ Ѵ. ( )

 				long duration = (0 != item->GetSocket(0)) ? item->GetSocket(0) : item->GetProto()->aLimits[(BYTE)item->GetProto()->cLimitRealTimeFirstUseIndex].lValue;

 

 				if (0 == duration)

@@ -9387,27 +9473,27 @@
 

 		const DWORD& dwVnum = item->GetVnum();

 

-		// ¶ó¸¶´Ü ÀÌº¥Æ® ÃÊ½Â´ÞÀÇ ¹ÝÁö(71135) Âø¿ë½Ã ÀÌÆåÆ® ¹ßµ¿

+		// 󸶴 ̺Ʈ ʽ´ (71135)  Ʈ ߵ

 		if (true == CItemVnumHelper::IsRamadanMoonRing(dwVnum))

 		{

 			this->EffectPacket(SE_EQUIP_RAMADAN_RING);

 		}

-		// ÇÒ·ÎÀ© »çÅÁ(71136) Âø¿ë½Ã ÀÌÆåÆ® ¹ßµ¿

+		// ҷ (71136)  Ʈ ߵ

 		else if (true == CItemVnumHelper::IsHalloweenCandy(dwVnum))

 		{

 			this->EffectPacket(SE_EQUIP_HALLOWEEN_CANDY);

 		}

-		// Çàº¹ÀÇ ¹ÝÁö(71143) Âø¿ë½Ã ÀÌÆåÆ® ¹ßµ¿

+		// ູ (71143)  Ʈ ߵ

 		else if (true == CItemVnumHelper::IsHappinessRing(dwVnum))

 		{

 			this->EffectPacket(SE_EQUIP_HAPPINESS_RING);

 		}

-		// »ç¶ûÀÇ ÆÒ´øÆ®(71145) Âø¿ë½Ã ÀÌÆåÆ® ¹ßµ¿

+		//  ҴƮ(71145)  Ʈ ߵ

 		else if (true == CItemVnumHelper::IsLovePendant(dwVnum))

 		{

 			this->EffectPacket(SE_EQUIP_LOVE_PENDANT);

 		}

-		// ITEM_UNIQUEÀÇ °æ¿ì, SpecialItemGroup¿¡ Á¤ÀÇµÇ¾î ÀÖ°í, (item->GetSIGVnum() != NULL)

+		// ITEM_UNIQUE , SpecialItemGroup ǵǾ ְ, (item->GetSIGVnum() != NULL)

 		//

 		else if ((ITEM_UNIQUE == item->GetType() || ITEM_RING == item->GetType()) && 0 != item->GetSIGVnum())

 		{

@@ -9636,7 +9722,7 @@
 		pItem = GetInventoryItem(wCell);

 		if (pItem && pItem->GetVnum() == vnum)

 		{

-			// °³ÀÎ »óÁ¡¿¡ µî·ÏµÈ ¹°°ÇÀÌ¸é ³Ñ¾î°£´Ù.

+			//   ϵ ̸ Ѿ.

 			if (m_pkMyShop && m_pkMyShop->IsSellingItem(pItem->GetID()))

 				continue;

 

@@ -9710,7 +9796,7 @@
 			continue;

 #endif

 

-		//°³ÀÎ »óÁ¡¿¡ µî·ÏµÈ ¹°°ÇÀÌ¸é ³Ñ¾î°£´Ù. (°³ÀÎ »óÁ¡¿¡¼­ ÆÇ¸ÅµÉ¶§ ÀÌ ºÎºÐÀ¸·Î µé¾î¿Ã °æ¿ì ¹®Á¦!)

+		//  ϵ ̸ Ѿ. (  Ǹŵɶ  κ   !)

 		if (m_pkMyShop)

 		{

 			bool isItemSelling = m_pkMyShop->IsSellingItem(GetInventoryItem(i)->GetID());

@@ -9771,7 +9857,7 @@
 	}

 #endif

 

-	// ¿¹¿ÜÃ³¸®°¡ ¾àÇÏ´Ù.

+	// ó ϴ.

 	if (count)

 		sys_log(0, "CHARACTER::RemoveSpecifyItem cannot remove enough item vnum %u, still remain %d", vnum, count);

 }

@@ -9813,7 +9899,7 @@
 		if (GetInventoryItem(i)->GetType() != type)

 			continue;

 

-		//°³ÀÎ »óÁ¡¿¡ µî·ÏµÈ ¹°°ÇÀÌ¸é ³Ñ¾î°£´Ù. (°³ÀÎ »óÁ¡¿¡¼­ ÆÇ¸ÅµÉ¶§ ÀÌ ºÎºÐÀ¸·Î µé¾î¿Ã °æ¿ì ¹®Á¦!)

+		//  ϵ ̸ Ѿ. (  Ǹŵɶ  κ   !)

 		if (m_pkMyShop)

 		{

 			bool isItemSelling = m_pkMyShop->IsSellingItem(GetInventoryItem(i)->GetID());

@@ -9932,15 +10018,15 @@
 					{

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #	if defined(__SET_ITEM__)

-						ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+						ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #	else

-						ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+						ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #	endif

 #else

 #	if defined(__SET_ITEM__)

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #	else

-						ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+						ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #	endif

 #endif

 					}

@@ -10010,15 +10096,15 @@
 		if (bMsg)

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #endif

 

@@ -10051,9 +10137,9 @@
 

 		item->AddToGround(GetMapIndex(), GetXYZ());

 		item->StartDestroyEvent();

-		// ¾ÈÆ¼ µå¶ø flag°¡ °É·ÁÀÖ´Â ¾ÆÀÌÅÛÀÇ °æ¿ì,

-		// ÀÎº¥¿¡ ºó °ø°£ÀÌ ¾ø¾î¼­ ¾îÂ¿ ¼ö ¾øÀÌ ¶³¾îÆ®¸®°Ô µÇ¸é,

-		// ownershipÀ» ¾ÆÀÌÅÛÀÌ »ç¶óÁú ¶§±îÁö(300ÃÊ) À¯ÁöÇÑ´Ù.

+		// Ƽ  flag ɷִ  ,

+		// κ    ¿   Ʈ Ǹ,

+		// ownership   (300) Ѵ.

 		if (IS_SET(item->GetAntiFlag(), ITEM_ANTIFLAG_DROP))

 			item->SetOwnership(this, 300);

 		else

@@ -10124,15 +10210,15 @@
 				if (bMsg)

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-					ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+					ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-					ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+					ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #endif

 

@@ -10174,15 +10260,15 @@
 		if (bMsg)

 #if defined(__CHATTING_WINDOW_RENEWAL__)

 #if defined(__SET_ITEM__)

-			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+			ChatPacket(CHAT_TYPE_ITEM_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #else

 #if defined(__SET_ITEM__)

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_PRE_ITEM(item->GetItemSetValue(), item->GetVnum())));

 #else

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛ È¹µæ: %s", LC_ITEM(item->GetVnum())));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȹ: %s", LC_ITEM(item->GetVnum())));

 #endif

 #endif

 

@@ -10337,12 +10423,12 @@
 		case 20102:

 		case 20103:

 		{

-			// ÃÊ±Þ ¸»

+			// ʱ 

 			if (item->GetVnum() == ITEM_REVIVE_HORSE_1)

 			{

 				if (!IsDead())

 				{

-					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á×Áö ¾ÊÀº ¸»¿¡°Ô ¼±ÃÊ¸¦ ¸ÔÀÏ ¼ö ¾ø½À´Ï´Ù."));

+					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ʸ   ϴ."));

 					return false;

 				}

 				return true;

@@ -10351,7 +10437,7 @@
 			{

 				if (IsDead())

 				{

-					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á×Àº ¸»¿¡°Ô »ç·á¸¦ ¸ÔÀÏ ¼ö ¾ø½À´Ï´Ù."));

+					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ḧ   ϴ."));

 					return false;

 				}

 				return true;

@@ -10367,12 +10453,12 @@
 		case 20105:

 		case 20106:

 		{

-			// Áß±Þ ¸»

+			// ߱ 

 			if (item->GetVnum() == ITEM_REVIVE_HORSE_2)

 			{

 				if (!IsDead())

 				{

-					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á×Áö ¾ÊÀº ¸»¿¡°Ô ¼±ÃÊ¸¦ ¸ÔÀÏ ¼ö ¾ø½À´Ï´Ù."));

+					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ʸ   ϴ."));

 					return false;

 				}

 				return true;

@@ -10381,7 +10467,7 @@
 			{

 				if (IsDead())

 				{

-					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á×Àº ¸»¿¡°Ô »ç·á¸¦ ¸ÔÀÏ ¼ö ¾ø½À´Ï´Ù."));

+					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ḧ   ϴ."));

 					return false;

 				}

 				return true;

@@ -10397,12 +10483,12 @@
 		case 20108:

 		case 20109:

 		{

-			// °í±Þ ¸»

+			//  

 			if (item->GetVnum() == ITEM_REVIVE_HORSE_3)

 			{

 				if (!IsDead())

 				{

-					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á×Áö ¾ÊÀº ¸»¿¡°Ô ¼±ÃÊ¸¦ ¸ÔÀÏ ¼ö ¾ø½À´Ï´Ù."));

+					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("   ʸ   ϴ."));

 					return false;

 				}

 				return true;

@@ -10411,7 +10497,7 @@
 			{

 				if (IsDead())

 				{

-					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á×Àº ¸»¿¡°Ô »ç·á¸¦ ¸ÔÀÏ ¼ö ¾ø½À´Ï´Ù."));

+					from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ḧ   ϴ."));

 					return false;

 				}

 				return true;

@@ -10502,7 +10588,7 @@
 			}

 			else

 			{

-				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 			}

 		}

 		break;

@@ -10521,7 +10607,7 @@
 			}

 			else

 			{

-				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ ¾ÆÀÌÅÛÀº °³·®ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 			}

 		}

 		break;

@@ -10542,14 +10628,14 @@
 			{

 				from->ReviveHorse();

 				item->SetCount(item->GetCount() - 1);

-				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸»¿¡°Ô ¼±ÃÊ¸¦ ÁÖ¾ú½À´Ï´Ù."));

+				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʸ ־ϴ."));

 			}

 			else if (item->GetVnum() == ITEM_HORSE_FOOD_1 ||

 				item->GetVnum() == ITEM_HORSE_FOOD_2 ||

 				item->GetVnum() == ITEM_HORSE_FOOD_3)

 			{

 				from->FeedHorse();

-				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¸»¿¡°Ô »ç·á¸¦ ÁÖ¾ú½À´Ï´Ù."));

+				from->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ḧ ־ϴ."));

 				item->SetCount(item->GetCount() - 1);

 				EffectPacket(SE_HPUP_RED);

 			}

@@ -10689,7 +10775,7 @@
 					ChatPacket(CHAT_TYPE_INFO, LC_STRING("This doesn't seem to work here."));

 					return false;

 				}

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÀÚ¿¡¼­ ¸ó½ºÅÍ°¡ ³ªÅ¸³µ½À´Ï´Ù!"));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ڿ Ͱ Ÿϴ!"));

 				bSuccess = true;

 			}

 			break;

@@ -10698,7 +10784,7 @@
 			{

 				sys_log(0, "CSpecialItemGroup::SLOW %d", -(int)dwCount);

 				AddAffect(AFFECT_SLOW, POINT_MOV_SPEED, -(int)dwCount, AFF_SLOW, 300, 0, true);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÀÚ¿¡¼­ ³ª¿Â »¡°£ ¿¬±â¸¦ µéÀÌ¸¶½ÃÀÚ ¿òÁ÷ÀÌ´Â ¼Óµµ°¡ ´À·ÁÁ³½À´Ï´Ù!"));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ڿ   ⸦ ̸ ̴ ӵ ϴ!"));

 				bSuccess = true;

 			}

 			break;

@@ -10710,7 +10796,7 @@
 				iDropHP = MIN(iDropHP, GetHP() - 1);

 				sys_log(0, "CSpecialItemGroup::DRAIN_HP %d", -iDropHP);

 				PointChange(POINT_HP, -iDropHP);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÀÚ°¡ °©ÀÚ±â Æø¹ßÇÏ¿´½À´Ï´Ù! »ý¸í·ÂÀÌ °¨¼ÒÇß½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ڰ ڱ Ͽϴ!  ߽ϴ."));

 				bSuccess = true;

 			}

 			break;

@@ -10718,7 +10804,7 @@
 			case CSpecialItemGroup::POISON:

 			{

 				AttackedByPoison(NULL);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÀÚ¿¡¼­ ³ª¿Â ³ì»ö ¿¬±â¸¦ µéÀÌ¸¶½ÃÀÚ µ¶ÀÌ ¿Â¸öÀ¸·Î ÆÛÁý´Ï´Ù!"));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ڿ   ⸦ ̸  ¸ ϴ!"));

 				bSuccess = true;

 			}

 			break;

@@ -10726,7 +10812,7 @@
 			case CSpecialItemGroup::BLEEDING:

 			{

 				AttackedByBleeding(NULL);

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÀÚ¿¡¼­ ³ª¿Â »¡°£ ¿¬±â¸¦ µéÀÌ¸¶½ÃÀÚ ¿òÁ÷ÀÌ´Â ¼Óµµ°¡ ´À·ÁÁ³½À´Ï´Ù!"));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ڿ   ⸦ ̸ ̴ ӵ ϴ!"));

 				bSuccess = true;

 			}

 			break;

@@ -10743,7 +10829,7 @@
 					ChatPacket(CHAT_TYPE_INFO, LC_STRING("This doesn't seem to work here."));

 					return false;

 				}

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÀÚ¿¡¼­ ¸ó½ºÅÍ°¡ ³ªÅ¸³µ½À´Ï´Ù!"));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING("ڿ Ͱ Ÿϴ!"));

 				bSuccess = true;

 			}

 			break;

@@ -10763,7 +10849,7 @@
 

 		if (!bSuccess)

 		{

-			ChatPacket(CHAT_TYPE_TALKING, LC_STRING("¾Æ¹«°Íµµ ¾òÀ» ¼ö ¾ø¾ú½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_TALKING, LC_STRING("ƹ͵   ϴ."));

 			return false;

 		}

 	}

@@ -10775,8 +10861,8 @@
 {

 	if (item->CheckItemUseLevel(GetLevel()) == false)

 	{

-		// ·¹º§ Á¦ÇÑ¿¡ °É¸²

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÁ÷ ÀÌ ¸Ó¸®¸¦ »ç¿ëÇÒ ¼ö ¾ø´Â ·¹º§ÀÔ´Ï´Ù."));

+		//  ѿ ɸ

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("  Ӹ    Դϴ."));

 		return false;

 	}

 

@@ -10785,7 +10871,7 @@
 	switch (GetJob())

 	{

 		case JOB_WARRIOR:

-			hair -= 72000; // 73001 - 72000 = 1001 ºÎÅÍ Çì¾î ¹øÈ£ ½ÃÀÛ

+			hair -= 72000; // 73001 - 72000 = 1001   ȣ 

 			break;

 

 		case JOB_ASSASSIN:

@@ -10810,7 +10896,7 @@
 

 	if (hair == GetPart(PART_HAIR))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("µ¿ÀÏÇÑ ¸Ó¸® ½ºÅ¸ÀÏ·Î´Â ±³Ã¼ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ӹ ŸϷδ ü  ϴ."));

 		return true;

 	}

 

@@ -10827,21 +10913,26 @@
 {

 	if (IsPolymorphed())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì µÐ°©ÁßÀÎ »óÅÂÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ а Դϴ."));

 		return false;

 	}

 

 	if (true == IsRiding())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("µÐ°©ÇÒ ¼ö ¾ø´Â »óÅÂÀÔ´Ï´Ù."));

-		return false;

+		// [BUNDLE_15][Fix] Prevent mount bonus/stat stacking with polymorph by forcing dismount

+		StopRiding();

+		if (true == IsRiding())

+		{

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("а   Դϴ."));

+			return false;

+		}

 	}

 

 	DWORD dwVnum = item->GetSocket(0);

 

 	if (dwVnum == 0)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("Àß¸øµÈ µÐ°© ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("߸ а Դϴ."));

 		item->SetCount(item->GetCount() - 1);

 		return false;

 	}

@@ -10850,7 +10941,7 @@
 

 	if (pMob == NULL)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("Àß¸øµÈ µÐ°© ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("߸ а Դϴ."));

 		item->SetCount(item->GetCount() - 1);

 		return false;

 	}

@@ -10863,14 +10954,14 @@
 		case 70107: // Polymorph Marble

 		case 71093: // Polymorph Marble

 		{

-			// µÐ°©±¸ Ã³¸®

+			// а ó

 			sys_log(0, "USE_POLYMORPH_BALL PID(%d) vnum(%d)", GetPlayerID(), dwVnum);

 

-			// ·¹º§ Á¦ÇÑ Ã¼Å©

+			//   üũ

 			int iPolymorphLevelLimit = MAX(0, 20 - GetLevel() * 3 / 10);

 			if (pMob->m_table.bLevel >= GetLevel() + iPolymorphLevelLimit)

 			{

-				ChatPacket(CHAT_TYPE_INFO, LC_STRING("³ªº¸´Ù ³Ê¹« ³ôÀº ·¹º§ÀÇ ¸ó½ºÅÍ·Î´Â º¯½Å ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+				ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ʹ   ͷδ    ϴ."));

 				return false;

 			}

 

@@ -10897,11 +10988,11 @@
 

 		case 50322: // Transformation Role

 		{

-			// º¸·ù

-

-			// µÐ°©¼­ Ã³¸®

-			// ¼ÒÄÏ0 ¼ÒÄÏ1 ¼ÒÄÏ2

-			// µÐ°©ÇÒ ¸ó½ºÅÍ ¹øÈ£ ¼ö·ÃÁ¤µµ µÐ°©¼­ ·¹º§

+			// 

+

+			// а ó

+			// 0 1 2

+			// а  ȣ  а 

 			sys_log(0, "USE_POLYMORPH_BOOK: %s(%u) vnum(%u)", GetName(), GetPlayerID(), dwVnum);

 

 			if (CPolymorphUtils::instance().PolymorphCharacter(this, item, pMob) == true)

@@ -11036,8 +11127,8 @@
 						const int pct_of_will_used = (amount_of_used + amount) * 100 / amount_of_full;

 

 						bool bLog = false;

-						// »ç¿ë·®ÀÇ 10% ´ÜÀ§·Î ·Î±×¸¦ ³²±è

-						// (»ç¿ë·®ÀÇ %¿¡¼­, ½ÊÀÇ ÀÚ¸®°¡ ¹Ù²ð ¶§¸¶´Ù ·Î±×¸¦ ³²±è.)

+						// 뷮 10%  α׸ 

+						// (뷮 %,  ڸ ٲ  α׸ .)

 						if ((pct_of_will_used / 10) - (pct_of_used / 10) >= 1)

 							bLog = true;

 						pItem->SetSocket(idx_of_amount_of_used, amount_of_used + amount, bLog);

@@ -11133,7 +11224,7 @@
 	}

 }

 

-/// ÇöÀç Ä³¸¯ÅÍÀÇ »óÅÂ¸¦ ¹ÙÅÁÀ¸·Î ÁÖ¾îÁø itemÀ» Âø¿ëÇÒ ¼ö ÀÖ´Â Áö È®ÀÎÇÏ°í, ºÒ°¡´É ÇÏ´Ù¸é Ä³¸¯ÅÍ¿¡°Ô ÀÌÀ¯¸¦ ¾Ë·ÁÁÖ´Â ÇÔ¼ö

+///  ĳ ¸  ־ item   ִ  Ȯϰ, Ұ ϴٸ ĳͿ  ˷ִ Լ

 bool CHARACTER::CanEquipNow(const LPITEM item, const TItemPos& srcCell, const TItemPos& destCell) /*const*/

 {

 	if (IsFishing())

@@ -11184,7 +11275,7 @@
 			{

 				if (GetLevel() < limit)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("·¹º§ÀÌ ³·¾Æ Âø¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 					return false;

 				}

 			}

@@ -11195,7 +11286,7 @@
 			{

 				if (GetConquerorLevel() < limit)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("·¹º§ÀÌ ³·¾Æ Âø¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 					return false;

 				}

 			}

@@ -11206,7 +11297,7 @@
 			{

 				if (GetPoint(POINT_ST) < limit)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("±Ù·ÂÀÌ ³·¾Æ Âø¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٷ    ϴ."));

 					return false;

 				}

 			}

@@ -11216,7 +11307,7 @@
 			{

 				if (GetPoint(POINT_IQ) < limit)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("Áö´ÉÀÌ ³·¾Æ Âø¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("    ϴ."));

 					return false;

 				}

 			}

@@ -11226,7 +11317,7 @@
 			{

 				if (GetPoint(POINT_DX) < limit)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("¹ÎÃ¸ÀÌ ³·¾Æ Âø¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ø    ϴ."));

 					return false;

 				}

 			}

@@ -11236,7 +11327,7 @@
 			{

 				if (GetPoint(POINT_HT) < limit)

 				{

-					ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ã¼·ÂÀÌ ³·¾Æ Âø¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+					ChatPacket(CHAT_TYPE_INFO, LC_STRING("ü    ϴ."));

 					return false;

 				}

 			}

@@ -11249,14 +11340,14 @@
 		if ((GetWear(WEAR_UNIQUE1) && GetWear(WEAR_UNIQUE1)->IsSameSpecialGroup(item)) ||

 			(GetWear(WEAR_UNIQUE2) && GetWear(WEAR_UNIQUE2)->IsSameSpecialGroup(item)))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°°Àº Á¾·ùÀÇ À¯´ÏÅ© ¾ÆÀÌÅÛ µÎ °³¸¦ µ¿½Ã¿¡ ÀåÂøÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ũ    ÿ   ϴ."));

 			return false;

 		}

 

 		if (marriage::CManager::instance().IsMarriageUniqueItem(item->GetVnum()) &&

 			!marriage::CManager::instance().IsMarried(GetPlayerID()))

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("°áÈ¥ÇÏÁö ¾ÊÀº »óÅÂ¿¡¼­ ¿¹¹°À» Âø¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ȥ  ¿    ϴ."));

 			return false;

 		}

 	}

@@ -11280,7 +11371,7 @@
 	return true;

 }

 

-/// ÇöÀç Ä³¸¯ÅÍÀÇ »óÅÂ¸¦ ¹ÙÅÁÀ¸·Î Âø¿ë ÁßÀÎ itemÀ» ¹þÀ» ¼ö ÀÖ´Â Áö È®ÀÎÇÏ°í, ºÒ°¡´É ÇÏ´Ù¸é Ä³¸¯ÅÍ¿¡°Ô ÀÌÀ¯¸¦ ¾Ë·ÁÁÖ´Â ÇÔ¼ö

+///  ĳ ¸    item   ִ  Ȯϰ, Ұ ϴٸ ĳͿ  ˷ִ Լ

 bool CHARACTER::CanUnequipNow(const LPITEM item, const TItemPos& srcCell, const TItemPos& destCell) /*const*/

 //bool CHARACTER::CanUnequipNow(const LPITEM item, const TItemPos& swapCell) /*const*/

 {

@@ -11293,7 +11384,7 @@
 		}

 	}

 

-	// ¿µ¿øÈ÷ ÇØÁ¦ÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛ

+	//     

 	if (IS_SET(item->GetFlag(), ITEM_FLAG_IRREMOVABLE))

 		return false;

 

@@ -11303,7 +11394,7 @@
 		return false;

 	}

 

-	// ¾ÆÀÌÅÛ unequip½Ã ÀÎº¥Åä¸®·Î ¿Å±æ ¶§ ºó ÀÚ¸®°¡ ÀÖ´Â Áö È®ÀÎ

+	//  unequip κ丮 ű   ڸ ִ  Ȯ

 	{

 		int pos = -1;

 

@@ -11316,7 +11407,7 @@
 

 		if (-1 == pos)

 		{

-			ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+			ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 			return false;

 		}

 	}

@@ -11519,7 +11610,7 @@
 

 	if (item->GetAttributeSetIndex() == -1)

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼Ó¼ºÀ» º¯°æÇÒ ¼ö ¾ø´Â ¾ÆÀÌÅÛÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ӽ    Դϴ."));

 		return;

 	}

 


--- a/server/metin2/Source/Server/game/src/cube.cpp
+++ b/server/metin2/Source/Server/game/src/cube.cpp
@@ -215,13 +215,13 @@
 

 	if (pChar->PreventTradeWindow(WND_CUBE, true/*except*/))

 	{

-		pChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ù¸¥ °Å·¡ÁßÀÏ°æ¿ì °³ÀÎ»óÁ¡À» ¿­¼ö°¡ ¾ø½À´Ï´Ù."));

+		pChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٸ ŷϰ λ  ϴ."));

 		return;

 	}

 

 	if (pChar->IsCubeOpen())

 	{

-		pChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¦Á¶Ã¢ÀÌ ¿­·ÁÀÖÁö ¾Ê½À´Ï´Ù"));

+		pChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("â  ʽϴ"));

 		return;

 	}

 

@@ -281,9 +281,24 @@
 	if (pChar->IsCubeOpen() == false)

 		return;

 

-	const LPCHARACTER pNPC = pChar->GetQuestNPC();

+	const LPCHARACTER pNPC = pChar->GetCubeNpc();

 	if (pNPC == nullptr)

 		return;

+

+	// [Security] Re-validate proximity to the cube NPC on every craft (prevents remote crafting via packet injection)

+	if (pNPC->GetMapIndex() != pChar->GetMapIndex())

+	{

+		CCubeManager::Instance().CloseCube(pChar);

+		return;

+	}

+

+	const int kMaxCubeDistance = 500;

+	if (DISTANCE_APPROX(pChar->GetX() - pNPC->GetX(), pChar->GetY() - pNPC->GetY()) > kMaxCubeDistance)

+	{

+		pChar->ChatPacket(CHAT_TYPE_INFO, LC_STRING("You are too far away from the crafting NPC."));

+		CCubeManager::Instance().CloseCube(pChar);

+		return;

+	}

 

 	try

 	{

@@ -448,6 +463,7 @@
 				pRewardItem->SetItemSetValue(pkCube.iSetValue);

 #endif

 				ITEM_MANAGER::instance().RemoveItem(pNotRemoveItem, "CUBE COPY");

+				pNotRemoveItem = nullptr;

 			}

 			else

 			{

@@ -554,11 +570,11 @@
 */

 enum ECubeResultCategory

 {

-	CUBE_CATEGORY_POTION, // ¾àÃÊ, Áø¾× µîµî.. (Æ÷¼ÇÀ¸·Î Æ¯Á¤ÇÒ ¼ö ¾øÀ¸´Ï »ç¿ë ¾È ÇÔ. ¾àÃÊ°°Àº°Ç ´Ù °Á ±âÅ¸)

-	CUBE_CATEGORY_WEAPON, // ¹«±â

-	CUBE_CATEGORY_ARMOR, // ¹æ¾î±¸

-	CUBE_CATEGORY_ACCESSORY, // Àå½Å±¸

-	CUBE_CATEGORY_ETC, // ±âÅ¸ µîµî...

+	CUBE_CATEGORY_POTION, // ,  .. ( Ư     . ʰ   Ÿ)

+	CUBE_CATEGORY_WEAPON, // 

+	CUBE_CATEGORY_ARMOR, // 

+	CUBE_CATEGORY_ACCESSORY, // ű

+	CUBE_CATEGORY_ETC, // Ÿ ...

 };

 

 typedef std::vector<CUBE_VALUE> TCubeValueVector;

@@ -570,12 +586,12 @@
 		bHaveComplicateMaterial = false;

 	};

 

-	CUBE_VALUE reward; // º¸»óÀÌ ¹¹³Ä

-	TCubeValueVector material; // Àç·áµéÀº ¹¹³Ä

-	DWORD gold; // µ·Àº ¾ó¸¶µå³Ä

-	TCubeValueVector complicateMaterial; // º¹ÀâÇÑ-_- Àç·áµé

-

-	// .. Å¬¶óÀÌ¾ðÆ®¿¡¼­ Àç·á¸¦ º¸¿©ÁÖ±â À§ÇÏ¿© ¾à¼ÓÇÑ Æ÷¸Ë

+	CUBE_VALUE reward; //  

+	TCubeValueVector material; //  

+	DWORD gold; //  󸶵

+	TCubeValueVector complicateMaterial; // -_- 

+

+	// .. Ŭ̾Ʈ Ḧ ֱ Ͽ  

 	// 72723,1&72724,2&72730,1

 	// 52001,1|52002,1|52003,1&72723,1&72724,5

 	// => ( 52001,1 or 52002,1 or 52003,1 ) and 72723,1 and 72724,5

@@ -591,13 +607,13 @@
 	int level;

 };

 

-// ÀÚ·á±¸Á¶³ª ÀÌ·±°Å º´½ÅÀÎ°Ç ÀÌÇØÁ»... ´©±¸¶«¿¡ ¿µÈ¥ÀÌ ¾ø´Â »óÅÂ¿¡¼­ ¸¸µé¾ú¾¸

+// ڷᱸ ̷ ΰ ...  ȥ  ¿ 

 typedef std::vector<SCubeMaterialInfo> TCubeResultList;

-typedef std::unordered_map<DWORD, TCubeResultList> TCubeMapByNPC; // °¢°¢ÀÇ NPCº°·Î ¾î¶² °É ¸¸µé ¼ö ÀÖ°í Àç·á°¡ ¹ºÁö...

-typedef std::unordered_map<DWORD, std::string> TCubeResultInfoTextByNPC; // °¢°¢ÀÇ NPCº°·Î ¸¸µé ¼ö ÀÖ´Â ¸ñ·ÏÀ» Á¤ÇØÁø Æ÷¸ËÀ¸·Î Á¤¸®ÇÑ Á¤º¸

+typedef std::unordered_map<DWORD, TCubeResultList> TCubeMapByNPC; //  NPC     ְ ᰡ ...

+typedef std::unordered_map<DWORD, std::string> TCubeResultInfoTextByNPC; //  NPC   ִ     

 

 TCubeMapByNPC cube_info_map;

-TCubeResultInfoTextByNPC cube_result_info_map_by_npc; // ³×ÀÌ¹Ö Á¸³ª º´½Å°°´Ù ¤»¤»¤»

+TCubeResultInfoTextByNPC cube_result_info_map_by_npc; // ̹  Ű 

 

 class CCubeMaterialInfoHelper

 {

@@ -608,7 +624,7 @@
 /*

 * Static Functions

 */

-// ÇÊ¿äÇÑ ¾ÆÀÌÅÛ °³¼ö¸¦ °¡Áö°íÀÖ´Â°¡?

+// ʿ   ִ°?

 static bool FN_check_item_count(LPITEM* items, DWORD item_vnum, int need_count)

 {

 	int count = 0;

@@ -627,7 +643,7 @@
 	return (count >= need_count);

 }

 

-// Å¥ºê³»ÀÇ Àç·á¸¦ Áö¿î´Ù.

+// ť곻 Ḧ .

 static void FN_remove_material(LPITEM* items, DWORD item_vnum, int need_count)

 {

 	int count = 0;

@@ -689,7 +705,7 @@
 	return false;

 }

 

-// Å¥ºêµ¥ÀÌÅ¸°¡ ¿Ã¹Ù¸£°Ô ÃÊ±âÈ­ µÇ¾ú´ÂÁö Ã¼Å©ÇÑ´Ù.

+// ť굥Ÿ ùٸ ʱȭ Ǿ üũѴ.

 static bool FN_check_cube_data(CUBE_DATA* cube_data)

 {

 	DWORD i = 0;

@@ -727,10 +743,10 @@
 #endif

 }

 

-// ÇÊ¿äÇÑ Àç·áÀÇ ¼ö·®À» ¸¸Á·ÇÏ´ÂÁö Ã¼Å©ÇÑ´Ù.

+// ʿ   ϴ üũѴ.

 bool CUBE_DATA::can_make_item(LPITEM* items, WORD npc_vnum)

 {

-	// ÇÊ¿äÇÑ Àç·á, ¼ö·®À» ¸¸Á·ÇÏ´ÂÁö Ã¼Å©ÇÑ´Ù.

+	// ʿ ,  ϴ üũѴ.

 	DWORD i, end_index;

 	DWORD need_vnum;

 	int need_count;

@@ -758,7 +774,7 @@
 	return true;

 }

 

-// Å¥ºê¸¦ µ¹·ÈÀ»¶§ ³ª¿À´Â ¾ÆÀÌÅÛÀÇ Á¾·ù¸¦ °áÁ¤ÇÔ

+// ť긦     

 CUBE_VALUE* CUBE_DATA::reward_value()

 {

 	int end_index = 0;

@@ -771,7 +787,7 @@
 	return &this->reward[reward_index];

 }

 

-// Å¥ºê¿¡ µé¾îÀÖ´Â Àç·á¸¦ Áö¿î´Ù

+// ť꿡 ִ Ḧ 

 void CUBE_DATA::remove_material(LPCHARACTER ch)

 {

 	DWORD i, end_index;

@@ -809,7 +825,7 @@
 	}

 }

 

-// Å¥ºêÃ¢ ¿­±â

+// ťâ 

 void Cube_open(LPCHARACTER ch)

 {

 	const auto reload = !s_isInitializedCubeMaterialInformation;

@@ -850,13 +866,13 @@
 

 	if (ch->IsCubeOpen())

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÀÌ¹Ì Á¦Á¶Ã¢ÀÌ ¿­·ÁÀÖ½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("̹ â ֽϴ."));

 		return;

 	}

 

 	if (ch->PreventTradeWindow(WND_ALL))

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ù¸¥ °Å·¡Áß(Ã¢°í,±³È¯,»óÁ¡)¿¡´Â »ç¿ëÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٸ ŷ(â,ȯ,)   ϴ."));

 		return;

 	}

 

@@ -873,7 +889,7 @@
 	ch->ChatPacket(CHAT_TYPE_COMMAND, "cube open %d %d", npc->GetRaceNum(), reload);

 }

 

-// Å¥ºê Äµ½½

+// ť ĵ

 void Cube_close(LPCHARACTER ch)

 {

 	RETURN_IF_CUBE_IS_NOT_OPENED(ch);

@@ -972,13 +988,13 @@
 		}

 	else TOKEN("gold")

 	{

-		// Á¦Á¶¿¡ ÇÊ¿äÇÑ ±Ý¾×

+		//  ʿ ݾ

 		cube_data->gold = value1;

 	}

 #if defined(__CUBE_RENEWAL__)

 	else TOKEN("not_remove")

 	{

-		// Á¦Á¶¿¡ ÇÊ¿äÇÑ ±Ý¾×

+		//  ʿ ݾ

 		cube_data->not_remove = value1;

 	}

 #endif

@@ -1056,10 +1072,10 @@
 // return new item

 bool Cube_make(LPCHARACTER ch)

 {

-	// ÁÖ¾îÁø ¾ÆÀÌÅÛÀ» ÇÊ¿ä·ÎÇÏ´Â Á¶ÇÕÀ» Ã£´Â´Ù. (Å¥ºêµ¥ÀÌÅ¸·Î ÄªÇÔ)

-	// Å¥ºê µ¥ÀÌÅ¸°¡ ÀÖ´Ù¸é ¾ÆÀÌÅÛÀÇ Àç·á¸¦ Ã¼Å©ÇÑ´Ù.

-	// »õ·Î¿î ¾ÆÀÌÅÛÀ» ¸¸µç´Ù.

-	// »õ·Î¿î ¾ÆÀÌÅÛ Áö±Þ

+	// ־  ʿϴ  ã´. (ť굥Ÿ Ī)

+	// ť Ÿ ִٸ  Ḧ üũѴ.

+	// ο  .

+	// ο  

 

 	LPCHARACTER npc;

 	int percent_number = 0;

@@ -1069,7 +1085,7 @@
 

 	if (!(ch)->IsCubeOpen())

 	{

-		(ch)->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¦Á¶Ã¢ÀÌ ¿­·ÁÀÖÁö ¾Ê½À´Ï´Ù"));

+		(ch)->ChatPacket(CHAT_TYPE_INFO, LC_STRING("â  ʽϴ"));

 		return false;

 	}

 

@@ -1084,7 +1100,7 @@
 

 	if (NULL == cube_proto)

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¦Á¶ Àç·á°¡ ºÎÁ·ÇÕ´Ï´Ù"));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ᰡ մϴ"));

 		return false;

 	}

 

@@ -1097,23 +1113,23 @@
 	unsigned long long gold = ch->GetGold();

 	if (gold < static_cast<unsigned long long>(cube_proto->gold))

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µ·ÀÌ ºÎÁ·ÇÏ°Å³ª ¾ÆÀÌÅÛÀÌ Á¦ÀÚ¸®¿¡ ¾ø½À´Ï´Ù."));	// ÀÌ ÅØ½ºÆ®´Â ÀÌ¹Ì ³Î¸® ¾²ÀÌ´Â°Å¶ó Ãß°¡¹ø¿ª ÇÊ¿ä ¾øÀ½

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϰų  ڸ ϴ."));	//  ؽƮ ̹ θ ̴°Ŷ ߰ ʿ 

 		return false;

 	}

 

 	CUBE_VALUE* reward_value = cube_proto->reward_value();

 

-	// »ç¿ëµÇ¾ú´ø Àç·á¾ÆÀÌÅÛ »èÁ¦

+	// Ǿ  

 	cube_proto->remove_material(ch);

 

-	// Á¦Á¶½Ã ÇÊ¿äÇÑ °ñµå Â÷°¨

+	//  ʿ  

 	if (cube_proto->gold > 0)

 		ch->PointChange(POINT_GOLD, -(long long)cube_proto->gold, false);

 

 	percent_number = number(1, 100);

 	if (percent_number <= cube_proto->percent)

 	{

-		// ¼º°ø

+		// 

 		ch->ChatPacket(CHAT_TYPE_COMMAND, "cube success %d %d", reward_value->vnum, reward_value->count);

 		new_item = ch->AutoGiveItem(reward_value->vnum, reward_value->count);

 

@@ -1132,8 +1148,8 @@
 	}

 	else

 	{

-		// ½ÇÆÐ

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Á¦Á¶¿¡ ½ÇÆÐÇÏ¿´½À´Ï´Ù.")); // 2012.11.12 »õ·Î Ãß°¡µÈ ¸Þ¼¼Áö (locale_string.txt ¿¡ Ãß°¡ÇØ¾ß ÇÔ)

+		// 

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ͽϴ.")); // 2012.11.12  ߰ ޼ (locale_string.txt  ߰ؾ )

 		ch->ChatPacket(CHAT_TYPE_COMMAND, "cube fail");

 		LogManager::instance().CubeLog(ch->GetPlayerID(), ch->GetX(), ch->GetY(),

 			reward_value->vnum, 0, 0, 0);

@@ -1143,7 +1159,7 @@
 	return false;

 }

 

-// Å¥ºê¿¡ ÀÖ´Â ¾ÆÀÌÅÛµéÀ» Ç¥½Ã

+// ť꿡 ִ ۵ ǥ

 void Cube_show_list(LPCHARACTER ch)

 {

 	LPITEM* cube_item;

@@ -1162,13 +1178,13 @@
 	}

 }

 

-// ÀÎº¥Åä¸®¿¡ ÀÖ´Â ¾ÆÀÌÅÛÀ» Å¥ºê¿¡ µî·Ï

+// κ丮 ִ  ť꿡 

 void Cube_add_item(LPCHARACTER ch, int cube_index, int inven_index)

 {

-	// ¾ÆÀÌÅÛÀÌ ÀÖ´Â°¡?

-	// Å¥ºê³»ÀÇ ºóÀÚ¸® Ã£±â

-	// Å¥ºê¼¼ÆÃ

-	// ¸Þ½ÃÁö Àü¼Û

+	//  ִ°?

+	// ť곻 ڸ ã

+	// ť꼼

+	// ޽ 

 	LPITEM item;

 	LPITEM* cube_item;

 

@@ -1186,7 +1202,7 @@
 

 	cube_item = ch->GetCubeItem();

 

-	// ÀÌ¹Ì ´Ù¸¥À§Ä¡¿¡ µî·ÏµÇ¾ú´ø ¾ÆÀÌÅÛÀÌ¸é ±âÁ¸ indext»èÁ¦

+	// ̹ ٸġ ϵǾ ̸  indext

 	for (int i = 0; i < CUBE_MAX_NUM; ++i)

 	{

 		if (item == cube_item[i])

@@ -1201,14 +1217,14 @@
 	if (test_server)

 		ch->ChatPacket(CHAT_TYPE_INFO, "cube[%d]: inventory[%d]: %s added", cube_index, inven_index, item->GetName());

 

-	// ÇöÀç »óÀÚ¿¡ ¿Ã¶ó¿Â ¾ÆÀÌÅÛµé·Î ¹«¾ùÀ» ¸¸µé ¼ö ÀÖ´ÂÁö Å¬¶óÀÌ¾ðÆ®¿¡ Á¤º¸ Àü´Þ

-	// À» ÇÏ°í½Í¾úÀ¸³ª ±×³É ÇÊ¿äÇÑ °ñµå°¡ ¾ó¸¶ÀÎÁö Àü´Þ

+	//  ڿ ö ۵    ִ Ŭ̾Ʈ  

+	//  ϰ; ׳ ʿ 尡  

 	FN_update_cube_status(ch);

 

 	return;

 }

 

-// Å¥ºê¿¡ÀÖ´Â ¾ÆÀÌÅÛÀ» Á¦°Å

+// ť꿡ִ  

 void Cube_delete_item(LPCHARACTER ch, int cube_index)

 {

 	LPITEM item;

@@ -1228,14 +1244,14 @@
 	if (test_server)

 		ch->ChatPacket(CHAT_TYPE_INFO, "cube[%d]: cube[%d]: %s deleted", cube_index, item->GetCell(), item->GetName());

 

-	// ÇöÀç »óÀÚ¿¡ ¿Ã¶ó¿Â ¾ÆÀÌÅÛµé·Î ¹«¾ùÀ» ¸¸µé ¼ö ÀÖ´ÂÁö Å¬¶óÀÌ¾ðÆ®¿¡ Á¤º¸ Àü´Þ

-	// À» ÇÏ°í½Í¾úÀ¸³ª ±×³É ÇÊ¿äÇÑ °ñµå°¡ ¾ó¸¶ÀÎÁö Àü´Þ

+	//  ڿ ö ۵    ִ Ŭ̾Ʈ  

+	//  ϰ; ׳ ʿ 尡  

 	FN_update_cube_status(ch);

 

 	return;

 }

 

-// ¾ÆÀÌÅÛ ÀÌ¸§À» ÅëÇØ¼­ ¼ø¼ö ÀÌ¸§°ú °­È­·¹º§À» ºÐ¸®ÇÏ´Â ÇÔ¼ö (¹«½Ö°Ë+5 -> ¹«½Ö°Ë, 5)

+//  ̸ ؼ  ̸ ȭ иϴ Լ (ְ+5 -> ְ, 5)

 SItemNameAndLevel SplitItemNameAndLevelFromName(const std::string& name)

 {

 	int level = 0;

@@ -1269,7 +1285,7 @@
 

 void Cube_MakeCubeInformationText()

 {

-	// ÀÌÁ¦ Á¤¸®µÈ Å¥ºê °á°ú ¹× Àç·áµéÀÇ Á¤º¸·Î Å¬¶óÀÌ¾ðÆ®¿¡ º¸³» ÁÙ Á¤º¸·Î º¯È¯ÇÔ.

+	//   ť     Ŭ̾Ʈ    ȯ.

 	for (TCubeMapByNPC::iterator iter = cube_info_map.begin(); cube_info_map.end() != iter; ++iter)

 	{

 		const DWORD& npcVNUM = iter->first;

@@ -1280,13 +1296,13 @@
 			SCubeMaterialInfo& materialInfo = *resultIter;

 			std::string& infoText = materialInfo.infoText;

 

-			// ÀÌ³ðÀÌ ³ª»Û³ðÀÌ¾ß

+			// ̳ ۳̾

 			if (0 < materialInfo.complicateMaterial.size())

 			{

 				std::sort(materialInfo.complicateMaterial.begin(), materialInfo.complicateMaterial.end(), FIsLessCubeValue);

 				std::sort(materialInfo.material.begin(), materialInfo.material.end(), FIsLessCubeValue);

 

-				//// Áßº¹µÇ´Â Àç·áµéÀ» Áö¿ò

+				//// ߺǴ  

 				for (TCubeValueVector::iterator iter = materialInfo.complicateMaterial.begin(); materialInfo.complicateMaterial.end() != iter; ++iter)

 				{

 					for (TCubeValueVector::iterator targetIter = materialInfo.material.begin(); materialInfo.material.end() != targetIter; ++targetIter)

@@ -1298,11 +1314,11 @@
 					}

 				}

 

-				// 72723,1 or 72725,1 or ... ÀÌ·± ½ÄÀÇ ¾à¼ÓµÈ Æ÷¸ËÀ» ÁöÅ°´Â ÅØ½ºÆ®¸¦ »ý¼º

+				// 72723,1 or 72725,1 or ... ̷  ӵ  Ű ؽƮ 

 				for (TCubeValueVector::iterator iter = materialInfo.complicateMaterial.begin(); materialInfo.complicateMaterial.end() != iter; ++iter)

 				{

 					char tempBuffer[128];

-					sprintf(tempBuffer, "%d,%d|", iter->vnum, iter->count);

+					snprintf(tempBuffer, sizeof(tempBuffer), "%d,%d|", iter->vnum, iter->count);

 

 					infoText += std::string(tempBuffer);

 				}

@@ -1313,21 +1329,21 @@
 					infoText.push_back('&');

 			}

 

-			// Áßº¹µÇÁö ¾Ê´Â ÀÏ¹Ý Àç·áµéµµ Æ÷¸Ë »ý¼º

+			// ߺ ʴ Ϲ 鵵  

 			for (TCubeValueVector::iterator iter = materialInfo.material.begin(); materialInfo.material.end() != iter; ++iter)

 			{

 				char tempBuffer[128];

-				sprintf(tempBuffer, "%d,%d&", iter->vnum, iter->count);

+				snprintf(tempBuffer, sizeof(tempBuffer), "%d,%d&", iter->vnum, iter->count);

 				infoText += std::string(tempBuffer);

 			}

 

 			infoText.erase(infoText.size() - 1);

 

-			// ¸¸µé ¶§ °ñµå°¡ ÇÊ¿äÇÏ´Ù¸é °ñµåÁ¤º¸ Ãß°¡

+			//   尡 ʿϴٸ  ߰

 			if (0 < materialInfo.gold)

 			{

 				char temp[128];

-				sprintf(temp, "%d", materialInfo.gold);

+				snprintf(temp, sizeof(temp), "%d", materialInfo.gold);

 				infoText += std::string("/") + temp;

 			}

 

@@ -1344,7 +1360,7 @@
 

 		const std::vector<CUBE_VALUE>& rewards = cubeData->reward;

 

-		// ÇÏµåÄÚµù ¤¸¤µ

+		// ϵڵ 

 		if (1 != rewards.size())

 		{

 			sys_err("[CubeInfo] WARNING! Does not support multiple rewards (count: %d)", rewards.size());

@@ -1374,13 +1390,13 @@
 		{

 			SCubeMaterialInfo& existInfo = *iter;

 

-			// ÀÌ¹Ì Áßº¹µÇ´Â º¸»óÀÌ µî·ÏµÇ¾î ÀÖ´Ù¸é ¾Æ¿¹ ´Ù¸¥ Á¶ÇÕÀ¸·Î ¸¸µå´Â °ÍÀÎÁö,

-			// °ÅÀÇ °°Àº Á¶ÇÕÀÎµ¥ Æ¯Á¤ ºÎºÐ¸¸ Æ²¸° °ÍÀÎÁö ±¸ºÐÇÔ.

-			// ¿¹¸¦µé¸é Æ¯Á¤ ºÎºÐ¸¸ Æ²¸° ¾ÆÀÌÅÛµéÀº ¾Æ·¡Ã³·³ ÇÏ³ª·Î ¹­¾î¼­ ÇÏ³ªÀÇ °á°ú·Î º¸¿©ÁÖ±â À§ÇÔÀÓ:

-			// ¿ë½ÅÁö°Ë:

-			//		¹«½Ö°Ë+5 ~ +9 x 1

-			//		ºÓÀº Ä®ÀÚ·ç Á¶°¢ x1

-			//		³ì»ö °ËÀå½Ä Á¶°¢ x1

+			// ̹ ߺǴ  ϵǾ ִٸ ƿ ٸ   ,

+			//   ε Ư κи Ʋ  .

+			//  Ư κи Ʋ ۵ Ʒó ϳ  ϳ  ֱ :

+			// :

+			//		ְ+5 ~ +9 x 1

+			//		 Įڷ  x1

+			//		   x1

 			if (reward.vnum == existInfo.reward.vnum)

 			{

 				for (TCubeValueVector::iterator existMaterialIter = existInfo.material.begin(); existInfo.material.end() != existMaterialIter; ++existMaterialIter)

@@ -1395,8 +1411,8 @@
 

 					if (0 < existItemInfo.level)

 					{

-						// Áö±Ý Ãß°¡ÇÏ´Â Å¥ºê °á°ú¹°ÀÇ Àç·á¿Í, ±âÁ¸¿¡ µî·ÏµÇ¾îÀÖ´ø Å¥ºê °á°ú¹°ÀÇ Àç·á Áß

-						// Áßº¹µÇ´Â ºÎºÐÀÌ ÀÖ´ÂÁö °Ë»öÇÑ´Ù

+						//  ߰ϴ ť  ,  ϵǾִ ť   

+						// ߺǴ κ ִ ˻Ѵ

 						for (TCubeValueVector::iterator currentMaterialIter = materialInfo.material.begin(); materialInfo.material.end() != currentMaterialIter; ++currentMaterialIter)

 						{

 							TItemTable* currentMaterialProto = ITEM_MANAGER::Instance().GetTable(currentMaterialIter->vnum);

@@ -1412,7 +1428,7 @@
 

 								//currentMaterialIter = materialInfo.material.erase(currentMaterialIter);

 

-								// TODO : Áßº¹µÇ´Â ¾ÆÀÌÅÛ µÎ °³ ÀÌ»ó °ËÃâÇØ¾ß µÉ ¼öµµ ÀÖÀ½

+								// TODO : ߺǴ    ̻ ؾ   

 								break;

 							}

 						} // for currentMaterialIter

@@ -1432,7 +1448,7 @@
 	return true;

 }

 

-// Å¬¶óÀÌ¾ðÆ®¿¡¼­ ¼­¹ö·Î : ÇöÀç NPC°¡ ¸¸µé ¼ö ÀÖ´Â ¾ÆÀÌÅÛµéÀÇ Á¤º¸(¸ñ·Ï)¸¦ ¿äÃ»

+// Ŭ̾Ʈ  :  NPC   ִ ۵ () û

 void Cube_request_result_list(LPCHARACTER ch)

 {

 	RETURN_IF_CUBE_IS_NOT_OPENED(ch);

@@ -1446,7 +1462,7 @@
 

 	std::string& resultText = cube_result_info_map_by_npc[npcVNUM];

 

-	// ÇØ´ç NPC°¡ ¸¸µé ¼ö ÀÖ´Â ¸ñ·ÏÀÌ Á¤¸®µÈ °Ô ¾ø´Ù¸é Ä³½Ã¸¦ »ý¼º

+	// ش NPC   ִ    ٸ ĳø 

 	if (resultText.length() == 0)

 	{

 		resultText.clear();

@@ -1456,7 +1472,7 @@
 		{

 			const SCubeMaterialInfo& materialInfo = *iter;

 			char temp[128];

-			sprintf(temp, "%d,%d", materialInfo.reward.vnum, materialInfo.reward.count);

+			snprintf(temp, sizeof(temp), "%d,%d", materialInfo.reward.vnum, materialInfo.reward.count);

 

 			resultText += std::string(temp) + "/";

 		}

@@ -1465,7 +1481,7 @@
 

 		resultText.erase(resultText.size() - 1);

 

-		// Ã¤ÆÃ ÆÐÅ¶ÀÇ ÇÑ°è¸¦ ³Ñ¾î°¡¸é ¿¡·¯ ³²±è... ±âÈ¹ÀÚ ºÐµé ²² Á¶Á¤ÇØ´Þ¶ó°í ¿äÃ»ÇÏ°Å³ª, ³ªÁß¿¡ ´Ù¸¥ ¹æ½ÄÀ¸·Î ¹Ù²Ù°Å³ª...

+		// ä Ŷ Ѱ踦 Ѿ  ... ȹ е  ش޶ ûϰų, ߿ ٸ  ٲٰų...

 		if (resultText.size() - 20 >= CHAT_MAX_LEN)

 		{

 			sys_err("[CubeInfo] Too long cube result list text. (NPC: %d, length: %d)", npcVNUM, resultText.size());

@@ -1475,7 +1491,7 @@
 

 	}

 

-	// ÇöÀç NPC°¡ ¸¸µé ¼ö ÀÖ´Â ¾ÆÀÌÅÛµéÀÇ ¸ñ·ÏÀ» ¾Æ·¡ Æ÷¸ËÀ¸·Î Àü¼ÛÇÑ´Ù.

+	//  NPC   ִ ۵  Ʒ  Ѵ.

 	// (Server -> Client) /cube r_list npcVNUM resultCount vnum1,count1/vnum2,count2,/vnum3,count3/...

 	// (Server -> Client) /cube r_list 20383 4 123,1/125,1/128,1/130,5

 


--- a/server/metin2/Source/Server/game/src/exchange.cpp
+++ b/server/metin2/Source/Server/game/src/exchange.cpp
@@ -21,9 +21,160 @@
 #	include "messenger_manager.h"

 #endif

 

+static bool __ComputeExchangeDestinationSlots(LPCHARACTER victim, LPITEM const* apItems, TItemPos* outPos)

+{

+	if (!victim || !apItems || !outPos)

+		return false;

+

+	for (int i = 0; i < EXCHANGE_ITEM_MAX_NUM; ++i)

+		outPos[i] = NPOS;

+

+	static CGrid s_grid1(5, INVENTORY_MAX_NUM / 5 / INVENTORY_PAGE_COUNT);

+	static CGrid s_grid2(5, INVENTORY_MAX_NUM / 5 / INVENTORY_PAGE_COUNT);

+#if defined(__EXTEND_INVEN_SYSTEM__)

+	static CGrid s_grid3(5, INVENTORY_MAX_NUM / 5 / INVENTORY_PAGE_COUNT);

+	static CGrid s_grid4(5, INVENTORY_MAX_NUM / 5 / INVENTORY_PAGE_COUNT);

+#endif

+

+	s_grid1.Clear();

+	s_grid2.Clear();

+#if defined(__EXTEND_INVEN_SYSTEM__)

+	s_grid3.Clear();

+	s_grid4.Clear();

+#endif

+

+	for (int pos = 0; pos < INVENTORY_PAGE_SIZE * 1; ++pos)

+	{

+		LPITEM it = victim->GetInventoryItem(pos);

+		if (it)

+			s_grid1.Put(pos, 1, it->GetSize());

+	}

+	for (int pos = INVENTORY_PAGE_SIZE * 1; pos < INVENTORY_PAGE_SIZE * 2; ++pos)

+	{

+		LPITEM it = victim->GetInventoryItem(pos);

+		if (it)

+			s_grid2.Put(pos - INVENTORY_PAGE_SIZE * 1, 1, it->GetSize());

+	}

+#if defined(__EXTEND_INVEN_SYSTEM__)

+	for (int pos = INVENTORY_PAGE_SIZE * 2; pos < INVENTORY_PAGE_SIZE * 3; ++pos)

+	{

+		LPITEM it = victim->GetInventoryItem(pos);

+		if (it)

+			s_grid3.Put(pos - INVENTORY_PAGE_SIZE * 2, 1, it->GetSize());

+	}

+	for (int pos = INVENTORY_PAGE_SIZE * 3; pos < INVENTORY_PAGE_SIZE * 4; ++pos)

+	{

+		LPITEM it = victim->GetInventoryItem(pos);

+		if (it)

+			s_grid4.Put(pos - INVENTORY_PAGE_SIZE * 3, 1, it->GetSize());

+	}

+#endif

+

+#if defined(__DRAGON_SOUL_SYSTEM__)

+	static std::vector<WORD> s_vDSGrid(DRAGON_SOUL_INVENTORY_MAX_NUM);

+	bool bDSInitialized = false;

+#endif

+

+	for (int i = 0; i < EXCHANGE_ITEM_MAX_NUM; ++i)

+	{

+		LPITEM item = apItems[i];

+		if (!item)

+			continue;

+

+#if defined(__DRAGON_SOUL_SYSTEM__)

+		if (item->IsDragonSoul())

+		{

+			if (!victim->DragonSoul_IsQualified())

+				return false;

+

+			if (!bDSInitialized)

+			{

+				bDSInitialized = true;

+				victim->CopyDragonSoulItemGrid(s_vDSGrid);

+			}

+

+			bool bFound = false;

+			WORD wBasePos = DSManager::instance().GetBasePosition(item);

+			if (wBasePos >= DRAGON_SOUL_INVENTORY_MAX_NUM)

+				return false;

+

+			for (int b = 0; b < DRAGON_SOUL_BOX_SIZE; ++b)

+			{

+				WORD wPos = wBasePos + b;

+				if (s_vDSGrid[wPos] != 0)

+					continue;

+

+				bool bEmpty = true;

+				for (int j = 1; j < item->GetSize(); ++j)

+				{

+					if (s_vDSGrid[wPos + j * DRAGON_SOUL_BOX_COLUMN_NUM])

+					{

+						bEmpty = false;

+						break;

+					}

+				}

+				if (!bEmpty)

+					continue;

+

+				for (int j = 0; j < item->GetSize(); ++j)

+					s_vDSGrid[wPos + j * DRAGON_SOUL_BOX_COLUMN_NUM] = 1;

+

+				outPos[i] = TItemPos(DRAGON_SOUL_INVENTORY, wPos);

+				bFound = true;

+				break;

+			}

+

+			if (!bFound)

+				return false;

+

+			continue;

+		}

+#endif

+

+		const int size = item->GetSize();

+		int pos = s_grid1.FindBlank(1, size);

+		if (pos >= 0)

+		{

+			s_grid1.Put(pos, 1, size);

+			outPos[i] = TItemPos(INVENTORY, pos);

+			continue;

+		}

+

+		pos = s_grid2.FindBlank(1, size);

+		if (pos >= 0)

+		{

+			s_grid2.Put(pos, 1, size);

+			outPos[i] = TItemPos(INVENTORY, pos + INVENTORY_PAGE_SIZE * 1);

+			continue;

+		}

+

+#if defined(__EXTEND_INVEN_SYSTEM__)

+		pos = s_grid3.FindBlank(1, size);

+		if (pos >= 0)

+		{

+			s_grid3.Put(pos, 1, size);

+			outPos[i] = TItemPos(INVENTORY, pos + INVENTORY_PAGE_SIZE * 2);

+			continue;

+		}

+

+		pos = s_grid4.FindBlank(1, size);

+		if (pos >= 0)

+		{

+			s_grid4.Put(pos, 1, size);

+			outPos[i] = TItemPos(INVENTORY, pos + INVENTORY_PAGE_SIZE * 3);

+			continue;

+		}

+#endif

+

+		return false;

+	}

+

+	return true;

+}

+

 void exchange_packet(LPCHARACTER ch, BYTE sub_header, bool is_me, DWORD arg1, TItemPos arg2, DWORD arg3, void* pvData = NULL);

 

-// ±³È¯ ÆÐÅ¶

+// ȯ Ŷ

 void exchange_packet(LPCHARACTER ch, BYTE sub_header, bool is_me, DWORD arg1, TItemPos arg2, DWORD arg3, void* pvData)

 {

 	if (!ch->GetDesc())

@@ -80,15 +231,15 @@
 	ch->GetDesc()->Packet(&pack_exchg, sizeof(pack_exchg));

 }

 

-// ±³È¯À» ½ÃÀÛ

+// ȯ 

 bool CHARACTER::ExchangeStart(LPCHARACTER victim)

 {

-	if (this == victim) // ÀÚ±â ÀÚ½Å°ú´Â ±³È¯À» ¸øÇÑ´Ù.

+	if (this == victim) // ڱ ڽŰ ȯ Ѵ.

 		return false;

 

 	if (IsObserverMode())

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("°üÀü »óÅÂ¿¡¼­´Â ±³È¯À» ÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ¿ ȯ   ϴ."));

 		return false;

 	}

 

@@ -102,6 +253,14 @@
 		return false;

 

 	if (victim->IsNPC())

+		return false;

+

+	// [Security Fix] Remote Exchange (inter-map) is not allowed.

+	if (victim->IsNPC())

+		return false;

+

+	// [Security] Prevent cross-map / remote exchange via packet injection

+	if (GetMapIndex() != victim->GetMapIndex())

 		return false;

 

 #ifdef __GROWTH_PET_SYSTEM__

@@ -148,20 +307,20 @@
 	// PREVENT_TRADE_WINDOW

 	if (PreventTradeWindow(WND_EXCHANGE, true/*except*/))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ù¸¥ °Å·¡Ã¢ÀÌ ¿­·ÁÀÖÀ»°æ¿ì °Å·¡¸¦ ÇÒ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٸ ŷâ  ŷ Ҽ ϴ."));

 		return false;

 	}

 

 	if (victim->PreventTradeWindow(WND_EXCHANGE, true/*except*/))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ´Ù¸¥ °Å·¡ÁßÀÌ¶ó °Å·¡¸¦ ÇÒ¼ö ¾ø½À´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ٸ ŷ̶ ŷ Ҽ ϴ."));

 		return false;

 	}

 	// END_PREVENT_TRADE_WINDOW

 

 	int iDist = DISTANCE_APPROX(GetX() - victim->GetX(), GetY() - victim->GetY());

 

-	// °Å¸® Ã¼Å©

+	// Ÿ üũ

 	if (iDist >= EXCHANGE_MAX_DISTANCE)

 		return false;

 

@@ -176,7 +335,7 @@
 

 	if (victim->IsBlockMode(BLOCK_EXCHANGE))

 	{

-		ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÌ ±³È¯ °ÅºÎ »óÅÂÀÔ´Ï´Ù."));

+		ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ȯ ź Դϴ."));

 		return false;

 	}

 

@@ -232,7 +391,7 @@
 	if (!item_pos.IsValidItemPosition())

 		return false;

 

-	// Àåºñ´Â ±³È¯ÇÒ ¼ö ¾øÀ½

+	//  ȯ  

 	if (item_pos.IsEquipPosition())

 		return false;

 

@@ -243,7 +402,7 @@
 

 	if (IS_SET(item->GetAntiFlag(), ITEM_ANTIFLAG_GIVE))

 	{

-		m_pOwner->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¾ÆÀÌÅÛÀ» °Ç³×ÁÙ ¼ö ¾ø½À´Ï´Ù."));

+		m_pOwner->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ǳ  ϴ."));

 		return false;

 	}

 

@@ -264,7 +423,7 @@
 	}

 #endif

 

-	// ÀÌ¹Ì ±³È¯Ã¢¿¡ Ãß°¡µÈ ¾ÆÀÌÅÛÀÎ°¡?

+	// ̹ ȯâ ߰ ΰ?

 	if (item->IsExchanging())

 	{

 		sys_log(0, "EXCHANGE under exchanging");

@@ -324,7 +483,7 @@
 		return true;

 	}

 

-	// Ãß°¡ÇÒ °ø°£ÀÌ ¾øÀ½

+	// ߰  

 	return false;

 }

 

@@ -360,7 +519,7 @@
 

 	if (GetOwner()->GetGold() < gold)

 	{

-		// °¡Áö°í ÀÖ´Â µ·ÀÌ ºÎÁ·.

+		//  ִ  .

 		exchange_packet(GetOwner(), EXCHANGE_SUBHEADER_GC_LESS_GOLD, 0, 0, NPOS, 0);

 		return false;

 	}

@@ -427,7 +586,7 @@
 }

 #endif

 

-// µ·ÀÌ ÃæºÐÈ÷ ÀÖ´ÂÁö, ±³È¯ÇÏ·Á´Â ¾ÆÀÌÅÛÀÌ ½ÇÁ¦·Î ÀÖ´ÂÁö È®ÀÎ ÇÑ´Ù.

+//   ִ, ȯϷ   ִ Ȯ Ѵ.

 bool CExchange::Check(int* piItemCount)

 {

 	if (GetOwner()->GetGold() < m_lGold)

@@ -511,12 +670,30 @@
 #endif

 

 #if defined(__DRAGON_SOUL_SYSTEM__)

-	// ¾Æ... ¹º°¡ °³º´½Å °°Áö¸¸... ¿ëÈ¥¼® ÀÎº¥À» ³ë¸Ö ÀÎº¥ º¸°í µû¶ó ¸¸µç ³» Àß¸øÀÌ´Ù ¤Ð¤Ð

+	// ...   ... ȥ κ  κ     ߸̴ Ф

 	static std::vector <WORD> s_vDSGrid(DRAGON_SOUL_INVENTORY_MAX_NUM);

 

-	// ÀÏ´Ü ¿ëÈ¥¼®À» ±³È¯ÇÏÁö ¾ÊÀ» °¡´É¼ºÀÌ Å©¹Ç·Î, ¿ëÈ¥¼® ÀÎº¥ º¹»ç´Â ¿ëÈ¥¼®ÀÌ ÀÖÀ» ¶§ ÇÏµµ·Ï ÇÑ´Ù.

+	// ϴ ȥ ȯ  ɼ ũǷ, ȥ κ  ȥ   ϵ Ѵ.

 	bool bDSInitialized = false;

 #endif

+

+	if (m_lGold)

+	{

+		const long long vic_gold = (long long)victim->GetGold() + (long long)m_lGold;

+		if (vic_gold >= (long long)GOLD_MAX)

+		{

+			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("The target has reached Yang limit."));

+			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("You have reached Yang limit."));

+			return false;

+		}

+	}

+

+	if (!__ComputeExchangeDestinationSlots(victim, m_apItems, aDstPos))

+	{

+		GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("The target does not have enough inventory space."));

+		victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("You do not have enough inventory space."));

+		return false;

+	}

 

 	for (i = 0; i < EXCHANGE_ITEM_MAX_NUM; ++i)

 	{

@@ -617,13 +794,14 @@
 	return true;

 }

 

-// ±³È¯ ³¡ (¾ÆÀÌÅÛ°ú µ· µîÀ» ½ÇÁ¦·Î ¿Å±ä´Ù)

+// ȯ  (۰    ű)

 bool CExchange::Done()

 {

-	int empty_pos, i;

+	int i;

 	LPITEM item;

 

 	LPCHARACTER victim = GetCompany()->GetOwner();

+	TItemPos aDstPos[EXCHANGE_ITEM_MAX_NUM];

 

 #if defined(__CHEQUE_SYSTEM__)

 	if (m_lCheque)

@@ -638,33 +816,32 @@
 	}

 #endif

 

+	if (m_lGold)

+	{

+		const long long vic_gold = (long long)victim->GetGold() + (long long)m_lGold;

+		if (vic_gold >= (long long)GOLD_MAX)

+		{

+			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("The target has reached Yang limit."));

+			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("You have reached Yang limit."));

+			return false;

+		}

+	}

+

+	if (!__ComputeExchangeDestinationSlots(victim, m_apItems, aDstPos))

+	{

+		GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("The target does not have enough inventory space."));

+		victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("You do not have enough inventory space."));

+		return false;

+	}

+

 	for (i = 0; i < EXCHANGE_ITEM_MAX_NUM; ++i)

 	{

 		if (!(item = m_apItems[i]))

 			continue;

 

-#if defined(__DRAGON_SOUL_SYSTEM__)

-		if (item->IsDragonSoul())

-			empty_pos = victim->GetEmptyDragonSoulInventory(item);

-		else

-#endif

-			empty_pos = victim->GetEmptyInventory(item->GetSize());

-

-		if (empty_pos < 0)

-		{

-			sys_err("Exchange::Done : Cannot find blank position in inventory %s <-> %s item %s",

-				m_pOwner->GetName(), victim->GetName(), item->GetName());

-			continue;

-		}

-

-		if (empty_pos < 0)

-		{

-			sys_err("Exchange::Done : Cannot find blank position in inventory %s <-> %s item %s",

-					m_pOwner->GetName(), victim->GetName(), item->GetName());

-			continue;

-		}

-

-		assert(empty_pos >= 0);

+		const TItemPos& dstPos = aDstPos[i];

+		if (!dstPos.IsValidItemPosition())

+			return false;

 

 		m_pOwner->SyncQuickslot(SLOT_TYPE_INVENTORY, item->GetCell(), WORD_MAX);

 

@@ -685,12 +862,7 @@
 #endif

 

 		item->RemoveFromCharacter();

-#if defined(__DRAGON_SOUL_SYSTEM__)

-		if (item->IsDragonSoul())

-			item->AddToCharacter(victim, TItemPos(DRAGON_SOUL_INVENTORY, empty_pos));

-		else

-#endif

-			item->AddToCharacter(victim, TItemPos(INVENTORY, empty_pos));

+		item->AddToCharacter(victim, dstPos);

 		ITEM_MANAGER::instance().FlushDelayedSave(item);

 

 		item->SetExchanging(false);

@@ -755,7 +927,7 @@
 	return true;

 }

 

-// ±³È¯À» µ¿ÀÇ

+// ȯ 

 bool CExchange::Accept(bool bAccept)

 {

 	if (m_bAccept == bAccept)

@@ -763,7 +935,7 @@
 

 	m_bAccept = bAccept;

 

-	// µÑ ´Ù µ¿ÀÇ ÇßÀ¸¹Ç·Î ±³È¯ ¼º¸³

+	//    Ƿ ȯ 

 	if (m_bAccept && GetCompany()->m_bAccept)

 	{

 		int iItemCount;

@@ -778,36 +950,36 @@
 		if (GetOwner()->IsRunningQuest() || victim->IsRunningQuest())

 			goto EXCHANGE_END;

 	

-		// exchange_check ¿¡¼­´Â ±³È¯ÇÒ ¾ÆÀÌÅÛµéÀÌ Á¦ÀÚ¸®¿¡ ÀÖ³ª È®ÀÎÇÏ°í,

-		// ¿¤Å©µµ ÃæºÐÈ÷ ÀÖ³ª È®ÀÎÇÑ´Ù, µÎ¹øÂ° ÀÎÀÚ·Î ±³È¯ÇÒ ¾ÆÀÌÅÛ °³¼ö

-		// ¸¦ ¸®ÅÏÇÑ´Ù.

+		// exchange_check  ȯ ۵ ڸ ֳ Ȯϰ,

+		// ũ  ֳ ȮѴ, ι° ڷ ȯ  

+		//  Ѵ.

 		if (!Check(&iItemCount))

 		{

-			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µ·ÀÌ ºÎÁ·ÇÏ°Å³ª ¾ÆÀÌÅÛÀÌ Á¦ÀÚ¸®¿¡ ¾ø½À´Ï´Ù."));

-			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÇ µ·ÀÌ ºÎÁ·ÇÏ°Å³ª ¾ÆÀÌÅÛÀÌ Á¦ÀÚ¸®¿¡ ¾ø½À´Ï´Ù."));

+			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϰų  ڸ ϴ."));

+			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ϰų  ڸ ϴ."));

 			goto EXCHANGE_END;

 		}

 

-		// ¸®ÅÏ ¹ÞÀº ¾ÆÀÌÅÛ °³¼ö·Î »ó´ë¹æÀÇ ¼ÒÁöÇ°¿¡ ³²Àº ÀÚ¸®°¡ ÀÖ³ª È®ÀÎÇÑ´Ù.

+		//      ǰ  ڸ ֳ ȮѴ.

 		if (!CheckSpace())

 		{

-			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÇ ¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

-			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ǰ   ϴ."));

+			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 			goto EXCHANGE_END;

 		}

 

-		// »ó´ë¹æµµ ¸¶Âù°¡Áö·Î..

+		// 浵 ..

 		if (!GetCompany()->Check(&iItemCount))

 		{

-			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("µ·ÀÌ ºÎÁ·ÇÏ°Å³ª ¾ÆÀÌÅÛÀÌ Á¦ÀÚ¸®¿¡ ¾ø½À´Ï´Ù."));

-			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÇ µ·ÀÌ ºÎÁ·ÇÏ°Å³ª ¾ÆÀÌÅÛÀÌ Á¦ÀÚ¸®¿¡ ¾ø½À´Ï´Ù."));

+			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ϰų  ڸ ϴ."));

+			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("  ϰų  ڸ ϴ."));

 			goto EXCHANGE_END;

 		}

 

 		if (!GetCompany()->CheckSpace())

 		{

-			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»ó´ë¹æÀÇ ¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

-			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("¼ÒÁöÇ°¿¡ ºó °ø°£ÀÌ ¾ø½À´Ï´Ù."));

+			victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" ǰ   ϴ."));

+			GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ǰ   ϴ."));

 			goto EXCHANGE_END;

 		}

 

@@ -821,7 +993,7 @@
 

 		if (Done())

 		{

-			if (m_lGold) // µ·ÀÌ ÀÖÀ» ‹š¸¸ ÀúÀå

+			if (m_lGold) //    

 				GetOwner()->Save();

 

 #if defined(__CHEQUE_SYSTEM__)

@@ -831,7 +1003,7 @@
 

 			if (GetCompany()->Done())

 			{

-				if (GetCompany()->m_lGold) // µ·ÀÌ ÀÖÀ» ¶§¸¸ ÀúÀå

+				if (GetCompany()->m_lGold) //    

 					victim->Save();

 

 #if defined(__CHEQUE_SYSTEM__)

@@ -840,8 +1012,8 @@
 #endif

 

 				// INTERNATIONAL_VERSION

-				GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("%s ´Ô°úÀÇ ±³È¯ÀÌ ¼º»ç µÇ¾ú½À´Ï´Ù.", victim->GetName()));

-				victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("%s ´Ô°úÀÇ ±³È¯ÀÌ ¼º»ç µÇ¾ú½À´Ï´Ù.", GetOwner()->GetName()));

+				GetOwner()->ChatPacket(CHAT_TYPE_INFO, LC_STRING("%s ԰ ȯ  Ǿϴ.", victim->GetName()));

+				victim->ChatPacket(CHAT_TYPE_INFO, LC_STRING("%s ԰ ȯ  Ǿϴ.", GetOwner()->GetName()));

 				// END_OF_INTERNATIONAL_VERSION

 			}

 		}

@@ -852,14 +1024,14 @@
 	}

 	else

 	{

-		// ¾Æ´Ï¸é accept¿¡ ´ëÇÑ ÆÐÅ¶À» º¸³»ÀÚ.

+		// ƴϸ accept  Ŷ .

 		exchange_packet(GetOwner(), EXCHANGE_SUBHEADER_GC_ACCEPT, true, m_bAccept, NPOS, 0);

 		exchange_packet(GetCompany()->GetOwner(), EXCHANGE_SUBHEADER_GC_ACCEPT, false, m_bAccept, NPOS, 0);

 		return true;

 	}

 }

 

-// ±³È¯ Ãë¼Ò

+// ȯ 

 void CExchange::Cancel()

 {

 	exchange_packet(GetOwner(), EXCHANGE_SUBHEADER_GC_END, 0, 0, NPOS, 0);


--- a/server/metin2/Source/Server/game/src/shop.cpp
+++ b/server/metin2/Source/Server/game/src/shop.cpp
@@ -33,7 +33,7 @@
 

 CShop::~CShop()

 {

-	TPacketGCShop pack;

+	TPacketGCShop pack{};

 

 	pack.header = HEADER_GC_SHOP;

 	pack.subheader = SHOP_SUBHEADER_GC_END;

@@ -41,15 +41,21 @@
 

 	Broadcast(&pack, sizeof(pack));

 

-	GuestMapType::iterator it;

-

-	it = m_map_guest.begin();

-	while (it != m_map_guest.end())

+	for (GuestMapType::iterator it = m_map_guest.begin(); it != m_map_guest.end(); ++it)

 	{

 		LPCHARACTER ch = it->first;

-		ch->SetShop(nullptr);

-		++it;

-	}

+		if (!ch)

+			continue;

+

+		if (ch->GetShop() == this)

+			ch->SetShop(NULL);

+

+		// prevent stale shop-owner pointer on guests when a PC shop is destroyed

+		if (m_pkPC && ch->GetShopOwner() == m_pkPC)

+			ch->SetShopOwner(NULL);

+	}

+

+	m_map_guest.clear();

 

 #if !defined(__MYSHOP_EXPANSION__)

 	M2_DELETE(m_pGrid);

@@ -216,8 +222,8 @@
 		if (item.pkItem)

 		{

 			item.vnum = pkItem->GetVnum();

-			item.count = pkItem->GetCount(); // PC ¼¥ÀÇ °æ¿ì ¾ÆÀÌÅÛ °³¼ö´Â ÁøÂ¥ ¾ÆÀÌÅÛÀÇ °³¼ö¿©¾ß ÇÑ´Ù.

-			item.price = pTable->price; // °¡°Ýµµ »ç¿ëÀÚ°¡ Á¤ÇÑ´ë·Î..

+			item.count = pkItem->GetCount(); // PC     ¥   Ѵ.

+			item.price = pTable->price; // ݵ ڰ Ѵ..

 #if defined(__CHEQUE_SYSTEM__)

 			item.cheque = pTable->cheque;

 #endif

@@ -256,6 +262,7 @@
 int CShop::Buy(LPCHARACTER ch, BYTE pos

 )

 {

+	if (!ch) return SHOP_SUBHEADER_GC_END;

 	if (pos >= m_itemVector.size())

 	{

 		sys_log(0, "Shop::Buy : invalid position %d : %s", pos, ch->GetName());

@@ -311,7 +318,14 @@
 #endif

 

 	if (it->second) // if other empire, price is triple

+	{

+		if (dwPrice > (std::numeric_limits<DWORD>::max() / 3))

+		{

+			LogManager::instance().HackLog("SHOP_BUY_GOLD_OVERFLOW_TRIPLE", ch);

+			return SHOP_SUBHEADER_GC_NOT_ENOUGH_MONEY;

+		}

 		dwPrice *= 3;

+	}

 

 	if (ch->GetGold() < dwPrice)

 	{

@@ -329,7 +343,7 @@
 

 	LPITEM item;

 

-	if (m_pkPC) // ÇÇ¾¾°¡ ¿î¿µÇÏ´Â ¼¥Àº ÇÇ¾¾°¡ ½ÇÁ¦ ¾ÆÀÌÅÛÀ» °¡Áö°íÀÖ¾î¾ß ÇÑ´Ù.

+	if (m_pkPC) // Ǿ ϴ  Ǿ   ־ Ѵ.

 		item = r_item.pkItem;

 	else

 		item = ITEM_MANAGER::instance().CreateItem(r_item.vnum, r_item.count);

@@ -341,7 +355,7 @@
 	{

 		if (quest::CQuestManager::instance().GetEventFlag("hivalue_item_sell") == 0)

 		{

-			// Ãàº¹ÀÇ ±¸½½ && ¸¸³âÇÑÃ¶ ÀÌº¥Æ® 

+			// ູ  && ö ̺Ʈ 

 			if (item->GetVnum() == 70024 || item->GetVnum() == 70035)

 			{

 				return SHOP_SUBHEADER_GC_END;

@@ -377,14 +391,14 @@
 	}

 

 	if (dwPrice)

-		ch->PointChange(POINT_GOLD, -dwPrice, false);

+		ch->PointChange(POINT_GOLD, -static_cast<POINT_VALUE>(dwPrice), false);

 

 #if defined(__CHEQUE_SYSTEM__)

 	if (dwCheque)

-		ch->PointChange(POINT_CHEQUE, -dwCheque, false);

-#endif

-

-	// ¼¼±Ý °è»ê

+		ch->PointChange(POINT_CHEQUE, -static_cast<POINT_VALUE>(dwCheque), false);

+#endif

+

+	//  

 	DWORD dwTax = 0;

 	int iVal = 0;

 

@@ -395,14 +409,26 @@
 			if (iVal > 100)

 				iVal = 100;

 

-			dwTax = dwPrice * iVal / 100;

-			dwPrice = dwPrice - dwTax;

+			{

+				const int64_t llPrice = static_cast<int64_t>(dwPrice);

+				int64_t llTax = (llPrice * static_cast<int64_t>(iVal)) / 100;

+				if (llTax < 0) llTax = 0;

+				if (llTax > llPrice) llTax = llPrice;

+				dwTax = static_cast<DWORD>(llTax);

+				dwPrice = static_cast<DWORD>(llPrice - llTax);

+			}

 		}

 		else

 		{

 			iVal = 3;

-			dwTax = dwPrice * iVal / 100;

-			dwPrice = dwPrice - dwTax;

+			{

+				const int64_t llPrice = static_cast<int64_t>(dwPrice);

+				int64_t llTax = (llPrice * static_cast<int64_t>(iVal)) / 100;

+				if (llTax < 0) llTax = 0;

+				if (llTax > llPrice) llTax = llPrice;

+				dwTax = static_cast<DWORD>(llTax);

+				dwPrice = static_cast<DWORD>(llPrice - llTax);

+			}

 		}

 	}

 	else

@@ -414,8 +440,14 @@
 			if (iVal > 100)

 				iVal = 100;

 

-			dwTax = dwPrice * iVal / 100;

-			dwPrice = dwPrice - dwTax;

+			{

+				const int64_t llPrice = static_cast<int64_t>(dwPrice);

+				int64_t llTax = (llPrice * static_cast<int64_t>(iVal)) / 100;

+				if (llTax < 0) llTax = 0;

+				if (llTax > llPrice) llTax = llPrice;

+				dwTax = static_cast<DWORD>(llTax);

+				dwPrice = static_cast<DWORD>(llPrice - llTax);

+			}

 		}

 		else

 		{

@@ -424,13 +456,13 @@
 		}

 	}

 

-	// »óÁ¡¿¡¼­ »ì‹š ¼¼±Ý 5%

+	//  싚  5%

 	if (!m_pkPC)

 	{

 		CMonarch::instance().SendtoDBAddMoney(dwTax, ch->GetEmpire(), ch);

 	}

 

-	// ±ºÁÖ ½Ã½ºÅÛ : ¼¼±Ý Â¡¼ö

+	//  ý :  ¡

 	if (m_pkPC)

 	{

 		m_pkPC->SyncQuickslot(SLOT_TYPE_INVENTORY, item->GetCell(), WORD_MAX);

@@ -470,7 +502,7 @@
 #endif

 

 		if (iVal > 0)

-			m_pkPC->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÆÇ¸Å±Ý¾×ÀÇ %d %% °¡ ¼¼±ÝÀ¸·Î ³ª°¡°ÔµË´Ï´Ù", iVal));

+			m_pkPC->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ǹűݾ %d %%   Ե˴ϴ", iVal));

 

 		CMonarch::instance().SendtoDBAddMoney(dwTax, m_pkPC->GetEmpire(), m_pkPC);

 	}

@@ -490,7 +522,7 @@
 			LogManager::instance().GoldBarLog(ch->GetPlayerID(), item->GetID(), PERSONAL_SHOP_BUY, "");

 		}

 

-		DBManager::instance().SendMoneyLog(MONEY_LOG_SHOP, item->GetVnum(), -dwPrice);

+		DBManager::instance().SendMoneyLog(MONEY_LOG_SHOP, item->GetVnum(), -static_cast<long>(dwPrice));

 	}

 

 	if (item)

@@ -511,6 +543,9 @@
 	if (!ch)

 		return false;

 

+	LPDESC d = ch->GetDesc();

+	if (!d) return false;

+

 	if (ch->GetExchange())

 		return false;

 

@@ -521,7 +556,7 @@
 

 	m_map_guest.insert(GuestMapType::value_type(ch, bOtherEmpire));

 

-	TPacketGCShop pack;

+	TPacketGCShop pack{};

 

 	pack.header = HEADER_GC_SHOP;

 	pack.subheader = SHOP_SUBHEADER_GC_START;

@@ -548,7 +583,7 @@
 		// HIVALUE_ITEM_EVENT

 		if (quest::CQuestManager::instance().GetEventFlag("hivalue_item_sell") == 0)

 		{

-			// Ãàº¹ÀÇ ±¸½½ && ¸¸³âÇÑÃ¶ ÀÌº¥Æ® 

+			// ູ  && ö ̺Ʈ 

 			if (item.vnum == 70024 || item.vnum == 70035)

 			{

 				continue;

@@ -594,8 +629,8 @@
 

 	pack.size = sizeof(pack) + sizeof(pack2);

 

-	ch->GetDesc()->BufferedPacket(&pack, sizeof(TPacketGCShop));

-	ch->GetDesc()->Packet(&pack2, sizeof(TPacketGCShopStart));

+	d->BufferedPacket(&pack, sizeof(TPacketGCShop));

+	d->Packet(&pack2, sizeof(TPacketGCShopStart));

 	return true;

 }

 

@@ -607,13 +642,14 @@
 	m_map_guest.erase(ch);

 	ch->SetShop(NULL);

 

-	TPacketGCShop pack;

+	TPacketGCShop pack{};

 

 	pack.header = HEADER_GC_SHOP;

 	pack.subheader = SHOP_SUBHEADER_GC_END;

 	pack.size = sizeof(TPacketGCShop);

 

-	ch->GetDesc()->Packet(&pack, sizeof(pack));

+	if (ch->GetDesc())

+		ch->GetDesc()->Packet(&pack, sizeof(pack));

 }

 

 void CShop::Broadcast(const void* data, int bytes)

@@ -637,6 +673,9 @@
 

 void CShop::BroadcastUpdateItem(BYTE pos)

 {

+	if (pos >= m_itemVector.size())

+		return;

+

 	TPacketGCShop pack;

 	TPacketGCShopUpdateItem pack2;

 


--- a/server/metin2/Source/Server/game/src/shop_manager.cpp
+++ b/server/metin2/Source/Server/game/src/shop_manager.cpp
@@ -76,6 +76,18 @@
 		delete v;

 

 	m_map_pkShop.clear();

+	m_map_pkShopByNPCVnum.clear(); // avoid dangling pointers

+

+	// also free PC shops on shutdown

+	{

+		TShopMap::iterator itPC = m_map_pkShopByPC.begin();

+		while (itPC != m_map_pkShopByPC.end())

+		{

+			delete itPC->second;

+			++itPC;

+		}

+		m_map_pkShopByPC.clear();

+	}

 }

 

 LPSHOP CShopManager::Get(DWORD dwVnum)

@@ -99,10 +111,10 @@
 }

 

 /*

-* ÀÎÅÍÆäÀÌ½º ÇÔ¼öµé

+* ̽ Լ

 */

 

-// »óÁ¡ °Å·¡¸¦ ½ÃÀÛ

+//  ŷ 

 bool CShopManager::StartShopping(LPCHARACTER pkChr, LPCHARACTER pkChrShopKeeper, int iShopVnum)

 {

 #if defined(__QUEST_EVENT_BUY_SELL__)

@@ -136,7 +148,7 @@
 	// PREVENT_TRADE_WINDOW

 	if (pkChr->PreventTradeWindow(WND_SHOPOWNER, true/*except*/))

 	{

-		pkChr->ChatPacket(CHAT_TYPE_INFO, LC_STRING("´Ù¸¥ °Å·¡Ã¢ÀÌ ¿­¸°»óÅÂ¿¡¼­´Â »óÁ¡°Å·¡¸¦ ÇÒ¼ö °¡ ¾ø½À´Ï´Ù."));

+		pkChr->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ٸ ŷâ ¿ ŷ Ҽ  ϴ."));

 		return false;

 	}

 	// END_PREVENT_TRADE_WINDOW

@@ -167,7 +179,9 @@
 	if (pkChr->GetEmpire() != pkChrShopKeeper->GetEmpire())

 		bOtherEmpire = true;

 

-	pkShop->AddGuest(pkChr, pkChrShopKeeper->GetVID(), bOtherEmpire);

+	if (!pkShop->AddGuest(pkChr, pkChrShopKeeper->GetVID(), bOtherEmpire))

+		return false;

+

 	pkChr->SetShopOwner(pkChrShopKeeper);

 	sys_log(0, "SHOP: START: %s", pkChr->GetName());

 	return true;

@@ -211,7 +225,7 @@
 	M2_DELETE(pkShop);

 }

 

-// »óÁ¡ °Å·¡¸¦ Á¾·á

+//  ŷ 

 void CShopManager::StopShopping(LPCHARACTER ch)

 {

 	LPSHOP shop;

@@ -227,7 +241,7 @@
 	sys_log(0, "SHOP: END: %s", ch->GetName());

 }

 

-// ¾ÆÀÌÅÛ ±¸ÀÔ

+//  

 void CShopManager::Buy(LPCHARACTER ch, BYTE pos)

 {

 	if (!ch->GetShop())

@@ -238,7 +252,7 @@
 

 	if (DISTANCE_APPROX(ch->GetX() - ch->GetShopOwner()->GetX(), ch->GetY() - ch->GetShopOwner()->GetY()) > 2000)

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÁ¡°úÀÇ °Å¸®°¡ ³Ê¹« ¸Ö¾î ¹°°ÇÀ» »ì ¼ö ¾ø½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ÿ ʹ ־    ϴ."));

 		return;

 	}

 

@@ -252,16 +266,21 @@
 

 	int ret = pkShop->Buy(ch, pos);

 

-	if (SHOP_SUBHEADER_GC_OK != ret) // ¹®Á¦°¡ ÀÖ¾úÀ¸¸é º¸³½´Ù.

-	{

-		TPacketGCShop pack;

+	if (SHOP_SUBHEADER_GC_OK != ret) // 문제가 있을때만 보낸다.

+	{

+		TPacketGCShop pack{};

 

 		pack.header = HEADER_GC_SHOP;

 		pack.subheader = ret;

 		pack.size = sizeof(TPacketGCShop);

 

-		ch->GetDesc()->Packet(&pack, sizeof(pack));

-	}

+		LPDESC d = ch->GetDesc();

+		if (!d)

+			return;

+

+		d->Packet(&pack, sizeof(pack));

+	}

+}

 }

 

 void CShopManager::Sell(LPCHARACTER ch, WORD wCell, WORD wCount, BYTE bType)

@@ -280,7 +299,7 @@
 

 	if (DISTANCE_APPROX(ch->GetX() - ch->GetShopOwner()->GetX(), ch->GetY() - ch->GetShopOwner()->GetY()) > 2000)

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("»óÁ¡°úÀÇ °Å¸®°¡ ³Ê¹« ¸Ö¾î ¹°°ÇÀ» ÆÈ ¼ö ¾ø½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING(" Ÿ ʹ ־    ϴ."));

 		return;

 	}

 

@@ -291,7 +310,7 @@
 

 	if (item->IsEquipped() == true)

 	{

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Âø¿ë ÁßÀÎ ¾ÆÀÌÅÛÀº ÆÇ¸ÅÇÒ ¼ö ¾ø½À´Ï´Ù."));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("   Ǹ  ϴ."));

 		return;

 	}

 

@@ -333,7 +352,7 @@
 

 	dwPrice /= 5;

 

-	// ¼¼±Ý °è»ê

+	//  

 	DWORD dwTax = 0;

 	int iVal = 3;

 

@@ -347,11 +366,11 @@
 	if (GOLD_MAX <= nTotalMoney)

 	{

 		sys_err("[OVERFLOW_GOLD] id %u name %s gold %d", ch->GetPlayerID(), ch->GetName(), ch->GetGold());

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("20¾ï³ÉÀÌ ÃÊ°úÇÏ¿© ¹°Ç°À» ÆÈ¼ö ¾ø½À´Ï´Ù."));

-		return;

-	}

-

-	// 20050802.myevan.»óÁ¡ ÆÇ¸Å ·Î±×¿¡ ¾ÆÀÌÅÛ ID Ãß°¡

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("20 ʰϿ ǰ ȼ ϴ."));

+		return;

+	}

+

+	// 20050802.myevan. Ǹ α׿  ID ߰

 	sys_log(0, "SHOP: SELL: %s item name: %s(x%d):%u price: %u", ch->GetName(), item->GetName(), wCount, item->GetID(), dwPrice);

 

 #ifdef ENABLE_EXTENDED_BATTLE_PASS

@@ -359,7 +378,7 @@
 #endif

 

 	if (iVal > 0)

-		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("ÆÇ¸Å±Ý¾×ÀÇ %d %% °¡ ¼¼±ÝÀ¸·Î ³ª°¡°ÔµË´Ï´Ù", iVal));

+		ch->ChatPacket(CHAT_TYPE_INFO, LC_STRING("Ǹűݾ %d %%   Ե˴ϴ", iVal));

 

 	DBManager::instance().SendMoneyLog(MONEY_LOG_SHOP, item->GetVnum(), dwPrice);

 

@@ -377,7 +396,7 @@
 	else

 		item->SetCount(item->GetCount() - wCount);

 

-	// ±ºÁÖ ½Ã½ºÅÛ : ¼¼±Ý Â¡¼ö

+	//  ý :  ¡

 	CMonarch::instance().SendtoDBAddMoney(dwTax, ch->GetEmpire(), ch);

 

 	ch->PointChange(POINT_GOLD, dwPrice, false);

@@ -580,8 +599,8 @@
 

 bool CShopManager::ReadShopTableEx(const char* stFileName)

 {

-	// file À¯¹« Ã¼Å©.

-	// ¾ø´Â °æ¿ì´Â ¿¡·¯·Î Ã³¸®ÇÏÁö ¾Ê´Â´Ù.

+	// file  üũ.

+	//    ó ʴ´.

 	FILE* fp = fopen(stFileName, "rb");

 	if (NULL == fp)

 		return true;


