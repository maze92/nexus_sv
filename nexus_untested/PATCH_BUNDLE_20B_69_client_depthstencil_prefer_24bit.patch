--- /mnt/data/_patch_orig/grpdetector_cpp_GrpDetector.cpp	2026-02-11 12:11:56.000000000 +0000
+++ "/mnt/data/nexus_src/Nexus OS/src-client/Client/EterLib/GrpDetector.cpp"	2026-02-17 05:22:23.443592839 +0000
@@ -182,85 +182,87 @@
 	UINT m_dwMinDepthBits = 16;
 	UINT m_dwMinStencilBits = 0;
 
-	if (m_dwMinDepthBits <= 16 && m_dwMinStencilBits == 0)
+	// Prefer higher precision depth-stencil formats first (reduces Z-fighting / flicker).
+	// Fall back to 16-bit depth only if needed for compatibility.
+	if (m_dwMinDepthBits <= 24 && m_dwMinStencilBits <= 8)
 	{
 		if (SUCCEEDED(rkD3D.CheckDeviceFormat(iD3DAdapterInfo, DeviceType,
-			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D16)))
+			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D24S8)))
 		{
 			if (SUCCEEDED(rkD3D.CheckDepthStencilMatch(iD3DAdapterInfo, DeviceType,
-				TargetFormat, TargetFormat, D3DFMT_D16)))
+				TargetFormat, TargetFormat, D3DFMT_D24S8)))
 			{
-				*pDepthStencilFormat = D3DFMT_D16;
+				*pDepthStencilFormat = D3DFMT_D24S8;
 				return TRUE;
 			}
 		}
 	}
 
-	if (m_dwMinDepthBits <= 15 && m_dwMinStencilBits <= 1)
+	if (m_dwMinDepthBits <= 24 && m_dwMinStencilBits == 0)
 	{
 		if (SUCCEEDED(rkD3D.CheckDeviceFormat(iD3DAdapterInfo, DeviceType,
-			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D15S1)))
+			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D24X8)))
 		{
 			if (SUCCEEDED(rkD3D.CheckDepthStencilMatch(iD3DAdapterInfo, DeviceType,
-				TargetFormat, TargetFormat, D3DFMT_D15S1)))
+				TargetFormat, TargetFormat, D3DFMT_D24X8)))
 			{
-				*pDepthStencilFormat = D3DFMT_D15S1;
+				*pDepthStencilFormat = D3DFMT_D24X8;
 				return TRUE;
 			}
 		}
 	}
 
-	if (m_dwMinDepthBits <= 24 && m_dwMinStencilBits == 0)
+	if (m_dwMinDepthBits <= 32 && m_dwMinStencilBits == 0)
 	{
 		if (SUCCEEDED(rkD3D.CheckDeviceFormat(iD3DAdapterInfo, DeviceType,
-			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D24X8)))
+			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D32)))
 		{
 			if (SUCCEEDED(rkD3D.CheckDepthStencilMatch(iD3DAdapterInfo, DeviceType,
-				TargetFormat, TargetFormat, D3DFMT_D24X8)))
+				TargetFormat, TargetFormat, D3DFMT_D32)))
 			{
-				*pDepthStencilFormat = D3DFMT_D24X8;
+				*pDepthStencilFormat = D3DFMT_D32;
 				return TRUE;
 			}
 		}
 	}
 
-	if (m_dwMinDepthBits <= 24 && m_dwMinStencilBits <= 8)
+	if (m_dwMinDepthBits <= 16 && m_dwMinStencilBits == 0)
 	{
 		if (SUCCEEDED(rkD3D.CheckDeviceFormat(iD3DAdapterInfo, DeviceType,
-			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D24S8)))
+			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D16)))
 		{
 			if (SUCCEEDED(rkD3D.CheckDepthStencilMatch(iD3DAdapterInfo, DeviceType,
-				TargetFormat, TargetFormat, D3DFMT_D24S8)))
+				TargetFormat, TargetFormat, D3DFMT_D16)))
 			{
-				*pDepthStencilFormat = D3DFMT_D24S8;
+				*pDepthStencilFormat = D3DFMT_D16;
 				return TRUE;
 			}
 		}
 	}
 
-	if (m_dwMinDepthBits <= 24 && m_dwMinStencilBits <= 4)
+	if (m_dwMinDepthBits <= 15 && m_dwMinStencilBits <= 1)
 	{
 		if (SUCCEEDED(rkD3D.CheckDeviceFormat(iD3DAdapterInfo, DeviceType,
-			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D24X4S4)))
+			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D15S1)))
 		{
 			if (SUCCEEDED(rkD3D.CheckDepthStencilMatch(iD3DAdapterInfo, DeviceType,
-				TargetFormat, TargetFormat, D3DFMT_D24X4S4)))
+				TargetFormat, TargetFormat, D3DFMT_D15S1)))
 			{
-				*pDepthStencilFormat = D3DFMT_D24X4S4;
+				*pDepthStencilFormat = D3DFMT_D15S1;
 				return TRUE;
 			}
 		}
 	}
 
-	if (m_dwMinDepthBits <= 32 && m_dwMinStencilBits == 0)
+	if (m_dwMinDepthBits <= 24 && m_dwMinStencilBits <= 4)
 	{
 		if (SUCCEEDED(rkD3D.CheckDeviceFormat(iD3DAdapterInfo, DeviceType,
-			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D32)))
+			TargetFormat, D3DUSAGE_DEPTHSTENCIL, D3DRTYPE_SURFACE, D3DFMT_D24X4S4)))
 		{
 			if (SUCCEEDED(rkD3D.CheckDepthStencilMatch(iD3DAdapterInfo, DeviceType,
-				TargetFormat, TargetFormat, D3DFMT_D32)))
+				TargetFormat, TargetFormat, D3DFMT_D24X4S4)))
 			{
-				*pDepthStencilFormat = D3DFMT_D32;
+				*pDepthStencilFormat = D3DFMT_D24X4S4;
 				return TRUE;
 			}
 		}
